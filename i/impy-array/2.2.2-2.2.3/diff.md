# Comparing `tmp/impy_array-2.2.2.tar.gz` & `tmp/impy_array-2.2.3.tar.gz`

## Comparing `impy_array-2.2.2.tar` & `impy_array-2.2.3.tar`

### file list

```diff
@@ -1,61 +1,62 @@
--rw-r--r--   0        0        0     1084 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/__init__.py
--rw-r--r--   0        0        0     4974 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/__main__.py
--rw-r--r--   0        0        0     3688 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/_const.py
--rw-r--r--   0        0        0      808 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/_types.py
--rw-r--r--   0        0        0     4839 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/array_api.py
--rw-r--r--   0        0        0     9651 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/binder.py
--rw-r--r--   0        0        0    10946 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/collections.py
--rw-r--r--   0        0        0    29654 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/core.py
--rw-r--r--   0        0        0    28398 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/correlation.py
--rw-r--r--   0        0        0    19241 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/io.py
--rw-r--r--   0        0        0     7035 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/random.py
--rw-r--r--   0        0        0    14164 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/roi.py
--rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/__init__.py
--rw-r--r--   0        0        0    13111 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_deprecated.py
--rw-r--r--   0        0        0     6517 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_imshow.py
--rw-r--r--   0        0        0    10570 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/axesmixin.py
--rw-r--r--   0        0        0     2809 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/big.py
--rw-r--r--   0        0        0   157482 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/imgarray.py
--rw-r--r--   0        0        0     6415 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/label.py
--rw-r--r--   0        0        0    56945 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/labeledarray.py
--rw-r--r--   0        0        0    55489 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/lazy.py
--rw-r--r--   0        0        0    13937 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/phasearray.py
--rw-r--r--   0        0        0     7886 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/specials.py
--rw-r--r--   0        0        0      271 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/__init__.py
--rw-r--r--   0        0        0    10031 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_corr.py
--rw-r--r--   0        0        0     3101 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_deconv.py
--rw-r--r--   0        0        0     4548 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_docs.py
--rw-r--r--   0        0        0     6794 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_filters.py
--rw-r--r--   0        0        0     4206 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_glcm.py
--rw-r--r--   0        0        0     2646 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_linalg.py
--rw-r--r--   0        0        0     2865 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_misc.py
--rw-r--r--   0        0        0     5042 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_plot.py
--rw-r--r--   0        0        0     3428 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_process_numba.py
--rw-r--r--   0        0        0     1283 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_skimage.py
--rw-r--r--   0        0        0     1305 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_structures.py
--rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/_utils/_transform.py
--rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/bases/__init__.py
--rw-r--r--   0        0        0    27104 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/bases/metaarray.py
--rw-r--r--   0        0        0     9359 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/arrays/bases/overload.py
--rw-r--r--   0        0        0      239 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/axes/__init__.py
--rw-r--r--   0        0        0    12134 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/axes/_axes.py
--rw-r--r--   0        0        0     1522 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/axes/_axes_tuple.py
--rw-r--r--   0        0        0     7630 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/axes/_axis.py
--rw-r--r--   0        0        0     2657 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/axes/_slicer.py
--rw-r--r--   0        0        0       65 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/frame/__init__.py
--rw-r--r--   0        0        0    12354 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/frame/frames.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/utils/__init__.py
--rw-r--r--   0        0        0     3076 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/utils/axesop.py
--rw-r--r--   0        0        0     5946 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/utils/deco.py
--rw-r--r--   0        0        0     4770 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/utils/gauss.py
--rw-r--r--   0        0        0      622 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/utils/misc.py
--rw-r--r--   0        0        0     2423 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/utils/slicer.py
--rw-r--r--   0        0        0      437 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/utils/utilcls.py
--rw-r--r--   0        0        0      286 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/viewer/__init__.py
--rw-r--r--   0        0        0    12187 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/viewer/utils.py
--rw-r--r--   0        0        0    17561 2020-02-02 00:00:00.000000 impy_array-2.2.2/impy/viewer/viewer.py
--rw-r--r--   0        0        0     1936 2020-02-02 00:00:00.000000 impy_array-2.2.2/.gitignore
--rw-r--r--   0        0        0     1546 2020-02-02 00:00:00.000000 impy_array-2.2.2/LICENSE
--rw-r--r--   0        0        0     3613 2020-02-02 00:00:00.000000 impy_array-2.2.2/README.md
--rw-r--r--   0        0        0     1266 2020-02-02 00:00:00.000000 impy_array-2.2.2/pyproject.toml
--rw-r--r--   0        0        0     6322 2020-02-02 00:00:00.000000 impy_array-2.2.2/PKG-INFO
+-rw-r--r--   0        0        0     1084 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/__init__.py
+-rw-r--r--   0        0        0     4974 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/__main__.py
+-rw-r--r--   0        0        0     3688 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/_const.py
+-rw-r--r--   0        0        0      808 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/_types.py
+-rw-r--r--   0        0        0     4839 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/array_api.py
+-rw-r--r--   0        0        0     9651 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/binder.py
+-rw-r--r--   0        0        0    10946 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/collections.py
+-rw-r--r--   0        0        0    29654 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/core.py
+-rw-r--r--   0        0        0    28398 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/correlation.py
+-rw-r--r--   0        0        0    19241 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/io.py
+-rw-r--r--   0        0        0     7035 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/random.py
+-rw-r--r--   0        0        0    14164 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/roi.py
+-rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/__init__.py
+-rw-r--r--   0        0        0    13143 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_deprecated.py
+-rw-r--r--   0        0        0     6517 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_imshow.py
+-rw-r--r--   0        0        0    10570 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/axesmixin.py
+-rw-r--r--   0        0        0     2809 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/big.py
+-rw-r--r--   0        0        0   155930 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/imgarray.py
+-rw-r--r--   0        0        0     6415 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/label.py
+-rw-r--r--   0        0        0    56945 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/labeledarray.py
+-rw-r--r--   0        0        0    55446 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/lazy.py
+-rw-r--r--   0        0        0    13937 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/phasearray.py
+-rw-r--r--   0        0        0     7886 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/specials.py
+-rw-r--r--   0        0        0     4696 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/tiled.py
+-rw-r--r--   0        0        0      271 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/__init__.py
+-rw-r--r--   0        0        0    10031 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_corr.py
+-rw-r--r--   0        0        0     3101 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_deconv.py
+-rw-r--r--   0        0        0     4968 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_docs.py
+-rw-r--r--   0        0        0     7212 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_filters.py
+-rw-r--r--   0        0        0     4206 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_glcm.py
+-rw-r--r--   0        0        0     2646 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_linalg.py
+-rw-r--r--   0        0        0     2865 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_misc.py
+-rw-r--r--   0        0        0     5042 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_plot.py
+-rw-r--r--   0        0        0     3428 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_process_numba.py
+-rw-r--r--   0        0        0     1283 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_skimage.py
+-rw-r--r--   0        0        0     1305 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_structures.py
+-rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/_utils/_transform.py
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/bases/__init__.py
+-rw-r--r--   0        0        0    27104 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/bases/metaarray.py
+-rw-r--r--   0        0        0     9359 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/arrays/bases/overload.py
+-rw-r--r--   0        0        0      239 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/axes/__init__.py
+-rw-r--r--   0        0        0    12134 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/axes/_axes.py
+-rw-r--r--   0        0        0     1522 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/axes/_axes_tuple.py
+-rw-r--r--   0        0        0     7630 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/axes/_axis.py
+-rw-r--r--   0        0        0     2657 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/axes/_slicer.py
+-rw-r--r--   0        0        0       65 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/frame/__init__.py
+-rw-r--r--   0        0        0    12354 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/frame/frames.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/utils/__init__.py
+-rw-r--r--   0        0        0     3076 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/utils/axesop.py
+-rw-r--r--   0        0        0     5946 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/utils/deco.py
+-rw-r--r--   0        0        0     4770 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/utils/gauss.py
+-rw-r--r--   0        0        0      622 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/utils/misc.py
+-rw-r--r--   0        0        0     2423 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/utils/slicer.py
+-rw-r--r--   0        0        0      437 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/utils/utilcls.py
+-rw-r--r--   0        0        0      286 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/viewer/__init__.py
+-rw-r--r--   0        0        0    12187 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/viewer/utils.py
+-rw-r--r--   0        0        0    17561 2020-02-02 00:00:00.000000 impy_array-2.2.3/impy/viewer/viewer.py
+-rw-r--r--   0        0        0     1936 2020-02-02 00:00:00.000000 impy_array-2.2.3/.gitignore
+-rw-r--r--   0        0        0     1546 2020-02-02 00:00:00.000000 impy_array-2.2.3/LICENSE
+-rw-r--r--   0        0        0     3613 2020-02-02 00:00:00.000000 impy_array-2.2.3/README.md
+-rw-r--r--   0        0        0     1266 2020-02-02 00:00:00.000000 impy_array-2.2.3/pyproject.toml
+-rw-r--r--   0        0        0     6322 2020-02-02 00:00:00.000000 impy_array-2.2.3/PKG-INFO
```

### Comparing `impy_array-2.2.2/impy/__init__.py` & `impy_array-2.2.3/impy/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-__version__ = "2.2.2"
+__version__ = "2.2.3"
 __author__ = "Hanjin Liu"
 __email__ = "liuhanjin-sc@g.ecc.u-tokyo.ac.jp"
 
 import logging
 
 from ._const import Const, SetConst, use
```

### Comparing `impy_array-2.2.2/impy/__main__.py` & `impy_array-2.2.3/impy/__main__.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/_const.py` & `impy_array-2.2.3/impy/_const.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/_types.py` & `impy_array-2.2.3/impy/_types.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/array_api.py` & `impy_array-2.2.3/impy/array_api.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/binder.py` & `impy_array-2.2.3/impy/binder.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/collections.py` & `impy_array-2.2.3/impy/collections.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/core.py` & `impy_array-2.2.3/impy/core.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/correlation.py` & `impy_array-2.2.3/impy/correlation.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/io.py` & `impy_array-2.2.3/impy/io.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/random.py` & `impy_array-2.2.3/impy/random.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/roi.py` & `impy_array-2.2.3/impy/roi.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/__init__.py` & `impy_array-2.2.3/impy/arrays/__init__.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_deprecated.py` & `impy_array-2.2.3/impy/arrays/_deprecated.py`

 * *Files 1% similar despite different names*

```diff
@@ -18,15 +18,15 @@
 
 if TYPE_CHECKING:
     from ..frame import MarkerFrame
     from .imgarray import ImgArray
 
 @dims_to_spatial_axes
 def gauss_sm(
-    self,
+    self: ImgArray,
     coords = None,
     radius = 4,
     sigma = 1.5, 
     filt = None,
     percentile: float = 95,
     *,
     return_all: bool = False,
@@ -126,15 +126,15 @@
                         
     return out
 
 
 @dims_to_spatial_axes
 @check_input_and_output
 def corner_peaks(
-    self,
+    self: ImgArray,
     *, 
     min_distance:int = 1,
     percentile: float | None = None, 
     topn: int = np.inf,
     topn_per_label: int = np.inf,
     exclude_border: bool = True,
     use_labels: bool = True, 
@@ -235,15 +235,15 @@
     """        
     warnings.warn("'find_corners' is deprecated and will be removed.", DeprecationWarning)
     res = self.gaussian_filter(sigma=1).corner_harris(sigma=sigma, k=k, dims=dims)
     out = res.corner_peaks(min_distance=3, percentile=97, dims=dims)
     return out
 
 @check_input_and_output
-def track_template(self, template:np.ndarray, bg=None, along: AxisLike = "t") -> MarkerFrame:
+def track_template(self: ImgArray, template:np.ndarray, bg=None, along: AxisLike = "t") -> MarkerFrame:
     """
     Tracking using template matching. For every time frame, matched region is interpreted as a
     new template and is used for the next template. To avoid slight shifts accumulating to the
     template image, new template image will be fitteg to the old one by phase cross correlation.
 
     Parameters
     ----------
@@ -297,14 +297,15 @@
     from ..frame import MarkerFrame
     pos = np.array(pos)
     pos = np.hstack([np.arange(self.sizeof(along), dtype=np.uint16).reshape(-1,1), pos])
     pos = MarkerFrame(pos, columns=along+dims)
     
     return pos
 
+
 def _translate_image(img, shift, order=1, cval=0):
     ndim = len(shift)
     mx = _transform.compose_affine_matrix(translation=-np.asarray(shift), ndim=ndim)
     return _transform.warp(img, mx, order=order, cval=cval)
 
 
 def _specify_one(center, radius, shape:tuple) -> tuple[slice]:
```

### Comparing `impy_array-2.2.2/impy/arrays/_imshow.py` & `impy_array-2.2.3/impy/arrays/_imshow.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/axesmixin.py` & `impy_array-2.2.3/impy/arrays/axesmixin.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/big.py` & `impy_array-2.2.3/impy/arrays/big.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/imgarray.py` & `impy_array-2.2.3/impy/arrays/imgarray.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,9829 +15,9732 @@
 000000e0: 6564 6172 7261 7920 696d 706f 7274 204c  edarray import L
 000000f0: 6162 656c 6564 4172 7261 790d 0a66 726f  abeledArray..fro
 00000100: 6d20 2e6c 6162 656c 2069 6d70 6f72 7420  m .label import 
 00000110: 4c61 6265 6c0d 0a66 726f 6d20 2e70 6861  Label..from .pha
 00000120: 7365 6172 7261 7920 696d 706f 7274 2050  searray import P
 00000130: 6861 7365 4172 7261 790d 0a66 726f 6d20  haseArray..from 
 00000140: 2e73 7065 6369 616c 7320 696d 706f 7274  .specials import
-00000150: 2050 726f 7041 7272 6179 0d0a 0d0a 6672   PropArray....fr
-00000160: 6f6d 202e 5f75 7469 6c73 2e5f 736b 696d  om ._utils._skim
-00000170: 6167 6520 696d 706f 7274 2073 6b65 7870  age import skexp
-00000180: 2c20 736b 6665 6174 2c20 736b 6669 6c2c  , skfeat, skfil,
-00000190: 2073 6b69 6d61 6765 2c20 736b 6d65 732c   skimage, skmes,
-000001a0: 2073 6b72 6573 2c20 736b 7365 672c 2073   skres, skseg, s
-000001b0: 6b74 7261 6e73 0d0a 6672 6f6d 202e 5f75  ktrans..from ._u
-000001c0: 7469 6c73 2069 6d70 6f72 7420 5f66 696c  tils import _fil
-000001d0: 7465 7273 2c20 5f6c 696e 616c 672c 205f  ters, _linalg, _
-000001e0: 6465 636f 6e76 2c20 5f6d 6973 632c 205f  deconv, _misc, _
-000001f0: 676c 636d 2c20 5f64 6f63 732c 205f 7472  glcm, _docs, _tr
-00000200: 616e 7366 6f72 6d2c 205f 7374 7275 6374  ansform, _struct
-00000210: 7572 6573 2c20 5f63 6f72 720d 0a0d 0a66  ures, _corr....f
-00000220: 726f 6d20 696d 7079 2e75 7469 6c73 2e61  rom impy.utils.a
-00000230: 7865 736f 7020 696d 706f 7274 2061 6464  xesop import add
-00000240: 5f61 7865 732c 2073 7769 7463 685f 736c  _axes, switch_sl
-00000250: 6963 652c 2063 6f6d 706c 656d 656e 745f  ice, complement_
-00000260: 6178 6573 2c20 6669 6e64 5f66 6972 7374  axes, find_first
-00000270: 5f61 7070 6561 7265 640d 0a66 726f 6d20  _appeared..from 
-00000280: 696d 7079 2e75 7469 6c73 2e64 6563 6f20  impy.utils.deco 
-00000290: 696d 706f 7274 2063 6865 636b 5f69 6e70  import check_inp
-000002a0: 7574 5f61 6e64 5f6f 7574 7075 742c 2064  ut_and_output, d
-000002b0: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
-000002c0: 7865 732c 2073 616d 655f 6474 7970 650d  xes, same_dtype.
-000002d0: 0a66 726f 6d20 696d 7079 2e75 7469 6c73  .from impy.utils
-000002e0: 2e67 6175 7373 2069 6d70 6f72 7420 4761  .gauss import Ga
-000002f0: 7573 7369 616e 4261 636b 6772 6f75 6e64  ussianBackground
-00000300: 2c20 4761 7573 7369 616e 5061 7274 6963  , GaussianPartic
-00000310: 6c65 0d0a 6672 6f6d 2069 6d70 792e 7574  le..from impy.ut
-00000320: 696c 732e 6d69 7363 2069 6d70 6f72 7420  ils.misc import 
-00000330: 6368 6563 6b5f 6e64 2c20 6c61 7267 6573  check_nd, larges
-00000340: 745f 7a65 726f 730d 0a66 726f 6d20 696d  t_zeros..from im
-00000350: 7079 2e75 7469 6c73 2e73 6c69 6365 7220  py.utils.slicer 
-00000360: 696d 706f 7274 2073 6f6c 7665 5f73 6c69  import solve_sli
-00000370: 6365 720d 0a0d 0a66 726f 6d20 696d 7079  cer....from impy
-00000380: 2e63 6f6c 6c65 6374 696f 6e73 2069 6d70  .collections imp
-00000390: 6f72 7420 4461 7461 4469 6374 0d0a 6672  ort DataDict..fr
-000003a0: 6f6d 2069 6d70 792e 6178 6573 2069 6d70  om impy.axes imp
-000003b0: 6f72 7420 4178 6973 4c69 6b65 2c20 736c  ort AxisLike, sl
-000003c0: 6963 6572 2c20 4178 6573 2c20 4178 6973  icer, Axes, Axis
-000003d0: 0d0a 6672 6f6d 2069 6d70 792e 5f74 7970  ..from impy._typ
-000003e0: 6573 2069 6d70 6f72 7420 6e44 496e 742c  es import nDInt,
-000003f0: 206e 4446 6c6f 6174 2c20 4469 6d73 2c20   nDFloat, Dims, 
-00000400: 436f 6f72 6473 2c20 4178 6573 5461 7267  Coords, AxesTarg
-00000410: 6574 6564 536c 6963 6572 2c20 5061 6464  etedSlicer, Padd
-00000420: 696e 674d 6f64 650d 0a66 726f 6d20 696d  ingMode..from im
-00000430: 7079 2e5f 636f 6e73 7420 696d 706f 7274  py._const import
-00000440: 2043 6f6e 7374 0d0a 6672 6f6d 2069 6d70   Const..from imp
-00000450: 792e 6172 7261 795f 6170 6920 696d 706f  y.array_api impo
-00000460: 7274 2078 702c 2063 7570 795f 6469 7370  rt xp, cupy_disp
-00000470: 6174 6368 6572 0d0a 0d0a 6966 2054 5950  atcher....if TYP
-00000480: 455f 4348 4543 4b49 4e47 3a0d 0a20 2020  E_CHECKING:..   
-00000490: 2066 726f 6d20 2e2e 6672 616d 6520 696d   from ..frame im
-000004a0: 706f 7274 204d 6172 6b65 7246 7261 6d65  port MarkerFrame
-000004b0: 0d0a 2020 2020 6672 6f6d 2074 7970 696e  ..    from typin
-000004c0: 6720 696d 706f 7274 204c 6974 6572 616c  g import Literal
-000004d0: 2c20 556e 696f 6e0d 0a20 2020 2054 6872  , Union..    Thr
-000004e0: 6561 7368 6f6c 644d 6574 686f 6420 3d20  easholdMethod = 
-000004f0: 4c69 7465 7261 6c5b 0d0a 2020 2020 2020  Literal[..      
-00000500: 2020 2269 736f 6461 7461 222c 2022 6c69    "isodata", "li
-00000510: 222c 2022 6c6f 6361 6c22 2c20 226d 6561  ", "local", "mea
-00000520: 6e22 2c20 226d 696e 222c 2022 6d69 6e69  n", "min", "mini
-00000530: 6d75 6d22 2c20 226e 6962 6c61 636b 222c  mum", "niblack",
-00000540: 2022 6f74 7375 222c 2022 7361 7576 6f6c   "otsu", "sauvol
-00000550: 6122 2c0d 0a20 2020 2020 2020 2022 7472  a",..        "tr
-00000560: 6961 6e67 6c65 222c 2022 7965 6e22 0d0a  iangle", "yen"..
-00000570: 2020 2020 5d0d 0a20 2020 2046 6674 5368      ]..    FftSh
-00000580: 6170 6520 3d20 4c69 7465 7261 6c5b 2273  ape = Literal["s
-00000590: 616d 6522 2c20 2273 7175 6172 6522 5d0d  ame", "square"].
-000005a0: 0a0d 0a63 6c61 7373 2049 6d67 4172 7261  ...class ImgArra
-000005b0: 7928 4c61 6265 6c65 6441 7272 6179 293a  y(LabeledArray):
-000005c0: 0d0a 2020 2020 2222 220d 0a20 2020 2041  ..    """..    A
-000005d0: 6e20 6e2d 4420 6172 7261 7920 666f 7220  n n-D array for 
-000005e0: 696d 6167 6520 616e 616c 7973 6973 2e0d  image analysis..
-000005f0: 0a20 2020 200d 0a20 2020 2041 7474 7269  .    ..    Attri
-00000600: 6275 7465 730d 0a20 2020 202d 2d2d 2d2d  butes..    -----
-00000610: 2d2d 2d2d 2d0d 0a20 2020 2061 7865 7320  -----..    axes 
-00000620: 3a20 7374 720d 0a20 2020 2020 2020 2049  : str..        I
-00000630: 6d61 6765 2061 7865 732c 2073 7563 6820  mage axes, such 
-00000640: 6173 2022 7a79 7822 206f 7220 2274 6379  as "zyx" or "tcy
-00000650: 7822 2e0d 0a20 2020 2073 6361 6c65 203a  x"...    scale :
-00000660: 2053 6361 6c65 4469 6374 0d0a 2020 2020   ScaleDict..    
-00000670: 2020 2020 5068 7973 6963 616c 2073 6361      Physical sca
-00000680: 6c65 2061 6c6f 6e67 2065 6163 6820 6178  le along each ax
-00000690: 6973 2e20 466f 7220 696e 7374 616e 6365  is. For instance
-000006a0: 2c20 7363 616c 6520 6f66 2078 2d61 7869  , scale of x-axi
-000006b0: 7320 6361 6e20 6265 2072 6566 6572 7265  s can be referre
-000006c0: 6420 0d0a 2020 2020 2020 2020 746f 2062  d ..        to b
-000006d0: 7920 6060 696d 672e 7363 616c 655b 2278  y ``img.scale["x
-000006e0: 225d 6060 206f 7220 6060 696d 672e 7363  "]`` or ``img.sc
-000006f0: 616c 652e 780d 0a20 2020 206d 6574 6164  ale.x..    metad
-00000700: 6174 6120 3a20 6469 6374 0d0a 2020 2020  ata : dict..    
-00000710: 2020 2020 4d65 7461 6461 7461 2074 6167      Metadata tag
-00000720: 6765 6420 746f 2074 6865 2069 6d61 6765  ged to the image
-00000730: 2e0d 0a20 2020 2073 6f75 7263 6520 3a20  ...    source : 
-00000740: 5061 7468 0d0a 2020 2020 2020 2020 536f  Path..        So
-00000750: 7572 6365 2066 696c 6520 6f66 2074 6865  urce file of the
-00000760: 2069 6d61 6765 2e0d 0a20 2020 2022 2222   image...    """
-00000770: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
-00000780: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
-00000790: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
-000007a0: 6573 0d0a 2020 2020 4073 616d 655f 6474  es..    @same_dt
-000007b0: 7970 6528 6173 666c 6f61 743d 5472 7565  ype(asfloat=True
-000007c0: 290d 0a20 2020 2040 6368 6563 6b5f 696e  )..    @check_in
-000007d0: 7075 745f 616e 645f 6f75 7470 7574 0d0a  put_and_output..
-000007e0: 2020 2020 6465 6620 6166 6669 6e65 280d      def affine(.
-000007f0: 0a20 2020 2020 2020 2073 656c 662c 206d  .        self, m
-00000800: 6174 7269 783d 4e6f 6e65 2c20 2a2c 2073  atrix=None, *, s
-00000810: 6361 6c65 3d4e 6f6e 652c 2072 6f74 6174  cale=None, rotat
-00000820: 696f 6e3d 4e6f 6e65 2c20 7368 6561 723d  ion=None, shear=
-00000830: 4e6f 6e65 2c20 7472 616e 736c 6174 696f  None, translatio
-00000840: 6e3d 4e6f 6e65 2c0d 0a20 2020 2020 2020  n=None,..       
-00000850: 206f 7264 6572 3a20 696e 7420 3d20 312c   order: int = 1,
-00000860: 206d 6f64 653a 2050 6164 6469 6e67 4d6f   mode: PaddingMo
-00000870: 6465 203d 2022 636f 6e73 7461 6e74 222c  de = "constant",
-00000880: 2063 7661 6c3a 2066 6c6f 6174 203d 2030   cval: float = 0
-00000890: 2c20 6f75 7470 7574 5f73 6861 7065 203d  , output_shape =
-000008a0: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-000008b0: 7072 6566 696c 7465 723a 2062 6f6f 6c20  prefilter: bool 
-000008c0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 2064  | None = None, d
-000008d0: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
-000008e0: 2c20 7570 6461 7465 3a20 626f 6f6c 203d  , update: bool =
-000008f0: 2046 616c 7365 2c0d 0a20 2020 2029 202d   False,..    ) -
-00000900: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
-00000910: 2020 2020 2072 2222 220d 0a20 2020 2020       r"""..     
-00000920: 2020 2043 6f6e 7665 7274 2069 6d61 6765     Convert image
-00000930: 2062 7920 4166 6669 6e65 2074 7261 6e73   by Affine trans
-00000940: 666f 726d 6174 696f 6e2e 2032 4420 4166  formation. 2D Af
-00000950: 6669 6e65 2074 7261 6e73 666f 726d 6174  fine transformat
-00000960: 696f 6e20 6973 2077 7269 7474 656e 2061  ion is written a
-00000970: 733a 0d0a 2020 2020 2020 2020 0d0a 2020  s:..        ..  
-00000980: 2020 2020 2020 2e2e 206d 6174 683a 3a0d        .. math::.
-00000990: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-000009a0: 2020 2020 2020 205c 6265 6769 6e7b 626d         \begin{bm
-000009b0: 6174 7269 787d 2079 275c 5c20 7827 205c  atrix} y'\\ x' \
-000009c0: 5c31 205c 656e 647b 626d 6174 7269 787d  \1 \end{bmatrix}
-000009d0: 203d 0d0a 2020 2020 2020 2020 2020 2020   =..            
-000009e0: 5c62 6567 696e 7b62 6d61 7472 6978 7d20  \begin{bmatrix} 
-000009f0: 415f 7b30 307d 2026 2041 5f7b 3031 7d20  A_{00} & A_{01} 
-00000a00: 2620 415f 7b30 327d 205c 5c0d 0a20 2020  & A_{02} \\..   
-00000a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000a20: 2020 2020 2020 2020 2041 5f7b 3130 7d20           A_{10} 
-00000a30: 2620 415f 7b31 317d 2026 2041 5f7b 3132  & A_{11} & A_{12
-00000a40: 7d20 5c5c 0d0a 2020 2020 2020 2020 2020  } \\..          
+00000150: 2050 726f 7041 7272 6179 0d0a 6672 6f6d   PropArray..from
+00000160: 202e 7469 6c65 6420 696d 706f 7274 2054   .tiled import T
+00000170: 696c 6564 4163 6365 7373 6f72 0d0a 0d0a  iledAccessor....
+00000180: 6672 6f6d 202e 5f75 7469 6c73 2e5f 736b  from ._utils._sk
+00000190: 696d 6167 6520 696d 706f 7274 2073 6b65  image import ske
+000001a0: 7870 2c20 736b 6665 6174 2c20 736b 6669  xp, skfeat, skfi
+000001b0: 6c2c 2073 6b69 6d61 6765 2c20 736b 6d65  l, skimage, skme
+000001c0: 732c 2073 6b72 6573 2c20 736b 7365 672c  s, skres, skseg,
+000001d0: 2073 6b74 7261 6e73 0d0a 6672 6f6d 202e   sktrans..from .
+000001e0: 5f75 7469 6c73 2069 6d70 6f72 7420 5f66  _utils import _f
+000001f0: 696c 7465 7273 2c20 5f6c 696e 616c 672c  ilters, _linalg,
+00000200: 205f 6465 636f 6e76 2c20 5f6d 6973 632c   _deconv, _misc,
+00000210: 205f 676c 636d 2c20 5f64 6f63 732c 205f   _glcm, _docs, _
+00000220: 7472 616e 7366 6f72 6d2c 205f 7374 7275  transform, _stru
+00000230: 6374 7572 6573 2c20 5f63 6f72 720d 0a0d  ctures, _corr...
+00000240: 0a66 726f 6d20 696d 7079 2e75 7469 6c73  .from impy.utils
+00000250: 2e61 7865 736f 7020 696d 706f 7274 2061  .axesop import a
+00000260: 6464 5f61 7865 732c 2073 7769 7463 685f  dd_axes, switch_
+00000270: 736c 6963 652c 2063 6f6d 706c 656d 656e  slice, complemen
+00000280: 745f 6178 6573 2c20 6669 6e64 5f66 6972  t_axes, find_fir
+00000290: 7374 5f61 7070 6561 7265 640d 0a66 726f  st_appeared..fro
+000002a0: 6d20 696d 7079 2e75 7469 6c73 2e64 6563  m impy.utils.dec
+000002b0: 6f20 696d 706f 7274 2063 6865 636b 5f69  o import check_i
+000002c0: 6e70 7574 5f61 6e64 5f6f 7574 7075 742c  nput_and_output,
+000002d0: 2064 696d 735f 746f 5f73 7061 7469 616c   dims_to_spatial
+000002e0: 5f61 7865 732c 2073 616d 655f 6474 7970  _axes, same_dtyp
+000002f0: 650d 0a66 726f 6d20 696d 7079 2e75 7469  e..from impy.uti
+00000300: 6c73 2e67 6175 7373 2069 6d70 6f72 7420  ls.gauss import 
+00000310: 4761 7573 7369 616e 4261 636b 6772 6f75  GaussianBackgrou
+00000320: 6e64 2c20 4761 7573 7369 616e 5061 7274  nd, GaussianPart
+00000330: 6963 6c65 0d0a 6672 6f6d 2069 6d70 792e  icle..from impy.
+00000340: 7574 696c 732e 6d69 7363 2069 6d70 6f72  utils.misc impor
+00000350: 7420 6368 6563 6b5f 6e64 2c20 6c61 7267  t check_nd, larg
+00000360: 6573 745f 7a65 726f 730d 0a66 726f 6d20  est_zeros..from 
+00000370: 696d 7079 2e75 7469 6c73 2e73 6c69 6365  impy.utils.slice
+00000380: 7220 696d 706f 7274 2073 6f6c 7665 5f73  r import solve_s
+00000390: 6c69 6365 720d 0a0d 0a66 726f 6d20 696d  licer....from im
+000003a0: 7079 2e63 6f6c 6c65 6374 696f 6e73 2069  py.collections i
+000003b0: 6d70 6f72 7420 4461 7461 4469 6374 0d0a  mport DataDict..
+000003c0: 6672 6f6d 2069 6d70 792e 6178 6573 2069  from impy.axes i
+000003d0: 6d70 6f72 7420 4178 6973 4c69 6b65 2c20  mport AxisLike, 
+000003e0: 736c 6963 6572 2c20 4178 6573 2c20 4178  slicer, Axes, Ax
+000003f0: 6973 0d0a 6672 6f6d 2069 6d70 792e 5f74  is..from impy._t
+00000400: 7970 6573 2069 6d70 6f72 7420 6e44 496e  ypes import nDIn
+00000410: 742c 206e 4446 6c6f 6174 2c20 4469 6d73  t, nDFloat, Dims
+00000420: 2c20 436f 6f72 6473 2c20 4178 6573 5461  , Coords, AxesTa
+00000430: 7267 6574 6564 536c 6963 6572 2c20 5061  rgetedSlicer, Pa
+00000440: 6464 696e 674d 6f64 650d 0a66 726f 6d20  ddingMode..from 
+00000450: 696d 7079 2e5f 636f 6e73 7420 696d 706f  impy._const impo
+00000460: 7274 2043 6f6e 7374 0d0a 6672 6f6d 2069  rt Const..from i
+00000470: 6d70 792e 6172 7261 795f 6170 6920 696d  mpy.array_api im
+00000480: 706f 7274 2078 702c 2063 7570 795f 6469  port xp, cupy_di
+00000490: 7370 6174 6368 6572 0d0a 0d0a 6966 2054  spatcher....if T
+000004a0: 5950 455f 4348 4543 4b49 4e47 3a0d 0a20  YPE_CHECKING:.. 
+000004b0: 2020 2066 726f 6d20 2e2e 6672 616d 6520     from ..frame 
+000004c0: 696d 706f 7274 204d 6172 6b65 7246 7261  import MarkerFra
+000004d0: 6d65 0d0a 2020 2020 6672 6f6d 2074 7970  me..    from typ
+000004e0: 696e 6720 696d 706f 7274 204c 6974 6572  ing import Liter
+000004f0: 616c 0d0a 2020 2020 5468 7265 6173 686f  al..    Threasho
+00000500: 6c64 4d65 7468 6f64 203d 204c 6974 6572  ldMethod = Liter
+00000510: 616c 5b0d 0a20 2020 2020 2020 2022 6973  al[..        "is
+00000520: 6f64 6174 6122 2c20 226c 6922 2c20 226c  odata", "li", "l
+00000530: 6f63 616c 222c 2022 6d65 616e 222c 2022  ocal", "mean", "
+00000540: 6d69 6e22 2c20 226d 696e 696d 756d 222c  min", "minimum",
+00000550: 2022 6e69 626c 6163 6b22 2c20 226f 7473   "niblack", "ots
+00000560: 7522 2c20 2273 6175 766f 6c61 222c 0d0a  u", "sauvola",..
+00000570: 2020 2020 2020 2020 2274 7269 616e 676c          "triangl
+00000580: 6522 2c20 2279 656e 220d 0a20 2020 205d  e", "yen"..    ]
+00000590: 0d0a 2020 2020 4666 7453 6861 7065 203d  ..    FftShape =
+000005a0: 204c 6974 6572 616c 5b22 7361 6d65 222c   Literal["same",
+000005b0: 2022 7371 7561 7265 225d 0d0a 0d0a 636c   "square"]....cl
+000005c0: 6173 7320 496d 6741 7272 6179 284c 6162  ass ImgArray(Lab
+000005d0: 656c 6564 4172 7261 7929 3a0d 0a20 2020  eledArray):..   
+000005e0: 2022 2222 0d0a 2020 2020 416e 206e 2d44   """..    An n-D
+000005f0: 2061 7272 6179 2066 6f72 2069 6d61 6765   array for image
+00000600: 2061 6e61 6c79 7369 732e 0d0a 2020 2020   analysis...    
+00000610: 0d0a 2020 2020 4174 7472 6962 7574 6573  ..    Attributes
+00000620: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
+00000630: 0d0a 2020 2020 6178 6573 203a 2073 7472  ..    axes : str
+00000640: 0d0a 2020 2020 2020 2020 496d 6167 6520  ..        Image 
+00000650: 6178 6573 2c20 7375 6368 2061 7320 227a  axes, such as "z
+00000660: 7978 2220 6f72 2022 7463 7978 222e 0d0a  yx" or "tcyx"...
+00000670: 2020 2020 7363 616c 6520 3a20 5363 616c      scale : Scal
+00000680: 6544 6963 740d 0a20 2020 2020 2020 2050  eDict..        P
+00000690: 6879 7369 6361 6c20 7363 616c 6520 616c  hysical scale al
+000006a0: 6f6e 6720 6561 6368 2061 7869 732e 2046  ong each axis. F
+000006b0: 6f72 2069 6e73 7461 6e63 652c 2073 6361  or instance, sca
+000006c0: 6c65 206f 6620 782d 6178 6973 2063 616e  le of x-axis can
+000006d0: 2062 6520 7265 6665 7272 6564 200d 0a20   be referred .. 
+000006e0: 2020 2020 2020 2074 6f20 6279 2060 6069         to by ``i
+000006f0: 6d67 2e73 6361 6c65 5b22 7822 5d60 6020  mg.scale["x"]`` 
+00000700: 6f72 2060 6069 6d67 2e73 6361 6c65 2e78  or ``img.scale.x
+00000710: 0d0a 2020 2020 6d65 7461 6461 7461 203a  ..    metadata :
+00000720: 2064 6963 740d 0a20 2020 2020 2020 204d   dict..        M
+00000730: 6574 6164 6174 6120 7461 6767 6564 2074  etadata tagged t
+00000740: 6f20 7468 6520 696d 6167 652e 0d0a 2020  o the image...  
+00000750: 2020 736f 7572 6365 203a 2050 6174 680d    source : Path.
+00000760: 0a20 2020 2020 2020 2053 6f75 7263 6520  .        Source 
+00000770: 6669 6c65 206f 6620 7468 6520 696d 6167  file of the imag
+00000780: 652e 0d0a 2020 2020 2222 220d 0a20 2020  e...    """..   
+00000790: 2074 696c 6564 203d 2054 696c 6564 4163   tiled = TiledAc
+000007a0: 6365 7373 6f72 2829 0d0a 0d0a 2020 2020  cessor()....    
+000007b0: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+000007c0: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+000007d0: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+000007e0: 2020 4073 616d 655f 6474 7970 6528 6173    @same_dtype(as
+000007f0: 666c 6f61 743d 5472 7565 290d 0a20 2020  float=True)..   
+00000800: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
+00000810: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
+00000820: 6620 6166 6669 6e65 280d 0a20 2020 2020  f affine(..     
+00000830: 2020 2073 656c 662c 206d 6174 7269 783d     self, matrix=
+00000840: 4e6f 6e65 2c20 2a2c 2073 6361 6c65 3d4e  None, *, scale=N
+00000850: 6f6e 652c 2072 6f74 6174 696f 6e3d 4e6f  one, rotation=No
+00000860: 6e65 2c20 7368 6561 723d 4e6f 6e65 2c20  ne, shear=None, 
+00000870: 7472 616e 736c 6174 696f 6e3d 4e6f 6e65  translation=None
+00000880: 2c0d 0a20 2020 2020 2020 206f 7264 6572  ,..        order
+00000890: 3a20 696e 7420 3d20 312c 206d 6f64 653a  : int = 1, mode:
+000008a0: 2050 6164 6469 6e67 4d6f 6465 203d 2022   PaddingMode = "
+000008b0: 636f 6e73 7461 6e74 222c 2063 7661 6c3a  constant", cval:
+000008c0: 2066 6c6f 6174 203d 2030 2c20 6f75 7470   float = 0, outp
+000008d0: 7574 5f73 6861 7065 203d 204e 6f6e 652c  ut_shape = None,
+000008e0: 0d0a 2020 2020 2020 2020 7072 6566 696c  ..        prefil
+000008f0: 7465 723a 2062 6f6f 6c20 7c20 4e6f 6e65  ter: bool | None
+00000900: 203d 204e 6f6e 652c 2064 696d 733a 2044   = None, dims: D
+00000910: 696d 7320 3d20 4e6f 6e65 2c20 7570 6461  ims = None, upda
+00000920: 7465 3a20 626f 6f6c 203d 2046 616c 7365  te: bool = False
+00000930: 2c0d 0a20 2020 2029 202d 3e20 496d 6741  ,..    ) -> ImgA
+00000940: 7272 6179 3a0d 0a20 2020 2020 2020 2072  rray:..        r
+00000950: 2222 220d 0a20 2020 2020 2020 2043 6f6e  """..        Con
+00000960: 7665 7274 2069 6d61 6765 2062 7920 4166  vert image by Af
+00000970: 6669 6e65 2074 7261 6e73 666f 726d 6174  fine transformat
+00000980: 696f 6e2e 2032 4420 4166 6669 6e65 2074  ion. 2D Affine t
+00000990: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
+000009a0: 2077 7269 7474 656e 2061 733a 0d0a 2020   written as:..  
+000009b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000009c0: 2e2e 206d 6174 683a 3a0d 0a20 2020 2020  .. math::..     
+000009d0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+000009e0: 205c 6265 6769 6e7b 626d 6174 7269 787d   \begin{bmatrix}
+000009f0: 2079 275c 5c20 7827 205c 5c31 205c 656e   y'\\ x' \\1 \en
+00000a00: 647b 626d 6174 7269 787d 203d 0d0a 2020  d{bmatrix} =..  
+00000a10: 2020 2020 2020 2020 2020 5c62 6567 696e            \begin
+00000a20: 7b62 6d61 7472 6978 7d20 415f 7b30 307d  {bmatrix} A_{00}
+00000a30: 2026 2041 5f7b 3031 7d20 2620 415f 7b30   & A_{01} & A_{0
+00000a40: 327d 205c 5c0d 0a20 2020 2020 2020 2020  2} \\..         
 00000a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000a60: 2020 2020 2020 3020 2620 2020 2020 2030        0 &      0
-00000a70: 2026 2020 2020 2020 3120 205c 656e 647b   &      1  \end{
-00000a80: 626d 6174 7269 787d 0d0a 2020 2020 2020  bmatrix}..      
+00000a60: 2020 2041 5f7b 3130 7d20 2620 415f 7b31     A_{10} & A_{1
+00000a70: 317d 2026 2041 5f7b 3132 7d20 5c5c 0d0a  1} & A_{12} \\..
+00000a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00000a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000aa0: 2020 2020 2020 5c62 6567 696e 7b62 6d61        \begin{bma
-00000ab0: 7472 6978 7d20 7920 5c5c 785c 5c20 3120  trix} y \\x\\ 1 
-00000ac0: 5c65 6e64 7b62 6d61 7472 6978 7d0d 0a20  \end{bmatrix}.. 
-00000ad0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00000ae0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00000af0: 616e 6420 7369 6d69 6c61 726c 792c 206e  and similarly, n
-00000b00: 2d44 2041 6666 696e 6520 7472 616e 7366  -D Affine transf
-00000b10: 6f72 6d61 7469 6f6e 2063 616e 2062 6520  ormation can be 
-00000b20: 6465 7363 7269 6265 6420 6173 2028 6e2b  described as (n+
-00000b30: 3129 2d44 206d 6174 7269 782e 0d0a 0d0a  1)-D matrix.....
-00000b40: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00000b50: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-00000b60: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00000b70: 6d61 7472 6978 2c20 7363 616c 652c 2072  matrix, scale, r
-00000b80: 6f74 6174 696f 6e2c 2073 6865 6172 2c20  otation, shear, 
-00000b90: 7472 616e 736c 6174 696f 6e0d 0a20 2020  translation..   
-00000ba0: 2020 2020 2020 2020 2041 6666 696e 6520           Affine 
-00000bb0: 7472 616e 7366 6f72 6d61 7469 6f6e 2070  transformation p
-00000bc0: 6172 616d 6574 6572 732e 2053 6565 2060  arameters. See `
-00000bd0: 6073 6b69 6d61 6765 2e74 7261 6e73 666f  `skimage.transfo
-00000be0: 726d 2e41 6666 696e 6554 7261 6e73 666f  rm.AffineTransfo
-00000bf0: 726d 6060 2066 6f72 2064 6574 6169 6c73  rm`` for details
-00000c00: 2e0d 0a20 2020 2020 2020 207b 6f72 6465  ...        {orde
-00000c10: 727d 7b6d 6f64 657d 7b63 7661 6c7d 0d0a  r}{mode}{cval}..
-00000c20: 2020 2020 2020 2020 6f75 7470 7574 5f73          output_s
-00000c30: 6861 7065 203a 2074 7570 6c65 206f 6620  hape : tuple of 
-00000c40: 696e 742c 206f 7074 696f 6e61 6c0d 0a20  int, optional.. 
-00000c50: 2020 2020 2020 2020 2020 2053 6861 7065             Shape
-00000c60: 206f 6620 6f75 7470 7574 2061 7272 6179   of output array
-00000c70: 2e0d 0a20 2020 2020 2020 207b 6469 6d73  ...        {dims
-00000c80: 7d7b 7570 6461 7465 7d0d 0a0d 0a20 2020  }{update}....   
-00000c90: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-00000ca0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-00000cb0: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
-00000cc0: 0a20 2020 2020 2020 2020 2020 2054 7261  .            Tra
-00000cd0: 6e73 666f 726d 6564 2069 6d61 6765 2e0d  nsformed image..
-00000ce0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00000cf0: 2020 2020 2020 6966 2075 7064 6174 6520        if update 
-00000d00: 616e 6420 6f75 7470 7574 5f73 6861 7065  and output_shape
-00000d10: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00000d20: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00000d30: 2056 616c 7565 4572 726f 7228 2243 616e   ValueError("Can
-00000d40: 6e6f 7420 7570 6461 7465 2069 6d61 6765  not update image
-00000d50: 2077 6865 6e20 6f75 7470 7574 5f73 6861   when output_sha
-00000d60: 7065 2069 7320 7072 6f76 6964 6564 2e22  pe is provided."
-00000d70: 290d 0a20 2020 2020 2020 2069 6620 6973  )..        if is
-00000d80: 696e 7374 616e 6365 2863 7661 6c2c 2073  instance(cval, s
-00000d90: 7472 2920 616e 6420 6861 7361 7474 7228  tr) and hasattr(
-00000da0: 6e70 2c20 6376 616c 293a 0d0a 2020 2020  np, cval):..    
-00000db0: 2020 2020 2020 2020 6376 616c 203d 2067          cval = g
-00000dc0: 6574 6174 7472 286e 702c 2063 7661 6c29  etattr(np, cval)
-00000dd0: 2873 656c 662e 7661 6c75 6529 0d0a 2020  (self.value)..  
-00000de0: 2020 2020 2020 656c 6966 2063 616c 6c61        elif calla
-00000df0: 626c 6528 6376 616c 293a 0d0a 2020 2020  ble(cval):..    
-00000e00: 2020 2020 2020 2020 6376 616c 203d 2063          cval = c
-00000e10: 7661 6c28 7365 6c66 2e76 616c 7565 290d  val(self.value).
-00000e20: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00000e30: 2020 2070 7265 6669 6c74 6572 203d 2070     prefilter = p
-00000e40: 7265 6669 6c74 6572 206f 7220 6f72 6465  refilter or orde
-00000e50: 7220 3e20 310d 0a20 2020 2020 2020 200d  r > 1..        .
-00000e60: 0a20 2020 2020 2020 2069 6620 7472 616e  .        if tran
-00000e70: 736c 6174 696f 6e20 6973 206e 6f74 204e  slation is not N
-00000e80: 6f6e 6520 616e 6420 616c 6c28 6120 6973  one and all(a is
-00000e90: 204e 6f6e 6520 666f 7220 6120 696e 205b   None for a in [
-00000ea0: 6d61 7472 6978 2c20 7363 616c 652c 2072  matrix, scale, r
-00000eb0: 6f74 6174 696f 6e2c 2073 6865 6172 5d29  otation, shear])
-00000ec0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00000ed0: 6869 6674 203d 202d 6e70 2e61 7361 7272  hift = -np.asarr
-00000ee0: 6179 2874 7261 6e73 6c61 7469 6f6e 290d  ay(translation).
-00000ef0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00000f00: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
-00000f10: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
-00000f20: 2020 2020 2020 205f 7472 616e 7366 6f72         _transfor
-00000f30: 6d2e 7368 6966 742c 0d0a 2020 2020 2020  m.shift,..      
-00000f40: 2020 2020 2020 2020 2020 635f 6178 6573            c_axes
-00000f50: 3d63 6f6d 706c 656d 656e 745f 6178 6573  =complement_axes
-00000f60: 2864 696d 732c 2073 656c 662e 6178 6573  (dims, self.axes
-00000f70: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00000f80: 2020 2020 6b77 6172 6773 3d64 6963 7428      kwargs=dict(
-00000f90: 7368 6966 743d 7368 6966 742c 206f 7264  shift=shift, ord
-00000fa0: 6572 3d6f 7264 6572 2c20 6d6f 6465 3d6d  er=order, mode=m
-00000fb0: 6f64 652c 2063 7661 6c3d 6376 616c 2c20  ode, cval=cval, 
-00000fc0: 7072 6566 696c 7465 723d 7072 6566 696c  prefilter=prefil
-00000fd0: 7465 7229 0d0a 2020 2020 2020 2020 2020  ter)..          
-00000fe0: 2020 290d 0a20 2020 2020 2020 2069 6620    )..        if 
-00000ff0: 6d61 7472 6978 2069 7320 4e6f 6e65 3a0d  matrix is None:.
-00001000: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-00001010: 7269 7820 3d20 5f74 7261 6e73 666f 726d  rix = _transform
-00001020: 2e63 6f6d 706f 7365 5f61 6666 696e 655f  .compose_affine_
-00001030: 6d61 7472 6978 280d 0a20 2020 2020 2020  matrix(..       
-00001040: 2020 2020 2020 2020 2073 6361 6c65 3d73           scale=s
-00001050: 6361 6c65 2c20 726f 7461 7469 6f6e 3d72  cale, rotation=r
-00001060: 6f74 6174 696f 6e2c 2073 6865 6172 3d73  otation, shear=s
-00001070: 6865 6172 2c20 7472 616e 736c 6174 696f  hear, translatio
-00001080: 6e3d 7472 616e 736c 6174 696f 6e2c 0d0a  n=translation,..
-00001090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000010a0: 6e64 696d 3d6c 656e 2864 696d 7329 0d0a  ndim=len(dims)..
-000010b0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-000010c0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000010d0: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
-000010e0: 0a20 2020 2020 2020 2020 2020 205f 7472  .            _tr
-000010f0: 616e 7366 6f72 6d2e 7761 7270 2c0d 0a20  ansform.warp,.. 
-00001100: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
-00001110: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
-00001120: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
-00001130: 7329 2c0d 0a20 2020 2020 2020 2020 2020  s),..           
-00001140: 206b 7761 7267 733d 6469 6374 286d 6174   kwargs=dict(mat
-00001150: 7269 783d 6d61 7472 6978 2c20 6f72 6465  rix=matrix, orde
-00001160: 723d 6f72 6465 722c 206d 6f64 653d 6d6f  r=order, mode=mo
-00001170: 6465 2c20 6376 616c 3d63 7661 6c2c 0d0a  de, cval=cval,..
-00001180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001190: 2020 2020 2020 2020 6f75 7470 7574 5f73          output_s
-000011a0: 6861 7065 3d6f 7574 7075 745f 7368 6170  hape=output_shap
-000011b0: 652c 2070 7265 6669 6c74 6572 3d70 7265  e, prefilter=pre
-000011c0: 6669 6c74 6572 290d 0a20 2020 2020 2020  filter)..       
-000011d0: 2029 0d0a 2020 2020 0d0a 2020 2020 405f   )..    ..    @_
-000011e0: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-000011f0: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-00001200: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-00001210: 4073 616d 655f 6474 7970 6528 6173 666c  @same_dtype(asfl
-00001220: 6f61 743d 5472 7565 290d 0a20 2020 2040  oat=True)..    @
-00001230: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
-00001240: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
-00001250: 726f 7461 7465 280d 0a20 2020 2020 2020  rotate(..       
-00001260: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
-00001270: 6465 6772 6565 3a20 666c 6f61 742c 0d0a  degree: float,..
-00001280: 2020 2020 2020 2020 6365 6e74 6572 3a20          center: 
-00001290: 5365 7175 656e 6365 5b66 6c6f 6174 5d20  Sequence[float] 
-000012a0: 7c20 4c69 7465 7261 6c5b 2263 656e 7465  | Literal["cente
-000012b0: 7222 5d20 3d20 2263 656e 7465 7222 2c0d  r"] = "center",.
-000012c0: 0a20 2020 2020 2020 202a 2c0d 0a20 2020  .        *,..   
-000012d0: 2020 2020 206f 7264 6572 3a20 696e 7420       order: int 
-000012e0: 3d20 332c 0d0a 2020 2020 2020 2020 6d6f  = 3,..        mo
-000012f0: 6465 3a20 5061 6464 696e 674d 6f64 6520  de: PaddingMode 
-00001300: 3d20 2263 6f6e 7374 616e 7422 2c0d 0a20  = "constant",.. 
-00001310: 2020 2020 2020 2063 7661 6c3a 2066 6c6f         cval: flo
-00001320: 6174 203d 2030 2c0d 0a20 2020 2020 2020  at = 0,..       
-00001330: 2064 696d 733a 2044 696d 7320 3d20 322c   dims: Dims = 2,
-00001340: 0d0a 2020 2020 2020 2020 7570 6461 7465  ..        update
-00001350: 3a20 626f 6f6c 203d 2046 616c 7365 0d0a  : bool = False..
-00001360: 2020 2020 2920 2d3e 2049 6d67 4172 7261      ) -> ImgArra
-00001370: 793a 0d0a 2020 2020 2020 2020 2222 220d  y:..        """.
-00001380: 0a20 2020 2020 2020 2032 4420 726f 7461  .        2D rota
-00001390: 7469 6f6e 206f 6620 616e 2069 6d61 6765  tion of an image
-000013a0: 2061 726f 756e 6420 6120 706f 696e 742e   around a point.
-000013b0: 204f 7574 7369 6465 2077 696c 6c20 6265   Outside will be
-000013c0: 2070 6164 6465 6420 7769 7468 207a 6572   padded with zer
-000013d0: 6f2e 2046 6f72 206e 2d44 2069 6d61 6765  o. For n-D image
-000013e0: 732c 0d0a 2020 2020 2020 2020 7468 6973  s,..        this
-000013f0: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
-00001400: 6973 2066 6173 7465 7220 7468 616e 2060  is faster than `
-00001410: 6073 6369 7079 2e6e 6469 6d61 6765 2e72  `scipy.ndimage.r
-00001420: 6f74 6174 6560 602e 0d0a 0d0a 2020 2020  otate``.....    
-00001430: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-00001440: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00001450: 2d2d 0d0a 2020 2020 2020 2020 6465 6772  --..        degr
-00001460: 6565 203a 2066 6c6f 6174 0d0a 2020 2020  ee : float..    
-00001470: 2020 2020 2020 2020 436c 6f63 6b77 6973          Clockwis
-00001480: 6520 6465 6772 6565 206f 6620 726f 7461  e degree of rota
-00001490: 7469 6f6e 2e20 4e6f 7420 7261 6469 616e  tion. Not radian
-000014a0: 2e0d 0a20 2020 2020 2020 2063 656e 7465  ...        cente
-000014b0: 7220 3a20 7374 7220 6f72 2061 7272 6179  r : str or array
-000014c0: 2d6c 696b 652c 206f 7074 696f 6e61 6c0d  -like, optional.
-000014d0: 0a20 2020 2020 2020 2020 2020 2052 6f74  .            Rot
-000014e0: 6174 696f 6e20 6365 6e74 6572 2063 6f6f  ation center coo
-000014f0: 7264 696e 6174 652e 2042 7920 6465 6661  rdinate. By defa
-00001500: 756c 7420 7468 6520 6365 6e74 6572 206f  ult the center o
-00001510: 6620 696d 6167 6520 7769 6c6c 2062 6520  f image will be 
-00001520: 7468 6520 726f 7461 7469 6f6e 2063 656e  the rotation cen
-00001530: 7465 722e 0d0a 2020 2020 2020 2020 7b6f  ter...        {o
-00001540: 7264 6572 7d7b 6d6f 6465 7d7b 6376 616c  rder}{mode}{cval
-00001550: 7d7b 6469 6d73 7d7b 7570 6461 7465 7d0d  }{dims}{update}.
-00001560: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00001570: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
-00001580: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
-00001590: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
-000015a0: 2020 2052 6f74 6174 6564 2069 6d61 6765     Rotated image
-000015b0: 2e0d 0a20 2020 2020 2020 2022 2222 2020  ...        """  
-000015c0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000015d0: 6966 2063 656e 7465 7220 3d3d 2022 6365  if center == "ce
-000015e0: 6e74 6572 223a 0d0a 2020 2020 2020 2020  nter":..        
-000015f0: 2020 2020 6365 6e74 6572 203d 206e 702e      center = np.
-00001600: 6172 7261 7928 7365 6c66 2e73 697a 6573  array(self.sizes
-00001610: 6f66 2864 696d 7329 292f 322e 202d 2030  of(dims))/2. - 0
-00001620: 2e35 0d0a 2020 2020 2020 2020 656c 7365  .5..        else
-00001630: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-00001640: 656e 7465 7220 3d20 6e70 2e61 7361 7272  enter = np.asarr
-00001650: 6179 2863 656e 7465 7229 0d0a 2020 2020  ay(center)..    
-00001660: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00001670: 2020 7472 616e 736c 6174 696f 6e5f 3020    translation_0 
-00001680: 3d20 5f74 7261 6e73 666f 726d 2e63 6f6d  = _transform.com
-00001690: 706f 7365 5f61 6666 696e 655f 6d61 7472  pose_affine_matr
-000016a0: 6978 2874 7261 6e73 6c61 7469 6f6e 3d63  ix(translation=c
-000016b0: 656e 7465 7229 0d0a 2020 2020 2020 2020  enter)..        
-000016c0: 726f 7461 7469 6f6e 203d 205f 7472 616e  rotation = _tran
-000016d0: 7366 6f72 6d2e 636f 6d70 6f73 655f 6166  sform.compose_af
-000016e0: 6669 6e65 5f6d 6174 7269 7828 726f 7461  fine_matrix(rota
-000016f0: 7469 6f6e 3d6e 702e 6465 6732 7261 6428  tion=np.deg2rad(
-00001700: 6465 6772 6565 2929 0d0a 2020 2020 2020  degree))..      
-00001710: 2020 7472 616e 736c 6174 696f 6e5f 3120    translation_1 
-00001720: 3d20 5f74 7261 6e73 666f 726d 2e63 6f6d  = _transform.com
-00001730: 706f 7365 5f61 6666 696e 655f 6d61 7472  pose_affine_matr
-00001740: 6978 2874 7261 6e73 6c61 7469 6f6e 3d2d  ix(translation=-
-00001750: 6365 6e74 6572 290d 0a20 2020 2020 2020  center)..       
-00001760: 200d 0a20 2020 2020 2020 206d 7820 3d20   ..        mx = 
-00001770: 7472 616e 736c 6174 696f 6e5f 3020 4020  translation_0 @ 
-00001780: 726f 7461 7469 6f6e 2040 2074 7261 6e73  rotation @ trans
-00001790: 6c61 7469 6f6e 5f31 0d0a 2020 2020 2020  lation_1..      
-000017a0: 2020 6d78 5b2d 312c 203a 5d20 3d20 5b30    mx[-1, :] = [0
-000017b0: 5d20 2a20 6c65 6e28 6469 6d73 2920 2b20  ] * len(dims) + 
-000017c0: 5b31 5d0d 0a20 2020 2020 2020 2072 6574  [1]..        ret
-000017d0: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
-000017e0: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
-000017f0: 2020 205f 7472 616e 7366 6f72 6d2e 7761     _transform.wa
-00001800: 7270 2c0d 0a20 2020 2020 2020 2020 2020  rp,..           
-00001810: 2063 5f61 7865 733d 636f 6d70 6c65 6d65   c_axes=compleme
-00001820: 6e74 5f61 7865 7328 6469 6d73 2c20 7365  nt_axes(dims, se
-00001830: 6c66 2e61 7865 7329 2c0d 0a20 2020 2020  lf.axes),..     
-00001840: 2020 2020 2020 206b 7761 7267 733d 6469         kwargs=di
-00001850: 6374 286d 6174 7269 783d 6d78 2c20 6f72  ct(matrix=mx, or
-00001860: 6465 723d 6f72 6465 722c 206d 6f64 653d  der=order, mode=
-00001870: 6d6f 6465 2c20 6376 616c 3d63 7661 6c29  mode, cval=cval)
-00001880: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
-00001890: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
-000018a0: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
-000018b0: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
-000018c0: 6178 6573 0d0a 2020 2020 4073 616d 655f  axes..    @same_
-000018d0: 6474 7970 6528 6173 666c 6f61 743d 5472  dtype(asfloat=Tr
-000018e0: 7565 290d 0a20 2020 2040 6368 6563 6b5f  ue)..    @check_
-000018f0: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
-00001900: 0d0a 2020 2020 6465 6620 7374 7265 7463  ..    def stretc
-00001910: 6828 0d0a 2020 2020 2020 2020 7365 6c66  h(..        self
-00001920: 2c0d 0a20 2020 2020 2020 2073 6361 6c65  ,..        scale
-00001930: 3a20 6e44 466c 6f61 742c 0d0a 2020 2020  : nDFloat,..    
-00001940: 2020 2020 6365 6e74 6572 3a20 5365 7175      center: Sequ
-00001950: 656e 6365 5b66 6c6f 6174 5d20 7c20 4c69  ence[float] | Li
-00001960: 7465 7261 6c5b 2263 656e 7465 7222 5d20  teral["center"] 
-00001970: 3d20 2263 656e 7465 7222 2c0d 0a20 2020  = "center",..   
-00001980: 2020 2020 202a 2c0d 0a20 2020 2020 2020       *,..       
-00001990: 206d 6f64 653a 2050 6164 6469 6e67 4d6f   mode: PaddingMo
-000019a0: 6465 203d 2022 636f 6e73 7461 6e74 222c  de = "constant",
-000019b0: 200d 0a20 2020 2020 2020 2063 7661 6c3a   ..        cval:
-000019c0: 2066 6c6f 6174 203d 2030 2c20 0d0a 2020   float = 0, ..  
-000019d0: 2020 2020 2020 6469 6d73 3a20 4469 6d73        dims: Dims
-000019e0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
-000019f0: 2020 6f72 6465 723a 2069 6e74 203d 2031    order: int = 1
-00001a00: 2c0d 0a20 2020 2029 202d 3e20 496d 6741  ,..    ) -> ImgA
-00001a10: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
-00001a20: 2222 0d0a 2020 2020 2020 2020 3244 2073  ""..        2D s
-00001a30: 7472 6574 6368 696e 6720 6f66 2061 6e20  tretching of an 
-00001a40: 696d 6167 6520 6672 6f6d 2061 2070 6f69  image from a poi
-00001a50: 6e74 2e0d 0a0d 0a20 2020 2020 2020 2050  nt.....        P
-00001a60: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-00001a70: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00001a80: 2020 2020 2020 2073 6361 6c65 3a20 6172         scale: ar
-00001a90: 7261 792d 6c69 6b65 0d0a 2020 2020 2020  ray-like..      
-00001aa0: 2020 2020 2020 5374 7265 7463 6820 6661        Stretch fa
-00001ab0: 6374 6f72 732e 0d0a 2020 2020 2020 2020  ctors...        
-00001ac0: 6365 6e74 6572 203a 2073 7472 206f 7220  center : str or 
-00001ad0: 6172 7261 792d 6c69 6b65 2c20 6f70 7469  array-like, opti
-00001ae0: 6f6e 616c 0d0a 2020 2020 2020 2020 2020  onal..          
-00001af0: 2020 526f 7461 7469 6f6e 2063 656e 7465    Rotation cente
-00001b00: 7220 636f 6f72 6469 6e61 7465 2e20 4279  r coordinate. By
-00001b10: 2064 6566 6175 6c74 2074 6865 2063 656e   default the cen
-00001b20: 7465 7220 6f66 2069 6d61 6765 2077 696c  ter of image wil
-00001b30: 6c20 6265 2074 6865 2072 6f74 6174 696f  l be the rotatio
-00001b40: 6e20 6365 6e74 6572 2e0d 0a20 2020 2020  n center...     
-00001b50: 2020 207b 6d6f 6465 7d7b 6376 616c 7d7b     {mode}{cval}{
-00001b60: 6469 6d73 7d7b 6f72 6465 727d 0d0a 0d0a  dims}{order}....
-00001b70: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
-00001b80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00001b90: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
-00001ba0: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
-00001bb0: 5374 7265 7463 6865 6420 696d 6167 652e  Stretched image.
-00001bc0: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
-00001bd0: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
-00001be0: 6620 6365 6e74 6572 203d 3d20 2263 656e  f center == "cen
-00001bf0: 7465 7222 3a0d 0a20 2020 2020 2020 2020  ter":..         
-00001c00: 2020 2063 656e 7465 7220 3d20 6e70 2e61     center = np.a
-00001c10: 7272 6179 2873 656c 662e 7369 7a65 736f  rray(self.sizeso
-00001c20: 6628 6469 6d73 2929 2f32 2e20 2d20 302e  f(dims))/2. - 0.
-00001c30: 350d 0a20 2020 2020 2020 2065 6c73 653a  5..        else:
-00001c40: 0d0a 2020 2020 2020 2020 2020 2020 6365  ..            ce
-00001c50: 6e74 6572 203d 206e 702e 6173 6172 7261  nter = np.asarra
-00001c60: 7928 6365 6e74 6572 290d 0a20 2020 2020  y(center)..     
-00001c70: 2020 200d 0a20 2020 2020 2020 2073 6361     ..        sca
-00001c80: 6c65 203d 2063 6865 636b 5f6e 6428 7363  le = check_nd(sc
-00001c90: 616c 652c 206c 656e 2864 696d 7329 290d  ale, len(dims)).
-00001ca0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00001cb0: 2020 2074 7261 6e73 6c61 7469 6f6e 5f30     translation_0
-00001cc0: 203d 205f 7472 616e 7366 6f72 6d2e 636f   = _transform.co
-00001cd0: 6d70 6f73 655f 6166 6669 6e65 5f6d 6174  mpose_affine_mat
-00001ce0: 7269 7828 7472 616e 736c 6174 696f 6e3d  rix(translation=
-00001cf0: 6365 6e74 6572 290d 0a20 2020 2020 2020  center)..       
-00001d00: 2073 7472 6574 6368 203d 205f 7472 616e   stretch = _tran
-00001d10: 7366 6f72 6d2e 636f 6d70 6f73 655f 6166  sform.compose_af
-00001d20: 6669 6e65 5f6d 6174 7269 7828 7363 616c  fine_matrix(scal
-00001d30: 653d 312f 6e70 2e61 7361 7272 6179 2873  e=1/np.asarray(s
-00001d40: 6361 6c65 2929 0d0a 2020 2020 2020 2020  cale))..        
-00001d50: 7472 616e 736c 6174 696f 6e5f 3120 3d20  translation_1 = 
-00001d60: 5f74 7261 6e73 666f 726d 2e63 6f6d 706f  _transform.compo
-00001d70: 7365 5f61 6666 696e 655f 6d61 7472 6978  se_affine_matrix
-00001d80: 2874 7261 6e73 6c61 7469 6f6e 3d2d 6365  (translation=-ce
-00001d90: 6e74 6572 290d 0a20 2020 2020 2020 200d  nter)..        .
-00001da0: 0a20 2020 2020 2020 206d 7820 3d20 7472  .        mx = tr
-00001db0: 616e 736c 6174 696f 6e5f 3020 4020 7374  anslation_0 @ st
-00001dc0: 7265 7463 6820 4020 7472 616e 736c 6174  retch @ translat
-00001dd0: 696f 6e5f 310d 0a20 2020 2020 2020 206d  ion_1..        m
-00001de0: 785b 2d31 2c20 3a5d 203d 205b 305d 202a  x[-1, :] = [0] *
-00001df0: 206c 656e 2864 696d 7329 202b 205b 315d   len(dims) + [1]
-00001e00: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00001e10: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00001e20: 5f61 7070 6c79 5f64 6173 6b28 0d0a 2020  _apply_dask(..  
-00001e30: 2020 2020 2020 2020 2020 5f74 7261 6e73            _trans
-00001e40: 666f 726d 2e77 6172 702c 0d0a 2020 2020  form.warp,..    
-00001e50: 2020 2020 2020 2020 635f 6178 6573 3d63          c_axes=c
-00001e60: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
-00001e70: 696d 732c 2073 656c 662e 6178 6573 292c  ims, self.axes),
-00001e80: 0d0a 2020 2020 2020 2020 2020 2020 6b77  ..            kw
-00001e90: 6172 6773 3d64 6963 7428 6d61 7472 6978  args=dict(matrix
-00001ea0: 3d6d 782c 206f 7264 6572 3d6f 7264 6572  =mx, order=order
-00001eb0: 2c20 6d6f 6465 3d6d 6f64 652c 2063 7661  , mode=mode, cva
-00001ec0: 6c3d 6376 616c 292c 0d0a 2020 2020 2020  l=cval),..      
-00001ed0: 2020 290d 0a0d 0a20 2020 2040 5f64 6f63    )....    @_doc
-00001ee0: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
-00001ef0: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
-00001f00: 616c 5f61 7865 730d 0a20 2020 2040 7361  al_axes..    @sa
-00001f10: 6d65 5f64 7479 7065 2861 7366 6c6f 6174  me_dtype(asfloat
-00001f20: 3d54 7275 6529 0d0a 2020 2020 6465 6620  =True)..    def 
-00001f30: 7265 7363 616c 6528 0d0a 2020 2020 2020  rescale(..      
-00001f40: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-00001f50: 2073 6361 6c65 3a20 6e44 466c 6f61 7420   scale: nDFloat 
-00001f60: 3d20 312f 3136 2c0d 0a20 2020 2020 2020  = 1/16,..       
-00001f70: 202a 2c0d 0a20 2020 2020 2020 206f 7264   *,..        ord
-00001f80: 6572 3a20 696e 7420 3d20 4e6f 6e65 2c0d  er: int = None,.
-00001f90: 0a20 2020 2020 2020 206d 6f64 653a 2050  .        mode: P
-00001fa0: 6164 6469 6e67 4d6f 6465 203d 2022 7265  addingMode = "re
-00001fb0: 666c 6563 7422 2c0d 0a20 2020 2020 2020  flect",..       
-00001fc0: 2063 7661 6c3a 2066 6c6f 6174 203d 2030   cval: float = 0
-00001fd0: 2e30 2c0d 0a20 2020 2020 2020 2064 696d  .0,..        dim
-00001fe0: 733a 2044 696d 7320 3d20 4e6f 6e65 2c0d  s: Dims = None,.
-00001ff0: 0a20 2020 2029 202d 3e20 496d 6741 7272  .    ) -> ImgArr
-00002000: 6179 3a0d 0a20 2020 2020 2020 2022 2222  ay:..        """
-00002010: 0d0a 2020 2020 2020 2020 5265 7363 616c  ..        Rescal
-00002020: 6520 696d 6167 6520 6279 2061 7070 6c79  e image by apply
-00002030: 696e 6720 7468 6520 6469 6167 6f6e 616c  ing the diagonal
-00002040: 2063 6f6d 706f 6e65 6e74 206f 6620 4166   component of Af
-00002050: 6669 6e65 206d 6174 7269 782e 0d0a 0d0a  fine matrix.....
-00002060: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00002070: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-00002080: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00002090: 7363 616c 6520 3a20 666c 6f61 742c 206f  scale : float, o
-000020a0: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-000020b0: 2020 2020 2052 656c 6174 6976 6520 7363       Relative sc
-000020c0: 616c 6520 6f66 2074 6865 206e 6577 2069  ale of the new i
-000020d0: 6d61 6765 2e20 7363 616c 6520 312f 3220  mage. scale 1/2 
-000020e0: 6d65 616e 7320 7468 6174 2074 6865 2073  means that the s
-000020f0: 6861 7065 206f 660d 0a20 2020 2020 2020  hape of..       
-00002100: 2020 2020 2074 6865 206f 7574 7075 7420       the output 
-00002110: 696d 6167 6520 7769 6c6c 2062 6520 284e  image will be (N
-00002120: 2f32 2c20 2e2e 2e29 2e0d 0a20 2020 2020  /2, ...)...     
-00002130: 2020 207b 6f72 6465 727d 7b6d 6f64 657d     {order}{mode}
-00002140: 7b63 7661 6c7d 7b64 696d 737d 0d0a 2020  {cval}{dims}..  
-00002150: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00002160: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-00002170: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
-00002180: 2020 496d 6741 7272 6179 0d0a 2020 2020    ImgArray..    
-00002190: 2020 2020 2020 2020 5265 7363 616c 6564          Rescaled
-000021a0: 2069 6d61 6765 2e0d 0a20 2020 2020 2020   image...       
-000021b0: 2022 2222 0d0a 2020 2020 2020 2020 7363   """..        sc
-000021c0: 616c 655f 6973 5f73 6571 203d 2068 6173  ale_is_seq = has
-000021d0: 6174 7472 2873 6361 6c65 2c20 225f 5f69  attr(scale, "__i
-000021e0: 7465 725f 5f22 290d 0a20 2020 2020 2020  ter__")..       
-000021f0: 200d 0a20 2020 2020 2020 2023 2043 6865   ..        # Che
-00002200: 636b 2069 6620 6f75 7470 7574 2069 7320  ck if output is 
-00002210: 746f 6f20 6c61 7267 652e 0d0a 2020 2020  too large...    
-00002220: 2020 2020 6762 203d 202d 310d 0a20 2020      gb = -1..   
-00002230: 2020 2020 2069 6620 6e6f 7420 7363 616c       if not scal
-00002240: 655f 6973 5f73 6571 2061 6e64 2073 6361  e_is_seq and sca
-00002250: 6c65 203e 2031 3a0d 0a20 2020 2020 2020  le > 1:..       
-00002260: 2020 2020 2067 6220 3d20 6e70 2e70 726f       gb = np.pro
-00002270: 6428 7365 6c66 2e73 6861 7065 2920 2a20  d(self.shape) * 
-00002280: 2873 6361 6c65 202a 2a20 6c65 6e28 6469  (scale ** len(di
-00002290: 6d73 2929 202f 2031 6539 0d0a 2020 2020  ms)) / 1e9..    
-000022a0: 2020 2020 656c 6966 2073 6361 6c65 5f69      elif scale_i
-000022b0: 735f 7365 7120 616e 6420 6e70 2e70 726f  s_seq and np.pro
-000022c0: 6428 6c69 7374 2873 6361 6c65 2929 203e  d(list(scale)) >
-000022d0: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-000022e0: 2067 6220 3d20 6e70 2e70 726f 6428 7365   gb = np.prod(se
-000022f0: 6c66 2e73 6861 7065 2920 2a20 6e70 2e70  lf.shape) * np.p
-00002300: 726f 6428 6c69 7374 2873 6361 6c65 2929  rod(list(scale))
-00002310: 202f 2031 6539 0d0a 2020 2020 2020 2020   / 1e9..        
-00002320: 6966 2067 6220 3e20 436f 6e73 745b 224d  if gb > Const["M
-00002330: 4158 5f47 4222 5d3a 0d0a 2020 2020 2020  AX_GB"]:..      
-00002340: 2020 2020 2020 7261 6973 6520 4d65 6d6f        raise Memo
-00002350: 7279 4572 726f 7228 6622 4f75 7470 7574  ryError(f"Output
-00002360: 2069 6d61 6765 2069 7320 746f 6f20 6c61   image is too la
-00002370: 7267 653a 207b 6762 7d20 4742 2229 0d0a  rge: {gb} GB")..
-00002380: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00002390: 2020 6966 2073 6361 6c65 5f69 735f 7365    if scale_is_se
-000023a0: 713a 0d0a 2020 2020 2020 2020 2020 2020  q:..            
-000023b0: 7363 616c 6520 3d20 6c69 7374 2873 6361  scale = list(sca
-000023c0: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
-000023d0: 2069 6620 6c65 6e28 7363 616c 6529 2021   if len(scale) !
-000023e0: 3d20 6c65 6e28 6469 6d73 293a 0d0a 2020  = len(dims):..  
-000023f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00002400: 6973 6520 5661 6c75 6545 7272 6f72 280d  ise ValueError(.
-00002410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002420: 2020 2020 2022 7363 616c 6520 6d75 7374       "scale must
-00002430: 2068 6176 6520 7468 6520 7361 6d65 206c   have the same l
-00002440: 656e 6774 6820 6173 2074 6865 2073 7061  ength as the spa
-00002450: 7469 616c 2064 696d 656e 7369 6f6e 732e  tial dimensions.
-00002460: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00002470: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00002480: 2020 6974 203d 2069 7465 7228 7363 616c    it = iter(scal
-00002490: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000024a0: 7363 616c 655f 203d 205b 6e65 7874 2869  scale_ = [next(i
-000024b0: 7429 2069 6620 6120 696e 2064 696d 7320  t) if a in dims 
-000024c0: 656c 7365 2031 2066 6f72 2061 2069 6e20  else 1 for a in 
-000024d0: 7365 6c66 2e61 7865 735d 0d0a 2020 2020  self.axes]..    
-000024e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000024f0: 2020 2020 2020 2073 6361 6c65 5f20 3d20         scale_ = 
-00002500: 5b73 6361 6c65 2069 6620 6120 696e 2064  [scale if a in d
-00002510: 696d 7320 656c 7365 2031 2066 6f72 2061  ims else 1 for a
-00002520: 2069 6e20 7365 6c66 2e61 7865 735d 0d0a   in self.axes]..
-00002530: 2020 2020 2020 2020 6f75 7420 3d20 736b          out = sk
-00002540: 7472 616e 732e 7265 7363 616c 6528 0d0a  trans.rescale(..
-00002550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002560: 2e76 616c 7565 2c20 7363 616c 655f 2c20  .value, scale_, 
-00002570: 6f72 6465 723d 6f72 6465 722c 206d 6f64  order=order, mod
-00002580: 653d 6d6f 6465 2c20 6376 616c 3d63 7661  e=mode, cval=cva
-00002590: 6c2c 2061 6e74 695f 616c 6961 7369 6e67  l, anti_aliasing
-000025a0: 3d46 616c 7365 0d0a 2020 2020 2020 2020  =False..        
-000025b0: 290d 0a20 2020 2020 2020 206f 7574 203d  )..        out =
-000025c0: 206f 7574 2e76 6965 7728 7365 6c66 2e5f   out.view(self._
-000025d0: 5f63 6c61 7373 5f5f 292e 5f73 6574 5f69  _class__)._set_i
-000025e0: 6e66 6f28 7365 6c66 290d 0a20 2020 2020  nfo(self)..     
-000025f0: 2020 206f 7574 2e61 7865 7320 3d20 7365     out.axes = se
-00002600: 6c66 2e61 7865 732e 636f 7079 2829 0d0a  lf.axes.copy()..
-00002610: 2020 2020 2020 2020 6f75 742e 7365 745f          out.set_
-00002620: 7363 616c 6528 7b61 3a20 7365 6c66 2e73  scale({a: self.s
-00002630: 6361 6c65 5b61 5d2f 7363 616c 6520 666f  cale[a]/scale fo
-00002640: 7220 612c 2073 6361 6c65 2069 6e20 7a69  r a, scale in zi
-00002650: 7028 7365 6c66 2e61 7865 732c 2073 6361  p(self.axes, sca
-00002660: 6c65 5f29 7d29 0d0a 2020 2020 2020 2020  le_)})..        
-00002670: 7265 7475 726e 206f 7574 0d0a 2020 2020  return out..    
-00002680: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
-00002690: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
-000026a0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
-000026b0: 6573 0d0a 2020 2020 4073 616d 655f 6474  es..    @same_dt
-000026c0: 7970 650d 0a20 2020 2064 6566 2062 696e  ype..    def bin
-000026d0: 6e69 6e67 280d 0a20 2020 2020 2020 2073  ning(..        s
-000026e0: 656c 662c 0d0a 2020 2020 2020 2020 6269  elf,..        bi
-000026f0: 6e73 697a 653a 2069 6e74 203d 2032 2c0d  nsize: int = 2,.
-00002700: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-00002710: 3d20 226d 6561 6e22 2c20 0d0a 2020 2020  = "mean", ..    
-00002720: 2020 2020 2a2c 200d 0a20 2020 2020 2020      *, ..       
-00002730: 2063 6865 636b 5f65 6467 6573 3a20 626f   check_edges: bo
-00002740: 6f6c 203d 2054 7275 652c 0d0a 2020 2020  ol = True,..    
-00002750: 2020 2020 6469 6d73 3a20 4469 6d73 203d      dims: Dims =
-00002760: 204e 6f6e 650d 0a20 2020 2029 202d 3e20   None..    ) -> 
-00002770: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
-00002780: 2020 2072 2222 220d 0a20 2020 2020 2020     r"""..       
-00002790: 2042 696e 6e69 6e67 206f 6620 696d 6167   Binning of imag
-000027a0: 6573 2e20 5468 6973 2066 756e 6374 696f  es. This functio
-000027b0: 6e20 6973 2073 696d 696c 6172 2074 6f20  n is similar to 
-000027c0: 6060 7265 7363 616c 6560 6020 6275 7420  ``rescale`` but 
-000027d0: 6973 2073 7472 6963 746c 7920 0d0a 2020  is strictly ..  
-000027e0: 2020 2020 2020 6269 6e6e 6564 2062 7920        binned by 
-000027f0: 3a6d 6174 683a 604e 205c 7469 6d65 7320  :math:`N \times 
-00002800: 4e60 2062 6c6f 636b 732e 2041 6c73 6f2c  N` blocks. Also,
-00002810: 2061 6e79 206e 756d 7079 2066 756e 6374   any numpy funct
-00002820: 696f 6e73 2074 6861 7420 6163 6365 7074  ions that accept
-00002830: 200d 0a20 2020 2020 2020 2022 6178 6973   ..        "axis
-00002840: 2220 6172 6775 6d65 6e74 2061 7265 2073  " argument are s
-00002850: 7570 706f 7274 6564 2066 6f72 2072 6564  upported for red
-00002860: 7563 6520 6675 6e63 7469 6f6e 732e 0d0a  uce functions...
-00002870: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00002880: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00002890: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-000028a0: 2020 6269 6e73 697a 6520 3a20 696e 742c    binsize : int,
-000028b0: 2064 6566 6175 6c74 2069 7320 320d 0a20   default is 2.. 
-000028c0: 2020 2020 2020 2020 2020 2042 696e 2073             Bin s
-000028d0: 697a 652c 2073 7563 6820 6173 2032 7832  ize, such as 2x2
-000028e0: 2e0d 0a20 2020 2020 2020 206d 6574 686f  ...        metho
-000028f0: 6420 3a20 7374 7220 6f72 2063 616c 6c61  d : str or calla
-00002900: 626c 652c 2064 6566 6175 6c74 2069 7320  ble, default is 
-00002910: 6e75 6d70 792e 6d65 616e 0d0a 2020 2020  numpy.mean..    
-00002920: 2020 2020 2020 2020 5265 6475 6365 2066          Reduce f
-00002930: 756e 6374 696f 6e20 6170 706c 6965 6420  unction applied 
-00002940: 746f 2065 6163 6820 6269 6e2e 0d0a 2020  to each bin...  
-00002950: 2020 2020 2020 6368 6563 6b5f 6564 6765        check_edge
-00002960: 7320 3a20 626f 6f6c 2c20 6465 6661 756c  s : bool, defaul
-00002970: 7420 6973 2054 7275 650d 0a20 2020 2020  t is True..     
-00002980: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00002990: 6f6e 6c79 2064 6976 6973 6962 6c65 2060  only divisible `
-000029a0: 6062 696e 7369 7a65 6060 2069 7320 6163  `binsize`` is ac
-000029b0: 6365 7074 6564 2e20 4966 2046 616c 7365  cepted. If False
-000029c0: 2c20 696d 6167 6520 6973 0d0a 2020 2020  , image is..    
-000029d0: 2020 2020 2020 2020 6372 6f70 7065 6420          cropped 
-000029e0: 6174 2074 6865 2065 6e64 2074 6f20 6d61  at the end to ma
-000029f0: 7463 6820 6062 696e 7369 7a65 602e 0d0a  tch `binsize`...
-00002a00: 2020 2020 2020 2020 7b64 696d 737d 0d0a          {dims}..
-00002a10: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00002a20: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-00002a30: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
-00002a40: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
-00002a50: 2020 4269 6e6e 6564 2069 6d61 6765 0d0a    Binned image..
-00002a60: 2020 2020 2020 2020 2222 2220 0d0a 2020          """ ..  
-00002a70: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00002a80: 6e63 6528 6d65 7468 6f64 2c20 7374 7229  nce(method, str)
-00002a90: 3a0d 0a20 2020 2020 2020 2020 2020 2062  :..            b
-00002aa0: 696e 6675 6e63 203d 2067 6574 6174 7472  infunc = getattr
-00002ab0: 286e 702c 206d 6574 686f 6429 0d0a 2020  (np, method)..  
-00002ac0: 2020 2020 2020 656c 6966 2063 616c 6c61        elif calla
-00002ad0: 626c 6528 6d65 7468 6f64 293a 0d0a 2020  ble(method):..  
-00002ae0: 2020 2020 2020 2020 2020 6269 6e66 756e            binfun
-00002af0: 6320 3d20 6d65 7468 6f64 0d0a 2020 2020  c = method..    
-00002b00: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00002b10: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00002b20: 6545 7272 6f72 2822 606d 6574 686f 6460  eError("`method`
-00002b30: 206d 7573 7420 6265 2061 206e 756d 7079   must be a numpy
-00002b40: 2066 756e 6374 696f 6e20 6f72 2063 616c   function or cal
-00002b50: 6c61 626c 6520 6f62 6a65 6374 2e22 290d  lable object.").
-00002b60: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00002b70: 2020 2069 6620 6269 6e73 697a 6520 3d3d     if binsize ==
-00002b80: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-00002b90: 2072 6574 7572 6e20 7365 6c66 0d0a 2020   return self..  
-00002ba0: 2020 2020 2020 696d 675f 746f 5f72 6573        img_to_res
-00002bb0: 6861 7065 2c20 7368 6170 652c 2073 6361  hape, shape, sca
-00002bc0: 6c65 5f20 3d20 5f6d 6973 632e 6164 6a75  le_ = _misc.adju
-00002bd0: 7374 5f62 696e 280d 0a20 2020 2020 2020  st_bin(..       
-00002be0: 2020 2020 2073 656c 662e 7661 6c75 652c       self.value,
-00002bf0: 2062 696e 7369 7a65 2c20 6368 6563 6b5f   binsize, check_
-00002c00: 6564 6765 732c 2064 696d 732c 2073 656c  edges, dims, sel
-00002c10: 662e 6178 6573 0d0a 2020 2020 2020 2020  f.axes..        
-00002c20: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-00002c30: 2020 2020 2072 6573 6861 7065 645f 696d       reshaped_im
-00002c40: 6720 3d20 696d 675f 746f 5f72 6573 6861  g = img_to_resha
-00002c50: 7065 2e72 6573 6861 7065 2873 6861 7065  pe.reshape(shape
-00002c60: 290d 0a20 2020 2020 2020 2061 7865 735f  )..        axes_
-00002c70: 746f 5f72 6564 7563 6520 3d20 7475 706c  to_reduce = tupl
-00002c80: 6528 6920 2a20 3220 2b20 3120 666f 7220  e(i * 2 + 1 for 
-00002c90: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-00002ca0: 6e64 696d 2929 0d0a 2020 2020 2020 2020  ndim))..        
-00002cb0: 6f75 743a 206e 702e 6e64 6172 7261 7920  out: np.ndarray 
-00002cc0: 3d20 6269 6e66 756e 6328 7265 7368 6170  = binfunc(reshap
-00002cd0: 6564 5f69 6d67 2c20 6178 6973 3d61 7865  ed_img, axis=axe
-00002ce0: 735f 746f 5f72 6564 7563 6529 0d0a 2020  s_to_reduce)..  
-00002cf0: 2020 2020 2020 6f75 743a 2049 6d67 4172        out: ImgAr
-00002d00: 7261 7920 3d20 6f75 742e 7669 6577 2873  ray = out.view(s
-00002d10: 656c 662e 5f5f 636c 6173 735f 5f29 0d0a  elf.__class__)..
-00002d20: 2020 2020 2020 2020 6f75 742e 5f73 6574          out._set
-00002d30: 5f69 6e66 6f28 7365 6c66 290d 0a20 2020  _info(self)..   
-00002d40: 2020 2020 206f 7574 2e61 7865 7320 3d20       out.axes = 
-00002d50: 7365 6c66 2e61 7865 732e 636f 7079 2829  self.axes.copy()
-00002d60: 2020 2320 5f73 6574 5f69 6e66 6f20 646f    # _set_info do
-00002d70: 6573 206e 6f74 2070 6173 7320 636f 7079  es not pass copy
-00002d80: 2073 6f20 6e65 7720 6178 6573 206d 7573   so new axes mus
-00002d90: 7420 6265 2064 6566 696e 6564 2068 6572  t be defined her
-00002da0: 652e 0d0a 2020 2020 2020 2020 6f75 742e  e...        out.
-00002db0: 7365 745f 7363 616c 6528 0d0a 2020 2020  set_scale(..    
-00002dc0: 2020 2020 2020 2020 7b61 3a20 7365 6c66          {a: self
-00002dd0: 2e73 6361 6c65 5b61 5d2f 7363 616c 6520  .scale[a]/scale 
-00002de0: 666f 7220 612c 2073 6361 6c65 2069 6e20  for a, scale in 
-00002df0: 7a69 7028 7365 6c66 2e61 7865 732c 2073  zip(self.axes, s
-00002e00: 6361 6c65 5f29 7d0d 0a20 2020 2020 2020  cale_)}..       
-00002e10: 2029 0d0a 2020 2020 2020 2020 7265 7475   )..        retu
-00002e20: 726e 206f 7574 0d0a 2020 2020 0d0a 2020  rn out..    ..  
-00002e30: 2020 405f 646f 6373 2e77 7269 7465 5f64    @_docs.write_d
-00002e40: 6f63 730d 0a20 2020 2040 6469 6d73 5f74  ocs..    @dims_t
-00002e50: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
-00002e60: 2020 2020 6465 6620 7261 6469 616c 5f70      def radial_p
-00002e70: 726f 6669 6c65 280d 0a20 2020 2020 2020  rofile(..       
-00002e80: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
-00002e90: 6e62 696e 3a20 696e 7420 3d20 3332 2c0d  nbin: int = 32,.
-00002ea0: 0a20 2020 2020 2020 2063 656e 7465 723a  .        center:
-00002eb0: 2049 7465 7261 626c 655b 666c 6f61 745d   Iterable[float]
-00002ec0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0d   | None = None,.
-00002ed0: 0a20 2020 2020 2020 2072 5f6d 6178 3a20  .        r_max: 
-00002ee0: 666c 6f61 7420 3d20 4e6f 6e65 2c20 0d0a  float = None, ..
-00002ef0: 2020 2020 2020 2020 2a2c 200d 0a20 2020          *, ..   
-00002f00: 2020 2020 206d 6574 686f 643a 2073 7472       method: str
-00002f10: 203d 2022 6d65 616e 222c 0d0a 2020 2020   = "mean",..    
-00002f20: 2020 2020 6469 6d73 3a20 4469 6d73 203d      dims: Dims =
-00002f30: 204e 6f6e 650d 0a20 2020 2029 202d 3e20   None..    ) -> 
-00002f40: 5072 6f70 4172 7261 793a 0d0a 2020 2020  PropArray:..    
-00002f50: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00002f60: 2043 616c 6375 6c61 7465 2072 6164 6961   Calculate radia
-00002f70: 6c20 7072 6f66 696c 6520 6f66 2069 6d61  l profile of ima
-00002f80: 6765 732e 2053 6361 6c65 2061 6c6f 6e67  ges. Scale along
-00002f90: 2065 6163 6820 6178 6973 2077 696c 6c20   each axis will 
-00002fa0: 6265 2063 6f6e 7369 6465 7265 642c 200d  be considered, .
-00002fb0: 0a20 2020 2020 2020 2069 2e65 2e2c 2072  .        i.e., r
-00002fc0: 6174 6865 7220 656c 6c69 7073 6f69 6461  ather ellipsoida
-00002fd0: 6c20 7072 6f66 696c 6520 7769 6c6c 2062  l profile will b
-00002fe0: 6520 6361 6c63 756c 6174 6564 2069 6e73  e calculated ins
-00002ff0: 7465 6164 2069 6620 7363 616c 6573 2061  tead if scales a
-00003000: 7265 0d0a 2020 2020 2020 2020 6469 6666  re..        diff
-00003010: 6572 656e 7420 6265 7477 6565 6e20 6178  erent between ax
-00003020: 6573 2e0d 0a0d 0a20 2020 2020 2020 2050  es.....        P
-00003030: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-00003040: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00003050: 2020 2020 2020 206e 6269 6e20 3a20 696e         nbin : in
-00003060: 742c 2064 6566 6175 6c74 2069 7320 3332  t, default is 32
-00003070: 0d0a 2020 2020 2020 2020 2020 2020 4e75  ..            Nu
-00003080: 6d62 6572 206f 6620 6269 6e73 2e0d 0a20  mber of bins... 
-00003090: 2020 2020 2020 2063 656e 7465 7220 3a20         center : 
-000030a0: 6974 6572 6162 6c65 206f 6620 666c 6f61  iterable of floa
-000030b0: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
-000030c0: 2020 2020 2020 2020 2054 6865 2063 6f6f           The coo
-000030d0: 7264 696e 6174 6520 6f66 2063 656e 7465  rdinate of cente
-000030e0: 7220 6f66 2072 6164 6961 6c20 7072 6f66  r of radial prof
-000030f0: 696c 652e 2042 7920 6465 6661 756c 742c  ile. By default,
-00003100: 2074 6865 2063 656e 7465 7220 6f66 2069   the center of i
-00003110: 6d61 6765 0d0a 2020 2020 2020 2020 2020  mage..          
-00003120: 2020 6973 2075 7365 642e 0d0a 2020 2020    is used...    
-00003130: 2020 2020 725f 6d61 7820 3a20 666c 6f61      r_max : floa
-00003140: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
-00003150: 2020 2020 2020 2020 204d 6178 696d 756d           Maximum
-00003160: 2072 6164 6975 7320 746f 206d 616b 6520   radius to make 
-00003170: 7072 6f66 696c 652e 2052 6567 696f 6e20  profile. Region 
-00003180: 3020 3c3d 2072 203c 2072 5f6d 6178 2077  0 <= r < r_max w
-00003190: 696c 6c20 6265 2073 706c 6974 2069 6e74  ill be split int
-000031a0: 6f20 0d0a 2020 2020 2020 2020 2020 2020  o ..            
-000031b0: 6060 6e62 696e 6060 2072 696e 6773 2028  ``nbin`` rings (
-000031c0: 6f72 2073 6865 6c6c 7329 2e20 2a2a 5363  or shells). **Sc
-000031d0: 616c 6520 6d75 7374 2062 6520 636f 6e73  ale must be cons
-000031e0: 6964 6572 6564 2a2a 2062 6563 6175 7365  idered** because
-000031f0: 2073 6361 6c65 7320 6f66 200d 0a20 2020   scales of ..   
-00003200: 2020 2020 2020 2020 2065 6163 6820 6178           each ax
-00003210: 6973 206d 6179 2076 6172 792e 0d0a 2020  is may vary...  
-00003220: 2020 2020 2020 6d65 7468 6f64 203a 2073        method : s
-00003230: 7472 2c20 6465 6661 756c 7420 6973 2022  tr, default is "
-00003240: 6d65 616e 220d 0a20 2020 2020 2020 2020  mean"..         
-00003250: 2020 2052 6564 7563 6520 6675 6e63 7469     Reduce functi
-00003260: 6f6e 2e20 4261 7369 6320 7374 6174 6973  on. Basic statis
-00003270: 7469 6373 2066 756e 6374 696f 6e73 2061  tics functions a
-00003280: 7265 2073 7570 706f 7274 6564 2069 6e20  re supported in 
-00003290: 6060 7363 6970 792e 6e64 696d 6167 6560  ``scipy.ndimage`
-000032a0: 600d 0a20 2020 2020 2020 2020 2020 2062  `..            b
-000032b0: 7574 2074 6865 6972 206e 616d 6573 2061  ut their names a
-000032c0: 7265 206e 6f74 2063 6f6e 7369 7374 656e  re not consisten
-000032d0: 7420 7769 7468 2074 686f 7365 2069 6e20  t with those in 
-000032e0: 606e 756d 7079 602e 2055 7365 2060 6e75  `numpy`. Use `nu
-000032f0: 6d70 7960 2773 206e 616d 6573 0d0a 2020  mpy`'s names..  
-00003300: 2020 2020 2020 2020 2020 6865 7265 2e0d            here..
-00003310: 0a20 2020 2020 2020 207b 6469 6d73 7d0d  .        {dims}.
-00003320: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00003330: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
-00003340: 2d2d 2d0d 0a20 2020 2020 2020 2050 726f  ---..        Pro
-00003350: 7041 7272 6179 0d0a 2020 2020 2020 2020  pArray..        
-00003360: 2020 2020 5261 6469 616c 2070 726f 6669      Radial profi
-00003370: 6c65 2073 746f 7265 6420 696e 2078 2d61  le stored in x-a
-00003380: 7869 7320 6279 2064 6566 6175 6c74 2e20  xis by default. 
-00003390: 4966 2069 6e70 7574 2069 6d61 6765 2068  If input image h
-000033a0: 6173 2074 7a63 7978 2d61 7865 732c 2074  as tzcyx-axes, t
-000033b0: 6865 6e20 616e 2061 7272 6179 200d 0a20  hen an array .. 
-000033c0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-000033d0: 7463 782d 6178 6573 2077 696c 6c20 6265  tcx-axes will be
-000033e0: 2072 6574 7572 6e65 642e 0d0a 2020 2020   returned...    
-000033f0: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
-00003400: 0a20 2020 2020 2020 2066 756e 6320 3d20  .        func = 
-00003410: 7b22 6d65 616e 223a 2078 702e 6e64 692e  {"mean": xp.ndi.
-00003420: 6d65 616e 2c0d 0a20 2020 2020 2020 2020  mean,..         
-00003430: 2020 2020 2020 2022 7375 6d22 3a20 7870         "sum": xp
-00003440: 2e6e 6469 2e73 756d 5f6c 6162 656c 732c  .ndi.sum_labels,
-00003450: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003460: 2020 226d 6564 6961 6e22 3a20 7870 2e6e    "median": xp.n
-00003470: 6469 2e6d 6564 6961 6e2c 0d0a 2020 2020  di.median,..    
-00003480: 2020 2020 2020 2020 2020 2020 226d 6178              "max
-00003490: 223a 2078 702e 6e64 692e 6d61 7869 6d75  ": xp.ndi.maximu
-000034a0: 6d2c 0d0a 2020 2020 2020 2020 2020 2020  m,..            
-000034b0: 2020 2020 226d 696e 223a 2078 702e 6e64      "min": xp.nd
-000034c0: 692e 6d69 6e69 6d75 6d2c 0d0a 2020 2020  i.minimum,..    
-000034d0: 2020 2020 2020 2020 2020 2020 2273 7464              "std
-000034e0: 223a 2078 702e 6e64 692e 7374 616e 6461  ": xp.ndi.standa
-000034f0: 7264 5f64 6576 6961 7469 6f6e 2c0d 0a20  rd_deviation,.. 
-00003500: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00003510: 7661 7222 3a20 7870 2e6e 6469 2e76 6172  var": xp.ndi.var
-00003520: 6961 6e63 657d 5b6d 6574 686f 645d 0d0a  iance}[method]..
-00003530: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00003540: 2020 7370 6174 6961 6c5f 7368 6170 6520    spatial_shape 
-00003550: 3d20 7365 6c66 2e73 697a 6573 6f66 2864  = self.sizesof(d
-00003560: 696d 7329 0d0a 2020 2020 2020 2020 696e  ims)..        in
-00003570: 6473 203d 2078 702e 696e 6469 6365 7328  ds = xp.indices(
-00003580: 7370 6174 6961 6c5f 7368 6170 6529 0d0a  spatial_shape)..
-00003590: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-000035a0: 2020 2320 6368 6563 6b20 6365 6e74 6572    # check center
-000035b0: 0d0a 2020 2020 2020 2020 6966 2063 656e  ..        if cen
-000035c0: 7465 7220 6973 204e 6f6e 653a 0d0a 2020  ter is None:..  
-000035d0: 2020 2020 2020 2020 2020 6365 6e74 6572            center
-000035e0: 203d 205b 732f 3220 666f 7220 7320 696e   = [s/2 for s in
-000035f0: 2073 7061 7469 616c 5f73 6861 7065 5d0d   spatial_shape].
-00003600: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
-00003610: 6e28 6365 6e74 6572 2920 213d 206c 656e  n(center) != len
-00003620: 2864 696d 7329 3a0d 0a20 2020 2020 2020  (dims):..       
-00003630: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00003640: 4572 726f 7228 0d0a 2020 2020 2020 2020  Error(..        
-00003650: 2020 2020 2020 2020 6622 4c65 6e67 7468          f"Length
-00003660: 206f 6620 6063 656e 7465 7260 206d 7573   of `center` mus
-00003670: 7420 6d61 7463 6820 696e 7075 7420 6469  t match input di
-00003680: 6d65 6e73 696f 6e61 6c69 7479 2027 7b64  mensionality '{d
-00003690: 696d 737d 272e 220d 0a20 2020 2020 2020  ims}'."..       
-000036a0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-000036b0: 0d0a 2020 2020 2020 2020 7220 3d20 7870  ..        r = xp
-000036c0: 2e73 7172 7428 0d0a 2020 2020 2020 2020  .sqrt(..        
-000036d0: 2020 2020 7375 6d28 2828 7820 2d20 6329      sum(((x - c)
-000036e0: 2a73 656c 662e 7363 616c 655b 615d 292a  *self.scale[a])*
-000036f0: 2a32 2066 6f72 2078 2c20 632c 2061 2069  *2 for x, c, a i
-00003700: 6e20 7a69 7028 696e 6473 2c20 6365 6e74  n zip(inds, cent
-00003710: 6572 2c20 6469 6d73 2929 0d0a 2020 2020  er, dims))..    
-00003720: 2020 2020 290d 0a20 2020 2020 2020 2072      )..        r
-00003730: 5f6c 696d 203d 2072 2e6d 6178 2829 0d0a  _lim = r.max()..
-00003740: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00003750: 2020 2320 6368 6563 6b20 725f 6d61 780d    # check r_max.
-00003760: 0a20 2020 2020 2020 2069 6620 725f 6d61  .        if r_ma
-00003770: 7820 6973 204e 6f6e 653a 0d0a 2020 2020  x is None:..    
-00003780: 2020 2020 2020 2020 725f 6d61 7820 3d20          r_max = 
-00003790: 725f 6c69 6d0d 0a20 2020 2020 2020 2065  r_lim..        e
-000037a0: 6c69 6620 725f 6d61 7820 3e20 725f 6c69  lif r_max > r_li
-000037b0: 6d20 6f72 2072 5f6d 6178 203c 3d20 303a  m or r_max <= 0:
-000037c0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-000037d0: 6973 6520 5661 6c75 6545 7272 6f72 280d  ise ValueError(.
-000037e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000037f0: 2066 2260 725f 6d61 7860 206d 7573 7420   f"`r_max` must 
-00003800: 6265 2069 6e20 7261 6e67 6520 6f66 2030  be in range of 0
-00003810: 203c 2072 5f6d 6178 203c 3d20 7b72 5f6c   < r_max <= {r_l
-00003820: 696d 7d20 7769 7468 2074 6869 7320 696d  im} with this im
-00003830: 6167 652e 220d 0a20 2020 2020 2020 2020  age."..         
-00003840: 2020 2029 0d0a 2020 2020 2020 2020 0d0a     )..        ..
-00003850: 2020 2020 2020 2020 2320 6d61 6b65 2072          # make r
-00003860: 6164 6961 6c6c 7920 7365 7061 7261 7465  adially separate
-00003870: 6420 6c61 6265 6c73 0d0a 2020 2020 2020  d labels..      
-00003880: 2020 725f 7265 6c20 3d20 722f 725f 6d61    r_rel = r/r_ma
-00003890: 780d 0a20 2020 2020 2020 206c 6162 656c  x..        label
-000038a0: 7320 3d20 286e 6269 6e20 2a20 725f 7265  s = (nbin * r_re
-000038b0: 6c29 2e61 7374 7970 6528 6e70 2e75 696e  l).astype(np.uin
-000038c0: 7431 3629 202b 2031 0d0a 2020 2020 2020  t16) + 1..      
-000038d0: 2020 6c61 6265 6c73 5b72 5f72 656c 203e    labels[r_rel >
-000038e0: 3d20 315d 203d 2030 0d0a 2020 2020 2020  = 1] = 0..      
-000038f0: 2020 0d0a 2020 2020 2020 2020 635f 6178    ..        c_ax
-00003900: 6573 203d 2063 6f6d 706c 656d 656e 745f  es = complement_
-00003910: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-00003920: 6178 6573 290d 0a20 2020 2020 2020 200d  axes)..        .
-00003930: 0a20 2020 2020 2020 206f 7574 203d 2050  .        out = P
-00003940: 726f 7041 7272 6179 280d 0a20 2020 2020  ropArray(..     
-00003950: 2020 2020 2020 206e 702e 656d 7074 7928         np.empty(
-00003960: 7365 6c66 2e73 697a 6573 6f66 2863 5f61  self.sizesof(c_a
-00003970: 7865 7329 2b28 696e 7428 6c61 6265 6c73  xes)+(int(labels
-00003980: 2e6d 6178 2829 292c 2929 2c0d 0a20 2020  .max()),)),..   
-00003990: 2020 2020 2020 2020 2064 7479 7065 3d6e           dtype=n
-000039a0: 702e 666c 6f61 7433 322c 0d0a 2020 2020  p.float32,..    
-000039b0: 2020 2020 2020 2020 6178 6573 3d63 5f61          axes=c_a
-000039c0: 7865 7320 2b20 5b64 696d 735b 2d31 5d5d  xes + [dims[-1]]
-000039d0: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
-000039e0: 736f 7572 6365 3d73 656c 662e 736f 7572  source=self.sour
-000039f0: 6365 2c20 0d0a 2020 2020 2020 2020 2020  ce, ..          
-00003a00: 2020 6d65 7461 6461 7461 3d73 656c 662e    metadata=self.
-00003a10: 6d65 7461 6461 7461 2c20 0d0a 2020 2020  metadata, ..    
-00003a20: 2020 2020 2020 2020 7072 6f70 6e61 6d65          propname
-00003a30: 3d22 7261 6469 616c 5f70 726f 6669 6c65  ="radial_profile
-00003a40: 220d 0a20 2020 2020 2020 2029 0d0a 2020  "..        )..  
-00003a50: 2020 2020 2020 7261 6469 616c 5f66 756e        radial_fun
-00003a60: 6320 3d20 7061 7274 6961 6c28 6375 7079  c = partial(cupy
-00003a70: 5f64 6973 7061 7463 6865 7228 6675 6e63  _dispatcher(func
-00003a80: 292c 206c 6162 656c 733d 6c61 6265 6c73  ), labels=labels
-00003a90: 2c20 696e 6465 783d 7870 2e61 7261 6e67  , index=xp.arang
-00003aa0: 6528 312c 206c 6162 656c 732e 6d61 7828  e(1, labels.max(
-00003ab0: 292b 3129 290d 0a20 2020 2020 2020 2066  )+1))..        f
-00003ac0: 6f72 2073 6c2c 2069 6d67 2069 6e20 7365  or sl, img in se
-00003ad0: 6c66 2e69 7465 7228 635f 6178 6573 2c20  lf.iter(c_axes, 
-00003ae0: 6578 636c 7564 653d 6469 6d73 293a 0d0a  exclude=dims):..
-00003af0: 2020 2020 2020 2020 2020 2020 6f75 745b              out[
-00003b00: 736c 5d20 3d20 7870 2e61 736e 756d 7079  sl] = xp.asnumpy
-00003b10: 2872 6164 6961 6c5f 6675 6e63 2869 6d67  (radial_func(img
-00003b20: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
-00003b30: 726e 206f 7574 0d0a 2020 2020 0d0a 2020  rn out..    ..  
-00003b40: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
-00003b50: 616c 5f61 7865 730d 0a20 2020 2064 6566  al_axes..    def
-00003b60: 2067 6175 7373 6669 7428 0d0a 2020 2020   gaussfit(..    
-00003b70: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00003b80: 2020 2073 6361 6c65 3a20 666c 6f61 7420     scale: float 
-00003b90: 3d20 312f 3136 2c0d 0a20 2020 2020 2020  = 1/16,..       
-00003ba0: 2070 303a 2053 6571 7565 6e63 655b 666c   p0: Sequence[fl
-00003bb0: 6f61 745d 207c 204e 6f6e 6520 3d20 4e6f  oat] | None = No
-00003bc0: 6e65 2c0d 0a20 2020 2020 2020 206d 6574  ne,..        met
-00003bd0: 686f 643a 2073 7472 203d 2022 506f 7765  hod: str = "Powe
-00003be0: 6c6c 222c 0d0a 2020 2020 2020 2020 6d61  ll",..        ma
-00003bf0: 736b 3a20 6e70 2e6e 6461 7272 6179 207c  sk: np.ndarray |
-00003c00: 204e 6f6e 6520 3d20 4e6f 6e65 2c0d 0a20   None = None,.. 
-00003c10: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
-00003c20: 7320 3d20 2279 7822 2c0d 0a20 2020 2029  s = "yx",..    )
-00003c30: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
-00003c40: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00003c50: 2020 2020 4669 7420 7468 6520 696d 6167      Fit the imag
-00003c60: 6520 746f 2032 2d44 2047 6175 7373 6961  e to 2-D Gaussia
-00003c70: 6e20 6261 636b 6772 6f75 6e64 2e0d 0a0d  n background....
-00003c80: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00003c90: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-00003ca0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-00003cb0: 2073 6361 6c65 203a 2066 6c6f 6174 2c20   scale : float, 
-00003cc0: 6465 6661 756c 7420 6973 2031 2f31 362e  default is 1/16.
-00003cd0: 0d0a 2020 2020 2020 2020 2020 2020 5363  ..            Sc
-00003ce0: 616c 6520 6f66 2072 6f75 6768 2069 6d61  ale of rough ima
-00003cf0: 6765 2028 746f 2073 7065 6564 2075 7020  ge (to speed up 
-00003d00: 6669 7474 696e 6729 2e0d 0a20 2020 2020  fitting)...     
-00003d10: 2020 2070 3020 3a20 7365 7175 656e 6365     p0 : sequence
-00003d20: 206f 6620 666c 6f61 742c 206f 7074 696f   of float, optio
-00003d30: 6e61 6c0d 0a20 2020 2020 2020 2020 2020  nal..           
-00003d40: 2049 6e69 7469 616c 2070 6172 616d 6574   Initial paramet
-00003d50: 6572 732e 0d0a 2020 2020 2020 2020 6d65  ers...        me
-00003d60: 7468 6f64 203a 2073 7472 2c20 6f70 7469  thod : str, opti
-00003d70: 6f6e 616c 0d0a 2020 2020 2020 2020 2020  onal..          
-00003d80: 2020 4669 7474 696e 6720 6d65 7468 6f64    Fitting method
-00003d90: 2e20 5365 6520 6073 6369 7079 2e6f 7074  . See `scipy.opt
-00003da0: 696d 697a 652e 6d69 6e69 6d69 7a65 602e  imize.minimize`.
-00003db0: 0d0a 2020 2020 2020 2020 6d61 736b 203a  ..        mask :
-00003dc0: 206e 702e 6e64 6172 7261 792c 206f 7074   np.ndarray, opt
-00003dd0: 696f 6e61 6c2c 0d0a 2020 2020 2020 2020  ional,..        
-00003de0: 2020 2020 4966 2067 6976 656e 2c20 6967      If given, ig
-00003df0: 6e6f 7265 2074 6865 2054 7275 6520 7265  nore the True re
-00003e00: 6769 6f6e 2066 726f 6d20 6669 7474 696e  gion from fittin
-00003e10: 672e 0d0a 2020 2020 2020 2020 7b64 696d  g...        {dim
-00003e20: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
-00003e30: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-00003e40: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00003e50: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00003e60: 2020 2020 2020 4669 7420 696d 6167 652e        Fit image.
-00003e70: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00003e80: 2020 2020 2020 206e 6469 6d20 3d20 6c65         ndim = le
-00003e90: 6e28 6469 6d73 290d 0a20 2020 2020 2020  n(dims)..       
-00003ea0: 2069 6620 7365 6c66 2e6e 6469 6d20 3e20   if self.ndim > 
-00003eb0: 6e64 696d 3a0d 0a20 2020 2020 2020 2020  ndim:..         
-00003ec0: 2020 206f 7574 203d 206e 702e 656d 7074     out = np.empt
-00003ed0: 795f 6c69 6b65 2873 656c 6629 0d0a 2020  y_like(self)..  
-00003ee0: 2020 2020 2020 2020 2020 635f 6178 6573            c_axes
-00003ef0: 203d 2063 6f6d 706c 656d 656e 745f 6178   = complement_ax
-00003f00: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
-00003f10: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
-00003f20: 2066 726f 6d20 2e62 6173 6573 2069 6d70   from .bases imp
-00003f30: 6f72 7420 4d65 7461 4172 7261 790d 0a20  ort MetaArray.. 
-00003f40: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00003f50: 7320 3d20 4d65 7461 4172 7261 7928 6e70  s = MetaArray(np
-00003f60: 2e65 6d70 7479 2873 656c 662e 7368 6170  .empty(self.shap
-00003f70: 655b 3a2d 6e64 696d 5d2c 2064 7479 7065  e[:-ndim], dtype
-00003f80: 3d6f 626a 6563 7429 2c20 6178 6573 3d63  =object), axes=c
-00003f90: 5f61 7865 7329 0d0a 2020 2020 2020 2020  _axes)..        
-00003fa0: 2020 2020 666f 7220 736c 2c20 696d 6720      for sl, img 
-00003fb0: 696e 2073 656c 662e 6974 6572 2863 5f61  in self.iter(c_a
-00003fc0: 7865 732c 2069 7372 6177 3d54 7275 6529  xes, israw=True)
-00003fd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00003fe0: 2020 2066 6974 203d 2069 6d67 2e67 6175     fit = img.gau
-00003ff0: 7373 6669 7428 7363 616c 653d 7363 616c  ssfit(scale=scal
-00004000: 652c 2070 303d 7030 2c20 6d65 7468 6f64  e, p0=p0, method
-00004010: 3d6d 6574 686f 642c 2064 696d 733d 6469  =method, dims=di
-00004020: 6d73 290d 0a20 2020 2020 2020 2020 2020  ms)..           
-00004030: 2020 2020 2070 6172 616d 735b 736c 5b3a       params[sl[:
-00004040: 2d6e 6469 6d5d 5d20 3d20 6669 742e 6d65  -ndim]] = fit.me
-00004050: 7461 6461 7461 5b22 4761 7573 7369 616e  tadata["Gaussian
-00004060: 5061 7261 6d65 7465 7273 225d 0d0a 2020  Parameters"]..  
-00004070: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00004080: 745b 736c 5d20 3d20 6669 742e 7661 6c75  t[sl] = fit.valu
-00004090: 650d 0a20 2020 2020 2020 2020 2020 206f  e..            o
-000040a0: 7574 2e6d 6574 6164 6174 6120 3d20 6f75  ut.metadata = ou
-000040b0: 742e 6d65 7461 6461 7461 2e63 6f70 7928  t.metadata.copy(
-000040c0: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
-000040d0: 7574 2e6d 6574 6164 6174 615b 2247 6175  ut.metadata["Gau
-000040e0: 7373 6961 6e50 6172 616d 6574 6572 7322  ssianParameters"
-000040f0: 5d20 3d20 7061 7261 6d73 0d0a 2020 2020  ] = params..    
-00004100: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-00004110: 7574 0d0a 2020 2020 2020 2020 0d0a 2020  ut..        ..  
-00004120: 2020 2020 2020 726f 7567 6820 3d20 7365        rough = se
-00004130: 6c66 2e72 6573 6361 6c65 2873 6361 6c65  lf.rescale(scale
-00004140: 292e 7661 6c75 652e 6173 7479 7065 286e  ).value.astype(n
-00004150: 702e 666c 6f61 7433 3229 0d0a 2020 2020  p.float32)..    
-00004160: 2020 2020 6966 206d 6173 6b20 6973 206e      if mask is n
-00004170: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00004180: 2020 2020 2020 6672 6f6d 202e 2e63 6f72        from ..cor
-00004190: 6520 696d 706f 7274 2061 7361 7272 6179  e import asarray
-000041a0: 2061 7320 6970 5f61 7361 7272 6179 0d0a   as ip_asarray..
-000041b0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-000041c0: 203d 2069 705f 6173 6172 7261 7928 6d61   = ip_asarray(ma
-000041d0: 736b 292e 7265 7363 616c 6528 7363 616c  sk).rescale(scal
-000041e0: 6529 203e 2030 0d0a 2020 2020 2020 2020  e) > 0..        
-000041f0: 6761 7573 7369 616e 203d 2047 6175 7373  gaussian = Gauss
-00004200: 6961 6e42 6163 6b67 726f 756e 6428 7030  ianBackground(p0
-00004210: 290d 0a20 2020 2020 2020 2067 6175 7373  )..        gauss
-00004220: 6961 6e2e 6669 7428 726f 7567 682c 206d  ian.fit(rough, m
-00004230: 6574 686f 643d 6d65 7468 6f64 2c20 6d61  ethod=method, ma
-00004240: 736b 3d6d 6173 6b29 0d0a 2020 2020 2020  sk=mask)..      
-00004250: 2020 6761 7573 7369 616e 2e72 6573 6361    gaussian.resca
-00004260: 6c65 2831 2f73 6361 6c65 290d 0a20 2020  le(1/scale)..   
-00004270: 2020 2020 2066 6974 203d 2067 6175 7373       fit = gauss
-00004280: 6961 6e2e 6765 6e65 7261 7465 2873 656c  ian.generate(sel
-00004290: 662e 7368 6170 6529 2e76 6965 7728 7365  f.shape).view(se
-000042a0: 6c66 2e5f 5f63 6c61 7373 5f5f 290d 0a20  lf.__class__).. 
-000042b0: 2020 2020 2020 2066 6974 2e5f 7365 745f         fit._set_
-000042c0: 696e 666f 2873 656c 6629 0d0a 2020 2020  info(self)..    
-000042d0: 2020 2020 6669 742e 6d65 7461 6461 7461      fit.metadata
-000042e0: 203d 2066 6974 2e6d 6574 6164 6174 612e   = fit.metadata.
-000042f0: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-00004300: 6669 742e 6d65 7461 6461 7461 5b22 4761  fit.metadata["Ga
-00004310: 7573 7369 616e 5061 7261 6d65 7465 7273  ussianParameters
-00004320: 225d 203d 2067 6175 7373 6961 6e2e 6173  "] = gaussian.as
-00004330: 6469 6374 2829 0d0a 2020 2020 2020 2020  dict()..        
-00004340: 7265 7475 726e 2066 6974 0d0a 2020 2020  return fit..    
-00004350: 0d0a 2020 2020 4073 616d 655f 6474 7970  ..    @same_dtyp
-00004360: 6528 6173 666c 6f61 743d 5472 7565 290d  e(asfloat=True).
-00004370: 0a20 2020 2040 6368 6563 6b5f 696e 7075  .    @check_inpu
-00004380: 745f 616e 645f 6f75 7470 7574 0d0a 2020  t_and_output..  
-00004390: 2020 6465 6620 6761 7573 735f 636f 7272    def gauss_corr
-000043a0: 6563 7469 6f6e 2873 656c 662c 2072 6566  ection(self, ref
-000043b0: 3a20 496d 6741 7272 6179 3d4e 6f6e 652c  : ImgArray=None,
-000043c0: 2073 6361 6c65 3a20 666c 6f61 7420 3d20   scale: float = 
-000043d0: 312f 3136 2c20 6d65 6469 616e 5f72 6164  1/16, median_rad
-000043e0: 6975 733a 2066 6c6f 6174 203d 2031 3529  ius: float = 15)
-000043f0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-00004400: 2020 2020 2020 2020 436f 7272 6563 7420          Correct 
-00004410: 756e 6576 656e 6c79 2064 6973 7472 6962  unevenly distrib
-00004420: 7574 6564 2065 7863 6974 6174 696f 6e20  uted excitation 
-00004430: 6c69 6768 7420 7573 696e 6720 4761 7573  light using Gaus
-00004440: 7369 616e 2066 6974 7469 6e67 2e20 5468  sian fitting. Th
-00004450: 6973 206d 6574 686f 6420 7375 6274 7261  is method subtra
-00004460: 6374 730d 0a20 2020 2020 2020 2062 6163  cts..        bac
-00004470: 6b67 726f 756e 6420 696e 7465 6e73 6974  kground intensit
-00004480: 7920 6174 2074 6865 2073 616d 6520 7469  y at the same ti
-00004490: 6d65 2e20 4966 2069 6e70 7574 2069 6d61  me. If input ima
-000044a0: 6765 2069 7320 7569 6e74 2c20 7468 656e  ge is uint, then
-000044b0: 206f 7574 7075 7420 7661 6c75 6520 756e   output value un
-000044c0: 6465 7220 3020 7769 6c6c 0d0a 2020 2020  der 0 will..    
-000044d0: 2020 2020 7265 706c 6163 6564 2077 6974      replaced wit
-000044e0: 6820 302e 2049 6620 796f 7520 7761 6e74  h 0. If you want
-000044f0: 2074 6f20 7175 616e 7469 6679 2062 6163   to quantify bac
-00004500: 6b67 726f 756e 642c 2069 7420 6973 206e  kground, it is n
-00004510: 6563 6573 7361 7279 2074 6f20 6669 7273  ecessary to firs
-00004520: 7420 636f 6e76 6572 7420 696e 7075 740d  t convert input.
-00004530: 0a20 2020 2020 2020 2069 6d61 6765 2074  .        image t
-00004540: 6f20 666c 6f61 7420 696d 6167 652e 0d0a  o float image...
-00004550: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00004560: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00004570: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00004580: 2020 7265 6620 3a20 496d 6741 7272 6179    ref : ImgArray
-00004590: 2c20 6465 6661 756c 7420 6973 2060 7365  , default is `se
-000045a0: 6c66 602e 0d0a 2020 2020 2020 2020 2020  lf`...          
-000045b0: 2020 5265 6665 7265 6e63 6520 696d 6167    Reference imag
-000045c0: 6520 746f 2065 7374 696d 6174 6520 6261  e to estimate ba
-000045d0: 636b 6772 6f75 6e64 2e0d 0a20 2020 2020  ckground...     
-000045e0: 2020 2073 6361 6c65 203a 2066 6c6f 6174     scale : float
-000045f0: 2c20 6465 6661 756c 7420 6973 2031 2f31  , default is 1/1
-00004600: 362e 0d0a 2020 2020 2020 2020 2020 2020  6...            
-00004610: 5363 616c 6520 6f66 2072 6f75 6768 2069  Scale of rough i
-00004620: 6d61 6765 2028 746f 2073 7065 6564 2075  mage (to speed u
-00004630: 7020 6669 7474 696e 6729 2e0d 0a20 2020  p fitting)...   
-00004640: 2020 2020 206d 6564 6961 6e5f 7261 6469       median_radi
-00004650: 7573 203a 2066 6c6f 6174 2c20 6465 6661  us : float, defa
-00004660: 756c 7420 6973 2031 352e 0d0a 2020 2020  ult is 15...    
-00004670: 2020 2020 2020 2020 5261 6469 7573 206f          Radius o
-00004680: 6620 6d65 6469 616e 2070 7265 6669 6c74  f median prefilt
-00004690: 6572 2773 206b 6572 6e65 6c2e 2049 6620  er's kernel. If 
-000046a0: 736d 616c 6c65 7220 7468 616e 2031 2c20  smaller than 1, 
-000046b0: 7072 6566 696c 7465 7269 6e67 2077 696c  prefiltering wil
-000046c0: 6c20 6265 2073 6b69 7070 6564 2e0d 0a0d  l be skipped....
-000046d0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000046e0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-000046f0: 2d0d 0a20 2020 2020 2020 2049 6d67 4172  -..        ImgAr
-00004700: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
-00004710: 2043 6f72 7265 6374 6564 2061 6e64 2062   Corrected and b
-00004720: 6163 6b67 726f 756e 6420 7375 6274 7261  ackground subtra
-00004730: 6374 6564 2069 6d61 6765 2e0d 0a20 2020  cted image...   
-00004740: 2020 2020 200d 0a20 2020 2020 2020 2045       ..        E
-00004750: 7861 6d70 6c65 730d 0a20 2020 2020 2020  xamples..       
-00004760: 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020   --------..     
-00004770: 2020 2031 2e20 5768 656e 2069 6e70 7574     1. When input
-00004780: 2069 6d61 6765 2068 6173 2022 7074 6379   image has "ptcy
-00004790: 7822 2d61 7865 732c 2061 6e64 2079 6f75  x"-axes, and you
-000047a0: 2077 616e 7420 746f 2065 7374 696d 6174   want to estimat
-000047b0: 6520 7468 6520 6261 636b 6772 6f75 6e64  e the background
-000047c0: 2069 6e74 656e 7369 7479 0d0a 2020 2020   intensity..    
-000047d0: 2020 2020 666f 7220 6561 6368 2063 6861      for each cha
-000047e0: 6e6e 656c 2062 7920 6176 6572 6167 696e  nnel by averagin
-000047f0: 6720 616c 6c20 7468 6520 706f 7369 7469  g all the positi
-00004800: 6f6e 7320 616e 6420 7469 6d65 732e 0d0a  ons and times...
-00004810: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00004820: 2020 2020 2020 3e3e 3e20 696d 675f 636f        >>> img_co
-00004830: 7220 3d20 696d 672e 6761 7573 735f 636f  r = img.gauss_co
-00004840: 7272 6563 7469 6f6e 2872 6566 3d69 6d67  rrection(ref=img
-00004850: 2e70 726f 6a28 2270 7422 2929 0d0a 2020  .proj("pt"))..  
-00004860: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00004870: 322e 2057 6865 6e20 696e 7075 7420 696d  2. When input im
-00004880: 6167 6520 6861 7320 2270 7463 7978 222d  age has "ptcyx"-
-00004890: 6178 6573 2c20 616e 6420 796f 7520 7761  axes, and you wa
-000048a0: 6e74 2074 6f20 6573 7469 6d61 7465 2074  nt to estimate t
-000048b0: 6865 2062 6163 6b67 726f 756e 6420 696e  he background in
-000048c0: 7465 6e73 6974 790d 0a20 2020 2020 2020  tensity..       
-000048d0: 2066 6f72 2065 6163 6820 6368 616e 6e65   for each channe
-000048e0: 6c20 616e 6420 7469 6d65 2070 6f69 6e74  l and time point
-000048f0: 2062 7920 6176 6572 6167 696e 6720 616c   by averaging al
-00004900: 6c20 7468 6520 706f 7369 7469 6f6e 732e  l the positions.
-00004910: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00004920: 2020 2020 2020 2020 3e3e 3e20 696d 675f          >>> img_
-00004930: 636f 7220 3d20 696d 672e 6761 7573 735f  cor = img.gauss_
-00004940: 636f 7272 6563 7469 6f6e 2872 6566 3d69  correction(ref=i
-00004950: 6d67 2e70 726f 6a28 2270 2229 290d 0a20  mg.proj("p")).. 
-00004960: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00004970: 2020 2020 6966 2072 6566 2069 7320 4e6f      if ref is No
-00004980: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00004990: 2072 6566 203d 2073 656c 660d 0a20 2020   ref = self..   
-000049a0: 2020 2020 2065 6c69 6620 6e6f 7420 6973       elif not is
-000049b0: 696e 7374 616e 6365 2872 6566 2c20 7365  instance(ref, se
-000049c0: 6c66 2e5f 5f63 6c61 7373 5f5f 293a 0d0a  lf.__class__):..
-000049d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000049e0: 6520 5479 7065 4572 726f 7228 6622 6072  e TypeError(f"`r
-000049f0: 6566 6020 6d75 7374 2062 6520 4e6f 6e65  ef` must be None
-00004a00: 206f 7220 496d 6741 7272 6179 2c20 6275   or ImgArray, bu
-00004a10: 7420 676f 7420 7b74 7970 6528 7265 6629  t got {type(ref)
-00004a20: 7d22 290d 0a20 2020 2020 2020 200d 0a20  }")..        .. 
-00004a30: 2020 2020 2020 2073 656c 665f 6c6f 6f70         self_loop
-00004a40: 5f61 7865 7320 3d20 636f 6d70 6c65 6d65  _axes = compleme
-00004a50: 6e74 5f61 7865 7328 7265 662e 6178 6573  nt_axes(ref.axes
-00004a60: 2c20 7365 6c66 2e61 7865 7329 0d0a 2020  , self.axes)..  
-00004a70: 2020 2020 2020 7265 665f 6c6f 6f70 5f61        ref_loop_a
-00004a80: 7865 7320 3d20 636f 6d70 6c65 6d65 6e74  xes = complement
-00004a90: 5f61 7865 7328 2279 7822 2c20 7265 662e  _axes("yx", ref.
-00004aa0: 6178 6573 290d 0a20 2020 2020 2020 206f  axes)..        o
-00004ab0: 7574 203d 206e 702e 656d 7074 7928 7365  ut = np.empty(se
-00004ac0: 6c66 2e73 6861 7065 2c20 6474 7970 653d  lf.shape, dtype=
-00004ad0: 6e70 2e66 6c6f 6174 3332 290d 0a20 2020  np.float32)..   
-00004ae0: 2020 2020 2066 6f72 2073 6c30 2c20 7265       for sl0, re
-00004af0: 665f 2069 6e20 7265 662e 6974 6572 2872  f_ in ref.iter(r
-00004b00: 6566 5f6c 6f6f 705f 6178 6573 2c20 6973  ef_loop_axes, is
-00004b10: 7261 773d 5472 7565 293a 0d0a 2020 2020  raw=True):..    
-00004b20: 2020 2020 2020 2020 7265 665f 3a20 496d          ref_: Im
-00004b30: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
-00004b40: 2020 2020 6966 206d 6564 6961 6e5f 7261      if median_ra
-00004b50: 6469 7573 203e 3d20 313a 0d0a 2020 2020  dius >= 1:..    
-00004b60: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
-00004b70: 203d 2072 6566 5f2e 6d65 6469 616e 5f66   = ref_.median_f
-00004b80: 696c 7465 7228 7261 6469 7573 3d6d 6564  ilter(radius=med
-00004b90: 6961 6e5f 7261 6469 7573 290d 0a20 2020  ian_radius)..   
-00004ba0: 2020 2020 2020 2020 2066 6974 203d 2072           fit = r
-00004bb0: 6566 5f2e 6761 7573 7366 6974 2873 6361  ef_.gaussfit(sca
-00004bc0: 6c65 3d73 6361 6c65 290d 0a20 2020 2020  le=scale)..     
-00004bd0: 2020 2020 2020 2061 203d 2066 6974 2e6d         a = fit.m
-00004be0: 6178 2829 0d0a 2020 2020 2020 2020 2020  ax()..          
-00004bf0: 2020 666f 7220 736c 2c20 696d 6720 696e    for sl, img in
-00004c00: 2073 656c 662e 6974 6572 2873 656c 665f   self.iter(self_
-00004c10: 6c6f 6f70 5f61 7865 732c 2069 7372 6177  loop_axes, israw
-00004c20: 3d54 7275 6529 3a0d 0a20 2020 2020 2020  =True):..       
-00004c30: 2020 2020 2020 2020 206f 7574 5b73 6c5d           out[sl]
-00004c40: 5b73 6c30 5d20 3d20 2869 6d67 5b73 6c30  [sl0] = (img[sl0
-00004c50: 5d20 2f20 6669 7420 2a20 6120 2d20 6129  ] / fit * a - a)
-00004c60: 2e76 616c 7565 0d0a 2020 2020 2020 2020  .value..        
-00004c70: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00004c80: 206f 7574 2e76 6965 7728 7365 6c66 2e5f   out.view(self._
-00004c90: 5f63 6c61 7373 5f5f 290d 0a0d 0a20 2020  _class__)....   
-00004ca0: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
-00004cb0: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
-00004cc0: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
-00004cd0: 7865 730d 0a20 2020 2064 6566 2068 6573  xes..    def hes
-00004ce0: 7369 616e 5f65 6967 7661 6c28 7365 6c66  sian_eigval(self
-00004cf0: 2c20 7369 676d 613a 206e 4446 6c6f 6174  , sigma: nDFloat
-00004d00: 203d 2031 2c20 2a2c 2064 696d 733a 2044   = 1, *, dims: D
-00004d10: 696d 7320 3d20 4e6f 6e65 2920 2d3e 2049  ims = None) -> I
-00004d20: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
-00004d30: 2020 2222 220d 0a20 2020 2020 2020 2043    """..        C
-00004d40: 616c 6375 6c61 7465 2048 6573 7369 616e  alculate Hessian
-00004d50: 2773 2065 6967 656e 7661 6c75 6573 2066  's eigenvalues f
-00004d60: 6f72 2065 6163 6820 696d 6167 652e 200d  or each image. .
-00004d70: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00004d80: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-00004d90: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00004da0: 2d0d 0a20 2020 2020 2020 207b 7369 676d  -..        {sigm
-00004db0: 617d 0d0a 2020 2020 2020 2020 7b64 696d  a}..        {dim
-00004dc0: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
-00004dd0: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-00004de0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00004df0: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00004e00: 2020 2020 2020 4172 7261 7920 6f66 2065        Array of e
-00004e10: 6967 656e 7661 6c75 6573 2e20 5468 6520  igenvalues. The 
-00004e20: 6178 6973 2060 6022 6261 7365 2260 6020  axis ``"base"`` 
-00004e30: 6465 6e6f 7465 7320 7468 6520 696e 6465  denotes the inde
-00004e40: 7820 6f66 2065 6967 656e 7661 6c75 6573  x of eigenvalues
-00004e50: 2e0d 0a20 2020 2020 2020 2020 2020 206c  ...            l
-00004e60: 3d30 206d 6561 6e73 2074 6865 2073 6d61  =0 means the sma
-00004e70: 6c6c 6573 7420 6569 6765 6e76 616c 7565  llest eigenvalue
-00004e80: 2e0d 0a20 2020 2020 2020 200d 0a20 2020  ...        ..   
-00004e90: 2020 2020 2045 7861 6d70 6c65 730d 0a20       Examples.. 
-00004ea0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0d         --------.
-00004eb0: 0a20 2020 2020 2020 2045 7874 7261 6374  .        Extract
-00004ec0: 2066 696c 616d 656e 740d 0a20 2020 2020   filament..     
-00004ed0: 2020 2020 2020 203e 3e3e 2065 6967 203d         >>> eig =
-00004ee0: 202d 696d 672e 6865 7373 6961 6e5f 6569   -img.hessian_ei
-00004ef0: 6776 616c 2829 5b69 702e 736c 6963 6572  gval()[ip.slicer
-00004f00: 2e62 6173 655b 305d 5d0d 0a20 2020 2020  .base[0]]..     
-00004f10: 2020 2020 2020 203e 3e3e 2065 6967 5b65         >>> eig[e
-00004f20: 6967 3c30 5d20 3d20 300d 0a20 2020 2020  ig<0] = 0..     
-00004f30: 2020 2022 2222 2020 2020 2020 2020 0d0a     """        ..
-00004f40: 2020 2020 2020 2020 6e64 696d 203d 206c          ndim = l
-00004f50: 656e 2864 696d 7329 0d0a 2020 2020 2020  en(dims)..      
-00004f60: 2020 7369 676d 6120 3d20 6368 6563 6b5f    sigma = check_
-00004f70: 6e64 2873 6967 6d61 2c20 6e64 696d 290d  nd(sigma, ndim).
-00004f80: 0a20 2020 2020 2020 2070 7873 697a 6520  .        pxsize 
-00004f90: 3d20 6e70 2e61 7272 6179 285b 7365 6c66  = np.array([self
-00004fa0: 2e73 6361 6c65 5b61 5d20 666f 7220 6120  .scale[a] for a 
-00004fb0: 696e 2064 696d 735d 290d 0a20 2020 2020  in dims])..     
-00004fc0: 2020 200d 0a20 2020 2020 2020 2065 6967     ..        eig
-00004fd0: 7661 6c20 3d20 7365 6c66 2e61 735f 666c  val = self.as_fl
-00004fe0: 6f61 7428 292e 5f61 7070 6c79 5f64 6173  oat()._apply_das
-00004ff0: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
-00005000: 5f6c 696e 616c 672e 6865 7373 6961 6e5f  _linalg.hessian_
-00005010: 6569 6776 616c 2c20 0d0a 2020 2020 2020  eigval, ..      
-00005020: 2020 2020 2020 635f 6178 6573 3d63 6f6d        c_axes=com
-00005030: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
-00005040: 732c 2073 656c 662e 6178 6573 292c 200d  s, self.axes), .
-00005050: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00005060: 5f61 7869 733d 2d31 2c0d 0a20 2020 2020  _axis=-1,..     
-00005070: 2020 2020 2020 2061 7267 733d 2873 6967         args=(sig
-00005080: 6d61 2c20 7078 7369 7a65 290d 0a20 2020  ma, pxsize)..   
-00005090: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-000050a0: 0d0a 2020 2020 2020 2020 6569 6776 616c  ..        eigval
-000050b0: 3a20 496d 6741 7272 6179 203d 206e 702e  : ImgArray = np.
-000050c0: 6d6f 7665 6178 6973 2865 6967 7661 6c2c  moveaxis(eigval,
-000050d0: 202d 312c 2030 290d 0a20 2020 2020 2020   -1, 0)..       
-000050e0: 200d 0a20 2020 2020 2020 206e 6577 5f61   ..        new_a
-000050f0: 7865 7320 3d20 5b22 6261 7365 225d 202b  xes = ["base"] +
-00005100: 2073 656c 662e 6178 6573 0d0a 2020 2020   self.axes..    
-00005110: 2020 2020 6569 6776 616c 2e5f 7365 745f      eigval._set_
-00005120: 696e 666f 2873 656c 662c 206e 6577 5f61  info(self, new_a
-00005130: 7865 733d 6e65 775f 6178 6573 290d 0a20  xes=new_axes).. 
-00005140: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00005150: 2072 6574 7572 6e20 6569 6776 616c 0d0a   return eigval..
-00005160: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
-00005170: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
-00005180: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
-00005190: 6c5f 6178 6573 0d0a 2020 2020 6465 6620  l_axes..    def 
-000051a0: 6865 7373 6961 6e5f 6569 6728 7365 6c66  hessian_eig(self
-000051b0: 2c20 7369 676d 613a 206e 4446 6c6f 6174  , sigma: nDFloat
-000051c0: 203d 2031 2c20 2a2c 2064 696d 733a 2044   = 1, *, dims: D
-000051d0: 696d 7320 3d20 4e6f 6e65 2920 2d3e 2074  ims = None) -> t
-000051e0: 7570 6c65 5b49 6d67 4172 7261 792c 2049  uple[ImgArray, I
-000051f0: 6d67 4172 7261 795d 3a0d 0a20 2020 2020  mgArray]:..     
-00005200: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00005210: 4361 6c63 756c 6174 6520 4865 7373 6961  Calculate Hessia
-00005220: 6e27 7320 6569 6765 6e76 616c 7565 7320  n's eigenvalues 
-00005230: 616e 6420 6569 6765 6e76 6563 746f 7273  and eigenvectors
-00005240: 2e0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
-00005250: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
-00005260: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-00005270: 2020 2020 207b 7369 676d 617d 7b64 696d       {sigma}{dim
-00005280: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
-00005290: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-000052a0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-000052b0: 496d 6741 7272 6179 2061 6e64 2049 6d67  ImgArray and Img
-000052c0: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
-000052d0: 2020 2041 7272 6179 7320 6f66 2065 6967     Arrays of eig
-000052e0: 656e 7661 6c75 6573 2061 6e64 2065 6967  envalues and eig
-000052f0: 656e 7665 6374 6f72 732e 2054 6865 2061  envectors. The a
-00005300: 7869 7320 6060 2262 6173 6522 6060 2064  xis ``"base"`` d
-00005310: 656e 6f74 6573 2074 6865 2069 6e64 6578  enotes the index
-00005320: 206f 6620 0d0a 2020 2020 2020 2020 2020   of ..          
-00005330: 2020 6569 6765 6e76 616c 7565 732e 206c    eigenvalues. l
-00005340: 3d30 206d 6561 6e73 2074 6865 2073 6d61  =0 means the sma
-00005350: 6c6c 6573 7420 6569 6765 6e76 616c 7565  llest eigenvalue
-00005360: 2e20 6060 2264 696d 2260 6020 6465 6e6f  . ``"dim"`` deno
-00005370: 7465 7320 7468 6520 696e 6465 7820 6f66  tes the index of
-00005380: 0d0a 2020 2020 2020 2020 2020 2020 7370  ..            sp
-00005390: 6174 6961 6c20 6469 6d65 6e73 696f 6e73  atial dimensions
-000053a0: 2e20 466f 7220 3344 2069 6d61 6765 2c20  . For 3D image, 
-000053b0: 6469 6d3d 3020 6d65 616e 7320 7a2d 656c  dim=0 means z-el
-000053c0: 656d 656e 7420 6f66 2061 6e20 6569 6765  ement of an eige
-000053d0: 6e76 6563 746f 722e 0d0a 2020 2020 2020  nvector...      
-000053e0: 2020 2222 2220 2020 2020 2020 2020 2020    """           
-000053f0: 2020 2020 200d 0a20 2020 2020 2020 206e       ..        n
-00005400: 6469 6d20 3d20 6c65 6e28 6469 6d73 290d  dim = len(dims).
-00005410: 0a20 2020 2020 2020 2073 6967 6d61 203d  .        sigma =
-00005420: 2063 6865 636b 5f6e 6428 7369 676d 612c   check_nd(sigma,
-00005430: 206e 6469 6d29 0d0a 2020 2020 2020 2020   ndim)..        
-00005440: 7078 7369 7a65 203d 206e 702e 6172 7261  pxsize = np.arra
-00005450: 7928 5b73 656c 662e 7363 616c 655b 615d  y([self.scale[a]
-00005460: 2066 6f72 2061 2069 6e20 6469 6d73 5d29   for a in dims])
-00005470: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00005480: 2020 2020 6569 6773 203d 2073 656c 662e      eigs = self.
-00005490: 6173 5f66 6c6f 6174 2829 2e5f 6170 706c  as_float()._appl
-000054a0: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
-000054b0: 2020 2020 205f 6c69 6e61 6c67 2e68 6573       _linalg.hes
-000054c0: 7369 616e 5f65 6967 682c 200d 0a20 2020  sian_eigh, ..   
-000054d0: 2020 2020 2020 2020 2063 5f61 7865 733d           c_axes=
-000054e0: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
-000054f0: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
-00005500: 2c0d 0a20 2020 2020 2020 2020 2020 206e  ,..            n
-00005510: 6577 5f61 7869 733d 5b2d 322c 202d 315d  ew_axis=[-2, -1]
-00005520: 2c0d 0a20 2020 2020 2020 2020 2020 2061  ,..            a
-00005530: 7267 733d 2873 6967 6d61 2c20 7078 7369  rgs=(sigma, pxsi
-00005540: 7a65 290d 0a20 2020 2020 2020 2029 0d0a  ze)..        )..
-00005550: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00005560: 2020 6569 6776 616c 2c20 6569 6776 6563    eigval, eigvec
-00005570: 203d 205f 6c69 6e61 6c67 2e65 6967 735f   = _linalg.eigs_
-00005580: 706f 7374 5f70 726f 6365 7373 2865 6967  post_process(eig
-00005590: 732c 2073 656c 662e 6178 6573 2c20 7365  s, self.axes, se
-000055a0: 6c66 290d 0a20 2020 2020 2020 2072 6574  lf)..        ret
-000055b0: 7572 6e20 6569 6776 616c 2c20 6569 6776  urn eigval, eigv
-000055c0: 6563 0d0a 2020 2020 0d0a 2020 2020 405f  ec..    ..    @_
-000055d0: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-000055e0: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-000055f0: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-00005600: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
-00005610: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
-00005620: 2073 7472 7563 7475 7265 5f74 656e 736f   structure_tenso
-00005630: 725f 6569 6776 616c 2873 656c 662c 2073  r_eigval(self, s
-00005640: 6967 6d61 3a20 6e44 466c 6f61 7420 3d20  igma: nDFloat = 
-00005650: 312c 202a 2c20 6469 6d73 3a20 4469 6d73  1, *, dims: Dims
-00005660: 203d 204e 6f6e 6529 202d 3e20 496d 6741   = None) -> ImgA
-00005670: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
-00005680: 2222 0d0a 2020 2020 2020 2020 4361 6c63  ""..        Calc
-00005690: 756c 6174 6520 7374 7275 6374 7572 6520  ulate structure 
-000056a0: 7465 6e73 6f72 2773 2065 6967 656e 7661  tensor's eigenva
-000056b0: 6c75 6573 2061 6e64 2065 6967 656e 7665  lues and eigenve
-000056c0: 6374 6f72 732e 0d0a 0d0a 2020 2020 2020  ctors.....      
-000056d0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-000056e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-000056f0: 0d0a 2020 2020 2020 2020 7b73 6967 6d61  ..        {sigma
-00005700: 7d0d 0a20 2020 2020 2020 207b 6469 6d73  }..        {dims
-00005710: 7d0d 0a0d 0a20 2020 2020 2020 2052 6574  }....        Ret
-00005720: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
-00005730: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
-00005740: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
-00005750: 2020 2020 2041 7272 6179 206f 6620 6569       Array of ei
-00005760: 6765 6e76 616c 7565 732e 2054 6865 2061  genvalues. The a
-00005770: 7869 7320 6060 226c 2260 6020 6465 6e6f  xis ``"l"`` deno
-00005780: 7465 7320 7468 6520 696e 6465 7820 6f66  tes the index of
-00005790: 2065 6967 656e 7661 6c75 6573 2e0d 0a20   eigenvalues... 
-000057a0: 2020 2020 2020 2020 2020 206c 3d30 206d             l=0 m
-000057b0: 6561 6e73 2074 6865 2073 6d61 6c6c 6573  eans the smalles
-000057c0: 7420 6569 6765 6e76 616c 7565 2e0d 0a20  t eigenvalue... 
-000057d0: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-000057e0: 2020 2020 0d0a 2020 2020 2020 2020 6e64      ..        nd
-000057f0: 696d 203d 206c 656e 2864 696d 7329 0d0a  im = len(dims)..
-00005800: 2020 2020 2020 2020 7369 676d 6120 3d20          sigma = 
-00005810: 6368 6563 6b5f 6e64 2873 6967 6d61 2c20  check_nd(sigma, 
-00005820: 6e64 696d 290d 0a20 2020 2020 2020 2070  ndim)..        p
-00005830: 7873 697a 6520 3d20 6e70 2e61 7272 6179  xsize = np.array
-00005840: 285b 7365 6c66 2e73 6361 6c65 5b61 5d20  ([self.scale[a] 
-00005850: 666f 7220 6120 696e 2064 696d 735d 290d  for a in dims]).
-00005860: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00005870: 2020 2065 6967 7661 6c20 3d20 7365 6c66     eigval = self
-00005880: 2e61 735f 666c 6f61 7428 292e 5f61 7070  .as_float()._app
-00005890: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
-000058a0: 2020 2020 2020 5f6c 696e 616c 672e 7374        _linalg.st
-000058b0: 7275 6374 7572 655f 7465 6e73 6f72 5f65  ructure_tensor_e
-000058c0: 6967 7661 6c2c 200d 0a20 2020 2020 2020  igval, ..       
-000058d0: 2020 2020 2063 5f61 7865 733d 636f 6d70       c_axes=comp
-000058e0: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
-000058f0: 2c20 7365 6c66 2e61 7865 7329 2c20 0d0a  , self.axes), ..
-00005900: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00005910: 6178 6973 3d2d 312c 0d0a 2020 2020 2020  axis=-1,..      
-00005920: 2020 2020 2020 6172 6773 3d28 7369 676d        args=(sigm
-00005930: 612c 2070 7873 697a 6529 2c0d 0a20 2020  a, pxsize),..   
-00005940: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00005950: 0d0a 2020 2020 2020 2020 6e65 775f 6178  ..        new_ax
-00005960: 6573 203d 205b 2262 6173 6522 5d20 2b20  es = ["base"] + 
-00005970: 7365 6c66 2e61 7865 730d 0a20 2020 2020  self.axes..     
-00005980: 2020 2065 6967 7661 6c2e 5f73 6574 5f69     eigval._set_i
-00005990: 6e66 6f28 7365 6c66 2c20 6e65 775f 6178  nfo(self, new_ax
-000059a0: 6573 3d6e 6577 5f61 7865 7329 0d0a 2020  es=new_axes)..  
-000059b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000059c0: 7265 7475 726e 2065 6967 7661 6c0d 0a20  return eigval.. 
-000059d0: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
-000059e0: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
-000059f0: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-00005a00: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
-00005a10: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-00005a20: 7574 0d0a 2020 2020 6465 6620 7374 7275  ut..    def stru
-00005a30: 6374 7572 655f 7465 6e73 6f72 5f65 6967  cture_tensor_eig
-00005a40: 2873 656c 662c 2073 6967 6d61 3a20 6e44  (self, sigma: nD
-00005a50: 466c 6f61 7420 3d20 312c 202a 2c20 6469  Float = 1, *, di
-00005a60: 6d73 3a20 4469 6d73 203d 204e 6f6e 6529  ms: Dims = None)
-00005a70: 2d3e 2074 7570 6c65 5b49 6d67 4172 7261  -> tuple[ImgArra
-00005a80: 792c 2049 6d67 4172 7261 795d 3a0d 0a20  y, ImgArray]:.. 
-00005a90: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00005aa0: 2020 2020 4361 6c63 756c 6174 6520 7374      Calculate st
-00005ab0: 7275 6374 7572 6520 7465 6e73 6f72 2773  ructure tensor's
-00005ac0: 2065 6967 656e 7661 6c75 6573 2061 6e64   eigenvalues and
-00005ad0: 2065 6967 656e 7665 6374 6f72 732e 0d0a   eigenvectors...
-00005ae0: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00005af0: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00005b00: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00005b10: 2020 7b73 6967 6d61 7d0d 0a20 2020 2020    {sigma}..     
-00005b20: 2020 207b 6469 6d73 7d0d 0a0d 0a20 2020     {dims}....   
-00005b30: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-00005b40: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-00005b50: 2020 2020 2020 2049 6d67 4172 7261 7920         ImgArray 
-00005b60: 616e 6420 496d 6741 7272 6179 0d0a 2020  and ImgArray..  
-00005b70: 2020 2020 2020 2020 2020 4172 7261 7973            Arrays
-00005b80: 206f 6620 6569 6765 6e76 616c 7565 7320   of eigenvalues 
-00005b90: 616e 6420 6569 6765 6e76 6563 746f 7273  and eigenvectors
-00005ba0: 2e20 5468 6520 6178 6973 2060 6022 6c22  . The axis ``"l"
-00005bb0: 6060 2064 656e 6f74 6573 2074 6865 2069  `` denotes the i
-00005bc0: 6e64 6578 206f 6620 0d0a 2020 2020 2020  ndex of ..      
-00005bd0: 2020 2020 2020 6569 6765 6e76 616c 7565        eigenvalue
-00005be0: 732e 206c 3d30 206d 6561 6e73 2074 6865  s. l=0 means the
-00005bf0: 2073 6d61 6c6c 6573 7420 6569 6765 6e76   smallest eigenv
-00005c00: 616c 7565 2e20 6060 2272 2260 6020 6465  alue. ``"r"`` de
-00005c10: 6e6f 7465 7320 7468 6520 696e 6465 7820  notes the index 
-00005c20: 6f66 0d0a 2020 2020 2020 2020 2020 2020  of..            
-00005c30: 7370 6174 6961 6c20 6469 6d65 6e73 696f  spatial dimensio
-00005c40: 6e73 2e20 466f 7220 3344 2069 6d61 6765  ns. For 3D image
-00005c50: 2c20 723d 3020 6d65 616e 7320 7a2d 656c  , r=0 means z-el
-00005c60: 656d 656e 7420 6f66 2061 6e20 6569 6765  ement of an eige
-00005c70: 6e76 6563 746f 722e 0d0a 2020 2020 2020  nvector...      
-00005c80: 2020 2222 2220 2020 2020 2020 2020 2020    """           
-00005c90: 2020 2020 200d 0a20 2020 2020 2020 206e       ..        n
-00005ca0: 6469 6d20 3d20 6c65 6e28 6469 6d73 290d  dim = len(dims).
-00005cb0: 0a20 2020 2020 2020 2073 6967 6d61 203d  .        sigma =
-00005cc0: 2063 6865 636b 5f6e 6428 7369 676d 612c   check_nd(sigma,
-00005cd0: 206e 6469 6d29 0d0a 2020 2020 2020 2020   ndim)..        
-00005ce0: 7078 7369 7a65 203d 206e 702e 6172 7261  pxsize = np.arra
-00005cf0: 7928 5b73 656c 662e 7363 616c 655b 615d  y([self.scale[a]
-00005d00: 2066 6f72 2061 2069 6e20 6469 6d73 5d29   for a in dims])
-00005d10: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00005d20: 2020 2020 6569 6773 203d 2073 656c 662e      eigs = self.
-00005d30: 6173 5f66 6c6f 6174 2829 2e5f 6170 706c  as_float()._appl
-00005d40: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
-00005d50: 2020 2020 205f 6c69 6e61 6c67 2e73 7472       _linalg.str
-00005d60: 7563 7475 7265 5f74 656e 736f 725f 6569  ucture_tensor_ei
-00005d70: 6768 2c0d 0a20 2020 2020 2020 2020 2020  gh,..           
-00005d80: 2063 5f61 7865 733d 636f 6d70 6c65 6d65   c_axes=compleme
-00005d90: 6e74 5f61 7865 7328 6469 6d73 2c20 7365  nt_axes(dims, se
-00005da0: 6c66 2e61 7865 7329 2c0d 0a20 2020 2020  lf.axes),..     
-00005db0: 2020 2020 2020 206e 6577 5f61 7869 733d         new_axis=
-00005dc0: 5b2d 322c 202d 315d 2c0d 0a20 2020 2020  [-2, -1],..     
-00005dd0: 2020 2020 2020 2061 7267 733d 2873 6967         args=(sig
-00005de0: 6d61 2c20 7078 7369 7a65 290d 0a20 2020  ma, pxsize)..   
-00005df0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00005e00: 0d0a 2020 2020 2020 2020 6569 6776 616c  ..        eigval
-00005e10: 2c20 6569 6776 6563 203d 205f 6c69 6e61  , eigvec = _lina
-00005e20: 6c67 2e65 6967 735f 706f 7374 5f70 726f  lg.eigs_post_pro
-00005e30: 6365 7373 2865 6967 732c 2073 656c 662e  cess(eigs, self.
-00005e40: 6178 6573 2c20 7365 6c66 290d 0a0d 0a20  axes, self).... 
-00005e50: 2020 2020 2020 2072 6574 7572 6e20 6569         return ei
-00005e60: 6776 616c 2c20 6569 6776 6563 0d0a 2020  gval, eigvec..  
-00005e70: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
-00005e80: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
-00005e90: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
-00005ea0: 6178 6573 0d0a 2020 2020 4073 616d 655f  axes..    @same_
-00005eb0: 6474 7970 6528 6173 666c 6f61 743d 5472  dtype(asfloat=Tr
-00005ec0: 7565 290d 0a20 2020 2040 6368 6563 6b5f  ue)..    @check_
-00005ed0: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
-00005ee0: 0d0a 2020 2020 6465 6620 6564 6765 5f66  ..    def edge_f
-00005ef0: 696c 7465 7228 0d0a 2020 2020 2020 2020  ilter(..        
-00005f00: 7365 6c66 2c0d 0a20 2020 2020 2020 206d  self,..        m
-00005f10: 6574 686f 643a 2073 7472 203d 2022 736f  ethod: str = "so
-00005f20: 6265 6c22 2c0d 0a20 2020 2020 2020 202a  bel",..        *
-00005f30: 2c0d 0a20 2020 2020 2020 2064 696d 733a  ,..        dims:
-00005f40: 2044 696d 7320 3d20 4e6f 6e65 2c0d 0a20   Dims = None,.. 
-00005f50: 2020 2020 2020 2075 7064 6174 653a 2062         update: b
-00005f60: 6f6f 6c20 3d20 4661 6c73 650d 0a20 2020  ool = False..   
-00005f70: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
-00005f80: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00005f90: 2020 2020 2020 536f 6265 6c20 6669 6c74        Sobel filt
-00005fa0: 6572 2e20 5468 6973 2066 696c 7465 7220  er. This filter 
-00005fb0: 6973 2075 7365 6675 6c20 666f 7220 6564  is useful for ed
-00005fc0: 6765 2064 6574 6563 7469 6f6e 2e0d 0a0d  ge detection....
-00005fd0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00005fe0: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-00005ff0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-00006000: 206d 6574 686f 6420 3a20 7374 722c 207b   method : str, {
-00006010: 2273 6f62 656c 222c 2022 6661 7269 6422  "sobel", "farid"
-00006020: 2c20 2273 6368 6172 7222 2c20 2270 7265  , "scharr", "pre
-00006030: 7769 7474 227d 2c20 6465 6661 756c 7420  witt"}, default 
-00006040: 6973 2022 736f 6265 6c22 0d0a 2020 2020  is "sobel"..    
-00006050: 2020 2020 2020 2020 4564 6765 206f 7065          Edge ope
-00006060: 7261 746f 7220 6e61 6d65 2e0d 0a20 2020  rator name...   
-00006070: 2020 2020 207b 6469 6d73 7d7b 7570 6461       {dims}{upda
-00006080: 7465 7d0d 0a0d 0a20 2020 2020 2020 2052  te}....        R
-00006090: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-000060a0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-000060b0: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
-000060c0: 2020 2020 2020 2046 696c 7465 7265 6420         Filtered 
-000060d0: 696d 6167 652e 0d0a 2020 2020 2020 2020  image...        
-000060e0: 2222 2220 2020 2020 2020 200d 0a20 2020  """        ..   
-000060f0: 2020 2020 2023 2047 6574 206f 7065 7261       # Get opera
-00006100: 746f 720d 0a20 2020 2020 2020 206d 6574  tor..        met
-00006110: 686f 645f 6469 6374 203d 207b 2273 6f62  hod_dict = {"sob
-00006120: 656c 223a 2073 6b66 696c 2e73 6f62 656c  el": skfil.sobel
-00006130: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00006140: 2020 2020 2020 2020 2020 2266 6172 6964            "farid
-00006150: 223a 2073 6b66 696c 2e66 6172 6964 2c0d  ": skfil.farid,.
-00006160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006170: 2020 2020 2020 2020 2273 6368 6172 7222          "scharr"
-00006180: 3a20 736b 6669 6c2e 7363 6861 7272 2c0d  : skfil.scharr,.
-00006190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000061a0: 2020 2020 2020 2020 2270 7265 7769 7474          "prewitt
-000061b0: 223a 2073 6b66 696c 2e70 7265 7769 7474  ": skfil.prewitt
-000061c0: 7d0d 0a20 2020 2020 2020 2074 7279 3a0d  }..        try:.
-000061d0: 0a20 2020 2020 2020 2020 2020 2066 203d  .            f =
-000061e0: 206d 6574 686f 645f 6469 6374 5b6d 6574   method_dict[met
-000061f0: 686f 645d 0d0a 2020 2020 2020 2020 6578  hod]..        ex
-00006200: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
-00006210: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006220: 6520 5661 6c75 6545 7272 6f72 2822 606d  e ValueError("`m
-00006230: 6574 686f 6460 206d 7573 7420 6265 2027  ethod` must be '
-00006240: 736f 6265 6c27 2c20 2766 6172 6964 2720  sobel', 'farid' 
-00006250: 2773 6368 6172 7227 2c20 6f72 2027 7072  'scharr', or 'pr
-00006260: 6577 6974 7427 2e22 290d 0a20 2020 2020  ewitt'.")..     
-00006270: 2020 200d 0a20 2020 2020 2020 2072 6574     ..        ret
-00006280: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
-00006290: 6461 736b 2866 2c20 635f 6178 6573 3d63  dask(f, c_axes=c
-000062a0: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
-000062b0: 696d 732c 2073 656c 662e 6178 6573 2929  ims, self.axes))
-000062c0: 0d0a 2020 2020 0d0a 2020 2020 405f 646f  ..    ..    @_do
-000062d0: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
-000062e0: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
-000062f0: 6961 6c5f 6178 6573 0d0a 2020 2020 4073  ial_axes..    @s
-00006300: 616d 655f 6474 7970 6528 6173 666c 6f61  ame_dtype(asfloa
-00006310: 743d 5472 7565 290d 0a20 2020 2040 6368  t=True)..    @ch
-00006320: 6563 6b5f 696e 7075 745f 616e 645f 6f75  eck_input_and_ou
-00006330: 7470 7574 0d0a 2020 2020 6465 6620 6c6f  tput..    def lo
-00006340: 7770 6173 735f 6669 6c74 6572 280d 0a20  wpass_filter(.. 
-00006350: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
-00006360: 2020 2020 2020 6375 746f 6666 3a20 6e44        cutoff: nD
-00006370: 466c 6f61 7420 3d20 302e 322c 0d0a 2020  Float = 0.2,..  
-00006380: 2020 2020 2020 6f72 6465 723a 2066 6c6f        order: flo
-00006390: 6174 203d 2032 2c0d 0a20 2020 2020 2020  at = 2,..       
-000063a0: 202a 2c20 0d0a 2020 2020 2020 2020 6469   *, ..        di
-000063b0: 6d73 3a20 4469 6d73 203d 204e 6f6e 652c  ms: Dims = None,
-000063c0: 200d 0a20 2020 2020 2020 2075 7064 6174   ..        updat
-000063d0: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
-000063e0: 0d0a 2020 2020 2920 2d3e 2049 6d67 4172  ..    ) -> ImgAr
-000063f0: 7261 793a 0d0a 2020 2020 2020 2020 2222  ray:..        ""
-00006400: 220d 0a20 2020 2020 2020 2042 7574 7465  "..        Butte
-00006410: 7277 6f72 7468 206c 6f77 2d70 6173 7320  rworth low-pass 
-00006420: 6669 6c74 6572 2e0d 0a0d 0a20 2020 2020  filter.....     
-00006430: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-00006440: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00006450: 2d0d 0a20 2020 2020 2020 2063 7574 6f66  -..        cutof
-00006460: 6620 3a20 666c 6f61 7420 6f72 2061 7272  f : float or arr
-00006470: 6179 2d6c 696b 652c 2064 6566 6175 6c74  ay-like, default
-00006480: 2069 7320 302e 320d 0a20 2020 2020 2020   is 0.2..       
-00006490: 2020 2020 2043 7574 6f66 6620 6672 6571       Cutoff freq
-000064a0: 7565 6e63 792e 0d0a 2020 2020 2020 2020  uency...        
-000064b0: 6f72 6465 7220 3a20 666c 6f61 742c 2064  order : float, d
-000064c0: 6566 6175 6c74 2069 7320 320d 0a20 2020  efault is 2..   
-000064d0: 2020 2020 2020 2020 2053 7465 6570 6e65           Steepne
-000064e0: 7373 206f 6620 6375 746f 6666 2e0d 0a20  ss of cutoff... 
-000064f0: 2020 2020 2020 207b 6469 6d73 7d7b 7570         {dims}{up
-00006500: 6461 7465 7d0d 0a0d 0a20 2020 2020 2020  date}....       
-00006510: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
-00006520: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
-00006530: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
-00006540: 2020 2020 2020 2020 2046 696c 7465 7265           Filtere
-00006550: 6420 696d 6167 650d 0a20 2020 2020 2020  d image..       
-00006560: 2022 2222 2020 2020 2020 2020 200d 0a20   """         .. 
-00006570: 2020 2020 2020 2066 726f 6d20 2e5f 7574         from ._ut
-00006580: 696c 732e 5f73 6b69 6d61 6765 2069 6d70  ils._skimage imp
-00006590: 6f72 7420 5f67 6574 5f4e 445f 6275 7474  ort _get_ND_butt
-000065a0: 6572 776f 7274 685f 6669 6c74 6572 0d0a  erworth_filter..
-000065b0: 2020 2020 2020 2020 6e64 696d 7320 3d20          ndims = 
-000065c0: 6c65 6e28 6469 6d73 290d 0a20 2020 2020  len(dims)..     
-000065d0: 2020 2063 7574 6f66 6620 3d20 6368 6563     cutoff = chec
-000065e0: 6b5f 6e64 2863 7574 6f66 662c 206e 6469  k_nd(cutoff, ndi
-000065f0: 6d73 290d 0a20 2020 2020 2020 2069 6620  ms)..        if 
-00006600: 616c 6c28 2863 203e 3d20 302e 352a 6e70  all((c >= 0.5*np
-00006610: 2e73 7172 7428 6e64 696d 7329 206f 7220  .sqrt(ndims) or 
-00006620: 6320 3c3d 2030 2920 666f 7220 6320 696e  c <= 0) for c in
-00006630: 2063 7574 6f66 6629 3a0d 0a20 2020 2020   cutoff):..     
-00006640: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00006650: 6c66 0d0a 2020 2020 2020 2020 7370 6174  lf..        spat
-00006660: 6961 6c5f 7368 6170 6520 3d20 7365 6c66  ial_shape = self
-00006670: 2e73 697a 6573 6f66 2864 696d 7329 0d0a  .sizesof(dims)..
-00006680: 2020 2020 2020 2020 7370 6174 6961 6c5f          spatial_
-00006690: 6178 6573 203d 205b 7365 6c66 2e61 7869  axes = [self.axi
-000066a0: 736f 6628 6129 2066 6f72 2061 2069 6e20  sof(a) for a in 
-000066b0: 6469 6d73 5d0d 0a20 2020 2020 2020 2077  dims]..        w
-000066c0: 6569 6768 7420 3d20 5f67 6574 5f4e 445f  eight = _get_ND_
-000066d0: 6275 7474 6572 776f 7274 685f 6669 6c74  butterworth_filt
-000066e0: 6572 2873 7061 7469 616c 5f73 6861 7065  er(spatial_shape
-000066f0: 2c20 6375 746f 6666 2c20 6f72 6465 722c  , cutoff, order,
-00006700: 2046 616c 7365 2c20 5472 7565 290d 0a20   False, True).. 
-00006710: 2020 2020 2020 2069 6e70 7574 203d 2078         input = x
-00006720: 702e 6173 6172 7261 7928 7365 6c66 2e76  p.asarray(self.v
-00006730: 616c 7565 290d 0a20 2020 2020 2020 2069  alue)..        i
-00006740: 6620 6c65 6e28 6469 6d73 2920 3c20 7365  f len(dims) < se
-00006750: 6c66 2e6e 6469 6d3a 0d0a 2020 2020 2020  lf.ndim:..      
-00006760: 2020 2020 2020 7765 6967 6874 203d 2061        weight = a
-00006770: 6464 5f61 7865 7328 7365 6c66 2e61 7865  dd_axes(self.axe
-00006780: 732c 2073 656c 662e 7368 6170 652c 2077  s, self.shape, w
-00006790: 6569 6768 742c 2064 696d 7329 0d0a 2020  eight, dims)..  
-000067a0: 2020 2020 2020 6f75 7420 3d20 7870 2e66        out = xp.f
-000067b0: 6674 2e69 7266 6674 6e28 0d0a 2020 2020  ft.irfftn(..    
-000067c0: 2020 2020 2020 2020 7870 2e61 7361 7272          xp.asarr
-000067d0: 6179 2877 6569 6768 7429 202a 2078 702e  ay(weight) * xp.
-000067e0: 6666 742e 7266 6674 6e28 696e 7075 742c  fft.rfftn(input,
-000067f0: 2061 7865 733d 7370 6174 6961 6c5f 6178   axes=spatial_ax
-00006800: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
-00006810: 2020 2073 3d73 7061 7469 616c 5f73 6861     s=spatial_sha
-00006820: 7065 2c20 0d0a 2020 2020 2020 2020 2020  pe, ..          
-00006830: 2020 6178 6573 3d73 7061 7469 616c 5f61    axes=spatial_a
-00006840: 7865 732c 0d0a 2020 2020 2020 2020 290d  xes,..        ).
-00006850: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006860: 7870 2e61 736e 756d 7079 286f 7574 290d  xp.asnumpy(out).
-00006870: 0a20 2020 200d 0a20 2020 2040 5f64 6f63  .    ..    @_doc
-00006880: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
-00006890: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
-000068a0: 616c 5f61 7865 730d 0a20 2020 2040 7361  al_axes..    @sa
-000068b0: 6d65 5f64 7479 7065 2861 7366 6c6f 6174  me_dtype(asfloat
-000068c0: 3d54 7275 6529 0d0a 2020 2020 4063 6865  =True)..    @che
-000068d0: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
-000068e0: 7075 740d 0a20 2020 2064 6566 206c 6f77  put..    def low
-000068f0: 7061 7373 5f63 6f6e 765f 6669 6c74 6572  pass_conv_filter
-00006900: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
-00006910: 0d0a 2020 2020 2020 2020 6375 746f 6666  ..        cutoff
-00006920: 3a20 6e44 466c 6f61 7420 3d20 302e 322c  : nDFloat = 0.2,
-00006930: 0d0a 2020 2020 2020 2020 6f72 6465 723a  ..        order:
-00006940: 2066 6c6f 6174 203d 2032 2c0d 0a20 2020   float = 2,..   
-00006950: 2020 2020 202a 2c20 0d0a 2020 2020 2020       *, ..      
-00006960: 2020 6469 6d73 3a20 4469 6d73 203d 204e    dims: Dims = N
-00006970: 6f6e 652c 0d0a 2020 2020 2020 2020 7570  one,..        up
-00006980: 6461 7465 3a20 626f 6f6c 203d 2046 616c  date: bool = Fal
-00006990: 7365 0d0a 2020 2020 2920 2d3e 2049 6d67  se..    ) -> Img
-000069a0: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
-000069b0: 2222 220d 0a20 2020 2020 2020 2042 7574  """..        But
-000069c0: 7465 7277 6f72 7468 206c 6f77 2d70 6173  terworth low-pas
-000069d0: 7320 6669 6c74 6572 2069 6e20 7265 616c  s filter in real
-000069e0: 2073 7061 6365 2e20 4275 7474 6572 776f   space. Butterwo
-000069f0: 7274 6820 6b65 726e 656c 2069 7320 6372  rth kernel is cr
-00006a00: 6561 7465 6420 6669 7273 7420 7573 696e  eated first usin
-00006a10: 6720 696e 7665 7273 650d 0a20 2020 2020  g inverse..     
-00006a20: 2020 2046 6f75 7269 6572 2074 7261 6e73     Fourier trans
-00006a30: 666f 726d 206f 6620 7765 6967 6874 2066  form of weight f
-00006a40: 756e 6374 696f 6e2e 0d0a 0d0a 2020 2020  unction.....    
-00006a50: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-00006a60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00006a70: 2d2d 0d0a 2020 2020 2020 2020 6375 746f  --..        cuto
-00006a80: 6666 203a 2066 6c6f 6174 206f 7220 6172  ff : float or ar
-00006a90: 7261 792d 6c69 6b65 2c20 6465 6661 756c  ray-like, defaul
-00006aa0: 7420 6973 2030 2e32 0d0a 2020 2020 2020  t is 0.2..      
-00006ab0: 2020 2020 2020 4375 746f 6666 2066 7265        Cutoff fre
-00006ac0: 7175 656e 6379 2e0d 0a20 2020 2020 2020  quency...       
-00006ad0: 206f 7264 6572 203a 2066 6c6f 6174 2c20   order : float, 
-00006ae0: 6465 6661 756c 7420 6973 2032 0d0a 2020  default is 2..  
-00006af0: 2020 2020 2020 2020 2020 5374 6565 706e            Steepn
-00006b00: 6573 7320 6f66 2063 7574 6f66 662e 0d0a  ess of cutoff...
-00006b10: 2020 2020 2020 2020 7b64 696d 737d 7b75          {dims}{u
-00006b20: 7064 6174 657d 0d0a 0d0a 2020 2020 2020  pdate}....      
-00006b30: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00006b40: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00006b50: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
-00006b60: 2020 2020 2020 2020 2020 4669 6c74 6572            Filter
-00006b70: 6564 2069 6d61 6765 0d0a 2020 2020 2020  ed image..      
-00006b80: 2020 2222 2220 2020 2020 2020 0d0a 2020    """       ..  
-00006b90: 2020 2020 2020 6672 6f6d 202e 5f75 7469        from ._uti
-00006ba0: 6c73 2e5f 736b 696d 6167 6520 696d 706f  ls._skimage impo
-00006bb0: 7274 205f 6765 745f 4e44 5f62 7574 7465  rt _get_ND_butte
-00006bc0: 7277 6f72 7468 5f66 696c 7465 720d 0a20  rworth_filter.. 
-00006bd0: 2020 2020 2020 206e 6469 6d73 203d 206c         ndims = l
-00006be0: 656e 2864 696d 7329 0d0a 2020 2020 2020  en(dims)..      
-00006bf0: 2020 6375 746f 6666 203d 2063 6865 636b    cutoff = check
-00006c00: 5f6e 6428 6375 746f 6666 2c20 6e64 696d  _nd(cutoff, ndim
-00006c10: 7329 0d0a 2020 2020 2020 2020 6966 2061  s)..        if a
-00006c20: 6c6c 2828 6320 3e3d 2030 2e35 2a6e 702e  ll((c >= 0.5*np.
-00006c30: 7371 7274 286e 6469 6d73 2920 6f72 2063  sqrt(ndims) or c
-00006c40: 203c 3d20 3029 2066 6f72 2063 2069 6e20   <= 0) for c in 
-00006c50: 6375 746f 6666 293a 0d0a 2020 2020 2020  cutoff):..      
-00006c60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00006c70: 660d 0a20 2020 2020 2020 2073 7061 7469  f..        spati
-00006c80: 616c 5f73 6861 7065 203d 2073 656c 662e  al_shape = self.
-00006c90: 7369 7a65 736f 6628 6469 6d73 290d 0a20  sizesof(dims).. 
-00006ca0: 2020 2020 2020 2077 6569 6768 7420 3d20         weight = 
-00006cb0: 5f67 6574 5f4e 445f 6275 7474 6572 776f  _get_ND_butterwo
-00006cc0: 7274 685f 6669 6c74 6572 2873 7061 7469  rth_filter(spati
-00006cd0: 616c 5f73 6861 7065 2c20 6375 746f 6666  al_shape, cutoff
-00006ce0: 2c20 6f72 6465 722c 2046 616c 7365 2c20  , order, False, 
-00006cf0: 5472 7565 290d 0a20 2020 2020 2020 206b  True)..        k
-00006d00: 6572 5f61 6c6c 203d 2078 702e 6173 6e75  er_all = xp.asnu
-00006d10: 6d70 7928 7870 2e66 6674 2e69 7266 6674  mpy(xp.fft.irfft
-00006d20: 6e28 7870 2e61 7361 7272 6179 2877 6569  n(xp.asarray(wei
-00006d30: 6768 7429 2c20 733d 7370 6174 6961 6c5f  ght), s=spatial_
-00006d40: 7368 6170 6529 290d 0a20 2020 2020 2020  shape))..       
-00006d50: 206b 6572 5f61 6c6c 203d 206e 702e 6666   ker_all = np.ff
-00006d60: 742e 6666 7473 6869 6674 286b 6572 5f61  t.fftshift(ker_a
-00006d70: 6c6c 290d 0a20 2020 2020 2020 2073 6c20  ll)..        sl 
-00006d80: 3d20 5b5d 0d0a 2020 2020 2020 2020 666f  = []..        fo
-00006d90: 7220 732c 2063 2069 6e20 7a69 7028 7370  r s, c in zip(sp
-00006da0: 6174 6961 6c5f 7368 6170 652c 2063 7574  atial_shape, cut
-00006db0: 6f66 6629 3a0d 0a20 2020 2020 2020 2020  off):..         
-00006dc0: 2020 2072 6164 6975 7320 3d20 696e 7428     radius = int(
-00006dd0: 6d69 6e28 312f 632c 2031 3129 290d 0a20  min(1/c, 11)).. 
-00006de0: 2020 2020 2020 2020 2020 2073 6c2e 6170             sl.ap
-00006df0: 7065 6e64 2873 6c69 6365 2873 2f2f 3220  pend(slice(s//2 
-00006e00: 2d20 7261 6469 7573 2c20 732f 2f32 202b  - radius, s//2 +
-00006e10: 2072 6164 6975 7320 2b20 3129 290d 0a20   radius + 1)).. 
-00006e20: 2020 2020 2020 206b 6572 203d 206b 6572         ker = ker
-00006e30: 5f61 6c6c 5b74 7570 6c65 2873 6c29 5d0d  _all[tuple(sl)].
-00006e40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006e50: 7365 6c66 2e63 6f6e 766f 6c76 6528 6b65  self.convolve(ke
-00006e60: 7229 0d0a 2020 2020 0d0a 2020 2020 405f  r)..    ..    @_
-00006e70: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-00006e80: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-00006e90: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-00006ea0: 4073 616d 655f 6474 7970 6528 6173 666c  @same_dtype(asfl
-00006eb0: 6f61 743d 5472 7565 290d 0a20 2020 2040  oat=True)..    @
-00006ec0: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
-00006ed0: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
-00006ee0: 7469 6c65 645f 6c6f 7770 6173 735f 6669  tiled_lowpass_fi
-00006ef0: 6c74 6572 280d 0a20 2020 2020 2020 2073  lter(..        s
-00006f00: 656c 662c 0d0a 2020 2020 2020 2020 6375  elf,..        cu
-00006f10: 746f 6666 3a20 666c 6f61 7420 3d20 302e  toff: float = 0.
-00006f20: 322c 0d0a 2020 2020 2020 2020 6368 756e  2,..        chun
-00006f30: 6b73 203d 2022 6175 746f 222c 0d0a 2020  ks = "auto",..  
-00006f40: 2020 2020 2020 6f72 6465 723a 2069 6e74        order: int
-00006f50: 203d 2032 2c20 0d0a 2020 2020 2020 2020   = 2, ..        
-00006f60: 6f76 6572 6c61 703a 2069 6e74 203d 2031  overlap: int = 1
-00006f70: 362c 0d0a 2020 2020 2020 2020 2a2c 0d0a  6,..        *,..
-00006f80: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
-00006f90: 6d73 203d 204e 6f6e 652c 0d0a 2020 2020  ms = None,..    
-00006fa0: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
-00006fb0: 203d 2046 616c 7365 0d0a 2020 2020 2920   = False..    ) 
-00006fc0: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
-00006fd0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00006fe0: 2020 2054 696c 652d 6279 2d74 696c 6520     Tile-by-tile 
-00006ff0: 4275 7474 6572 776f 7274 6820 6c6f 772d  Butterworth low-
-00007000: 7061 7373 2066 696c 7465 722e 2054 6869  pass filter. Thi
-00007010: 7320 6d65 7468 6f64 2069 7320 616e 2061  s method is an a
-00007020: 7070 726f 7869 6d61 7469 6f6e 206f 6620  pproximation of 
-00007030: 7468 6520 7374 616e 6461 7264 0d0a 2020  the standard..  
-00007040: 2020 2020 2020 6c6f 772d 7061 7373 2066        low-pass f
-00007050: 696c 7465 722c 2077 6869 6368 2077 6f75  ilter, which wou
-00007060: 6c64 2062 6520 7573 6566 756c 2077 6865  ld be useful whe
-00007070: 6e20 7468 6520 696d 6167 6520 6973 206c  n the image is l
-00007080: 6172 6765 2e0d 0a0d 0a20 2020 2020 2020  arge.....       
-00007090: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
-000070a0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
-000070b0: 0a20 2020 2020 2020 2063 7574 6f66 6620  .        cutoff 
-000070c0: 3a20 666c 6f61 7420 6f72 2061 7272 6179  : float or array
-000070d0: 2d6c 696b 652c 2064 6566 6175 6c74 2069  -like, default i
-000070e0: 7320 302e 320d 0a20 2020 2020 2020 2020  s 0.2..         
-000070f0: 2020 2043 7574 6f66 6620 6672 6571 7565     Cutoff freque
-00007100: 6e63 792e 0d0a 2020 2020 2020 2020 6368  ncy...        ch
-00007110: 756e 6b73 203a 2073 7472 206f 7220 7365  unks : str or se
-00007120: 7175 656e 6365 206f 6620 696e 740d 0a20  quence of int.. 
-00007130: 2020 2020 2020 2020 2020 2043 6875 6e6b             Chunk
-00007140: 2073 697a 6520 6f66 2065 6163 6820 6c6f   size of each lo
-00007150: 7770 6173 7320 6669 6c74 6572 2074 6173  wpass filter tas
-00007160: 6b2e 0d0a 2020 2020 2020 2020 6f72 6465  k...        orde
-00007170: 7220 3a20 666c 6f61 742c 2064 6566 6175  r : float, defau
-00007180: 6c74 2069 7320 320d 0a20 2020 2020 2020  lt is 2..       
-00007190: 2020 2020 2053 7465 6570 6e65 7373 206f       Steepness o
-000071a0: 6620 6375 746f 6666 2e0d 0a20 2020 2020  f cutoff...     
-000071b0: 2020 206f 7665 726c 6170 203a 2069 6e74     overlap : int
-000071c0: 2c20 6465 6661 756c 7420 6973 2031 360d  , default is 16.
-000071d0: 0a20 2020 2020 2020 2020 2020 204f 7665  .            Ove
-000071e0: 726c 6170 7069 6e67 2070 6978 656c 7320  rlapping pixels 
-000071f0: 6174 2074 6865 2065 6467 6573 206f 6620  at the edges of 
-00007200: 7469 6c65 732e 0d0a 2020 2020 2020 2020  tiles...        
-00007210: 7b64 696d 737d 7b75 7064 6174 657d 0d0a  {dims}{update}..
-00007220: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00007230: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-00007240: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
-00007250: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
-00007260: 2020 4669 6c74 6572 6564 2069 6d61 6765    Filtered image
-00007270: 2e0d 0a20 2020 2020 2020 2022 2222 2020  ...        """  
-00007280: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00007290: 6966 2064 696d 7320 213d 2073 656c 662e  if dims != self.
-000072a0: 6178 6573 3a0d 0a20 2020 2020 2020 2020  axes:..         
-000072b0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-000072c0: 656d 656e 7465 6445 7272 6f72 2822 6261  ementedError("ba
-000072d0: 7463 6820 7072 6f63 6573 7369 6e67 206e  tch processing n
-000072e0: 6f74 2069 6d70 6c65 6d65 6e74 6564 2079  ot implemented y
-000072f0: 6574 2e22 290d 0a20 2020 2020 2020 2066  et.")..        f
-00007300: 726f 6d20 2e5f 7574 696c 732e 5f73 6b69  rom ._utils._ski
-00007310: 6d61 6765 2069 6d70 6f72 7420 5f67 6574  mage import _get
-00007320: 5f4e 445f 6275 7474 6572 776f 7274 685f  _ND_butterworth_
-00007330: 6669 6c74 6572 0d0a 2020 2020 2020 2020  filter..        
-00007340: 6672 6f6d 2064 6173 6b20 696d 706f 7274  from dask import
-00007350: 2061 7272 6179 2061 7320 6461 0d0a 0d0a   array as da....
-00007360: 2020 2020 2020 2020 6e64 696d 7320 3d20          ndims = 
-00007370: 6c65 6e28 6469 6d73 290d 0a20 2020 2020  len(dims)..     
-00007380: 2020 2063 7574 6f66 6620 3d20 6368 6563     cutoff = chec
-00007390: 6b5f 6e64 2863 7574 6f66 662c 206e 6469  k_nd(cutoff, ndi
-000073a0: 6d73 290d 0a20 2020 2020 2020 2069 6620  ms)..        if 
-000073b0: 616c 6c28 2863 203e 3d20 302e 352a 6e70  all((c >= 0.5*np
-000073c0: 2e73 7172 7428 6e64 696d 7329 206f 7220  .sqrt(ndims) or 
-000073d0: 6320 3c3d 2030 2920 666f 7220 6320 696e  c <= 0) for c in
-000073e0: 2063 7574 6f66 6629 3a0d 0a20 2020 2020   cutoff):..     
-000073f0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00007400: 6c66 0d0a 2020 2020 2020 2020 0d0a 2020  lf..        ..  
-00007410: 2020 2020 2020 6465 7074 6820 3d20 7377        depth = sw
-00007420: 6974 6368 5f73 6c69 6365 2864 696d 732c  itch_slice(dims,
-00007430: 2073 656c 662e 6178 6573 2c20 6f76 6572   self.axes, over
-00007440: 6c61 702c 2030 290d 0a20 2020 2020 2020  lap, 0)..       
-00007450: 200d 0a20 2020 2020 2020 2064 6566 2066   ..        def f
-00007460: 756e 6328 6172 7229 3a0d 0a20 2020 2020  unc(arr):..     
-00007470: 2020 2020 2020 2061 7272 203d 2078 702e         arr = xp.
-00007480: 6173 6172 7261 7928 6172 7229 0d0a 2020  asarray(arr)..  
-00007490: 2020 2020 2020 2020 2020 7368 6170 6520            shape 
-000074a0: 3d20 6172 722e 7368 6170 650d 0a20 2020  = arr.shape..   
-000074b0: 2020 2020 2020 2020 2077 6569 6768 7420           weight 
-000074c0: 3d20 5f67 6574 5f4e 445f 6275 7474 6572  = _get_ND_butter
-000074d0: 776f 7274 685f 6669 6c74 6572 2873 6861  worth_filter(sha
-000074e0: 7065 2c20 6375 746f 6666 2c20 6f72 6465  pe, cutoff, orde
-000074f0: 722c 2046 616c 7365 2c20 5472 7565 290d  r, False, True).
-00007500: 0a20 2020 2020 2020 2020 2020 2066 7420  .            ft 
-00007510: 3d20 7870 2e61 7361 7272 6179 2877 6569  = xp.asarray(wei
-00007520: 6768 7429 202a 2078 702e 6666 742e 7266  ght) * xp.fft.rf
-00007530: 6674 6e28 6172 7229 0d0a 2020 2020 2020  ftn(arr)..      
-00007540: 2020 2020 2020 6966 7420 3d20 7870 2e66        ift = xp.f
-00007550: 6674 2e69 7266 6674 6e28 6674 2c20 733d  ft.irfftn(ft, s=
-00007560: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-00007570: 2020 2020 7265 7475 726e 2078 702e 6173      return xp.as
-00007580: 6e75 6d70 7928 6966 7429 0d0a 2020 2020  numpy(ift)..    
-00007590: 2020 2020 0d0a 2020 2020 2020 2020 696e      ..        in
-000075a0: 7075 7420 3d20 6461 2e66 726f 6d5f 6172  put = da.from_ar
-000075b0: 7261 7928 7365 6c66 2e76 616c 7565 2c20  ray(self.value, 
-000075c0: 6368 756e 6b73 3d63 6875 6e6b 7329 0d0a  chunks=chunks)..
-000075d0: 2020 2020 2020 2020 6f75 7420 3d20 6461          out = da
-000075e0: 2e6d 6170 5f6f 7665 726c 6170 280d 0a20  .map_overlap(.. 
-000075f0: 2020 2020 2020 2020 2020 2066 756e 632c             func,
-00007600: 2069 6e70 7574 2c20 6465 7074 683d 6465   input, depth=de
-00007610: 7074 682c 2062 6f75 6e64 6172 793d 2272  pth, boundary="r
-00007620: 6566 6c65 6374 222c 2064 7479 7065 3d73  eflect", dtype=s
-00007630: 656c 662e 6474 7970 650d 0a20 2020 2020  elf.dtype..     
-00007640: 2020 2029 2e63 6f6d 7075 7465 2829 0d0a     ).compute()..
-00007650: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00007660: 2020 7265 7475 726e 206f 7574 0d0a 2020    return out..  
-00007670: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
-00007680: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
-00007690: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
-000076a0: 6178 6573 0d0a 2020 2020 4073 616d 655f  axes..    @same_
-000076b0: 6474 7970 6528 6173 666c 6f61 743d 5472  dtype(asfloat=Tr
-000076c0: 7565 290d 0a20 2020 2040 6368 6563 6b5f  ue)..    @check_
-000076d0: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
-000076e0: 0d0a 2020 2020 6465 6620 6869 6768 7061  ..    def highpa
-000076f0: 7373 5f66 696c 7465 7228 0d0a 2020 2020  ss_filter(..    
-00007700: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00007710: 2020 2063 7574 6f66 663a 206e 4446 6c6f     cutoff: nDFlo
-00007720: 6174 203d 2030 2e32 2c0d 0a20 2020 2020  at = 0.2,..     
-00007730: 2020 206f 7264 6572 3a20 666c 6f61 7420     order: float 
-00007740: 3d20 322c 0d0a 2020 2020 2020 2020 2a2c  = 2,..        *,
-00007750: 200d 0a20 2020 2020 2020 2064 696d 733a   ..        dims:
-00007760: 2044 696d 7320 3d20 4e6f 6e65 2c20 0d0a   Dims = None, ..
-00007770: 2020 2020 2020 2020 7570 6461 7465 3a20          update: 
-00007780: 626f 6f6c 203d 2046 616c 7365 0d0a 2020  bool = False..  
-00007790: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
-000077a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000077b0: 2020 2020 2020 2042 7574 7465 7277 6f72         Butterwor
-000077c0: 7468 2068 6967 682d 7061 7373 2066 696c  th high-pass fil
-000077d0: 7465 722e 0d0a 0d0a 2020 2020 2020 2020  ter.....        
-000077e0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
-000077f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
-00007800: 2020 2020 2020 2020 6375 746f 6666 203a          cutoff :
-00007810: 2066 6c6f 6174 206f 7220 6172 7261 792d   float or array-
-00007820: 6c69 6b65 2c20 6465 6661 756c 7420 6973  like, default is
-00007830: 2030 2e32 0d0a 2020 2020 2020 2020 2020   0.2..          
-00007840: 2020 4375 746f 6666 2066 7265 7175 656e    Cutoff frequen
-00007850: 6379 2e0d 0a20 2020 2020 2020 206f 7264  cy...        ord
-00007860: 6572 203a 2066 6c6f 6174 2c20 6465 6661  er : float, defa
-00007870: 756c 7420 6973 2032 0d0a 2020 2020 2020  ult is 2..      
-00007880: 2020 2020 2020 5374 6565 706e 6573 7320        Steepness 
-00007890: 6f66 2063 7574 6f66 662e 0d0a 2020 2020  of cutoff...    
-000078a0: 2020 2020 7b64 696d 737d 7b75 7064 6174      {dims}{updat
-000078b0: 657d 0d0a 0d0a 2020 2020 2020 2020 5265  e}....        Re
-000078c0: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-000078d0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-000078e0: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-000078f0: 2020 2020 2020 4669 6c74 6572 6564 2069        Filtered i
-00007900: 6d61 6765 0d0a 2020 2020 2020 2020 2222  mage..        ""
-00007910: 2220 2020 2020 2020 2020 0d0a 2020 2020  "         ..    
-00007920: 2020 2020 6672 6f6d 202e 5f75 7469 6c73      from ._utils
-00007930: 2e5f 736b 696d 6167 6520 696d 706f 7274  ._skimage import
-00007940: 205f 6765 745f 4e44 5f62 7574 7465 7277   _get_ND_butterw
-00007950: 6f72 7468 5f66 696c 7465 720d 0a20 2020  orth_filter..   
-00007960: 2020 2020 2063 7574 6f66 6620 3d20 6368       cutoff = ch
-00007970: 6563 6b5f 6e64 2863 7574 6f66 662c 206c  eck_nd(cutoff, l
-00007980: 656e 2864 696d 7329 290d 0a20 2020 2020  en(dims))..     
-00007990: 2020 2073 7061 7469 616c 5f73 6861 7065     spatial_shape
-000079a0: 203d 2073 656c 662e 7369 7a65 736f 6628   = self.sizesof(
-000079b0: 6469 6d73 290d 0a20 2020 2020 2020 2073  dims)..        s
-000079c0: 7061 7469 616c 5f61 7865 7320 3d20 5b73  patial_axes = [s
-000079d0: 656c 662e 6178 6973 6f66 2861 2920 666f  elf.axisof(a) fo
-000079e0: 7220 6120 696e 2064 696d 735d 0d0a 2020  r a in dims]..  
-000079f0: 2020 2020 2020 7765 6967 6874 203d 205f        weight = _
-00007a00: 6765 745f 4e44 5f62 7574 7465 7277 6f72  get_ND_butterwor
-00007a10: 7468 5f66 696c 7465 7228 7370 6174 6961  th_filter(spatia
-00007a20: 6c5f 7368 6170 652c 2063 7574 6f66 662c  l_shape, cutoff,
-00007a30: 206f 7264 6572 2c20 5472 7565 2c20 5472   order, True, Tr
-00007a40: 7565 290d 0a20 2020 2020 2020 2069 6e70  ue)..        inp
-00007a50: 7574 203d 2078 702e 6173 6172 7261 7928  ut = xp.asarray(
-00007a60: 7365 6c66 2e76 616c 7565 290d 0a20 2020  self.value)..   
-00007a70: 2020 2020 2069 6620 6c65 6e28 6469 6d73       if len(dims
-00007a80: 2920 3c20 7365 6c66 2e6e 6469 6d3a 0d0a  ) < self.ndim:..
-00007a90: 2020 2020 2020 2020 2020 2020 7765 6967              weig
-00007aa0: 6874 203d 2061 6464 5f61 7865 7328 7365  ht = add_axes(se
-00007ab0: 6c66 2e61 7865 732c 2073 656c 662e 7368  lf.axes, self.sh
-00007ac0: 6170 652c 2077 6569 6768 742c 2064 696d  ape, weight, dim
-00007ad0: 7329 0d0a 2020 2020 2020 2020 6f75 7420  s)..        out 
-00007ae0: 3d20 7870 2e66 6674 2e69 7266 6674 6e28  = xp.fft.irfftn(
-00007af0: 7870 2e61 7361 7272 6179 2877 6569 6768  xp.asarray(weigh
-00007b00: 7429 2a78 702e 6666 742e 7266 6674 6e28  t)*xp.fft.rfftn(
-00007b10: 696e 7075 742c 2061 7865 733d 7370 6174  input, axes=spat
-00007b20: 6961 6c5f 6178 6573 292c 200d 0a20 2020  ial_axes), ..   
-00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b40: 2020 2020 2020 2020 2073 3d73 7061 7469           s=spati
-00007b50: 616c 5f73 6861 7065 2c20 6178 6573 3d73  al_shape, axes=s
-00007b60: 7061 7469 616c 5f61 7865 7329 0d0a 2020  patial_axes)..  
-00007b70: 2020 2020 2020 7265 7475 726e 2078 702e        return xp.
-00007b80: 6173 6e75 6d70 7928 6f75 7429 0d0a 2020  asnumpy(out)..  
-00007b90: 2020 0d0a 2020 2020 0d0a 2020 2020 405f    ..    ..    @_
-00007ba0: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-00007bb0: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-00007bc0: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-00007bd0: 4073 616d 655f 6474 7970 6528 6173 666c  @same_dtype(asfl
-00007be0: 6f61 743d 5472 7565 290d 0a20 2020 2040  oat=True)..    @
-00007bf0: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
-00007c00: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
-00007c10: 636f 6e76 6f6c 7665 280d 0a20 2020 2020  convolve(..     
-00007c20: 2020 2073 656c 662c 0d0a 2020 2020 2020     self,..      
-00007c30: 2020 6b65 726e 656c 2c20 0d0a 2020 2020    kernel, ..    
-00007c40: 2020 2020 2a2c 0d0a 2020 2020 2020 2020      *,..        
-00007c50: 6d6f 6465 3a20 5061 6464 696e 674d 6f64  mode: PaddingMod
-00007c60: 6520 3d20 2272 6566 6c65 6374 222c 200d  e = "reflect", .
-00007c70: 0a20 2020 2020 2020 2063 7661 6c3a 2066  .        cval: f
-00007c80: 6c6f 6174 203d 2030 2c0d 0a20 2020 2020  loat = 0,..     
-00007c90: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
-00007ca0: 4e6f 6e65 2c20 0d0a 2020 2020 2020 2020  None, ..        
-00007cb0: 7570 6461 7465 3a20 626f 6f6c 203d 2046  update: bool = F
-00007cc0: 616c 7365 2c0d 0a20 2020 2029 202d 3e20  alse,..    ) -> 
-00007cd0: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
-00007ce0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00007cf0: 4765 6e65 7261 6c20 6c69 6e65 6172 2063  General linear c
-00007d00: 6f6e 766f 6c75 7469 6f6e 2062 7920 7275  onvolution by ru
-00007d10: 6e6e 696e 6720 6b65 726e 656c 2066 696c  nning kernel fil
-00007d20: 7465 7269 6e67 2e0d 0a0d 0a20 2020 2020  tering.....     
-00007d30: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-00007d40: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00007d50: 2d0d 0a20 2020 2020 2020 206b 6572 6e65  -..        kerne
-00007d60: 6c20 3a20 6172 7261 792d 6c69 6b65 0d0a  l : array-like..
-00007d70: 2020 2020 2020 2020 2020 2020 436f 6e76              Conv
-00007d80: 6f6c 7574 696f 6e20 6b65 726e 656c 2e0d  olution kernel..
-00007d90: 0a20 2020 2020 2020 207b 6d6f 6465 7d7b  .        {mode}{
-00007da0: 6376 616c 7d7b 6469 6d73 7d7b 7570 6461  cval}{dims}{upda
-00007db0: 7465 7d0d 0a0d 0a20 2020 2020 2020 2052  te}....        R
-00007dc0: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-00007dd0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-00007de0: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
-00007df0: 2020 2020 2020 2043 6f6e 766f 6c76 6564         Convolved
-00007e00: 2069 6d61 6765 2e0d 0a20 2020 2020 2020   image...       
-00007e10: 2022 2222 2020 2020 2020 2020 0d0a 2020   """        ..  
-00007e20: 2020 2020 2020 6b65 726e 656c 203d 206e        kernel = n
-00007e30: 702e 6173 6172 7261 7928 6b65 726e 656c  p.asarray(kernel
-00007e40: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-00007e50: 3332 290d 0a20 2020 2020 2020 2072 6574  32)..        ret
-00007e60: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
-00007e70: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
-00007e80: 2020 205f 6669 6c74 6572 732e 636f 6e76     _filters.conv
-00007e90: 6f6c 7665 2c20 0d0a 2020 2020 2020 2020  olve, ..        
-00007ea0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
-00007eb0: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
-00007ec0: 2073 656c 662e 6178 6573 292c 200d 0a20   self.axes), .. 
-00007ed0: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
-00007ee0: 3d73 656c 662e 6474 7970 652c 0d0a 2020  =self.dtype,..  
-00007ef0: 2020 2020 2020 2020 2020 6172 6773 3d28            args=(
-00007f00: 6b65 726e 656c 2c29 2c0d 0a20 2020 2020  kernel,),..     
-00007f10: 2020 2020 2020 206b 7761 7267 733d 6469         kwargs=di
-00007f20: 6374 286d 6f64 653d 6d6f 6465 2c20 6376  ct(mode=mode, cv
-00007f30: 616c 3d63 7661 6c29 0d0a 2020 2020 2020  al=cval)..      
-00007f40: 2020 290d 0a20 2020 2020 2020 200d 0a20    )..        .. 
-00007f50: 2020 2040 5f64 6f63 732e 7772 6974 655f     @_docs.write_
-00007f60: 646f 6373 0d0a 2020 2020 4064 696d 735f  docs..    @dims_
-00007f70: 746f 5f73 7061 7469 616c 5f61 7865 730d  to_spatial_axes.
-00007f80: 0a20 2020 2040 6368 6563 6b5f 696e 7075  .    @check_inpu
-00007f90: 745f 616e 645f 6f75 7470 7574 0d0a 2020  t_and_output..  
-00007fa0: 2020 6465 6620 6572 6f73 696f 6e28 0d0a    def erosion(..
-00007fb0: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
-00007fc0: 2020 2020 2020 2072 6164 6975 733a 2066         radius: f
-00007fd0: 6c6f 6174 203d 2031 2e2c 0d0a 2020 2020  loat = 1.,..    
-00007fe0: 2020 2020 2a2c 200d 0a20 2020 2020 2020      *, ..       
-00007ff0: 206d 6f64 653a 2050 6164 6469 6e67 4d6f   mode: PaddingMo
-00008000: 6465 203d 2022 7265 666c 6563 7422 2c0d  de = "reflect",.
-00008010: 0a20 2020 2020 2020 2063 7661 6c3a 2066  .        cval: f
-00008020: 6c6f 6174 203d 2030 2e30 2c0d 0a20 2020  loat = 0.0,..   
-00008030: 2020 2020 2064 696d 733a 2044 696d 7320       dims: Dims 
-00008040: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
-00008050: 2075 7064 6174 653a 2062 6f6f 6c20 3d20   update: bool = 
-00008060: 4661 6c73 652c 0d0a 2020 2020 2920 2d3e  False,..    ) ->
-00008070: 2049 6d67 4172 7261 793a 0d0a 2020 2020   ImgArray:..    
-00008080: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00008090: 204d 6f72 7068 6f6c 6f67 6963 616c 2065   Morphological e
-000080a0: 726f 7369 6f6e 2e20 0d0a 2020 2020 2020  rosion. ..      
-000080b0: 2020 0d0a 2020 2020 2020 2020 4966 2069    ..        If i
-000080c0: 6e70 7574 2069 7320 6269 6e61 7279 2069  nput is binary i
-000080d0: 6d61 6765 2c20 7468 6520 7275 6e6e 696e  mage, the runnin
-000080e0: 6720 6675 6e63 7469 6f6e 2077 696c 6c20  g function will 
-000080f0: 6175 746f 6d61 7469 6361 6c6c 7920 7377  automatically sw
-00008100: 6974 6368 6564 2074 6f0d 0a20 2020 2020  itched to..     
-00008110: 2020 2060 6062 696e 6172 795f 6572 6f73     ``binary_eros
-00008120: 696f 6e60 6020 746f 2073 7065 6564 2075  ion`` to speed u
-00008130: 7020 6361 6c63 756c 6174 696f 6e2e 0d0a  p calculation...
-00008140: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00008150: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00008160: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00008170: 2020 7b72 6164 6975 737d 7b6d 6f64 657d    {radius}{mode}
-00008180: 7b63 7661 6c7d 7b64 696d 737d 7b75 7064  {cval}{dims}{upd
-00008190: 6174 657d 0d0a 0d0a 2020 2020 2020 2020  ate}....        
-000081a0: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-000081b0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
-000081c0: 2020 496d 6741 7272 6179 0d0a 2020 2020    ImgArray..    
-000081d0: 2020 2020 2020 2020 4669 6c74 6572 6564          Filtered
-000081e0: 2069 6d61 6765 2e0d 0a20 2020 2020 2020   image...       
-000081f0: 2022 2222 2020 2020 2020 2020 0d0a 2020   """        ..  
-00008200: 2020 2020 2020 6469 736b 203d 205f 7374        disk = _st
-00008210: 7275 6374 7572 6573 2e62 616c 6c5f 6c69  ructures.ball_li
-00008220: 6b65 2872 6164 6975 732c 206c 656e 2864  ke(radius, len(d
-00008230: 696d 7329 290d 0a20 2020 2020 2020 2069  ims))..        i
-00008240: 6620 7365 6c66 2e64 7479 7065 203d 3d20  f self.dtype == 
-00008250: 626f 6f6c 3a0d 0a20 2020 2020 2020 2020  bool:..         
-00008260: 2020 2066 203d 205f 6669 6c74 6572 732e     f = _filters.
-00008270: 6269 6e61 7279 5f65 726f 7369 6f6e 0d0a  binary_erosion..
-00008280: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-00008290: 6773 203d 2064 6963 7428 7374 7275 6374  gs = dict(struct
-000082a0: 7572 653d 6469 736b 2c20 626f 7264 6572  ure=disk, border
-000082b0: 5f76 616c 7565 3d31 290d 0a20 2020 2020  _value=1)..     
-000082c0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000082d0: 2020 2020 2020 6620 3d20 5f66 696c 7465        f = _filte
-000082e0: 7273 2e65 726f 7369 6f6e 0d0a 2020 2020  rs.erosion..    
-000082f0: 2020 2020 2020 2020 6b77 6172 6773 203d          kwargs =
-00008300: 2064 6963 7428 666f 6f74 7072 696e 743d   dict(footprint=
-00008310: 6469 736b 2c20 6d6f 6465 3d6d 6f64 652c  disk, mode=mode,
-00008320: 2063 7661 6c3d 6376 616c 290d 0a20 2020   cval=cval)..   
-00008330: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00008340: 2e5f 6170 706c 795f 6461 736b 280d 0a20  ._apply_dask(.. 
-00008350: 2020 2020 2020 2020 2020 2066 2c20 0d0a             f, ..
-00008360: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
-00008370: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
-00008380: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
-00008390: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
-000083a0: 2020 2064 7479 7065 3d73 656c 662e 6474     dtype=self.dt
-000083b0: 7970 652c 0d0a 2020 2020 2020 2020 2020  ype,..          
-000083c0: 2020 6b77 6172 6773 3d6b 7761 7267 730d    kwargs=kwargs.
-000083d0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-000083e0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
-000083f0: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
-00008400: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
-00008410: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
-00008420: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
-00008430: 0a20 2020 2064 6566 2064 696c 6174 696f  .    def dilatio
-00008440: 6e28 0d0a 2020 2020 2020 2020 7365 6c66  n(..        self
-00008450: 2c0d 0a20 2020 2020 2020 2072 6164 6975  ,..        radiu
-00008460: 733a 2066 6c6f 6174 203d 2031 2c0d 0a20  s: float = 1,.. 
-00008470: 2020 2020 2020 202a 2c20 0d0a 2020 2020         *, ..    
-00008480: 2020 2020 6d6f 6465 3a20 5061 6464 696e      mode: Paddin
-00008490: 674d 6f64 6520 3d20 2272 6566 6c65 6374  gMode = "reflect
-000084a0: 222c 0d0a 2020 2020 2020 2020 6376 616c  ",..        cval
-000084b0: 3a20 666c 6f61 7420 3d20 302e 302c 0d0a  : float = 0.0,..
-000084c0: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
-000084d0: 6d73 203d 204e 6f6e 652c 0d0a 2020 2020  ms = None,..    
-000084e0: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
-000084f0: 203d 2046 616c 7365 2c0d 0a20 2020 2029   = False,..    )
-00008500: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
-00008510: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00008520: 2020 2020 4d6f 7270 686f 6c6f 6769 6361      Morphologica
-00008530: 6c20 6469 6c61 7469 6f6e 2e20 4966 2069  l dilation. If i
-00008540: 6e70 7574 2069 7320 6269 6e61 7279 2069  nput is binary i
-00008550: 6d61 6765 2c20 7468 6520 7275 6e6e 696e  mage, the runnin
-00008560: 6720 6675 6e63 7469 6f6e 2077 696c 6c20  g function will 
-00008570: 6175 746f 6d61 7469 6361 6c6c 7920 7377  automatically sw
-00008580: 6974 6368 6564 2074 6f0d 0a20 2020 2020  itched to..     
-00008590: 2020 2060 6062 696e 6172 795f 6469 6c61     ``binary_dila
-000085a0: 7469 6f6e 6060 2074 6f20 7370 6565 6420  tion`` to speed 
-000085b0: 7570 2063 616c 6375 6c61 7469 6f6e 2e0d  up calculation..
-000085c0: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-000085d0: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
-000085e0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
-000085f0: 2020 207b 7261 6469 7573 7d7b 6d6f 6465     {radius}{mode
-00008600: 7d7b 6376 616c 7d7b 6469 6d73 7d7b 7570  }{cval}{dims}{up
-00008610: 6461 7465 7d0d 0a0d 0a20 2020 2020 2020  date}....       
-00008620: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
-00008630: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
-00008640: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
-00008650: 2020 2020 2020 2020 2046 696c 7465 7265           Filtere
-00008660: 6420 696d 6167 652e 0d0a 2020 2020 2020  d image...      
-00008670: 2020 2222 2220 2020 2020 2020 200d 0a20    """        .. 
-00008680: 2020 2020 2020 2064 6973 6b20 3d20 5f73         disk = _s
-00008690: 7472 7563 7475 7265 732e 6261 6c6c 5f6c  tructures.ball_l
-000086a0: 696b 6528 7261 6469 7573 2c20 6c65 6e28  ike(radius, len(
-000086b0: 6469 6d73 2929 0d0a 2020 2020 2020 2020  dims))..        
-000086c0: 6966 2073 656c 662e 6474 7970 6520 3d3d  if self.dtype ==
-000086d0: 2062 6f6f 6c3a 0d0a 2020 2020 2020 2020   bool:..        
-000086e0: 2020 2020 6620 3d20 5f66 696c 7465 7273      f = _filters
-000086f0: 2e62 696e 6172 795f 6469 6c61 7469 6f6e  .binary_dilation
-00008700: 0d0a 2020 2020 2020 2020 2020 2020 6b77  ..            kw
-00008710: 6172 6773 203d 2064 6963 7428 7374 7275  args = dict(stru
-00008720: 6374 7572 653d 6469 736b 290d 0a20 2020  cture=disk)..   
-00008730: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00008740: 2020 2020 2020 2020 6620 3d20 5f66 696c          f = _fil
-00008750: 7465 7273 2e64 696c 6174 696f 6e0d 0a20  ters.dilation.. 
-00008760: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-00008770: 7320 3d20 6469 6374 2866 6f6f 7470 7269  s = dict(footpri
-00008780: 6e74 3d64 6973 6b2c 206d 6f64 653d 6d6f  nt=disk, mode=mo
-00008790: 6465 2c20 6376 616c 3d63 7661 6c29 0d0a  de, cval=cval)..
-000087a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000087b0: 656c 662e 5f61 7070 6c79 5f64 6173 6b28  elf._apply_dask(
-000087c0: 0d0a 2020 2020 2020 2020 2020 2020 662c  ..            f,
-000087d0: 200d 0a20 2020 2020 2020 2020 2020 2063   ..            c
-000087e0: 5f61 7865 733d 636f 6d70 6c65 6d65 6e74  _axes=complement
-000087f0: 5f61 7865 7328 6469 6d73 2c20 7365 6c66  _axes(dims, self
-00008800: 2e61 7865 7329 2c20 0d0a 2020 2020 2020  .axes), ..      
-00008810: 2020 2020 2020 6474 7970 653d 7365 6c66        dtype=self
-00008820: 2e64 7479 7065 2c0d 0a20 2020 2020 2020  .dtype,..       
-00008830: 2020 2020 206b 7761 7267 733d 6b77 6172       kwargs=kwar
-00008840: 6773 0d0a 2020 2020 2020 2020 290d 0a20  gs..        ).. 
-00008850: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
-00008860: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
-00008870: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-00008880: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
-00008890: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-000088a0: 7574 0d0a 2020 2020 6465 6620 6f70 656e  ut..    def open
-000088b0: 696e 6728 0d0a 2020 2020 2020 2020 7365  ing(..        se
-000088c0: 6c66 2c0d 0a20 2020 2020 2020 2072 6164  lf,..        rad
-000088d0: 6975 733a 2066 6c6f 6174 203d 2031 2c0d  ius: float = 1,.
-000088e0: 0a20 2020 2020 2020 202a 2c0d 0a20 2020  .        *,..   
-000088f0: 2020 2020 206d 6f64 653a 2050 6164 6469       mode: Paddi
-00008900: 6e67 4d6f 6465 203d 2022 7265 666c 6563  ngMode = "reflec
-00008910: 7422 2c0d 0a20 2020 2020 2020 2063 7661  t",..        cva
-00008920: 6c3a 2066 6c6f 6174 203d 2030 2e30 2c0d  l: float = 0.0,.
-00008930: 0a20 2020 2020 2020 2064 696d 733a 2044  .        dims: D
-00008940: 696d 7320 3d20 4e6f 6e65 2c0d 0a20 2020  ims = None,..   
-00008950: 2020 2020 2075 7064 6174 653a 2062 6f6f       update: boo
-00008960: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
-00008970: 2920 2d3e 2049 6d67 4172 7261 793a 0d0a  ) -> ImgArray:..
-00008980: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00008990: 2020 2020 204d 6f72 7068 6f6c 6f67 6963       Morphologic
-000089a0: 616c 206f 7065 6e69 6e67 2e20 4966 2069  al opening. If i
-000089b0: 6e70 7574 2069 7320 6269 6e61 7279 2069  nput is binary i
-000089c0: 6d61 6765 2c20 7468 6520 7275 6e6e 696e  mage, the runnin
-000089d0: 6720 6675 6e63 7469 6f6e 2077 696c 6c20  g function will 
-000089e0: 6175 746f 6d61 7469 6361 6c6c 7920 7377  automatically sw
-000089f0: 6974 6368 6564 2074 6f0d 0a20 2020 2020  itched to..     
-00008a00: 2020 2060 6062 696e 6172 795f 6f70 656e     ``binary_open
-00008a10: 696e 6760 6020 746f 2073 7065 6564 2075  ing`` to speed u
-00008a20: 7020 6361 6c63 756c 6174 696f 6e2e 0d0a  p calculation...
-00008a30: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00008a40: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00008a50: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00008a60: 2020 7b72 6164 6975 737d 7b6d 6f64 657d    {radius}{mode}
-00008a70: 7b63 7661 6c7d 7b64 696d 737d 7b75 7064  {cval}{dims}{upd
-00008a80: 6174 657d 0d0a 0d0a 2020 2020 2020 2020  ate}....        
-00008a90: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-00008aa0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
-00008ab0: 2020 496d 6741 7272 6179 0d0a 2020 2020    ImgArray..    
-00008ac0: 2020 2020 2020 2020 4669 6c74 6572 6564          Filtered
-00008ad0: 2069 6d61 6765 2e0d 0a20 2020 2020 2020   image...       
-00008ae0: 2022 2222 2020 2020 2020 2020 0d0a 2020   """        ..  
-00008af0: 2020 2020 2020 6469 736b 203d 205f 7374        disk = _st
-00008b00: 7275 6374 7572 6573 2e62 616c 6c5f 6c69  ructures.ball_li
-00008b10: 6b65 2872 6164 6975 732c 206c 656e 2864  ke(radius, len(d
-00008b20: 696d 7329 290d 0a20 2020 2020 2020 2069  ims))..        i
-00008b30: 6620 7365 6c66 2e64 7479 7065 203d 3d20  f self.dtype == 
-00008b40: 626f 6f6c 3a0d 0a20 2020 2020 2020 2020  bool:..         
-00008b50: 2020 2066 203d 205f 6669 6c74 6572 732e     f = _filters.
-00008b60: 6269 6e61 7279 5f6f 7065 6e69 6e67 0d0a  binary_opening..
-00008b70: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-00008b80: 6773 203d 2064 6963 7428 7374 7275 6374  gs = dict(struct
-00008b90: 7572 653d 6469 736b 290d 0a20 2020 2020  ure=disk)..     
-00008ba0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00008bb0: 2020 2020 2020 6620 3d20 5f66 696c 7465        f = _filte
-00008bc0: 7273 2e6f 7065 6e69 6e67 0d0a 2020 2020  rs.opening..    
-00008bd0: 2020 2020 2020 2020 6b77 6172 6773 203d          kwargs =
-00008be0: 2064 6963 7428 666f 6f74 7072 696e 743d   dict(footprint=
-00008bf0: 6469 736b 2c20 6d6f 6465 3d6d 6f64 652c  disk, mode=mode,
-00008c00: 2063 7661 6c3d 6376 616c 290d 0a20 2020   cval=cval)..   
-00008c10: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00008c20: 2e5f 6170 706c 795f 6461 736b 280d 0a20  ._apply_dask(.. 
-00008c30: 2020 2020 2020 2020 2020 2066 2c20 0d0a             f, ..
-00008c40: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
-00008c50: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
-00008c60: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
-00008c70: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
-00008c80: 2020 2064 7479 7065 3d73 656c 662e 6474     dtype=self.dt
-00008c90: 7970 652c 0d0a 2020 2020 2020 2020 2020  ype,..          
-00008ca0: 2020 6b77 6172 6773 3d6b 7761 7267 730d    kwargs=kwargs.
-00008cb0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-00008cc0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
-00008cd0: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
-00008ce0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
-00008cf0: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
-00008d00: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
-00008d10: 0a20 2020 2064 6566 2063 6c6f 7369 6e67  .    def closing
-00008d20: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
-00008d30: 0d0a 2020 2020 2020 2020 7261 6469 7573  ..        radius
-00008d40: 3a20 666c 6f61 7420 3d20 312c 0d0a 2020  : float = 1,..  
-00008d50: 2020 2020 2020 2a2c 200d 0a20 2020 2020        *, ..     
-00008d60: 2020 206d 6f64 653a 2050 6164 6469 6e67     mode: Padding
-00008d70: 4d6f 6465 203d 2022 7265 666c 6563 7422  Mode = "reflect"
-00008d80: 2c0d 0a20 2020 2020 2020 2063 7661 6c3a  ,..        cval:
-00008d90: 2066 6c6f 6174 203d 2030 2e30 2c0d 0a20   float = 0.0,.. 
-00008da0: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
-00008db0: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
-00008dc0: 2020 2075 7064 6174 653a 2062 6f6f 6c20     update: bool 
-00008dd0: 3d20 4661 6c73 652c 0d0a 2020 2020 2920  = False,..    ) 
-00008de0: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
-00008df0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00008e00: 2020 204d 6f72 7068 6f6c 6f67 6963 616c     Morphological
-00008e10: 2063 6c6f 7369 6e67 2e20 0d0a 2020 2020   closing. ..    
-00008e20: 2020 2020 0d0a 2020 2020 2020 2020 4966      ..        If
-00008e30: 2069 6e70 7574 2069 7320 6269 6e61 7279   input is binary
-00008e40: 2069 6d61 6765 2c20 7468 6520 7275 6e6e   image, the runn
-00008e50: 696e 6720 6675 6e63 7469 6f6e 2077 696c  ing function wil
-00008e60: 6c20 6175 746f 6d61 7469 6361 6c6c 7920  l automatically 
-00008e70: 7377 6974 6368 6564 2074 6f0d 0a20 2020  switched to..   
-00008e80: 2020 2020 2060 6062 696e 6172 795f 636c       ``binary_cl
-00008e90: 6f73 696e 6760 6020 746f 2073 7065 6564  osing`` to speed
-00008ea0: 2075 7020 6361 6c63 756c 6174 696f 6e2e   up calculation.
-00008eb0: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
-00008ec0: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
-00008ed0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00008ee0: 2020 2020 7b72 6164 6975 737d 7b64 696d      {radius}{dim
-00008ef0: 737d 7b6d 6f64 657d 7b63 7661 6c7d 7b75  s}{mode}{cval}{u
-00008f00: 7064 6174 657d 0d0a 0d0a 2020 2020 2020  pdate}....      
-00008f10: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00008f20: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00008f30: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
-00008f40: 2020 2020 2020 2020 2020 4669 6c74 6572            Filter
-00008f50: 6564 2069 6d61 6765 2e0d 0a20 2020 2020  ed image...     
-00008f60: 2020 2022 2222 2020 2020 2020 2020 0d0a     """        ..
-00008f70: 2020 2020 2020 2020 6469 736b 203d 205f          disk = _
-00008f80: 7374 7275 6374 7572 6573 2e62 616c 6c5f  structures.ball_
-00008f90: 6c69 6b65 2872 6164 6975 732c 206c 656e  like(radius, len
-00008fa0: 2864 696d 7329 290d 0a20 2020 2020 2020  (dims))..       
-00008fb0: 2069 6620 7365 6c66 2e64 7479 7065 203d   if self.dtype =
-00008fc0: 3d20 626f 6f6c 3a0d 0a20 2020 2020 2020  = bool:..       
-00008fd0: 2020 2020 2066 203d 205f 6669 6c74 6572       f = _filter
-00008fe0: 732e 6269 6e61 7279 5f63 6c6f 7369 6e67  s.binary_closing
-00008ff0: 0d0a 2020 2020 2020 2020 2020 2020 6b77  ..            kw
-00009000: 6172 6773 203d 2064 6963 7428 7374 7275  args = dict(stru
-00009010: 6374 7572 653d 6469 736b 290d 0a20 2020  cture=disk)..   
-00009020: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00009030: 2020 2020 2020 2020 6620 3d20 5f66 696c          f = _fil
-00009040: 7465 7273 2e63 6c6f 7369 6e67 0d0a 2020  ters.closing..  
-00009050: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00009060: 203d 2064 6963 7428 666f 6f74 7072 696e   = dict(footprin
-00009070: 743d 6469 736b 2c20 6d6f 6465 3d6d 6f64  t=disk, mode=mod
-00009080: 652c 2063 7661 6c3d 6376 616c 290d 0a20  e, cval=cval).. 
-00009090: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000090a0: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
-000090b0: 0a20 2020 2020 2020 2020 2020 2066 2c20  .            f, 
-000090c0: 0d0a 2020 2020 2020 2020 2020 2020 635f  ..            c_
-000090d0: 6178 6573 3d63 6f6d 706c 656d 656e 745f  axes=complement_
-000090e0: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-000090f0: 6178 6573 292c 200d 0a20 2020 2020 2020  axes), ..       
-00009100: 2020 2020 2064 7479 7065 3d73 656c 662e       dtype=self.
-00009110: 6474 7970 652c 0d0a 2020 2020 2020 2020  dtype,..        
-00009120: 2020 2020 6b77 6172 6773 3d6b 7761 7267      kwargs=kwarg
-00009130: 730d 0a20 2020 2020 2020 2029 0d0a 2020  s..        )..  
-00009140: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
-00009150: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
-00009160: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
-00009170: 6178 6573 0d0a 2020 2020 4063 6865 636b  axes..    @check
-00009180: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
-00009190: 740d 0a20 2020 2064 6566 2074 6f70 6861  t..    def topha
-000091a0: 7428 0d0a 2020 2020 2020 2020 7365 6c66  t(..        self
-000091b0: 2c0d 0a20 2020 2020 2020 2072 6164 6975  ,..        radiu
-000091c0: 733a 2066 6c6f 6174 203d 2033 302c 0d0a  s: float = 30,..
-000091d0: 2020 2020 2020 2020 2a2c 0d0a 2020 2020          *,..    
-000091e0: 2020 2020 6d6f 6465 3a20 5061 6464 696e      mode: Paddin
-000091f0: 674d 6f64 6520 3d20 2272 6566 6c65 6374  gMode = "reflect
-00009200: 222c 0d0a 2020 2020 2020 2020 6376 616c  ",..        cval
-00009210: 3a20 666c 6f61 7420 3d20 302e 302c 0d0a  : float = 0.0,..
-00009220: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
-00009230: 6d73 203d 204e 6f6e 652c 0d0a 2020 2020  ms = None,..    
-00009240: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
-00009250: 203d 2046 616c 7365 2c0d 0a20 2020 2029   = False,..    )
-00009260: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
-00009270: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00009280: 2020 2020 546f 7068 6174 206d 6f72 7068      Tophat morph
-00009290: 6f6c 6f67 6963 616c 2069 6d61 6765 2070  ological image p
-000092a0: 726f 6365 7373 696e 672e 2054 6869 7320  rocessing. This 
-000092b0: 6973 2075 7365 6675 6c20 666f 7220 6261  is useful for ba
-000092c0: 636b 6772 6f75 6e64 2073 7562 7472 6163  ckground subtrac
-000092d0: 7469 6f6e 2e0d 0a0d 0a20 2020 2020 2020  tion.....       
-000092e0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
-000092f0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
-00009300: 0a20 2020 2020 2020 207b 7261 6469 7573  .        {radius
-00009310: 7d7b 6d6f 6465 7d7b 6376 616c 7d7b 6469  }{mode}{cval}{di
-00009320: 6d73 7d7b 7570 6461 7465 7d0d 0a0d 0a20  ms}{update}.... 
-00009330: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
-00009340: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
-00009350: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
-00009360: 790d 0a20 2020 2020 2020 2020 2020 2046  y..            F
-00009370: 696c 7465 7265 6420 696d 6167 652e 0d0a  iltered image...
-00009380: 2020 2020 2020 2020 2222 2220 2020 2020          """     
-00009390: 2020 200d 0a20 2020 2020 2020 200d 0a20     ..        .. 
-000093a0: 2020 2020 2020 2064 6973 6b20 3d20 5f73         disk = _s
-000093b0: 7472 7563 7475 7265 732e 6261 6c6c 5f6c  tructures.ball_l
-000093c0: 696b 6528 7261 6469 7573 2c20 6c65 6e28  ike(radius, len(
-000093d0: 6469 6d73 2929 0d0a 2020 2020 2020 2020  dims))..        
-000093e0: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
-000093f0: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
-00009400: 2020 2020 2020 5f66 696c 7465 7273 2e77        _filters.w
-00009410: 6869 7465 5f74 6f70 6861 742c 200d 0a20  hite_tophat, .. 
-00009420: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
-00009430: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
-00009440: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
-00009450: 7329 2c20 0d0a 2020 2020 2020 2020 2020  s), ..          
-00009460: 2020 6474 7970 653d 7365 6c66 2e64 7479    dtype=self.dty
-00009470: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
-00009480: 206b 7761 7267 733d 6469 6374 2866 6f6f   kwargs=dict(foo
-00009490: 7470 7269 6e74 3d64 6973 6b2c 206d 6f64  tprint=disk, mod
-000094a0: 653d 6d6f 6465 2c20 6376 616c 3d63 7661  e=mode, cval=cva
-000094b0: 6c29 0d0a 2020 2020 2020 2020 290d 0a20  l)..        ).. 
-000094c0: 2020 200d 0a20 2020 200d 0a20 2020 2040     ..    ..    @
-000094d0: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
-000094e0: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
-000094f0: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
-00009500: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
-00009510: 645f 6f75 7470 7574 286f 6e6c 795f 6269  d_output(only_bi
-00009520: 6e61 7279 3d54 7275 6529 0d0a 2020 2020  nary=True)..    
-00009530: 6465 6620 736d 6f6f 7468 5f6d 6173 6b28  def smooth_mask(
-00009540: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
-00009550: 0a20 2020 2020 2020 2073 6967 6d61 3a20  .        sigma: 
-00009560: 666c 6f61 7420 3d20 322e 302c 0d0a 2020  float = 2.0,..  
-00009570: 2020 2020 2020 6469 6c61 7465 5f72 6164        dilate_rad
-00009580: 6975 733a 2066 6c6f 6174 203d 2032 2e30  ius: float = 2.0
-00009590: 2c0d 0a20 2020 2020 2020 206d 6173 6b5f  ,..        mask_
-000095a0: 6c69 6768 743a 2062 6f6f 6c20 3d20 4661  light: bool = Fa
-000095b0: 6c73 652c 0d0a 2020 2020 2020 2020 2a2c  lse,..        *,
-000095c0: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
-000095d0: 4469 6d73 203d 204e 6f6e 650d 0a20 2020  Dims = None..   
-000095e0: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
-000095f0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00009600: 2020 2020 2020 536d 6f6f 7468 656e 2062        Smoothen b
-00009610: 696e 6172 7920 6d61 736b 2069 6d61 6765  inary mask image
-00009620: 2061 7420 6974 7320 6564 6765 732e 2054   at its edges. T
-00009630: 6869 7320 6973 2075 7365 6675 6c20 746f  his is useful to
-00009640: 206d 616b 6520 6120 2273 6f66 7420 6d61   make a "soft ma
-00009650: 736b 222e 0d0a 2020 2020 2020 2020 0d0a  sk"...        ..
-00009660: 2020 2020 2020 2020 5468 6973 206d 6574          This met
-00009670: 686f 6420 6170 706c 6965 7320 6572 6f73  hod applies eros
-00009680: 696f 6e2f 6469 6c61 7469 6f6e 2074 6f20  ion/dilation to 
-00009690: 6120 6269 6e61 7279 2069 6d61 6765 2061  a binary image a
-000096a0: 6e64 2074 6865 6e20 736d 6f6f 7468 2069  nd then smooth i
-000096b0: 7473 2065 6467 6573 2062 7920 4761 7573  ts edges by Gaus
-000096c0: 7369 616e 2e0d 0a20 2020 2020 2020 2054  sian...        T
-000096d0: 6865 2074 6f74 616c 2076 616c 7565 2069  he total value i
-000096e0: 7320 616c 7761 7973 206c 6172 6765 7220  s always larger 
-000096f0: 6166 7465 7220 4761 7573 7369 616e 2073  after Gaussian s
-00009700: 6d6f 6f74 6869 6e67 2e0d 0a0d 0a20 2020  moothing.....   
-00009710: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-00009720: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00009730: 2d2d 2d0d 0a20 2020 2020 2020 2073 6967  ---..        sig
-00009740: 6d61 203a 2066 6c6f 6174 2c20 6465 6661  ma : float, defa
-00009750: 756c 7420 6973 2032 2e30 0d0a 2020 2020  ult is 2.0..    
-00009760: 2020 2020 2020 2020 5374 616e 6461 7264          Standard
-00009770: 2064 6576 6961 7469 6f6e 206f 6620 4761   deviation of Ga
-00009780: 7573 7369 616e 2062 6c75 722e 0d0a 2020  ussian blur...  
-00009790: 2020 2020 2020 6469 6c61 7465 5f72 6164        dilate_rad
-000097a0: 6975 7320 3a20 666c 6f61 742c 2064 6566  ius : float, def
-000097b0: 6175 6c74 2069 7320 322e 300d 0a20 2020  ault is 2.0..   
-000097c0: 2020 2020 2020 2020 2052 6164 6975 7320           Radius 
-000097d0: 696e 2070 6978 656c 2074 6861 7420 7769  in pixel that wi
-000097e0: 6c6c 2062 6520 7573 6564 2074 6f20 6469  ll be used to di
-000097f0: 6c61 7465 206d 6173 6b20 6265 666f 7265  late mask before
-00009800: 2073 6d6f 6f74 6869 6e67 2e0d 0a20 2020   smoothing...   
-00009810: 2020 2020 206d 6173 6b5f 6c69 6768 7420       mask_light 
-00009820: 3a20 626f 6f6c 2c20 6465 6661 756c 7420  : bool, default 
-00009830: 6973 2046 616c 7365 0d0a 2020 2020 2020  is False..      
-00009840: 2020 2020 2020 4966 2074 7275 652c 206d        If true, m
-00009850: 6173 6b20 6172 7261 7920 6973 2063 6f6e  ask array is con
-00009860: 7369 6465 7265 6420 746f 206d 6173 6b20  sidered to mask 
-00009870: 6f74 6865 7220 696d 6167 6520 6174 2069  other image at i
-00009880: 7473 2054 7275 6520 7661 6c75 6573 2e20  ts True values. 
-00009890: 4f74 6865 7277 6973 6520 6d61 736b 2061  Otherwise mask a
-000098a0: 7272 6179 200d 0a20 2020 2020 2020 2020  rray ..         
-000098b0: 2020 2070 6c61 7973 206d 6f72 6520 6c69     plays more li
-000098c0: 6b65 2061 2077 6569 6768 7420 6172 7261  ke a weight arra
-000098d0: 792c 2074 6861 7420 6973 2c20 4661 6c73  y, that is, Fals
-000098e0: 6520 7265 6769 6f6e 2077 696c 6c20 6265  e region will be
-000098f0: 207a 6572 6f2e 0d0a 2020 2020 2020 2020   zero...        
-00009900: 7b64 696d 737d 0d0a 2020 2020 2020 2020  {dims}..        
-00009910: 2020 2020 0d0a 2020 2020 2020 2020 5265      ..        Re
-00009920: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-00009930: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00009940: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00009950: 2020 2020 2020 536d 6f6f 7468 656e 6564        Smoothened
-00009960: 206d 6173 6b20 696d 6167 652e 0d0a 2020   mask image...  
-00009970: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00009980: 2020 2069 6620 6e6f 7420 6d61 736b 5f6c     if not mask_l
-00009990: 6967 6874 3a0d 0a20 2020 2020 2020 2020  ight:..         
-000099a0: 2020 2073 656c 6620 3d20 7e73 656c 660d     self = ~self.
-000099b0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-000099c0: 2020 2069 6620 6469 6c61 7465 5f72 6164     if dilate_rad
-000099d0: 6975 7320 3e20 303a 0d0a 2020 2020 2020  ius > 0:..      
-000099e0: 2020 2020 2020 7365 6c66 203d 2073 656c        self = sel
-000099f0: 662e 6572 6f73 696f 6e28 6469 6c61 7465  f.erosion(dilate
-00009a00: 5f72 6164 6975 732c 2064 696d 733d 6469  _radius, dims=di
-00009a10: 6d73 290d 0a20 2020 2020 2020 2065 6c69  ms)..        eli
-00009a20: 6620 6469 6c61 7465 5f72 6164 6975 7320  f dilate_radius 
-00009a30: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
-00009a40: 2020 7365 6c66 203d 2073 656c 662e 6469    self = self.di
-00009a50: 6c61 7469 6f6e 282d 6469 6c61 7465 5f72  lation(-dilate_r
-00009a60: 6164 6975 732c 2064 696d 733d 6469 6d73  adius, dims=dims
-00009a70: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-00009a80: 2020 2020 2069 6620 7369 676d 6120 3e20       if sigma > 
-00009a90: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-00009aa0: 6469 7374 203d 2073 656c 662e 6469 7374  dist = self.dist
-00009ab0: 616e 6365 5f6d 6170 2864 696d 733d 6469  ance_map(dims=di
-00009ac0: 6d73 290d 0a20 2020 2020 2020 2020 2020  ms)..           
-00009ad0: 2062 6c75 7272 6564 5f6d 6173 6b20 3d20   blurred_mask = 
-00009ae0: 6e70 2e65 7870 282d 6469 7374 2a2a 322f  np.exp(-dist**2/
-00009af0: 322f 7369 676d 612a 2a32 290d 0a20 2020  2/sigma**2)..   
-00009b00: 2020 2020 2065 6c69 6620 7369 676d 6120       elif sigma 
-00009b10: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00009b20: 2020 2062 6c75 7272 6564 5f6d 6173 6b20     blurred_mask 
-00009b30: 3d20 3120 2d20 7365 6c66 2e61 7374 7970  = 1 - self.astyp
-00009b40: 6528 6e70 2e66 6c6f 6174 3332 290d 0a20  e(np.float32).. 
-00009b50: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00009b60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00009b70: 5661 6c75 6545 7272 6f72 2822 7369 676d  ValueError("sigm
-00009b80: 6120 6d75 7374 2062 6520 6e6f 6e2d 6e65  a must be non-ne
-00009b90: 6761 7469 7665 2e22 290d 0a20 2020 2020  gative.")..     
-00009ba0: 2020 2069 6620 6d61 736b 5f6c 6967 6874     if mask_light
-00009bb0: 3a0d 0a20 2020 2020 2020 2020 2020 2062  :..            b
-00009bc0: 6c75 7272 6564 5f6d 6173 6b20 3d20 3120  lurred_mask = 1 
-00009bd0: 2d20 626c 7572 7265 645f 6d61 736b 0d0a  - blurred_mask..
-00009be0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-00009bf0: 6c75 7272 6564 5f6d 6173 6b0d 0a20 2020  lurred_mask..   
-00009c00: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
-00009c10: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
-00009c20: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
-00009c30: 7865 730d 0a20 2020 2040 7361 6d65 5f64  xes..    @same_d
-00009c40: 7479 7065 2861 7366 6c6f 6174 3d54 7275  type(asfloat=Tru
-00009c50: 6529 0d0a 2020 2020 4063 6865 636b 5f69  e)..    @check_i
-00009c60: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
-00009c70: 0a20 2020 2064 6566 206d 6561 6e5f 6669  .    def mean_fi
-00009c80: 6c74 6572 280d 0a20 2020 2020 2020 2073  lter(..        s
-00009c90: 656c 662c 0d0a 2020 2020 2020 2020 7261  elf,..        ra
-00009ca0: 6469 7573 3a20 666c 6f61 7420 3d20 312c  dius: float = 1,
-00009cb0: 0d0a 2020 2020 2020 2020 2a2c 0d0a 2020  ..        *,..  
-00009cc0: 2020 2020 2020 6d6f 6465 3a20 5061 6464        mode: Padd
-00009cd0: 696e 674d 6f64 6520 3d20 2272 6566 6c65  ingMode = "refle
-00009ce0: 6374 222c 0d0a 2020 2020 2020 2020 6376  ct",..        cv
-00009cf0: 616c 3a20 666c 6f61 7420 3d20 302e 302c  al: float = 0.0,
-00009d00: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
-00009d10: 4469 6d73 203d 204e 6f6e 652c 0d0a 2020  Dims = None,..  
-00009d20: 2020 2020 2020 7570 6461 7465 3a20 626f        update: bo
-00009d30: 6f6c 203d 2046 616c 7365 2920 2d3e 2049  ol = False) -> I
-00009d40: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
-00009d50: 2020 2222 220d 0a20 2020 2020 2020 204d    """..        M
-00009d60: 6561 6e20 6669 6c74 6572 2e20 4b65 726e  ean filter. Kern
-00009d70: 656c 2069 7320 6669 6c6c 6564 2077 6974  el is filled wit
-00009d80: 6820 7361 6d65 2076 616c 7565 732e 0d0a  h same values...
-00009d90: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00009da0: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00009db0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00009dc0: 2020 7b72 6164 6975 737d 7b6d 6f64 657d    {radius}{mode}
-00009dd0: 7b63 7661 6c7d 7b64 696d 737d 7b75 7064  {cval}{dims}{upd
-00009de0: 6174 657d 0d0a 2020 2020 2020 2020 2020  ate}..          
-00009df0: 2020 0d0a 2020 2020 2020 2020 5265 7475    ..        Retu
-00009e00: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
-00009e10: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
-00009e20: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
-00009e30: 2020 2020 4669 6c74 6572 6564 2069 6d61      Filtered ima
-00009e40: 6765 0d0a 2020 2020 2020 2020 2222 2220  ge..        """ 
-00009e50: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00009e60: 2064 6973 6b20 3d20 5f73 7472 7563 7475   disk = _structu
-00009e70: 7265 732e 6261 6c6c 5f6c 696b 6528 7261  res.ball_like(ra
-00009e80: 6469 7573 2c20 6c65 6e28 6469 6d73 2929  dius, len(dims))
-00009e90: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00009ea0: 2073 656c 662e 5f61 7070 6c79 5f64 6173   self._apply_das
-00009eb0: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
-00009ec0: 5f66 696c 7465 7273 2e6d 6561 6e5f 6669  _filters.mean_fi
-00009ed0: 6c74 6572 2c20 0d0a 2020 2020 2020 2020  lter, ..        
-00009ee0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
-00009ef0: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
-00009f00: 2073 656c 662e 6178 6573 292c 200d 0a20   self.axes), .. 
-00009f10: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
-00009f20: 3d73 656c 662e 6474 7970 652c 0d0a 2020  =self.dtype,..  
-00009f30: 2020 2020 2020 2020 2020 6172 6773 3d28            args=(
-00009f40: 6469 736b 2c29 2c0d 0a20 2020 2020 2020  disk,),..       
-00009f50: 2020 2020 206b 7761 7267 733d 6469 6374       kwargs=dict
-00009f60: 286d 6f64 653d 6d6f 6465 2c20 6376 616c  (mode=mode, cval
-00009f70: 3d63 7661 6c29 2c0d 0a20 2020 2020 2020  =cval),..       
-00009f80: 2029 0d0a 2020 2020 0d0a 2020 2020 405f   )..    ..    @_
-00009f90: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-00009fa0: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-00009fb0: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-00009fc0: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
-00009fd0: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
-00009fe0: 2073 7464 5f66 696c 7465 7228 0d0a 2020   std_filter(..  
-00009ff0: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
-0000a000: 2020 2020 2072 6164 6975 733a 2066 6c6f       radius: flo
-0000a010: 6174 203d 2031 2c20 0d0a 2020 2020 2020  at = 1, ..      
-0000a020: 2020 2a2c 200d 0a20 2020 2020 2020 206d    *, ..        m
-0000a030: 6f64 653a 2050 6164 6469 6e67 4d6f 6465  ode: PaddingMode
-0000a040: 203d 2022 7265 666c 6563 7422 2c0d 0a20   = "reflect",.. 
-0000a050: 2020 2020 2020 2063 7661 6c3a 2066 6c6f         cval: flo
-0000a060: 6174 203d 2030 2e30 2c0d 0a20 2020 2020  at = 0.0,..     
-0000a070: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
-0000a080: 4e6f 6e65 2c0d 0a20 2020 2029 202d 3e20  None,..    ) -> 
-0000a090: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
-0000a0a0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000a0b0: 5374 616e 6461 7264 2064 6576 6961 7469  Standard deviati
-0000a0c0: 6f6e 2066 696c 7465 722e 0d0a 0d0a 2020  on filter.....  
-0000a0d0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0000a0e0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0000a0f0: 2d2d 2d2d 0d0a 2020 2020 2020 2020 7b72  ----..        {r
-0000a100: 6164 6975 737d 7b6d 6f64 657d 7b63 7661  adius}{mode}{cva
-0000a110: 6c7d 7b64 696d 737d 0d0a 0d0a 2020 2020  l}{dims}....    
-0000a120: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0000a130: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-0000a140: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-0000a150: 2020 2020 2020 2020 2020 2020 4669 6c74              Filt
-0000a160: 6572 6564 2069 6d61 6765 0d0a 2020 2020  ered image..    
-0000a170: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
-0000a180: 0a20 2020 2020 2020 2064 6973 6b20 3d20  .        disk = 
-0000a190: 5f73 7472 7563 7475 7265 732e 6261 6c6c  _structures.ball
-0000a1a0: 5f6c 696b 6528 7261 6469 7573 2c20 6c65  _like(radius, le
-0000a1b0: 6e28 6469 6d73 2929 0d0a 2020 2020 2020  n(dims))..      
-0000a1c0: 2020 7265 7475 726e 2073 656c 662e 6173    return self.as
-0000a1d0: 5f66 6c6f 6174 2829 2e5f 6170 706c 795f  _float()._apply_
-0000a1e0: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
-0000a1f0: 2020 205f 6669 6c74 6572 732e 7374 645f     _filters.std_
-0000a200: 6669 6c74 6572 2c20 0d0a 2020 2020 2020  filter, ..      
-0000a210: 2020 2020 2020 635f 6178 6573 3d63 6f6d        c_axes=com
-0000a220: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
-0000a230: 732c 2073 656c 662e 6178 6573 292c 200d  s, self.axes), .
-0000a240: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-0000a250: 733d 2864 6973 6b2c 292c 0d0a 2020 2020  s=(disk,),..    
-0000a260: 2020 2020 2020 2020 6b77 6172 6773 3d64          kwargs=d
-0000a270: 6963 7428 6d6f 6465 3d6d 6f64 652c 2063  ict(mode=mode, c
-0000a280: 7661 6c3d 6376 616c 292c 0d0a 2020 2020  val=cval),..    
-0000a290: 2020 2020 290d 0a20 2020 200d 0a20 2020      )..    ..   
-0000a2a0: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
-0000a2b0: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
-0000a2c0: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
-0000a2d0: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
-0000a2e0: 616e 645f 6f75 7470 7574 0d0a 2020 2020  and_output..    
-0000a2f0: 6465 6620 636f 6566 5f66 696c 7465 7228  def coef_filter(
-0000a300: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
-0000a310: 0a20 2020 2020 2020 2072 6164 6975 733a  .        radius:
-0000a320: 2066 6c6f 6174 203d 2031 2c0d 0a20 2020   float = 1,..   
-0000a330: 2020 2020 202a 2c0d 0a20 2020 2020 2020       *,..       
-0000a340: 206d 6f64 653a 2050 6164 6469 6e67 4d6f   mode: PaddingMo
-0000a350: 6465 203d 2022 7265 666c 6563 7422 2c0d  de = "reflect",.
-0000a360: 0a20 2020 2020 2020 2063 7661 6c3a 2066  .        cval: f
-0000a370: 6c6f 6174 203d 2030 2e30 2c0d 0a20 2020  loat = 0.0,..   
-0000a380: 2020 2020 2064 696d 733a 2044 696d 7320       dims: Dims 
-0000a390: 3d20 4e6f 6e65 0d0a 2020 2020 2920 2d3e  = None..    ) ->
-0000a3a0: 2049 6d67 4172 7261 793a 0d0a 2020 2020   ImgArray:..    
-0000a3b0: 2020 2020 7222 2222 0d0a 2020 2020 2020      r"""..      
-0000a3c0: 2020 436f 6566 6669 6369 656e 7420 6f66    Coefficient of
-0000a3d0: 2076 6172 6961 6e63 6520 6669 6c74 6572   variance filter
-0000a3e0: 2e20 0d0a 2020 2020 2020 2020 0d0a 2020  . ..        ..  
-0000a3f0: 2020 2020 2020 466f 7220 6b65 726e 656c        For kernel
-0000a400: 2061 7265 6120 582c 203a 6d61 7468 3a60   area X, :math:`
-0000a410: 5c66 7261 637b 5c73 7172 747b 565b 585d  \frac{\sqrt{V[X]
-0000a420: 7d7d 7b45 5b58 5d7d 6020 6973 2063 616c  }}{E[X]}` is cal
-0000a430: 6375 6c61 7465 642e 2054 6869 7320 6669  culated. This fi
-0000a440: 6c74 6572 0d0a 2020 2020 2020 2020 6973  lter..        is
-0000a450: 2075 7365 6675 6c20 666f 7220 6665 6174   useful for feat
-0000a460: 7572 6520 6578 7472 6163 7469 6f6e 2066  ure extraction f
-0000a470: 726f 6d20 696d 6167 6573 2077 6974 6820  rom images with 
-0000a480: 756e 6576 656e 2062 6163 6b67 726f 756e  uneven backgroun
-0000a490: 6420 696e 7465 6e73 6974 792e 0d0a 0d0a  d intensity.....
-0000a4a0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-0000a4b0: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-0000a4c0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-0000a4d0: 7b72 6164 6975 737d 7b6d 6f64 657d 7b63  {radius}{mode}{c
-0000a4e0: 7661 6c7d 7b64 696d 737d 0d0a 2020 2020  val}{dims}..    
-0000a4f0: 2020 2020 0d0a 2020 2020 2020 2020 5265      ..        Re
-0000a500: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-0000a510: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-0000a520: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-0000a530: 2020 2020 2020 4669 6c74 6572 6564 2069        Filtered i
-0000a540: 6d61 6765 0d0a 2020 2020 2020 2020 2222  mage..        ""
-0000a550: 2220 2020 2020 2020 200d 0a20 2020 2020  "        ..     
-0000a560: 2020 2064 6973 6b20 3d20 5f73 7472 7563     disk = _struc
-0000a570: 7475 7265 732e 6261 6c6c 5f6c 696b 6528  tures.ball_like(
-0000a580: 7261 6469 7573 2c20 6c65 6e28 6469 6d73  radius, len(dims
-0000a590: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
-0000a5a0: 726e 2073 656c 662e 6173 5f66 6c6f 6174  rn self.as_float
-0000a5b0: 2829 2e5f 6170 706c 795f 6461 736b 280d  ()._apply_dask(.
-0000a5c0: 0a20 2020 2020 2020 2020 2020 205f 6669  .            _fi
-0000a5d0: 6c74 6572 732e 636f 6566 5f66 696c 7465  lters.coef_filte
-0000a5e0: 722c 200d 0a20 2020 2020 2020 2020 2020  r, ..           
-0000a5f0: 2063 5f61 7865 733d 636f 6d70 6c65 6d65   c_axes=compleme
-0000a600: 6e74 5f61 7865 7328 6469 6d73 2c20 7365  nt_axes(dims, se
-0000a610: 6c66 2e61 7865 7329 2c20 0d0a 2020 2020  lf.axes), ..    
-0000a620: 2020 2020 2020 2020 6172 6773 3d28 6469          args=(di
-0000a630: 736b 2c29 2c0d 0a20 2020 2020 2020 2020  sk,),..         
-0000a640: 2020 206b 7761 7267 733d 6469 6374 286d     kwargs=dict(m
-0000a650: 6f64 653d 6d6f 6465 2c20 6376 616c 3d63  ode=mode, cval=c
-0000a660: 7661 6c29 2c0d 0a20 2020 2020 2020 2029  val),..        )
-0000a670: 0d0a 2020 2020 0d0a 2020 2020 405f 646f  ..    ..    @_do
-0000a680: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
-0000a690: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
-0000a6a0: 6961 6c5f 6178 6573 0d0a 2020 2020 4063  ial_axes..    @c
-0000a6b0: 6865 636b 5f69 6e70 7574 5f61 6e64 5f6f  heck_input_and_o
-0000a6c0: 7574 7075 740d 0a20 2020 2064 6566 206d  utput..    def m
-0000a6d0: 6564 6961 6e5f 6669 6c74 6572 280d 0a20  edian_filter(.. 
-0000a6e0: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
-0000a6f0: 2020 2020 2020 7261 6469 7573 3a20 666c        radius: fl
-0000a700: 6f61 7420 3d20 312c 0d0a 2020 2020 2020  oat = 1,..      
-0000a710: 2020 2a2c 0d0a 2020 2020 2020 2020 6d6f    *,..        mo
-0000a720: 6465 3a20 5061 6464 696e 674d 6f64 6520  de: PaddingMode 
-0000a730: 3d20 2272 6566 6c65 6374 222c 0d0a 2020  = "reflect",..  
-0000a740: 2020 2020 2020 6376 616c 3a20 666c 6f61        cval: floa
-0000a750: 7420 3d20 302e 302c 0d0a 2020 2020 2020  t = 0.0,..      
-0000a760: 2020 6469 6d73 3a20 4469 6d73 203d 204e    dims: Dims = N
-0000a770: 6f6e 652c 0d0a 2020 2020 2020 2020 7570  one,..        up
-0000a780: 6461 7465 3a20 626f 6f6c 203d 2046 616c  date: bool = Fal
-0000a790: 7365 2c0d 0a20 2020 2029 202d 3e20 496d  se,..    ) -> Im
-0000a7a0: 6741 7272 6179 3a0d 0a20 2020 2020 2020  gArray:..       
-0000a7b0: 2022 2222 0d0a 2020 2020 2020 2020 5275   """..        Ru
-0000a7c0: 6e6e 696e 6720 6d75 6c74 692d 6469 6d65  nning multi-dime
-0000a7d0: 6e73 696f 6e61 6c20 6d65 6469 616e 2066  nsional median f
-0000a7e0: 696c 7465 722e 200d 0a20 2020 2020 2020  ilter. ..       
-0000a7f0: 200d 0a20 2020 2020 2020 2054 6869 7320   ..        This 
-0000a800: 6669 6c74 6572 2069 7320 7573 6566 756c  filter is useful
-0000a810: 2066 6f72 2064 656c 6574 696e 6720 6f75   for deleting ou
-0000a820: 746c 6965 7273 2067 656e 6572 6174 6564  tliers generated
-0000a830: 2062 7920 6e6f 6973 652e 0d0a 0d0a 2020   by noise.....  
-0000a840: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0000a850: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0000a860: 2d2d 2d2d 0d0a 2020 2020 2020 2020 7b72  ----..        {r
-0000a870: 6164 6975 737d 7b6d 6f64 657d 7b63 7661  adius}{mode}{cva
-0000a880: 6c7d 7b64 696d 737d 7b75 7064 6174 657d  l}{dims}{update}
-0000a890: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0000a8a0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0000a8b0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-0000a8c0: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-0000a8d0: 2020 2020 2020 2020 2020 2020 4669 6c74              Filt
-0000a8e0: 6572 6564 2069 6d61 6765 2e0d 0a20 2020  ered image...   
-0000a8f0: 2020 2020 2022 2222 2020 2020 200d 0a20       """     .. 
-0000a900: 2020 2020 2020 2064 6973 6b20 3d20 5f73         disk = _s
-0000a910: 7472 7563 7475 7265 732e 6261 6c6c 5f6c  tructures.ball_l
-0000a920: 696b 6528 7261 6469 7573 2c20 6c65 6e28  ike(radius, len(
-0000a930: 6469 6d73 2929 0d0a 2020 2020 2020 2020  dims))..        
-0000a940: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
-0000a950: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
-0000a960: 2020 2020 2020 5f66 696c 7465 7273 2e6d        _filters.m
-0000a970: 6564 6961 6e5f 6669 6c74 6572 2c20 0d0a  edian_filter, ..
-0000a980: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
-0000a990: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
-0000a9a0: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
-0000a9b0: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
-0000a9c0: 2020 2064 7479 7065 3d73 656c 662e 6474     dtype=self.dt
-0000a9d0: 7970 652c 0d0a 2020 2020 2020 2020 2020  ype,..          
-0000a9e0: 2020 6b77 6172 6773 3d64 6963 7428 666f    kwargs=dict(fo
-0000a9f0: 6f74 7072 696e 743d 6469 736b 2c20 6d6f  otprint=disk, mo
-0000aa00: 6465 3d6d 6f64 652c 2063 7661 6c3d 6376  de=mode, cval=cv
-0000aa10: 616c 292c 0d0a 2020 2020 2020 2020 290d  al),..        ).
-0000aa20: 0a20 2020 200d 0a20 2020 2040 6469 6d73  .    ..    @dims
-0000aa30: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
-0000aa40: 0d0a 2020 2020 4073 616d 655f 6474 7970  ..    @same_dtyp
-0000aa50: 650d 0a20 2020 2040 6368 6563 6b5f 696e  e..    @check_in
-0000aa60: 7075 745f 616e 645f 6f75 7470 7574 0d0a  put_and_output..
-0000aa70: 2020 2020 6465 6620 6469 616d 6574 6572      def diameter
-0000aa80: 5f6f 7065 6e69 6e67 2873 656c 662c 2064  _opening(self, d
-0000aa90: 6961 6d65 7465 723a 696e 743d 382c 202a  iameter:int=8, *
-0000aaa0: 2c20 636f 6e6e 6563 7469 7669 7479 3a69  , connectivity:i
-0000aab0: 6e74 3d31 2c20 6469 6d73 3a20 4469 6d73  nt=1, dims: Dims
-0000aac0: 203d 204e 6f6e 652c 200d 0a20 2020 2020   = None, ..     
-0000aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aae0: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
-0000aaf0: 203d 2046 616c 7365 2920 2d3e 2049 6d67   = False) -> Img
-0000ab00: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
-0000ab10: 6672 6f6d 2073 6b69 6d61 6765 2e6d 6f72  from skimage.mor
-0000ab20: 7068 6f6c 6f67 7920 696d 706f 7274 2064  phology import d
-0000ab30: 6961 6d65 7465 725f 6f70 656e 696e 670d  iameter_opening.
-0000ab40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000ab50: 7365 6c66 2e5f 6170 706c 795f 6461 736b  self._apply_dask
-0000ab60: 280d 0a20 2020 2020 2020 2020 2020 2064  (..            d
-0000ab70: 6961 6d65 7465 725f 6f70 656e 696e 672c  iameter_opening,
-0000ab80: 200d 0a20 2020 2020 2020 2020 2020 2063   ..            c
-0000ab90: 5f61 7865 733d 636f 6d70 6c65 6d65 6e74  _axes=complement
-0000aba0: 5f61 7865 7328 6469 6d73 2c20 7365 6c66  _axes(dims, self
-0000abb0: 2e61 7865 7329 2c20 0d0a 2020 2020 2020  .axes), ..      
-0000abc0: 2020 2020 2020 6b77 6172 6773 3d64 6963        kwargs=dic
-0000abd0: 7428 6469 616d 6574 6572 5f74 6872 6573  t(diameter_thres
-0000abe0: 686f 6c64 3d64 6961 6d65 7465 722c 2063  hold=diameter, c
-0000abf0: 6f6e 6e65 6374 6976 6974 793d 636f 6e6e  onnectivity=conn
-0000ac00: 6563 7469 7669 7479 290d 0a20 2020 2020  ectivity)..     
-0000ac10: 2020 2029 0d0a 2020 2020 2020 2020 0d0a     )..        ..
-0000ac20: 2020 2020 4064 696d 735f 746f 5f73 7061      @dims_to_spa
-0000ac30: 7469 616c 5f61 7865 730d 0a20 2020 2040  tial_axes..    @
-0000ac40: 7361 6d65 5f64 7479 7065 0d0a 2020 2020  same_dtype..    
-0000ac50: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
-0000ac60: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
-0000ac70: 2064 6961 6d65 7465 725f 636c 6f73 696e   diameter_closin
-0000ac80: 6728 7365 6c66 2c20 6469 616d 6574 6572  g(self, diameter
-0000ac90: 3a69 6e74 3d38 2c20 2a2c 2063 6f6e 6e65  :int=8, *, conne
-0000aca0: 6374 6976 6974 793a 696e 743d 312c 2064  ctivity:int=1, d
-0000acb0: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
-0000acc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000acd0: 2020 2020 2020 2020 2020 2020 7570 6461              upda
-0000ace0: 7465 3a20 626f 6f6c 203d 2046 616c 7365  te: bool = False
-0000acf0: 2920 2d3e 2049 6d67 4172 7261 793a 0d0a  ) -> ImgArray:..
-0000ad00: 2020 2020 2020 2020 6672 6f6d 2073 6b69          from ski
-0000ad10: 6d61 6765 2e6d 6f72 7068 6f6c 6f67 7920  mage.morphology 
-0000ad20: 696d 706f 7274 2064 6961 6d65 7465 725f  import diameter_
-0000ad30: 636c 6f73 696e 670d 0a20 2020 2020 2020  closing..       
-0000ad40: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
-0000ad50: 706c 795f 6461 736b 280d 0a20 2020 2020  ply_dask(..     
-0000ad60: 2020 2020 2020 2064 6961 6d65 7465 725f         diameter_
-0000ad70: 636c 6f73 696e 672c 200d 0a20 2020 2020  closing, ..     
-0000ad80: 2020 2020 2020 2063 5f61 7865 733d 636f         c_axes=co
-0000ad90: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
-0000ada0: 6d73 2c20 7365 6c66 2e61 7865 7329 2c20  ms, self.axes), 
-0000adb0: 0d0a 2020 2020 2020 2020 2020 2020 6b77  ..            kw
-0000adc0: 6172 6773 3d64 6963 7428 6469 616d 6574  args=dict(diamet
-0000add0: 6572 5f74 6872 6573 686f 6c64 3d64 6961  er_threshold=dia
-0000ade0: 6d65 7465 722c 2063 6f6e 6e65 6374 6976  meter, connectiv
-0000adf0: 6974 793d 636f 6e6e 6563 7469 7669 7479  ity=connectivity
-0000ae00: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
-0000ae10: 2020 0d0a 2020 2020 4064 696d 735f 746f    ..    @dims_to
-0000ae20: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
-0000ae30: 2020 2040 7361 6d65 5f64 7479 7065 0d0a     @same_dtype..
-0000ae40: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
-0000ae50: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
-0000ae60: 2064 6566 2061 7265 615f 6f70 656e 696e   def area_openin
-0000ae70: 6728 7365 6c66 2c20 6172 6561 3a69 6e74  g(self, area:int
-0000ae80: 3d36 342c 202a 2c20 636f 6e6e 6563 7469  =64, *, connecti
-0000ae90: 7669 7479 3a69 6e74 3d31 2c20 6469 6d73  vity:int=1, dims
-0000aea0: 3a20 4469 6d73 203d 204e 6f6e 652c 200d  : Dims = None, .
-0000aeb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aec0: 2020 2020 2020 7570 6461 7465 3a20 626f        update: bo
-0000aed0: 6f6c 203d 2046 616c 7365 2920 2d3e 2049  ol = False) -> I
-0000aee0: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
-0000aef0: 2020 6672 6f6d 2073 6b69 6d61 6765 2e6d    from skimage.m
-0000af00: 6f72 7068 6f6c 6f67 7920 696d 706f 7274  orphology import
-0000af10: 2072 656d 6f76 655f 736d 616c 6c5f 686f   remove_small_ho
-0000af20: 6c65 732c 2061 7265 615f 6f70 656e 696e  les, area_openin
-0000af30: 670d 0a20 2020 2020 2020 2069 6620 7365  g..        if se
-0000af40: 6c66 2e64 7479 7065 203d 3d20 626f 6f6c  lf.dtype == bool
-0000af50: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0000af60: 6574 7572 6e20 7365 6c66 2e5f 6170 706c  eturn self._appl
-0000af70: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
-0000af80: 2020 2020 2020 2020 2072 656d 6f76 655f           remove_
-0000af90: 736d 616c 6c5f 686f 6c65 732c 0d0a 2020  small_holes,..  
-0000afa0: 2020 2020 2020 2020 2020 2020 2020 635f                c_
-0000afb0: 6178 6573 3d63 6f6d 706c 656d 656e 745f  axes=complement_
-0000afc0: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-0000afd0: 6178 6573 292c 200d 0a20 2020 2020 2020  axes), ..       
-0000afe0: 2020 2020 2020 2020 206b 7761 7267 733d           kwargs=
-0000aff0: 6469 6374 2861 7265 615f 7468 7265 7368  dict(area_thresh
-0000b000: 6f6c 643d 6172 6561 2c20 636f 6e6e 6563  old=area, connec
-0000b010: 7469 7669 7479 3d63 6f6e 6e65 6374 6976  tivity=connectiv
-0000b020: 6974 7929 0d0a 2020 2020 2020 2020 2020  ity)..          
-0000b030: 2020 290d 0a20 2020 2020 2020 2065 6c73    )..        els
-0000b040: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000b050: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
-0000b060: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
-0000b070: 2020 2020 2020 2020 2020 6172 6561 5f6f            area_o
-0000b080: 7065 6e69 6e67 2c20 0d0a 2020 2020 2020  pening, ..      
-0000b090: 2020 2020 2020 2020 2020 635f 6178 6573            c_axes
-0000b0a0: 3d63 6f6d 706c 656d 656e 745f 6178 6573  =complement_axes
-0000b0b0: 2864 696d 732c 2073 656c 662e 6178 6573  (dims, self.axes
-0000b0c0: 292c 200d 0a20 2020 2020 2020 2020 2020  ), ..           
-0000b0d0: 2020 2020 206b 7761 7267 733d 6469 6374       kwargs=dict
-0000b0e0: 2861 7265 615f 7468 7265 7368 6f6c 643d  (area_threshold=
-0000b0f0: 6172 6561 2c20 636f 6e6e 6563 7469 7669  area, connectivi
-0000b100: 7479 3d63 6f6e 6e65 6374 6976 6974 7929  ty=connectivity)
-0000b110: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-0000b120: 0a20 2020 2020 2020 200d 0a20 2020 2040  .        ..    @
-0000b130: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
-0000b140: 6178 6573 0d0a 2020 2020 4073 616d 655f  axes..    @same_
-0000b150: 6474 7970 650d 0a20 2020 2040 6368 6563  dtype..    @chec
-0000b160: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-0000b170: 7574 0d0a 2020 2020 6465 6620 6172 6561  ut..    def area
-0000b180: 5f63 6c6f 7369 6e67 2873 656c 662c 2061  _closing(self, a
-0000b190: 7265 613a 696e 743d 3634 2c20 2a2c 2063  rea:int=64, *, c
-0000b1a0: 6f6e 6e65 6374 6976 6974 793a 696e 743d  onnectivity:int=
-0000b1b0: 312c 2064 696d 733a 2044 696d 7320 3d20  1, dims: Dims = 
-0000b1c0: 4e6f 6e65 2c20 0d0a 2020 2020 2020 2020  None, ..        
-0000b1d0: 2020 2020 2020 2020 2020 2020 2075 7064               upd
-0000b1e0: 6174 653a 2062 6f6f 6c20 3d20 4661 6c73  ate: bool = Fals
-0000b1f0: 6529 202d 3e20 496d 6741 7272 6179 3a0d  e) -> ImgArray:.
-0000b200: 0a20 2020 2020 2020 2066 726f 6d20 736b  .        from sk
-0000b210: 696d 6167 652e 6d6f 7270 686f 6c6f 6779  image.morphology
-0000b220: 2069 6d70 6f72 7420 7265 6d6f 7665 5f73   import remove_s
-0000b230: 6d61 6c6c 5f68 6f6c 6573 2c20 6172 6561  mall_holes, area
-0000b240: 5f63 6c6f 7369 6e67 0d0a 2020 2020 2020  _closing..      
-0000b250: 2020 6966 2073 656c 662e 6474 7970 6520    if self.dtype 
-0000b260: 3d3d 2062 6f6f 6c3a 0d0a 2020 2020 2020  == bool:..      
-0000b270: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000b280: 662e 5f61 7070 6c79 5f64 6173 6b28 0d0a  f._apply_dask(..
-0000b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2a0: 7265 6d6f 7665 5f73 6d61 6c6c 5f68 6f6c  remove_small_hol
-0000b2b0: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
-0000b2c0: 2020 2020 2063 5f61 7865 733d 636f 6d70       c_axes=comp
-0000b2d0: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
-0000b2e0: 2c20 7365 6c66 2e61 7865 7329 2c20 0d0a  , self.axes), ..
-0000b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b300: 6b77 6172 6773 3d64 6963 7428 6172 6561  kwargs=dict(area
-0000b310: 5f74 6872 6573 686f 6c64 3d61 7265 612c  _threshold=area,
-0000b320: 2063 6f6e 6e65 6374 6976 6974 793d 636f   connectivity=co
-0000b330: 6e6e 6563 7469 7669 7479 290d 0a20 2020  nnectivity)..   
-0000b340: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-0000b350: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000b360: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000b370: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
-0000b380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b390: 2061 7265 615f 636c 6f73 696e 672c 200d   area_closing, .
-0000b3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b3b0: 2063 5f61 7865 733d 636f 6d70 6c65 6d65   c_axes=compleme
-0000b3c0: 6e74 5f61 7865 7328 6469 6d73 2c20 7365  nt_axes(dims, se
-0000b3d0: 6c66 2e61 7865 7329 2c20 0d0a 2020 2020  lf.axes), ..    
-0000b3e0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-0000b3f0: 6773 3d64 6963 7428 6172 6561 5f74 6872  gs=dict(area_thr
-0000b400: 6573 686f 6c64 3d61 7265 612c 2063 6f6e  eshold=area, con
-0000b410: 6e65 6374 6976 6974 793d 636f 6e6e 6563  nectivity=connec
-0000b420: 7469 7669 7479 290d 0a20 2020 2020 2020  tivity)..       
-0000b430: 2020 2020 2029 0d0a 2020 2020 0d0a 2020       )..    ..  
-0000b440: 2020 405f 646f 6373 2e77 7269 7465 5f64    @_docs.write_d
-0000b450: 6f63 730d 0a20 2020 2040 6469 6d73 5f74  ocs..    @dims_t
-0000b460: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
-0000b470: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
-0000b480: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
-0000b490: 2064 6566 2065 6e74 726f 7079 5f66 696c   def entropy_fil
-0000b4a0: 7465 7228 7365 6c66 2c20 7261 6469 7573  ter(self, radius
-0000b4b0: 3a20 6e44 466c 6f61 7420 3d20 352c 202a  : nDFloat = 5, *
-0000b4c0: 2c20 6469 6d73 3a20 4469 6d73 203d 204e  , dims: Dims = N
-0000b4d0: 6f6e 6529 202d 3e20 496d 6741 7272 6179  one) -> ImgArray
-0000b4e0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-0000b4f0: 2020 2020 2020 2020 5275 6e6e 696e 6720          Running 
-0000b500: 656e 7472 6f70 7920 6669 6c74 6572 2e20  entropy filter. 
-0000b510: 5468 6973 2066 696c 7465 7220 6973 2075  This filter is u
-0000b520: 7365 6675 6c20 666f 7220 6465 7465 6374  seful for detect
-0000b530: 696e 6720 6368 616e 6765 2069 6e20 6261  ing change in ba
-0000b540: 636b 6772 6f75 6e64 2064 6973 7472 6962  ckground distrib
-0000b550: 7574 696f 6e2e 0d0a 0d0a 2020 2020 2020  ution.....      
-0000b560: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-0000b570: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0000b580: 0d0a 2020 2020 2020 2020 7b72 6164 6975  ..        {radiu
-0000b590: 737d 7b64 696d 737d 0d0a 0d0a 2020 2020  s}{dims}....    
-0000b5a0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0000b5b0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-0000b5c0: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-0000b5d0: 2020 2020 2020 2020 2020 2020 4669 6c74              Filt
-0000b5e0: 6572 6564 2069 6d61 6765 2e0d 0a20 2020  ered image...   
-0000b5f0: 2020 2020 2022 2222 2020 2020 2020 2020       """        
-0000b600: 0d0a 2020 2020 2020 2020 6469 736b 203d  ..        disk =
-0000b610: 205f 7374 7275 6374 7572 6573 2e62 616c   _structures.bal
-0000b620: 6c5f 6c69 6b65 2872 6164 6975 732c 206c  l_like(radius, l
-0000b630: 656e 2864 696d 7329 290d 0a20 2020 2020  en(dims))..     
-0000b640: 2020 200d 0a20 2020 2020 2020 2073 656c     ..        sel
-0000b650: 6620 3d20 7365 6c66 2e61 735f 7569 6e74  f = self.as_uint
-0000b660: 3828 290d 0a20 2020 2020 2020 2072 6574  8()..        ret
-0000b670: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
-0000b680: 6461 736b 2873 6b66 696c 2e72 616e 6b2e  dask(skfil.rank.
-0000b690: 656e 7472 6f70 792c 200d 0a20 2020 2020  entropy, ..     
-0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6b0: 2020 2020 2020 2020 2020 635f 6178 6573            c_axes
-0000b6c0: 3d63 6f6d 706c 656d 656e 745f 6178 6573  =complement_axes
-0000b6d0: 2864 696d 732c 2073 656c 662e 6178 6573  (dims, self.axes
-0000b6e0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b700: 2020 206b 7761 7267 733d 6469 6374 2866     kwargs=dict(f
-0000b710: 6f6f 7470 7269 6e74 3d64 6973 6b29 0d0a  ootprint=disk)..
-0000b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b730: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000b740: 2e61 735f 666c 6f61 7428 290d 0a20 2020  .as_float()..   
-0000b750: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
-0000b760: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
-0000b770: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
-0000b780: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
-0000b790: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
-0000b7a0: 0d0a 2020 2020 6465 6620 656e 6861 6e63  ..    def enhanc
-0000b7b0: 655f 636f 6e74 7261 7374 2873 656c 662c  e_contrast(self,
-0000b7c0: 2072 6164 6975 733a 6e44 466c 6f61 743d   radius:nDFloat=
-0000b7d0: 312c 202a 2c20 6469 6d73 3a20 4469 6d73  1, *, dims: Dims
-0000b7e0: 203d 204e 6f6e 652c 2075 7064 6174 653a   = None, update:
-0000b7f0: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
-0000b800: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
-0000b810: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0000b820: 2020 456e 6861 6e63 6520 636f 6e74 7261    Enhance contra
-0000b830: 7374 2066 696c 7465 722e 0d0a 0d0a 2020  st filter.....  
-0000b840: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0000b850: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0000b860: 2d2d 2d2d 0d0a 2020 2020 2020 2020 7b72  ----..        {r
-0000b870: 6164 6975 737d 7b64 696d 737d 7b75 7064  adius}{dims}{upd
-0000b880: 6174 657d 0d0a 0d0a 2020 2020 2020 2020  ate}....        
-0000b890: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-0000b8a0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
-0000b8b0: 2020 496d 6741 7272 6179 0d0a 2020 2020    ImgArray..    
-0000b8c0: 2020 2020 2020 2020 436f 6e74 7261 7374          Contrast
-0000b8d0: 2065 6e68 616e 6365 6420 696d 6167 652e   enhanced image.
-0000b8e0: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
-0000b8f0: 2020 2020 200d 0a20 2020 2020 2020 2064       ..        d
-0000b900: 6973 6b20 3d20 5f73 7472 7563 7475 7265  isk = _structure
-0000b910: 732e 6261 6c6c 5f6c 696b 6528 7261 6469  s.ball_like(radi
-0000b920: 7573 2c20 6c65 6e28 6469 6d73 2929 0d0a  us, len(dims))..
-0000b930: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000b940: 6474 7970 6520 3d3d 206e 702e 666c 6f61  dtype == np.floa
-0000b950: 7433 323a 0d0a 2020 2020 2020 2020 2020  t32:..          
-0000b960: 2020 616d 7020 3d20 6d61 7828 6e70 2e61    amp = max(np.a
-0000b970: 6273 2873 656c 662e 7261 6e67 6529 290d  bs(self.range)).
-0000b980: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000b990: 662e 7661 6c75 655b 3a5d 202f 3d20 616d  f.value[:] /= am
-0000b9a0: 700d 0a20 2020 2020 2020 2077 6974 6820  p..        with 
-0000b9b0: 7761 726e 696e 6773 2e63 6174 6368 5f77  warnings.catch_w
-0000b9c0: 6172 6e69 6e67 7328 293a 0d0a 2020 2020  arnings():..    
-0000b9d0: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-0000b9e0: 2e73 696d 706c 6566 696c 7465 7228 2269  .simplefilter("i
-0000b9f0: 676e 6f72 6522 290d 0a20 2020 2020 2020  gnore")..       
-0000ba00: 2020 2020 206f 7574 203d 2073 656c 662e       out = self.
-0000ba10: 5f61 7070 6c79 5f64 6173 6b28 736b 6669  _apply_dask(skfi
-0000ba20: 6c2e 7261 6e6b 2e65 6e68 616e 6365 5f63  l.rank.enhance_c
-0000ba30: 6f6e 7472 6173 742c 200d 0a20 2020 2020  ontrast, ..     
-0000ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba50: 2020 2020 2020 2020 2020 2020 2063 5f61               c_a
-0000ba60: 7865 733d 636f 6d70 6c65 6d65 6e74 5f61  xes=complement_a
-0000ba70: 7865 7328 6469 6d73 2c20 7365 6c66 2e61  xes(dims, self.a
-0000ba80: 7865 7329 2c20 0d0a 2020 2020 2020 2020  xes), ..        
-0000ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000baa0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
-0000bab0: 7365 6c66 2e64 7479 7065 2c0d 0a20 2020  self.dtype,..   
-0000bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bad0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000bae0: 7267 733d 2864 6973 6b2c 290d 0a20 2020  rgs=(disk,)..   
-0000baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000bb10: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000bb20: 662e 6474 7970 6520 3d3d 206e 702e 666c  f.dtype == np.fl
-0000bb30: 6f61 7433 323a 0d0a 2020 2020 2020 2020  oat32:..        
-0000bb40: 2020 2020 7365 6c66 2e76 616c 7565 5b3a      self.value[:
-0000bb50: 5d20 2a3d 2061 6d70 0d0a 2020 2020 2020  ] *= amp..      
-0000bb60: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
-0000bb70: 726e 206f 7574 0d0a 2020 2020 0d0a 2020  rn out..    ..  
-0000bb80: 2020 405f 646f 6373 2e77 7269 7465 5f64    @_docs.write_d
-0000bb90: 6f63 730d 0a20 2020 2040 6469 6d73 5f74  ocs..    @dims_t
-0000bba0: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
-0000bbb0: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
-0000bbc0: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
-0000bbd0: 2064 6566 206c 6170 6c61 6369 616e 5f66   def laplacian_f
-0000bbe0: 696c 7465 7228 7365 6c66 2c20 7261 6469  ilter(self, radi
-0000bbf0: 7573 3a20 696e 7420 3d20 312c 202a 2c20  us: int = 1, *, 
-0000bc00: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
-0000bc10: 652c 2075 7064 6174 653a 2062 6f6f 6c20  e, update: bool 
-0000bc20: 3d20 4661 6c73 6529 202d 3e20 496d 6741  = False) -> ImgA
-0000bc30: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
-0000bc40: 2222 0d0a 2020 2020 2020 2020 4564 6765  ""..        Edge
-0000bc50: 2064 6574 6563 7469 6f6e 2075 7369 6e67   detection using
-0000bc60: 204c 6170 6c61 6369 616e 2066 696c 7465   Laplacian filte
-0000bc70: 722e 204b 6572 6e65 6c20 6973 206d 6164  r. Kernel is mad
-0000bc80: 6520 6279 2060 736b 696d 6167 6560 2773  e by `skimage`'s
-0000bc90: 2066 756e 6374 696f 6e2e 0d0a 0d0a 2020   function.....  
-0000bca0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0000bcb0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0000bcc0: 2d2d 2d2d 0d0a 2020 2020 2020 2020 7261  ----..        ra
-0000bcd0: 6469 7573 203a 2069 6e74 2c20 6465 6661  dius : int, defa
-0000bce0: 756c 7420 6973 2031 0d0a 2020 2020 2020  ult is 1..      
-0000bcf0: 2020 2020 2020 5261 6469 7573 206f 6620        Radius of 
-0000bd00: 6b65 726e 656c 2e20 5368 6170 6520 6f66  kernel. Shape of
-0000bd10: 206b 6572 6e65 6c20 7769 6c6c 2062 6520   kernel will be 
-0000bd20: 2832 2a72 6164 6975 732b 312c 2032 2a72  (2*radius+1, 2*r
-0000bd30: 6164 6975 732b 3129 2e0d 0a20 2020 2020  adius+1)...     
-0000bd40: 2020 207b 6469 6d73 7d7b 7570 6461 7465     {dims}{update
-0000bd50: 7d0d 0a0d 0a20 2020 2020 2020 2052 6574  }....        Ret
-0000bd60: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
-0000bd70: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
-0000bd80: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
-0000bd90: 2020 2020 2046 696c 7465 7265 6420 696d       Filtered im
-0000bda0: 6167 652e 0d0a 2020 2020 2020 2020 2222  age...        ""
-0000bdb0: 2220 2020 2020 2020 200d 0a20 2020 2020  "        ..     
-0000bdc0: 2020 206e 6469 6d20 3d20 6c65 6e28 6469     ndim = len(di
-0000bdd0: 6d73 290d 0a20 2020 2020 2020 205f 2c20  ms)..        _, 
-0000bde0: 6c61 706c 6163 655f 6f70 203d 2073 6b72  laplace_op = skr
-0000bdf0: 6573 2e75 6674 2e6c 6170 6c61 6369 616e  es.uft.laplacian
-0000be00: 286e 6469 6d2c 2028 322a 7261 6469 7573  (ndim, (2*radius
-0000be10: 2b31 2c29 202a 206e 6469 6d29 0d0a 2020  +1,) * ndim)..  
-0000be20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000be30: 662e 6173 5f66 6c6f 6174 2829 2e5f 6170  f.as_float()._ap
-0000be40: 706c 795f 6461 736b 280d 0a20 2020 2020  ply_dask(..     
-0000be50: 2020 2020 2020 205f 6669 6c74 6572 732e         _filters.
-0000be60: 636f 6e76 6f6c 7665 2c20 0d0a 2020 2020  convolve, ..    
-0000be70: 2020 2020 2020 2020 635f 6178 6573 3d63          c_axes=c
-0000be80: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
-0000be90: 696d 732c 2073 656c 662e 6178 6573 292c  ims, self.axes),
-0000bea0: 200d 0a20 2020 2020 2020 2020 2020 2064   ..            d
-0000beb0: 7479 7065 3d73 656c 662e 6474 7970 652c  type=self.dtype,
-0000bec0: 0d0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
-0000bed0: 6773 3d28 6c61 706c 6163 655f 6f70 2c29  gs=(laplace_op,)
-0000bee0: 2c0d 0a20 2020 2020 2020 2020 2020 206b  ,..            k
-0000bef0: 7761 7267 733d 6469 6374 286d 6f64 653d  wargs=dict(mode=
-0000bf00: 2272 6566 6c65 6374 2229 0d0a 2020 2020  "reflect")..    
-0000bf10: 2020 2020 290d 0a20 2020 200d 0a20 2020      )..    ..   
-0000bf20: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
-0000bf30: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
-0000bf40: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
-0000bf50: 2020 2040 7361 6d65 5f64 7479 7065 2861     @same_dtype(a
-0000bf60: 7366 6c6f 6174 3d54 7275 6529 0d0a 2020  sfloat=True)..  
-0000bf70: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
-0000bf80: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
-0000bf90: 6566 206b 616c 6d61 6e5f 6669 6c74 6572  ef kalman_filter
-0000bfa0: 2873 656c 662c 2067 6169 6e3a 2066 6c6f  (self, gain: flo
-0000bfb0: 6174 203d 2030 2e38 2c20 6e6f 6973 655f  at = 0.8, noise_
-0000bfc0: 7661 723a 2066 6c6f 6174 203d 2030 2e30  var: float = 0.0
-0000bfd0: 352c 202a 2c20 616c 6f6e 673a 2073 7472  5, *, along: str
-0000bfe0: 203d 2022 7422 2c20 0d0a 2020 2020 2020   = "t", ..      
-0000bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c000: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
-0000c010: 652c 2075 7064 6174 653a 2062 6f6f 6c20  e, update: bool 
-0000c020: 3d20 4661 6c73 6529 202d 3e20 496d 6741  = False) -> ImgA
-0000c030: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
-0000c040: 2222 0d0a 2020 2020 2020 2020 4b61 6c6d  ""..        Kalm
-0000c050: 616e 2066 696c 7465 7220 666f 7220 696d  an filter for im
-0000c060: 6167 6520 736d 6f6f 7468 696e 672e 2054  age smoothing. T
-0000c070: 6869 7320 6675 6e63 7469 6f6e 2069 7320  his function is 
-0000c080: 7361 6d65 2061 7320 224b 616c 6d61 6e20  same as "Kalman 
-0000c090: 5374 6163 6b20 4669 6c74 6572 2220 696e  Stack Filter" in
-0000c0a0: 2049 6d61 6765 4a20 6275 7420 7375 7070   ImageJ but supp
-0000c0b0: 6f72 740d 0a20 2020 2020 2020 2062 6174  ort..        bat
-0000c0c0: 6368 2070 726f 6365 7373 696e 672e 2054  ch processing. T
-0000c0d0: 6869 7320 6669 6c74 6572 2069 7320 7573  his filter is us
-0000c0e0: 6566 756c 2066 6f72 2070 7265 7072 6f63  eful for preproc
-0000c0f0: 6573 7369 6e67 206f 6620 7061 7274 6963  essing of partic
-0000c100: 6c65 2074 7261 636b 696e 672e 0d0a 0d0a  le tracking.....
-0000c110: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-0000c120: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-0000c130: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-0000c140: 6761 696e 203a 2066 6c6f 6174 2c20 6465  gain : float, de
-0000c150: 6661 756c 7420 6973 2030 2e38 0d0a 2020  fault is 0.8..  
-0000c160: 2020 2020 2020 2020 2020 4669 6c74 6572            Filter
-0000c170: 2067 6169 6e2e 0d0a 2020 2020 2020 2020   gain...        
-0000c180: 6e6f 6973 655f 7661 7220 3a20 666c 6f61  noise_var : floa
-0000c190: 742c 2064 6566 6175 6c74 2069 7320 302e  t, default is 0.
-0000c1a0: 3035 0d0a 2020 2020 2020 2020 2020 2020  05..            
-0000c1b0: 496e 6974 6961 6c20 6573 7469 6d61 7465  Initial estimate
-0000c1c0: 206f 6620 6e6f 6973 6520 7661 7269 616e   of noise varian
-0000c1d0: 6365 2e0d 0a20 2020 2020 2020 2061 6c6f  ce...        alo
-0000c1e0: 6e67 203a 2073 7472 2c20 6465 6661 756c  ng : str, defaul
-0000c1f0: 7420 6973 2022 7422 0d0a 2020 2020 2020  t is "t"..      
-0000c200: 2020 2020 2020 5768 6963 6820 6178 6973        Which axis
-0000c210: 2077 696c 6c20 6265 2074 6865 2074 696d   will be the tim
-0000c220: 6520 6178 6973 2e0d 0a20 2020 2020 2020  e axis...       
-0000c230: 207b 6469 6d73 7d7b 7570 6461 7465 7d0d   {dims}{update}.
-0000c240: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0000c250: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
-0000c260: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
-0000c270: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
-0000c280: 2020 2046 696c 7465 7265 6420 696d 6167     Filtered imag
-0000c290: 650d 0a20 2020 2020 2020 2022 2222 2020  e..        """  
-0000c2a0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000c2b0: 745f 6178 6973 203d 2073 656c 662e 6178  t_axis = self.ax
-0000c2c0: 6973 6f66 2861 6c6f 6e67 290d 0a20 2020  isof(along)..   
-0000c2d0: 2020 2020 206d 696e 5f61 203d 206d 696e       min_a = min
-0000c2e0: 2873 656c 662e 6178 6973 6f66 2861 2920  (self.axisof(a) 
-0000c2f0: 666f 7220 6120 696e 2064 696d 7329 0d0a  for a in dims)..
-0000c300: 2020 2020 2020 2020 6966 2074 5f61 7869          if t_axi
-0000c310: 7320 3e20 6d69 6e5f 613a 0d0a 2020 2020  s > min_a:..    
-0000c320: 2020 2020 2020 2020 7365 6c66 203d 206e          self = n
-0000c330: 702e 7377 6170 6178 6573 2873 656c 662c  p.swapaxes(self,
-0000c340: 2074 5f61 7869 732c 206d 696e 5f61 290d   t_axis, min_a).
-0000c350: 0a20 2020 2020 2020 206f 7574 203d 2073  .        out = s
-0000c360: 656c 662e 5f61 7070 6c79 5f64 6173 6b28  elf._apply_dask(
-0000c370: 0d0a 2020 2020 2020 2020 2020 2020 5f66  ..            _f
-0000c380: 696c 7465 7273 2e6b 616c 6d61 6e5f 6669  ilters.kalman_fi
-0000c390: 6c74 6572 2c20 0d0a 2020 2020 2020 2020  lter, ..        
-0000c3a0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
-0000c3b0: 656d 656e 745f 6178 6573 285b 616c 6f6e  ement_axes([alon
-0000c3c0: 675d 202b 2064 696d 732c 2073 656c 662e  g] + dims, self.
-0000c3d0: 6178 6573 292c 200d 0a20 2020 2020 2020  axes), ..       
-0000c3e0: 2020 2020 2061 7267 733d 2867 6169 6e2c       args=(gain,
-0000c3f0: 206e 6f69 7365 5f76 6172 290d 0a20 2020   noise_var)..   
-0000c400: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000c410: 0d0a 2020 2020 2020 2020 6966 2074 5f61  ..        if t_a
-0000c420: 7869 7320 3e20 6d69 6e5f 613a 0d0a 2020  xis > min_a:..  
-0000c430: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
-0000c440: 6e70 2e73 7761 7061 7865 7328 6f75 742c  np.swapaxes(out,
-0000c450: 206d 696e 5f61 2c20 745f 6178 6973 290d   min_a, t_axis).
-0000c460: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-0000c470: 6e20 6f75 740d 0a20 2020 200d 0a20 2020  n out..    ..   
-0000c480: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
-0000c490: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
-0000c4a0: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
-0000c4b0: 7075 740d 0a20 2020 2064 6566 2066 6f63  put..    def foc
-0000c4c0: 7573 5f6d 6170 2873 656c 662c 2072 6164  us_map(self, rad
-0000c4d0: 6975 733a 2069 6e74 203d 2031 2c20 2a2c  ius: int = 1, *,
-0000c4e0: 2064 696d 733a 2044 696d 7320 3d20 3229   dims: Dims = 2)
-0000c4f0: 202d 3e20 5072 6f70 4172 7261 793a 0d0a   -> PropArray:..
-0000c500: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0000c510: 2020 2020 2043 6f6d 7075 7465 2066 6f63       Compute foc
-0000c520: 7573 206d 6170 2075 7369 6e67 2076 6172  us map using var
-0000c530: 6961 6e63 6520 6f66 204c 6170 6c61 6369  iance of Laplaci
-0000c540: 616e 206d 6574 686f 642e 2079 782d 706c  an method. yx-pl
-0000c550: 616e 6520 7769 7468 2068 6967 6865 7220  ane with higher 
-0000c560: 7661 7269 616e 6365 2069 7320 6c69 6b65  variance is like
-0000c570: 6c79 2061 0d0a 2020 2020 2020 2020 666f  ly a..        fo
-0000c580: 6361 6c20 706c 616e 6520 6265 6361 7573  cal plane becaus
-0000c590: 6520 7368 6172 7065 7220 696d 6167 6520  e sharper image 
-0000c5a0: 6361 7573 6573 2068 6967 6865 7220 7661  causes higher va
-0000c5b0: 6c75 6520 6f66 204c 6170 6c61 6369 616e  lue of Laplacian
-0000c5c0: 206f 6e20 7468 6520 6564 6765 732e 0d0a   on the edges...
-0000c5d0: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0000c5e0: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-0000c5f0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-0000c600: 2020 7261 6469 7573 203a 2069 6e74 2c20    radius : int, 
-0000c610: 6465 6661 756c 7420 6973 2031 0d0a 2020  default is 1..  
-0000c620: 2020 2020 2020 2020 2020 5261 6469 7573            Radius
-0000c630: 206f 6620 4c61 706c 6163 6961 6e20 6669   of Laplacian fi
-0000c640: 6c74 6572 2773 206b 6572 6e65 6c2e 0d0a  lter's kernel...
-0000c650: 2020 2020 2020 2020 7b64 696d 737d 0d0a          {dims}..
-0000c660: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0000c670: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-0000c680: 2d2d 0d0a 2020 2020 2020 2020 5072 6f70  --..        Prop
-0000c690: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
-0000c6a0: 2020 2041 7272 6179 206f 6620 7661 7269     Array of vari
-0000c6b0: 616e 6365 206f 6620 4c61 706c 6163 6961  ance of Laplacia
-0000c6c0: 6e0d 0a20 2020 2020 2020 200d 0a20 2020  n..        ..   
-0000c6d0: 2020 2020 2045 7861 6d70 6c65 730d 0a20       Examples.. 
-0000c6e0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0d         --------.
-0000c6f0: 0a20 2020 2020 2020 2047 6574 2074 6865  .        Get the
-0000c700: 2066 6f63 7573 2070 6c61 6e65 2066 726f   focus plane fro
-0000c710: 6d20 6120 3344 2069 6d61 6765 2e0d 0a20  m a 3D image... 
-0000c720: 2020 2020 2020 2020 2020 203e 3e3e 2073             >>> s
-0000c730: 636f 7265 203d 2069 6d67 2e66 6f63 7573  core = img.focus
-0000c740: 5f6d 6170 2829 0d0a 2020 2020 2020 2020  _map()..        
-0000c750: 2020 2020 3e3e 3e20 7363 6f72 652e 706c      >>> score.pl
-0000c760: 6f74 2829 2020 2020 2020 2020 2020 2020  ot()            
-0000c770: 2020 2023 2070 6c6f 7420 7468 6520 7661     # plot the va
-0000c780: 7269 6174 696f 6e20 6f66 206c 6170 6c61  riation of lapla
-0000c790: 6369 616e 2066 6f63 7573 0d0a 2020 2020  cian focus..    
-0000c7a0: 2020 2020 2020 2020 3e3e 3e20 7a5f 666f          >>> z_fo
-0000c7b0: 6375 7320 3d20 6e70 2e61 7267 6d61 7828  cus = np.argmax(
-0000c7c0: 7363 6f72 6529 2023 2064 6574 6572 6d69  score) # determi
-0000c7d0: 6e65 2074 6865 2066 6f63 7573 2070 6c61  ne the focus pla
-0000c7e0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0000c7f0: 3e3e 3e20 696d 675b 7a5f 666f 6375 735d  >>> img[z_focus]
-0000c800: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c810: 2067 6574 2074 6865 2066 6f63 7573 2070   get the focus p
-0000c820: 6c61 6e65 0d0a 2020 2020 2020 2020 2222  lane..        ""
-0000c830: 2220 2020 2020 2020 200d 0a20 2020 2020  "        ..     
-0000c840: 2020 2063 5f61 7865 7320 3d20 636f 6d70     c_axes = comp
-0000c850: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
-0000c860: 2c20 7365 6c66 2e61 7865 7329 0d0a 2020  , self.axes)..  
-0000c870: 2020 2020 2020 6c61 706c 6163 655f 696d        laplace_im
-0000c880: 6720 3d20 7365 6c66 2e61 735f 666c 6f61  g = self.as_floa
-0000c890: 7428 292e 6c61 706c 6163 6961 6e5f 6669  t().laplacian_fi
-0000c8a0: 6c74 6572 2872 6164 6975 732c 2064 696d  lter(radius, dim
-0000c8b0: 733d 6469 6d73 290d 0a20 2020 2020 2020  s=dims)..       
-0000c8c0: 206f 7574 203d 206e 702e 7661 7228 6c61   out = np.var(la
-0000c8d0: 706c 6163 655f 696d 672c 2061 7869 733d  place_img, axis=
-0000c8e0: 6469 6d73 290d 0a20 2020 2020 2020 206f  dims)..        o
-0000c8f0: 7574 203d 2050 726f 7041 7272 6179 286f  ut = PropArray(o
-0000c900: 7574 2e76 616c 7565 2c20 6474 7970 653d  ut.value, dtype=
-0000c910: 6e70 2e66 6c6f 6174 3332 2c20 6e61 6d65  np.float32, name
-0000c920: 3d73 656c 662e 6e61 6d65 2c20 0d0a 2020  =self.name, ..  
-0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c940: 2020 2020 2020 6178 6573 3d63 5f61 7865        axes=c_axe
-0000c950: 732c 2070 726f 706e 616d 653d 2276 6172  s, propname="var
-0000c960: 6961 6e63 655f 6f66 5f6c 6170 6c61 6369  iance_of_laplaci
-0000c970: 616e 2229 0d0a 2020 2020 2020 2020 7265  an")..        re
-0000c980: 7475 726e 206f 7574 0d0a 2020 2020 0d0a  turn out..    ..
-0000c990: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
-0000c9a0: 5f64 6f63 730d 0a20 2020 2040 7361 6d65  _docs..    @same
-0000c9b0: 5f64 7479 7065 2861 7366 6c6f 6174 3d54  _dtype(asfloat=T
-0000c9c0: 7275 6529 0d0a 2020 2020 4063 6865 636b  rue)..    @check
-0000c9d0: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
-0000c9e0: 740d 0a20 2020 2064 6566 2075 6e6d 6978  t..    def unmix
-0000c9f0: 2873 656c 662c 206d 6174 7269 782c 2062  (self, matrix, b
-0000ca00: 6720 3d20 4e6f 6e65 2c20 2a2c 2061 6c6f  g = None, *, alo
-0000ca10: 6e67 3a20 7374 7220 3d20 2263 222c 2075  ng: str = "c", u
-0000ca20: 7064 6174 653a 2062 6f6f 6c20 3d20 4661  pdate: bool = Fa
-0000ca30: 6c73 6529 202d 3e20 496d 6741 7272 6179  lse) -> ImgArray
-0000ca40: 3a0d 0a20 2020 2020 2020 2072 2222 220d  :..        r""".
-0000ca50: 0a20 2020 2020 2020 2055 6e6d 6978 2066  .        Unmix f
-0000ca60: 6c75 6f72 6573 6365 6e63 6520 6c65 616b  luorescence leak
-0000ca70: 6167 6520 6265 7477 6565 6e20 6368 616e  age between chan
-0000ca80: 6e65 6c73 2069 6e20 6120 6c69 6e65 6172  nels in a linear
-0000ca90: 2077 6179 2e20 466f 7220 6578 616d 706c   way. For exampl
-0000caa0: 652c 2061 2062 6c75 652f 6772 6565 6e20  e, a blue/green 
-0000cab0: 696d 6167 652c 0d0a 2020 2020 2020 2020  image,..        
-0000cac0: 666c 756f 7265 7363 656e 7420 6c65 616b  fluorescent leak
-0000cad0: 6167 6520 6361 6e20 6265 2077 7269 7474  age can be writt
-0000cae0: 656e 2061 7320 666f 6c6c 6f77 696e 6720  en as following 
-0000caf0: 6571 7561 7469 6f6e 3a0d 0a20 2020 2020  equation:..     
-0000cb00: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-0000cb10: 203a 6d61 7468 3a60 5c6c 6566 745c 7b5c   :math:`\left\{\
-0000cb20: 6265 6769 6e7b 6172 7261 797d 7b6c 6c7d  begin{array}{ll}
-0000cb30: 2042 5f7b 6f62 737d 203d 2042 5f7b 7265   B_{obs} = B_{re
-0000cb40: 616c 7d20 2b20 6120 5c63 646f 7420 475f  al} + a \cdot G_
-0000cb50: 7b72 6561 6c7d 2026 205c 5c47 5f7b 6f62  {real} & \\G_{ob
-0000cb60: 737d 203d 2062 205c 6364 6f74 2042 5f7b  s} = b \cdot B_{
-0000cb70: 7265 616c 7d20 2b20 475f 7b72 6561 6c7d  real} + G_{real}
-0000cb80: 2026 205c 656e 647b 6172 7261 797d 205c   & \end{array} \
-0000cb90: 7269 6768 742e 600d 0a20 2020 2020 2020  right.`..       
-0000cba0: 2020 2020 200d 0a20 2020 2020 2020 2077       ..        w
-0000cbb0: 6865 7265 2022 6f62 7322 206d 6561 6e73  here "obs" means
-0000cbc0: 206f 6273 6572 7665 6420 696e 7465 6e73   observed intens
-0000cbd0: 6974 6965 732c 2022 7265 616c 2220 6d65  ities, "real" me
-0000cbe0: 616e 7320 7468 6520 7265 616c 2069 6e74  ans the real int
-0000cbf0: 656e 7369 7479 2e20 496e 2074 6869 7320  ensity. In this 
-0000cc00: 6c69 6e65 6172 2063 6173 652c 200d 0a20  linear case, .. 
-0000cc10: 2020 2020 2020 206c 6561 6b61 6765 206d         leakage m
-0000cc20: 6174 7269 783a 0d0a 2020 2020 2020 2020  atrix:..        
-0000cc30: 0d0a 2020 2020 2020 2020 2020 2020 3a6d  ..            :m
-0000cc40: 6174 683a 604d 203d 205c 6265 6769 6e7b  ath:`M = \begin{
-0000cc50: 626d 6174 7269 787d 2031 2026 2061 205c  bmatrix} 1 & a \
-0000cc60: 5c62 2026 2031 205c 656e 647b 626d 6174  \b & 1 \end{bmat
-0000cc70: 7269 787d 205c 5c60 0d0a 2020 2020 2020  rix} \\`..      
-0000cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc90: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
-0000cca0: 2020 2020 2020 2020 2020 2020 3a6d 6174              :mat
-0000ccb0: 683a 6056 5f7b 6f62 737d 203d 204d 205c  h:`V_{obs} = M \
-0000ccc0: 6364 6f74 2056 5f7b 7265 616c 7d60 0d0a  cdot V_{real}`..
-0000ccd0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0000cce0: 2020 2020 2020 6d75 7374 2062 6520 7072        must be pr
-0000ccf0: 6564 6566 696e 6564 2e20 4966 204d 2069  edefined. If M i
-0000cd00: 7320 6769 7665 6e2c 2074 6865 6e20 7265  s given, then re
-0000cd10: 616c 2069 6e74 656e 7369 7469 6573 2063  al intensities c
-0000cd20: 616e 2062 6520 7265 7374 6f72 6564 2062  an be restored b
-0000cd30: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0000cd40: 0d0a 2020 2020 2020 2020 2020 2020 3a6d  ..            :m
-0000cd50: 6174 683a 6056 5f7b 7265 616c 7d20 3d20  ath:`V_{real} = 
-0000cd60: 4d5e 7b2d 317d 205c 6364 6f74 2056 5f7b  M^{-1} \cdot V_{
-0000cd70: 6f62 737d 600d 0a20 2020 2020 2020 200d  obs}`..        .
-0000cd80: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0000cd90: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-0000cda0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0000cdb0: 206d 6174 7269 7820 3a20 6172 7261 792d   matrix : array-
-0000cdc0: 6c69 6b65 0d0a 2020 2020 2020 2020 2020  like..          
-0000cdd0: 2020 4c65 616b 6167 6520 6d61 7472 6978    Leakage matrix
-0000cde0: 2e20 5468 6520 2869 2c20 6a29 2063 6f6d  . The (i, j) com
-0000cdf0: 706f 6e65 6e74 206f 6620 7468 6520 6d61  ponent of the ma
-0000ce00: 7472 6978 2069 7320 7468 6520 6c65 616b  trix is the leak
-0000ce10: 6167 6520 6672 6f6d 2069 2d74 6820 6368  age from i-th ch
-0000ce20: 616e 6e65 6c20 746f 0d0a 2020 2020 2020  annel to..      
-0000ce30: 2020 2020 2020 6a2d 7468 2063 6861 6e6e        j-th chann
-0000ce40: 656c 2e0d 0a20 2020 2020 2020 2062 6720  el...        bg 
-0000ce50: 3a20 6172 7261 792d 6c69 6b65 2c20 6f70  : array-like, op
-0000ce60: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-0000ce70: 2020 2020 5665 6374 6f72 206f 6620 6261      Vector of ba
-0000ce80: 636b 6772 6f75 6e64 2069 6e74 656e 7369  ckground intensi
-0000ce90: 7469 6573 2066 6f72 2065 6163 6820 6368  ties for each ch
-0000cea0: 616e 6e65 6c2e 2049 6620 6e6f 7420 6769  annel. If not gi
-0000ceb0: 7665 6e2c 2069 7420 6973 2061 7373 756d  ven, it is assum
-0000cec0: 6564 2074 6f20 6265 2074 6865 0d0a 2020  ed to be the..  
-0000ced0: 2020 2020 2020 2020 2020 6d69 6e69 6d75            minimu
-0000cee0: 6d20 7661 6c75 6520 6f66 2065 6163 6820  m value of each 
-0000cef0: 6368 616e 6e65 6c2e 0d0a 2020 2020 2020  channel...      
-0000cf00: 2020 616c 6f6e 6720 3a20 7374 722c 2064    along : str, d
-0000cf10: 6566 6175 6c74 2069 7320 2263 220d 0a20  efault is "c".. 
-0000cf20: 2020 2020 2020 2020 2020 2054 6865 2061             The a
-0000cf30: 7869 7320 6f66 2063 6861 6e6e 656c 2e0d  xis of channel..
-0000cf40: 0a20 2020 2020 2020 207b 7570 6461 7465  .        {update
-0000cf50: 7d0d 0a20 2020 2020 2020 200d 0a20 2020  }..        ..   
-0000cf60: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-0000cf70: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-0000cf80: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
-0000cf90: 0a20 2020 2020 2020 2020 2020 2055 6e6d  .            Unm
-0000cfa0: 6978 6564 2069 6d61 6765 2e0d 0a20 2020  ixed image...   
-0000cfb0: 2020 2020 200d 0a20 2020 2020 2020 2045       ..        E
-0000cfc0: 7861 6d70 6c65 730d 0a20 2020 2020 2020  xamples..       
-0000cfd0: 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020   --------..     
-0000cfe0: 2020 2043 6f6d 706c 656d 656e 7420 7468     Complement th
-0000cff0: 6520 6368 616e 6e65 6c2d 3020 746f 2063  e channel-0 to c
-0000d000: 6861 6e6e 656c 2d31 206c 6561 6b61 6765  hannel-1 leakage
-0000d010: 2e0d 0a20 2020 2020 2020 2020 2020 203e  ...            >
-0000d020: 3e3e 206d 7478 203d 205b 5b31 2e30 2c20  >> mtx = [[1.0, 
-0000d030: 302e 345d 2c0d 0a20 2020 2020 2020 2020  0.4],..         
-0000d040: 2020 203e 3e3e 2020 2020 2020 2020 5b30     >>>        [0
-0000d050: 2e30 2c20 312e 305d 5d0d 0a20 2020 2020  .0, 1.0]]..     
-0000d060: 2020 2020 2020 203e 3e3e 2062 6720 3d20         >>> bg = 
-0000d070: 5b31 3530 302c 2031 3230 305d 0d0a 2020  [1500, 1200]..  
-0000d080: 2020 2020 2020 2020 2020 3e3e 3e20 756e            >>> un
-0000d090: 6d69 7865 645f 696d 6720 3d20 696d 672e  mixed_img = img.
-0000d0a0: 756e 6d69 7828 6d74 782c 2062 6729 0d0a  unmix(mtx, bg)..
-0000d0b0: 2020 2020 2020 2020 2222 2220 2020 2020          """     
-0000d0c0: 2020 200d 0a20 2020 2020 2020 206e 5f63     ..        n_c
-0000d0d0: 686e 203d 2073 656c 662e 7369 7a65 6f66  hn = self.sizeof
-0000d0e0: 2861 6c6f 6e67 290d 0a20 2020 2020 2020  (along)..       
-0000d0f0: 2063 5f61 7820 3d20 7365 6c66 2e61 7869   c_ax = self.axi
-0000d100: 736f 6628 616c 6f6e 6729 0d0a 2020 2020  sof(along)..    
-0000d110: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
-0000d120: 6368 6563 6b20 6d61 7472 6978 2061 6e64  check matrix and
-0000d130: 2062 670d 0a20 2020 2020 2020 206d 6174   bg..        mat
-0000d140: 7269 7820 3d20 6e70 2e61 7361 7272 6179  rix = np.asarray
-0000d150: 286d 6174 7269 782c 2064 7479 7065 3d6e  (matrix, dtype=n
-0000d160: 702e 666c 6f61 7433 3229 0d0a 2020 2020  p.float32)..    
-0000d170: 2020 2020 6966 206d 6174 7269 782e 7368      if matrix.sh
-0000d180: 6170 6520 213d 2028 6e5f 6368 6e2c 206e  ape != (n_chn, n
-0000d190: 5f63 686e 293a 0d0a 2020 2020 2020 2020  _chn):..        
-0000d1a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000d1b0: 7272 6f72 2866 2260 6d61 705f 6d61 7472  rror(f"`map_matr
-0000d1c0: 6978 6020 6d75 7374 2068 6176 6520 7368  ix` must have sh
-0000d1d0: 6170 6520 7b28 6e5f 6368 6e2c 206e 5f63  ape {(n_chn, n_c
-0000d1e0: 686e 297d 2229 0d0a 2020 2020 2020 2020  hn)}")..        
-0000d1f0: 6966 2062 6720 6973 204e 6f6e 653a 0d0a  if bg is None:..
-0000d200: 2020 2020 2020 2020 2020 2020 6267 203d              bg =
-0000d210: 206e 702e 7a65 726f 7328 6e5f 6368 6e29   np.zeros(n_chn)
-0000d220: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0000d230: 0a20 2020 2020 2020 2020 2020 2062 6720  .            bg 
-0000d240: 3d20 6e70 2e61 7361 7272 6179 2862 672c  = np.asarray(bg,
-0000d250: 2064 7479 7065 3d6e 702e 666c 6f61 7433   dtype=np.float3
-0000d260: 3229 2e72 6176 656c 2829 0d0a 2020 2020  2).ravel()..    
-0000d270: 2020 2020 2020 2020 6966 2062 672e 7369          if bg.si
-0000d280: 7a65 2021 3d20 6e5f 6368 6e3a 0d0a 2020  ze != n_chn:..  
-0000d290: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000d2a0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-0000d2b0: 2260 6267 6020 6d75 7374 2068 6176 6520  "`bg` must have 
-0000d2c0: 6c65 6e67 7468 207b 6e5f 6368 6e7d 2229  length {n_chn}")
-0000d2d0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0000d2e0: 2020 2020 2320 6d6f 7665 2063 6861 6e6e      # move chann
-0000d2f0: 656c 2061 7869 7320 746f 2074 6865 206c  el axis to the l
-0000d300: 6173 740d 0a20 2020 2020 2020 2069 6e70  ast..        inp
-0000d310: 7574 5f20 3d20 6e70 2e6d 6f76 6561 7869  ut_ = np.moveaxi
-0000d320: 7328 6e70 2e61 7361 7272 6179 2873 656c  s(np.asarray(sel
-0000d330: 662c 2064 7479 7065 3d6e 702e 666c 6f61  f, dtype=np.floa
-0000d340: 7433 3229 2c20 635f 6178 2c20 2d31 290d  t32), c_ax, -1).
-0000d350: 0a20 2020 2020 2020 2023 206d 756c 7469  .        # multi
-0000d360: 706c 7920 696e 7665 7273 6520 6d61 7472  ply inverse matr
-0000d370: 6978 0d0a 2020 2020 2020 2020 6f75 7420  ix..        out 
-0000d380: 3d20 2869 6e70 7574 5f20 2d20 6267 2920  = (input_ - bg) 
-0000d390: 4020 6e70 2e6c 696e 616c 672e 696e 7628  @ np.linalg.inv(
-0000d3a0: 6d61 7472 6978 2920 2b20 6267 0d0a 2020  matrix) + bg..  
-0000d3b0: 2020 2020 2020 2320 7265 7374 6f72 6520        # restore 
-0000d3c0: 7468 6520 6178 6573 206f 7264 6572 0d0a  the axes order..
-0000d3d0: 2020 2020 2020 2020 6f75 7420 3d20 6e70          out = np
-0000d3e0: 2e6d 6f76 6561 7869 7328 6f75 742c 202d  .moveaxis(out, -
-0000d3f0: 312c 2063 5f61 7829 0d0a 2020 2020 2020  1, c_ax)..      
-0000d400: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
-0000d410: 726e 206f 7574 2e76 6965 7728 7365 6c66  rn out.view(self
-0000d420: 2e5f 5f63 6c61 7373 5f5f 290d 0a20 2020  .__class__)..   
-0000d430: 2020 2020 200d 0a20 2020 200d 0a20 2020       ..    ..   
-0000d440: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
-0000d450: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
-0000d460: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
-0000d470: 2020 2040 7361 6d65 5f64 7479 7065 2861     @same_dtype(a
-0000d480: 7366 6c6f 6174 3d54 7275 6529 0d0a 2020  sfloat=True)..  
-0000d490: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
-0000d4a0: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
-0000d4b0: 6566 2066 696c 6c5f 686f 6c65 2873 656c  ef fill_hole(sel
-0000d4c0: 662c 2074 6872 3a20 666c 6f61 747c 7374  f, thr: float|st
-0000d4d0: 7220 3d20 226f 7473 7522 2c20 2a2c 2064  r = "otsu", *, d
-0000d4e0: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
-0000d4f0: 2c20 7570 6461 7465 3a20 626f 6f6c 203d  , update: bool =
-0000d500: 2046 616c 7365 2920 2d3e 2049 6d67 4172   False) -> ImgAr
-0000d510: 7261 793a 0d0a 2020 2020 2020 2020 2222  ray:..        ""
-0000d520: 220d 0a20 2020 2020 2020 2046 696c 6c69  "..        Filli
-0000d530: 6e67 2068 6f6c 6573 2e20 5365 6520 736b  ng holes. See sk
-0000d540: 696d 6167 6527 7320 646f 6375 6d65 6e74  image's document
-0000d550: 7320 0d0a 2020 2020 2020 2020 6068 6572  s ..        `her
-0000d560: 6520 3c68 7474 7073 3a2f 2f73 6369 6b69  e <https://sciki
-0000d570: 742d 696d 6167 652e 6f72 672f 646f 6373  t-image.org/docs
-0000d580: 2f73 7461 626c 652f 6175 746f 5f65 7861  /stable/auto_exa
-0000d590: 6d70 6c65 732f 6665 6174 7572 6573 5f64  mples/features_d
-0000d5a0: 6574 6563 7469 6f6e 2f70 6c6f 745f 686f  etection/plot_ho
-0000d5b0: 6c65 735f 616e 645f 7065 616b 732e 6874  les_and_peaks.ht
-0000d5c0: 6d6c 3e60 5f2e 0d0a 0d0a 2020 2020 2020  ml>`_.....      
-0000d5d0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-0000d5e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0000d5f0: 0d0a 2020 2020 2020 2020 7468 7220 3a20  ..        thr : 
-0000d600: 7363 616c 6172 206f 7220 7374 722c 206f  scalar or str, o
-0000d610: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-0000d620: 2020 2020 2054 6872 6573 686f 6c64 2028       Threshold (
-0000d630: 7661 6c75 6520 6f72 206d 6574 686f 6429  value or method)
-0000d640: 2074 6f20 6170 706c 7920 6966 2069 6d61   to apply if ima
-0000d650: 6765 2069 7320 6e6f 7420 6269 6e61 7279  ge is not binary
-0000d660: 2e0d 0a20 2020 2020 2020 207b 6469 6d73  ...        {dims
-0000d670: 7d7b 7570 6461 7465 7d0d 0a20 2020 2020  }{update}..     
-0000d680: 2020 200d 0a20 2020 2020 2020 2052 6574     ..        Ret
-0000d690: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
-0000d6a0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
-0000d6b0: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
-0000d6c0: 2020 2020 2048 6f6c 652d 6669 6c6c 6564       Hole-filled
-0000d6d0: 2069 6d61 6765 2e0d 0a20 2020 2020 2020   image...       
-0000d6e0: 2022 2222 2020 2020 2020 2020 0d0a 2020   """        ..  
-0000d6f0: 2020 2020 2020 6966 2073 656c 662e 6474        if self.dt
-0000d700: 7970 6520 213d 2062 6f6f 6c3a 0d0a 2020  ype != bool:..  
-0000d710: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
-0000d720: 2073 656c 662e 7468 7265 7368 6f6c 6428   self.threshold(
-0000d730: 7468 723d 7468 7229 2e76 616c 7565 0d0a  thr=thr).value..
-0000d740: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000d750: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
-0000d760: 3d20 7365 6c66 2e76 616c 7565 0d0a 2020  = self.value..  
-0000d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d780: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
-0000d790: 726e 2073 656c 662e 5f61 7070 6c79 5f64  rn self._apply_d
-0000d7a0: 6173 6b28 0d0a 2020 2020 2020 2020 2020  ask(..          
-0000d7b0: 2020 5f66 696c 7465 7273 2e66 696c 6c5f    _filters.fill_
-0000d7c0: 686f 6c65 2c20 0d0a 2020 2020 2020 2020  hole, ..        
-0000d7d0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
-0000d7e0: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
-0000d7f0: 2073 656c 662e 6178 6573 292c 200d 0a20   self.axes), .. 
-0000d800: 2020 2020 2020 2020 2020 2061 7267 733d             args=
-0000d810: 286d 6173 6b2c 292c 0d0a 2020 2020 2020  (mask,),..      
-0000d820: 2020 2020 2020 6474 7970 653d 7365 6c66        dtype=self
-0000d830: 2e64 7479 7065 0d0a 2020 2020 2020 2020  .dtype..        
-0000d840: 290d 0a0d 0a20 2020 2040 5f64 6f63 732e  )....    @_docs.
-0000d850: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
-0000d860: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-0000d870: 5f61 7865 730d 0a20 2020 2040 7361 6d65  _axes..    @same
-0000d880: 5f64 7479 7065 2861 7366 6c6f 6174 3d54  _dtype(asfloat=T
-0000d890: 7275 6529 0d0a 2020 2020 4063 6865 636b  rue)..    @check
-0000d8a0: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
-0000d8b0: 740d 0a20 2020 2064 6566 2067 6175 7373  t..    def gauss
-0000d8c0: 6961 6e5f 6669 6c74 6572 2873 656c 662c  ian_filter(self,
-0000d8d0: 2073 6967 6d61 3a20 6e44 466c 6f61 7420   sigma: nDFloat 
-0000d8e0: 3d20 312c 202a 2c20 6469 6d73 3a20 4469  = 1, *, dims: Di
-0000d8f0: 6d73 203d 204e 6f6e 652c 2075 7064 6174  ms = None, updat
-0000d900: 653a 2062 6f6f 6c20 3d20 4661 6c73 6529  e: bool = False)
-0000d910: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
-0000d920: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0000d930: 2020 2020 5275 6e20 4761 7573 7369 616e      Run Gaussian
-0000d940: 2066 696c 7465 7220 2847 6175 7373 6961   filter (Gaussia
-0000d950: 6e20 626c 7572 292e 0d0a 2020 2020 2020  n blur)...      
-0000d960: 2020 0d0a 2020 2020 2020 2020 5061 7261    ..        Para
-0000d970: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
-0000d980: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-0000d990: 2020 2020 7b73 6967 6d61 7d7b 6469 6d73      {sigma}{dims
-0000d9a0: 7d7b 7570 6461 7465 7d0d 0a20 2020 2020  }{update}..     
-0000d9b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000d9c0: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
-0000d9d0: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
-0000d9e0: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
-0000d9f0: 2020 2020 2020 2020 2046 696c 7465 7265           Filtere
-0000da00: 6420 696d 6167 652e 0d0a 2020 2020 2020  d image...      
-0000da10: 2020 2222 220d 0a20 2020 2020 2020 2072    """..        r
-0000da20: 6574 7572 6e20 7365 6c66 2e5f 6170 706c  eturn self._appl
-0000da30: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
-0000da40: 2020 2020 205f 6669 6c74 6572 732e 6761       _filters.ga
-0000da50: 7573 7369 616e 5f66 696c 7465 722c 200d  ussian_filter, .
-0000da60: 0a20 2020 2020 2020 2020 2020 2063 5f61  .            c_a
-0000da70: 7865 733d 636f 6d70 6c65 6d65 6e74 5f61  xes=complement_a
-0000da80: 7865 7328 6469 6d73 2c20 7365 6c66 2e61  xes(dims, self.a
-0000da90: 7865 7329 2c20 0d0a 2020 2020 2020 2020  xes), ..        
-0000daa0: 2020 2020 6172 6773 3d28 7369 676d 612c      args=(sigma,
-0000dab0: 292c 200d 0a20 2020 2020 2020 2020 2020  ), ..           
-0000dac0: 2064 7479 7065 3d6e 702e 666c 6f61 7433   dtype=np.float3
-0000dad0: 320d 0a20 2020 2020 2020 2029 0d0a 0d0a  2..        )....
-0000dae0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
-0000daf0: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
-0000db00: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
-0000db10: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
-0000db20: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
-0000db30: 0a20 2020 2064 6566 2064 6f67 5f66 696c  .    def dog_fil
-0000db40: 7465 7228 7365 6c66 2c20 6c6f 775f 7369  ter(self, low_si
+00000aa0: 3020 2620 2020 2020 2030 2026 2020 2020  0 &      0 &    
+00000ab0: 2020 3120 205c 656e 647b 626d 6174 7269    1  \end{bmatri
+00000ac0: 787d 0d0a 2020 2020 2020 2020 2020 2020  x}..            
+00000ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ae0: 5c62 6567 696e 7b62 6d61 7472 6978 7d20  \begin{bmatrix} 
+00000af0: 7920 5c5c 785c 5c20 3120 5c65 6e64 7b62  y \\x\\ 1 \end{b
+00000b00: 6d61 7472 6978 7d0d 0a20 2020 2020 2020  matrix}..       
+00000b10: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00000b20: 0d0a 2020 2020 2020 2020 616e 6420 7369  ..        and si
+00000b30: 6d69 6c61 726c 792c 206e 2d44 2041 6666  milarly, n-D Aff
+00000b40: 696e 6520 7472 616e 7366 6f72 6d61 7469  ine transformati
+00000b50: 6f6e 2063 616e 2062 6520 6465 7363 7269  on can be descri
+00000b60: 6265 6420 6173 2028 6e2b 3129 2d44 206d  bed as (n+1)-D m
+00000b70: 6174 7269 782e 0d0a 0d0a 2020 2020 2020  atrix.....      
+00000b80: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00000b90: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00000ba0: 0d0a 2020 2020 2020 2020 6d61 7472 6978  ..        matrix
+00000bb0: 2c20 7363 616c 652c 2072 6f74 6174 696f  , scale, rotatio
+00000bc0: 6e2c 2073 6865 6172 2c20 7472 616e 736c  n, shear, transl
+00000bd0: 6174 696f 6e0d 0a20 2020 2020 2020 2020  ation..         
+00000be0: 2020 2041 6666 696e 6520 7472 616e 7366     Affine transf
+00000bf0: 6f72 6d61 7469 6f6e 2070 6172 616d 6574  ormation paramet
+00000c00: 6572 732e 2053 6565 2060 6073 6b69 6d61  ers. See ``skima
+00000c10: 6765 2e74 7261 6e73 666f 726d 2e41 6666  ge.transform.Aff
+00000c20: 696e 6554 7261 6e73 666f 726d 6060 2066  ineTransform`` f
+00000c30: 6f72 2064 6574 6169 6c73 2e0d 0a20 2020  or details...   
+00000c40: 2020 2020 207b 6f72 6465 727d 7b6d 6f64       {order}{mod
+00000c50: 657d 7b63 7661 6c7d 0d0a 2020 2020 2020  e}{cval}..      
+00000c60: 2020 6f75 7470 7574 5f73 6861 7065 203a    output_shape :
+00000c70: 2074 7570 6c65 206f 6620 696e 742c 206f   tuple of int, o
+00000c80: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+00000c90: 2020 2020 2053 6861 7065 206f 6620 6f75       Shape of ou
+00000ca0: 7470 7574 2061 7272 6179 2e0d 0a20 2020  tput array...   
+00000cb0: 2020 2020 207b 6469 6d73 7d7b 7570 6461       {dims}{upda
+00000cc0: 7465 7d0d 0a0d 0a20 2020 2020 2020 2052  te}....        R
+00000cd0: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
+00000ce0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00000cf0: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
+00000d00: 2020 2020 2020 2054 7261 6e73 666f 726d         Transform
+00000d10: 6564 2069 6d61 6765 2e0d 0a20 2020 2020  ed image...     
+00000d20: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00000d30: 6966 2075 7064 6174 6520 616e 6420 6f75  if update and ou
+00000d40: 7470 7574 5f73 6861 7065 2069 7320 6e6f  tput_shape is no
+00000d50: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00000d60: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00000d70: 4572 726f 7228 2243 616e 6e6f 7420 7570  Error("Cannot up
+00000d80: 6461 7465 2069 6d61 6765 2077 6865 6e20  date image when 
+00000d90: 6f75 7470 7574 5f73 6861 7065 2069 7320  output_shape is 
+00000da0: 7072 6f76 6964 6564 2e22 290d 0a20 2020  provided.")..   
+00000db0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00000dc0: 6365 2863 7661 6c2c 2073 7472 2920 616e  ce(cval, str) an
+00000dd0: 6420 6861 7361 7474 7228 6e70 2c20 6376  d hasattr(np, cv
+00000de0: 616c 293a 0d0a 2020 2020 2020 2020 2020  al):..          
+00000df0: 2020 6376 616c 203d 2067 6574 6174 7472    cval = getattr
+00000e00: 286e 702c 2063 7661 6c29 2873 656c 662e  (np, cval)(self.
+00000e10: 7661 6c75 6529 0d0a 2020 2020 2020 2020  value)..        
+00000e20: 656c 6966 2063 616c 6c61 626c 6528 6376  elif callable(cv
+00000e30: 616c 293a 0d0a 2020 2020 2020 2020 2020  al):..          
+00000e40: 2020 6376 616c 203d 2063 7661 6c28 7365    cval = cval(se
+00000e50: 6c66 2e76 616c 7565 290d 0a20 2020 2020  lf.value)..     
+00000e60: 2020 200d 0a20 2020 2020 2020 2070 7265     ..        pre
+00000e70: 6669 6c74 6572 203d 2070 7265 6669 6c74  filter = prefilt
+00000e80: 6572 206f 7220 6f72 6465 7220 3e20 310d  er or order > 1.
+00000e90: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00000ea0: 2020 2069 6620 7472 616e 736c 6174 696f     if translatio
+00000eb0: 6e20 6973 206e 6f74 204e 6f6e 6520 616e  n is not None an
+00000ec0: 6420 616c 6c28 6120 6973 204e 6f6e 6520  d all(a is None 
+00000ed0: 666f 7220 6120 696e 205b 6d61 7472 6978  for a in [matrix
+00000ee0: 2c20 7363 616c 652c 2072 6f74 6174 696f  , scale, rotatio
+00000ef0: 6e2c 2073 6865 6172 5d29 3a0d 0a20 2020  n, shear]):..   
+00000f00: 2020 2020 2020 2020 2073 6869 6674 203d           shift =
+00000f10: 202d 6e70 2e61 7361 7272 6179 2874 7261   -np.asarray(tra
+00000f20: 6e73 6c61 7469 6f6e 290d 0a20 2020 2020  nslation)..     
+00000f30: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00000f40: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
+00000f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000f60: 205f 7472 616e 7366 6f72 6d2e 7368 6966   _transform.shif
+00000f70: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00000f80: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
+00000f90: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
+00000fa0: 2073 656c 662e 6178 6573 292c 0d0a 2020   self.axes),..  
+00000fb0: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
+00000fc0: 6172 6773 3d64 6963 7428 7368 6966 743d  args=dict(shift=
+00000fd0: 7368 6966 742c 206f 7264 6572 3d6f 7264  shift, order=ord
+00000fe0: 6572 2c20 6d6f 6465 3d6d 6f64 652c 2063  er, mode=mode, c
+00000ff0: 7661 6c3d 6376 616c 2c20 7072 6566 696c  val=cval, prefil
+00001000: 7465 723d 7072 6566 696c 7465 7229 0d0a  ter=prefilter)..
+00001010: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00001020: 2020 2020 2020 2069 6620 6d61 7472 6978         if matrix
+00001030: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00001040: 2020 2020 2020 206d 6174 7269 7820 3d20         matrix = 
+00001050: 5f74 7261 6e73 666f 726d 2e63 6f6d 706f  _transform.compo
+00001060: 7365 5f61 6666 696e 655f 6d61 7472 6978  se_affine_matrix
+00001070: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00001080: 2020 2073 6361 6c65 3d73 6361 6c65 2c20     scale=scale, 
+00001090: 726f 7461 7469 6f6e 3d72 6f74 6174 696f  rotation=rotatio
+000010a0: 6e2c 2073 6865 6172 3d73 6865 6172 2c20  n, shear=shear, 
+000010b0: 7472 616e 736c 6174 696f 6e3d 7472 616e  translation=tran
+000010c0: 736c 6174 696f 6e2c 0d0a 2020 2020 2020  slation,..      
+000010d0: 2020 2020 2020 2020 2020 6e64 696d 3d6c            ndim=l
+000010e0: 656e 2864 696d 7329 0d0a 2020 2020 2020  en(dims)..      
+000010f0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00001100: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
+00001110: 706c 795f 6461 736b 280d 0a20 2020 2020  ply_dask(..     
+00001120: 2020 2020 2020 205f 7472 616e 7366 6f72         _transfor
+00001130: 6d2e 7761 7270 2c0d 0a20 2020 2020 2020  m.warp,..       
+00001140: 2020 2020 2063 5f61 7865 733d 636f 6d70       c_axes=comp
+00001150: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
+00001160: 2c20 7365 6c66 2e61 7865 7329 2c0d 0a20  , self.axes),.. 
+00001170: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+00001180: 733d 6469 6374 286d 6174 7269 783d 6d61  s=dict(matrix=ma
+00001190: 7472 6978 2c20 6f72 6465 723d 6f72 6465  trix, order=orde
+000011a0: 722c 206d 6f64 653d 6d6f 6465 2c20 6376  r, mode=mode, cv
+000011b0: 616c 3d63 7661 6c2c 0d0a 2020 2020 2020  al=cval,..      
+000011c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011d0: 2020 6f75 7470 7574 5f73 6861 7065 3d6f    output_shape=o
+000011e0: 7574 7075 745f 7368 6170 652c 2070 7265  utput_shape, pre
+000011f0: 6669 6c74 6572 3d70 7265 6669 6c74 6572  filter=prefilter
+00001200: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
+00001210: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
+00001220: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
+00001230: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
+00001240: 6178 6573 0d0a 2020 2020 4073 616d 655f  axes..    @same_
+00001250: 6474 7970 6528 6173 666c 6f61 743d 5472  dtype(asfloat=Tr
+00001260: 7565 290d 0a20 2020 2040 6368 6563 6b5f  ue)..    @check_
+00001270: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
+00001280: 0d0a 2020 2020 6465 6620 726f 7461 7465  ..    def rotate
+00001290: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
+000012a0: 0d0a 2020 2020 2020 2020 6465 6772 6565  ..        degree
+000012b0: 3a20 666c 6f61 742c 0d0a 2020 2020 2020  : float,..      
+000012c0: 2020 6365 6e74 6572 3a20 5365 7175 656e    center: Sequen
+000012d0: 6365 5b66 6c6f 6174 5d20 7c20 4c69 7465  ce[float] | Lite
+000012e0: 7261 6c5b 2263 656e 7465 7222 5d20 3d20  ral["center"] = 
+000012f0: 2263 656e 7465 7222 2c0d 0a20 2020 2020  "center",..     
+00001300: 2020 202a 2c0d 0a20 2020 2020 2020 206f     *,..        o
+00001310: 7264 6572 3a20 696e 7420 3d20 332c 0d0a  rder: int = 3,..
+00001320: 2020 2020 2020 2020 6d6f 6465 3a20 5061          mode: Pa
+00001330: 6464 696e 674d 6f64 6520 3d20 2263 6f6e  ddingMode = "con
+00001340: 7374 616e 7422 2c0d 0a20 2020 2020 2020  stant",..       
+00001350: 2063 7661 6c3a 2066 6c6f 6174 203d 2030   cval: float = 0
+00001360: 2c0d 0a20 2020 2020 2020 2064 696d 733a  ,..        dims:
+00001370: 2044 696d 7320 3d20 322c 0d0a 2020 2020   Dims = 2,..    
+00001380: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
+00001390: 203d 2046 616c 7365 0d0a 2020 2020 2920   = False..    ) 
+000013a0: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
+000013b0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+000013c0: 2020 2032 4420 726f 7461 7469 6f6e 206f     2D rotation o
+000013d0: 6620 616e 2069 6d61 6765 2061 726f 756e  f an image aroun
+000013e0: 6420 6120 706f 696e 742e 204f 7574 7369  d a point. Outsi
+000013f0: 6465 2077 696c 6c20 6265 2070 6164 6465  de will be padde
+00001400: 6420 7769 7468 207a 6572 6f2e 2046 6f72  d with zero. For
+00001410: 206e 2d44 2069 6d61 6765 732c 0d0a 2020   n-D images,..  
+00001420: 2020 2020 2020 7468 6973 2069 6d70 6c65        this imple
+00001430: 6d65 6e74 6174 696f 6e20 6973 2066 6173  mentation is fas
+00001440: 7465 7220 7468 616e 2060 6073 6369 7079  ter than ``scipy
+00001450: 2e6e 6469 6d61 6765 2e72 6f74 6174 6560  .ndimage.rotate`
+00001460: 602e 0d0a 0d0a 2020 2020 2020 2020 5061  `.....        Pa
+00001470: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+00001480: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00001490: 2020 2020 2020 6465 6772 6565 203a 2066        degree : f
+000014a0: 6c6f 6174 0d0a 2020 2020 2020 2020 2020  loat..          
+000014b0: 2020 436c 6f63 6b77 6973 6520 6465 6772    Clockwise degr
+000014c0: 6565 206f 6620 726f 7461 7469 6f6e 2e20  ee of rotation. 
+000014d0: 4e6f 7420 7261 6469 616e 2e0d 0a20 2020  Not radian...   
+000014e0: 2020 2020 2063 656e 7465 7220 3a20 7374       center : st
+000014f0: 7220 6f72 2061 7272 6179 2d6c 696b 652c  r or array-like,
+00001500: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
+00001510: 2020 2020 2020 2052 6f74 6174 696f 6e20         Rotation 
+00001520: 6365 6e74 6572 2063 6f6f 7264 696e 6174  center coordinat
+00001530: 652e 2042 7920 6465 6661 756c 7420 7468  e. By default th
+00001540: 6520 6365 6e74 6572 206f 6620 696d 6167  e center of imag
+00001550: 6520 7769 6c6c 2062 6520 7468 6520 726f  e will be the ro
+00001560: 7461 7469 6f6e 2063 656e 7465 722e 0d0a  tation center...
+00001570: 2020 2020 2020 2020 7b6f 7264 6572 7d7b          {order}{
+00001580: 6d6f 6465 7d7b 6376 616c 7d7b 6469 6d73  mode}{cval}{dims
+00001590: 7d7b 7570 6461 7465 7d0d 0a0d 0a20 2020  }{update}....   
+000015a0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+000015b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
+000015c0: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
+000015d0: 0a20 2020 2020 2020 2020 2020 2052 6f74  .            Rot
+000015e0: 6174 6564 2069 6d61 6765 2e0d 0a20 2020  ated image...   
+000015f0: 2020 2020 2022 2222 2020 2020 2020 2020       """        
+00001600: 0d0a 2020 2020 2020 2020 6966 2063 656e  ..        if cen
+00001610: 7465 7220 3d3d 2022 6365 6e74 6572 223a  ter == "center":
+00001620: 0d0a 2020 2020 2020 2020 2020 2020 6365  ..            ce
+00001630: 6e74 6572 203d 206e 702e 6172 7261 7928  nter = np.array(
+00001640: 7365 6c66 2e73 697a 6573 6f66 2864 696d  self.sizesof(dim
+00001650: 7329 292f 322e 202d 2030 2e35 0d0a 2020  s))/2. - 0.5..  
+00001660: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00001670: 2020 2020 2020 2020 2063 656e 7465 7220           center 
+00001680: 3d20 6e70 2e61 7361 7272 6179 2863 656e  = np.asarray(cen
+00001690: 7465 7229 0d0a 2020 2020 2020 2020 2020  ter)..          
+000016a0: 2020 0d0a 2020 2020 2020 2020 7472 616e    ..        tran
+000016b0: 736c 6174 696f 6e5f 3020 3d20 5f74 7261  slation_0 = _tra
+000016c0: 6e73 666f 726d 2e63 6f6d 706f 7365 5f61  nsform.compose_a
+000016d0: 6666 696e 655f 6d61 7472 6978 2874 7261  ffine_matrix(tra
+000016e0: 6e73 6c61 7469 6f6e 3d63 656e 7465 7229  nslation=center)
+000016f0: 0d0a 2020 2020 2020 2020 726f 7461 7469  ..        rotati
+00001700: 6f6e 203d 205f 7472 616e 7366 6f72 6d2e  on = _transform.
+00001710: 636f 6d70 6f73 655f 6166 6669 6e65 5f6d  compose_affine_m
+00001720: 6174 7269 7828 726f 7461 7469 6f6e 3d6e  atrix(rotation=n
+00001730: 702e 6465 6732 7261 6428 6465 6772 6565  p.deg2rad(degree
+00001740: 2929 0d0a 2020 2020 2020 2020 7472 616e  ))..        tran
+00001750: 736c 6174 696f 6e5f 3120 3d20 5f74 7261  slation_1 = _tra
+00001760: 6e73 666f 726d 2e63 6f6d 706f 7365 5f61  nsform.compose_a
+00001770: 6666 696e 655f 6d61 7472 6978 2874 7261  ffine_matrix(tra
+00001780: 6e73 6c61 7469 6f6e 3d2d 6365 6e74 6572  nslation=-center
+00001790: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+000017a0: 2020 2020 206d 7820 3d20 7472 616e 736c       mx = transl
+000017b0: 6174 696f 6e5f 3020 4020 726f 7461 7469  ation_0 @ rotati
+000017c0: 6f6e 2040 2074 7261 6e73 6c61 7469 6f6e  on @ translation
+000017d0: 5f31 0d0a 2020 2020 2020 2020 6d78 5b2d  _1..        mx[-
+000017e0: 312c 203a 5d20 3d20 5b30 5d20 2a20 6c65  1, :] = [0] * le
+000017f0: 6e28 6469 6d73 2920 2b20 5b31 5d0d 0a20  n(dims) + [1].. 
+00001800: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00001810: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
+00001820: 0a20 2020 2020 2020 2020 2020 205f 7472  .            _tr
+00001830: 616e 7366 6f72 6d2e 7761 7270 2c0d 0a20  ansform.warp,.. 
+00001840: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
+00001850: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
+00001860: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+00001870: 7329 2c0d 0a20 2020 2020 2020 2020 2020  s),..           
+00001880: 206b 7761 7267 733d 6469 6374 286d 6174   kwargs=dict(mat
+00001890: 7269 783d 6d78 2c20 6f72 6465 723d 6f72  rix=mx, order=or
+000018a0: 6465 722c 206d 6f64 653d 6d6f 6465 2c20  der, mode=mode, 
+000018b0: 6376 616c 3d63 7661 6c29 2c0d 0a20 2020  cval=cval),..   
+000018c0: 2020 2020 2029 0d0a 2020 2020 0d0a 2020       )..    ..  
+000018d0: 2020 405f 646f 6373 2e77 7269 7465 5f64    @_docs.write_d
+000018e0: 6f63 730d 0a20 2020 2040 6469 6d73 5f74  ocs..    @dims_t
+000018f0: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
+00001900: 2020 2020 4073 616d 655f 6474 7970 6528      @same_dtype(
+00001910: 6173 666c 6f61 743d 5472 7565 290d 0a20  asfloat=True).. 
+00001920: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
+00001930: 616e 645f 6f75 7470 7574 0d0a 2020 2020  and_output..    
+00001940: 6465 6620 7374 7265 7463 6828 0d0a 2020  def stretch(..  
+00001950: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
+00001960: 2020 2020 2073 6361 6c65 3a20 6e44 466c       scale: nDFl
+00001970: 6f61 742c 0d0a 2020 2020 2020 2020 6365  oat,..        ce
+00001980: 6e74 6572 3a20 5365 7175 656e 6365 5b66  nter: Sequence[f
+00001990: 6c6f 6174 5d20 7c20 4c69 7465 7261 6c5b  loat] | Literal[
+000019a0: 2263 656e 7465 7222 5d20 3d20 2263 656e  "center"] = "cen
+000019b0: 7465 7222 2c0d 0a20 2020 2020 2020 202a  ter",..        *
+000019c0: 2c0d 0a20 2020 2020 2020 206d 6f64 653a  ,..        mode:
+000019d0: 2050 6164 6469 6e67 4d6f 6465 203d 2022   PaddingMode = "
+000019e0: 636f 6e73 7461 6e74 222c 200d 0a20 2020  constant", ..   
+000019f0: 2020 2020 2063 7661 6c3a 2066 6c6f 6174       cval: float
+00001a00: 203d 2030 2c20 0d0a 2020 2020 2020 2020   = 0, ..        
+00001a10: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+00001a20: 652c 0d0a 2020 2020 2020 2020 6f72 6465  e,..        orde
+00001a30: 723a 2069 6e74 203d 2031 2c0d 0a20 2020  r: int = 1,..   
+00001a40: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
+00001a50: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00001a60: 2020 2020 2020 3244 2073 7472 6574 6368        2D stretch
+00001a70: 696e 6720 6f66 2061 6e20 696d 6167 6520  ing of an image 
+00001a80: 6672 6f6d 2061 2070 6f69 6e74 2e0d 0a0d  from a point....
+00001a90: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00001aa0: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
+00001ab0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00001ac0: 2073 6361 6c65 3a20 6172 7261 792d 6c69   scale: array-li
+00001ad0: 6b65 0d0a 2020 2020 2020 2020 2020 2020  ke..            
+00001ae0: 5374 7265 7463 6820 6661 6374 6f72 732e  Stretch factors.
+00001af0: 0d0a 2020 2020 2020 2020 6365 6e74 6572  ..        center
+00001b00: 203a 2073 7472 206f 7220 6172 7261 792d   : str or array-
+00001b10: 6c69 6b65 2c20 6f70 7469 6f6e 616c 0d0a  like, optional..
+00001b20: 2020 2020 2020 2020 2020 2020 526f 7461              Rota
+00001b30: 7469 6f6e 2063 656e 7465 7220 636f 6f72  tion center coor
+00001b40: 6469 6e61 7465 2e20 4279 2064 6566 6175  dinate. By defau
+00001b50: 6c74 2074 6865 2063 656e 7465 7220 6f66  lt the center of
+00001b60: 2069 6d61 6765 2077 696c 6c20 6265 2074   image will be t
+00001b70: 6865 2072 6f74 6174 696f 6e20 6365 6e74  he rotation cent
+00001b80: 6572 2e0d 0a20 2020 2020 2020 207b 6d6f  er...        {mo
+00001b90: 6465 7d7b 6376 616c 7d7b 6469 6d73 7d7b  de}{cval}{dims}{
+00001ba0: 6f72 6465 727d 0d0a 0d0a 2020 2020 2020  order}....      
+00001bb0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+00001bc0: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+00001bd0: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
+00001be0: 2020 2020 2020 2020 2020 5374 7265 7463            Stretc
+00001bf0: 6865 6420 696d 6167 652e 0d0a 2020 2020  hed image...    
+00001c00: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+00001c10: 0a20 2020 2020 2020 2069 6620 6365 6e74  .        if cent
+00001c20: 6572 203d 3d20 2263 656e 7465 7222 3a0d  er == "center":.
+00001c30: 0a20 2020 2020 2020 2020 2020 2063 656e  .            cen
+00001c40: 7465 7220 3d20 6e70 2e61 7272 6179 2873  ter = np.array(s
+00001c50: 656c 662e 7369 7a65 736f 6628 6469 6d73  elf.sizesof(dims
+00001c60: 2929 2f32 2e20 2d20 302e 350d 0a20 2020  ))/2. - 0.5..   
+00001c70: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00001c80: 2020 2020 2020 2020 6365 6e74 6572 203d          center =
+00001c90: 206e 702e 6173 6172 7261 7928 6365 6e74   np.asarray(cent
+00001ca0: 6572 290d 0a20 2020 2020 2020 200d 0a20  er)..        .. 
+00001cb0: 2020 2020 2020 2073 6361 6c65 203d 2063         scale = c
+00001cc0: 6865 636b 5f6e 6428 7363 616c 652c 206c  heck_nd(scale, l
+00001cd0: 656e 2864 696d 7329 290d 0a20 2020 2020  en(dims))..     
+00001ce0: 2020 200d 0a20 2020 2020 2020 2074 7261     ..        tra
+00001cf0: 6e73 6c61 7469 6f6e 5f30 203d 205f 7472  nslation_0 = _tr
+00001d00: 616e 7366 6f72 6d2e 636f 6d70 6f73 655f  ansform.compose_
+00001d10: 6166 6669 6e65 5f6d 6174 7269 7828 7472  affine_matrix(tr
+00001d20: 616e 736c 6174 696f 6e3d 6365 6e74 6572  anslation=center
+00001d30: 290d 0a20 2020 2020 2020 2073 7472 6574  )..        stret
+00001d40: 6368 203d 205f 7472 616e 7366 6f72 6d2e  ch = _transform.
+00001d50: 636f 6d70 6f73 655f 6166 6669 6e65 5f6d  compose_affine_m
+00001d60: 6174 7269 7828 7363 616c 653d 312f 6e70  atrix(scale=1/np
+00001d70: 2e61 7361 7272 6179 2873 6361 6c65 2929  .asarray(scale))
+00001d80: 0d0a 2020 2020 2020 2020 7472 616e 736c  ..        transl
+00001d90: 6174 696f 6e5f 3120 3d20 5f74 7261 6e73  ation_1 = _trans
+00001da0: 666f 726d 2e63 6f6d 706f 7365 5f61 6666  form.compose_aff
+00001db0: 696e 655f 6d61 7472 6978 2874 7261 6e73  ine_matrix(trans
+00001dc0: 6c61 7469 6f6e 3d2d 6365 6e74 6572 290d  lation=-center).
+00001dd0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00001de0: 2020 206d 7820 3d20 7472 616e 736c 6174     mx = translat
+00001df0: 696f 6e5f 3020 4020 7374 7265 7463 6820  ion_0 @ stretch 
+00001e00: 4020 7472 616e 736c 6174 696f 6e5f 310d  @ translation_1.
+00001e10: 0a20 2020 2020 2020 206d 785b 2d31 2c20  .        mx[-1, 
+00001e20: 3a5d 203d 205b 305d 202a 206c 656e 2864  :] = [0] * len(d
+00001e30: 696d 7329 202b 205b 315d 0d0a 2020 2020  ims) + [1]..    
+00001e40: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+00001e50: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
+00001e60: 5f64 6173 6b28 0d0a 2020 2020 2020 2020  _dask(..        
+00001e70: 2020 2020 5f74 7261 6e73 666f 726d 2e77      _transform.w
+00001e80: 6172 702c 0d0a 2020 2020 2020 2020 2020  arp,..          
+00001e90: 2020 635f 6178 6573 3d63 6f6d 706c 656d    c_axes=complem
+00001ea0: 656e 745f 6178 6573 2864 696d 732c 2073  ent_axes(dims, s
+00001eb0: 656c 662e 6178 6573 292c 0d0a 2020 2020  elf.axes),..    
+00001ec0: 2020 2020 2020 2020 6b77 6172 6773 3d64          kwargs=d
+00001ed0: 6963 7428 6d61 7472 6978 3d6d 782c 206f  ict(matrix=mx, o
+00001ee0: 7264 6572 3d6f 7264 6572 2c20 6d6f 6465  rder=order, mode
+00001ef0: 3d6d 6f64 652c 2063 7661 6c3d 6376 616c  =mode, cval=cval
+00001f00: 292c 0d0a 2020 2020 2020 2020 290d 0a0d  ),..        )...
+00001f10: 0a20 2020 2040 5f64 6f63 732e 7772 6974  .    @_docs.writ
+00001f20: 655f 646f 6373 0d0a 2020 2020 4064 696d  e_docs..    @dim
+00001f30: 735f 746f 5f73 7061 7469 616c 5f61 7865  s_to_spatial_axe
+00001f40: 730d 0a20 2020 2040 7361 6d65 5f64 7479  s..    @same_dty
+00001f50: 7065 2861 7366 6c6f 6174 3d54 7275 6529  pe(asfloat=True)
+00001f60: 0d0a 2020 2020 6465 6620 7265 7363 616c  ..    def rescal
+00001f70: 6528 0d0a 2020 2020 2020 2020 7365 6c66  e(..        self
+00001f80: 2c0d 0a20 2020 2020 2020 2073 6361 6c65  ,..        scale
+00001f90: 3a20 6e44 466c 6f61 7420 3d20 312f 3136  : nDFloat = 1/16
+00001fa0: 2c0d 0a20 2020 2020 2020 202a 2c0d 0a20  ,..        *,.. 
+00001fb0: 2020 2020 2020 206f 7264 6572 3a20 696e         order: in
+00001fc0: 7420 3d20 4e6f 6e65 2c0d 0a20 2020 2020  t = None,..     
+00001fd0: 2020 206d 6f64 653a 2050 6164 6469 6e67     mode: Padding
+00001fe0: 4d6f 6465 203d 2022 7265 666c 6563 7422  Mode = "reflect"
+00001ff0: 2c0d 0a20 2020 2020 2020 2063 7661 6c3a  ,..        cval:
+00002000: 2066 6c6f 6174 203d 2030 2e30 2c0d 0a20   float = 0.0,.. 
+00002010: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
+00002020: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2029  s = None,..    )
+00002030: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+00002040: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00002050: 2020 2020 5265 7363 616c 6520 696d 6167      Rescale imag
+00002060: 6520 6279 2061 7070 6c79 696e 6720 7468  e by applying th
+00002070: 6520 6469 6167 6f6e 616c 2063 6f6d 706f  e diagonal compo
+00002080: 6e65 6e74 206f 6620 4166 6669 6e65 206d  nent of Affine m
+00002090: 6174 7269 782e 0d0a 0d0a 2020 2020 2020  atrix.....      
+000020a0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+000020b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+000020c0: 0d0a 2020 2020 2020 2020 7363 616c 6520  ..        scale 
+000020d0: 3a20 666c 6f61 742c 206f 7074 696f 6e61  : float, optiona
+000020e0: 6c0d 0a20 2020 2020 2020 2020 2020 2052  l..            R
+000020f0: 656c 6174 6976 6520 7363 616c 6520 6f66  elative scale of
+00002100: 2074 6865 206e 6577 2069 6d61 6765 2e20   the new image. 
+00002110: 7363 616c 6520 312f 3220 6d65 616e 7320  scale 1/2 means 
+00002120: 7468 6174 2074 6865 2073 6861 7065 206f  that the shape o
+00002130: 660d 0a20 2020 2020 2020 2020 2020 2074  f..            t
+00002140: 6865 206f 7574 7075 7420 696d 6167 6520  he output image 
+00002150: 7769 6c6c 2062 6520 284e 2f32 2c20 2e2e  will be (N/2, ..
+00002160: 2e29 2e0d 0a20 2020 2020 2020 207b 6f72  .)...        {or
+00002170: 6465 727d 7b6d 6f64 657d 7b63 7661 6c7d  der}{mode}{cval}
+00002180: 7b64 696d 737d 0d0a 2020 2020 2020 2020  {dims}..        
+00002190: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000021a0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000021b0: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
+000021c0: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
+000021d0: 2020 5265 7363 616c 6564 2069 6d61 6765    Rescaled image
+000021e0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+000021f0: 2020 2020 2020 2020 7363 616c 655f 6973          scale_is
+00002200: 5f73 6571 203d 2068 6173 6174 7472 2873  _seq = hasattr(s
+00002210: 6361 6c65 2c20 225f 5f69 7465 725f 5f22  cale, "__iter__"
+00002220: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00002230: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+00002240: 6f75 7470 7574 2069 7320 746f 6f20 6c61  output is too la
+00002250: 7267 652e 0d0a 2020 2020 2020 2020 6762  rge...        gb
+00002260: 203d 202d 310d 0a20 2020 2020 2020 2069   = -1..        i
+00002270: 6620 6e6f 7420 7363 616c 655f 6973 5f73  f not scale_is_s
+00002280: 6571 2061 6e64 2073 6361 6c65 203e 2031  eq and scale > 1
+00002290: 3a0d 0a20 2020 2020 2020 2020 2020 2067  :..            g
+000022a0: 6220 3d20 6e70 2e70 726f 6428 7365 6c66  b = np.prod(self
+000022b0: 2e73 6861 7065 2920 2a20 2873 6361 6c65  .shape) * (scale
+000022c0: 202a 2a20 6c65 6e28 6469 6d73 2929 202f   ** len(dims)) /
+000022d0: 2031 6539 0d0a 2020 2020 2020 2020 656c   1e9..        el
+000022e0: 6966 2073 6361 6c65 5f69 735f 7365 7120  if scale_is_seq 
+000022f0: 616e 6420 6e70 2e70 726f 6428 6c69 7374  and np.prod(list
+00002300: 2873 6361 6c65 2929 203e 2031 3a0d 0a20  (scale)) > 1:.. 
+00002310: 2020 2020 2020 2020 2020 2067 6220 3d20             gb = 
+00002320: 6e70 2e70 726f 6428 7365 6c66 2e73 6861  np.prod(self.sha
+00002330: 7065 2920 2a20 6e70 2e70 726f 6428 6c69  pe) * np.prod(li
+00002340: 7374 2873 6361 6c65 2929 202f 2031 6539  st(scale)) / 1e9
+00002350: 0d0a 2020 2020 2020 2020 6966 2067 6220  ..        if gb 
+00002360: 3e20 436f 6e73 745b 224d 4158 5f47 4222  > Const["MAX_GB"
+00002370: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00002380: 7261 6973 6520 4d65 6d6f 7279 4572 726f  raise MemoryErro
+00002390: 7228 6622 4f75 7470 7574 2069 6d61 6765  r(f"Output image
+000023a0: 2069 7320 746f 6f20 6c61 7267 653a 207b   is too large: {
+000023b0: 6762 7d20 4742 2229 0d0a 2020 2020 2020  gb} GB")..      
+000023c0: 2020 0d0a 2020 2020 2020 2020 6966 2073    ..        if s
+000023d0: 6361 6c65 5f69 735f 7365 713a 0d0a 2020  cale_is_seq:..  
+000023e0: 2020 2020 2020 2020 2020 7363 616c 6520            scale 
+000023f0: 3d20 6c69 7374 2873 6361 6c65 290d 0a20  = list(scale).. 
+00002400: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00002410: 6e28 7363 616c 6529 2021 3d20 6c65 6e28  n(scale) != len(
+00002420: 6469 6d73 293a 0d0a 2020 2020 2020 2020  dims):..        
+00002430: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00002440: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
+00002450: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00002460: 7363 616c 6520 6d75 7374 2068 6176 6520  scale must have 
+00002470: 7468 6520 7361 6d65 206c 656e 6774 6820  the same length 
+00002480: 6173 2074 6865 2073 7061 7469 616c 2064  as the spatial d
+00002490: 696d 656e 7369 6f6e 732e 220d 0a20 2020  imensions."..   
+000024a0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+000024b0: 2020 2020 2020 2020 2020 2020 6974 203d              it =
+000024c0: 2069 7465 7228 7363 616c 6529 0d0a 2020   iter(scale)..  
+000024d0: 2020 2020 2020 2020 2020 7363 616c 655f            scale_
+000024e0: 203d 205b 6e65 7874 2869 7429 2069 6620   = [next(it) if 
+000024f0: 6120 696e 2064 696d 7320 656c 7365 2031  a in dims else 1
+00002500: 2066 6f72 2061 2069 6e20 7365 6c66 2e61   for a in self.a
+00002510: 7865 735d 0d0a 2020 2020 2020 2020 656c  xes]..        el
+00002520: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00002530: 2073 6361 6c65 5f20 3d20 5b73 6361 6c65   scale_ = [scale
+00002540: 2069 6620 6120 696e 2064 696d 7320 656c   if a in dims el
+00002550: 7365 2031 2066 6f72 2061 2069 6e20 7365  se 1 for a in se
+00002560: 6c66 2e61 7865 735d 0d0a 2020 2020 2020  lf.axes]..      
+00002570: 2020 6f75 7420 3d20 736b 7472 616e 732e    out = sktrans.
+00002580: 7265 7363 616c 6528 0d0a 2020 2020 2020  rescale(..      
+00002590: 2020 2020 2020 7365 6c66 2e76 616c 7565        self.value
+000025a0: 2c20 7363 616c 655f 2c20 6f72 6465 723d  , scale_, order=
+000025b0: 6f72 6465 722c 206d 6f64 653d 6d6f 6465  order, mode=mode
+000025c0: 2c20 6376 616c 3d63 7661 6c2c 2061 6e74  , cval=cval, ant
+000025d0: 695f 616c 6961 7369 6e67 3d46 616c 7365  i_aliasing=False
+000025e0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+000025f0: 2020 2020 206f 7574 203d 206f 7574 2e76       out = out.v
+00002600: 6965 7728 7365 6c66 2e5f 5f63 6c61 7373  iew(self.__class
+00002610: 5f5f 292e 5f73 6574 5f69 6e66 6f28 7365  __)._set_info(se
+00002620: 6c66 290d 0a20 2020 2020 2020 206f 7574  lf)..        out
+00002630: 2e61 7865 7320 3d20 7365 6c66 2e61 7865  .axes = self.axe
+00002640: 732e 636f 7079 2829 0d0a 2020 2020 2020  s.copy()..      
+00002650: 2020 6f75 742e 7365 745f 7363 616c 6528    out.set_scale(
+00002660: 7b61 3a20 7365 6c66 2e73 6361 6c65 5b61  {a: self.scale[a
+00002670: 5d2f 7363 616c 6520 666f 7220 612c 2073  ]/scale for a, s
+00002680: 6361 6c65 2069 6e20 7a69 7028 7365 6c66  cale in zip(self
+00002690: 2e61 7865 732c 2073 6361 6c65 5f29 7d29  .axes, scale_)})
+000026a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000026b0: 206f 7574 0d0a 2020 2020 0d0a 2020 2020   out..    ..    
+000026c0: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+000026d0: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+000026e0: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+000026f0: 2020 4073 616d 655f 6474 7970 650d 0a20    @same_dtype.. 
+00002700: 2020 2064 6566 2062 696e 6e69 6e67 280d     def binning(.
+00002710: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+00002720: 2020 2020 2020 2020 6269 6e73 697a 653a          binsize:
+00002730: 2069 6e74 203d 2032 2c0d 0a20 2020 2020   int = 2,..     
+00002740: 2020 206d 6574 686f 6420 3d20 226d 6561     method = "mea
+00002750: 6e22 2c20 0d0a 2020 2020 2020 2020 2a2c  n", ..        *,
+00002760: 200d 0a20 2020 2020 2020 2063 6865 636b   ..        check
+00002770: 5f65 6467 6573 3a20 626f 6f6c 203d 2054  _edges: bool = T
+00002780: 7275 652c 0d0a 2020 2020 2020 2020 6469  rue,..        di
+00002790: 6d73 3a20 4469 6d73 203d 204e 6f6e 650d  ms: Dims = None.
+000027a0: 0a20 2020 2029 202d 3e20 496d 6741 7272  .    ) -> ImgArr
+000027b0: 6179 3a0d 0a20 2020 2020 2020 2072 2222  ay:..        r""
+000027c0: 220d 0a20 2020 2020 2020 2042 696e 6e69  "..        Binni
+000027d0: 6e67 206f 6620 696d 6167 6573 2e20 5468  ng of images. Th
+000027e0: 6973 2066 756e 6374 696f 6e20 6973 2073  is function is s
+000027f0: 696d 696c 6172 2074 6f20 6060 7265 7363  imilar to ``resc
+00002800: 616c 6560 6020 6275 7420 6973 2073 7472  ale`` but is str
+00002810: 6963 746c 7920 0d0a 2020 2020 2020 2020  ictly ..        
+00002820: 6269 6e6e 6564 2062 7920 3a6d 6174 683a  binned by :math:
+00002830: 604e 205c 7469 6d65 7320 4e60 2062 6c6f  `N \times N` blo
+00002840: 636b 732e 2041 6c73 6f2c 2061 6e79 206e  cks. Also, any n
+00002850: 756d 7079 2066 756e 6374 696f 6e73 2074  umpy functions t
+00002860: 6861 7420 6163 6365 7074 200d 0a20 2020  hat accept ..   
+00002870: 2020 2020 2022 6178 6973 2220 6172 6775       "axis" argu
+00002880: 6d65 6e74 2061 7265 2073 7570 706f 7274  ment are support
+00002890: 6564 2066 6f72 2072 6564 7563 6520 6675  ed for reduce fu
+000028a0: 6e63 7469 6f6e 732e 0d0a 0d0a 2020 2020  nctions.....    
+000028b0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+000028c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000028d0: 2d2d 0d0a 2020 2020 2020 2020 6269 6e73  --..        bins
+000028e0: 697a 6520 3a20 696e 742c 2064 6566 6175  ize : int, defau
+000028f0: 6c74 2069 7320 320d 0a20 2020 2020 2020  lt is 2..       
+00002900: 2020 2020 2042 696e 2073 697a 652c 2073       Bin size, s
+00002910: 7563 6820 6173 2032 7832 2e0d 0a20 2020  uch as 2x2...   
+00002920: 2020 2020 206d 6574 686f 6420 3a20 7374       method : st
+00002930: 7220 6f72 2063 616c 6c61 626c 652c 2064  r or callable, d
+00002940: 6566 6175 6c74 2069 7320 6e75 6d70 792e  efault is numpy.
+00002950: 6d65 616e 0d0a 2020 2020 2020 2020 2020  mean..          
+00002960: 2020 5265 6475 6365 2066 756e 6374 696f    Reduce functio
+00002970: 6e20 6170 706c 6965 6420 746f 2065 6163  n applied to eac
+00002980: 6820 6269 6e2e 0d0a 2020 2020 2020 2020  h bin...        
+00002990: 6368 6563 6b5f 6564 6765 7320 3a20 626f  check_edges : bo
+000029a0: 6f6c 2c20 6465 6661 756c 7420 6973 2054  ol, default is T
+000029b0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+000029c0: 2049 6620 5472 7565 2c20 6f6e 6c79 2064   If True, only d
+000029d0: 6976 6973 6962 6c65 2060 6062 696e 7369  ivisible ``binsi
+000029e0: 7a65 6060 2069 7320 6163 6365 7074 6564  ze`` is accepted
+000029f0: 2e20 4966 2046 616c 7365 2c20 696d 6167  . If False, imag
+00002a00: 6520 6973 0d0a 2020 2020 2020 2020 2020  e is..          
+00002a10: 2020 6372 6f70 7065 6420 6174 2074 6865    cropped at the
+00002a20: 2065 6e64 2074 6f20 6d61 7463 6820 6062   end to match `b
+00002a30: 696e 7369 7a65 602e 0d0a 2020 2020 2020  insize`...      
+00002a40: 2020 7b64 696d 737d 0d0a 0d0a 2020 2020    {dims}....    
+00002a50: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00002a60: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+00002a70: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
+00002a80: 2020 2020 2020 2020 2020 2020 4269 6e6e              Binn
+00002a90: 6564 2069 6d61 6765 0d0a 2020 2020 2020  ed image..      
+00002aa0: 2020 2222 2220 0d0a 2020 2020 2020 2020    """ ..        
+00002ab0: 6966 2069 7369 6e73 7461 6e63 6528 6d65  if isinstance(me
+00002ac0: 7468 6f64 2c20 7374 7229 3a0d 0a20 2020  thod, str):..   
+00002ad0: 2020 2020 2020 2020 2062 696e 6675 6e63           binfunc
+00002ae0: 203d 2067 6574 6174 7472 286e 702c 206d   = getattr(np, m
+00002af0: 6574 686f 6429 0d0a 2020 2020 2020 2020  ethod)..        
+00002b00: 656c 6966 2063 616c 6c61 626c 6528 6d65  elif callable(me
+00002b10: 7468 6f64 293a 0d0a 2020 2020 2020 2020  thod):..        
+00002b20: 2020 2020 6269 6e66 756e 6320 3d20 6d65      binfunc = me
+00002b30: 7468 6f64 0d0a 2020 2020 2020 2020 656c  thod..        el
+00002b40: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00002b50: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+00002b60: 2822 606d 6574 686f 6460 206d 7573 7420  ("`method` must 
+00002b70: 6265 2061 206e 756d 7079 2066 756e 6374  be a numpy funct
+00002b80: 696f 6e20 6f72 2063 616c 6c61 626c 6520  ion or callable 
+00002b90: 6f62 6a65 6374 2e22 290d 0a20 2020 2020  object.")..     
+00002ba0: 2020 200d 0a20 2020 2020 2020 2069 6620     ..        if 
+00002bb0: 6269 6e73 697a 6520 3d3d 2031 3a0d 0a20  binsize == 1:.. 
+00002bc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00002bd0: 6e20 7365 6c66 0d0a 2020 2020 2020 2020  n self..        
+00002be0: 696d 675f 746f 5f72 6573 6861 7065 2c20  img_to_reshape, 
+00002bf0: 7368 6170 652c 2073 6361 6c65 5f20 3d20  shape, scale_ = 
+00002c00: 5f6d 6973 632e 6164 6a75 7374 5f62 696e  _misc.adjust_bin
+00002c10: 280d 0a20 2020 2020 2020 2020 2020 2073  (..            s
+00002c20: 656c 662e 7661 6c75 652c 2062 696e 7369  elf.value, binsi
+00002c30: 7a65 2c20 6368 6563 6b5f 6564 6765 732c  ze, check_edges,
+00002c40: 2064 696d 732c 2073 656c 662e 6178 6573   dims, self.axes
+00002c50: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+00002c60: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+00002c70: 6573 6861 7065 645f 696d 6720 3d20 696d  eshaped_img = im
+00002c80: 675f 746f 5f72 6573 6861 7065 2e72 6573  g_to_reshape.res
+00002c90: 6861 7065 2873 6861 7065 290d 0a20 2020  hape(shape)..   
+00002ca0: 2020 2020 2061 7865 735f 746f 5f72 6564       axes_to_red
+00002cb0: 7563 6520 3d20 7475 706c 6528 6920 2a20  uce = tuple(i * 
+00002cc0: 3220 2b20 3120 666f 7220 6920 696e 2072  2 + 1 for i in r
+00002cd0: 616e 6765 2873 656c 662e 6e64 696d 2929  ange(self.ndim))
+00002ce0: 0d0a 2020 2020 2020 2020 6f75 743a 206e  ..        out: n
+00002cf0: 702e 6e64 6172 7261 7920 3d20 6269 6e66  p.ndarray = binf
+00002d00: 756e 6328 7265 7368 6170 6564 5f69 6d67  unc(reshaped_img
+00002d10: 2c20 6178 6973 3d61 7865 735f 746f 5f72  , axis=axes_to_r
+00002d20: 6564 7563 6529 0d0a 2020 2020 2020 2020  educe)..        
+00002d30: 6f75 743a 2049 6d67 4172 7261 7920 3d20  out: ImgArray = 
+00002d40: 6f75 742e 7669 6577 2873 656c 662e 5f5f  out.view(self.__
+00002d50: 636c 6173 735f 5f29 0d0a 2020 2020 2020  class__)..      
+00002d60: 2020 6f75 742e 5f73 6574 5f69 6e66 6f28    out._set_info(
+00002d70: 7365 6c66 290d 0a20 2020 2020 2020 206f  self)..        o
+00002d80: 7574 2e61 7865 7320 3d20 7365 6c66 2e61  ut.axes = self.a
+00002d90: 7865 732e 636f 7079 2829 2020 2320 5f73  xes.copy()  # _s
+00002da0: 6574 5f69 6e66 6f20 646f 6573 206e 6f74  et_info does not
+00002db0: 2070 6173 7320 636f 7079 2073 6f20 6e65   pass copy so ne
+00002dc0: 7720 6178 6573 206d 7573 7420 6265 2064  w axes must be d
+00002dd0: 6566 696e 6564 2068 6572 652e 0d0a 2020  efined here...  
+00002de0: 2020 2020 2020 6f75 742e 7365 745f 7363        out.set_sc
+00002df0: 616c 6528 0d0a 2020 2020 2020 2020 2020  ale(..          
+00002e00: 2020 7b61 3a20 7365 6c66 2e73 6361 6c65    {a: self.scale
+00002e10: 5b61 5d2f 7363 616c 6520 666f 7220 612c  [a]/scale for a,
+00002e20: 2073 6361 6c65 2069 6e20 7a69 7028 7365   scale in zip(se
+00002e30: 6c66 2e61 7865 732c 2073 6361 6c65 5f29  lf.axes, scale_)
+00002e40: 7d0d 0a20 2020 2020 2020 2029 0d0a 2020  }..        )..  
+00002e50: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+00002e60: 0d0a 2020 2020 0d0a 2020 2020 405f 646f  ..    ..    @_do
+00002e70: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
+00002e80: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
+00002e90: 6961 6c5f 6178 6573 0d0a 2020 2020 6465  ial_axes..    de
+00002ea0: 6620 7261 6469 616c 5f70 726f 6669 6c65  f radial_profile
+00002eb0: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
+00002ec0: 0d0a 2020 2020 2020 2020 6e62 696e 3a20  ..        nbin: 
+00002ed0: 696e 7420 3d20 3332 2c0d 0a20 2020 2020  int = 32,..     
+00002ee0: 2020 2063 656e 7465 723a 2049 7465 7261     center: Itera
+00002ef0: 626c 655b 666c 6f61 745d 207c 204e 6f6e  ble[float] | Non
+00002f00: 6520 3d20 4e6f 6e65 2c0d 0a20 2020 2020  e = None,..     
+00002f10: 2020 2072 5f6d 6178 3a20 666c 6f61 7420     r_max: float 
+00002f20: 3d20 4e6f 6e65 2c20 0d0a 2020 2020 2020  = None, ..      
+00002f30: 2020 2a2c 200d 0a20 2020 2020 2020 206d    *, ..        m
+00002f40: 6574 686f 643a 2073 7472 203d 2022 6d65  ethod: str = "me
+00002f50: 616e 222c 0d0a 2020 2020 2020 2020 6469  an",..        di
+00002f60: 6d73 3a20 4469 6d73 203d 204e 6f6e 650d  ms: Dims = None.
+00002f70: 0a20 2020 2029 202d 3e20 5072 6f70 4172  .    ) -> PropAr
+00002f80: 7261 793a 0d0a 2020 2020 2020 2020 2222  ray:..        ""
+00002f90: 220d 0a20 2020 2020 2020 2043 616c 6375  "..        Calcu
+00002fa0: 6c61 7465 2072 6164 6961 6c20 7072 6f66  late radial prof
+00002fb0: 696c 6520 6f66 2069 6d61 6765 732e 2053  ile of images. S
+00002fc0: 6361 6c65 2061 6c6f 6e67 2065 6163 6820  cale along each 
+00002fd0: 6178 6973 2077 696c 6c20 6265 2063 6f6e  axis will be con
+00002fe0: 7369 6465 7265 642c 200d 0a20 2020 2020  sidered, ..     
+00002ff0: 2020 2069 2e65 2e2c 2072 6174 6865 7220     i.e., rather 
+00003000: 656c 6c69 7073 6f69 6461 6c20 7072 6f66  ellipsoidal prof
+00003010: 696c 6520 7769 6c6c 2062 6520 6361 6c63  ile will be calc
+00003020: 756c 6174 6564 2069 6e73 7465 6164 2069  ulated instead i
+00003030: 6620 7363 616c 6573 2061 7265 0d0a 2020  f scales are..  
+00003040: 2020 2020 2020 6469 6666 6572 656e 7420        different 
+00003050: 6265 7477 6565 6e20 6178 6573 2e0d 0a0d  between axes....
+00003060: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00003070: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
+00003080: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00003090: 206e 6269 6e20 3a20 696e 742c 2064 6566   nbin : int, def
+000030a0: 6175 6c74 2069 7320 3332 0d0a 2020 2020  ault is 32..    
+000030b0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+000030c0: 6620 6269 6e73 2e0d 0a20 2020 2020 2020  f bins...       
+000030d0: 2063 656e 7465 7220 3a20 6974 6572 6162   center : iterab
+000030e0: 6c65 206f 6620 666c 6f61 742c 206f 7074  le of float, opt
+000030f0: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
+00003100: 2020 2054 6865 2063 6f6f 7264 696e 6174     The coordinat
+00003110: 6520 6f66 2063 656e 7465 7220 6f66 2072  e of center of r
+00003120: 6164 6961 6c20 7072 6f66 696c 652e 2042  adial profile. B
+00003130: 7920 6465 6661 756c 742c 2074 6865 2063  y default, the c
+00003140: 656e 7465 7220 6f66 2069 6d61 6765 0d0a  enter of image..
+00003150: 2020 2020 2020 2020 2020 2020 6973 2075              is u
+00003160: 7365 642e 0d0a 2020 2020 2020 2020 725f  sed...        r_
+00003170: 6d61 7820 3a20 666c 6f61 742c 206f 7074  max : float, opt
+00003180: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
+00003190: 2020 204d 6178 696d 756d 2072 6164 6975     Maximum radiu
+000031a0: 7320 746f 206d 616b 6520 7072 6f66 696c  s to make profil
+000031b0: 652e 2052 6567 696f 6e20 3020 3c3d 2072  e. Region 0 <= r
+000031c0: 203c 2072 5f6d 6178 2077 696c 6c20 6265   < r_max will be
+000031d0: 2073 706c 6974 2069 6e74 6f20 0d0a 2020   split into ..  
+000031e0: 2020 2020 2020 2020 2020 6060 6e62 696e            ``nbin
+000031f0: 6060 2072 696e 6773 2028 6f72 2073 6865  `` rings (or she
+00003200: 6c6c 7329 2e20 2a2a 5363 616c 6520 6d75  lls). **Scale mu
+00003210: 7374 2062 6520 636f 6e73 6964 6572 6564  st be considered
+00003220: 2a2a 2062 6563 6175 7365 2073 6361 6c65  ** because scale
+00003230: 7320 6f66 200d 0a20 2020 2020 2020 2020  s of ..         
+00003240: 2020 2065 6163 6820 6178 6973 206d 6179     each axis may
+00003250: 2076 6172 792e 0d0a 2020 2020 2020 2020   vary...        
+00003260: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
+00003270: 6661 756c 7420 6973 2022 6d65 616e 220d  fault is "mean".
+00003280: 0a20 2020 2020 2020 2020 2020 2052 6564  .            Red
+00003290: 7563 6520 6675 6e63 7469 6f6e 2e20 4261  uce function. Ba
+000032a0: 7369 6320 7374 6174 6973 7469 6373 2066  sic statistics f
+000032b0: 756e 6374 696f 6e73 2061 7265 2073 7570  unctions are sup
+000032c0: 706f 7274 6564 2069 6e20 6060 7363 6970  ported in ``scip
+000032d0: 792e 6e64 696d 6167 6560 600d 0a20 2020  y.ndimage``..   
+000032e0: 2020 2020 2020 2020 2062 7574 2074 6865           but the
+000032f0: 6972 206e 616d 6573 2061 7265 206e 6f74  ir names are not
+00003300: 2063 6f6e 7369 7374 656e 7420 7769 7468   consistent with
+00003310: 2074 686f 7365 2069 6e20 606e 756d 7079   those in `numpy
+00003320: 602e 2055 7365 2060 6e75 6d70 7960 2773  `. Use `numpy`'s
+00003330: 206e 616d 6573 0d0a 2020 2020 2020 2020   names..        
+00003340: 2020 2020 6865 7265 2e0d 0a20 2020 2020      here...     
+00003350: 2020 207b 6469 6d73 7d0d 0a0d 0a20 2020     {dims}....   
+00003360: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+00003370: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
+00003380: 2020 2020 2020 2050 726f 7041 7272 6179         PropArray
+00003390: 0d0a 2020 2020 2020 2020 2020 2020 5261  ..            Ra
+000033a0: 6469 616c 2070 726f 6669 6c65 2073 746f  dial profile sto
+000033b0: 7265 6420 696e 2078 2d61 7869 7320 6279  red in x-axis by
+000033c0: 2064 6566 6175 6c74 2e20 4966 2069 6e70   default. If inp
+000033d0: 7574 2069 6d61 6765 2068 6173 2074 7a63  ut image has tzc
+000033e0: 7978 2d61 7865 732c 2074 6865 6e20 616e  yx-axes, then an
+000033f0: 2061 7272 6179 200d 0a20 2020 2020 2020   array ..       
+00003400: 2020 2020 2077 6974 6820 7463 782d 6178       with tcx-ax
+00003410: 6573 2077 696c 6c20 6265 2072 6574 7572  es will be retur
+00003420: 6e65 642e 0d0a 2020 2020 2020 2020 2222  ned...        ""
+00003430: 2220 2020 2020 2020 200d 0a20 2020 2020  "        ..     
+00003440: 2020 2066 756e 6320 3d20 7b22 6d65 616e     func = {"mean
+00003450: 223a 2078 702e 6e64 692e 6d65 616e 2c0d  ": xp.ndi.mean,.
+00003460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003470: 2022 7375 6d22 3a20 7870 2e6e 6469 2e73   "sum": xp.ndi.s
+00003480: 756d 5f6c 6162 656c 732c 0d0a 2020 2020  um_labels,..    
+00003490: 2020 2020 2020 2020 2020 2020 226d 6564              "med
+000034a0: 6961 6e22 3a20 7870 2e6e 6469 2e6d 6564  ian": xp.ndi.med
+000034b0: 6961 6e2c 0d0a 2020 2020 2020 2020 2020  ian,..          
+000034c0: 2020 2020 2020 226d 6178 223a 2078 702e        "max": xp.
+000034d0: 6e64 692e 6d61 7869 6d75 6d2c 0d0a 2020  ndi.maximum,..  
+000034e0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+000034f0: 696e 223a 2078 702e 6e64 692e 6d69 6e69  in": xp.ndi.mini
+00003500: 6d75 6d2c 0d0a 2020 2020 2020 2020 2020  mum,..          
+00003510: 2020 2020 2020 2273 7464 223a 2078 702e        "std": xp.
+00003520: 6e64 692e 7374 616e 6461 7264 5f64 6576  ndi.standard_dev
+00003530: 6961 7469 6f6e 2c0d 0a20 2020 2020 2020  iation,..       
+00003540: 2020 2020 2020 2020 2022 7661 7222 3a20           "var": 
+00003550: 7870 2e6e 6469 2e76 6172 6961 6e63 657d  xp.ndi.variance}
+00003560: 5b6d 6574 686f 645d 0d0a 2020 2020 2020  [method]..      
+00003570: 2020 0d0a 2020 2020 2020 2020 7370 6174    ..        spat
+00003580: 6961 6c5f 7368 6170 6520 3d20 7365 6c66  ial_shape = self
+00003590: 2e73 697a 6573 6f66 2864 696d 7329 0d0a  .sizesof(dims)..
+000035a0: 2020 2020 2020 2020 696e 6473 203d 2078          inds = x
+000035b0: 702e 696e 6469 6365 7328 7370 6174 6961  p.indices(spatia
+000035c0: 6c5f 7368 6170 6529 0d0a 2020 2020 2020  l_shape)..      
+000035d0: 2020 0d0a 2020 2020 2020 2020 2320 6368    ..        # ch
+000035e0: 6563 6b20 6365 6e74 6572 0d0a 2020 2020  eck center..    
+000035f0: 2020 2020 6966 2063 656e 7465 7220 6973      if center is
+00003600: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00003610: 2020 2020 6365 6e74 6572 203d 205b 732f      center = [s/
+00003620: 3220 666f 7220 7320 696e 2073 7061 7469  2 for s in spati
+00003630: 616c 5f73 6861 7065 5d0d 0a20 2020 2020  al_shape]..     
+00003640: 2020 2065 6c69 6620 6c65 6e28 6365 6e74     elif len(cent
+00003650: 6572 2920 213d 206c 656e 2864 696d 7329  er) != len(dims)
+00003660: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00003670: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00003680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003690: 2020 6622 4c65 6e67 7468 206f 6620 6063    f"Length of `c
+000036a0: 656e 7465 7260 206d 7573 7420 6d61 7463  enter` must matc
+000036b0: 6820 696e 7075 7420 6469 6d65 6e73 696f  h input dimensio
+000036c0: 6e61 6c69 7479 2027 7b64 696d 737d 272e  nality '{dims}'.
+000036d0: 220d 0a20 2020 2020 2020 2020 2020 2029  "..            )
+000036e0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000036f0: 2020 2020 7220 3d20 7870 2e73 7172 7428      r = xp.sqrt(
+00003700: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+00003710: 6d28 2828 7820 2d20 6329 2a73 656c 662e  m(((x - c)*self.
+00003720: 7363 616c 655b 615d 292a 2a32 2066 6f72  scale[a])**2 for
+00003730: 2078 2c20 632c 2061 2069 6e20 7a69 7028   x, c, a in zip(
+00003740: 696e 6473 2c20 6365 6e74 6572 2c20 6469  inds, center, di
+00003750: 6d73 2929 0d0a 2020 2020 2020 2020 290d  ms))..        ).
+00003760: 0a20 2020 2020 2020 2072 5f6c 696d 203d  .        r_lim =
+00003770: 2072 2e6d 6178 2829 0d0a 2020 2020 2020   r.max()..      
+00003780: 2020 0d0a 2020 2020 2020 2020 2320 6368    ..        # ch
+00003790: 6563 6b20 725f 6d61 780d 0a20 2020 2020  eck r_max..     
+000037a0: 2020 2069 6620 725f 6d61 7820 6973 204e     if r_max is N
+000037b0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000037c0: 2020 725f 6d61 7820 3d20 725f 6c69 6d0d    r_max = r_lim.
+000037d0: 0a20 2020 2020 2020 2065 6c69 6620 725f  .        elif r_
+000037e0: 6d61 7820 3e20 725f 6c69 6d20 6f72 2072  max > r_lim or r
+000037f0: 5f6d 6178 203c 3d20 303a 0d0a 2020 2020  _max <= 0:..    
+00003800: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00003810: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
+00003820: 2020 2020 2020 2020 2020 2066 2260 725f             f"`r_
+00003830: 6d61 7860 206d 7573 7420 6265 2069 6e20  max` must be in 
+00003840: 7261 6e67 6520 6f66 2030 203c 2072 5f6d  range of 0 < r_m
+00003850: 6178 203c 3d20 7b72 5f6c 696d 7d20 7769  ax <= {r_lim} wi
+00003860: 7468 2074 6869 7320 696d 6167 652e 220d  th this image.".
+00003870: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00003880: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00003890: 2020 2320 6d61 6b65 2072 6164 6961 6c6c    # make radiall
+000038a0: 7920 7365 7061 7261 7465 6420 6c61 6265  y separated labe
+000038b0: 6c73 0d0a 2020 2020 2020 2020 725f 7265  ls..        r_re
+000038c0: 6c20 3d20 722f 725f 6d61 780d 0a20 2020  l = r/r_max..   
+000038d0: 2020 2020 206c 6162 656c 7320 3d20 286e       labels = (n
+000038e0: 6269 6e20 2a20 725f 7265 6c29 2e61 7374  bin * r_rel).ast
+000038f0: 7970 6528 6e70 2e75 696e 7431 3629 202b  ype(np.uint16) +
+00003900: 2031 0d0a 2020 2020 2020 2020 6c61 6265   1..        labe
+00003910: 6c73 5b72 5f72 656c 203e 3d20 315d 203d  ls[r_rel >= 1] =
+00003920: 2030 0d0a 2020 2020 2020 2020 0d0a 2020   0..        ..  
+00003930: 2020 2020 2020 635f 6178 6573 203d 2063        c_axes = c
+00003940: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
+00003950: 696d 732c 2073 656c 662e 6178 6573 290d  ims, self.axes).
+00003960: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00003970: 2020 206f 7574 203d 2050 726f 7041 7272     out = PropArr
+00003980: 6179 280d 0a20 2020 2020 2020 2020 2020  ay(..           
+00003990: 206e 702e 656d 7074 7928 7365 6c66 2e73   np.empty(self.s
+000039a0: 697a 6573 6f66 2863 5f61 7865 7329 2b28  izesof(c_axes)+(
+000039b0: 696e 7428 6c61 6265 6c73 2e6d 6178 2829  int(labels.max()
+000039c0: 292c 2929 2c0d 0a20 2020 2020 2020 2020  ),)),..         
+000039d0: 2020 2064 7479 7065 3d6e 702e 666c 6f61     dtype=np.floa
+000039e0: 7433 322c 0d0a 2020 2020 2020 2020 2020  t32,..          
+000039f0: 2020 6178 6573 3d63 5f61 7865 7320 2b20    axes=c_axes + 
+00003a00: 5b64 696d 735b 2d31 5d5d 2c20 0d0a 2020  [dims[-1]], ..  
+00003a10: 2020 2020 2020 2020 2020 736f 7572 6365            source
+00003a20: 3d73 656c 662e 736f 7572 6365 2c20 0d0a  =self.source, ..
+00003a30: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+00003a40: 6461 7461 3d73 656c 662e 6d65 7461 6461  data=self.metada
+00003a50: 7461 2c20 0d0a 2020 2020 2020 2020 2020  ta, ..          
+00003a60: 2020 7072 6f70 6e61 6d65 3d22 7261 6469    propname="radi
+00003a70: 616c 5f70 726f 6669 6c65 220d 0a20 2020  al_profile"..   
+00003a80: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00003a90: 7261 6469 616c 5f66 756e 6320 3d20 7061  radial_func = pa
+00003aa0: 7274 6961 6c28 6375 7079 5f64 6973 7061  rtial(cupy_dispa
+00003ab0: 7463 6865 7228 6675 6e63 292c 206c 6162  tcher(func), lab
+00003ac0: 656c 733d 6c61 6265 6c73 2c20 696e 6465  els=labels, inde
+00003ad0: 783d 7870 2e61 7261 6e67 6528 312c 206c  x=xp.arange(1, l
+00003ae0: 6162 656c 732e 6d61 7828 292b 3129 290d  abels.max()+1)).
+00003af0: 0a20 2020 2020 2020 2066 6f72 2073 6c2c  .        for sl,
+00003b00: 2069 6d67 2069 6e20 7365 6c66 2e69 7465   img in self.ite
+00003b10: 7228 635f 6178 6573 2c20 6578 636c 7564  r(c_axes, exclud
+00003b20: 653d 6469 6d73 293a 0d0a 2020 2020 2020  e=dims):..      
+00003b30: 2020 2020 2020 6f75 745b 736c 5d20 3d20        out[sl] = 
+00003b40: 7870 2e61 736e 756d 7079 2872 6164 6961  xp.asnumpy(radia
+00003b50: 6c5f 6675 6e63 2869 6d67 2929 0d0a 2020  l_func(img))..  
+00003b60: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+00003b70: 0d0a 2020 2020 0d0a 2020 2020 4064 696d  ..    ..    @dim
+00003b80: 735f 746f 5f73 7061 7469 616c 5f61 7865  s_to_spatial_axe
+00003b90: 730d 0a20 2020 2064 6566 2067 6175 7373  s..    def gauss
+00003ba0: 6669 7428 0d0a 2020 2020 2020 2020 7365  fit(..        se
+00003bb0: 6c66 2c0d 0a20 2020 2020 2020 2073 6361  lf,..        sca
+00003bc0: 6c65 3a20 666c 6f61 7420 3d20 312f 3136  le: float = 1/16
+00003bd0: 2c0d 0a20 2020 2020 2020 2070 303a 2053  ,..        p0: S
+00003be0: 6571 7565 6e63 655b 666c 6f61 745d 207c  equence[float] |
+00003bf0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0d 0a20   None = None,.. 
+00003c00: 2020 2020 2020 206d 6574 686f 643a 2073         method: s
+00003c10: 7472 203d 2022 506f 7765 6c6c 222c 0d0a  tr = "Powell",..
+00003c20: 2020 2020 2020 2020 6d61 736b 3a20 6e70          mask: np
+00003c30: 2e6e 6461 7272 6179 207c 204e 6f6e 6520  .ndarray | None 
+00003c40: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
+00003c50: 2064 696d 733a 2044 696d 7320 3d20 2279   dims: Dims = "y
+00003c60: 7822 2c0d 0a20 2020 2029 202d 3e20 496d  x",..    ) -> Im
+00003c70: 6741 7272 6179 3a0d 0a20 2020 2020 2020  gArray:..       
+00003c80: 2022 2222 0d0a 2020 2020 2020 2020 4669   """..        Fi
+00003c90: 7420 7468 6520 696d 6167 6520 746f 2032  t the image to 2
+00003ca0: 2d44 2047 6175 7373 6961 6e20 6261 636b  -D Gaussian back
+00003cb0: 6772 6f75 6e64 2e0d 0a0d 0a20 2020 2020  ground.....     
+00003cc0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+00003cd0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00003ce0: 2d0d 0a20 2020 2020 2020 2073 6361 6c65  -..        scale
+00003cf0: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+00003d00: 7420 6973 2031 2f31 362e 0d0a 2020 2020  t is 1/16...    
+00003d10: 2020 2020 2020 2020 5363 616c 6520 6f66          Scale of
+00003d20: 2072 6f75 6768 2069 6d61 6765 2028 746f   rough image (to
+00003d30: 2073 7065 6564 2075 7020 6669 7474 696e   speed up fittin
+00003d40: 6729 2e0d 0a20 2020 2020 2020 2070 3020  g)...        p0 
+00003d50: 3a20 7365 7175 656e 6365 206f 6620 666c  : sequence of fl
+00003d60: 6f61 742c 206f 7074 696f 6e61 6c0d 0a20  oat, optional.. 
+00003d70: 2020 2020 2020 2020 2020 2049 6e69 7469             Initi
+00003d80: 616c 2070 6172 616d 6574 6572 732e 0d0a  al parameters...
+00003d90: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+00003da0: 2073 7472 2c20 6f70 7469 6f6e 616c 0d0a   str, optional..
+00003db0: 2020 2020 2020 2020 2020 2020 4669 7474              Fitt
+00003dc0: 696e 6720 6d65 7468 6f64 2e20 5365 6520  ing method. See 
+00003dd0: 6073 6369 7079 2e6f 7074 696d 697a 652e  `scipy.optimize.
+00003de0: 6d69 6e69 6d69 7a65 602e 0d0a 2020 2020  minimize`...    
+00003df0: 2020 2020 6d61 736b 203a 206e 702e 6e64      mask : np.nd
+00003e00: 6172 7261 792c 206f 7074 696f 6e61 6c2c  array, optional,
+00003e10: 0d0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+00003e20: 2067 6976 656e 2c20 6967 6e6f 7265 2074   given, ignore t
+00003e30: 6865 2054 7275 6520 7265 6769 6f6e 2066  he True region f
+00003e40: 726f 6d20 6669 7474 696e 672e 0d0a 2020  rom fitting...  
+00003e50: 2020 2020 2020 7b64 696d 737d 0d0a 0d0a        {dims}....
+00003e60: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
+00003e70: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00003e80: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
+00003e90: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+00003ea0: 4669 7420 696d 6167 652e 0d0a 2020 2020  Fit image...    
+00003eb0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00003ec0: 206e 6469 6d20 3d20 6c65 6e28 6469 6d73   ndim = len(dims
+00003ed0: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00003ee0: 6c66 2e6e 6469 6d20 3e20 6e64 696d 3a0d  lf.ndim > ndim:.
+00003ef0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00003f00: 203d 206e 702e 656d 7074 795f 6c69 6b65   = np.empty_like
+00003f10: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+00003f20: 2020 2020 635f 6178 6573 203d 2063 6f6d      c_axes = com
+00003f30: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
+00003f40: 732c 2073 656c 662e 6178 6573 290d 0a20  s, self.axes).. 
+00003f50: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+00003f60: 2e62 6173 6573 2069 6d70 6f72 7420 4d65  .bases import Me
+00003f70: 7461 4172 7261 790d 0a20 2020 2020 2020  taArray..       
+00003f80: 2020 2020 2070 6172 616d 7320 3d20 4d65       params = Me
+00003f90: 7461 4172 7261 7928 6e70 2e65 6d70 7479  taArray(np.empty
+00003fa0: 2873 656c 662e 7368 6170 655b 3a2d 6e64  (self.shape[:-nd
+00003fb0: 696d 5d2c 2064 7479 7065 3d6f 626a 6563  im], dtype=objec
+00003fc0: 7429 2c20 6178 6573 3d63 5f61 7865 7329  t), axes=c_axes)
+00003fd0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00003fe0: 7220 736c 2c20 696d 6720 696e 2073 656c  r sl, img in sel
+00003ff0: 662e 6974 6572 2863 5f61 7865 732c 2069  f.iter(c_axes, i
+00004000: 7372 6177 3d54 7275 6529 3a0d 0a20 2020  sraw=True):..   
+00004010: 2020 2020 2020 2020 2020 2020 2066 6974               fit
+00004020: 203d 2069 6d67 2e67 6175 7373 6669 7428   = img.gaussfit(
+00004030: 7363 616c 653d 7363 616c 652c 2070 303d  scale=scale, p0=
+00004040: 7030 2c20 6d65 7468 6f64 3d6d 6574 686f  p0, method=metho
+00004050: 642c 2064 696d 733d 6469 6d73 290d 0a20  d, dims=dims).. 
+00004060: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00004070: 6172 616d 735b 736c 5b3a 2d6e 6469 6d5d  arams[sl[:-ndim]
+00004080: 5d20 3d20 6669 742e 6d65 7461 6461 7461  ] = fit.metadata
+00004090: 5b22 4761 7573 7369 616e 5061 7261 6d65  ["GaussianParame
+000040a0: 7465 7273 225d 0d0a 2020 2020 2020 2020  ters"]..        
+000040b0: 2020 2020 2020 2020 6f75 745b 736c 5d20          out[sl] 
+000040c0: 3d20 6669 742e 7661 6c75 650d 0a20 2020  = fit.value..   
+000040d0: 2020 2020 2020 2020 206f 7574 2e6d 6574           out.met
+000040e0: 6164 6174 6120 3d20 6f75 742e 6d65 7461  adata = out.meta
+000040f0: 6461 7461 2e63 6f70 7928 290d 0a20 2020  data.copy()..   
+00004100: 2020 2020 2020 2020 206f 7574 2e6d 6574           out.met
+00004110: 6164 6174 615b 2247 6175 7373 6961 6e50  adata["GaussianP
+00004120: 6172 616d 6574 6572 7322 5d20 3d20 7061  arameters"] = pa
+00004130: 7261 6d73 0d0a 2020 2020 2020 2020 2020  rams..          
+00004140: 2020 7265 7475 726e 206f 7574 0d0a 2020    return out..  
+00004150: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00004160: 726f 7567 6820 3d20 7365 6c66 2e72 6573  rough = self.res
+00004170: 6361 6c65 2873 6361 6c65 292e 7661 6c75  cale(scale).valu
+00004180: 652e 6173 7479 7065 286e 702e 666c 6f61  e.astype(np.floa
+00004190: 7433 3229 0d0a 2020 2020 2020 2020 6966  t32)..        if
+000041a0: 206d 6173 6b20 6973 206e 6f74 204e 6f6e   mask is not Non
+000041b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000041c0: 6672 6f6d 202e 2e63 6f72 6520 696d 706f  from ..core impo
+000041d0: 7274 2061 7361 7272 6179 2061 7320 6970  rt asarray as ip
+000041e0: 5f61 7361 7272 6179 0d0a 2020 2020 2020  _asarray..      
+000041f0: 2020 2020 2020 6d61 736b 203d 2069 705f        mask = ip_
+00004200: 6173 6172 7261 7928 6d61 736b 292e 7265  asarray(mask).re
+00004210: 7363 616c 6528 7363 616c 6529 203e 2030  scale(scale) > 0
+00004220: 0d0a 2020 2020 2020 2020 6761 7573 7369  ..        gaussi
+00004230: 616e 203d 2047 6175 7373 6961 6e42 6163  an = GaussianBac
+00004240: 6b67 726f 756e 6428 7030 290d 0a20 2020  kground(p0)..   
+00004250: 2020 2020 2067 6175 7373 6961 6e2e 6669       gaussian.fi
+00004260: 7428 726f 7567 682c 206d 6574 686f 643d  t(rough, method=
+00004270: 6d65 7468 6f64 2c20 6d61 736b 3d6d 6173  method, mask=mas
+00004280: 6b29 0d0a 2020 2020 2020 2020 6761 7573  k)..        gaus
+00004290: 7369 616e 2e72 6573 6361 6c65 2831 2f73  sian.rescale(1/s
+000042a0: 6361 6c65 290d 0a20 2020 2020 2020 2066  cale)..        f
+000042b0: 6974 203d 2067 6175 7373 6961 6e2e 6765  it = gaussian.ge
+000042c0: 6e65 7261 7465 2873 656c 662e 7368 6170  nerate(self.shap
+000042d0: 6529 2e76 6965 7728 7365 6c66 2e5f 5f63  e).view(self.__c
+000042e0: 6c61 7373 5f5f 290d 0a20 2020 2020 2020  lass__)..       
+000042f0: 2066 6974 2e5f 7365 745f 696e 666f 2873   fit._set_info(s
+00004300: 656c 6629 0d0a 2020 2020 2020 2020 6669  elf)..        fi
+00004310: 742e 6d65 7461 6461 7461 203d 2066 6974  t.metadata = fit
+00004320: 2e6d 6574 6164 6174 612e 636f 7079 2829  .metadata.copy()
+00004330: 0d0a 2020 2020 2020 2020 6669 742e 6d65  ..        fit.me
+00004340: 7461 6461 7461 5b22 4761 7573 7369 616e  tadata["Gaussian
+00004350: 5061 7261 6d65 7465 7273 225d 203d 2067  Parameters"] = g
+00004360: 6175 7373 6961 6e2e 6173 6469 6374 2829  aussian.asdict()
+00004370: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00004380: 2066 6974 0d0a 2020 2020 0d0a 2020 2020   fit..    ..    
+00004390: 4073 616d 655f 6474 7970 6528 6173 666c  @same_dtype(asfl
+000043a0: 6f61 743d 5472 7565 290d 0a20 2020 2040  oat=True)..    @
+000043b0: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
+000043c0: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
+000043d0: 6761 7573 735f 636f 7272 6563 7469 6f6e  gauss_correction
+000043e0: 2873 656c 662c 2072 6566 3a20 496d 6741  (self, ref: ImgA
+000043f0: 7272 6179 3d4e 6f6e 652c 2073 6361 6c65  rray=None, scale
+00004400: 3a20 666c 6f61 7420 3d20 312f 3136 2c20  : float = 1/16, 
+00004410: 6d65 6469 616e 5f72 6164 6975 733a 2066  median_radius: f
+00004420: 6c6f 6174 203d 2031 3529 3a0d 0a20 2020  loat = 15):..   
+00004430: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00004440: 2020 436f 7272 6563 7420 756e 6576 656e    Correct uneven
+00004450: 6c79 2064 6973 7472 6962 7574 6564 2065  ly distributed e
+00004460: 7863 6974 6174 696f 6e20 6c69 6768 7420  xcitation light 
+00004470: 7573 696e 6720 4761 7573 7369 616e 2066  using Gaussian f
+00004480: 6974 7469 6e67 2e20 5468 6973 206d 6574  itting. This met
+00004490: 686f 6420 7375 6274 7261 6374 730d 0a20  hod subtracts.. 
+000044a0: 2020 2020 2020 2062 6163 6b67 726f 756e         backgroun
+000044b0: 6420 696e 7465 6e73 6974 7920 6174 2074  d intensity at t
+000044c0: 6865 2073 616d 6520 7469 6d65 2e20 4966  he same time. If
+000044d0: 2069 6e70 7574 2069 6d61 6765 2069 7320   input image is 
+000044e0: 7569 6e74 2c20 7468 656e 206f 7574 7075  uint, then outpu
+000044f0: 7420 7661 6c75 6520 756e 6465 7220 3020  t value under 0 
+00004500: 7769 6c6c 0d0a 2020 2020 2020 2020 7265  will..        re
+00004510: 706c 6163 6564 2077 6974 6820 302e 2049  placed with 0. I
+00004520: 6620 796f 7520 7761 6e74 2074 6f20 7175  f you want to qu
+00004530: 616e 7469 6679 2062 6163 6b67 726f 756e  antify backgroun
+00004540: 642c 2069 7420 6973 206e 6563 6573 7361  d, it is necessa
+00004550: 7279 2074 6f20 6669 7273 7420 636f 6e76  ry to first conv
+00004560: 6572 7420 696e 7075 740d 0a20 2020 2020  ert input..     
+00004570: 2020 2069 6d61 6765 2074 6f20 666c 6f61     image to floa
+00004580: 7420 696d 6167 652e 0d0a 0d0a 2020 2020  t image.....    
+00004590: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+000045a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000045b0: 2d2d 0d0a 2020 2020 2020 2020 7265 6620  --..        ref 
+000045c0: 3a20 496d 6741 7272 6179 2c20 6465 6661  : ImgArray, defa
+000045d0: 756c 7420 6973 2060 7365 6c66 602e 0d0a  ult is `self`...
+000045e0: 2020 2020 2020 2020 2020 2020 5265 6665              Refe
+000045f0: 7265 6e63 6520 696d 6167 6520 746f 2065  rence image to e
+00004600: 7374 696d 6174 6520 6261 636b 6772 6f75  stimate backgrou
+00004610: 6e64 2e0d 0a20 2020 2020 2020 2073 6361  nd...        sca
+00004620: 6c65 203a 2066 6c6f 6174 2c20 6465 6661  le : float, defa
+00004630: 756c 7420 6973 2031 2f31 362e 0d0a 2020  ult is 1/16...  
+00004640: 2020 2020 2020 2020 2020 5363 616c 6520            Scale 
+00004650: 6f66 2072 6f75 6768 2069 6d61 6765 2028  of rough image (
+00004660: 746f 2073 7065 6564 2075 7020 6669 7474  to speed up fitt
+00004670: 696e 6729 2e0d 0a20 2020 2020 2020 206d  ing)...        m
+00004680: 6564 6961 6e5f 7261 6469 7573 203a 2066  edian_radius : f
+00004690: 6c6f 6174 2c20 6465 6661 756c 7420 6973  loat, default is
+000046a0: 2031 352e 0d0a 2020 2020 2020 2020 2020   15...          
+000046b0: 2020 5261 6469 7573 206f 6620 6d65 6469    Radius of medi
+000046c0: 616e 2070 7265 6669 6c74 6572 2773 206b  an prefilter's k
+000046d0: 6572 6e65 6c2e 2049 6620 736d 616c 6c65  ernel. If smalle
+000046e0: 7220 7468 616e 2031 2c20 7072 6566 696c  r than 1, prefil
+000046f0: 7465 7269 6e67 2077 696c 6c20 6265 2073  tering will be s
+00004700: 6b69 7070 6564 2e0d 0a0d 0a20 2020 2020  kipped.....     
+00004710: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
+00004720: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
+00004730: 2020 2020 2049 6d67 4172 7261 790d 0a20       ImgArray.. 
+00004740: 2020 2020 2020 2020 2020 2043 6f72 7265             Corre
+00004750: 6374 6564 2061 6e64 2062 6163 6b67 726f  cted and backgro
+00004760: 756e 6420 7375 6274 7261 6374 6564 2069  und subtracted i
+00004770: 6d61 6765 2e0d 0a20 2020 2020 2020 200d  mage...        .
+00004780: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+00004790: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000047a0: 2d2d 2d0d 0a20 2020 2020 2020 2031 2e20  ---..        1. 
+000047b0: 5768 656e 2069 6e70 7574 2069 6d61 6765  When input image
+000047c0: 2068 6173 2022 7074 6379 7822 2d61 7865   has "ptcyx"-axe
+000047d0: 732c 2061 6e64 2079 6f75 2077 616e 7420  s, and you want 
+000047e0: 746f 2065 7374 696d 6174 6520 7468 6520  to estimate the 
+000047f0: 6261 636b 6772 6f75 6e64 2069 6e74 656e  background inten
+00004800: 7369 7479 0d0a 2020 2020 2020 2020 666f  sity..        fo
+00004810: 7220 6561 6368 2063 6861 6e6e 656c 2062  r each channel b
+00004820: 7920 6176 6572 6167 696e 6720 616c 6c20  y averaging all 
+00004830: 7468 6520 706f 7369 7469 6f6e 7320 616e  the positions an
+00004840: 6420 7469 6d65 732e 0d0a 2020 2020 2020  d times...      
+00004850: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+00004860: 3e3e 3e20 696d 675f 636f 7220 3d20 696d  >>> img_cor = im
+00004870: 672e 6761 7573 735f 636f 7272 6563 7469  g.gauss_correcti
+00004880: 6f6e 2872 6566 3d69 6d67 2e70 726f 6a28  on(ref=img.proj(
+00004890: 2270 7422 2929 0d0a 2020 2020 2020 2020  "pt"))..        
+000048a0: 0d0a 2020 2020 2020 2020 322e 2057 6865  ..        2. Whe
+000048b0: 6e20 696e 7075 7420 696d 6167 6520 6861  n input image ha
+000048c0: 7320 2270 7463 7978 222d 6178 6573 2c20  s "ptcyx"-axes, 
+000048d0: 616e 6420 796f 7520 7761 6e74 2074 6f20  and you want to 
+000048e0: 6573 7469 6d61 7465 2074 6865 2062 6163  estimate the bac
+000048f0: 6b67 726f 756e 6420 696e 7465 6e73 6974  kground intensit
+00004900: 790d 0a20 2020 2020 2020 2066 6f72 2065  y..        for e
+00004910: 6163 6820 6368 616e 6e65 6c20 616e 6420  ach channel and 
+00004920: 7469 6d65 2070 6f69 6e74 2062 7920 6176  time point by av
+00004930: 6572 6167 696e 6720 616c 6c20 7468 6520  eraging all the 
+00004940: 706f 7369 7469 6f6e 732e 0d0a 2020 2020  positions...    
+00004950: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00004960: 2020 3e3e 3e20 696d 675f 636f 7220 3d20    >>> img_cor = 
+00004970: 696d 672e 6761 7573 735f 636f 7272 6563  img.gauss_correc
+00004980: 7469 6f6e 2872 6566 3d69 6d67 2e70 726f  tion(ref=img.pro
+00004990: 6a28 2270 2229 290d 0a20 2020 2020 2020  j("p"))..       
+000049a0: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
+000049b0: 2072 6566 2069 7320 4e6f 6e65 3a0d 0a20   ref is None:.. 
+000049c0: 2020 2020 2020 2020 2020 2072 6566 203d             ref =
+000049d0: 2073 656c 660d 0a20 2020 2020 2020 2065   self..        e
+000049e0: 6c69 6620 6e6f 7420 6973 696e 7374 616e  lif not isinstan
+000049f0: 6365 2872 6566 2c20 7365 6c66 2e5f 5f63  ce(ref, self.__c
+00004a00: 6c61 7373 5f5f 293a 0d0a 2020 2020 2020  lass__):..      
+00004a10: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00004a20: 4572 726f 7228 6622 6072 6566 6020 6d75  Error(f"`ref` mu
+00004a30: 7374 2062 6520 4e6f 6e65 206f 7220 496d  st be None or Im
+00004a40: 6741 7272 6179 2c20 6275 7420 676f 7420  gArray, but got 
+00004a50: 7b74 7970 6528 7265 6629 7d22 290d 0a20  {type(ref)}").. 
+00004a60: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00004a70: 2073 656c 665f 6c6f 6f70 5f61 7865 7320   self_loop_axes 
+00004a80: 3d20 636f 6d70 6c65 6d65 6e74 5f61 7865  = complement_axe
+00004a90: 7328 7265 662e 6178 6573 2c20 7365 6c66  s(ref.axes, self
+00004aa0: 2e61 7865 7329 0d0a 2020 2020 2020 2020  .axes)..        
+00004ab0: 7265 665f 6c6f 6f70 5f61 7865 7320 3d20  ref_loop_axes = 
+00004ac0: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
+00004ad0: 2279 7822 2c20 7265 662e 6178 6573 290d  "yx", ref.axes).
+00004ae0: 0a20 2020 2020 2020 206f 7574 203d 206e  .        out = n
+00004af0: 702e 656d 7074 7928 7365 6c66 2e73 6861  p.empty(self.sha
+00004b00: 7065 2c20 6474 7970 653d 6e70 2e66 6c6f  pe, dtype=np.flo
+00004b10: 6174 3332 290d 0a20 2020 2020 2020 2066  at32)..        f
+00004b20: 6f72 2073 6c30 2c20 7265 665f 2069 6e20  or sl0, ref_ in 
+00004b30: 7265 662e 6974 6572 2872 6566 5f6c 6f6f  ref.iter(ref_loo
+00004b40: 705f 6178 6573 2c20 6973 7261 773d 5472  p_axes, israw=Tr
+00004b50: 7565 293a 0d0a 2020 2020 2020 2020 2020  ue):..          
+00004b60: 2020 7265 665f 3a20 496d 6741 7272 6179    ref_: ImgArray
+00004b70: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00004b80: 206d 6564 6961 6e5f 7261 6469 7573 203e   median_radius >
+00004b90: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
+00004ba0: 2020 2020 2020 7265 665f 203d 2072 6566        ref_ = ref
+00004bb0: 5f2e 6d65 6469 616e 5f66 696c 7465 7228  _.median_filter(
+00004bc0: 7261 6469 7573 3d6d 6564 6961 6e5f 7261  radius=median_ra
+00004bd0: 6469 7573 290d 0a20 2020 2020 2020 2020  dius)..         
+00004be0: 2020 2066 6974 203d 2072 6566 5f2e 6761     fit = ref_.ga
+00004bf0: 7573 7366 6974 2873 6361 6c65 3d73 6361  ussfit(scale=sca
+00004c00: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+00004c10: 2061 203d 2066 6974 2e6d 6178 2829 0d0a   a = fit.max()..
+00004c20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00004c30: 736c 2c20 696d 6720 696e 2073 656c 662e  sl, img in self.
+00004c40: 6974 6572 2873 656c 665f 6c6f 6f70 5f61  iter(self_loop_a
+00004c50: 7865 732c 2069 7372 6177 3d54 7275 6529  xes, israw=True)
+00004c60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004c70: 2020 206f 7574 5b73 6c5d 5b73 6c30 5d20     out[sl][sl0] 
+00004c80: 3d20 2869 6d67 5b73 6c30 5d20 2f20 6669  = (img[sl0] / fi
+00004c90: 7420 2a20 6120 2d20 6129 2e76 616c 7565  t * a - a).value
+00004ca0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00004cb0: 2020 2020 7265 7475 726e 206f 7574 2e76      return out.v
+00004cc0: 6965 7728 7365 6c66 2e5f 5f63 6c61 7373  iew(self.__class
+00004cd0: 5f5f 290d 0a0d 0a20 2020 200d 0a20 2020  __)....    ..   
+00004ce0: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
+00004cf0: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
+00004d00: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
+00004d10: 2020 2064 6566 2068 6573 7369 616e 5f65     def hessian_e
+00004d20: 6967 7661 6c28 7365 6c66 2c20 7369 676d  igval(self, sigm
+00004d30: 613a 206e 4446 6c6f 6174 203d 2031 2c20  a: nDFloat = 1, 
+00004d40: 2a2c 2064 696d 733a 2044 696d 7320 3d20  *, dims: Dims = 
+00004d50: 4e6f 6e65 2920 2d3e 2049 6d67 4172 7261  None) -> ImgArra
+00004d60: 793a 0d0a 2020 2020 2020 2020 2222 220d  y:..        """.
+00004d70: 0a20 2020 2020 2020 2043 616c 6375 6c61  .        Calcula
+00004d80: 7465 2048 6573 7369 616e 2773 2065 6967  te Hessian's eig
+00004d90: 656e 7661 6c75 6573 2066 6f72 2065 6163  envalues for eac
+00004da0: 6820 696d 6167 652e 200d 0a20 2020 2020  h image. ..     
+00004db0: 2020 200d 0a20 2020 2020 2020 2050 6172     ..        Par
+00004dc0: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
+00004dd0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+00004de0: 2020 2020 207b 7369 676d 617d 0d0a 2020       {sigma}..  
+00004df0: 2020 2020 2020 7b64 696d 737d 0d0a 0d0a        {dims}....
+00004e00: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
+00004e10: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00004e20: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
+00004e30: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+00004e40: 4172 7261 7920 6f66 2065 6967 656e 7661  Array of eigenva
+00004e50: 6c75 6573 2e20 5468 6520 6178 6973 2060  lues. The axis `
+00004e60: 6022 6261 7365 2260 6020 6465 6e6f 7465  `"base"`` denote
+00004e70: 7320 7468 6520 696e 6465 7820 6f66 2065  s the index of e
+00004e80: 6967 656e 7661 6c75 6573 2e0d 0a20 2020  igenvalues...   
+00004e90: 2020 2020 2020 2020 206c 3d30 206d 6561           l=0 mea
+00004ea0: 6e73 2074 6865 2073 6d61 6c6c 6573 7420  ns the smallest 
+00004eb0: 6569 6765 6e76 616c 7565 2e0d 0a20 2020  eigenvalue...   
+00004ec0: 2020 2020 200d 0a20 2020 2020 2020 2045       ..        E
+00004ed0: 7861 6d70 6c65 730d 0a20 2020 2020 2020  xamples..       
+00004ee0: 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020   --------..     
+00004ef0: 2020 2045 7874 7261 6374 2066 696c 616d     Extract filam
+00004f00: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
+00004f10: 203e 3e3e 2065 6967 203d 202d 696d 672e   >>> eig = -img.
+00004f20: 6865 7373 6961 6e5f 6569 6776 616c 2829  hessian_eigval()
+00004f30: 5b69 702e 736c 6963 6572 2e62 6173 655b  [ip.slicer.base[
+00004f40: 305d 5d0d 0a20 2020 2020 2020 2020 2020  0]]..           
+00004f50: 203e 3e3e 2065 6967 5b65 6967 3c30 5d20   >>> eig[eig<0] 
+00004f60: 3d20 300d 0a20 2020 2020 2020 2022 2222  = 0..        """
+00004f70: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00004f80: 2020 6e64 696d 203d 206c 656e 2864 696d    ndim = len(dim
+00004f90: 7329 0d0a 2020 2020 2020 2020 7369 676d  s)..        sigm
+00004fa0: 6120 3d20 6368 6563 6b5f 6e64 2873 6967  a = check_nd(sig
+00004fb0: 6d61 2c20 6e64 696d 290d 0a20 2020 2020  ma, ndim)..     
+00004fc0: 2020 2070 7873 697a 6520 3d20 6e70 2e61     pxsize = np.a
+00004fd0: 7272 6179 285b 7365 6c66 2e73 6361 6c65  rray([self.scale
+00004fe0: 5b61 5d20 666f 7220 6120 696e 2064 696d  [a] for a in dim
+00004ff0: 735d 290d 0a20 2020 2020 2020 200d 0a20  s])..        .. 
+00005000: 2020 2020 2020 2065 6967 7661 6c20 3d20         eigval = 
+00005010: 7365 6c66 2e61 735f 666c 6f61 7428 292e  self.as_float().
+00005020: 5f61 7070 6c79 5f64 6173 6b28 0d0a 2020  _apply_dask(..  
+00005030: 2020 2020 2020 2020 2020 5f6c 696e 616c            _linal
+00005040: 672e 6865 7373 6961 6e5f 6569 6776 616c  g.hessian_eigval
+00005050: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+00005060: 635f 6178 6573 3d63 6f6d 706c 656d 656e  c_axes=complemen
+00005070: 745f 6178 6573 2864 696d 732c 2073 656c  t_axes(dims, sel
+00005080: 662e 6178 6573 292c 200d 0a20 2020 2020  f.axes), ..     
+00005090: 2020 2020 2020 206e 6577 5f61 7869 733d         new_axis=
+000050a0: 2d31 2c0d 0a20 2020 2020 2020 2020 2020  -1,..           
+000050b0: 2061 7267 733d 2873 6967 6d61 2c20 7078   args=(sigma, px
+000050c0: 7369 7a65 290d 0a20 2020 2020 2020 2029  size)..        )
+000050d0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000050e0: 2020 2020 6569 6776 616c 3a20 496d 6741      eigval: ImgA
+000050f0: 7272 6179 203d 206e 702e 6d6f 7665 6178  rray = np.moveax
+00005100: 6973 2865 6967 7661 6c2c 202d 312c 2030  is(eigval, -1, 0
+00005110: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00005120: 2020 2020 206e 6577 5f61 7865 7320 3d20       new_axes = 
+00005130: 5b22 6261 7365 225d 202b 2073 656c 662e  ["base"] + self.
+00005140: 6178 6573 0d0a 2020 2020 2020 2020 6569  axes..        ei
+00005150: 6776 616c 2e5f 7365 745f 696e 666f 2873  gval._set_info(s
+00005160: 656c 662c 206e 6577 5f61 7865 733d 6e65  elf, new_axes=ne
+00005170: 775f 6178 6573 290d 0a20 2020 2020 2020  w_axes)..       
+00005180: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
+00005190: 6e20 6569 6776 616c 0d0a 2020 2020 0d0a  n eigval..    ..
+000051a0: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
+000051b0: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
+000051c0: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
+000051d0: 0d0a 2020 2020 6465 6620 6865 7373 6961  ..    def hessia
+000051e0: 6e5f 6569 6728 7365 6c66 2c20 7369 676d  n_eig(self, sigm
+000051f0: 613a 206e 4446 6c6f 6174 203d 2031 2c20  a: nDFloat = 1, 
+00005200: 2a2c 2064 696d 733a 2044 696d 7320 3d20  *, dims: Dims = 
+00005210: 4e6f 6e65 2920 2d3e 2074 7570 6c65 5b49  None) -> tuple[I
+00005220: 6d67 4172 7261 792c 2049 6d67 4172 7261  mgArray, ImgArra
+00005230: 795d 3a0d 0a20 2020 2020 2020 2022 2222  y]:..        """
+00005240: 0d0a 2020 2020 2020 2020 4361 6c63 756c  ..        Calcul
+00005250: 6174 6520 4865 7373 6961 6e27 7320 6569  ate Hessian's ei
+00005260: 6765 6e76 616c 7565 7320 616e 6420 6569  genvalues and ei
+00005270: 6765 6e76 6563 746f 7273 2e0d 0a0d 0a20  genvectors..... 
+00005280: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00005290: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000052a0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 207b  -----..        {
+000052b0: 7369 676d 617d 7b64 696d 737d 0d0a 0d0a  sigma}{dims}....
+000052c0: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
+000052d0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000052e0: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
+000052f0: 6179 2061 6e64 2049 6d67 4172 7261 790d  ay and ImgArray.
+00005300: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
+00005310: 6179 7320 6f66 2065 6967 656e 7661 6c75  ays of eigenvalu
+00005320: 6573 2061 6e64 2065 6967 656e 7665 6374  es and eigenvect
+00005330: 6f72 732e 2054 6865 2061 7869 7320 6060  ors. The axis ``
+00005340: 2262 6173 6522 6060 2064 656e 6f74 6573  "base"`` denotes
+00005350: 2074 6865 2069 6e64 6578 206f 6620 0d0a   the index of ..
+00005360: 2020 2020 2020 2020 2020 2020 6569 6765              eige
+00005370: 6e76 616c 7565 732e 206c 3d30 206d 6561  nvalues. l=0 mea
+00005380: 6e73 2074 6865 2073 6d61 6c6c 6573 7420  ns the smallest 
+00005390: 6569 6765 6e76 616c 7565 2e20 6060 2264  eigenvalue. ``"d
+000053a0: 696d 2260 6020 6465 6e6f 7465 7320 7468  im"`` denotes th
+000053b0: 6520 696e 6465 7820 6f66 0d0a 2020 2020  e index of..    
+000053c0: 2020 2020 2020 2020 7370 6174 6961 6c20          spatial 
+000053d0: 6469 6d65 6e73 696f 6e73 2e20 466f 7220  dimensions. For 
+000053e0: 3344 2069 6d61 6765 2c20 6469 6d3d 3020  3D image, dim=0 
+000053f0: 6d65 616e 7320 7a2d 656c 656d 656e 7420  means z-element 
+00005400: 6f66 2061 6e20 6569 6765 6e76 6563 746f  of an eigenvecto
+00005410: 722e 0d0a 2020 2020 2020 2020 2222 2220  r...        """ 
+00005420: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+00005430: 0a20 2020 2020 2020 206e 6469 6d20 3d20  .        ndim = 
+00005440: 6c65 6e28 6469 6d73 290d 0a20 2020 2020  len(dims)..     
+00005450: 2020 2073 6967 6d61 203d 2063 6865 636b     sigma = check
+00005460: 5f6e 6428 7369 676d 612c 206e 6469 6d29  _nd(sigma, ndim)
+00005470: 0d0a 2020 2020 2020 2020 7078 7369 7a65  ..        pxsize
+00005480: 203d 206e 702e 6172 7261 7928 5b73 656c   = np.array([sel
+00005490: 662e 7363 616c 655b 615d 2066 6f72 2061  f.scale[a] for a
+000054a0: 2069 6e20 6469 6d73 5d29 0d0a 2020 2020   in dims])..    
+000054b0: 2020 2020 0d0a 2020 2020 2020 2020 6569      ..        ei
+000054c0: 6773 203d 2073 656c 662e 6173 5f66 6c6f  gs = self.as_flo
+000054d0: 6174 2829 2e5f 6170 706c 795f 6461 736b  at()._apply_dask
+000054e0: 280d 0a20 2020 2020 2020 2020 2020 205f  (..            _
+000054f0: 6c69 6e61 6c67 2e68 6573 7369 616e 5f65  linalg.hessian_e
+00005500: 6967 682c 200d 0a20 2020 2020 2020 2020  igh, ..         
+00005510: 2020 2063 5f61 7865 733d 636f 6d70 6c65     c_axes=comple
+00005520: 6d65 6e74 5f61 7865 7328 6469 6d73 2c20  ment_axes(dims, 
+00005530: 7365 6c66 2e61 7865 7329 2c0d 0a20 2020  self.axes),..   
+00005540: 2020 2020 2020 2020 206e 6577 5f61 7869           new_axi
+00005550: 733d 5b2d 322c 202d 315d 2c0d 0a20 2020  s=[-2, -1],..   
+00005560: 2020 2020 2020 2020 2061 7267 733d 2873           args=(s
+00005570: 6967 6d61 2c20 7078 7369 7a65 290d 0a20  igma, pxsize).. 
+00005580: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00005590: 2020 0d0a 2020 2020 2020 2020 6569 6776    ..        eigv
+000055a0: 616c 2c20 6569 6776 6563 203d 205f 6c69  al, eigvec = _li
+000055b0: 6e61 6c67 2e65 6967 735f 706f 7374 5f70  nalg.eigs_post_p
+000055c0: 726f 6365 7373 2865 6967 732c 2073 656c  rocess(eigs, sel
+000055d0: 662e 6178 6573 2c20 7365 6c66 290d 0a20  f.axes, self).. 
+000055e0: 2020 2020 2020 2072 6574 7572 6e20 6569         return ei
+000055f0: 6776 616c 2c20 6569 6776 6563 0d0a 2020  gval, eigvec..  
+00005600: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
+00005610: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
+00005620: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
+00005630: 6178 6573 0d0a 2020 2020 4063 6865 636b  axes..    @check
+00005640: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
+00005650: 740d 0a20 2020 2064 6566 2073 7472 7563  t..    def struc
+00005660: 7475 7265 5f74 656e 736f 725f 6569 6776  ture_tensor_eigv
+00005670: 616c 2873 656c 662c 2073 6967 6d61 3a20  al(self, sigma: 
+00005680: 6e44 466c 6f61 7420 3d20 312c 202a 2c20  nDFloat = 1, *, 
+00005690: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+000056a0: 6529 202d 3e20 496d 6741 7272 6179 3a0d  e) -> ImgArray:.
+000056b0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+000056c0: 2020 2020 2020 4361 6c63 756c 6174 6520        Calculate 
+000056d0: 7374 7275 6374 7572 6520 7465 6e73 6f72  structure tensor
+000056e0: 2773 2065 6967 656e 7661 6c75 6573 2061  's eigenvalues a
+000056f0: 6e64 2065 6967 656e 7665 6374 6f72 732e  nd eigenvectors.
+00005700: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
+00005710: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+00005720: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00005730: 2020 2020 7b73 6967 6d61 7d0d 0a20 2020      {sigma}..   
+00005740: 2020 2020 207b 6469 6d73 7d0d 0a0d 0a20       {dims}.... 
+00005750: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
+00005760: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
+00005770: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
+00005780: 790d 0a20 2020 2020 2020 2020 2020 2041  y..            A
+00005790: 7272 6179 206f 6620 6569 6765 6e76 616c  rray of eigenval
+000057a0: 7565 732e 2054 6865 2061 7869 7320 6060  ues. The axis ``
+000057b0: 226c 2260 6020 6465 6e6f 7465 7320 7468  "l"`` denotes th
+000057c0: 6520 696e 6465 7820 6f66 2065 6967 656e  e index of eigen
+000057d0: 7661 6c75 6573 2e0d 0a20 2020 2020 2020  values...       
+000057e0: 2020 2020 206c 3d30 206d 6561 6e73 2074       l=0 means t
+000057f0: 6865 2073 6d61 6c6c 6573 7420 6569 6765  he smallest eige
+00005800: 6e76 616c 7565 2e0d 0a20 2020 2020 2020  nvalue...       
+00005810: 2022 2222 2020 2020 2020 2020 2020 0d0a   """          ..
+00005820: 2020 2020 2020 2020 6e64 696d 203d 206c          ndim = l
+00005830: 656e 2864 696d 7329 0d0a 2020 2020 2020  en(dims)..      
+00005840: 2020 7369 676d 6120 3d20 6368 6563 6b5f    sigma = check_
+00005850: 6e64 2873 6967 6d61 2c20 6e64 696d 290d  nd(sigma, ndim).
+00005860: 0a20 2020 2020 2020 2070 7873 697a 6520  .        pxsize 
+00005870: 3d20 6e70 2e61 7272 6179 285b 7365 6c66  = np.array([self
+00005880: 2e73 6361 6c65 5b61 5d20 666f 7220 6120  .scale[a] for a 
+00005890: 696e 2064 696d 735d 290d 0a20 2020 2020  in dims])..     
+000058a0: 2020 200d 0a20 2020 2020 2020 2065 6967     ..        eig
+000058b0: 7661 6c20 3d20 7365 6c66 2e61 735f 666c  val = self.as_fl
+000058c0: 6f61 7428 292e 5f61 7070 6c79 5f64 6173  oat()._apply_das
+000058d0: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
+000058e0: 5f6c 696e 616c 672e 7374 7275 6374 7572  _linalg.structur
+000058f0: 655f 7465 6e73 6f72 5f65 6967 7661 6c2c  e_tensor_eigval,
+00005900: 200d 0a20 2020 2020 2020 2020 2020 2063   ..            c
+00005910: 5f61 7865 733d 636f 6d70 6c65 6d65 6e74  _axes=complement
+00005920: 5f61 7865 7328 6469 6d73 2c20 7365 6c66  _axes(dims, self
+00005930: 2e61 7865 7329 2c20 0d0a 2020 2020 2020  .axes), ..      
+00005940: 2020 2020 2020 6e65 775f 6178 6973 3d2d        new_axis=-
+00005950: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00005960: 6172 6773 3d28 7369 676d 612c 2070 7873  args=(sigma, pxs
+00005970: 697a 6529 2c0d 0a20 2020 2020 2020 2029  ize),..        )
+00005980: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00005990: 2020 2020 6e65 775f 6178 6573 203d 205b      new_axes = [
+000059a0: 2262 6173 6522 5d20 2b20 7365 6c66 2e61  "base"] + self.a
+000059b0: 7865 730d 0a20 2020 2020 2020 2065 6967  xes..        eig
+000059c0: 7661 6c2e 5f73 6574 5f69 6e66 6f28 7365  val._set_info(se
+000059d0: 6c66 2c20 6e65 775f 6178 6573 3d6e 6577  lf, new_axes=new
+000059e0: 5f61 7865 7329 0d0a 2020 2020 2020 2020  _axes)..        
+000059f0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00005a00: 2065 6967 7661 6c0d 0a20 2020 200d 0a20   eigval..    .. 
+00005a10: 2020 2040 5f64 6f63 732e 7772 6974 655f     @_docs.write_
+00005a20: 646f 6373 0d0a 2020 2020 4064 696d 735f  docs..    @dims_
+00005a30: 746f 5f73 7061 7469 616c 5f61 7865 730d  to_spatial_axes.
+00005a40: 0a20 2020 2040 6368 6563 6b5f 696e 7075  .    @check_inpu
+00005a50: 745f 616e 645f 6f75 7470 7574 0d0a 2020  t_and_output..  
+00005a60: 2020 6465 6620 7374 7275 6374 7572 655f    def structure_
+00005a70: 7465 6e73 6f72 5f65 6967 2873 656c 662c  tensor_eig(self,
+00005a80: 2073 6967 6d61 3a20 6e44 466c 6f61 7420   sigma: nDFloat 
+00005a90: 3d20 312c 202a 2c20 6469 6d73 3a20 4469  = 1, *, dims: Di
+00005aa0: 6d73 203d 204e 6f6e 6529 2d3e 2074 7570  ms = None)-> tup
+00005ab0: 6c65 5b49 6d67 4172 7261 792c 2049 6d67  le[ImgArray, Img
+00005ac0: 4172 7261 795d 3a0d 0a20 2020 2020 2020  Array]:..       
+00005ad0: 2022 2222 0d0a 2020 2020 2020 2020 4361   """..        Ca
+00005ae0: 6c63 756c 6174 6520 7374 7275 6374 7572  lculate structur
+00005af0: 6520 7465 6e73 6f72 2773 2065 6967 656e  e tensor's eigen
+00005b00: 7661 6c75 6573 2061 6e64 2065 6967 656e  values and eigen
+00005b10: 7665 6374 6f72 732e 0d0a 0d0a 2020 2020  vectors.....    
+00005b20: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+00005b30: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00005b40: 2d2d 0d0a 2020 2020 2020 2020 7b73 6967  --..        {sig
+00005b50: 6d61 7d0d 0a20 2020 2020 2020 207b 6469  ma}..        {di
+00005b60: 6d73 7d0d 0a0d 0a20 2020 2020 2020 2052  ms}....        R
+00005b70: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
+00005b80: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00005b90: 2049 6d67 4172 7261 7920 616e 6420 496d   ImgArray and Im
+00005ba0: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+00005bb0: 2020 2020 4172 7261 7973 206f 6620 6569      Arrays of ei
+00005bc0: 6765 6e76 616c 7565 7320 616e 6420 6569  genvalues and ei
+00005bd0: 6765 6e76 6563 746f 7273 2e20 5468 6520  genvectors. The 
+00005be0: 6178 6973 2060 6022 6c22 6060 2064 656e  axis ``"l"`` den
+00005bf0: 6f74 6573 2074 6865 2069 6e64 6578 206f  otes the index o
+00005c00: 6620 0d0a 2020 2020 2020 2020 2020 2020  f ..            
+00005c10: 6569 6765 6e76 616c 7565 732e 206c 3d30  eigenvalues. l=0
+00005c20: 206d 6561 6e73 2074 6865 2073 6d61 6c6c   means the small
+00005c30: 6573 7420 6569 6765 6e76 616c 7565 2e20  est eigenvalue. 
+00005c40: 6060 2272 2260 6020 6465 6e6f 7465 7320  ``"r"`` denotes 
+00005c50: 7468 6520 696e 6465 7820 6f66 0d0a 2020  the index of..  
+00005c60: 2020 2020 2020 2020 2020 7370 6174 6961            spatia
+00005c70: 6c20 6469 6d65 6e73 696f 6e73 2e20 466f  l dimensions. Fo
+00005c80: 7220 3344 2069 6d61 6765 2c20 723d 3020  r 3D image, r=0 
+00005c90: 6d65 616e 7320 7a2d 656c 656d 656e 7420  means z-element 
+00005ca0: 6f66 2061 6e20 6569 6765 6e76 6563 746f  of an eigenvecto
+00005cb0: 722e 0d0a 2020 2020 2020 2020 2222 2220  r...        """ 
+00005cc0: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+00005cd0: 0a20 2020 2020 2020 206e 6469 6d20 3d20  .        ndim = 
+00005ce0: 6c65 6e28 6469 6d73 290d 0a20 2020 2020  len(dims)..     
+00005cf0: 2020 2073 6967 6d61 203d 2063 6865 636b     sigma = check
+00005d00: 5f6e 6428 7369 676d 612c 206e 6469 6d29  _nd(sigma, ndim)
+00005d10: 0d0a 2020 2020 2020 2020 7078 7369 7a65  ..        pxsize
+00005d20: 203d 206e 702e 6172 7261 7928 5b73 656c   = np.array([sel
+00005d30: 662e 7363 616c 655b 615d 2066 6f72 2061  f.scale[a] for a
+00005d40: 2069 6e20 6469 6d73 5d29 0d0a 2020 2020   in dims])..    
+00005d50: 2020 2020 0d0a 2020 2020 2020 2020 6569      ..        ei
+00005d60: 6773 203d 2073 656c 662e 6173 5f66 6c6f  gs = self.as_flo
+00005d70: 6174 2829 2e5f 6170 706c 795f 6461 736b  at()._apply_dask
+00005d80: 280d 0a20 2020 2020 2020 2020 2020 205f  (..            _
+00005d90: 6c69 6e61 6c67 2e73 7472 7563 7475 7265  linalg.structure
+00005da0: 5f74 656e 736f 725f 6569 6768 2c0d 0a20  _tensor_eigh,.. 
+00005db0: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
+00005dc0: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
+00005dd0: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+00005de0: 7329 2c0d 0a20 2020 2020 2020 2020 2020  s),..           
+00005df0: 206e 6577 5f61 7869 733d 5b2d 322c 202d   new_axis=[-2, -
+00005e00: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+00005e10: 2061 7267 733d 2873 6967 6d61 2c20 7078   args=(sigma, px
+00005e20: 7369 7a65 290d 0a20 2020 2020 2020 2029  size)..        )
+00005e30: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00005e40: 2020 2020 6569 6776 616c 2c20 6569 6776      eigval, eigv
+00005e50: 6563 203d 205f 6c69 6e61 6c67 2e65 6967  ec = _linalg.eig
+00005e60: 735f 706f 7374 5f70 726f 6365 7373 2865  s_post_process(e
+00005e70: 6967 732c 2073 656c 662e 6178 6573 2c20  igs, self.axes, 
+00005e80: 7365 6c66 290d 0a0d 0a20 2020 2020 2020  self)....       
+00005e90: 2072 6574 7572 6e20 6569 6776 616c 2c20   return eigval, 
+00005ea0: 6569 6776 6563 0d0a 2020 2020 0d0a 2020  eigvec..    ..  
+00005eb0: 2020 405f 646f 6373 2e77 7269 7465 5f64    @_docs.write_d
+00005ec0: 6f63 730d 0a20 2020 2040 6469 6d73 5f74  ocs..    @dims_t
+00005ed0: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
+00005ee0: 2020 2020 4073 616d 655f 6474 7970 6528      @same_dtype(
+00005ef0: 6173 666c 6f61 743d 5472 7565 290d 0a20  asfloat=True).. 
+00005f00: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
+00005f10: 616e 645f 6f75 7470 7574 0d0a 2020 2020  and_output..    
+00005f20: 6465 6620 6564 6765 5f66 696c 7465 7228  def edge_filter(
+00005f30: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
+00005f40: 0a20 2020 2020 2020 206d 6574 686f 643a  .        method:
+00005f50: 2073 7472 203d 2022 736f 6265 6c22 2c0d   str = "sobel",.
+00005f60: 0a20 2020 2020 2020 202a 2c0d 0a20 2020  .        *,..   
+00005f70: 2020 2020 2064 696d 733a 2044 696d 7320       dims: Dims 
+00005f80: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
+00005f90: 2075 7064 6174 653a 2062 6f6f 6c20 3d20   update: bool = 
+00005fa0: 4661 6c73 650d 0a20 2020 2029 202d 3e20  False..    ) -> 
+00005fb0: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
+00005fc0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00005fd0: 536f 6265 6c20 6669 6c74 6572 2e20 5468  Sobel filter. Th
+00005fe0: 6973 2066 696c 7465 7220 6973 2075 7365  is filter is use
+00005ff0: 6675 6c20 666f 7220 6564 6765 2064 6574  ful for edge det
+00006000: 6563 7469 6f6e 2e0d 0a0d 0a20 2020 2020  ection.....     
+00006010: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+00006020: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00006030: 2d0d 0a20 2020 2020 2020 206d 6574 686f  -..        metho
+00006040: 6420 3a20 7374 722c 207b 2273 6f62 656c  d : str, {"sobel
+00006050: 222c 2022 6661 7269 6422 2c20 2273 6368  ", "farid", "sch
+00006060: 6172 7222 2c20 2270 7265 7769 7474 227d  arr", "prewitt"}
+00006070: 2c20 6465 6661 756c 7420 6973 2022 736f  , default is "so
+00006080: 6265 6c22 0d0a 2020 2020 2020 2020 2020  bel"..          
+00006090: 2020 4564 6765 206f 7065 7261 746f 7220    Edge operator 
+000060a0: 6e61 6d65 2e0d 0a20 2020 2020 2020 207b  name...        {
+000060b0: 6469 6d73 7d7b 7570 6461 7465 7d0d 0a0d  dims}{update}...
+000060c0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+000060d0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+000060e0: 2d0d 0a20 2020 2020 2020 2049 6d67 4172  -..        ImgAr
+000060f0: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
+00006100: 2046 696c 7465 7265 6420 696d 6167 652e   Filtered image.
+00006110: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
+00006120: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00006130: 2047 6574 206f 7065 7261 746f 720d 0a20   Get operator.. 
+00006140: 2020 2020 2020 206d 6574 686f 645f 6469         method_di
+00006150: 6374 203d 207b 2273 6f62 656c 223a 2073  ct = {"sobel": s
+00006160: 6b66 696c 2e73 6f62 656c 2c0d 0a20 2020  kfil.sobel,..   
+00006170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006180: 2020 2020 2266 6172 6964 223a 2073 6b66      "farid": skf
+00006190: 696c 2e66 6172 6964 2c0d 0a20 2020 2020  il.farid,..     
+000061a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061b0: 2020 2273 6368 6172 7222 3a20 736b 6669    "scharr": skfi
+000061c0: 6c2e 7363 6861 7272 2c0d 0a20 2020 2020  l.scharr,..     
+000061d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061e0: 2020 2270 7265 7769 7474 223a 2073 6b66    "prewitt": skf
+000061f0: 696c 2e70 7265 7769 7474 7d0d 0a20 2020  il.prewitt}..   
+00006200: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00006210: 2020 2020 2020 2066 203d 206d 6574 686f         f = metho
+00006220: 645f 6469 6374 5b6d 6574 686f 645d 0d0a  d_dict[method]..
+00006230: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+00006240: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+00006250: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00006260: 6545 7272 6f72 2822 606d 6574 686f 6460  eError("`method`
+00006270: 206d 7573 7420 6265 2027 736f 6265 6c27   must be 'sobel'
+00006280: 2c20 2766 6172 6964 2720 2773 6368 6172  , 'farid' 'schar
+00006290: 7227 2c20 6f72 2027 7072 6577 6974 7427  r', or 'prewitt'
+000062a0: 2e22 290d 0a20 2020 2020 2020 200d 0a20  .")..        .. 
+000062b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000062c0: 6c66 2e5f 6170 706c 795f 6461 736b 2866  lf._apply_dask(f
+000062d0: 2c20 635f 6178 6573 3d63 6f6d 706c 656d  , c_axes=complem
+000062e0: 656e 745f 6178 6573 2864 696d 732c 2073  ent_axes(dims, s
+000062f0: 656c 662e 6178 6573 2929 0d0a 2020 2020  elf.axes))..    
+00006300: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
+00006310: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
+00006320: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+00006330: 6573 0d0a 2020 2020 4073 616d 655f 6474  es..    @same_dt
+00006340: 7970 6528 6173 666c 6f61 743d 5472 7565  ype(asfloat=True
+00006350: 290d 0a20 2020 2040 6368 6563 6b5f 696e  )..    @check_in
+00006360: 7075 745f 616e 645f 6f75 7470 7574 0d0a  put_and_output..
+00006370: 2020 2020 6465 6620 6c6f 7770 6173 735f      def lowpass_
+00006380: 6669 6c74 6572 280d 0a20 2020 2020 2020  filter(..       
+00006390: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+000063a0: 6375 746f 6666 3a20 6e44 466c 6f61 7420  cutoff: nDFloat 
+000063b0: 3d20 302e 322c 0d0a 2020 2020 2020 2020  = 0.2,..        
+000063c0: 6f72 6465 723a 2066 6c6f 6174 203d 2032  order: float = 2
+000063d0: 2c0d 0a20 2020 2020 2020 202a 2c20 0d0a  ,..        *, ..
+000063e0: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
+000063f0: 6d73 203d 204e 6f6e 652c 200d 0a20 2020  ms = None, ..   
+00006400: 2020 2020 2075 7064 6174 653a 2062 6f6f       update: boo
+00006410: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
+00006420: 2920 2d3e 2049 6d67 4172 7261 793a 0d0a  ) -> ImgArray:..
+00006430: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00006440: 2020 2020 2042 7574 7465 7277 6f72 7468       Butterworth
+00006450: 206c 6f77 2d70 6173 7320 6669 6c74 6572   low-pass filter
+00006460: 2e0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
+00006470: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
+00006480: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+00006490: 2020 2020 2063 7574 6f66 6620 3a20 666c       cutoff : fl
+000064a0: 6f61 7420 6f72 2061 7272 6179 2d6c 696b  oat or array-lik
+000064b0: 652c 2064 6566 6175 6c74 2069 7320 302e  e, default is 0.
+000064c0: 320d 0a20 2020 2020 2020 2020 2020 2043  2..            C
+000064d0: 7574 6f66 6620 6672 6571 7565 6e63 792e  utoff frequency.
+000064e0: 0d0a 2020 2020 2020 2020 6f72 6465 7220  ..        order 
+000064f0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00006500: 2069 7320 320d 0a20 2020 2020 2020 2020   is 2..         
+00006510: 2020 2053 7465 6570 6e65 7373 206f 6620     Steepness of 
+00006520: 6375 746f 6666 2e0d 0a20 2020 2020 2020  cutoff...       
+00006530: 207b 6469 6d73 7d7b 7570 6461 7465 7d0d   {dims}{update}.
+00006540: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00006550: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
+00006560: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
+00006570: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
+00006580: 2020 2046 696c 7465 7265 6420 696d 6167     Filtered imag
+00006590: 650d 0a20 2020 2020 2020 2022 2222 2020  e..        """  
+000065a0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000065b0: 2066 726f 6d20 2e5f 7574 696c 732e 5f73   from ._utils._s
+000065c0: 6b69 6d61 6765 2069 6d70 6f72 7420 5f67  kimage import _g
+000065d0: 6574 5f4e 445f 6275 7474 6572 776f 7274  et_ND_butterwort
+000065e0: 685f 6669 6c74 6572 0d0a 2020 2020 2020  h_filter..      
+000065f0: 2020 6e64 696d 7320 3d20 6c65 6e28 6469    ndims = len(di
+00006600: 6d73 290d 0a20 2020 2020 2020 2063 7574  ms)..        cut
+00006610: 6f66 6620 3d20 6368 6563 6b5f 6e64 2863  off = check_nd(c
+00006620: 7574 6f66 662c 206e 6469 6d73 290d 0a20  utoff, ndims).. 
+00006630: 2020 2020 2020 2069 6620 616c 6c28 2863         if all((c
+00006640: 203e 3d20 302e 352a 6e70 2e73 7172 7428   >= 0.5*np.sqrt(
+00006650: 6e64 696d 7329 206f 7220 6320 3c3d 2030  ndims) or c <= 0
+00006660: 2920 666f 7220 6320 696e 2063 7574 6f66  ) for c in cutof
+00006670: 6629 3a0d 0a20 2020 2020 2020 2020 2020  f):..           
+00006680: 2072 6574 7572 6e20 7365 6c66 0d0a 2020   return self..  
+00006690: 2020 2020 2020 7370 6174 6961 6c5f 7368        spatial_sh
+000066a0: 6170 6520 3d20 7365 6c66 2e73 697a 6573  ape = self.sizes
+000066b0: 6f66 2864 696d 7329 0d0a 2020 2020 2020  of(dims)..      
+000066c0: 2020 7370 6174 6961 6c5f 6178 6573 203d    spatial_axes =
+000066d0: 205b 7365 6c66 2e61 7869 736f 6628 6129   [self.axisof(a)
+000066e0: 2066 6f72 2061 2069 6e20 6469 6d73 5d0d   for a in dims].
+000066f0: 0a20 2020 2020 2020 2077 6569 6768 7420  .        weight 
+00006700: 3d20 5f67 6574 5f4e 445f 6275 7474 6572  = _get_ND_butter
+00006710: 776f 7274 685f 6669 6c74 6572 2873 7061  worth_filter(spa
+00006720: 7469 616c 5f73 6861 7065 2c20 6375 746f  tial_shape, cuto
+00006730: 6666 2c20 6f72 6465 722c 2046 616c 7365  ff, order, False
+00006740: 2c20 5472 7565 290d 0a20 2020 2020 2020  , True)..       
+00006750: 2069 6e70 7574 203d 2078 702e 6173 6172   input = xp.asar
+00006760: 7261 7928 7365 6c66 2e76 616c 7565 290d  ray(self.value).
+00006770: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00006780: 6469 6d73 2920 3c20 7365 6c66 2e6e 6469  dims) < self.ndi
+00006790: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
+000067a0: 7765 6967 6874 203d 2061 6464 5f61 7865  weight = add_axe
+000067b0: 7328 7365 6c66 2e61 7865 732c 2073 656c  s(self.axes, sel
+000067c0: 662e 7368 6170 652c 2077 6569 6768 742c  f.shape, weight,
+000067d0: 2064 696d 7329 0d0a 2020 2020 2020 2020   dims)..        
+000067e0: 6f75 7420 3d20 7870 2e66 6674 2e69 7266  out = xp.fft.irf
+000067f0: 6674 6e28 0d0a 2020 2020 2020 2020 2020  ftn(..          
+00006800: 2020 7870 2e61 7361 7272 6179 2877 6569    xp.asarray(wei
+00006810: 6768 7429 202a 2078 702e 6666 742e 7266  ght) * xp.fft.rf
+00006820: 6674 6e28 696e 7075 742c 2061 7865 733d  ftn(input, axes=
+00006830: 7370 6174 6961 6c5f 6178 6573 292c 200d  spatial_axes), .
+00006840: 0a20 2020 2020 2020 2020 2020 2073 3d73  .            s=s
+00006850: 7061 7469 616c 5f73 6861 7065 2c20 0d0a  patial_shape, ..
+00006860: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+00006870: 3d73 7061 7469 616c 5f61 7865 732c 0d0a  =spatial_axes,..
+00006880: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00006890: 2020 2072 6574 7572 6e20 7870 2e61 736e     return xp.asn
+000068a0: 756d 7079 286f 7574 290d 0a20 2020 200d  umpy(out)..    .
+000068b0: 0a20 2020 2040 5f64 6f63 732e 7772 6974  .    @_docs.writ
+000068c0: 655f 646f 6373 0d0a 2020 2020 4064 696d  e_docs..    @dim
+000068d0: 735f 746f 5f73 7061 7469 616c 5f61 7865  s_to_spatial_axe
+000068e0: 730d 0a20 2020 2040 7361 6d65 5f64 7479  s..    @same_dty
+000068f0: 7065 2861 7366 6c6f 6174 3d54 7275 6529  pe(asfloat=True)
+00006900: 0d0a 2020 2020 4063 6865 636b 5f69 6e70  ..    @check_inp
+00006910: 7574 5f61 6e64 5f6f 7574 7075 740d 0a20  ut_and_output.. 
+00006920: 2020 2064 6566 206c 6f77 7061 7373 5f63     def lowpass_c
+00006930: 6f6e 765f 6669 6c74 6572 280d 0a20 2020  onv_filter(..   
+00006940: 2020 2020 2073 656c 662c 0d0a 2020 2020       self,..    
+00006950: 2020 2020 6375 746f 6666 3a20 6e44 466c      cutoff: nDFl
+00006960: 6f61 7420 3d20 302e 322c 0d0a 2020 2020  oat = 0.2,..    
+00006970: 2020 2020 6f72 6465 723a 2066 6c6f 6174      order: float
+00006980: 203d 2032 2c0d 0a20 2020 2020 2020 202a   = 2,..        *
+00006990: 2c20 0d0a 2020 2020 2020 2020 6469 6d73  , ..        dims
+000069a0: 3a20 4469 6d73 203d 204e 6f6e 652c 0d0a  : Dims = None,..
+000069b0: 2020 2020 2020 2020 7570 6461 7465 3a20          update: 
+000069c0: 626f 6f6c 203d 2046 616c 7365 0d0a 2020  bool = False..  
+000069d0: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
+000069e0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000069f0: 2020 2020 2020 2042 7574 7465 7277 6f72         Butterwor
+00006a00: 7468 206c 6f77 2d70 6173 7320 6669 6c74  th low-pass filt
+00006a10: 6572 2069 6e20 7265 616c 2073 7061 6365  er in real space
+00006a20: 2e20 4275 7474 6572 776f 7274 6820 6b65  . Butterworth ke
+00006a30: 726e 656c 2069 7320 6372 6561 7465 6420  rnel is created 
+00006a40: 6669 7273 7420 7573 696e 6720 696e 7665  first using inve
+00006a50: 7273 650d 0a20 2020 2020 2020 2046 6f75  rse..        Fou
+00006a60: 7269 6572 2074 7261 6e73 666f 726d 206f  rier transform o
+00006a70: 6620 7765 6967 6874 2066 756e 6374 696f  f weight functio
+00006a80: 6e2e 0d0a 0d0a 2020 2020 2020 2020 5061  n.....        Pa
+00006a90: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+00006aa0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00006ab0: 2020 2020 2020 6375 746f 6666 203a 2066        cutoff : f
+00006ac0: 6c6f 6174 206f 7220 6172 7261 792d 6c69  loat or array-li
+00006ad0: 6b65 2c20 6465 6661 756c 7420 6973 2030  ke, default is 0
+00006ae0: 2e32 0d0a 2020 2020 2020 2020 2020 2020  .2..            
+00006af0: 4375 746f 6666 2066 7265 7175 656e 6379  Cutoff frequency
+00006b00: 2e0d 0a20 2020 2020 2020 206f 7264 6572  ...        order
+00006b10: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+00006b20: 7420 6973 2032 0d0a 2020 2020 2020 2020  t is 2..        
+00006b30: 2020 2020 5374 6565 706e 6573 7320 6f66      Steepness of
+00006b40: 2063 7574 6f66 662e 0d0a 2020 2020 2020   cutoff...      
+00006b50: 2020 7b64 696d 737d 7b75 7064 6174 657d    {dims}{update}
+00006b60: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+00006b70: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+00006b80: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+00006b90: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+00006ba0: 2020 2020 4669 6c74 6572 6564 2069 6d61      Filtered ima
+00006bb0: 6765 0d0a 2020 2020 2020 2020 2222 2220  ge..        """ 
+00006bc0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00006bd0: 6672 6f6d 202e 5f75 7469 6c73 2e5f 736b  from ._utils._sk
+00006be0: 696d 6167 6520 696d 706f 7274 205f 6765  image import _ge
+00006bf0: 745f 4e44 5f62 7574 7465 7277 6f72 7468  t_ND_butterworth
+00006c00: 5f66 696c 7465 720d 0a20 2020 2020 2020  _filter..       
+00006c10: 206e 6469 6d73 203d 206c 656e 2864 696d   ndims = len(dim
+00006c20: 7329 0d0a 2020 2020 2020 2020 6375 746f  s)..        cuto
+00006c30: 6666 203d 2063 6865 636b 5f6e 6428 6375  ff = check_nd(cu
+00006c40: 746f 6666 2c20 6e64 696d 7329 0d0a 2020  toff, ndims)..  
+00006c50: 2020 2020 2020 6966 2061 6c6c 2828 6320        if all((c 
+00006c60: 3e3d 2030 2e35 2a6e 702e 7371 7274 286e  >= 0.5*np.sqrt(n
+00006c70: 6469 6d73 2920 6f72 2063 203c 3d20 3029  dims) or c <= 0)
+00006c80: 2066 6f72 2063 2069 6e20 6375 746f 6666   for c in cutoff
+00006c90: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00006ca0: 7265 7475 726e 2073 656c 660d 0a20 2020  return self..   
+00006cb0: 2020 2020 2073 7061 7469 616c 5f73 6861       spatial_sha
+00006cc0: 7065 203d 2073 656c 662e 7369 7a65 736f  pe = self.sizeso
+00006cd0: 6628 6469 6d73 290d 0a20 2020 2020 2020  f(dims)..       
+00006ce0: 2077 6569 6768 7420 3d20 5f67 6574 5f4e   weight = _get_N
+00006cf0: 445f 6275 7474 6572 776f 7274 685f 6669  D_butterworth_fi
+00006d00: 6c74 6572 2873 7061 7469 616c 5f73 6861  lter(spatial_sha
+00006d10: 7065 2c20 6375 746f 6666 2c20 6f72 6465  pe, cutoff, orde
+00006d20: 722c 2046 616c 7365 2c20 5472 7565 290d  r, False, True).
+00006d30: 0a20 2020 2020 2020 206b 6572 5f61 6c6c  .        ker_all
+00006d40: 203d 2078 702e 6173 6e75 6d70 7928 7870   = xp.asnumpy(xp
+00006d50: 2e66 6674 2e69 7266 6674 6e28 7870 2e61  .fft.irfftn(xp.a
+00006d60: 7361 7272 6179 2877 6569 6768 7429 2c20  sarray(weight), 
+00006d70: 733d 7370 6174 6961 6c5f 7368 6170 6529  s=spatial_shape)
+00006d80: 290d 0a20 2020 2020 2020 206b 6572 5f61  )..        ker_a
+00006d90: 6c6c 203d 206e 702e 6666 742e 6666 7473  ll = np.fft.ffts
+00006da0: 6869 6674 286b 6572 5f61 6c6c 290d 0a20  hift(ker_all).. 
+00006db0: 2020 2020 2020 2073 6c20 3d20 5b5d 0d0a         sl = []..
+00006dc0: 2020 2020 2020 2020 666f 7220 732c 2063          for s, c
+00006dd0: 2069 6e20 7a69 7028 7370 6174 6961 6c5f   in zip(spatial_
+00006de0: 7368 6170 652c 2063 7574 6f66 6629 3a0d  shape, cutoff):.
+00006df0: 0a20 2020 2020 2020 2020 2020 2072 6164  .            rad
+00006e00: 6975 7320 3d20 696e 7428 6d69 6e28 312f  ius = int(min(1/
+00006e10: 632c 2031 3129 290d 0a20 2020 2020 2020  c, 11))..       
+00006e20: 2020 2020 2073 6c2e 6170 7065 6e64 2873       sl.append(s
+00006e30: 6c69 6365 2873 2f2f 3220 2d20 7261 6469  lice(s//2 - radi
+00006e40: 7573 2c20 732f 2f32 202b 2072 6164 6975  us, s//2 + radiu
+00006e50: 7320 2b20 3129 290d 0a20 2020 2020 2020  s + 1))..       
+00006e60: 206b 6572 203d 206b 6572 5f61 6c6c 5b74   ker = ker_all[t
+00006e70: 7570 6c65 2873 6c29 5d0d 0a20 2020 2020  uple(sl)]..     
+00006e80: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
+00006e90: 6f6e 766f 6c76 6528 6b65 7229 0d0a 2020  onvolve(ker)..  
+00006ea0: 2020 0d0a 2020 2020 4073 616d 655f 6474    ..    @same_dt
+00006eb0: 7970 6528 6173 666c 6f61 743d 5472 7565  ype(asfloat=True
+00006ec0: 290d 0a20 2020 2064 6566 2074 696c 6564  )..    def tiled
+00006ed0: 5f6c 6f77 7061 7373 5f66 696c 7465 7228  _lowpass_filter(
+00006ee0: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
+00006ef0: 0a20 2020 2020 2020 2063 7574 6f66 663a  .        cutoff:
+00006f00: 2066 6c6f 6174 203d 2030 2e32 2c0d 0a20   float = 0.2,.. 
+00006f10: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
+00006f20: 2261 7574 6f22 2c0d 0a20 2020 2020 2020  "auto",..       
+00006f30: 206f 7264 6572 3a20 696e 7420 3d20 322c   order: int = 2,
+00006f40: 200d 0a20 2020 2020 2020 206f 7665 726c   ..        overl
+00006f50: 6170 3a20 696e 7420 3d20 3136 2c0d 0a20  ap: int = 16,.. 
+00006f60: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
+00006f70: 0d0a 2020 2020 2920 2d3e 2049 6d67 4172  ..    ) -> ImgAr
+00006f80: 7261 793a 0d0a 2020 2020 2020 2020 7761  ray:..        wa
+00006f90: 726e 696e 6773 2e77 6172 6e28 0d0a 2020  rnings.warn(..  
+00006fa0: 2020 2020 2020 2020 2020 2260 7469 6c65            "`tile
+00006fb0: 645f 6c6f 7770 6173 735f 6669 6c74 6572  d_lowpass_filter
+00006fc0: 6020 6973 2064 6570 7265 6361 7465 642e  ` is deprecated.
+00006fd0: 2050 6c65 6173 6520 7573 6520 220d 0a20   Please use ".. 
+00006fe0: 2020 2020 2020 2020 2020 2066 2260 696d             f"`im
+00006ff0: 672e 7469 6c65 6428 7b63 6875 6e6b 733d  g.tiled({chunks=
+00007000: 7d2c 207b 6f76 6572 6c61 703d 7d29 2e6c  }, {overlap=}).l
+00007010: 6f77 7061 7373 5f66 696c 7465 7228 7b63  owpass_filter({c
+00007020: 7574 6f66 663d 7d2c 207b 6f72 6465 723d  utoff=}, {order=
+00007030: 7d29 6020 696e 7374 6561 642e 222c 0d0a  })` instead.",..
+00007040: 2020 2020 2020 2020 2020 2020 4465 7072              Depr
+00007050: 6563 6174 696f 6e57 6172 6e69 6e67 2c0d  ecationWarning,.
+00007060: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+00007070: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00007080: 7469 6c65 6428 6368 756e 6b73 2c20 6f76  tiled(chunks, ov
+00007090: 6572 6c61 7029 2e6c 6f77 7061 7373 5f66  erlap).lowpass_f
+000070a0: 696c 7465 7228 6375 746f 6666 2c20 6f72  ilter(cutoff, or
+000070b0: 6465 7229 0d0a 2020 2020 0d0a 2020 2020  der)..    ..    
+000070c0: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+000070d0: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+000070e0: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+000070f0: 2020 4073 616d 655f 6474 7970 6528 6173    @same_dtype(as
+00007100: 666c 6f61 743d 5472 7565 290d 0a20 2020  float=True)..   
+00007110: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
+00007120: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
+00007130: 6620 6869 6768 7061 7373 5f66 696c 7465  f highpass_filte
+00007140: 7228 0d0a 2020 2020 2020 2020 7365 6c66  r(..        self
+00007150: 2c0d 0a20 2020 2020 2020 2063 7574 6f66  ,..        cutof
+00007160: 663a 206e 4446 6c6f 6174 203d 2030 2e32  f: nDFloat = 0.2
+00007170: 2c0d 0a20 2020 2020 2020 206f 7264 6572  ,..        order
+00007180: 3a20 666c 6f61 7420 3d20 322c 0d0a 2020  : float = 2,..  
+00007190: 2020 2020 2020 2a2c 200d 0a20 2020 2020        *, ..     
+000071a0: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
+000071b0: 4e6f 6e65 2c20 0d0a 2020 2020 2020 2020  None, ..        
+000071c0: 7570 6461 7465 3a20 626f 6f6c 203d 2046  update: bool = F
+000071d0: 616c 7365 0d0a 2020 2020 2920 2d3e 2049  alse..    ) -> I
+000071e0: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
+000071f0: 2020 2222 220d 0a20 2020 2020 2020 2042    """..        B
+00007200: 7574 7465 7277 6f72 7468 2068 6967 682d  utterworth high-
+00007210: 7061 7373 2066 696c 7465 722e 0d0a 0d0a  pass filter.....
+00007220: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00007230: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
+00007240: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
+00007250: 6375 746f 6666 203a 2066 6c6f 6174 206f  cutoff : float o
+00007260: 7220 6172 7261 792d 6c69 6b65 2c20 6465  r array-like, de
+00007270: 6661 756c 7420 6973 2030 2e32 0d0a 2020  fault is 0.2..  
+00007280: 2020 2020 2020 2020 2020 4375 746f 6666            Cutoff
+00007290: 2066 7265 7175 656e 6379 2e0d 0a20 2020   frequency...   
+000072a0: 2020 2020 206f 7264 6572 203a 2066 6c6f       order : flo
+000072b0: 6174 2c20 6465 6661 756c 7420 6973 2032  at, default is 2
+000072c0: 0d0a 2020 2020 2020 2020 2020 2020 5374  ..            St
+000072d0: 6565 706e 6573 7320 6f66 2063 7574 6f66  eepness of cutof
+000072e0: 662e 0d0a 2020 2020 2020 2020 7b64 696d  f...        {dim
+000072f0: 737d 7b75 7064 6174 657d 0d0a 0d0a 2020  s}{update}....  
+00007300: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+00007310: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
+00007320: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
+00007330: 0d0a 2020 2020 2020 2020 2020 2020 4669  ..            Fi
+00007340: 6c74 6572 6564 2069 6d61 6765 0d0a 2020  ltered image..  
+00007350: 2020 2020 2020 2222 2220 2020 2020 2020        """       
+00007360: 2020 0d0a 2020 2020 2020 2020 6672 6f6d    ..        from
+00007370: 202e 5f75 7469 6c73 2e5f 736b 696d 6167   ._utils._skimag
+00007380: 6520 696d 706f 7274 205f 6765 745f 4e44  e import _get_ND
+00007390: 5f62 7574 7465 7277 6f72 7468 5f66 696c  _butterworth_fil
+000073a0: 7465 720d 0a20 2020 2020 2020 2063 7574  ter..        cut
+000073b0: 6f66 6620 3d20 6368 6563 6b5f 6e64 2863  off = check_nd(c
+000073c0: 7574 6f66 662c 206c 656e 2864 696d 7329  utoff, len(dims)
+000073d0: 290d 0a20 2020 2020 2020 2073 7061 7469  )..        spati
+000073e0: 616c 5f73 6861 7065 203d 2073 656c 662e  al_shape = self.
+000073f0: 7369 7a65 736f 6628 6469 6d73 290d 0a20  sizesof(dims).. 
+00007400: 2020 2020 2020 2073 7061 7469 616c 5f61         spatial_a
+00007410: 7865 7320 3d20 5b73 656c 662e 6178 6973  xes = [self.axis
+00007420: 6f66 2861 2920 666f 7220 6120 696e 2064  of(a) for a in d
+00007430: 696d 735d 0d0a 2020 2020 2020 2020 7765  ims]..        we
+00007440: 6967 6874 203d 205f 6765 745f 4e44 5f62  ight = _get_ND_b
+00007450: 7574 7465 7277 6f72 7468 5f66 696c 7465  utterworth_filte
+00007460: 7228 7370 6174 6961 6c5f 7368 6170 652c  r(spatial_shape,
+00007470: 2063 7574 6f66 662c 206f 7264 6572 2c20   cutoff, order, 
+00007480: 5472 7565 2c20 5472 7565 290d 0a20 2020  True, True)..   
+00007490: 2020 2020 2069 6e70 7574 203d 2078 702e       input = xp.
+000074a0: 6173 6172 7261 7928 7365 6c66 2e76 616c  asarray(self.val
+000074b0: 7565 290d 0a20 2020 2020 2020 2069 6620  ue)..        if 
+000074c0: 6c65 6e28 6469 6d73 2920 3c20 7365 6c66  len(dims) < self
+000074d0: 2e6e 6469 6d3a 0d0a 2020 2020 2020 2020  .ndim:..        
+000074e0: 2020 2020 7765 6967 6874 203d 2061 6464      weight = add
+000074f0: 5f61 7865 7328 7365 6c66 2e61 7865 732c  _axes(self.axes,
+00007500: 2073 656c 662e 7368 6170 652c 2077 6569   self.shape, wei
+00007510: 6768 742c 2064 696d 7329 0d0a 2020 2020  ght, dims)..    
+00007520: 2020 2020 6f75 7420 3d20 7870 2e66 6674      out = xp.fft
+00007530: 2e69 7266 6674 6e28 7870 2e61 7361 7272  .irfftn(xp.asarr
+00007540: 6179 2877 6569 6768 7429 2a78 702e 6666  ay(weight)*xp.ff
+00007550: 742e 7266 6674 6e28 696e 7075 742c 2061  t.rfftn(input, a
+00007560: 7865 733d 7370 6174 6961 6c5f 6178 6573  xes=spatial_axes
+00007570: 292c 200d 0a20 2020 2020 2020 2020 2020  ), ..           
+00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007590: 2073 3d73 7061 7469 616c 5f73 6861 7065   s=spatial_shape
+000075a0: 2c20 6178 6573 3d73 7061 7469 616c 5f61  , axes=spatial_a
+000075b0: 7865 7329 0d0a 2020 2020 2020 2020 7265  xes)..        re
+000075c0: 7475 726e 2078 702e 6173 6e75 6d70 7928  turn xp.asnumpy(
+000075d0: 6f75 7429 0d0a 2020 2020 0d0a 2020 2020  out)..    ..    
+000075e0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
+000075f0: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
+00007600: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+00007610: 6573 0d0a 2020 2020 4073 616d 655f 6474  es..    @same_dt
+00007620: 7970 6528 6173 666c 6f61 743d 5472 7565  ype(asfloat=True
+00007630: 290d 0a20 2020 2040 6368 6563 6b5f 696e  )..    @check_in
+00007640: 7075 745f 616e 645f 6f75 7470 7574 0d0a  put_and_output..
+00007650: 2020 2020 6465 6620 636f 6e76 6f6c 7665      def convolve
+00007660: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
+00007670: 0d0a 2020 2020 2020 2020 6b65 726e 656c  ..        kernel
+00007680: 2c20 0d0a 2020 2020 2020 2020 2a2c 0d0a  , ..        *,..
+00007690: 2020 2020 2020 2020 6d6f 6465 3a20 5061          mode: Pa
+000076a0: 6464 696e 674d 6f64 6520 3d20 2272 6566  ddingMode = "ref
+000076b0: 6c65 6374 222c 200d 0a20 2020 2020 2020  lect", ..       
+000076c0: 2063 7661 6c3a 2066 6c6f 6174 203d 2030   cval: float = 0
+000076d0: 2c0d 0a20 2020 2020 2020 2064 696d 733a  ,..        dims:
+000076e0: 2044 696d 7320 3d20 4e6f 6e65 2c20 0d0a   Dims = None, ..
+000076f0: 2020 2020 2020 2020 7570 6461 7465 3a20          update: 
+00007700: 626f 6f6c 203d 2046 616c 7365 2c0d 0a20  bool = False,.. 
+00007710: 2020 2029 202d 3e20 496d 6741 7272 6179     ) -> ImgArray
+00007720: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00007730: 2020 2020 2020 2020 4765 6e65 7261 6c20          General 
+00007740: 6c69 6e65 6172 2063 6f6e 766f 6c75 7469  linear convoluti
+00007750: 6f6e 2062 7920 7275 6e6e 696e 6720 6b65  on by running ke
+00007760: 726e 656c 2066 696c 7465 7269 6e67 2e0d  rnel filtering..
+00007770: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00007780: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
+00007790: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
+000077a0: 2020 206b 6572 6e65 6c20 3a20 6172 7261     kernel : arra
+000077b0: 792d 6c69 6b65 0d0a 2020 2020 2020 2020  y-like..        
+000077c0: 2020 2020 436f 6e76 6f6c 7574 696f 6e20      Convolution 
+000077d0: 6b65 726e 656c 2e0d 0a20 2020 2020 2020  kernel...       
+000077e0: 207b 6d6f 6465 7d7b 6376 616c 7d7b 6469   {mode}{cval}{di
+000077f0: 6d73 7d7b 7570 6461 7465 7d0d 0a0d 0a20  ms}{update}.... 
+00007800: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
+00007810: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
+00007820: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
+00007830: 790d 0a20 2020 2020 2020 2020 2020 2043  y..            C
+00007840: 6f6e 766f 6c76 6564 2069 6d61 6765 2e0d  onvolved image..
+00007850: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
+00007860: 2020 2020 0d0a 2020 2020 2020 2020 6b65      ..        ke
+00007870: 726e 656c 203d 206e 702e 6173 6172 7261  rnel = np.asarra
+00007880: 7928 6b65 726e 656c 2c20 6474 7970 653d  y(kernel, dtype=
+00007890: 6e70 2e66 6c6f 6174 3332 290d 0a20 2020  np.float32)..   
+000078a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000078b0: 2e5f 6170 706c 795f 6461 736b 280d 0a20  ._apply_dask(.. 
+000078c0: 2020 2020 2020 2020 2020 205f 6669 6c74             _filt
+000078d0: 6572 732e 636f 6e76 6f6c 7665 2c20 0d0a  ers.convolve, ..
+000078e0: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
+000078f0: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
+00007900: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
+00007910: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
+00007920: 2020 2064 7479 7065 3d73 656c 662e 6474     dtype=self.dt
+00007930: 7970 652c 0d0a 2020 2020 2020 2020 2020  ype,..          
+00007940: 2020 6172 6773 3d28 6b65 726e 656c 2c29    args=(kernel,)
+00007950: 2c0d 0a20 2020 2020 2020 2020 2020 206b  ,..            k
+00007960: 7761 7267 733d 6469 6374 286d 6f64 653d  wargs=dict(mode=
+00007970: 6d6f 6465 2c20 6376 616c 3d63 7661 6c29  mode, cval=cval)
+00007980: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+00007990: 2020 2020 200d 0a20 2020 2040 5f64 6f63       ..    @_doc
+000079a0: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
+000079b0: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
+000079c0: 616c 5f61 7865 730d 0a20 2020 2040 6368  al_axes..    @ch
+000079d0: 6563 6b5f 696e 7075 745f 616e 645f 6f75  eck_input_and_ou
+000079e0: 7470 7574 0d0a 2020 2020 6465 6620 6572  tput..    def er
+000079f0: 6f73 696f 6e28 0d0a 2020 2020 2020 2020  osion(..        
+00007a00: 7365 6c66 2c0d 0a20 2020 2020 2020 2072  self,..        r
+00007a10: 6164 6975 733a 2066 6c6f 6174 203d 2031  adius: float = 1
+00007a20: 2e2c 0d0a 2020 2020 2020 2020 2a2c 200d  .,..        *, .
+00007a30: 0a20 2020 2020 2020 206d 6f64 653a 2050  .        mode: P
+00007a40: 6164 6469 6e67 4d6f 6465 203d 2022 7265  addingMode = "re
+00007a50: 666c 6563 7422 2c0d 0a20 2020 2020 2020  flect",..       
+00007a60: 2063 7661 6c3a 2066 6c6f 6174 203d 2030   cval: float = 0
+00007a70: 2e30 2c0d 0a20 2020 2020 2020 2064 696d  .0,..        dim
+00007a80: 733a 2044 696d 7320 3d20 4e6f 6e65 2c0d  s: Dims = None,.
+00007a90: 0a20 2020 2020 2020 2075 7064 6174 653a  .        update:
+00007aa0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0d0a   bool = False,..
+00007ab0: 2020 2020 2920 2d3e 2049 6d67 4172 7261      ) -> ImgArra
+00007ac0: 793a 0d0a 2020 2020 2020 2020 2222 220d  y:..        """.
+00007ad0: 0a20 2020 2020 2020 204d 6f72 7068 6f6c  .        Morphol
+00007ae0: 6f67 6963 616c 2065 726f 7369 6f6e 2e20  ogical erosion. 
+00007af0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00007b00: 2020 2020 4966 2069 6e70 7574 2069 7320      If input is 
+00007b10: 6269 6e61 7279 2069 6d61 6765 2c20 7468  binary image, th
+00007b20: 6520 7275 6e6e 696e 6720 6675 6e63 7469  e running functi
+00007b30: 6f6e 2077 696c 6c20 6175 746f 6d61 7469  on will automati
+00007b40: 6361 6c6c 7920 7377 6974 6368 6564 2074  cally switched t
+00007b50: 6f0d 0a20 2020 2020 2020 2060 6062 696e  o..        ``bin
+00007b60: 6172 795f 6572 6f73 696f 6e60 6020 746f  ary_erosion`` to
+00007b70: 2073 7065 6564 2075 7020 6361 6c63 756c   speed up calcul
+00007b80: 6174 696f 6e2e 0d0a 0d0a 2020 2020 2020  ation.....      
+00007b90: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00007ba0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00007bb0: 0d0a 2020 2020 2020 2020 7b72 6164 6975  ..        {radiu
+00007bc0: 737d 7b6d 6f64 657d 7b63 7661 6c7d 7b64  s}{mode}{cval}{d
+00007bd0: 696d 737d 7b75 7064 6174 657d 0d0a 0d0a  ims}{update}....
+00007be0: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
+00007bf0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00007c00: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
+00007c10: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+00007c20: 4669 6c74 6572 6564 2069 6d61 6765 2e0d  Filtered image..
+00007c30: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
+00007c40: 2020 2020 0d0a 2020 2020 2020 2020 6469      ..        di
+00007c50: 736b 203d 205f 7374 7275 6374 7572 6573  sk = _structures
+00007c60: 2e62 616c 6c5f 6c69 6b65 2872 6164 6975  .ball_like(radiu
+00007c70: 732c 206c 656e 2864 696d 7329 290d 0a20  s, len(dims)).. 
+00007c80: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+00007c90: 7479 7065 203d 3d20 626f 6f6c 3a0d 0a20  type == bool:.. 
+00007ca0: 2020 2020 2020 2020 2020 2066 203d 205f             f = _
+00007cb0: 6669 6c74 6572 732e 6269 6e61 7279 5f65  filters.binary_e
+00007cc0: 726f 7369 6f6e 0d0a 2020 2020 2020 2020  rosion..        
+00007cd0: 2020 2020 6b77 6172 6773 203d 2064 6963      kwargs = dic
+00007ce0: 7428 7374 7275 6374 7572 653d 6469 736b  t(structure=disk
+00007cf0: 2c20 626f 7264 6572 5f76 616c 7565 3d31  , border_value=1
+00007d00: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00007d10: 0d0a 2020 2020 2020 2020 2020 2020 6620  ..            f 
+00007d20: 3d20 5f66 696c 7465 7273 2e65 726f 7369  = _filters.erosi
+00007d30: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00007d40: 6b77 6172 6773 203d 2064 6963 7428 666f  kwargs = dict(fo
+00007d50: 6f74 7072 696e 743d 6469 736b 2c20 6d6f  otprint=disk, mo
+00007d60: 6465 3d6d 6f64 652c 2063 7661 6c3d 6376  de=mode, cval=cv
+00007d70: 616c 290d 0a20 2020 2020 2020 2072 6574  al)..        ret
+00007d80: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
+00007d90: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
+00007da0: 2020 2066 2c20 0d0a 2020 2020 2020 2020     f, ..        
+00007db0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
+00007dc0: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
+00007dd0: 2073 656c 662e 6178 6573 292c 200d 0a20   self.axes), .. 
+00007de0: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+00007df0: 3d73 656c 662e 6474 7970 652c 0d0a 2020  =self.dtype,..  
+00007e00: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+00007e10: 3d6b 7761 7267 730d 0a20 2020 2020 2020  =kwargs..       
+00007e20: 2029 0d0a 2020 2020 0d0a 2020 2020 405f   )..    ..    @_
+00007e30: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
+00007e40: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
+00007e50: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
+00007e60: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
+00007e70: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
+00007e80: 2064 696c 6174 696f 6e28 0d0a 2020 2020   dilation(..    
+00007e90: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
+00007ea0: 2020 2072 6164 6975 733a 2066 6c6f 6174     radius: float
+00007eb0: 203d 2031 2c0d 0a20 2020 2020 2020 202a   = 1,..        *
+00007ec0: 2c20 0d0a 2020 2020 2020 2020 6d6f 6465  , ..        mode
+00007ed0: 3a20 5061 6464 696e 674d 6f64 6520 3d20  : PaddingMode = 
+00007ee0: 2272 6566 6c65 6374 222c 0d0a 2020 2020  "reflect",..    
+00007ef0: 2020 2020 6376 616c 3a20 666c 6f61 7420      cval: float 
+00007f00: 3d20 302e 302c 0d0a 2020 2020 2020 2020  = 0.0,..        
+00007f10: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+00007f20: 652c 0d0a 2020 2020 2020 2020 7570 6461  e,..        upda
+00007f30: 7465 3a20 626f 6f6c 203d 2046 616c 7365  te: bool = False
+00007f40: 2c0d 0a20 2020 2029 202d 3e20 496d 6741  ,..    ) -> ImgA
+00007f50: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
+00007f60: 2222 0d0a 2020 2020 2020 2020 4d6f 7270  ""..        Morp
+00007f70: 686f 6c6f 6769 6361 6c20 6469 6c61 7469  hological dilati
+00007f80: 6f6e 2e20 4966 2069 6e70 7574 2069 7320  on. If input is 
+00007f90: 6269 6e61 7279 2069 6d61 6765 2c20 7468  binary image, th
+00007fa0: 6520 7275 6e6e 696e 6720 6675 6e63 7469  e running functi
+00007fb0: 6f6e 2077 696c 6c20 6175 746f 6d61 7469  on will automati
+00007fc0: 6361 6c6c 7920 7377 6974 6368 6564 2074  cally switched t
+00007fd0: 6f0d 0a20 2020 2020 2020 2060 6062 696e  o..        ``bin
+00007fe0: 6172 795f 6469 6c61 7469 6f6e 6060 2074  ary_dilation`` t
+00007ff0: 6f20 7370 6565 6420 7570 2063 616c 6375  o speed up calcu
+00008000: 6c61 7469 6f6e 2e0d 0a0d 0a20 2020 2020  lation.....     
+00008010: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+00008020: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00008030: 2d0d 0a20 2020 2020 2020 207b 7261 6469  -..        {radi
+00008040: 7573 7d7b 6d6f 6465 7d7b 6376 616c 7d7b  us}{mode}{cval}{
+00008050: 6469 6d73 7d7b 7570 6461 7465 7d0d 0a0d  dims}{update}...
+00008060: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00008070: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+00008080: 2d0d 0a20 2020 2020 2020 2049 6d67 4172  -..        ImgAr
+00008090: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
+000080a0: 2046 696c 7465 7265 6420 696d 6167 652e   Filtered image.
+000080b0: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
+000080c0: 2020 2020 200d 0a20 2020 2020 2020 2064       ..        d
+000080d0: 6973 6b20 3d20 5f73 7472 7563 7475 7265  isk = _structure
+000080e0: 732e 6261 6c6c 5f6c 696b 6528 7261 6469  s.ball_like(radi
+000080f0: 7573 2c20 6c65 6e28 6469 6d73 2929 0d0a  us, len(dims))..
+00008100: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00008110: 6474 7970 6520 3d3d 2062 6f6f 6c3a 0d0a  dtype == bool:..
+00008120: 2020 2020 2020 2020 2020 2020 6620 3d20              f = 
+00008130: 5f66 696c 7465 7273 2e62 696e 6172 795f  _filters.binary_
+00008140: 6469 6c61 7469 6f6e 0d0a 2020 2020 2020  dilation..      
+00008150: 2020 2020 2020 6b77 6172 6773 203d 2064        kwargs = d
+00008160: 6963 7428 7374 7275 6374 7572 653d 6469  ict(structure=di
+00008170: 736b 290d 0a20 2020 2020 2020 2065 6c73  sk)..        els
+00008180: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00008190: 6620 3d20 5f66 696c 7465 7273 2e64 696c  f = _filters.dil
+000081a0: 6174 696f 6e0d 0a20 2020 2020 2020 2020  ation..         
+000081b0: 2020 206b 7761 7267 7320 3d20 6469 6374     kwargs = dict
+000081c0: 2866 6f6f 7470 7269 6e74 3d64 6973 6b2c  (footprint=disk,
+000081d0: 206d 6f64 653d 6d6f 6465 2c20 6376 616c   mode=mode, cval
+000081e0: 3d63 7661 6c29 0d0a 2020 2020 2020 2020  =cval)..        
+000081f0: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
+00008200: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
+00008210: 2020 2020 2020 662c 200d 0a20 2020 2020        f, ..     
+00008220: 2020 2020 2020 2063 5f61 7865 733d 636f         c_axes=co
+00008230: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
+00008240: 6d73 2c20 7365 6c66 2e61 7865 7329 2c20  ms, self.axes), 
+00008250: 0d0a 2020 2020 2020 2020 2020 2020 6474  ..            dt
+00008260: 7970 653d 7365 6c66 2e64 7479 7065 2c0d  ype=self.dtype,.
+00008270: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+00008280: 7267 733d 6b77 6172 6773 0d0a 2020 2020  rgs=kwargs..    
+00008290: 2020 2020 290d 0a20 2020 200d 0a20 2020      )..    ..   
+000082a0: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
+000082b0: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
+000082c0: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
+000082d0: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
+000082e0: 616e 645f 6f75 7470 7574 0d0a 2020 2020  and_output..    
+000082f0: 6465 6620 6f70 656e 696e 6728 0d0a 2020  def opening(..  
+00008300: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
+00008310: 2020 2020 2072 6164 6975 733a 2066 6c6f       radius: flo
+00008320: 6174 203d 2031 2c0d 0a20 2020 2020 2020  at = 1,..       
+00008330: 202a 2c0d 0a20 2020 2020 2020 206d 6f64   *,..        mod
+00008340: 653a 2050 6164 6469 6e67 4d6f 6465 203d  e: PaddingMode =
+00008350: 2022 7265 666c 6563 7422 2c0d 0a20 2020   "reflect",..   
+00008360: 2020 2020 2063 7661 6c3a 2066 6c6f 6174       cval: float
+00008370: 203d 2030 2e30 2c0d 0a20 2020 2020 2020   = 0.0,..       
+00008380: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
+00008390: 6e65 2c0d 0a20 2020 2020 2020 2075 7064  ne,..        upd
+000083a0: 6174 653a 2062 6f6f 6c20 3d20 4661 6c73  ate: bool = Fals
+000083b0: 652c 0d0a 2020 2020 2920 2d3e 2049 6d67  e,..    ) -> Img
+000083c0: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
+000083d0: 2222 220d 0a20 2020 2020 2020 204d 6f72  """..        Mor
+000083e0: 7068 6f6c 6f67 6963 616c 206f 7065 6e69  phological openi
+000083f0: 6e67 2e20 4966 2069 6e70 7574 2069 7320  ng. If input is 
+00008400: 6269 6e61 7279 2069 6d61 6765 2c20 7468  binary image, th
+00008410: 6520 7275 6e6e 696e 6720 6675 6e63 7469  e running functi
+00008420: 6f6e 2077 696c 6c20 6175 746f 6d61 7469  on will automati
+00008430: 6361 6c6c 7920 7377 6974 6368 6564 2074  cally switched t
+00008440: 6f0d 0a20 2020 2020 2020 2060 6062 696e  o..        ``bin
+00008450: 6172 795f 6f70 656e 696e 6760 6020 746f  ary_opening`` to
+00008460: 2073 7065 6564 2075 7020 6361 6c63 756c   speed up calcul
+00008470: 6174 696f 6e2e 0d0a 0d0a 2020 2020 2020  ation.....      
+00008480: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00008490: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+000084a0: 0d0a 2020 2020 2020 2020 7b72 6164 6975  ..        {radiu
+000084b0: 737d 7b6d 6f64 657d 7b63 7661 6c7d 7b64  s}{mode}{cval}{d
+000084c0: 696d 737d 7b75 7064 6174 657d 0d0a 0d0a  ims}{update}....
+000084d0: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
+000084e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000084f0: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
+00008500: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+00008510: 4669 6c74 6572 6564 2069 6d61 6765 2e0d  Filtered image..
+00008520: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
+00008530: 2020 2020 0d0a 2020 2020 2020 2020 6469      ..        di
+00008540: 736b 203d 205f 7374 7275 6374 7572 6573  sk = _structures
+00008550: 2e62 616c 6c5f 6c69 6b65 2872 6164 6975  .ball_like(radiu
+00008560: 732c 206c 656e 2864 696d 7329 290d 0a20  s, len(dims)).. 
+00008570: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+00008580: 7479 7065 203d 3d20 626f 6f6c 3a0d 0a20  type == bool:.. 
+00008590: 2020 2020 2020 2020 2020 2066 203d 205f             f = _
+000085a0: 6669 6c74 6572 732e 6269 6e61 7279 5f6f  filters.binary_o
+000085b0: 7065 6e69 6e67 0d0a 2020 2020 2020 2020  pening..        
+000085c0: 2020 2020 6b77 6172 6773 203d 2064 6963      kwargs = dic
+000085d0: 7428 7374 7275 6374 7572 653d 6469 736b  t(structure=disk
+000085e0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+000085f0: 0d0a 2020 2020 2020 2020 2020 2020 6620  ..            f 
+00008600: 3d20 5f66 696c 7465 7273 2e6f 7065 6e69  = _filters.openi
+00008610: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
+00008620: 6b77 6172 6773 203d 2064 6963 7428 666f  kwargs = dict(fo
+00008630: 6f74 7072 696e 743d 6469 736b 2c20 6d6f  otprint=disk, mo
+00008640: 6465 3d6d 6f64 652c 2063 7661 6c3d 6376  de=mode, cval=cv
+00008650: 616c 290d 0a20 2020 2020 2020 2072 6574  al)..        ret
+00008660: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
+00008670: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
+00008680: 2020 2066 2c20 0d0a 2020 2020 2020 2020     f, ..        
+00008690: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
+000086a0: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
+000086b0: 2073 656c 662e 6178 6573 292c 200d 0a20   self.axes), .. 
+000086c0: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+000086d0: 3d73 656c 662e 6474 7970 652c 0d0a 2020  =self.dtype,..  
+000086e0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+000086f0: 3d6b 7761 7267 730d 0a20 2020 2020 2020  =kwargs..       
+00008700: 2029 0d0a 2020 2020 0d0a 2020 2020 405f   )..    ..    @_
+00008710: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
+00008720: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
+00008730: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
+00008740: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
+00008750: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
+00008760: 2063 6c6f 7369 6e67 280d 0a20 2020 2020   closing(..     
+00008770: 2020 2073 656c 662c 0d0a 2020 2020 2020     self,..      
+00008780: 2020 7261 6469 7573 3a20 666c 6f61 7420    radius: float 
+00008790: 3d20 312c 0d0a 2020 2020 2020 2020 2a2c  = 1,..        *,
+000087a0: 200d 0a20 2020 2020 2020 206d 6f64 653a   ..        mode:
+000087b0: 2050 6164 6469 6e67 4d6f 6465 203d 2022   PaddingMode = "
+000087c0: 7265 666c 6563 7422 2c0d 0a20 2020 2020  reflect",..     
+000087d0: 2020 2063 7661 6c3a 2066 6c6f 6174 203d     cval: float =
+000087e0: 2030 2e30 2c0d 0a20 2020 2020 2020 2064   0.0,..        d
+000087f0: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
+00008800: 2c0d 0a20 2020 2020 2020 2075 7064 6174  ,..        updat
+00008810: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
+00008820: 0d0a 2020 2020 2920 2d3e 2049 6d67 4172  ..    ) -> ImgAr
+00008830: 7261 793a 0d0a 2020 2020 2020 2020 2222  ray:..        ""
+00008840: 220d 0a20 2020 2020 2020 204d 6f72 7068  "..        Morph
+00008850: 6f6c 6f67 6963 616c 2063 6c6f 7369 6e67  ological closing
+00008860: 2e20 0d0a 2020 2020 2020 2020 0d0a 2020  . ..        ..  
+00008870: 2020 2020 2020 4966 2069 6e70 7574 2069        If input i
+00008880: 7320 6269 6e61 7279 2069 6d61 6765 2c20  s binary image, 
+00008890: 7468 6520 7275 6e6e 696e 6720 6675 6e63  the running func
+000088a0: 7469 6f6e 2077 696c 6c20 6175 746f 6d61  tion will automa
+000088b0: 7469 6361 6c6c 7920 7377 6974 6368 6564  tically switched
+000088c0: 2074 6f0d 0a20 2020 2020 2020 2060 6062   to..        ``b
+000088d0: 696e 6172 795f 636c 6f73 696e 6760 6020  inary_closing`` 
+000088e0: 746f 2073 7065 6564 2075 7020 6361 6c63  to speed up calc
+000088f0: 756c 6174 696f 6e2e 0d0a 0d0a 2020 2020  ulation.....    
+00008900: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+00008910: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00008920: 2d2d 0d0a 2020 2020 2020 2020 7b72 6164  --..        {rad
+00008930: 6975 737d 7b64 696d 737d 7b6d 6f64 657d  ius}{dims}{mode}
+00008940: 7b63 7661 6c7d 7b75 7064 6174 657d 0d0a  {cval}{update}..
+00008950: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00008960: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00008970: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
+00008980: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
+00008990: 2020 4669 6c74 6572 6564 2069 6d61 6765    Filtered image
+000089a0: 2e0d 0a20 2020 2020 2020 2022 2222 2020  ...        """  
+000089b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000089c0: 6469 736b 203d 205f 7374 7275 6374 7572  disk = _structur
+000089d0: 6573 2e62 616c 6c5f 6c69 6b65 2872 6164  es.ball_like(rad
+000089e0: 6975 732c 206c 656e 2864 696d 7329 290d  ius, len(dims)).
+000089f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008a00: 2e64 7479 7065 203d 3d20 626f 6f6c 3a0d  .dtype == bool:.
+00008a10: 0a20 2020 2020 2020 2020 2020 2066 203d  .            f =
+00008a20: 205f 6669 6c74 6572 732e 6269 6e61 7279   _filters.binary
+00008a30: 5f63 6c6f 7369 6e67 0d0a 2020 2020 2020  _closing..      
+00008a40: 2020 2020 2020 6b77 6172 6773 203d 2064        kwargs = d
+00008a50: 6963 7428 7374 7275 6374 7572 653d 6469  ict(structure=di
+00008a60: 736b 290d 0a20 2020 2020 2020 2065 6c73  sk)..        els
+00008a70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00008a80: 6620 3d20 5f66 696c 7465 7273 2e63 6c6f  f = _filters.clo
+00008a90: 7369 6e67 0d0a 2020 2020 2020 2020 2020  sing..          
+00008aa0: 2020 6b77 6172 6773 203d 2064 6963 7428    kwargs = dict(
+00008ab0: 666f 6f74 7072 696e 743d 6469 736b 2c20  footprint=disk, 
+00008ac0: 6d6f 6465 3d6d 6f64 652c 2063 7661 6c3d  mode=mode, cval=
+00008ad0: 6376 616c 290d 0a20 2020 2020 2020 2072  cval)..        r
+00008ae0: 6574 7572 6e20 7365 6c66 2e5f 6170 706c  eturn self._appl
+00008af0: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
+00008b00: 2020 2020 2066 2c20 0d0a 2020 2020 2020       f, ..      
+00008b10: 2020 2020 2020 635f 6178 6573 3d63 6f6d        c_axes=com
+00008b20: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
+00008b30: 732c 2073 656c 662e 6178 6573 292c 200d  s, self.axes), .
+00008b40: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
+00008b50: 7065 3d73 656c 662e 6474 7970 652c 0d0a  pe=self.dtype,..
+00008b60: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+00008b70: 6773 3d6b 7761 7267 730d 0a20 2020 2020  gs=kwargs..     
+00008b80: 2020 2029 0d0a 2020 2020 0d0a 2020 2020     )..    ..    
+00008b90: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+00008ba0: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+00008bb0: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+00008bc0: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
+00008bd0: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
+00008be0: 6566 2074 6f70 6861 7428 0d0a 2020 2020  ef tophat(..    
+00008bf0: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
+00008c00: 2020 2072 6164 6975 733a 2066 6c6f 6174     radius: float
+00008c10: 203d 2033 302c 0d0a 2020 2020 2020 2020   = 30,..        
+00008c20: 2a2c 0d0a 2020 2020 2020 2020 6d6f 6465  *,..        mode
+00008c30: 3a20 5061 6464 696e 674d 6f64 6520 3d20  : PaddingMode = 
+00008c40: 2272 6566 6c65 6374 222c 0d0a 2020 2020  "reflect",..    
+00008c50: 2020 2020 6376 616c 3a20 666c 6f61 7420      cval: float 
+00008c60: 3d20 302e 302c 0d0a 2020 2020 2020 2020  = 0.0,..        
+00008c70: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+00008c80: 652c 0d0a 2020 2020 2020 2020 7570 6461  e,..        upda
+00008c90: 7465 3a20 626f 6f6c 203d 2046 616c 7365  te: bool = False
+00008ca0: 2c0d 0a20 2020 2029 202d 3e20 496d 6741  ,..    ) -> ImgA
+00008cb0: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
+00008cc0: 2222 0d0a 2020 2020 2020 2020 546f 7068  ""..        Toph
+00008cd0: 6174 206d 6f72 7068 6f6c 6f67 6963 616c  at morphological
+00008ce0: 2069 6d61 6765 2070 726f 6365 7373 696e   image processin
+00008cf0: 672e 2054 6869 7320 6973 2075 7365 6675  g. This is usefu
+00008d00: 6c20 666f 7220 6261 636b 6772 6f75 6e64  l for background
+00008d10: 2073 7562 7472 6163 7469 6f6e 2e0d 0a0d   subtraction....
+00008d20: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00008d30: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
+00008d40: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00008d50: 207b 7261 6469 7573 7d7b 6d6f 6465 7d7b   {radius}{mode}{
+00008d60: 6376 616c 7d7b 6469 6d73 7d7b 7570 6461  cval}{dims}{upda
+00008d70: 7465 7d0d 0a0d 0a20 2020 2020 2020 2052  te}....        R
+00008d80: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
+00008d90: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00008da0: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
+00008db0: 2020 2020 2020 2046 696c 7465 7265 6420         Filtered 
+00008dc0: 696d 6167 652e 0d0a 2020 2020 2020 2020  image...        
+00008dd0: 2222 2220 2020 2020 2020 200d 0a20 2020  """        ..   
+00008de0: 2020 2020 200d 0a20 2020 2020 2020 2064       ..        d
+00008df0: 6973 6b20 3d20 5f73 7472 7563 7475 7265  isk = _structure
+00008e00: 732e 6261 6c6c 5f6c 696b 6528 7261 6469  s.ball_like(radi
+00008e10: 7573 2c20 6c65 6e28 6469 6d73 2929 0d0a  us, len(dims))..
+00008e20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00008e30: 656c 662e 5f61 7070 6c79 5f64 6173 6b28  elf._apply_dask(
+00008e40: 0d0a 2020 2020 2020 2020 2020 2020 5f66  ..            _f
+00008e50: 696c 7465 7273 2e77 6869 7465 5f74 6f70  ilters.white_top
+00008e60: 6861 742c 200d 0a20 2020 2020 2020 2020  hat, ..         
+00008e70: 2020 2063 5f61 7865 733d 636f 6d70 6c65     c_axes=comple
+00008e80: 6d65 6e74 5f61 7865 7328 6469 6d73 2c20  ment_axes(dims, 
+00008e90: 7365 6c66 2e61 7865 7329 2c20 0d0a 2020  self.axes), ..  
+00008ea0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
+00008eb0: 7365 6c66 2e64 7479 7065 2c0d 0a20 2020  self.dtype,..   
+00008ec0: 2020 2020 2020 2020 206b 7761 7267 733d           kwargs=
+00008ed0: 6469 6374 2866 6f6f 7470 7269 6e74 3d64  dict(footprint=d
+00008ee0: 6973 6b2c 206d 6f64 653d 6d6f 6465 2c20  isk, mode=mode, 
+00008ef0: 6376 616c 3d63 7661 6c29 0d0a 2020 2020  cval=cval)..    
+00008f00: 2020 2020 290d 0a20 2020 200d 0a20 2020      )..    ..   
+00008f10: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
+00008f20: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
+00008f30: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
+00008f40: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
+00008f50: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
+00008f60: 286f 6e6c 795f 6269 6e61 7279 3d54 7275  (only_binary=Tru
+00008f70: 6529 0d0a 2020 2020 6465 6620 736d 6f6f  e)..    def smoo
+00008f80: 7468 5f6d 6173 6b28 0d0a 2020 2020 2020  th_mask(..      
+00008f90: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
+00008fa0: 2073 6967 6d61 3a20 666c 6f61 7420 3d20   sigma: float = 
+00008fb0: 322e 302c 0d0a 2020 2020 2020 2020 6469  2.0,..        di
+00008fc0: 6c61 7465 5f72 6164 6975 733a 2066 6c6f  late_radius: flo
+00008fd0: 6174 203d 2032 2e30 2c0d 0a20 2020 2020  at = 2.0,..     
+00008fe0: 2020 206d 6173 6b5f 6c69 6768 743a 2062     mask_light: b
+00008ff0: 6f6f 6c20 3d20 4661 6c73 652c 0d0a 2020  ool = False,..  
+00009000: 2020 2020 2020 2a2c 0d0a 2020 2020 2020        *,..      
+00009010: 2020 6469 6d73 3a20 4469 6d73 203d 204e    dims: Dims = N
+00009020: 6f6e 650d 0a20 2020 2029 202d 3e20 496d  one..    ) -> Im
+00009030: 6741 7272 6179 3a0d 0a20 2020 2020 2020  gArray:..       
+00009040: 2022 2222 0d0a 2020 2020 2020 2020 536d   """..        Sm
+00009050: 6f6f 7468 656e 2062 696e 6172 7920 6d61  oothen binary ma
+00009060: 736b 2069 6d61 6765 2061 7420 6974 7320  sk image at its 
+00009070: 6564 6765 732e 2054 6869 7320 6973 2075  edges. This is u
+00009080: 7365 6675 6c20 746f 206d 616b 6520 6120  seful to make a 
+00009090: 2273 6f66 7420 6d61 736b 222e 0d0a 2020  "soft mask"...  
+000090a0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000090b0: 5468 6973 206d 6574 686f 6420 6170 706c  This method appl
+000090c0: 6965 7320 6572 6f73 696f 6e2f 6469 6c61  ies erosion/dila
+000090d0: 7469 6f6e 2074 6f20 6120 6269 6e61 7279  tion to a binary
+000090e0: 2069 6d61 6765 2061 6e64 2074 6865 6e20   image and then 
+000090f0: 736d 6f6f 7468 2069 7473 2065 6467 6573  smooth its edges
+00009100: 2062 7920 4761 7573 7369 616e 2e0d 0a20   by Gaussian... 
+00009110: 2020 2020 2020 2054 6865 2074 6f74 616c         The total
+00009120: 2076 616c 7565 2069 7320 616c 7761 7973   value is always
+00009130: 206c 6172 6765 7220 6166 7465 7220 4761   larger after Ga
+00009140: 7573 7369 616e 2073 6d6f 6f74 6869 6e67  ussian smoothing
+00009150: 2e0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
+00009160: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
+00009170: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+00009180: 2020 2020 2073 6967 6d61 203a 2066 6c6f       sigma : flo
+00009190: 6174 2c20 6465 6661 756c 7420 6973 2032  at, default is 2
+000091a0: 2e30 0d0a 2020 2020 2020 2020 2020 2020  .0..            
+000091b0: 5374 616e 6461 7264 2064 6576 6961 7469  Standard deviati
+000091c0: 6f6e 206f 6620 4761 7573 7369 616e 2062  on of Gaussian b
+000091d0: 6c75 722e 0d0a 2020 2020 2020 2020 6469  lur...        di
+000091e0: 6c61 7465 5f72 6164 6975 7320 3a20 666c  late_radius : fl
+000091f0: 6f61 742c 2064 6566 6175 6c74 2069 7320  oat, default is 
+00009200: 322e 300d 0a20 2020 2020 2020 2020 2020  2.0..           
+00009210: 2052 6164 6975 7320 696e 2070 6978 656c   Radius in pixel
+00009220: 2074 6861 7420 7769 6c6c 2062 6520 7573   that will be us
+00009230: 6564 2074 6f20 6469 6c61 7465 206d 6173  ed to dilate mas
+00009240: 6b20 6265 666f 7265 2073 6d6f 6f74 6869  k before smoothi
+00009250: 6e67 2e0d 0a20 2020 2020 2020 206d 6173  ng...        mas
+00009260: 6b5f 6c69 6768 7420 3a20 626f 6f6c 2c20  k_light : bool, 
+00009270: 6465 6661 756c 7420 6973 2046 616c 7365  default is False
+00009280: 0d0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+00009290: 2074 7275 652c 206d 6173 6b20 6172 7261   true, mask arra
+000092a0: 7920 6973 2063 6f6e 7369 6465 7265 6420  y is considered 
+000092b0: 746f 206d 6173 6b20 6f74 6865 7220 696d  to mask other im
+000092c0: 6167 6520 6174 2069 7473 2054 7275 6520  age at its True 
+000092d0: 7661 6c75 6573 2e20 4f74 6865 7277 6973  values. Otherwis
+000092e0: 6520 6d61 736b 2061 7272 6179 200d 0a20  e mask array .. 
+000092f0: 2020 2020 2020 2020 2020 2070 6c61 7973             plays
+00009300: 206d 6f72 6520 6c69 6b65 2061 2077 6569   more like a wei
+00009310: 6768 7420 6172 7261 792c 2074 6861 7420  ght array, that 
+00009320: 6973 2c20 4661 6c73 6520 7265 6769 6f6e  is, False region
+00009330: 2077 696c 6c20 6265 207a 6572 6f2e 0d0a   will be zero...
+00009340: 2020 2020 2020 2020 7b64 696d 737d 0d0a          {dims}..
+00009350: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00009360: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+00009370: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
+00009380: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
+00009390: 0d0a 2020 2020 2020 2020 2020 2020 536d  ..            Sm
+000093a0: 6f6f 7468 656e 6564 206d 6173 6b20 696d  oothened mask im
+000093b0: 6167 652e 0d0a 2020 2020 2020 2020 2222  age...        ""
+000093c0: 220d 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
+000093d0: 7420 6d61 736b 5f6c 6967 6874 3a0d 0a20  t mask_light:.. 
+000093e0: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+000093f0: 3d20 7e73 656c 660d 0a20 2020 2020 2020  = ~self..       
+00009400: 200d 0a20 2020 2020 2020 2069 6620 6469   ..        if di
+00009410: 6c61 7465 5f72 6164 6975 7320 3e20 303a  late_radius > 0:
+00009420: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00009430: 6c66 203d 2073 656c 662e 6572 6f73 696f  lf = self.erosio
+00009440: 6e28 6469 6c61 7465 5f72 6164 6975 732c  n(dilate_radius,
+00009450: 2064 696d 733d 6469 6d73 290d 0a20 2020   dims=dims)..   
+00009460: 2020 2020 2065 6c69 6620 6469 6c61 7465       elif dilate
+00009470: 5f72 6164 6975 7320 3c20 303a 0d0a 2020  _radius < 0:..  
+00009480: 2020 2020 2020 2020 2020 7365 6c66 203d            self =
+00009490: 2073 656c 662e 6469 6c61 7469 6f6e 282d   self.dilation(-
+000094a0: 6469 6c61 7465 5f72 6164 6975 732c 2064  dilate_radius, d
+000094b0: 696d 733d 6469 6d73 290d 0a20 2020 2020  ims=dims)..     
+000094c0: 2020 200d 0a20 2020 2020 2020 2069 6620     ..        if 
+000094d0: 7369 676d 6120 3e20 303a 0d0a 2020 2020  sigma > 0:..    
+000094e0: 2020 2020 2020 2020 6469 7374 203d 2073          dist = s
+000094f0: 656c 662e 6469 7374 616e 6365 5f6d 6170  elf.distance_map
+00009500: 2864 696d 733d 6469 6d73 290d 0a20 2020  (dims=dims)..   
+00009510: 2020 2020 2020 2020 2062 6c75 7272 6564           blurred
+00009520: 5f6d 6173 6b20 3d20 6e70 2e65 7870 282d  _mask = np.exp(-
+00009530: 6469 7374 2a2a 322f 322f 7369 676d 612a  dist**2/2/sigma*
+00009540: 2a32 290d 0a20 2020 2020 2020 2065 6c69  *2)..        eli
+00009550: 6620 7369 676d 6120 3d3d 2030 3a0d 0a20  f sigma == 0:.. 
+00009560: 2020 2020 2020 2020 2020 2062 6c75 7272             blurr
+00009570: 6564 5f6d 6173 6b20 3d20 3120 2d20 7365  ed_mask = 1 - se
+00009580: 6c66 2e61 7374 7970 6528 6e70 2e66 6c6f  lf.astype(np.flo
+00009590: 6174 3332 290d 0a20 2020 2020 2020 2065  at32)..        e
+000095a0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000095b0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000095c0: 6f72 2822 7369 676d 6120 6d75 7374 2062  or("sigma must b
+000095d0: 6520 6e6f 6e2d 6e65 6761 7469 7665 2e22  e non-negative."
+000095e0: 290d 0a20 2020 2020 2020 2069 6620 6d61  )..        if ma
+000095f0: 736b 5f6c 6967 6874 3a0d 0a20 2020 2020  sk_light:..     
+00009600: 2020 2020 2020 2062 6c75 7272 6564 5f6d         blurred_m
+00009610: 6173 6b20 3d20 3120 2d20 626c 7572 7265  ask = 1 - blurre
+00009620: 645f 6d61 736b 0d0a 2020 2020 2020 2020  d_mask..        
+00009630: 7265 7475 726e 2062 6c75 7272 6564 5f6d  return blurred_m
+00009640: 6173 6b0d 0a20 2020 200d 0a20 2020 2040  ask..    ..    @
+00009650: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
+00009660: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
+00009670: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
+00009680: 2040 7361 6d65 5f64 7479 7065 2861 7366   @same_dtype(asf
+00009690: 6c6f 6174 3d54 7275 6529 0d0a 2020 2020  loat=True)..    
+000096a0: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
+000096b0: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
+000096c0: 206d 6561 6e5f 6669 6c74 6572 280d 0a20   mean_filter(.. 
+000096d0: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
+000096e0: 2020 2020 2020 7261 6469 7573 3a20 666c        radius: fl
+000096f0: 6f61 7420 3d20 312c 0d0a 2020 2020 2020  oat = 1,..      
+00009700: 2020 2a2c 0d0a 2020 2020 2020 2020 6d6f    *,..        mo
+00009710: 6465 3a20 5061 6464 696e 674d 6f64 6520  de: PaddingMode 
+00009720: 3d20 2272 6566 6c65 6374 222c 0d0a 2020  = "reflect",..  
+00009730: 2020 2020 2020 6376 616c 3a20 666c 6f61        cval: floa
+00009740: 7420 3d20 302e 302c 0d0a 2020 2020 2020  t = 0.0,..      
+00009750: 2020 6469 6d73 3a20 4469 6d73 203d 204e    dims: Dims = N
+00009760: 6f6e 652c 0d0a 2020 2020 2020 2020 7570  one,..        up
+00009770: 6461 7465 3a20 626f 6f6c 203d 2046 616c  date: bool = Fal
+00009780: 7365 2920 2d3e 2049 6d67 4172 7261 793a  se) -> ImgArray:
+00009790: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000097a0: 2020 2020 2020 204d 6561 6e20 6669 6c74         Mean filt
+000097b0: 6572 2e20 4b65 726e 656c 2069 7320 6669  er. Kernel is fi
+000097c0: 6c6c 6564 2077 6974 6820 7361 6d65 2076  lled with same v
+000097d0: 616c 7565 732e 0d0a 0d0a 2020 2020 2020  alues.....      
+000097e0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+000097f0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00009800: 0d0a 2020 2020 2020 2020 7b72 6164 6975  ..        {radiu
+00009810: 737d 7b6d 6f64 657d 7b63 7661 6c7d 7b64  s}{mode}{cval}{d
+00009820: 696d 737d 7b75 7064 6174 657d 0d0a 2020  ims}{update}..  
+00009830: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00009840: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00009850: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+00009860: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
+00009870: 2020 2020 2020 2020 2020 2020 4669 6c74              Filt
+00009880: 6572 6564 2069 6d61 6765 0d0a 2020 2020  ered image..    
+00009890: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+000098a0: 0a20 2020 2020 2020 2064 6973 6b20 3d20  .        disk = 
+000098b0: 5f73 7472 7563 7475 7265 732e 6261 6c6c  _structures.ball
+000098c0: 5f6c 696b 6528 7261 6469 7573 2c20 6c65  _like(radius, le
+000098d0: 6e28 6469 6d73 2929 0d0a 2020 2020 2020  n(dims))..      
+000098e0: 2020 7265 7475 726e 2073 656c 662e 5f61    return self._a
+000098f0: 7070 6c79 5f64 6173 6b28 0d0a 2020 2020  pply_dask(..    
+00009900: 2020 2020 2020 2020 5f66 696c 7465 7273          _filters
+00009910: 2e6d 6561 6e5f 6669 6c74 6572 2c20 0d0a  .mean_filter, ..
+00009920: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
+00009930: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
+00009940: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
+00009950: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
+00009960: 2020 2064 7479 7065 3d73 656c 662e 6474     dtype=self.dt
+00009970: 7970 652c 0d0a 2020 2020 2020 2020 2020  ype,..          
+00009980: 2020 6172 6773 3d28 6469 736b 2c29 2c0d    args=(disk,),.
+00009990: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+000099a0: 7267 733d 6469 6374 286d 6f64 653d 6d6f  rgs=dict(mode=mo
+000099b0: 6465 2c20 6376 616c 3d63 7661 6c29 2c0d  de, cval=cval),.
+000099c0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+000099d0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
+000099e0: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
+000099f0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+00009a00: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
+00009a10: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
+00009a20: 0a20 2020 2064 6566 2073 7464 5f66 696c  .    def std_fil
+00009a30: 7465 7228 0d0a 2020 2020 2020 2020 7365  ter(..        se
+00009a40: 6c66 2c0d 0a20 2020 2020 2020 2072 6164  lf,..        rad
+00009a50: 6975 733a 2066 6c6f 6174 203d 2031 2c20  ius: float = 1, 
+00009a60: 0d0a 2020 2020 2020 2020 2a2c 200d 0a20  ..        *, .. 
+00009a70: 2020 2020 2020 206d 6f64 653a 2050 6164         mode: Pad
+00009a80: 6469 6e67 4d6f 6465 203d 2022 7265 666c  dingMode = "refl
+00009a90: 6563 7422 2c0d 0a20 2020 2020 2020 2063  ect",..        c
+00009aa0: 7661 6c3a 2066 6c6f 6174 203d 2030 2e30  val: float = 0.0
+00009ab0: 2c0d 0a20 2020 2020 2020 2064 696d 733a  ,..        dims:
+00009ac0: 2044 696d 7320 3d20 4e6f 6e65 2c0d 0a20   Dims = None,.. 
+00009ad0: 2020 2029 202d 3e20 496d 6741 7272 6179     ) -> ImgArray
+00009ae0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00009af0: 2020 2020 2020 2020 5374 616e 6461 7264          Standard
+00009b00: 2064 6576 6961 7469 6f6e 2066 696c 7465   deviation filte
+00009b10: 722e 0d0a 0d0a 2020 2020 2020 2020 5061  r.....        Pa
+00009b20: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+00009b30: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00009b40: 2020 2020 2020 7b72 6164 6975 737d 7b6d        {radius}{m
+00009b50: 6f64 657d 7b63 7661 6c7d 7b64 696d 737d  ode}{cval}{dims}
+00009b60: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+00009b70: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+00009b80: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+00009b90: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+00009ba0: 2020 2020 4669 6c74 6572 6564 2069 6d61      Filtered ima
+00009bb0: 6765 0d0a 2020 2020 2020 2020 2222 2220  ge..        """ 
+00009bc0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00009bd0: 2064 6973 6b20 3d20 5f73 7472 7563 7475   disk = _structu
+00009be0: 7265 732e 6261 6c6c 5f6c 696b 6528 7261  res.ball_like(ra
+00009bf0: 6469 7573 2c20 6c65 6e28 6469 6d73 2929  dius, len(dims))
+00009c00: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00009c10: 2073 656c 662e 6173 5f66 6c6f 6174 2829   self.as_float()
+00009c20: 2e5f 6170 706c 795f 6461 736b 280d 0a20  ._apply_dask(.. 
+00009c30: 2020 2020 2020 2020 2020 205f 6669 6c74             _filt
+00009c40: 6572 732e 7374 645f 6669 6c74 6572 2c20  ers.std_filter, 
+00009c50: 0d0a 2020 2020 2020 2020 2020 2020 635f  ..            c_
+00009c60: 6178 6573 3d63 6f6d 706c 656d 656e 745f  axes=complement_
+00009c70: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
+00009c80: 6178 6573 292c 200d 0a20 2020 2020 2020  axes), ..       
+00009c90: 2020 2020 2061 7267 733d 2864 6973 6b2c       args=(disk,
+00009ca0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00009cb0: 6b77 6172 6773 3d64 6963 7428 6d6f 6465  kwargs=dict(mode
+00009cc0: 3d6d 6f64 652c 2063 7661 6c3d 6376 616c  =mode, cval=cval
+00009cd0: 292c 0d0a 2020 2020 2020 2020 290d 0a20  ),..        ).. 
+00009ce0: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
+00009cf0: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
+00009d00: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
+00009d10: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
+00009d20: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
+00009d30: 7574 0d0a 2020 2020 6465 6620 636f 6566  ut..    def coef
+00009d40: 5f66 696c 7465 7228 0d0a 2020 2020 2020  _filter(..      
+00009d50: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
+00009d60: 2072 6164 6975 733a 2066 6c6f 6174 203d   radius: float =
+00009d70: 2031 2c0d 0a20 2020 2020 2020 202a 2c0d   1,..        *,.
+00009d80: 0a20 2020 2020 2020 206d 6f64 653a 2050  .        mode: P
+00009d90: 6164 6469 6e67 4d6f 6465 203d 2022 7265  addingMode = "re
+00009da0: 666c 6563 7422 2c0d 0a20 2020 2020 2020  flect",..       
+00009db0: 2063 7661 6c3a 2066 6c6f 6174 203d 2030   cval: float = 0
+00009dc0: 2e30 2c0d 0a20 2020 2020 2020 2064 696d  .0,..        dim
+00009dd0: 733a 2044 696d 7320 3d20 4e6f 6e65 0d0a  s: Dims = None..
+00009de0: 2020 2020 2920 2d3e 2049 6d67 4172 7261      ) -> ImgArra
+00009df0: 793a 0d0a 2020 2020 2020 2020 7222 2222  y:..        r"""
+00009e00: 0d0a 2020 2020 2020 2020 436f 6566 6669  ..        Coeffi
+00009e10: 6369 656e 7420 6f66 2076 6172 6961 6e63  cient of varianc
+00009e20: 6520 6669 6c74 6572 2e20 0d0a 2020 2020  e filter. ..    
+00009e30: 2020 2020 0d0a 2020 2020 2020 2020 466f      ..        Fo
+00009e40: 7220 6b65 726e 656c 2061 7265 6120 582c  r kernel area X,
+00009e50: 203a 6d61 7468 3a60 5c66 7261 637b 5c73   :math:`\frac{\s
+00009e60: 7172 747b 565b 585d 7d7d 7b45 5b58 5d7d  qrt{V[X]}}{E[X]}
+00009e70: 6020 6973 2063 616c 6375 6c61 7465 642e  ` is calculated.
+00009e80: 2054 6869 7320 6669 6c74 6572 0d0a 2020   This filter..  
+00009e90: 2020 2020 2020 6973 2075 7365 6675 6c20        is useful 
+00009ea0: 666f 7220 6665 6174 7572 6520 6578 7472  for feature extr
+00009eb0: 6163 7469 6f6e 2066 726f 6d20 696d 6167  action from imag
+00009ec0: 6573 2077 6974 6820 756e 6576 656e 2062  es with uneven b
+00009ed0: 6163 6b67 726f 756e 6420 696e 7465 6e73  ackground intens
+00009ee0: 6974 792e 0d0a 0d0a 2020 2020 2020 2020  ity.....        
+00009ef0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+00009f00: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+00009f10: 2020 2020 2020 2020 7b72 6164 6975 737d          {radius}
+00009f20: 7b6d 6f64 657d 7b63 7661 6c7d 7b64 696d  {mode}{cval}{dim
+00009f30: 737d 0d0a 2020 2020 2020 2020 0d0a 2020  s}..        ..  
+00009f40: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+00009f50: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
+00009f60: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
+00009f70: 0d0a 2020 2020 2020 2020 2020 2020 4669  ..            Fi
+00009f80: 6c74 6572 6564 2069 6d61 6765 0d0a 2020  ltered image..  
+00009f90: 2020 2020 2020 2222 2220 2020 2020 2020        """       
+00009fa0: 200d 0a20 2020 2020 2020 2064 6973 6b20   ..        disk 
+00009fb0: 3d20 5f73 7472 7563 7475 7265 732e 6261  = _structures.ba
+00009fc0: 6c6c 5f6c 696b 6528 7261 6469 7573 2c20  ll_like(radius, 
+00009fd0: 6c65 6e28 6469 6d73 2929 0d0a 2020 2020  len(dims))..    
+00009fe0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00009ff0: 6173 5f66 6c6f 6174 2829 2e5f 6170 706c  as_float()._appl
+0000a000: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
+0000a010: 2020 2020 205f 6669 6c74 6572 732e 636f       _filters.co
+0000a020: 6566 5f66 696c 7465 722c 200d 0a20 2020  ef_filter, ..   
+0000a030: 2020 2020 2020 2020 2063 5f61 7865 733d           c_axes=
+0000a040: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
+0000a050: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
+0000a060: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+0000a070: 6172 6773 3d28 6469 736b 2c29 2c0d 0a20  args=(disk,),.. 
+0000a080: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+0000a090: 733d 6469 6374 286d 6f64 653d 6d6f 6465  s=dict(mode=mode
+0000a0a0: 2c20 6376 616c 3d63 7661 6c29 2c0d 0a20  , cval=cval),.. 
+0000a0b0: 2020 2020 2020 2029 0d0a 2020 2020 0d0a         )..    ..
+0000a0c0: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
+0000a0d0: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
+0000a0e0: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
+0000a0f0: 0d0a 2020 2020 4063 6865 636b 5f69 6e70  ..    @check_inp
+0000a100: 7574 5f61 6e64 5f6f 7574 7075 740d 0a20  ut_and_output.. 
+0000a110: 2020 2064 6566 206d 6564 6961 6e5f 6669     def median_fi
+0000a120: 6c74 6572 280d 0a20 2020 2020 2020 2073  lter(..        s
+0000a130: 656c 662c 0d0a 2020 2020 2020 2020 7261  elf,..        ra
+0000a140: 6469 7573 3a20 666c 6f61 7420 3d20 312c  dius: float = 1,
+0000a150: 0d0a 2020 2020 2020 2020 2a2c 0d0a 2020  ..        *,..  
+0000a160: 2020 2020 2020 6d6f 6465 3a20 5061 6464        mode: Padd
+0000a170: 696e 674d 6f64 6520 3d20 2272 6566 6c65  ingMode = "refle
+0000a180: 6374 222c 0d0a 2020 2020 2020 2020 6376  ct",..        cv
+0000a190: 616c 3a20 666c 6f61 7420 3d20 302e 302c  al: float = 0.0,
+0000a1a0: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
+0000a1b0: 4469 6d73 203d 204e 6f6e 652c 0d0a 2020  Dims = None,..  
+0000a1c0: 2020 2020 2020 7570 6461 7465 3a20 626f        update: bo
+0000a1d0: 6f6c 203d 2046 616c 7365 2c0d 0a20 2020  ol = False,..   
+0000a1e0: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
+0000a1f0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0000a200: 2020 2020 2020 5275 6e6e 696e 6720 6d75        Running mu
+0000a210: 6c74 692d 6469 6d65 6e73 696f 6e61 6c20  lti-dimensional 
+0000a220: 6d65 6469 616e 2066 696c 7465 722e 200d  median filter. .
+0000a230: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000a240: 2020 2054 6869 7320 6669 6c74 6572 2069     This filter i
+0000a250: 7320 7573 6566 756c 2066 6f72 2064 656c  s useful for del
+0000a260: 6574 696e 6720 6f75 746c 6965 7273 2067  eting outliers g
+0000a270: 656e 6572 6174 6564 2062 7920 6e6f 6973  enerated by nois
+0000a280: 652e 0d0a 0d0a 2020 2020 2020 2020 5061  e.....        Pa
+0000a290: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+0000a2a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+0000a2b0: 2020 2020 2020 7b72 6164 6975 737d 7b6d        {radius}{m
+0000a2c0: 6f64 657d 7b63 7661 6c7d 7b64 696d 737d  ode}{cval}{dims}
+0000a2d0: 7b75 7064 6174 657d 0d0a 2020 2020 2020  {update}..      
+0000a2e0: 2020 0d0a 2020 2020 2020 2020 5265 7475    ..        Retu
+0000a2f0: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+0000a300: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+0000a310: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+0000a320: 2020 2020 4669 6c74 6572 6564 2069 6d61      Filtered ima
+0000a330: 6765 2e0d 0a20 2020 2020 2020 2022 2222  ge...        """
+0000a340: 2020 2020 200d 0a20 2020 2020 2020 2064       ..        d
+0000a350: 6973 6b20 3d20 5f73 7472 7563 7475 7265  isk = _structure
+0000a360: 732e 6261 6c6c 5f6c 696b 6528 7261 6469  s.ball_like(radi
+0000a370: 7573 2c20 6c65 6e28 6469 6d73 2929 0d0a  us, len(dims))..
+0000a380: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000a390: 656c 662e 5f61 7070 6c79 5f64 6173 6b28  elf._apply_dask(
+0000a3a0: 0d0a 2020 2020 2020 2020 2020 2020 5f66  ..            _f
+0000a3b0: 696c 7465 7273 2e6d 6564 6961 6e5f 6669  ilters.median_fi
+0000a3c0: 6c74 6572 2c20 0d0a 2020 2020 2020 2020  lter, ..        
+0000a3d0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
+0000a3e0: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
+0000a3f0: 2073 656c 662e 6178 6573 292c 200d 0a20   self.axes), .. 
+0000a400: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+0000a410: 3d73 656c 662e 6474 7970 652c 0d0a 2020  =self.dtype,..  
+0000a420: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+0000a430: 3d64 6963 7428 666f 6f74 7072 696e 743d  =dict(footprint=
+0000a440: 6469 736b 2c20 6d6f 6465 3d6d 6f64 652c  disk, mode=mode,
+0000a450: 2063 7661 6c3d 6376 616c 292c 0d0a 2020   cval=cval),..  
+0000a460: 2020 2020 2020 290d 0a20 2020 200d 0a20        )..    .. 
+0000a470: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
+0000a480: 6961 6c5f 6178 6573 0d0a 2020 2020 4073  ial_axes..    @s
+0000a490: 616d 655f 6474 7970 650d 0a20 2020 2040  ame_dtype..    @
+0000a4a0: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
+0000a4b0: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
+0000a4c0: 6469 616d 6574 6572 5f6f 7065 6e69 6e67  diameter_opening
+0000a4d0: 2873 656c 662c 2064 6961 6d65 7465 723a  (self, diameter:
+0000a4e0: 696e 743d 382c 202a 2c20 636f 6e6e 6563  int=8, *, connec
+0000a4f0: 7469 7669 7479 3a69 6e74 3d31 2c20 6469  tivity:int=1, di
+0000a500: 6d73 3a20 4469 6d73 203d 204e 6f6e 652c  ms: Dims = None,
+0000a510: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000a520: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+0000a530: 7465 3a20 626f 6f6c 203d 2046 616c 7365  te: bool = False
+0000a540: 2920 2d3e 2049 6d67 4172 7261 793a 0d0a  ) -> ImgArray:..
+0000a550: 2020 2020 2020 2020 6672 6f6d 2073 6b69          from ski
+0000a560: 6d61 6765 2e6d 6f72 7068 6f6c 6f67 7920  mage.morphology 
+0000a570: 696d 706f 7274 2064 6961 6d65 7465 725f  import diameter_
+0000a580: 6f70 656e 696e 670d 0a20 2020 2020 2020  opening..       
+0000a590: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
+0000a5a0: 706c 795f 6461 736b 280d 0a20 2020 2020  ply_dask(..     
+0000a5b0: 2020 2020 2020 2064 6961 6d65 7465 725f         diameter_
+0000a5c0: 6f70 656e 696e 672c 200d 0a20 2020 2020  opening, ..     
+0000a5d0: 2020 2020 2020 2063 5f61 7865 733d 636f         c_axes=co
+0000a5e0: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
+0000a5f0: 6d73 2c20 7365 6c66 2e61 7865 7329 2c20  ms, self.axes), 
+0000a600: 0d0a 2020 2020 2020 2020 2020 2020 6b77  ..            kw
+0000a610: 6172 6773 3d64 6963 7428 6469 616d 6574  args=dict(diamet
+0000a620: 6572 5f74 6872 6573 686f 6c64 3d64 6961  er_threshold=dia
+0000a630: 6d65 7465 722c 2063 6f6e 6e65 6374 6976  meter, connectiv
+0000a640: 6974 793d 636f 6e6e 6563 7469 7669 7479  ity=connectivity
+0000a650: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
+0000a660: 2020 2020 2020 0d0a 2020 2020 4064 696d        ..    @dim
+0000a670: 735f 746f 5f73 7061 7469 616c 5f61 7865  s_to_spatial_axe
+0000a680: 730d 0a20 2020 2040 7361 6d65 5f64 7479  s..    @same_dty
+0000a690: 7065 0d0a 2020 2020 4063 6865 636b 5f69  pe..    @check_i
+0000a6a0: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
+0000a6b0: 0a20 2020 2064 6566 2064 6961 6d65 7465  .    def diamete
+0000a6c0: 725f 636c 6f73 696e 6728 7365 6c66 2c20  r_closing(self, 
+0000a6d0: 6469 616d 6574 6572 3a69 6e74 3d38 2c20  diameter:int=8, 
+0000a6e0: 2a2c 2063 6f6e 6e65 6374 6976 6974 793a  *, connectivity:
+0000a6f0: 696e 743d 312c 2064 696d 733a 2044 696d  int=1, dims: Dim
+0000a700: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
+0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a720: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
+0000a730: 203d 2046 616c 7365 2920 2d3e 2049 6d67   = False) -> Img
+0000a740: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
+0000a750: 6672 6f6d 2073 6b69 6d61 6765 2e6d 6f72  from skimage.mor
+0000a760: 7068 6f6c 6f67 7920 696d 706f 7274 2064  phology import d
+0000a770: 6961 6d65 7465 725f 636c 6f73 696e 670d  iameter_closing.
+0000a780: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a790: 7365 6c66 2e5f 6170 706c 795f 6461 736b  self._apply_dask
+0000a7a0: 280d 0a20 2020 2020 2020 2020 2020 2064  (..            d
+0000a7b0: 6961 6d65 7465 725f 636c 6f73 696e 672c  iameter_closing,
+0000a7c0: 200d 0a20 2020 2020 2020 2020 2020 2063   ..            c
+0000a7d0: 5f61 7865 733d 636f 6d70 6c65 6d65 6e74  _axes=complement
+0000a7e0: 5f61 7865 7328 6469 6d73 2c20 7365 6c66  _axes(dims, self
+0000a7f0: 2e61 7865 7329 2c20 0d0a 2020 2020 2020  .axes), ..      
+0000a800: 2020 2020 2020 6b77 6172 6773 3d64 6963        kwargs=dic
+0000a810: 7428 6469 616d 6574 6572 5f74 6872 6573  t(diameter_thres
+0000a820: 686f 6c64 3d64 6961 6d65 7465 722c 2063  hold=diameter, c
+0000a830: 6f6e 6e65 6374 6976 6974 793d 636f 6e6e  onnectivity=conn
+0000a840: 6563 7469 7669 7479 290d 0a20 2020 2020  ectivity)..     
+0000a850: 2020 2029 0d0a 2020 2020 0d0a 2020 2020     )..    ..    
+0000a860: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
+0000a870: 5f61 7865 730d 0a20 2020 2040 7361 6d65  _axes..    @same
+0000a880: 5f64 7479 7065 0d0a 2020 2020 4063 6865  _dtype..    @che
+0000a890: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
+0000a8a0: 7075 740d 0a20 2020 2064 6566 2061 7265  put..    def are
+0000a8b0: 615f 6f70 656e 696e 6728 7365 6c66 2c20  a_opening(self, 
+0000a8c0: 6172 6561 3a69 6e74 3d36 342c 202a 2c20  area:int=64, *, 
+0000a8d0: 636f 6e6e 6563 7469 7669 7479 3a69 6e74  connectivity:int
+0000a8e0: 3d31 2c20 6469 6d73 3a20 4469 6d73 203d  =1, dims: Dims =
+0000a8f0: 204e 6f6e 652c 200d 0a20 2020 2020 2020   None, ..       
+0000a900: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0000a910: 6461 7465 3a20 626f 6f6c 203d 2046 616c  date: bool = Fal
+0000a920: 7365 2920 2d3e 2049 6d67 4172 7261 793a  se) -> ImgArray:
+0000a930: 0d0a 2020 2020 2020 2020 6672 6f6d 2073  ..        from s
+0000a940: 6b69 6d61 6765 2e6d 6f72 7068 6f6c 6f67  kimage.morpholog
+0000a950: 7920 696d 706f 7274 2072 656d 6f76 655f  y import remove_
+0000a960: 736d 616c 6c5f 686f 6c65 732c 2061 7265  small_holes, are
+0000a970: 615f 6f70 656e 696e 670d 0a20 2020 2020  a_opening..     
+0000a980: 2020 2069 6620 7365 6c66 2e64 7479 7065     if self.dtype
+0000a990: 203d 3d20 626f 6f6c 3a0d 0a20 2020 2020   == bool:..     
+0000a9a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000a9b0: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
+0000a9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a9d0: 2072 656d 6f76 655f 736d 616c 6c5f 686f   remove_small_ho
+0000a9e0: 6c65 732c 0d0a 2020 2020 2020 2020 2020  les,..          
+0000a9f0: 2020 2020 2020 635f 6178 6573 3d63 6f6d        c_axes=com
+0000aa00: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
+0000aa10: 732c 2073 656c 662e 6178 6573 292c 200d  s, self.axes), .
+0000aa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aa30: 206b 7761 7267 733d 6469 6374 2861 7265   kwargs=dict(are
+0000aa40: 615f 7468 7265 7368 6f6c 643d 6172 6561  a_threshold=area
+0000aa50: 2c20 636f 6e6e 6563 7469 7669 7479 3d63  , connectivity=c
+0000aa60: 6f6e 6e65 6374 6976 6974 7929 0d0a 2020  onnectivity)..  
+0000aa70: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+0000aa80: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000aa90: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000aaa0: 656c 662e 5f61 7070 6c79 5f64 6173 6b28  elf._apply_dask(
+0000aab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000aac0: 2020 6172 6561 5f6f 7065 6e69 6e67 2c20    area_opening, 
+0000aad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000aae0: 2020 635f 6178 6573 3d63 6f6d 706c 656d    c_axes=complem
+0000aaf0: 656e 745f 6178 6573 2864 696d 732c 2073  ent_axes(dims, s
+0000ab00: 656c 662e 6178 6573 292c 200d 0a20 2020  elf.axes), ..   
+0000ab10: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
+0000ab20: 7267 733d 6469 6374 2861 7265 615f 7468  rgs=dict(area_th
+0000ab30: 7265 7368 6f6c 643d 6172 6561 2c20 636f  reshold=area, co
+0000ab40: 6e6e 6563 7469 7669 7479 3d63 6f6e 6e65  nnectivity=conne
+0000ab50: 6374 6976 6974 7929 0d0a 2020 2020 2020  ctivity)..      
+0000ab60: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000ab70: 200d 0a20 2020 2040 6469 6d73 5f74 6f5f   ..    @dims_to_
+0000ab80: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+0000ab90: 2020 4073 616d 655f 6474 7970 650d 0a20    @same_dtype.. 
+0000aba0: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
+0000abb0: 616e 645f 6f75 7470 7574 0d0a 2020 2020  and_output..    
+0000abc0: 6465 6620 6172 6561 5f63 6c6f 7369 6e67  def area_closing
+0000abd0: 2873 656c 662c 2061 7265 613a 696e 743d  (self, area:int=
+0000abe0: 3634 2c20 2a2c 2063 6f6e 6e65 6374 6976  64, *, connectiv
+0000abf0: 6974 793a 696e 743d 312c 2064 696d 733a  ity:int=1, dims:
+0000ac00: 2044 696d 7320 3d20 4e6f 6e65 2c20 0d0a   Dims = None, ..
+0000ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac20: 2020 2020 2075 7064 6174 653a 2062 6f6f       update: boo
+0000ac30: 6c20 3d20 4661 6c73 6529 202d 3e20 496d  l = False) -> Im
+0000ac40: 6741 7272 6179 3a0d 0a20 2020 2020 2020  gArray:..       
+0000ac50: 2066 726f 6d20 736b 696d 6167 652e 6d6f   from skimage.mo
+0000ac60: 7270 686f 6c6f 6779 2069 6d70 6f72 7420  rphology import 
+0000ac70: 7265 6d6f 7665 5f73 6d61 6c6c 5f68 6f6c  remove_small_hol
+0000ac80: 6573 2c20 6172 6561 5f63 6c6f 7369 6e67  es, area_closing
+0000ac90: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000aca0: 662e 6474 7970 6520 3d3d 2062 6f6f 6c3a  f.dtype == bool:
+0000acb0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000acc0: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
+0000acd0: 5f64 6173 6b28 0d0a 2020 2020 2020 2020  _dask(..        
+0000ace0: 2020 2020 2020 2020 7265 6d6f 7665 5f73          remove_s
+0000acf0: 6d61 6c6c 5f68 6f6c 6573 2c0d 0a20 2020  mall_holes,..   
+0000ad00: 2020 2020 2020 2020 2020 2020 2063 5f61               c_a
+0000ad10: 7865 733d 636f 6d70 6c65 6d65 6e74 5f61  xes=complement_a
+0000ad20: 7865 7328 6469 6d73 2c20 7365 6c66 2e61  xes(dims, self.a
+0000ad30: 7865 7329 2c20 0d0a 2020 2020 2020 2020  xes), ..        
+0000ad40: 2020 2020 2020 2020 6b77 6172 6773 3d64          kwargs=d
+0000ad50: 6963 7428 6172 6561 5f74 6872 6573 686f  ict(area_thresho
+0000ad60: 6c64 3d61 7265 612c 2063 6f6e 6e65 6374  ld=area, connect
+0000ad70: 6976 6974 793d 636f 6e6e 6563 7469 7669  ivity=connectivi
+0000ad80: 7479 290d 0a20 2020 2020 2020 2020 2020  ty)..           
+0000ad90: 2029 0d0a 2020 2020 2020 2020 656c 7365   )..        else
+0000ada0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000adb0: 6574 7572 6e20 7365 6c66 2e5f 6170 706c  eturn self._appl
+0000adc0: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
+0000add0: 2020 2020 2020 2020 2061 7265 615f 636c           area_cl
+0000ade0: 6f73 696e 672c 200d 0a20 2020 2020 2020  osing, ..       
+0000adf0: 2020 2020 2020 2020 2063 5f61 7865 733d           c_axes=
+0000ae00: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
+0000ae10: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
+0000ae20: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+0000ae30: 2020 2020 6b77 6172 6773 3d64 6963 7428      kwargs=dict(
+0000ae40: 6172 6561 5f74 6872 6573 686f 6c64 3d61  area_threshold=a
+0000ae50: 7265 612c 2063 6f6e 6e65 6374 6976 6974  rea, connectivit
+0000ae60: 793d 636f 6e6e 6563 7469 7669 7479 290d  y=connectivity).
+0000ae70: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+0000ae80: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
+0000ae90: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
+0000aea0: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
+0000aeb0: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
+0000aec0: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
+0000aed0: 7075 740d 0a20 2020 2064 6566 2065 6e74  put..    def ent
+0000aee0: 726f 7079 5f66 696c 7465 7228 7365 6c66  ropy_filter(self
+0000aef0: 2c20 7261 6469 7573 3a20 6e44 466c 6f61  , radius: nDFloa
+0000af00: 7420 3d20 352c 202a 2c20 6469 6d73 3a20  t = 5, *, dims: 
+0000af10: 4469 6d73 203d 204e 6f6e 6529 202d 3e20  Dims = None) -> 
+0000af20: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
+0000af30: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0000af40: 5275 6e6e 696e 6720 656e 7472 6f70 7920  Running entropy 
+0000af50: 6669 6c74 6572 2e20 5468 6973 2066 696c  filter. This fil
+0000af60: 7465 7220 6973 2075 7365 6675 6c20 666f  ter is useful fo
+0000af70: 7220 6465 7465 6374 696e 6720 6368 616e  r detecting chan
+0000af80: 6765 2069 6e20 6261 636b 6772 6f75 6e64  ge in background
+0000af90: 2064 6973 7472 6962 7574 696f 6e2e 0d0a   distribution...
+0000afa0: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+0000afb0: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
+0000afc0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
+0000afd0: 2020 7b72 6164 6975 737d 7b64 696d 737d    {radius}{dims}
+0000afe0: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0000aff0: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+0000b000: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+0000b010: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+0000b020: 2020 2020 4669 6c74 6572 6564 2069 6d61      Filtered ima
+0000b030: 6765 2e0d 0a20 2020 2020 2020 2022 2222  ge...        """
+0000b040: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000b050: 2020 6469 736b 203d 205f 7374 7275 6374    disk = _struct
+0000b060: 7572 6573 2e62 616c 6c5f 6c69 6b65 2872  ures.ball_like(r
+0000b070: 6164 6975 732c 206c 656e 2864 696d 7329  adius, len(dims)
+0000b080: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+0000b090: 2020 2020 2073 656c 6620 3d20 7365 6c66       self = self
+0000b0a0: 2e61 735f 7569 6e74 3828 290d 0a20 2020  .as_uint8()..   
+0000b0b0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000b0c0: 2e5f 6170 706c 795f 6461 736b 2873 6b66  ._apply_dask(skf
+0000b0d0: 696c 2e72 616e 6b2e 656e 7472 6f70 792c  il.rank.entropy,
+0000b0e0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b100: 2020 635f 6178 6573 3d63 6f6d 706c 656d    c_axes=complem
+0000b110: 656e 745f 6178 6573 2864 696d 732c 2073  ent_axes(dims, s
+0000b120: 656c 662e 6178 6573 292c 0d0a 2020 2020  elf.axes),..    
+0000b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b140: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+0000b150: 733d 6469 6374 2866 6f6f 7470 7269 6e74  s=dict(footprint
+0000b160: 3d64 6973 6b29 0d0a 2020 2020 2020 2020  =disk)..        
+0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b180: 2020 2020 2020 2029 2e61 735f 666c 6f61         ).as_floa
+0000b190: 7428 290d 0a20 2020 200d 0a20 2020 2040  t()..    ..    @
+0000b1a0: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
+0000b1b0: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
+0000b1c0: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
+0000b1d0: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
+0000b1e0: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
+0000b1f0: 6620 656e 6861 6e63 655f 636f 6e74 7261  f enhance_contra
+0000b200: 7374 2873 656c 662c 2072 6164 6975 733a  st(self, radius:
+0000b210: 6e44 466c 6f61 743d 312c 202a 2c20 6469  nDFloat=1, *, di
+0000b220: 6d73 3a20 4469 6d73 203d 204e 6f6e 652c  ms: Dims = None,
+0000b230: 2075 7064 6174 653a 2062 6f6f 6c20 3d20   update: bool = 
+0000b240: 4661 6c73 6529 202d 3e20 496d 6741 7272  False) -> ImgArr
+0000b250: 6179 3a0d 0a20 2020 2020 2020 2022 2222  ay:..        """
+0000b260: 0d0a 2020 2020 2020 2020 456e 6861 6e63  ..        Enhanc
+0000b270: 6520 636f 6e74 7261 7374 2066 696c 7465  e contrast filte
+0000b280: 722e 0d0a 0d0a 2020 2020 2020 2020 5061  r.....        Pa
+0000b290: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+0000b2a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+0000b2b0: 2020 2020 2020 7b72 6164 6975 737d 7b64        {radius}{d
+0000b2c0: 696d 737d 7b75 7064 6174 657d 0d0a 0d0a  ims}{update}....
+0000b2d0: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
+0000b2e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0000b2f0: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
+0000b300: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+0000b310: 436f 6e74 7261 7374 2065 6e68 616e 6365  Contrast enhance
+0000b320: 6420 696d 6167 652e 0d0a 2020 2020 2020  d image...      
+0000b330: 2020 2222 2220 2020 2020 2020 200d 0a20    """        .. 
+0000b340: 2020 2020 2020 2064 6973 6b20 3d20 5f73         disk = _s
+0000b350: 7472 7563 7475 7265 732e 6261 6c6c 5f6c  tructures.ball_l
+0000b360: 696b 6528 7261 6469 7573 2c20 6c65 6e28  ike(radius, len(
+0000b370: 6469 6d73 2929 0d0a 2020 2020 2020 2020  dims))..        
+0000b380: 6966 2073 656c 662e 6474 7970 6520 3d3d  if self.dtype ==
+0000b390: 206e 702e 666c 6f61 7433 323a 0d0a 2020   np.float32:..  
+0000b3a0: 2020 2020 2020 2020 2020 616d 7020 3d20            amp = 
+0000b3b0: 6d61 7828 6e70 2e61 6273 2873 656c 662e  max(np.abs(self.
+0000b3c0: 7261 6e67 6529 290d 0a20 2020 2020 2020  range))..       
+0000b3d0: 2020 2020 2073 656c 662e 7661 6c75 655b       self.value[
+0000b3e0: 3a5d 202f 3d20 616d 700d 0a20 2020 2020  :] /= amp..     
+0000b3f0: 2020 2077 6974 6820 7761 726e 696e 6773     with warnings
+0000b400: 2e63 6174 6368 5f77 6172 6e69 6e67 7328  .catch_warnings(
+0000b410: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000b420: 7761 726e 696e 6773 2e73 696d 706c 6566  warnings.simplef
+0000b430: 696c 7465 7228 2269 676e 6f72 6522 290d  ilter("ignore").
+0000b440: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0000b450: 203d 2073 656c 662e 5f61 7070 6c79 5f64   = self._apply_d
+0000b460: 6173 6b28 736b 6669 6c2e 7261 6e6b 2e65  ask(skfil.rank.e
+0000b470: 6e68 616e 6365 5f63 6f6e 7472 6173 742c  nhance_contrast,
+0000b480: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4a0: 2020 2020 2063 5f61 7865 733d 636f 6d70       c_axes=comp
+0000b4b0: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
+0000b4c0: 2c20 7365 6c66 2e61 7865 7329 2c20 0d0a  , self.axes), ..
+0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4f0: 2020 6474 7970 653d 7365 6c66 2e64 7479    dtype=self.dty
+0000b500: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
+0000b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b520: 2020 2020 2020 2061 7267 733d 2864 6973         args=(dis
+0000b530: 6b2c 290d 0a20 2020 2020 2020 2020 2020  k,)..           
+0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b550: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000b560: 2020 6966 2073 656c 662e 6474 7970 6520    if self.dtype 
+0000b570: 3d3d 206e 702e 666c 6f61 7433 323a 0d0a  == np.float32:..
+0000b580: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b590: 2e76 616c 7565 5b3a 5d20 2a3d 2061 6d70  .value[:] *= amp
+0000b5a0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000b5b0: 2020 2020 7265 7475 726e 206f 7574 0d0a      return out..
+0000b5c0: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
+0000b5d0: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
+0000b5e0: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
+0000b5f0: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
+0000b600: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
+0000b610: 7075 740d 0a20 2020 2064 6566 206c 6170  put..    def lap
+0000b620: 6c61 6369 616e 5f66 696c 7465 7228 7365  lacian_filter(se
+0000b630: 6c66 2c20 7261 6469 7573 3a20 696e 7420  lf, radius: int 
+0000b640: 3d20 312c 202a 2c20 6469 6d73 3a20 4469  = 1, *, dims: Di
+0000b650: 6d73 203d 204e 6f6e 652c 2075 7064 6174  ms = None, updat
+0000b660: 653a 2062 6f6f 6c20 3d20 4661 6c73 6529  e: bool = False)
+0000b670: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+0000b680: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0000b690: 2020 2020 4564 6765 2064 6574 6563 7469      Edge detecti
+0000b6a0: 6f6e 2075 7369 6e67 204c 6170 6c61 6369  on using Laplaci
+0000b6b0: 616e 2066 696c 7465 722e 204b 6572 6e65  an filter. Kerne
+0000b6c0: 6c20 6973 206d 6164 6520 6279 2060 736b  l is made by `sk
+0000b6d0: 696d 6167 6560 2773 2066 756e 6374 696f  image`'s functio
+0000b6e0: 6e2e 0d0a 0d0a 2020 2020 2020 2020 5061  n.....        Pa
+0000b6f0: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+0000b700: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+0000b710: 2020 2020 2020 7261 6469 7573 203a 2069        radius : i
+0000b720: 6e74 2c20 6465 6661 756c 7420 6973 2031  nt, default is 1
+0000b730: 0d0a 2020 2020 2020 2020 2020 2020 5261  ..            Ra
+0000b740: 6469 7573 206f 6620 6b65 726e 656c 2e20  dius of kernel. 
+0000b750: 5368 6170 6520 6f66 206b 6572 6e65 6c20  Shape of kernel 
+0000b760: 7769 6c6c 2062 6520 2832 2a72 6164 6975  will be (2*radiu
+0000b770: 732b 312c 2032 2a72 6164 6975 732b 3129  s+1, 2*radius+1)
+0000b780: 2e0d 0a20 2020 2020 2020 207b 6469 6d73  ...        {dims
+0000b790: 7d7b 7570 6461 7465 7d0d 0a0d 0a20 2020  }{update}....   
+0000b7a0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+0000b7b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
+0000b7c0: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
+0000b7d0: 0a20 2020 2020 2020 2020 2020 2046 696c  .            Fil
+0000b7e0: 7465 7265 6420 696d 6167 652e 0d0a 2020  tered image...  
+0000b7f0: 2020 2020 2020 2222 2220 2020 2020 2020        """       
+0000b800: 200d 0a20 2020 2020 2020 206e 6469 6d20   ..        ndim 
+0000b810: 3d20 6c65 6e28 6469 6d73 290d 0a20 2020  = len(dims)..   
+0000b820: 2020 2020 205f 2c20 6c61 706c 6163 655f       _, laplace_
+0000b830: 6f70 203d 2073 6b72 6573 2e75 6674 2e6c  op = skres.uft.l
+0000b840: 6170 6c61 6369 616e 286e 6469 6d2c 2028  aplacian(ndim, (
+0000b850: 322a 7261 6469 7573 2b31 2c29 202a 206e  2*radius+1,) * n
+0000b860: 6469 6d29 0d0a 2020 2020 2020 2020 7265  dim)..        re
+0000b870: 7475 726e 2073 656c 662e 6173 5f66 6c6f  turn self.as_flo
+0000b880: 6174 2829 2e5f 6170 706c 795f 6461 736b  at()._apply_dask
+0000b890: 280d 0a20 2020 2020 2020 2020 2020 205f  (..            _
+0000b8a0: 6669 6c74 6572 732e 636f 6e76 6f6c 7665  filters.convolve
+0000b8b0: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
+0000b8c0: 635f 6178 6573 3d63 6f6d 706c 656d 656e  c_axes=complemen
+0000b8d0: 745f 6178 6573 2864 696d 732c 2073 656c  t_axes(dims, sel
+0000b8e0: 662e 6178 6573 292c 200d 0a20 2020 2020  f.axes), ..     
+0000b8f0: 2020 2020 2020 2064 7479 7065 3d73 656c         dtype=sel
+0000b900: 662e 6474 7970 652c 0d0a 2020 2020 2020  f.dtype,..      
+0000b910: 2020 2020 2020 6172 6773 3d28 6c61 706c        args=(lapl
+0000b920: 6163 655f 6f70 2c29 2c0d 0a20 2020 2020  ace_op,),..     
+0000b930: 2020 2020 2020 206b 7761 7267 733d 6469         kwargs=di
+0000b940: 6374 286d 6f64 653d 2272 6566 6c65 6374  ct(mode="reflect
+0000b950: 2229 0d0a 2020 2020 2020 2020 290d 0a20  ")..        ).. 
+0000b960: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
+0000b970: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
+0000b980: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
+0000b990: 5f61 7865 730d 0a20 2020 2040 7361 6d65  _axes..    @same
+0000b9a0: 5f64 7479 7065 2861 7366 6c6f 6174 3d54  _dtype(asfloat=T
+0000b9b0: 7275 6529 0d0a 2020 2020 4063 6865 636b  rue)..    @check
+0000b9c0: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
+0000b9d0: 740d 0a20 2020 2064 6566 206b 616c 6d61  t..    def kalma
+0000b9e0: 6e5f 6669 6c74 6572 2873 656c 662c 2067  n_filter(self, g
+0000b9f0: 6169 6e3a 2066 6c6f 6174 203d 2030 2e38  ain: float = 0.8
+0000ba00: 2c20 6e6f 6973 655f 7661 723a 2066 6c6f  , noise_var: flo
+0000ba10: 6174 203d 2030 2e30 352c 202a 2c20 616c  at = 0.05, *, al
+0000ba20: 6f6e 673a 2073 7472 203d 2022 7422 2c20  ong: str = "t", 
+0000ba30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ba40: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
+0000ba50: 6d73 203d 204e 6f6e 652c 2075 7064 6174  ms = None, updat
+0000ba60: 653a 2062 6f6f 6c20 3d20 4661 6c73 6529  e: bool = False)
+0000ba70: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+0000ba80: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0000ba90: 2020 2020 4b61 6c6d 616e 2066 696c 7465      Kalman filte
+0000baa0: 7220 666f 7220 696d 6167 6520 736d 6f6f  r for image smoo
+0000bab0: 7468 696e 672e 2054 6869 7320 6675 6e63  thing. This func
+0000bac0: 7469 6f6e 2069 7320 7361 6d65 2061 7320  tion is same as 
+0000bad0: 224b 616c 6d61 6e20 5374 6163 6b20 4669  "Kalman Stack Fi
+0000bae0: 6c74 6572 2220 696e 2049 6d61 6765 4a20  lter" in ImageJ 
+0000baf0: 6275 7420 7375 7070 6f72 740d 0a20 2020  but support..   
+0000bb00: 2020 2020 2062 6174 6368 2070 726f 6365       batch proce
+0000bb10: 7373 696e 672e 2054 6869 7320 6669 6c74  ssing. This filt
+0000bb20: 6572 2069 7320 7573 6566 756c 2066 6f72  er is useful for
+0000bb30: 2070 7265 7072 6f63 6573 7369 6e67 206f   preprocessing o
+0000bb40: 6620 7061 7274 6963 6c65 2074 7261 636b  f particle track
+0000bb50: 696e 672e 0d0a 0d0a 2020 2020 2020 2020  ing.....        
+0000bb60: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+0000bb70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+0000bb80: 2020 2020 2020 2020 6761 696e 203a 2066          gain : f
+0000bb90: 6c6f 6174 2c20 6465 6661 756c 7420 6973  loat, default is
+0000bba0: 2030 2e38 0d0a 2020 2020 2020 2020 2020   0.8..          
+0000bbb0: 2020 4669 6c74 6572 2067 6169 6e2e 0d0a    Filter gain...
+0000bbc0: 2020 2020 2020 2020 6e6f 6973 655f 7661          noise_va
+0000bbd0: 7220 3a20 666c 6f61 742c 2064 6566 6175  r : float, defau
+0000bbe0: 6c74 2069 7320 302e 3035 0d0a 2020 2020  lt is 0.05..    
+0000bbf0: 2020 2020 2020 2020 496e 6974 6961 6c20          Initial 
+0000bc00: 6573 7469 6d61 7465 206f 6620 6e6f 6973  estimate of nois
+0000bc10: 6520 7661 7269 616e 6365 2e0d 0a20 2020  e variance...   
+0000bc20: 2020 2020 2061 6c6f 6e67 203a 2073 7472       along : str
+0000bc30: 2c20 6465 6661 756c 7420 6973 2022 7422  , default is "t"
+0000bc40: 0d0a 2020 2020 2020 2020 2020 2020 5768  ..            Wh
+0000bc50: 6963 6820 6178 6973 2077 696c 6c20 6265  ich axis will be
+0000bc60: 2074 6865 2074 696d 6520 6178 6973 2e0d   the time axis..
+0000bc70: 0a20 2020 2020 2020 207b 6469 6d73 7d7b  .        {dims}{
+0000bc80: 7570 6461 7465 7d0d 0a0d 0a20 2020 2020  update}....     
+0000bc90: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
+0000bca0: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
+0000bcb0: 2020 2020 2049 6d67 4172 7261 790d 0a20       ImgArray.. 
+0000bcc0: 2020 2020 2020 2020 2020 2046 696c 7465             Filte
+0000bcd0: 7265 6420 696d 6167 650d 0a20 2020 2020  red image..     
+0000bce0: 2020 2022 2222 2020 2020 2020 2020 0d0a     """        ..
+0000bcf0: 2020 2020 2020 2020 745f 6178 6973 203d          t_axis =
+0000bd00: 2073 656c 662e 6178 6973 6f66 2861 6c6f   self.axisof(alo
+0000bd10: 6e67 290d 0a20 2020 2020 2020 206d 696e  ng)..        min
+0000bd20: 5f61 203d 206d 696e 2873 656c 662e 6178  _a = min(self.ax
+0000bd30: 6973 6f66 2861 2920 666f 7220 6120 696e  isof(a) for a in
+0000bd40: 2064 696d 7329 0d0a 2020 2020 2020 2020   dims)..        
+0000bd50: 6966 2074 5f61 7869 7320 3e20 6d69 6e5f  if t_axis > min_
+0000bd60: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
+0000bd70: 7365 6c66 203d 206e 702e 7377 6170 6178  self = np.swapax
+0000bd80: 6573 2873 656c 662c 2074 5f61 7869 732c  es(self, t_axis,
+0000bd90: 206d 696e 5f61 290d 0a20 2020 2020 2020   min_a)..       
+0000bda0: 206f 7574 203d 2073 656c 662e 5f61 7070   out = self._app
+0000bdb0: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
+0000bdc0: 2020 2020 2020 5f66 696c 7465 7273 2e6b        _filters.k
+0000bdd0: 616c 6d61 6e5f 6669 6c74 6572 2c20 0d0a  alman_filter, ..
+0000bde0: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
+0000bdf0: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
+0000be00: 6573 285b 616c 6f6e 675d 202b 2064 696d  es([along] + dim
+0000be10: 732c 2073 656c 662e 6178 6573 292c 200d  s, self.axes), .
+0000be20: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
+0000be30: 733d 2867 6169 6e2c 206e 6f69 7365 5f76  s=(gain, noise_v
+0000be40: 6172 290d 0a20 2020 2020 2020 2029 0d0a  ar)..        )..
+0000be50: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000be60: 2020 6966 2074 5f61 7869 7320 3e20 6d69    if t_axis > mi
+0000be70: 6e5f 613a 0d0a 2020 2020 2020 2020 2020  n_a:..          
+0000be80: 2020 6f75 7420 3d20 6e70 2e73 7761 7061    out = np.swapa
+0000be90: 7865 7328 6f75 742c 206d 696e 5f61 2c20  xes(out, min_a, 
+0000bea0: 745f 6178 6973 290d 0a0d 0a20 2020 2020  t_axis)....     
+0000beb0: 2020 2072 6574 7572 6e20 6f75 740d 0a20     return out.. 
+0000bec0: 2020 200d 0a20 2020 2040 6469 6d73 5f74     ..    @dims_t
+0000bed0: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
+0000bee0: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
+0000bef0: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
+0000bf00: 2064 6566 2066 6f63 7573 5f6d 6170 2873   def focus_map(s
+0000bf10: 656c 662c 2072 6164 6975 733a 2069 6e74  elf, radius: int
+0000bf20: 203d 2031 2c20 2a2c 2064 696d 733a 2044   = 1, *, dims: D
+0000bf30: 696d 7320 3d20 3229 202d 3e20 5072 6f70  ims = 2) -> Prop
+0000bf40: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
+0000bf50: 2222 220d 0a20 2020 2020 2020 2043 6f6d  """..        Com
+0000bf60: 7075 7465 2066 6f63 7573 206d 6170 2075  pute focus map u
+0000bf70: 7369 6e67 2076 6172 6961 6e63 6520 6f66  sing variance of
+0000bf80: 204c 6170 6c61 6369 616e 206d 6574 686f   Laplacian metho
+0000bf90: 642e 2079 782d 706c 616e 6520 7769 7468  d. yx-plane with
+0000bfa0: 2068 6967 6865 7220 7661 7269 616e 6365   higher variance
+0000bfb0: 2069 7320 6c69 6b65 6c79 2061 0d0a 2020   is likely a..  
+0000bfc0: 2020 2020 2020 666f 6361 6c20 706c 616e        focal plan
+0000bfd0: 6520 6265 6361 7573 6520 7368 6172 7065  e because sharpe
+0000bfe0: 7220 696d 6167 6520 6361 7573 6573 2068  r image causes h
+0000bff0: 6967 6865 7220 7661 6c75 6520 6f66 204c  igher value of L
+0000c000: 6170 6c61 6369 616e 206f 6e20 7468 6520  aplacian on the 
+0000c010: 6564 6765 732e 0d0a 0d0a 2020 2020 2020  edges.....      
+0000c020: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+0000c030: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0000c040: 0d0a 2020 2020 2020 2020 7261 6469 7573  ..        radius
+0000c050: 203a 2069 6e74 2c20 6465 6661 756c 7420   : int, default 
+0000c060: 6973 2031 0d0a 2020 2020 2020 2020 2020  is 1..          
+0000c070: 2020 5261 6469 7573 206f 6620 4c61 706c    Radius of Lapl
+0000c080: 6163 6961 6e20 6669 6c74 6572 2773 206b  acian filter's k
+0000c090: 6572 6e65 6c2e 0d0a 2020 2020 2020 2020  ernel...        
+0000c0a0: 7b64 696d 737d 0d0a 0d0a 2020 2020 2020  {dims}....      
+0000c0b0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+0000c0c0: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+0000c0d0: 2020 2020 5072 6f70 4172 7261 790d 0a20      PropArray.. 
+0000c0e0: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+0000c0f0: 206f 6620 7661 7269 616e 6365 206f 6620   of variance of 
+0000c100: 4c61 706c 6163 6961 6e0d 0a20 2020 2020  Laplacian..     
+0000c110: 2020 200d 0a20 2020 2020 2020 2045 7861     ..        Exa
+0000c120: 6d70 6c65 730d 0a20 2020 2020 2020 202d  mples..        -
+0000c130: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+0000c140: 2047 6574 2074 6865 2066 6f63 7573 2070   Get the focus p
+0000c150: 6c61 6e65 2066 726f 6d20 6120 3344 2069  lane from a 3D i
+0000c160: 6d61 6765 2e0d 0a20 2020 2020 2020 2020  mage...         
+0000c170: 2020 203e 3e3e 2073 636f 7265 203d 2069     >>> score = i
+0000c180: 6d67 2e66 6f63 7573 5f6d 6170 2829 0d0a  mg.focus_map()..
+0000c190: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+0000c1a0: 7363 6f72 652e 706c 6f74 2829 2020 2020  score.plot()    
+0000c1b0: 2020 2020 2020 2020 2020 2023 2070 6c6f             # plo
+0000c1c0: 7420 7468 6520 7661 7269 6174 696f 6e20  t the variation 
+0000c1d0: 6f66 206c 6170 6c61 6369 616e 2066 6f63  of laplacian foc
+0000c1e0: 7573 0d0a 2020 2020 2020 2020 2020 2020  us..            
+0000c1f0: 3e3e 3e20 7a5f 666f 6375 7320 3d20 6e70  >>> z_focus = np
+0000c200: 2e61 7267 6d61 7828 7363 6f72 6529 2023  .argmax(score) #
+0000c210: 2064 6574 6572 6d69 6e65 2074 6865 2066   determine the f
+0000c220: 6f63 7573 2070 6c61 6e65 0d0a 2020 2020  ocus plane..    
+0000c230: 2020 2020 2020 2020 3e3e 3e20 696d 675b          >>> img[
+0000c240: 7a5f 666f 6375 735d 2020 2020 2020 2020  z_focus]        
+0000c250: 2020 2020 2020 2023 2067 6574 2074 6865         # get the
+0000c260: 2066 6f63 7573 2070 6c61 6e65 0d0a 2020   focus plane..  
+0000c270: 2020 2020 2020 2222 2220 2020 2020 2020        """       
+0000c280: 200d 0a20 2020 2020 2020 2063 5f61 7865   ..        c_axe
+0000c290: 7320 3d20 636f 6d70 6c65 6d65 6e74 5f61  s = complement_a
+0000c2a0: 7865 7328 6469 6d73 2c20 7365 6c66 2e61  xes(dims, self.a
+0000c2b0: 7865 7329 0d0a 2020 2020 2020 2020 6c61  xes)..        la
+0000c2c0: 706c 6163 655f 696d 6720 3d20 7365 6c66  place_img = self
+0000c2d0: 2e61 735f 666c 6f61 7428 292e 6c61 706c  .as_float().lapl
+0000c2e0: 6163 6961 6e5f 6669 6c74 6572 2872 6164  acian_filter(rad
+0000c2f0: 6975 732c 2064 696d 733d 6469 6d73 290d  ius, dims=dims).
+0000c300: 0a20 2020 2020 2020 206f 7574 203d 206e  .        out = n
+0000c310: 702e 7661 7228 6c61 706c 6163 655f 696d  p.var(laplace_im
+0000c320: 672c 2061 7869 733d 6469 6d73 290d 0a20  g, axis=dims).. 
+0000c330: 2020 2020 2020 206f 7574 203d 2050 726f         out = Pro
+0000c340: 7041 7272 6179 286f 7574 2e76 616c 7565  pArray(out.value
+0000c350: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
+0000c360: 3332 2c20 6e61 6d65 3d73 656c 662e 6e61  32, name=self.na
+0000c370: 6d65 2c20 0d0a 2020 2020 2020 2020 2020  me, ..          
+0000c380: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0000c390: 6573 3d63 5f61 7865 732c 2070 726f 706e  es=c_axes, propn
+0000c3a0: 616d 653d 2276 6172 6961 6e63 655f 6f66  ame="variance_of
+0000c3b0: 5f6c 6170 6c61 6369 616e 2229 0d0a 2020  _laplacian")..  
+0000c3c0: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+0000c3d0: 0d0a 2020 2020 0d0a 2020 2020 405f 646f  ..    ..    @_do
+0000c3e0: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
+0000c3f0: 2020 2040 7361 6d65 5f64 7479 7065 2861     @same_dtype(a
+0000c400: 7366 6c6f 6174 3d54 7275 6529 0d0a 2020  sfloat=True)..  
+0000c410: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
+0000c420: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
+0000c430: 6566 2075 6e6d 6978 2873 656c 662c 206d  ef unmix(self, m
+0000c440: 6174 7269 782c 2062 6720 3d20 4e6f 6e65  atrix, bg = None
+0000c450: 2c20 2a2c 2061 6c6f 6e67 3a20 7374 7220  , *, along: str 
+0000c460: 3d20 2263 222c 2075 7064 6174 653a 2062  = "c", update: b
+0000c470: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
+0000c480: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
+0000c490: 2020 2072 2222 220d 0a20 2020 2020 2020     r"""..       
+0000c4a0: 2055 6e6d 6978 2066 6c75 6f72 6573 6365   Unmix fluoresce
+0000c4b0: 6e63 6520 6c65 616b 6167 6520 6265 7477  nce leakage betw
+0000c4c0: 6565 6e20 6368 616e 6e65 6c73 2069 6e20  een channels in 
+0000c4d0: 6120 6c69 6e65 6172 2077 6179 2e20 466f  a linear way. Fo
+0000c4e0: 7220 6578 616d 706c 652c 2061 2062 6c75  r example, a blu
+0000c4f0: 652f 6772 6565 6e20 696d 6167 652c 0d0a  e/green image,..
+0000c500: 2020 2020 2020 2020 666c 756f 7265 7363          fluoresc
+0000c510: 656e 7420 6c65 616b 6167 6520 6361 6e20  ent leakage can 
+0000c520: 6265 2077 7269 7474 656e 2061 7320 666f  be written as fo
+0000c530: 6c6c 6f77 696e 6720 6571 7561 7469 6f6e  llowing equation
+0000c540: 3a0d 0a20 2020 2020 2020 200d 0a20 2020  :..        ..   
+0000c550: 2020 2020 2020 2020 203a 6d61 7468 3a60           :math:`
+0000c560: 5c6c 6566 745c 7b5c 6265 6769 6e7b 6172  \left\{\begin{ar
+0000c570: 7261 797d 7b6c 6c7d 2042 5f7b 6f62 737d  ray}{ll} B_{obs}
+0000c580: 203d 2042 5f7b 7265 616c 7d20 2b20 6120   = B_{real} + a 
+0000c590: 5c63 646f 7420 475f 7b72 6561 6c7d 2026  \cdot G_{real} &
+0000c5a0: 205c 5c47 5f7b 6f62 737d 203d 2062 205c   \\G_{obs} = b \
+0000c5b0: 6364 6f74 2042 5f7b 7265 616c 7d20 2b20  cdot B_{real} + 
+0000c5c0: 475f 7b72 6561 6c7d 2026 205c 656e 647b  G_{real} & \end{
+0000c5d0: 6172 7261 797d 205c 7269 6768 742e 600d  array} \right.`.
+0000c5e0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+0000c5f0: 2020 2020 2020 2077 6865 7265 2022 6f62         where "ob
+0000c600: 7322 206d 6561 6e73 206f 6273 6572 7665  s" means observe
+0000c610: 6420 696e 7465 6e73 6974 6965 732c 2022  d intensities, "
+0000c620: 7265 616c 2220 6d65 616e 7320 7468 6520  real" means the 
+0000c630: 7265 616c 2069 6e74 656e 7369 7479 2e20  real intensity. 
+0000c640: 496e 2074 6869 7320 6c69 6e65 6172 2063  In this linear c
+0000c650: 6173 652c 200d 0a20 2020 2020 2020 206c  ase, ..        l
+0000c660: 6561 6b61 6765 206d 6174 7269 783a 0d0a  eakage matrix:..
+0000c670: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000c680: 2020 2020 2020 3a6d 6174 683a 604d 203d        :math:`M =
+0000c690: 205c 6265 6769 6e7b 626d 6174 7269 787d   \begin{bmatrix}
+0000c6a0: 2031 2026 2061 205c 5c62 2026 2031 205c   1 & a \\b & 1 \
+0000c6b0: 656e 647b 626d 6174 7269 787d 205c 5c60  end{bmatrix} \\`
+0000c6c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6e0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000c6f0: 2020 2020 3a6d 6174 683a 6056 5f7b 6f62      :math:`V_{ob
+0000c700: 737d 203d 204d 205c 6364 6f74 2056 5f7b  s} = M \cdot V_{
+0000c710: 7265 616c 7d60 0d0a 2020 2020 2020 2020  real}`..        
+0000c720: 2020 2020 0d0a 2020 2020 2020 2020 6d75      ..        mu
+0000c730: 7374 2062 6520 7072 6564 6566 696e 6564  st be predefined
+0000c740: 2e20 4966 204d 2069 7320 6769 7665 6e2c  . If M is given,
+0000c750: 2074 6865 6e20 7265 616c 2069 6e74 656e   then real inten
+0000c760: 7369 7469 6573 2063 616e 2062 6520 7265  sities can be re
+0000c770: 7374 6f72 6564 2062 793a 0d0a 2020 2020  stored by:..    
+0000c780: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000c790: 2020 2020 2020 3a6d 6174 683a 6056 5f7b        :math:`V_{
+0000c7a0: 7265 616c 7d20 3d20 4d5e 7b2d 317d 205c  real} = M^{-1} \
+0000c7b0: 6364 6f74 2056 5f7b 6f62 737d 600d 0a20  cdot V_{obs}`.. 
+0000c7c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000c7d0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+0000c7e0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+0000c7f0: 0a20 2020 2020 2020 206d 6174 7269 7820  .        matrix 
+0000c800: 3a20 6172 7261 792d 6c69 6b65 0d0a 2020  : array-like..  
+0000c810: 2020 2020 2020 2020 2020 4c65 616b 6167            Leakag
+0000c820: 6520 6d61 7472 6978 2e20 5468 6520 2869  e matrix. The (i
+0000c830: 2c20 6a29 2063 6f6d 706f 6e65 6e74 206f  , j) component o
+0000c840: 6620 7468 6520 6d61 7472 6978 2069 7320  f the matrix is 
+0000c850: 7468 6520 6c65 616b 6167 6520 6672 6f6d  the leakage from
+0000c860: 2069 2d74 6820 6368 616e 6e65 6c20 746f   i-th channel to
+0000c870: 0d0a 2020 2020 2020 2020 2020 2020 6a2d  ..            j-
+0000c880: 7468 2063 6861 6e6e 656c 2e0d 0a20 2020  th channel...   
+0000c890: 2020 2020 2062 6720 3a20 6172 7261 792d       bg : array-
+0000c8a0: 6c69 6b65 2c20 6f70 7469 6f6e 616c 0d0a  like, optional..
+0000c8b0: 2020 2020 2020 2020 2020 2020 5665 6374              Vect
+0000c8c0: 6f72 206f 6620 6261 636b 6772 6f75 6e64  or of background
+0000c8d0: 2069 6e74 656e 7369 7469 6573 2066 6f72   intensities for
+0000c8e0: 2065 6163 6820 6368 616e 6e65 6c2e 2049   each channel. I
+0000c8f0: 6620 6e6f 7420 6769 7665 6e2c 2069 7420  f not given, it 
+0000c900: 6973 2061 7373 756d 6564 2074 6f20 6265  is assumed to be
+0000c910: 2074 6865 0d0a 2020 2020 2020 2020 2020   the..          
+0000c920: 2020 6d69 6e69 6d75 6d20 7661 6c75 6520    minimum value 
+0000c930: 6f66 2065 6163 6820 6368 616e 6e65 6c2e  of each channel.
+0000c940: 0d0a 2020 2020 2020 2020 616c 6f6e 6720  ..        along 
+0000c950: 3a20 7374 722c 2064 6566 6175 6c74 2069  : str, default i
+0000c960: 7320 2263 220d 0a20 2020 2020 2020 2020  s "c"..         
+0000c970: 2020 2054 6865 2061 7869 7320 6f66 2063     The axis of c
+0000c980: 6861 6e6e 656c 2e0d 0a20 2020 2020 2020  hannel...       
+0000c990: 207b 7570 6461 7465 7d0d 0a20 2020 2020   {update}..     
+0000c9a0: 2020 200d 0a20 2020 2020 2020 2052 6574     ..        Ret
+0000c9b0: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
+0000c9c0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
+0000c9d0: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
+0000c9e0: 2020 2020 2055 6e6d 6978 6564 2069 6d61       Unmixed ima
+0000c9f0: 6765 2e0d 0a20 2020 2020 2020 200d 0a20  ge...        .. 
+0000ca00: 2020 2020 2020 2045 7861 6d70 6c65 730d         Examples.
+0000ca10: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0000ca20: 2d0d 0a20 2020 2020 2020 2043 6f6d 706c  -..        Compl
+0000ca30: 656d 656e 7420 7468 6520 6368 616e 6e65  ement the channe
+0000ca40: 6c2d 3020 746f 2063 6861 6e6e 656c 2d31  l-0 to channel-1
+0000ca50: 206c 6561 6b61 6765 2e0d 0a20 2020 2020   leakage...     
+0000ca60: 2020 2020 2020 203e 3e3e 206d 7478 203d         >>> mtx =
+0000ca70: 205b 5b31 2e30 2c20 302e 345d 2c0d 0a20   [[1.0, 0.4],.. 
+0000ca80: 2020 2020 2020 2020 2020 203e 3e3e 2020             >>>  
+0000ca90: 2020 2020 2020 5b30 2e30 2c20 312e 305d        [0.0, 1.0]
+0000caa0: 5d0d 0a20 2020 2020 2020 2020 2020 203e  ]..            >
+0000cab0: 3e3e 2062 6720 3d20 5b31 3530 302c 2031  >> bg = [1500, 1
+0000cac0: 3230 305d 0d0a 2020 2020 2020 2020 2020  200]..          
+0000cad0: 2020 3e3e 3e20 756e 6d69 7865 645f 696d    >>> unmixed_im
+0000cae0: 6720 3d20 696d 672e 756e 6d69 7828 6d74  g = img.unmix(mt
+0000caf0: 782c 2062 6729 0d0a 2020 2020 2020 2020  x, bg)..        
+0000cb00: 2222 2220 2020 2020 2020 200d 0a20 2020  """        ..   
+0000cb10: 2020 2020 206e 5f63 686e 203d 2073 656c       n_chn = sel
+0000cb20: 662e 7369 7a65 6f66 2861 6c6f 6e67 290d  f.sizeof(along).
+0000cb30: 0a20 2020 2020 2020 2063 5f61 7820 3d20  .        c_ax = 
+0000cb40: 7365 6c66 2e61 7869 736f 6628 616c 6f6e  self.axisof(alon
+0000cb50: 6729 0d0a 2020 2020 2020 2020 0d0a 2020  g)..        ..  
+0000cb60: 2020 2020 2020 2320 6368 6563 6b20 6d61        # check ma
+0000cb70: 7472 6978 2061 6e64 2062 670d 0a20 2020  trix and bg..   
+0000cb80: 2020 2020 206d 6174 7269 7820 3d20 6e70       matrix = np
+0000cb90: 2e61 7361 7272 6179 286d 6174 7269 782c  .asarray(matrix,
+0000cba0: 2064 7479 7065 3d6e 702e 666c 6f61 7433   dtype=np.float3
+0000cbb0: 3229 0d0a 2020 2020 2020 2020 6966 206d  2)..        if m
+0000cbc0: 6174 7269 782e 7368 6170 6520 213d 2028  atrix.shape != (
+0000cbd0: 6e5f 6368 6e2c 206e 5f63 686e 293a 0d0a  n_chn, n_chn):..
+0000cbe0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000cbf0: 6520 5661 6c75 6545 7272 6f72 2866 2260  e ValueError(f"`
+0000cc00: 6d61 705f 6d61 7472 6978 6020 6d75 7374  map_matrix` must
+0000cc10: 2068 6176 6520 7368 6170 6520 7b28 6e5f   have shape {(n_
+0000cc20: 6368 6e2c 206e 5f63 686e 297d 2229 0d0a  chn, n_chn)}")..
+0000cc30: 2020 2020 2020 2020 6966 2062 6720 6973          if bg is
+0000cc40: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0000cc50: 2020 2020 6267 203d 206e 702e 7a65 726f      bg = np.zero
+0000cc60: 7328 6e5f 6368 6e29 0d0a 2020 2020 2020  s(n_chn)..      
+0000cc70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000cc80: 2020 2020 2062 6720 3d20 6e70 2e61 7361       bg = np.asa
+0000cc90: 7272 6179 2862 672c 2064 7479 7065 3d6e  rray(bg, dtype=n
+0000cca0: 702e 666c 6f61 7433 3229 2e72 6176 656c  p.float32).ravel
+0000ccb0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000ccc0: 6966 2062 672e 7369 7a65 2021 3d20 6e5f  if bg.size != n_
+0000ccd0: 6368 6e3a 0d0a 2020 2020 2020 2020 2020  chn:..          
+0000cce0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000ccf0: 6545 7272 6f72 2866 2260 6267 6020 6d75  eError(f"`bg` mu
+0000cd00: 7374 2068 6176 6520 6c65 6e67 7468 207b  st have length {
+0000cd10: 6e5f 6368 6e7d 2229 0d0a 2020 2020 2020  n_chn}")..      
+0000cd20: 2020 0d0a 2020 2020 2020 2020 2320 6d6f    ..        # mo
+0000cd30: 7665 2063 6861 6e6e 656c 2061 7869 7320  ve channel axis 
+0000cd40: 746f 2074 6865 206c 6173 740d 0a20 2020  to the last..   
+0000cd50: 2020 2020 2069 6e70 7574 5f20 3d20 6e70       input_ = np
+0000cd60: 2e6d 6f76 6561 7869 7328 6e70 2e61 7361  .moveaxis(np.asa
+0000cd70: 7272 6179 2873 656c 662c 2064 7479 7065  rray(self, dtype
+0000cd80: 3d6e 702e 666c 6f61 7433 3229 2c20 635f  =np.float32), c_
+0000cd90: 6178 2c20 2d31 290d 0a20 2020 2020 2020  ax, -1)..       
+0000cda0: 2023 206d 756c 7469 706c 7920 696e 7665   # multiply inve
+0000cdb0: 7273 6520 6d61 7472 6978 0d0a 2020 2020  rse matrix..    
+0000cdc0: 2020 2020 6f75 7420 3d20 2869 6e70 7574      out = (input
+0000cdd0: 5f20 2d20 6267 2920 4020 6e70 2e6c 696e  _ - bg) @ np.lin
+0000cde0: 616c 672e 696e 7628 6d61 7472 6978 2920  alg.inv(matrix) 
+0000cdf0: 2b20 6267 0d0a 2020 2020 2020 2020 2320  + bg..        # 
+0000ce00: 7265 7374 6f72 6520 7468 6520 6178 6573  restore the axes
+0000ce10: 206f 7264 6572 0d0a 2020 2020 2020 2020   order..        
+0000ce20: 6f75 7420 3d20 6e70 2e6d 6f76 6561 7869  out = np.moveaxi
+0000ce30: 7328 6f75 742c 202d 312c 2063 5f61 7829  s(out, -1, c_ax)
+0000ce40: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000ce50: 2020 2020 7265 7475 726e 206f 7574 2e76      return out.v
+0000ce60: 6965 7728 7365 6c66 2e5f 5f63 6c61 7373  iew(self.__class
+0000ce70: 5f5f 290d 0a20 2020 2020 2020 200d 0a20  __)..        .. 
+0000ce80: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
+0000ce90: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
+0000cea0: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
+0000ceb0: 5f61 7865 730d 0a20 2020 2040 7361 6d65  _axes..    @same
+0000cec0: 5f64 7479 7065 2861 7366 6c6f 6174 3d54  _dtype(asfloat=T
+0000ced0: 7275 6529 0d0a 2020 2020 4063 6865 636b  rue)..    @check
+0000cee0: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
+0000cef0: 740d 0a20 2020 2064 6566 2066 696c 6c5f  t..    def fill_
+0000cf00: 686f 6c65 2873 656c 662c 2074 6872 3a20  hole(self, thr: 
+0000cf10: 666c 6f61 747c 7374 7220 3d20 226f 7473  float|str = "ots
+0000cf20: 7522 2c20 2a2c 2064 696d 733a 2044 696d  u", *, dims: Dim
+0000cf30: 7320 3d20 4e6f 6e65 2c20 7570 6461 7465  s = None, update
+0000cf40: 3a20 626f 6f6c 203d 2046 616c 7365 2920  : bool = False) 
+0000cf50: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
+0000cf60: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0000cf70: 2020 2046 696c 6c69 6e67 2068 6f6c 6573     Filling holes
+0000cf80: 2e20 5365 6520 736b 696d 6167 6527 7320  . See skimage's 
+0000cf90: 646f 6375 6d65 6e74 7320 0d0a 2020 2020  documents ..    
+0000cfa0: 2020 2020 6068 6572 6520 3c68 7474 7073      `here <https
+0000cfb0: 3a2f 2f73 6369 6b69 742d 696d 6167 652e  ://scikit-image.
+0000cfc0: 6f72 672f 646f 6373 2f73 7461 626c 652f  org/docs/stable/
+0000cfd0: 6175 746f 5f65 7861 6d70 6c65 732f 6665  auto_examples/fe
+0000cfe0: 6174 7572 6573 5f64 6574 6563 7469 6f6e  atures_detection
+0000cff0: 2f70 6c6f 745f 686f 6c65 735f 616e 645f  /plot_holes_and_
+0000d000: 7065 616b 732e 6874 6d6c 3e60 5f2e 0d0a  peaks.html>`_...
+0000d010: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+0000d020: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
+0000d030: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
+0000d040: 2020 7468 7220 3a20 7363 616c 6172 206f    thr : scalar o
+0000d050: 7220 7374 722c 206f 7074 696f 6e61 6c0d  r str, optional.
+0000d060: 0a20 2020 2020 2020 2020 2020 2054 6872  .            Thr
+0000d070: 6573 686f 6c64 2028 7661 6c75 6520 6f72  eshold (value or
+0000d080: 206d 6574 686f 6429 2074 6f20 6170 706c   method) to appl
+0000d090: 7920 6966 2069 6d61 6765 2069 7320 6e6f  y if image is no
+0000d0a0: 7420 6269 6e61 7279 2e0d 0a20 2020 2020  t binary...     
+0000d0b0: 2020 207b 6469 6d73 7d7b 7570 6461 7465     {dims}{update
+0000d0c0: 7d0d 0a20 2020 2020 2020 200d 0a20 2020  }..        ..   
+0000d0d0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+0000d0e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
+0000d0f0: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
+0000d100: 0a20 2020 2020 2020 2020 2020 2048 6f6c  .            Hol
+0000d110: 652d 6669 6c6c 6564 2069 6d61 6765 2e0d  e-filled image..
+0000d120: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
+0000d130: 2020 2020 0d0a 2020 2020 2020 2020 6966      ..        if
+0000d140: 2073 656c 662e 6474 7970 6520 213d 2062   self.dtype != b
+0000d150: 6f6f 6c3a 0d0a 2020 2020 2020 2020 2020  ool:..          
+0000d160: 2020 6d61 736b 203d 2073 656c 662e 7468    mask = self.th
+0000d170: 7265 7368 6f6c 6428 7468 723d 7468 7229  reshold(thr=thr)
+0000d180: 2e76 616c 7565 0d0a 2020 2020 2020 2020  .value..        
+0000d190: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000d1a0: 2020 206d 6173 6b20 3d20 7365 6c66 2e76     mask = self.v
+0000d1b0: 616c 7565 0d0a 2020 2020 2020 2020 2020  alue..          
+0000d1c0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000d1d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000d1e0: 5f61 7070 6c79 5f64 6173 6b28 0d0a 2020  _apply_dask(..  
+0000d1f0: 2020 2020 2020 2020 2020 5f66 696c 7465            _filte
+0000d200: 7273 2e66 696c 6c5f 686f 6c65 2c20 0d0a  rs.fill_hole, ..
+0000d210: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
+0000d220: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
+0000d230: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
+0000d240: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
+0000d250: 2020 2061 7267 733d 286d 6173 6b2c 292c     args=(mask,),
+0000d260: 0d0a 2020 2020 2020 2020 2020 2020 6474  ..            dt
+0000d270: 7970 653d 7365 6c66 2e64 7479 7065 0d0a  ype=self.dtype..
+0000d280: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+0000d290: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
+0000d2a0: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
+0000d2b0: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
+0000d2c0: 2020 2040 7361 6d65 5f64 7479 7065 2861     @same_dtype(a
+0000d2d0: 7366 6c6f 6174 3d54 7275 6529 0d0a 2020  sfloat=True)..  
+0000d2e0: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
+0000d2f0: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
+0000d300: 6566 2067 6175 7373 6961 6e5f 6669 6c74  ef gaussian_filt
+0000d310: 6572 280d 0a20 2020 2020 2020 2073 656c  er(..        sel
+0000d320: 662c 0d0a 2020 2020 2020 2020 7369 676d  f,..        sigm
+0000d330: 613a 206e 4446 6c6f 6174 203d 2031 2c0d  a: nDFloat = 1,.
+0000d340: 0a20 2020 2020 2020 202a 2c0d 0a20 2020  .        *,..   
+0000d350: 2020 2020 2066 6f75 7269 6572 3a20 626f       fourier: bo
+0000d360: 6f6c 203d 2046 616c 7365 2c0d 0a20 2020  ol = False,..   
+0000d370: 2020 2020 2064 696d 733a 2044 696d 7320       dims: Dims 
+0000d380: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
+0000d390: 2075 7064 6174 653a 2062 6f6f 6c20 3d20   update: bool = 
+0000d3a0: 4661 6c73 652c 0d0a 2020 2020 2920 2d3e  False,..    ) ->
+0000d3b0: 2049 6d67 4172 7261 793a 0d0a 2020 2020   ImgArray:..    
+0000d3c0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0000d3d0: 2052 756e 2047 6175 7373 6961 6e20 6669   Run Gaussian fi
+0000d3e0: 6c74 6572 2028 4761 7573 7369 616e 2062  lter (Gaussian b
+0000d3f0: 6c75 7229 2e0d 0a20 2020 2020 2020 200d  lur)...        .
+0000d400: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0000d410: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
+0000d420: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+0000d430: 207b 7369 676d 617d 7b66 6f75 7269 6572   {sigma}{fourier
+0000d440: 7d7b 6469 6d73 7d7b 7570 6461 7465 7d0d  }{dims}{update}.
+0000d450: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+0000d460: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
+0000d470: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
+0000d480: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
+0000d490: 790d 0a20 2020 2020 2020 2020 2020 2046  y..            F
+0000d4a0: 696c 7465 7265 6420 696d 6167 652e 0d0a  iltered image...
+0000d4b0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0000d4c0: 2020 2020 2066 696c 7465 725f 6675 6e63       filter_func
+0000d4d0: 203d 205f 6669 6c74 6572 732e 6761 7573   = _filters.gaus
+0000d4e0: 7369 616e 5f66 696c 7465 725f 666f 7572  sian_filter_four
+0000d4f0: 6965 7220 6966 2066 6f75 7269 6572 2065  ier if fourier e
+0000d500: 6c73 6520 5f66 696c 7465 7273 2e67 6175  lse _filters.gau
+0000d510: 7373 6961 6e5f 6669 6c74 6572 0d0a 2020  ssian_filter..  
+0000d520: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000d530: 662e 5f61 7070 6c79 5f64 6173 6b28 0d0a  f._apply_dask(..
+0000d540: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+0000d550: 6572 5f66 756e 632c 200d 0a20 2020 2020  er_func, ..     
+0000d560: 2020 2020 2020 2063 5f61 7865 733d 636f         c_axes=co
+0000d570: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
+0000d580: 6d73 2c20 7365 6c66 2e61 7865 7329 2c20  ms, self.axes), 
+0000d590: 0d0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
+0000d5a0: 6773 3d28 7369 676d 612c 292c 200d 0a20  gs=(sigma,), .. 
+0000d5b0: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+0000d5c0: 3d6e 702e 666c 6f61 7433 320d 0a20 2020  =np.float32..   
+0000d5d0: 2020 2020 2029 0d0a 0d0a 0d0a 2020 2020       )......    
+0000d5e0: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+0000d5f0: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+0000d600: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+0000d610: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
+0000d620: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
+0000d630: 6566 2064 6f67 5f66 696c 7465 7228 0d0a  ef dog_filter(..
+0000d640: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
+0000d650: 2020 2020 2020 206c 6f77 5f73 6967 6d61         low_sigma
+0000d660: 3a20 6e44 466c 6f61 7420 3d20 312c 0d0a  : nDFloat = 1,..
+0000d670: 2020 2020 2020 2020 6869 6768 5f73 6967          high_sig
+0000d680: 6d61 3a20 6e44 466c 6f61 7420 3d20 4e6f  ma: nDFloat = No
+0000d690: 6e65 2c0d 0a20 2020 2020 2020 202a 2c0d  ne,..        *,.
+0000d6a0: 0a20 2020 2020 2020 2066 6f75 7269 6572  .        fourier
+0000d6b0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0d  : bool = False,.
+0000d6c0: 0a20 2020 2020 2020 2064 696d 733a 2044  .        dims: D
+0000d6d0: 696d 7320 3d20 4e6f 6e65 2c0d 0a20 2020  ims = None,..   
+0000d6e0: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
+0000d6f0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0000d700: 2020 2020 2020 5275 6e20 4469 6666 6572        Run Differ
+0000d710: 656e 6365 206f 6620 4761 7573 7369 616e  ence of Gaussian
+0000d720: 2066 696c 7465 722e 2054 6869 7320 6675   filter. This fu
+0000d730: 6e63 7469 6f6e 2064 6f65 7320 6e6f 7420  nction does not 
+0000d740: 7375 7070 6f72 7420 6075 7064 6174 6560  support `update`
+0000d750: 0d0a 2020 2020 2020 2020 6172 6775 6d65  ..        argume
+0000d760: 6e74 2062 6563 6175 7365 2069 6e74 656e  nt because inten
+0000d770: 7369 7479 2063 616e 2062 6520 6e65 6761  sity can be nega
+0000d780: 7469 7665 2e0d 0a20 2020 2020 2020 200d  tive...        .
+0000d790: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0000d7a0: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
+0000d7b0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+0000d7c0: 206c 6f77 5f73 6967 6d61 203a 2073 6361   low_sigma : sca
+0000d7d0: 6c61 7220 6f72 2061 7272 6179 206f 6620  lar or array of 
+0000d7e0: 7363 616c 6172 732c 2064 6566 6175 6c74  scalars, default
+0000d7f0: 2069 7320 312e 0d0a 2020 2020 2020 2020   is 1...        
+0000d800: 2020 2020 6c6f 7765 7220 7374 616e 6461      lower standa
+0000d810: 7264 2064 6576 6961 7469 6f6e 2873 2920  rd deviation(s) 
+0000d820: 6f66 2047 6175 7373 6961 6e2e 0d0a 2020  of Gaussian...  
+0000d830: 2020 2020 2020 6869 6768 5f73 6967 6d61        high_sigma
+0000d840: 203a 2073 6361 6c61 7220 6f72 2061 7272   : scalar or arr
+0000d850: 6179 206f 6620 7363 616c 6172 732c 2064  ay of scalars, d
+0000d860: 6566 6175 6c74 2069 7320 7831 2e36 206f  efault is x1.6 o
+0000d870: 6620 6c6f 775f 7369 676d 612e 0d0a 2020  f low_sigma...  
+0000d880: 2020 2020 2020 2020 2020 6869 6768 6572            higher
+0000d890: 2073 7461 6e64 6172 6420 6465 7669 6174   standard deviat
+0000d8a0: 696f 6e28 7329 206f 6620 4761 7573 7369  ion(s) of Gaussi
+0000d8b0: 616e 2e0d 0a20 2020 2020 2020 207b 666f  an...        {fo
+0000d8c0: 7572 6965 727d 7b64 696d 737d 0d0a 2020  urier}{dims}..  
+0000d8d0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000d8e0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+0000d8f0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+0000d900: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
+0000d910: 2020 2020 2020 2020 2020 2020 4669 6c74              Filt
+0000d920: 6572 6564 2069 6d61 6765 2e0d 0a20 2020  ered image...   
+0000d930: 2020 2020 2022 2222 2020 2020 2020 2020       """        
+0000d940: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000d950: 2020 2020 6c6f 775f 7369 676d 6120 3d20      low_sigma = 
+0000d960: 6e70 2e61 7272 6179 2863 6865 636b 5f6e  np.array(check_n
+0000d970: 6428 6c6f 775f 7369 676d 612c 206c 656e  d(low_sigma, len
+0000d980: 2864 696d 7329 2929 0d0a 2020 2020 2020  (dims)))..      
+0000d990: 2020 6869 6768 5f73 6967 6d61 203d 206c    high_sigma = l
+0000d9a0: 6f77 5f73 6967 6d61 202a 2031 2e36 2069  ow_sigma * 1.6 i
+0000d9b0: 6620 6869 6768 5f73 6967 6d61 2069 7320  f high_sigma is 
+0000d9c0: 4e6f 6e65 2065 6c73 6520 6869 6768 5f73  None else high_s
+0000d9d0: 6967 6d61 0d0a 2020 2020 2020 2020 6669  igma..        fi
+0000d9e0: 6c74 6572 5f66 756e 6320 3d20 5f66 696c  lter_func = _fil
+0000d9f0: 7465 7273 2e64 6f67 5f66 696c 7465 725f  ters.dog_filter_
+0000da00: 666f 7572 6965 7220 6966 2066 6f75 7269  fourier if fouri
+0000da10: 6572 2065 6c73 6520 5f66 696c 7465 7273  er else _filters
+0000da20: 2e64 6f67 5f66 696c 7465 720d 0a20 2020  .dog_filter..   
+0000da30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000da40: 2e61 735f 666c 6f61 7428 292e 5f61 7070  .as_float()._app
+0000da50: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
+0000da60: 2020 2020 2020 6669 6c74 6572 5f66 756e        filter_fun
+0000da70: 632c 200d 0a20 2020 2020 2020 2020 2020  c, ..           
+0000da80: 2063 5f61 7865 733d 636f 6d70 6c65 6d65   c_axes=compleme
+0000da90: 6e74 5f61 7865 7328 6469 6d73 2c20 7365  nt_axes(dims, se
+0000daa0: 6c66 2e61 7865 7329 2c0d 0a20 2020 2020  lf.axes),..     
+0000dab0: 2020 2020 2020 2061 7267 733d 286c 6f77         args=(low
+0000dac0: 5f73 6967 6d61 2c20 6869 6768 5f73 6967  _sigma, high_sig
+0000dad0: 6d61 290d 0a20 2020 2020 2020 2029 0d0a  ma)..        )..
+0000dae0: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
+0000daf0: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
+0000db00: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
+0000db10: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
+0000db20: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
+0000db30: 7075 740d 0a20 2020 2064 6566 2064 6f68  put..    def doh
+0000db40: 5f66 696c 7465 7228 7365 6c66 2c20 7369  _filter(self, si
 0000db50: 676d 613a 206e 4446 6c6f 6174 203d 2031  gma: nDFloat = 1
-0000db60: 2c20 6869 6768 5f73 6967 6d61 3a20 6e44  , high_sigma: nD
-0000db70: 466c 6f61 7420 3d20 4e6f 6e65 2c20 2a2c  Float = None, *,
-0000db80: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
-0000db90: 6e65 2920 2d3e 2049 6d67 4172 7261 793a  ne) -> ImgArray:
-0000dba0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0000dbb0: 2020 2020 2020 2052 756e 2044 6966 6665         Run Diffe
-0000dbc0: 7265 6e63 6520 6f66 2047 6175 7373 6961  rence of Gaussia
-0000dbd0: 6e20 6669 6c74 6572 2e20 5468 6973 2066  n filter. This f
-0000dbe0: 756e 6374 696f 6e20 646f 6573 206e 6f74  unction does not
-0000dbf0: 2073 7570 706f 7274 2060 7570 6461 7465   support `update
-0000dc00: 600d 0a20 2020 2020 2020 2061 7267 756d  `..        argum
-0000dc10: 656e 7420 6265 6361 7573 6520 696e 7465  ent because inte
-0000dc20: 6e73 6974 7920 6361 6e20 6265 206e 6567  nsity can be neg
-0000dc30: 6174 6976 652e 0d0a 2020 2020 2020 2020  ative...        
-0000dc40: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0000dc50: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-0000dc60: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-0000dc70: 2020 6c6f 775f 7369 676d 6120 3a20 7363    low_sigma : sc
-0000dc80: 616c 6172 206f 7220 6172 7261 7920 6f66  alar or array of
-0000dc90: 2073 6361 6c61 7273 2c20 6465 6661 756c   scalars, defaul
-0000dca0: 7420 6973 2031 2e0d 0a20 2020 2020 2020  t is 1...       
-0000dcb0: 2020 2020 206c 6f77 6572 2073 7461 6e64       lower stand
-0000dcc0: 6172 6420 6465 7669 6174 696f 6e28 7329  ard deviation(s)
-0000dcd0: 206f 6620 4761 7573 7369 616e 2e0d 0a20   of Gaussian... 
-0000dce0: 2020 2020 2020 2068 6967 685f 7369 676d         high_sigm
-0000dcf0: 6120 3a20 7363 616c 6172 206f 7220 6172  a : scalar or ar
-0000dd00: 7261 7920 6f66 2073 6361 6c61 7273 2c20  ray of scalars, 
-0000dd10: 6465 6661 756c 7420 6973 2078 312e 3620  default is x1.6 
-0000dd20: 6f66 206c 6f77 5f73 6967 6d61 2e0d 0a20  of low_sigma... 
-0000dd30: 2020 2020 2020 2020 2020 2068 6967 6865             highe
-0000dd40: 7220 7374 616e 6461 7264 2064 6576 6961  r standard devia
-0000dd50: 7469 6f6e 2873 2920 6f66 2047 6175 7373  tion(s) of Gauss
-0000dd60: 6961 6e2e 0d0a 2020 2020 2020 2020 7b64  ian...        {d
-0000dd70: 696d 737d 0d0a 2020 2020 2020 2020 2020  ims}..          
-0000dd80: 2020 0d0a 2020 2020 2020 2020 5265 7475    ..        Retu
-0000dd90: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
-0000dda0: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
-0000ddb0: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
-0000ddc0: 2020 2020 4669 6c74 6572 6564 2069 6d61      Filtered ima
-0000ddd0: 6765 2e0d 0a20 2020 2020 2020 2022 2222  ge...        """
-0000dde0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000ddf0: 2020 0d0a 2020 2020 2020 2020 6c6f 775f    ..        low_
-0000de00: 7369 676d 6120 3d20 6e70 2e61 7272 6179  sigma = np.array
-0000de10: 2863 6865 636b 5f6e 6428 6c6f 775f 7369  (check_nd(low_si
-0000de20: 676d 612c 206c 656e 2864 696d 7329 2929  gma, len(dims)))
-0000de30: 0d0a 2020 2020 2020 2020 6869 6768 5f73  ..        high_s
-0000de40: 6967 6d61 203d 206c 6f77 5f73 6967 6d61  igma = low_sigma
-0000de50: 202a 2031 2e36 2069 6620 6869 6768 5f73   * 1.6 if high_s
-0000de60: 6967 6d61 2069 7320 4e6f 6e65 2065 6c73  igma is None els
-0000de70: 6520 6869 6768 5f73 6967 6d61 0d0a 2020  e high_sigma..  
-0000de80: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000de90: 7265 7475 726e 2073 656c 662e 6173 5f66  return self.as_f
-0000dea0: 6c6f 6174 2829 2e5f 6170 706c 795f 6461  loat()._apply_da
-0000deb0: 736b 280d 0a20 2020 2020 2020 2020 2020  sk(..           
-0000dec0: 205f 6669 6c74 6572 732e 646f 675f 6669   _filters.dog_fi
-0000ded0: 6c74 6572 2c20 0d0a 2020 2020 2020 2020  lter, ..        
-0000dee0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
-0000def0: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
-0000df00: 2073 656c 662e 6178 6573 292c 0d0a 2020   self.axes),..  
-0000df10: 2020 2020 2020 2020 2020 6172 6773 3d28            args=(
-0000df20: 6c6f 775f 7369 676d 612c 2068 6967 685f  low_sigma, high_
-0000df30: 7369 676d 6129 0d0a 2020 2020 2020 2020  sigma)..        
-0000df40: 290d 0a20 2020 200d 0a20 2020 2040 5f64  )..    ..    @_d
-0000df50: 6f63 732e 7772 6974 655f 646f 6373 0d0a  ocs.write_docs..
-0000df60: 2020 2020 4064 696d 735f 746f 5f73 7061      @dims_to_spa
-0000df70: 7469 616c 5f61 7865 730d 0a20 2020 2040  tial_axes..    @
-0000df80: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
-0000df90: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
-0000dfa0: 646f 685f 6669 6c74 6572 2873 656c 662c  doh_filter(self,
-0000dfb0: 2073 6967 6d61 3a20 6e44 466c 6f61 7420   sigma: nDFloat 
-0000dfc0: 3d20 312c 202a 2c20 6469 6d73 3a20 4469  = 1, *, dims: Di
-0000dfd0: 6d73 203d 204e 6f6e 6529 202d 3e20 496d  ms = None) -> Im
-0000dfe0: 6741 7272 6179 3a0d 0a20 2020 2020 2020  gArray:..       
-0000dff0: 2022 2222 0d0a 2020 2020 2020 2020 4465   """..        De
-0000e000: 7465 726d 696e 616e 7420 6f66 2048 6573  terminant of Hes
-0000e010: 7369 616e 2066 696c 7465 722e 2054 6869  sian filter. Thi
-0000e020: 7320 6675 6e63 7469 6f6e 2064 6f65 7320  s function does 
-0000e030: 6e6f 7420 7375 7070 6f72 7420 6075 7064  not support `upd
-0000e040: 6174 6560 0d0a 2020 2020 2020 2020 6172  ate`..        ar
-0000e050: 6775 6d65 6e74 2062 6563 6175 7365 206f  gument because o
-0000e060: 7574 7075 7420 6861 7320 746f 7461 6c20  utput has total 
-0000e070: 6469 6666 6572 656e 7420 7363 616c 6520  different scale 
-0000e080: 6f66 2069 6e74 656e 7369 7479 2e20 0d0a  of intensity. ..
-0000e090: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000e0a0: 2020 2020 2020 2e2e 2077 6172 6e69 6e67        .. warning
-0000e0b0: 3a3a 0d0a 2020 2020 2020 2020 2020 2020  ::..            
-0000e0c0: 2020 2020 4265 6361 7573 6520 696e 206d      Because in m
-0000e0d0: 6f73 7420 6361 7365 7320 7765 2077 616e  ost cases we wan
-0000e0e0: 7420 746f 2066 696e 6420 6f6e 6c79 2062  t to find only b
-0000e0f0: 7269 6768 7420 646f 7473 2c20 6569 6765  right dots, eige
-0000e100: 6e76 616c 7565 7320 6c61 7267 6572 200d  nvalues larger .
-0000e110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e120: 2074 6861 6e20 3020 6973 2069 676e 6f72   than 0 is ignor
-0000e130: 6564 2062 6566 6f72 6520 636f 6d70 7574  ed before comput
-0000e140: 696e 6720 6465 7465 726d 696e 616e 742e  ing determinant.
-0000e150: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
-0000e160: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
-0000e170: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-0000e180: 2020 2020 7b73 6967 6d61 7d7b 6469 6d73      {sigma}{dims
-0000e190: 7d0d 0a0d 0a20 2020 2020 2020 2052 6574  }....        Ret
-0000e1a0: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
-0000e1b0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
-0000e1c0: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
-0000e1d0: 2020 2020 2046 696c 7465 7265 6420 696d       Filtered im
-0000e1e0: 6167 652e 0d0a 2020 2020 2020 2020 2222  age...        ""
-0000e1f0: 2220 2020 200d 0a20 2020 2020 2020 2073  "    ..        s
-0000e200: 6967 6d61 203d 2063 6865 636b 5f6e 6428  igma = check_nd(
-0000e210: 7369 676d 612c 206c 656e 2864 696d 7329  sigma, len(dims)
-0000e220: 290d 0a20 2020 2020 2020 2070 7873 697a  )..        pxsiz
-0000e230: 6520 3d20 6e70 2e61 7272 6179 285b 7365  e = np.array([se
-0000e240: 6c66 2e73 6361 6c65 5b61 5d20 666f 7220  lf.scale[a] for 
-0000e250: 6120 696e 2064 696d 735d 290d 0a20 2020  a in dims])..   
-0000e260: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000e270: 2e61 735f 666c 6f61 7428 292e 5f61 7070  .as_float()._app
-0000e280: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
-0000e290: 2020 2020 2020 5f66 696c 7465 7273 2e64        _filters.d
-0000e2a0: 6f68 5f66 696c 7465 722c 200d 0a20 2020  oh_filter, ..   
-0000e2b0: 2020 2020 2020 2020 2063 5f61 7865 733d           c_axes=
-0000e2c0: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
-0000e2d0: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
-0000e2e0: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
-0000e2f0: 6172 6773 3d28 7369 676d 612c 2070 7873  args=(sigma, pxs
-0000e300: 697a 6529 0d0a 2020 2020 2020 2020 290d  ize)..        ).
-0000e310: 0a20 2020 200d 0a20 2020 2040 5f64 6f63  .    ..    @_doc
-0000e320: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
-0000e330: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
-0000e340: 616c 5f61 7865 730d 0a20 2020 2040 6368  al_axes..    @ch
-0000e350: 6563 6b5f 696e 7075 745f 616e 645f 6f75  eck_input_and_ou
-0000e360: 7470 7574 0d0a 2020 2020 6465 6620 6c6f  tput..    def lo
-0000e370: 675f 6669 6c74 6572 2873 656c 662c 2073  g_filter(self, s
-0000e380: 6967 6d61 3a20 6e44 466c 6f61 7420 3d20  igma: nDFloat = 
-0000e390: 312c 202a 2c20 6469 6d73 3a20 4469 6d73  1, *, dims: Dims
-0000e3a0: 203d 204e 6f6e 6529 202d 3e20 496d 6741   = None) -> ImgA
-0000e3b0: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
-0000e3c0: 2222 0d0a 2020 2020 2020 2020 4c61 706c  ""..        Lapl
-0000e3d0: 6163 6961 6e20 6f66 2047 6175 7373 6961  acian of Gaussia
-0000e3e0: 6e20 6669 6c74 6572 2e0d 0a0d 0a20 2020  n filter.....   
-0000e3f0: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-0000e400: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0000e410: 2d2d 2d0d 0a20 2020 2020 2020 207b 7369  ---..        {si
-0000e420: 676d 617d 7b64 696d 737d 0d0a 0d0a 2020  gma}{dims}....  
-0000e430: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
-0000e440: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
-0000e450: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
-0000e460: 0d0a 2020 2020 2020 2020 2020 2020 4669  ..            Fi
-0000e470: 6c74 6572 6564 2069 6d61 6765 2e0d 0a20  ltered image... 
-0000e480: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0000e490: 2020 2020 7265 7475 726e 202d 7365 6c66      return -self
-0000e4a0: 2e61 735f 666c 6f61 7428 292e 5f61 7070  .as_float()._app
-0000e4b0: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
-0000e4c0: 2020 2020 2020 5f66 696c 7465 7273 2e67        _filters.g
-0000e4d0: 6175 7373 6961 6e5f 6c61 706c 6163 652c  aussian_laplace,
-0000e4e0: 0d0a 2020 2020 2020 2020 2020 2020 635f  ..            c_
-0000e4f0: 6178 6573 3d63 6f6d 706c 656d 656e 745f  axes=complement_
-0000e500: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-0000e510: 6178 6573 292c 200d 0a20 2020 2020 2020  axes), ..       
-0000e520: 2020 2020 2061 7267 733d 2873 6967 6d61       args=(sigma
-0000e530: 2c29 0d0a 2020 2020 2020 2020 290d 0a20  ,)..        ).. 
-0000e540: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
-0000e550: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
-0000e560: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-0000e570: 5f61 7865 730d 0a20 2020 2040 7361 6d65  _axes..    @same
-0000e580: 5f64 7479 7065 2861 7366 6c6f 6174 3d54  _dtype(asfloat=T
-0000e590: 7275 6529 0d0a 2020 2020 4063 6865 636b  rue)..    @check
-0000e5a0: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
-0000e5b0: 740d 0a20 2020 2064 6566 2072 6f6c 6c69  t..    def rolli
-0000e5c0: 6e67 5f62 616c 6c28 0d0a 2020 2020 2020  ng_ball(..      
-0000e5d0: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-0000e5e0: 2072 6164 6975 733a 2066 6c6f 6174 203d   radius: float =
-0000e5f0: 2033 302c 0d0a 2020 2020 2020 2020 7072   30,..        pr
-0000e600: 6566 696c 7465 723a 204c 6974 6572 616c  efilter: Literal
-0000e610: 5b22 6d65 616e 222c 2022 6d65 6469 616e  ["mean", "median
-0000e620: 222c 2022 6e6f 6e65 225d 203d 2022 6d65  ", "none"] = "me
-0000e630: 616e 222c 0d0a 2020 2020 2020 2020 2a2c  an",..        *,
-0000e640: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000e650: 5f62 673a 2062 6f6f 6c20 3d20 4661 6c73  _bg: bool = Fals
-0000e660: 652c 0d0a 2020 2020 2020 2020 6469 6d73  e,..        dims
-0000e670: 3a20 4469 6d73 203d 204e 6f6e 652c 0d0a  : Dims = None,..
-0000e680: 2020 2020 2020 2020 7570 6461 7465 3a20          update: 
-0000e690: 626f 6f6c 203d 2046 616c 7365 0d0a 2020  bool = False..  
-0000e6a0: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
-0000e6b0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0000e6c0: 2020 2020 2020 2053 7562 7472 6163 7420         Subtract 
-0000e6d0: 4261 636b 6772 6f75 6e64 2075 7369 6e67  Background using
-0000e6e0: 2072 6f6c 6c69 6e67 2d62 616c 6c20 616c   rolling-ball al
-0000e6f0: 676f 7269 7468 6d2e 0d0a 0d0a 2020 2020  gorithm.....    
-0000e700: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-0000e710: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000e720: 2d2d 0d0a 2020 2020 2020 2020 7b72 6164  --..        {rad
-0000e730: 6975 737d 0d0a 2020 2020 2020 2020 7072  ius}..        pr
-0000e740: 6566 696c 7465 7220 3a20 226d 6561 6e22  efilter : "mean"
-0000e750: 2c20 226d 6564 6961 6e22 206f 7220 226e  , "median" or "n
-0000e760: 6f6e 6522 0d0a 2020 2020 2020 2020 2020  one"..          
-0000e770: 2020 4966 2061 7070 6c79 2033 7833 2061    If apply 3x3 a
-0000e780: 7665 7261 6769 6e67 2062 6566 6f72 6520  veraging before 
-0000e790: 6372 6561 7469 6e67 2062 6163 6b67 726f  creating backgro
-0000e7a0: 756e 642e 0d0a 2020 2020 2020 2020 7b64  und...        {d
-0000e7b0: 696d 737d 7b75 7064 6174 657d 0d0a 2020  ims}{update}..  
-0000e7c0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0000e7d0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0000e7e0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-0000e7f0: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-0000e800: 2020 2020 2020 2020 2020 2020 4261 636b              Back
-0000e810: 6772 6f75 6e64 2073 7562 7472 6163 7465  ground subtracte
-0000e820: 6420 696d 6167 652e 0d0a 2020 2020 2020  d image...      
-0000e830: 2020 2222 2220 2020 2020 2020 200d 0a20    """        .. 
-0000e840: 2020 2020 2020 2063 5f61 7865 7320 3d20         c_axes = 
-0000e850: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
-0000e860: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
-0000e870: 0d0a 2020 2020 2020 2020 6966 2070 7265  ..        if pre
-0000e880: 6669 6c74 6572 203d 3d20 226d 6561 6e22  filter == "mean"
-0000e890: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-0000e8a0: 696c 7420 3d20 7365 6c66 2e5f 6170 706c  ilt = self._appl
-0000e8b0: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
-0000e8c0: 2020 2020 2020 2020 205f 6669 6c74 6572           _filter
-0000e8d0: 732e 6d65 616e 5f66 696c 7465 722c 200d  s.mean_filter, .
-0000e8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e8f0: 2063 5f61 7865 733d 635f 6178 6573 2c20   c_axes=c_axes, 
-0000e900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e910: 2020 6b77 6172 6773 3d64 6963 7428 7365    kwargs=dict(se
-0000e920: 6c65 6d3d 6e70 2e6f 6e65 7328 2833 2c29  lem=np.ones((3,)
-0000e930: 2a6c 656e 2864 696d 7329 2929 0d0a 2020  *len(dims)))..  
-0000e940: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-0000e950: 2020 2020 2065 6c69 6620 7072 6566 696c       elif prefil
-0000e960: 7465 7220 3d3d 2022 6d65 6469 616e 223a  ter == "median":
-0000e970: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-0000e980: 6c74 203d 2073 656c 662e 5f61 7070 6c79  lt = self._apply
-0000e990: 5f64 6173 6b28 0d0a 2020 2020 2020 2020  _dask(..        
-0000e9a0: 2020 2020 2020 2020 5f66 696c 7465 7273          _filters
-0000e9b0: 2e6d 6564 6961 6e5f 6669 6c74 6572 2c20  .median_filter, 
-0000e9c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e9d0: 2020 635f 6178 6573 3d63 5f61 7865 732c    c_axes=c_axes,
-0000e9e0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0000e9f0: 2020 206b 7761 7267 733d 6469 6374 2866     kwargs=dict(f
-0000ea00: 6f6f 7470 7269 6e74 3d6e 702e 6f6e 6573  ootprint=np.ones
-0000ea10: 2828 332c 292a 6c65 6e28 6469 6d73 2929  ((3,)*len(dims))
-0000ea20: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
-0000ea30: 0d0a 2020 2020 2020 2020 656c 6966 2070  ..        elif p
-0000ea40: 7265 6669 6c74 6572 203d 3d20 226e 6f6e  refilter == "non
-0000ea50: 6522 3a0d 0a20 2020 2020 2020 2020 2020  e":..           
-0000ea60: 2066 696c 7420 3d20 7365 6c66 0d0a 2020   filt = self..  
-0000ea70: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000ea80: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000ea90: 616c 7565 4572 726f 7228 2260 7072 6566  alueError("`pref
-0000eaa0: 696c 7465 7260 206d 7573 7420 6265 2027  ilter` must be '
-0000eab0: 6d65 616e 272c 2027 6d65 6469 616e 2720  mean', 'median' 
-0000eac0: 6f72 2027 6e6f 6e65 272e 2229 0d0a 2020  or 'none'.")..  
-0000ead0: 2020 2020 2020 6669 6c74 2e61 7865 7320        filt.axes 
-0000eae0: 3d20 7365 6c66 2e61 7865 730d 0a20 2020  = self.axes..   
-0000eaf0: 2020 2020 2062 6163 6b20 3d20 6669 6c74       back = filt
-0000eb00: 2e5f 6170 706c 795f 6461 736b 280d 0a20  ._apply_dask(.. 
-0000eb10: 2020 2020 2020 2020 2020 2073 6b72 6573             skres
-0000eb20: 2e72 6f6c 6c69 6e67 5f62 616c 6c2c 200d  .rolling_ball, .
-0000eb30: 0a20 2020 2020 2020 2020 2020 2063 5f61  .            c_a
-0000eb40: 7865 733d 635f 6178 6573 2c20 0d0a 2020  xes=c_axes, ..  
-0000eb50: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-0000eb60: 3d64 6963 7428 7261 6469 7573 3d72 6164  =dict(radius=rad
-0000eb70: 6975 7329 0d0a 2020 2020 2020 2020 290d  ius)..        ).
-0000eb80: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000eb90: 7265 7475 726e 5f62 673a 0d0a 2020 2020  return_bg:..    
-0000eba0: 2020 2020 2020 2020 6f75 7420 3d20 7365          out = se
-0000ebb0: 6c66 2e76 616c 7565 202d 2062 6163 6b0d  lf.value - back.
-0000ebc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000ebd0: 7572 6e20 6f75 740d 0a20 2020 2020 2020  urn out..       
-0000ebe0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000ebf0: 2020 2020 7265 7475 726e 2062 6163 6b0d      return back.
-0000ec00: 0a20 2020 200d 0a20 2020 2040 5f64 6f63  .    ..    @_doc
-0000ec10: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
-0000ec20: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
-0000ec30: 616c 5f61 7865 730d 0a20 2020 2040 7361  al_axes..    @sa
-0000ec40: 6d65 5f64 7479 7065 2861 7366 6c6f 6174  me_dtype(asfloat
-0000ec50: 3d54 7275 6529 0d0a 2020 2020 4063 6865  =True)..    @che
-0000ec60: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
-0000ec70: 7075 740d 0a20 2020 2064 6566 2072 6f66  put..    def rof
-0000ec80: 5f66 696c 7465 7228 0d0a 2020 2020 2020  _filter(..      
-0000ec90: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-0000eca0: 206c 6d64 3a20 666c 6f61 7420 3d20 302e   lmd: float = 0.
-0000ecb0: 3035 2c0d 0a20 2020 2020 2020 2074 6f6c  05,..        tol
-0000ecc0: 3a20 666c 6f61 7420 3d20 3165 2d34 2c0d  : float = 1e-4,.
-0000ecd0: 0a20 2020 2020 2020 206d 6178 5f69 7465  .        max_ite
-0000ece0: 723a 2069 6e74 203d 2035 302c 200d 0a20  r: int = 50, .. 
-0000ecf0: 2020 2020 2020 202a 2c20 0d0a 2020 2020         *, ..    
-0000ed00: 2020 2020 6469 6d73 3a20 4469 6d73 203d      dims: Dims =
-0000ed10: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-0000ed20: 7570 6461 7465 3a20 626f 6f6c 203d 2046  update: bool = F
-0000ed30: 616c 7365 2c0d 0a20 2020 2029 202d 3e20  alse,..    ) -> 
-0000ed40: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
-0000ed50: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000ed60: 5275 6469 6e2d 4f73 6865 722d 4661 7465  Rudin-Osher-Fate
-0000ed70: 6d69 2773 2074 6f74 616c 2076 6172 6961  mi's total varia
-0000ed80: 7469 6f6e 2064 656e 6f69 7369 6e67 2e0d  tion denoising..
-0000ed90: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-0000eda0: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
-0000edb0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
-0000edc0: 2020 206c 6d64 203a 2066 6c6f 6174 2c20     lmd : float, 
-0000edd0: 6465 6661 756c 7420 6973 2030 2e30 350d  default is 0.05.
-0000ede0: 0a20 2020 2020 2020 2020 2020 2043 6f6e  .            Con
-0000edf0: 7374 616e 7420 7661 6c75 6520 696e 2074  stant value in t
-0000ee00: 6f74 616c 2076 6172 6961 7469 6f6e 2e0d  otal variation..
-0000ee10: 0a20 2020 2020 2020 2074 6f6c 203a 2066  .        tol : f
-0000ee20: 6c6f 6174 2c20 6465 6661 756c 7420 6973  loat, default is
-0000ee30: 2031 652d 340d 0a20 2020 2020 2020 2020   1e-4..         
-0000ee40: 2020 2049 7465 7261 7469 6f6e 2073 746f     Iteration sto
-0000ee50: 7073 2077 6865 6e20 6761 696e 2069 7320  ps when gain is 
-0000ee60: 756e 6465 7220 7468 6973 2076 616c 7565  under this value
-0000ee70: 2e0d 0a20 2020 2020 2020 206d 6178 5f69  ...        max_i
-0000ee80: 7465 7220 3a20 696e 742c 2064 6566 6175  ter : int, defau
-0000ee90: 6c74 2069 7320 3530 0d0a 2020 2020 2020  lt is 50..      
-0000eea0: 2020 2020 2020 4d61 7869 6d75 6d20 6e75        Maximum nu
-0000eeb0: 6d62 6572 206f 6620 6974 6572 6174 696f  mber of iteratio
-0000eec0: 6e73 2e0d 0a20 2020 2020 2020 207b 6469  ns...        {di
-0000eed0: 6d73 7d7b 7570 6461 7465 7d0d 0a20 2020  ms}{update}..   
-0000eee0: 2020 2020 200d 0a20 2020 2020 2020 2052       ..        R
-0000eef0: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-0000ef00: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0000ef10: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
-0000ef20: 2020 2020 2020 2046 696c 7465 7265 6420         Filtered 
-0000ef30: 696d 6167 650d 0a20 2020 2020 2020 2022  image..        "
-0000ef40: 2222 2020 2020 200d 0a20 2020 2020 2020  ""     ..       
-0000ef50: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
-0000ef60: 706c 795f 6461 736b 280d 0a20 2020 2020  ply_dask(..     
-0000ef70: 2020 2020 2020 2073 6b72 6573 2e5f 6465         skres._de
-0000ef80: 6e6f 6973 652e 5f64 656e 6f69 7365 5f74  noise._denoise_t
-0000ef90: 765f 6368 616d 626f 6c6c 655f 6e64 2c20  v_chambolle_nd, 
-0000efa0: 0d0a 2020 2020 2020 2020 2020 2020 635f  ..            c_
-0000efb0: 6178 6573 3d63 6f6d 706c 656d 656e 745f  axes=complement_
-0000efc0: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-0000efd0: 6178 6573 292c 0d0a 2020 2020 2020 2020  axes),..        
-0000efe0: 2020 2020 6b77 6172 6773 3d64 6963 7428      kwargs=dict(
-0000eff0: 7765 6967 6874 3d6c 6d64 2c20 6570 733d  weight=lmd, eps=
-0000f000: 746f 6c2c 206d 6178 5f6e 756d 5f69 7465  tol, max_num_ite
-0000f010: 723d 6d61 785f 6974 6572 290d 0a20 2020  r=max_iter)..   
-0000f020: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000f030: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
-0000f040: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
-0000f050: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
-0000f060: 6573 0d0a 2020 2020 4073 616d 655f 6474  es..    @same_dt
-0000f070: 7970 6528 6173 666c 6f61 743d 5472 7565  ype(asfloat=True
-0000f080: 290d 0a20 2020 2040 6368 6563 6b5f 696e  )..    @check_in
-0000f090: 7075 745f 616e 645f 6f75 7470 7574 0d0a  put_and_output..
-0000f0a0: 2020 2020 6465 6620 7761 7665 6c65 745f      def wavelet_
-0000f0b0: 6465 6e6f 6973 696e 6728 0d0a 2020 2020  denoising(..    
-0000f0c0: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-0000f0d0: 2020 206e 6f69 7365 5f73 6967 6d61 3a20     noise_sigma: 
-0000f0e0: 666c 6f61 7420 7c20 4e6f 6e65 203d 204e  float | None = N
-0000f0f0: 6f6e 652c 0d0a 2020 2020 2020 2020 2a2c  one,..        *,
-0000f100: 200d 0a20 2020 2020 2020 2077 6176 656c   ..        wavel
-0000f110: 6574 3a20 7374 7220 3d20 2264 6231 222c  et: str = "db1",
-0000f120: 0d0a 2020 2020 2020 2020 6d6f 6465 3a20  ..        mode: 
-0000f130: 4c69 7465 7261 6c5b 2273 6f66 7422 2c20  Literal["soft", 
-0000f140: 2268 6172 6422 5d20 3d20 2273 6f66 7422  "hard"] = "soft"
-0000f150: 2c20 0d0a 2020 2020 2020 2020 7761 7665  , ..        wave
-0000f160: 6c65 745f 6c65 7665 6c73 3a20 696e 7420  let_levels: int 
-0000f170: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0d0a  | None = None,..
-0000f180: 2020 2020 2020 2020 6d65 7468 6f64 3a20          method: 
-0000f190: 4c69 7465 7261 6c5b 2242 6179 6573 5368  Literal["BayesSh
-0000f1a0: 7269 6e6b 222c 2022 5669 7375 5368 7269  rink", "VisuShri
-0000f1b0: 6e6b 225d 203d 2022 4261 7965 7353 6872  nk"] = "BayesShr
-0000f1c0: 696e 6b22 2c0d 0a20 2020 2020 2020 206d  ink",..        m
-0000f1d0: 6178 5f73 6869 6674 733a 2069 6e74 207c  ax_shifts: int |
-0000f1e0: 2074 7570 6c65 5b69 6e74 2c20 2e2e 2e5d   tuple[int, ...]
-0000f1f0: 203d 2030 2c0d 0a20 2020 2020 2020 2073   = 0,..        s
-0000f200: 6869 6674 5f73 7465 7073 3a20 696e 7420  hift_steps: int 
-0000f210: 7c20 7475 706c 655b 696e 742c 202e 2e2e  | tuple[int, ...
-0000f220: 5d20 3d20 312c 0d0a 2020 2020 2020 2020  ] = 1,..        
-0000f230: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
-0000f240: 652c 0d0a 2020 2020 2920 2d3e 2049 6d67  e,..    ) -> Img
-0000f250: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
-0000f260: 2222 220d 0a20 2020 2020 2020 2057 6176  """..        Wav
-0000f270: 656c 6574 2064 656e 6f69 7369 6e67 2e20  elet denoising. 
-0000f280: 4265 6361 7573 6520 6974 2069 7320 6e6f  Because it is no
-0000f290: 7420 7368 6966 7420 696e 7661 7269 616e  t shift invarian
-0000f2a0: 742c 2060 6063 7963 6c65 5f73 7069 6e60  t, ``cycle_spin`
-0000f2b0: 6020 6973 2063 616c 6c65 6420 696e 7369  ` is called insi
-0000f2c0: 6465 2074 6865 200d 0a20 2020 2020 2020  de the ..       
-0000f2d0: 2066 756e 6374 696f 6e2e 0d0a 0d0a 2020   function.....  
-0000f2e0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0000f2f0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0000f300: 2d2d 2d2d 0d0a 2020 2020 2020 2020 6e6f  ----..        no
-0000f310: 6973 655f 7369 676d 6120 3a20 666c 6f61  ise_sigma : floa
-0000f320: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
-0000f330: 2020 2020 2020 2020 2053 7461 6e64 6172           Standar
-0000f340: 6420 6465 7669 6174 696f 6e20 6f66 206e  d deviation of n
-0000f350: 6f69 7365 2c20 6966 206b 6e6f 776e 2e0d  oise, if known..
-0000f360: 0a20 2020 2020 2020 2077 6176 656c 6574  .        wavelet
-0000f370: 203a 2073 7472 2c20 6465 6661 756c 7420   : str, default 
-0000f380: 6973 2022 6462 3122 0d0a 2020 2020 2020  is "db1"..      
-0000f390: 2020 2020 2020 416e 7920 6f70 7469 6f6e        Any option
-0000f3a0: 7320 6f66 2060 7079 7774 2e77 6176 656c  s of `pywt.wavel
-0000f3b0: 6973 7460 2e0d 0a20 2020 2020 2020 206d  ist`...        m
-0000f3c0: 6f64 6520 3a20 7b22 736f 6674 222c 2022  ode : {"soft", "
-0000f3d0: 6861 7264 227d 2c20 6465 6661 756c 7420  hard"}, default 
-0000f3e0: 6973 2022 736f 6674 220d 0a20 2020 2020  is "soft"..     
-0000f3f0: 2020 2020 2020 2054 7970 6520 6f66 2064         Type of d
-0000f400: 656e 6f69 7369 6e67 2e0d 0a20 2020 2020  enoising...     
-0000f410: 2020 2077 6176 656c 6574 5f6c 6576 656c     wavelet_level
-0000f420: 7320 3a20 696e 742c 206f 7074 696f 6e61  s : int, optiona
-0000f430: 6c0d 0a20 2020 2020 2020 2020 2020 2054  l..            T
-0000f440: 6865 206e 756d 6265 7220 6f66 2077 6176  he number of wav
-0000f450: 656c 6574 2064 6563 6f6d 706f 7369 7469  elet decompositi
-0000f460: 6f6e 206c 6576 656c 7320 746f 2075 7365  on levels to use
-0000f470: 2e0d 0a20 2020 2020 2020 206d 6574 686f  ...        metho
-0000f480: 6420 3a20 7b22 4261 7965 7353 6872 696e  d : {"BayesShrin
-0000f490: 6b22 2c20 2256 6973 7553 6872 696e 6b22  k", "VisuShrink"
-0000f4a0: 7d2c 2064 6566 6175 6c74 2069 7320 2242  }, default is "B
-0000f4b0: 6179 6573 5368 7269 6e6b 220d 0a20 2020  ayesShrink"..   
-0000f4c0: 2020 2020 2020 2020 2054 6872 6573 686f           Thresho
-0000f4d0: 6c64 696e 6720 6d65 7468 6f64 2074 6f20  lding method to 
-0000f4e0: 6265 2075 7365 640d 0a20 2020 2020 2020  be used..       
-0000f4f0: 206d 6178 5f73 6869 6674 7320 3a20 696e   max_shifts : in
-0000f500: 7420 6f72 2074 7570 6c65 2c20 6465 6661  t or tuple, defa
-0000f510: 756c 7420 6973 2030 0d0a 2020 2020 2020  ult is 0..      
-0000f520: 2020 2020 2020 5368 6966 7473 2069 6e20        Shifts in 
-0000f530: 7261 6e67 6528 302c 206d 6178 5f73 6869  range(0, max_shi
-0000f540: 6674 732b 3129 2077 696c 6c20 6265 2075  fts+1) will be u
-0000f550: 7365 642e 0d0a 2020 2020 2020 2020 7368  sed...        sh
-0000f560: 6966 745f 7374 6570 7320 3a20 696e 7420  ift_steps : int 
-0000f570: 6f72 2074 7570 6c65 2c20 6465 6661 756c  or tuple, defaul
-0000f580: 7420 6973 2031 0d0a 2020 2020 2020 2020  t is 1..        
-0000f590: 2020 2020 5374 6570 2073 697a 6520 6f66      Step size of
-0000f5a0: 2073 6869 6674 732e 0d0a 2020 2020 2020   shifts...      
-0000f5b0: 2020 7b64 696d 737d 0d0a 0d0a 2020 2020    {dims}....    
-0000f5c0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0000f5d0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-0000f5e0: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-0000f5f0: 2020 2020 2020 2020 2020 2020 4465 6e6f              Deno
-0000f600: 6973 6564 2069 6d61 6765 2e0d 0a20 2020  ised image...   
-0000f610: 2020 2020 2022 2222 2020 2020 2020 2020       """        
-0000f620: 0d0a 2020 2020 2020 2020 6675 6e63 5f6b  ..        func_k
-0000f630: 7720 3d20 6469 6374 280d 0a20 2020 2020  w = dict(..     
-0000f640: 2020 2020 2020 2073 6967 6d61 3d6e 6f69         sigma=noi
-0000f650: 7365 5f73 6967 6d61 2c20 0d0a 2020 2020  se_sigma, ..    
-0000f660: 2020 2020 2020 2020 7761 7665 6c65 743d          wavelet=
-0000f670: 7761 7665 6c65 742c 200d 0a20 2020 2020  wavelet, ..     
-0000f680: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
-0000f690: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
-0000f6a0: 7761 7665 6c65 745f 6c65 7665 6c73 3d77  wavelet_levels=w
-0000f6b0: 6176 656c 6574 5f6c 6576 656c 732c 0d0a  avelet_levels,..
-0000f6c0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-0000f6d0: 6f64 3d6d 6574 686f 640d 0a20 2020 2020  od=method..     
-0000f6e0: 2020 2029 0d0a 2020 2020 2020 2020 7265     )..        re
-0000f6f0: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
-0000f700: 5f64 6173 6b28 0d0a 2020 2020 2020 2020  _dask(..        
-0000f710: 2020 2020 736b 7265 732e 6379 636c 655f      skres.cycle_
-0000f720: 7370 696e 2c20 0d0a 2020 2020 2020 2020  spin, ..        
-0000f730: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
-0000f740: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
-0000f750: 2073 656c 662e 6178 6573 292c 200d 0a20   self.axes), .. 
-0000f760: 2020 2020 2020 2020 2020 2061 7267 733d             args=
-0000f770: 2873 6b72 6573 2e64 656e 6f69 7365 5f77  (skres.denoise_w
-0000f780: 6176 656c 6574 2c29 2c0d 0a20 2020 2020  avelet,),..     
-0000f790: 2020 2020 2020 206b 7761 7267 733d 6469         kwargs=di
-0000f7a0: 6374 2866 756e 635f 6b77 3d66 756e 635f  ct(func_kw=func_
-0000f7b0: 6b77 2c20 6d61 785f 7368 6966 7473 3d6d  kw, max_shifts=m
-0000f7c0: 6178 5f73 6869 6674 732c 2073 6869 6674  ax_shifts, shift
-0000f7d0: 5f73 7465 7073 3d73 6869 6674 5f73 7465  _steps=shift_ste
-0000f7e0: 7073 290d 0a20 2020 2020 2020 2029 0d0a  ps)..        )..
-0000f7f0: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
-0000f800: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
-0000f810: 2064 6566 2073 706c 6974 5f70 6978 656c   def split_pixel
-0000f820: 5f75 6e69 7428 0d0a 2020 2020 2020 2020  _unit(..        
-0000f830: 7365 6c66 2c0d 0a20 2020 2020 2020 2063  self,..        c
-0000f840: 656e 7465 723a 2074 7570 6c65 5b66 6c6f  enter: tuple[flo
-0000f850: 6174 2c20 666c 6f61 745d 203d 2028 302e  at, float] = (0.
-0000f860: 352c 2030 2e35 292c 0d0a 2020 2020 2020  5, 0.5),..      
-0000f870: 2020 2a2c 200d 0a20 2020 2020 2020 206f    *, ..        o
-0000f880: 7264 6572 3a20 696e 7420 3d20 312c 0d0a  rder: int = 1,..
-0000f890: 2020 2020 2020 2020 616e 676c 655f 6f72          angle_or
-0000f8a0: 6465 723a 206c 6973 745b 696e 745d 207c  der: list[int] |
-0000f8b0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0d 0a20   None = None,.. 
-0000f8c0: 2020 2020 2020 206e 6577 6178 6973 3a20         newaxis: 
-0000f8d0: 4178 6973 4c69 6b65 203d 2022 6122 2c0d  AxisLike = "a",.
-0000f8e0: 0a20 2020 2029 202d 3e20 496d 6741 7272  .    ) -> ImgArr
-0000f8f0: 6179 3a0d 0a20 2020 2020 2020 2072 2222  ay:..        r""
-0000f900: 220d 0a20 2020 2020 2020 2053 706c 6974  "..        Split
-0000f910: 2061 2028 324e 2c20 324d 292d 696d 6167   a (2N, 2M)-imag
-0000f920: 6520 696e 746f 2066 6f75 7220 284e 2c20  e into four (N, 
-0000f930: 4d29 2d69 6d61 6765 7320 666f 7220 6561  M)-images for ea
-0000f940: 6368 206f 7468 6572 2070 6978 656c 732e  ch other pixels.
-0000f950: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0000f960: 2020 2020 4765 6e65 7261 6c6c 792c 2069      Generally, i
-0000f970: 6d61 6765 2061 6371 7569 7369 7469 6f6e  mage acquisition
-0000f980: 2077 6974 6820 6120 706f 6c61 7269 7a61   with a polariza
-0000f990: 7469 6f6e 2063 616d 6572 6120 7769 6c6c  tion camera will
-0000f9a0: 206f 7574 7075 7420 0d0a 2020 2020 2020   output ..      
-0000f9b0: 2020 3a6d 6174 683a 6028 324e 2c20 324d    :math:`(2N, 2M
-0000f9c0: 2960 2d69 6d61 6765 2077 6974 6820 3a6d  )`-image with :m
-0000f9d0: 6174 683a 604e 205c 7469 6d65 7320 4d60  ath:`N \times M`
-0000f9e0: 2070 6978 656c 2075 6e69 7473 3a0d 0a20   pixel units:.. 
-0000f9f0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000fa00: 202b 2d2b 2d2b 2d2b 2d2b 2d2b 2d2b 0d0a   +-+-+-+-+-+-+..
-0000fa10: 2020 2020 2020 2020 7c30 7c31 7c30 7c31          |0|1|0|1
-0000fa20: 7c30 7c31 7c0d 0a20 2020 2020 2020 202b  |0|1|..        +
-0000fa30: 2d2b 2d2b 2d2b 2d2b 2d2b 2d2b 0d0a 2020  -+-+-+-+-+-+..  
-0000fa40: 2020 2020 2020 7c33 7c32 7c33 7c32 7c33        |3|2|3|2|3
-0000fa50: 7c32 7c0d 0a20 2020 2020 2020 202b 2d2b  |2|..        +-+
-0000fa60: 2d2b 2d2b 2d2b 2d2b 2d2b 0d0a 2020 2020  -+-+-+-+-+..    
-0000fa70: 2020 2020 7c30 7c31 7c30 7c31 7c30 7c31      |0|1|0|1|0|1
-0000fa80: 7c0d 0a20 2020 2020 2020 202b 2d2b 2d2b  |..        +-+-+
-0000fa90: 2d2b 2d2b 2d2b 2d2b 0d0a 2020 2020 2020  -+-+-+-+..      
-0000faa0: 2020 7c33 7c32 7c33 7c32 7c33 7c32 7c0d    |3|2|3|2|3|2|.
-0000fab0: 0a20 2020 2020 2020 202b 2d2b 2d2b 2d2b  .        +-+-+-+
-0000fac0: 2d2b 2d2b 2d2b 0d0a 2020 2020 2020 2020  -+-+-+..        
-0000fad0: 0d0a 2020 2020 2020 2020 5468 6973 2066  ..        This f
-0000fae0: 756e 6374 696f 6e20 6765 6e65 7261 7465  unction generate
-0000faf0: 7320 696d 6167 6573 206f 6e6c 7920 636f  s images only co
-0000fb00: 6e73 6973 7420 6f66 2070 6f73 6974 696f  nsist of positio
-0000fb10: 6e73 206f 6620 5b30 5d2c 205b 315d 2c20  ns of [0], [1], 
-0000fb20: 0d0a 2020 2020 2020 2020 5b32 5d20 6f72  ..        [2] or
-0000fb30: 205b 335d 2e20 5374 7269 6374 6c79 2c20   [3]. Strictly, 
-0000fb40: 6561 6368 2069 6d61 6765 2069 7320 6163  each image is ac
-0000fb50: 7175 6972 6564 2066 726f 6d20 6469 6666  quired from diff
-0000fb60: 6572 656e 7420 706f 7369 7469 6f6e 200d  erent position .
-0000fb70: 0a20 2020 2020 2020 2028 7468 6520 7069  .        (the pi
-0000fb80: 7865 6c20 2869 2c20 6a29 2069 6e20 5b30  xel (i, j) in [0
-0000fb90: 5d2d 696d 6167 6520 616e 6420 7468 6520  ]-image and the 
-0000fba0: 7069 7865 6c20 2869 2c20 6a29 2069 6e20  pixel (i, j) in 
-0000fbb0: 5b31 5d2d 696d 6167 6520 6172 6520 0d0a  [1]-image are ..
-0000fbc0: 2020 2020 2020 2020 6163 7175 6972 6564          acquired
-0000fbd0: 2066 726f 6d20 6469 6666 6572 656e 7420   from different 
-0000fbe0: 706f 7369 7469 6f6e 7329 2e20 5468 6973  positions). This
-0000fbf0: 2066 756e 6374 696f 6e20 616c 736f 2063   function also c
-0000fc00: 6f6d 706c 656d 656e 7473 2066 6f72 0d0a  omplements for..
-0000fc10: 2020 2020 2020 2020 7468 6973 2064 6966          this dif
-0000fc20: 6665 7265 6e63 6520 6279 2069 6e74 6572  ference by inter
-0000fc30: 706f 6c61 7469 6f6e 2e0d 0a20 2020 2020  polation...     
-0000fc40: 2020 2020 0d0a 2020 2020 2020 2020 5061      ..        Pa
-0000fc50: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
-0000fc60: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-0000fc70: 2020 2020 2020 6365 6e74 6572 203a 2074        center : t
-0000fc80: 7570 6c65 2c20 6465 6661 756c 7420 6973  uple, default is
-0000fc90: 2028 302c 2030 290d 0a20 2020 2020 2020   (0, 0)..       
-0000fca0: 2020 2020 2043 6f6f 7264 696e 6174 6520       Coordinate 
-0000fcb0: 7468 6174 2077 696c 6c20 6265 2063 6f6e  that will be con
-0000fcc0: 7369 6465 7265 6420 6173 2074 6865 2063  sidered as the c
-0000fcd0: 656e 7465 7220 6f66 2074 6865 2072 6574  enter of the ret
-0000fce0: 7572 6e65 6420 0d0a 2020 2020 2020 2020  urned ..        
-0000fcf0: 2020 2020 696d 6167 652e 2049 6e70 7574      image. Input
-0000fd00: 2028 612c 2062 2920 6d75 7374 2073 6174   (a, b) must sat
-0000fd10: 6973 6679 2030 203c 2061 203c 2031 2061  isfy 0 < a < 1 a
-0000fd20: 6e64 2030 203c 2062 203c 2031 2e20 466f  nd 0 < b < 1. Fo
-0000fd30: 7220 6578 616d 706c 652c 0d0a 2020 2020  r example,..    
-0000fd40: 2020 2020 2020 2020 6365 6e74 6572 3d28          center=(
-0000fd50: 302c 2030 2920 6d65 616e 7320 7468 6520  0, 0) means the 
-0000fd60: 6d6f 7374 2075 7070 6572 206c 6566 7420  most upper left 
-0000fd70: 7069 7865 6c2c 2061 6e64 2063 656e 7465  pixel, and cente
-0000fd80: 723d 2830 2e35 2c20 302e 3529 0d0a 2020  r=(0.5, 0.5)..  
-0000fd90: 2020 2020 2020 2020 2020 6d65 616e 7320            means 
-0000fda0: 7468 6520 6d69 6464 6c65 2070 6f69 6e74  the middle point
-0000fdb0: 206f 6620 6120 7069 7865 6c20 756e 6974   of a pixel unit
-0000fdc0: 2e20 605b 5b30 2c20 315d 2c20 5b33 2c20  . `[[0, 1], [3, 
-0000fdd0: 325d 5d60 2062 6563 6f6d 6573 0d0a 2020  2]]` becomes..  
-0000fde0: 2020 2020 2020 2020 2020 605b 5b28 302c            `[[(0,
-0000fdf0: 2030 292c 2028 302c 2031 295d 2c20 5b28   0), (0, 1)], [(
-0000fe00: 312c 2030 292c 2028 312c 2031 295d 5d60  1, 0), (1, 1)]]`
-0000fe10: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0000fe20: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000fe30: 207b 6f72 6465 727d 0d0a 2020 2020 2020   {order}..      
-0000fe40: 2020 616e 676c 655f 6f72 6465 7220 3a20    angle_order : 
-0000fe50: 6c69 7374 206f 6620 696e 742c 2064 6566  list of int, def
-0000fe60: 6175 6c74 2069 7320 5b32 2c20 312c 2030  ault is [2, 1, 0
-0000fe70: 2c20 335d 0d0a 2020 2020 2020 2020 2020  , 3]..          
-0000fe80: 2020 5370 6563 6966 7920 7768 6963 6820    Specify which 
-0000fe90: 7069 7865 6c73 2063 6f72 7265 7370 6f6e  pixels correspon
-0000fea0: 6420 746f 2077 6869 6368 2070 6f6c 6172  d to which polar
-0000feb0: 697a 6174 696f 6e20 616e 676c 6573 2e20  ization angles. 
-0000fec0: 302c 2031 2c20 3220 0d0a 2020 2020 2020  0, 1, 2 ..      
-0000fed0: 2020 2020 2020 616e 6420 3320 636f 7272        and 3 corr
-0000fee0: 6573 706f 6e64 7320 746f 2070 6f6c 6172  esponds to polar
-0000fef0: 697a 6174 696f 6e20 6f66 2030 2c20 3435  ization of 0, 45
-0000ff00: 2c20 3930 2061 6e64 2031 3335 2064 6567  , 90 and 135 deg
-0000ff10: 7265 650d 0a20 2020 2020 2020 2020 2020  ree..           
-0000ff20: 2072 6573 7065 6374 6976 656c 792e 2054   respectively. T
-0000ff30: 6869 7320 6c69 7374 2077 696c 6c20 6265  his list will be
-0000ff40: 2064 6972 6563 746c 7920 7061 7373 6564   directly passed
-0000ff50: 2074 6f20 6060 6e70 2e6e 6461 7272 6179   to ``np.ndarray
-0000ff60: 6060 206c 696b 650d 0a20 2020 2020 2020  `` like..       
-0000ff70: 2020 2020 2060 6061 7272 5b61 6e67 6c65       ``arr[angle
-0000ff80: 5f6f 7264 6572 5d60 6020 746f 2073 6f72  _order]`` to sor
-0000ff90: 7420 6974 2e20 466f 7220 6578 616d 706c  t it. For exampl
-0000ffa0: 652c 2069 6620 6120 7069 7865 6c20 756e  e, if a pixel un
-0000ffb0: 6974 2072 6563 6569 7665 7320 0d0a 2020  it receives ..  
-0000ffc0: 2020 2020 2020 2020 2020 706f 6c61 7269            polari
-0000ffd0: 7a65 6420 6c69 6768 7420 6c69 6b65 2062  zed light like b
-0000ffe0: 656c 6f77 3a0d 0a20 2020 2020 2020 2020  elow:..         
-0000fff0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-00010000: 2020 2020 202e 2e20 636f 6465 2d62 6c6f       .. code-blo
-00010010: 636b 3a3a 0d0a 2020 2020 2020 2020 2020  ck::..          
-00010020: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00010030: 2020 2020 2020 2020 5b30 5d20 5b31 5d20          [0] [1] 
-00010040: 2020 205b 2039 305d 205b 2034 355d 2020     [ 90] [ 45]  
-00010050: 2020 5b7c 5d20 5b2f 5d0d 0a20 2020 2020    [|] [/]..     
-00010060: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00010070: 325d 205b 335d 202d 3e20 5b31 3335 5d20  2] [3] -> [135] 
-00010080: 5b20 2030 5d20 6f72 205b 5c5d 205b 2d5d  [  0] or [\] [-]
-00010090: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000100a0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-000100b0: 7468 656e 2060 6061 6e67 6c65 5f6f 7264  then ``angle_ord
-000100c0: 6572 6060 2073 686f 756c 6420 6265 205b  er`` should be [
-000100d0: 322c 2031 2c20 302c 2033 5d2e 0d0a 2020  2, 1, 0, 3]...  
-000100e0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000100f0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-00010100: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-00010110: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-00010120: 2020 2020 2020 2020 2020 2020 4178 6973              Axis
-00010130: 2022 6122 2069 7320 6164 6465 6420 696e   "a" is added in
-00010140: 2074 6865 2066 6972 7374 2064 696d 656e   the first dimen
-00010150: 7369 6f6e 2e20 466f 7220 6578 616d 706c  sion. For exampl
-00010160: 652c 2049 6620 696e 7075 7420 6973 0d0a  e, If input is..
-00010170: 2020 2020 2020 2020 2020 2020 2274 7978              "tyx
-00010180: 222d 6178 6573 2c20 7468 656e 206f 7574  "-axes, then out
-00010190: 7075 7420 7769 6c6c 2062 6520 2261 7479  put will be "aty
-000101a0: 7822 2d61 7865 732e 0d0a 2020 2020 2020  x"-axes...      
-000101b0: 2020 0d0a 2020 2020 2020 2020 4578 616d    ..        Exam
-000101c0: 706c 6573 0d0a 2020 2020 2020 2020 2d2d  ples..        --
-000101d0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-000101e0: 4578 7472 6163 7420 706f 6c61 7269 7a61  Extract polariza
-000101f0: 7469 6f6e 2069 6e20 302d 2c20 3435 2d2c  tion in 0-, 45-,
-00010200: 2039 302d 2061 6e64 2031 3335 2d64 6567   90- and 135-deg
-00010210: 7265 6520 6469 7265 6374 696f 6e73 2066  ree directions f
-00010220: 726f 6d20 616e 200d 0a20 2020 2020 2020  rom an ..       
-00010230: 2069 6d61 6765 2074 6861 7420 6973 2061   image that is a
-00010240: 6371 7569 7265 6420 6672 6f6d 2061 2070  cquired from a p
-00010250: 6f6c 6172 697a 6174 696f 6e20 6361 6d65  olarization came
-00010260: 7261 2c20 616e 6420 6361 6c63 756c 6174  ra, and calculat
-00010270: 6520 746f 7461 6c20 0d0a 2020 2020 2020  e total ..      
-00010280: 2020 696e 7465 6e73 6974 7920 6f66 206c    intensity of l
-00010290: 6967 6874 2062 7920 6176 6572 6167 696e  ight by averagin
-000102a0: 672e 0d0a 2020 2020 2020 2020 0d0a 2020  g...        ..  
-000102b0: 2020 2020 2020 2020 2020 3e3e 3e20 696d            >>> im
-000102c0: 675f 706f 6c20 3d20 696d 672e 7370 6c69  g_pol = img.spli
-000102d0: 745f 7069 7865 6c5f 756e 6974 2829 0d0a  t_pixel_unit()..
-000102e0: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
-000102f0: 696d 675f 746f 7461 6c20 3d20 696d 675f  img_total = img_
-00010300: 706f 6c2e 7072 6f6a 2861 7869 733d 2261  pol.proj(axis="a
-00010310: 2229 0d0a 2020 2020 2020 2020 2222 2220  ")..        """ 
-00010320: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00010330: 2079 632c 2078 6320 3d20 6365 6e74 6572   yc, xc = center
-00010340: 0d0a 2020 2020 2020 2020 6966 2061 6e67  ..        if ang
-00010350: 6c65 5f6f 7264 6572 2069 7320 4e6f 6e65  le_order is None
-00010360: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
-00010370: 6e67 6c65 5f6f 7264 6572 203d 205b 322c  ngle_order = [2,
-00010380: 2031 2c20 302c 2033 5d0d 0a20 2020 2020   1, 0, 3]..     
-00010390: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000103a0: 2069 6620 6e6f 7420 7365 6c66 2e73 6861   if not self.sha
-000103b0: 7065 2e78 2025 2032 203d 3d20 7365 6c66  pe.x % 2 == self
-000103c0: 2e73 6861 7065 2e79 2025 2032 203d 3d20  .shape.y % 2 == 
-000103d0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000103e0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000103f0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00010400: 2020 2066 2249 6d61 6765 2070 6978 656c     f"Image pixel
-00010410: 2073 697a 6573 206d 7573 7420 6265 2065   sizes must be e
-00010420: 7665 6e20 6e75 6d62 6572 732c 2067 6f74  ven numbers, got
-00010430: 207b 7365 6c66 2e73 697a 6573 6f66 2827   {self.sizesof('
-00010440: 7978 2729 7d22 0d0a 2020 2020 2020 2020  yx')}"..        
-00010450: 2020 2020 290d 0a20 2020 2020 2020 2069      )..        i
-00010460: 6d67 733a 206c 6973 745b 496d 6741 7272  mgs: list[ImgArr
-00010470: 6179 5d20 3d20 5b5d 0d0a 2020 2020 2020  ay] = []..      
-00010480: 2020 666d 7420 3d20 736c 6963 6572 2e67    fmt = slicer.g
-00010490: 6574 5f66 6f72 6d61 7474 6572 285b 2279  et_formatter(["y
-000104a0: 222c 2022 7822 5d29 0d0a 2020 2020 2020  ", "x"])..      
-000104b0: 2020 666f 7220 792c 2078 2069 6e20 5b28    for y, x in [(
-000104c0: 302c 2030 292c 2028 302c 2031 292c 2028  0, 0), (0, 1), (
-000104d0: 312c 2031 292c 2028 312c 2030 295d 3a0d  1, 1), (1, 0)]:.
-000104e0: 0a20 2020 2020 2020 2020 2020 2064 7220  .            dr 
-000104f0: 3d20 5b28 7963 202d 2079 292f 322c 2028  = [(yc - y)/2, (
-00010500: 7863 202d 2078 292f 325d 0d0a 2020 2020  xc - x)/2]..    
-00010510: 2020 2020 2020 2020 696d 6773 2e61 7070          imgs.app
-00010520: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
-00010530: 2020 2020 2020 7365 6c66 5b66 6d74 5b79        self[fmt[y
-00010540: 3a3a 322c 2078 3a3a 325d 5d2e 6166 6669  ::2, x::2]].affi
-00010550: 6e65 280d 0a20 2020 2020 2020 2020 2020  ne(..           
-00010560: 2020 2020 2020 2020 2074 7261 6e73 6c61           transla
-00010570: 7469 6f6e 3d64 722c 206f 7264 6572 3d6f  tion=dr, order=o
-00010580: 7264 6572 2c20 6469 6d73 3d22 7978 220d  rder, dims="yx".
-00010590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000105a0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-000105b0: 290d 0a20 2020 2020 2020 206f 7574 3a20  )..        out: 
-000105c0: 496d 6741 7272 6179 203d 206e 702e 7374  ImgArray = np.st
-000105d0: 6163 6b28 696d 6773 2c20 6178 6973 3d6e  ack(imgs, axis=n
-000105e0: 6577 6178 6973 290d 0a20 2020 2020 2020  ewaxis)..       
-000105f0: 2069 6620 6f75 742e 6c61 6265 6c73 2069   if out.labels i
-00010600: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00010610: 2020 2020 2020 2020 2064 656c 206f 7574           del out
-00010620: 2e6c 6162 656c 730d 0a20 2020 2020 2020  .labels..       
-00010630: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00010640: 726e 280d 0a20 2020 2020 2020 2020 2020  rn(..           
-00010650: 2020 2020 2022 4f75 7470 7574 2069 6d61       "Output ima
-00010660: 6765 206c 6162 656c 7320 6172 6520 6465  ge labels are de
-00010670: 6c65 7465 6420 6265 6361 7573 6520 6974  leted because it
-00010680: 2069 7320 696e 636f 6d70 6174 6962 6c65   is incompatible
-00010690: 2077 6974 6820 220d 0a20 2020 2020 2020   with "..       
-000106a0: 2020 2020 2020 2020 2022 7370 6c69 745f           "split_
-000106b0: 7069 7865 6c5f 756e 6974 222c 0d0a 2020  pixel_unit",..  
-000106c0: 2020 2020 2020 2020 2020 2020 2020 5573                Us
-000106d0: 6572 5761 726e 696e 672c 0d0a 2020 2020  erWarning,..    
-000106e0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000106f0: 2020 206f 7574 203d 206f 7574 5b66 227b     out = out[f"{
-00010700: 6e65 7761 7869 737d 3d7b 7374 7228 616e  newaxis}={str(an
-00010710: 676c 655f 6f72 6465 7229 5b31 3a2d 315d  gle_order)[1:-1]
-00010720: 7d22 5d0d 0a20 2020 2020 2020 206f 7574  }"]..        out
-00010730: 2e5f 7365 745f 696e 666f 2873 656c 662c  ._set_info(self,
-00010740: 206e 6577 5f61 7865 733d 6f75 742e 6178   new_axes=out.ax
-00010750: 6573 290d 0a20 2020 2020 2020 206f 7574  es)..        out
-00010760: 2e73 6574 5f73 6361 6c65 2879 3d73 656c  .set_scale(y=sel
-00010770: 662e 7363 616c 652e 792a 322c 2078 3d73  f.scale.y*2, x=s
-00010780: 656c 662e 7363 616c 652e 782a 3229 0d0a  elf.scale.x*2)..
-00010790: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-000107a0: 7574 0d0a 2020 2020 2020 2020 0d0a 2020  ut..        ..  
-000107b0: 2020 6465 6620 7374 6f6b 6573 2873 656c    def stokes(sel
-000107c0: 662c 202a 2c20 616c 6f6e 673a 2041 7869  f, *, along: Axi
-000107d0: 734c 696b 6520 3d20 2261 2229 202d 3e20  sLike = "a") -> 
-000107e0: 6469 6374 3a0d 0a20 2020 2020 2020 2022  dict:..        "
-000107f0: 2222 0d0a 2020 2020 2020 2020 4765 6e65  ""..        Gene
-00010800: 7261 7465 2073 746f 636b 7320 696d 6167  rate stocks imag
-00010810: 6573 2066 726f 6d20 616e 2069 6d61 6765  es from an image
-00010820: 2073 7461 636b 2077 6974 6820 706f 6c61   stack with pola
-00010830: 7269 7a65 6420 696d 6167 6573 2e20 0d0a  rized images. ..
-00010840: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00010850: 2020 4375 7272 656e 746c 792c 2044 6567    Currently, Deg
-00010860: 7265 6520 6f66 204c 696e 6561 7220 506f  ree of Linear Po
-00010870: 6c61 7269 7a61 7469 6f6e 2028 446f 4c50  larization (DoLP
-00010880: 2920 616e 6420 416e 676c 6520 6f66 200d  ) and Angle of .
-00010890: 0a20 2020 2020 2020 2050 6f6c 6172 697a  .        Polariz
-000108a0: 6174 696f 6e20 2841 6f50 2920 7769 6c6c  ation (AoP) will
-000108b0: 2062 6520 6361 6c63 756c 6174 6564 2e20   be calculated. 
-000108c0: 5468 6f73 6520 6972 7265 6775 6c61 7220  Those irregular 
-000108d0: 7661 6c75 6573 200d 0a20 2020 2020 2020  values ..       
-000108e0: 2028 6e70 2e6e 616e 2c20 6e70 2e69 6e66   (np.nan, np.inf
-000108f0: 2920 7769 6c6c 2062 6520 7265 706c 6163  ) will be replac
-00010900: 6564 2077 6974 6820 302e 2042 6520 7375  ed with 0. Be su
-00010910: 7265 2074 6861 7420 746f 2063 616c 6375  re that to calcu
-00010920: 6c61 7465 0d0a 2020 2020 2020 2020 446f  late..        Do
-00010930: 504c 2063 6f72 7265 6374 6c79 2062 6163  PL correctly bac
-00010940: 6b67 726f 756e 6420 7375 6274 7261 6374  kground subtract
-00010950: 696f 6e20 6d75 7374 2062 6520 6170 706c  ion must be appl
-00010960: 6965 6420 6265 666f 7265 6861 6e64 2062  ied beforehand b
-00010970: 6563 6175 7365 200d 0a20 2020 2020 2020  ecause ..       
-00010980: 2073 746f 6b65 7320 7061 7261 6d65 7465   stokes paramete
-00010990: 7220 6060 7330 6060 2069 7320 6166 6665  r ``s0`` is affe
-000109a0: 6374 6564 2062 7920 6162 736f 6c75 7465  cted by absolute
-000109b0: 2069 6e74 656e 7369 7469 6573 2e0d 0a0d   intensities....
-000109c0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-000109d0: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-000109e0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-000109f0: 2061 6c6f 6e67 203a 2041 7869 734c 696b   along : AxisLik
-00010a00: 652c 2064 6566 6175 6c74 2069 7320 2261  e, default is "a
-00010a10: 220d 0a20 2020 2020 2020 2020 2020 2054  "..            T
-00010a20: 6f20 6465 6669 6e65 2077 6869 6368 2061  o define which a
-00010a30: 7869 7320 6973 2070 6f6c 6172 697a 6174  xis is polarizat
-00010a40: 696f 6e20 616e 676c 6520 6178 6973 2e20  ion angle axis. 
-00010a50: 416c 6f6e 6720 7468 6973 2061 7869 7320  Along this axis 
-00010a60: 0d0a 2020 2020 2020 2020 2020 2020 7468  ..            th
-00010a70: 6520 616e 676c 6520 6f66 2070 6f6c 6172  e angle of polar
-00010a80: 697a 6572 206d 7573 7420 6265 2069 6e20  izer must be in 
-00010a90: 6f72 6465 7220 6f66 2030 2c20 3435 2c20  order of 0, 45, 
-00010aa0: 3930 2c20 3133 3520 6465 6772 6565 2e0d  90, 135 degree..
-00010ab0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00010ac0: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
-00010ad0: 2d2d 2d0d 0a20 2020 2020 2020 2064 6963  ---..        dic
-00010ae0: 740d 0a20 2020 2020 2020 2020 2020 2044  t..            D
-00010af0: 6963 7469 6f6e 616c 7920 7769 7468 206b  ictionaly with k
-00010b00: 6579 7320 2264 6f6c 7022 2061 6e64 2022  eys "dolp" and "
-00010b10: 616f 7022 2c20 7768 6963 6820 636f 7272  aop", which corr
-00010b20: 6573 706f 6e64 2074 6f20 446f 504c 2061  espond to DoPL a
-00010b30: 6e64 200d 0a20 2020 2020 2020 2020 2020  nd ..           
-00010b40: 2041 6f50 2072 6573 7065 6374 6976 656c   AoP respectivel
-00010b50: 792e 0d0a 2020 2020 2020 2020 0d0a 2020  y...        ..  
-00010b60: 2020 2020 2020 4578 616d 706c 6573 0d0a        Examples..
-00010b70: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00010b80: 0d0a 2020 2020 2020 2020 4361 6c63 756c  ..        Calcul
-00010b90: 6174 6520 416f 5020 696d 6167 6520 6672  ate AoP image fr
-00010ba0: 6f6d 2074 6865 2072 6177 2069 6d61 6765  om the raw image
-00010bb0: 2061 6e64 2064 6973 706c 6179 2074 6865   and display the
-00010bc0: 6d2e 0d0a 2020 2020 2020 2020 0d0a 2020  m...        ..  
-00010bd0: 2020 2020 2020 2020 2020 3e3e 3e20 696d            >>> im
-00010be0: 675f 706f 6c20 3d20 696d 672e 7370 6c69  g_pol = img.spli
-00010bf0: 745f 706f 6c61 7269 7a61 7469 6f6e 2829  t_polarization()
-00010c00: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-00010c10: 3e20 6470 6f6c 203d 2069 6d67 5f70 6f6c  > dpol = img_pol
-00010c20: 2e73 746f 6b65 7328 290d 0a20 2020 2020  .stokes()..     
-00010c30: 2020 2020 2020 203e 3e3e 2069 702e 6775         >>> ip.gu
-00010c40: 692e 6164 6428 696d 675f 706f 6c2e 7072  i.add(img_pol.pr
-00010c50: 6f6a 2829 290d 0a20 2020 2020 2020 2020  oj())..         
-00010c60: 2020 203e 3e3e 2069 702e 6775 692e 6164     >>> ip.gui.ad
-00010c70: 6428 6470 6f6c 2e61 6f70 2e72 6164 3264  d(dpol.aop.rad2d
-00010c80: 6567 2829 290d 0a20 2020 2020 2020 200d  eg())..        .
-00010c90: 0a20 2020 2020 2020 2052 6566 6572 656e  .        Referen
-00010ca0: 6365 730d 0a20 2020 2020 2020 202d 2d2d  ces..        ---
-00010cb0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-00010cc0: 202d 2068 7474 7073 3a2f 2f6d 6176 6963   - https://mavic
-00010cd0: 2e6e 652e 6a70 2f69 6e64 7574 7269 616c  .ne.jp/indutrial
-00010ce0: 6361 6d65 7261 2d70 6f6c 6172 697a 6174  camera-polarizat
-00010cf0: 696f 6e2d 696e 6c69 6e65 2f0d 0a20 2020  ion-inline/..   
-00010d00: 2020 2020 202d 2059 616e 672c 204a 2e2c       - Yang, J.,
-00010d10: 2051 6975 2c20 532e 2c20 4a69 6e2c 2057   Qiu, S., Jin, W
-00010d20: 2e2c 2057 616e 672c 2058 2e2c 2026 2058  ., Wang, X., & X
-00010d30: 7565 2c20 462e 2028 3230 3230 292e 2050  ue, F. (2020). P
-00010d40: 6f6c 6172 697a 6174 696f 6e20 696d 6167  olarization imag
-00010d50: 696e 6720 6d6f 6465 6c20 636f 6e73 6964  ing model consid
-00010d60: 6572 696e 6720 7468 6520 0d0a 2020 2020  ering the ..    
-00010d70: 2020 2020 2020 6e6f 6e2d 6964 6561 6c69        non-ideali
-00010d80: 7479 206f 6620 706f 6c61 7269 7a65 7273  ty of polarizers
-00010d90: 2e20 4170 706c 6965 6420 6f70 7469 6373  . Applied optics
-00010da0: 2c20 3539 2832 292c 2033 3036 2d33 3134  , 59(2), 306-314
-00010db0: 2e0d 0a20 2020 2020 2020 202d 2046 656e  ...        - Fen
-00010dc0: 672c 2042 2e2c 2047 756f 2c20 522e 2c20  g, B., Guo, R., 
-00010dd0: 5a68 616e 672c 2046 2e2c 205a 6861 6f2c  Zhang, F., Zhao,
-00010de0: 2046 2e2c 2026 2044 6f6e 672c 2059 2e20   F., & Dong, Y. 
-00010df0: 2832 3032 3129 2e20 4361 6c63 756c 6174  (2021). Calculat
-00010e00: 696f 6e20 616e 6420 6875 6520 6d61 7070  ion and hue mapp
-00010e10: 696e 6720 6f66 2041 6f50 2069 6e20 0d0a  ing of AoP in ..
-00010e20: 2020 2020 2020 2020 2020 706f 6c61 7269            polari
-00010e30: 7a61 7469 6f6e 2069 6d61 6769 6e67 2e20  zation imaging. 
-00010e40: 4d61 792e 2068 7474 7073 3a2f 2f64 6f69  May. https://doi
-00010e50: 2e6f 7267 2f31 302e 3131 3137 2f31 322e  .org/10.1117/12.
-00010e60: 3235 3233 3634 330d 0a20 2020 2020 2020  2523643..       
-00010e70: 2022 2222 0d0a 2020 2020 2020 2020 6e65   """..        ne
-00010e80: 775f 6178 6573 203d 2063 6f6d 706c 656d  w_axes = complem
-00010e90: 656e 745f 6178 6573 2861 6c6f 6e67 2c20  ent_axes(along, 
-00010ea0: 7365 6c66 2e61 7865 7329 0d0a 2020 2020  self.axes)..    
-00010eb0: 2020 2020 696d 6730 2c20 696d 6734 352c      img0, img45,
-00010ec0: 2069 6d67 3930 2c20 696d 6731 3335 203d   img90, img135 =
-00010ed0: 205b 612e 6173 5f66 6c6f 6174 2829 2e76   [a.as_float().v
-00010ee0: 616c 7565 2066 6f72 2061 2069 6e20 7365  alue for a in se
-00010ef0: 6c66 2e73 706c 6974 2861 6c6f 6e67 295d  lf.split(along)]
-00010f00: 0d0a 2020 2020 2020 2020 2320 5374 6f6b  ..        # Stok
-00010f10: 6573 2070 6172 616d 6574 6572 730d 0a20  es parameters.. 
-00010f20: 2020 2020 2020 2073 3020 3d20 2869 6d67         s0 = (img
-00010f30: 3020 2b20 696d 6734 3520 2b20 696d 6739  0 + img45 + img9
-00010f40: 3020 2b20 696d 6731 3335 292f 320d 0a20  0 + img135)/2.. 
-00010f50: 2020 2020 2020 2073 3120 3d20 696d 6730         s1 = img0
-00010f60: 202d 2069 6d67 3930 0d0a 2020 2020 2020   - img90..      
-00010f70: 2020 7332 203d 2069 6d67 3435 202d 2069    s2 = img45 - i
-00010f80: 6d67 3133 350d 0a20 2020 2020 2020 200d  mg135..        .
-00010f90: 0a20 2020 2020 2020 2023 2044 6567 7265  .        # Degre
-00010fa0: 6520 6f66 204c 696e 6561 7220 506f 6c61  e of Linear Pola
-00010fb0: 7269 7a61 7469 6f6e 2028 446f 4c50 290d  rization (DoLP).
-00010fc0: 0a20 2020 2020 2020 2023 2044 6f4c 5020  .        # DoLP 
-00010fd0: 6973 2064 6566 696e 6564 2061 733a 0d0a  is defined as:..
-00010fe0: 2020 2020 2020 2020 2320 446f 4c50 203d          # DoLP =
-00010ff0: 2073 7172 7428 7331 5e32 202b 2073 325e   sqrt(s1^2 + s2^
-00011000: 3229 2f73 300d 0a20 2020 2020 2020 2073  2)/s0..        s
-00011010: 305b 7330 3d3d 305d 203d 206e 702e 696e  0[s0==0] = np.in
-00011020: 660d 0a20 2020 2020 2020 2064 6f6c 703a  f..        dolp:
-00011030: 2049 6d67 4172 7261 7920 3d20 6e70 2e73   ImgArray = np.s
-00011040: 7172 7428 7331 2a2a 3220 2b20 7332 2a2a  qrt(s1**2 + s2**
-00011050: 3229 202f 2073 300d 0a20 2020 2020 2020  2) / s0..       
-00011060: 2064 6f6c 7020 3d20 646f 6c70 2e76 6965   dolp = dolp.vie
-00011070: 7728 7365 6c66 2e5f 5f63 6c61 7373 5f5f  w(self.__class__
-00011080: 290d 0a20 2020 2020 2020 2064 6f6c 702e  )..        dolp.
-00011090: 5f73 6574 5f69 6e66 6f28 7365 6c66 2c20  _set_info(self, 
-000110a0: 6e65 775f 6178 6573 3d6e 6577 5f61 7865  new_axes=new_axe
-000110b0: 7329 0d0a 2020 2020 2020 2020 646f 6c70  s)..        dolp
-000110c0: 2e73 6574 5f73 6361 6c65 2873 656c 6629  .set_scale(self)
-000110d0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000110e0: 2020 2020 2320 416e 676c 6520 6f66 2050      # Angle of P
-000110f0: 6f6c 6172 697a 6174 696f 6e20 2841 6f50  olarization (AoP
-00011100: 290d 0a20 2020 2020 2020 2023 2041 6f50  )..        # AoP
-00011110: 2069 7320 7573 7561 6c6c 7920 6361 6c63   is usually calc
-00011120: 756c 6174 6564 2061 7320 7073 6920 3d20  ulated as psi = 
-00011130: 312f 3261 7267 7461 6e28 7331 2f73 3229  1/2argtan(s1/s2)
-00011140: 2c20 6275 7420 7468 6973 2069 7320 7772  , but this is wr
-00011150: 6f6e 6720 6265 6361 7573 6520 0d0a 2020  ong because ..  
-00011160: 2020 2020 2020 2320 6c65 6674 2073 6964        # left sid
-00011170: 6520 6861 7320 7261 6e67 6520 6f66 205b  e has range of [
-00011180: 302c 2070 6929 2077 6869 6c65 2072 6967  0, pi) while rig
-00011190: 6874 2073 6964 6520 6861 7320 7261 6e67  ht side has rang
-000111a0: 6520 6f66 205b 2d70 692f 342c 2070 692f  e of [-pi/4, pi/
-000111b0: 3429 2e20 5468 650d 0a20 2020 2020 2020  4). The..       
-000111c0: 2023 2063 6f72 7265 6374 2066 6f72 6d75   # correct formu
-000111d0: 6c61 7469 6f6e 2069 733a 0d0a 2020 2020  lation is:..    
-000111e0: 2020 2020 2320 2020 2020 2020 7b20 312f      #       { 1/
-000111f0: 3261 7267 7461 6e28 7332 2f73 3129 2020  2argtan(s2/s1)  
-00011200: 2020 2020 2020 2020 2873 313e 3020 616e          (s1>0 an
-00011210: 6420 7332 3e30 290d 0a20 2020 2020 2020  d s2>0)..       
-00011220: 2023 2041 6f50 203d 207b 2031 2f32 6172   # AoP = { 1/2ar
-00011230: 6774 616e 2873 322f 7331 2920 2b20 7069  gtan(s2/s1) + pi
-00011240: 2f32 2020 2028 7331 3c30 290d 0a20 2020  /2   (s1<0)..   
-00011250: 2020 2020 2023 2020 2020 2020 207b 2031       #       { 1
-00011260: 2f32 6172 6774 616e 2873 322f 7331 2920  /2argtan(s2/s1) 
-00011270: 2b20 7069 2020 2020 2028 7331 3e30 2061  + pi     (s1>0 a
-00011280: 6e64 2073 323c 3029 0d0a 2020 2020 2020  nd s2<0)..      
-00011290: 2020 2320 4275 7420 6865 7265 2c20 6e70    # But here, np
-000112a0: 2e61 7263 7461 6e32 2063 616e 2064 6574  .arctan2 can det
-000112b0: 6563 7420 7468 6520 7369 676e 7320 6f66  ect the signs of
-000112c0: 2069 6e70 7574 7320 7331 2061 6e64 2073   inputs s1 and s
-000112d0: 322c 2073 6f20 7468 6174 2069 7420 7265  2, so that it re
-000112e0: 7475 726e 7320 0d0a 2020 2020 2020 2020  turns ..        
-000112f0: 2320 636f 7272 6563 7420 7661 6c75 6573  # correct values
-00011300: 2e0d 0a20 2020 2020 2020 2061 6f70 203d  ...        aop =
-00011310: 206e 702e 6172 6374 616e 3228 7332 2c20   np.arctan2(s2, 
-00011320: 7331 292f 320d 0a20 2020 2020 2020 2061  s1)/2..        a
-00011330: 6f70 3a20 5068 6173 6541 7272 6179 203d  op: PhaseArray =
-00011340: 2061 6f70 2e76 6965 7728 5068 6173 6541   aop.view(PhaseA
-00011350: 7272 6179 290d 0a20 2020 2020 2020 2061  rray)..        a
-00011360: 6f70 2e5f 7365 745f 696e 666f 2873 656c  op._set_info(sel
-00011370: 662c 206e 6577 5f61 7865 733d 6e65 775f  f, new_axes=new_
-00011380: 6178 6573 290d 0a20 2020 2020 2020 2061  axes)..        a
-00011390: 6f70 2e75 6e69 7420 3d20 2272 6164 220d  op.unit = "rad".
-000113a0: 0a20 2020 2020 2020 2061 6f70 2e62 6f72  .        aop.bor
-000113b0: 6465 7220 3d20 282d 6e70 2e70 692f 322c  der = (-np.pi/2,
-000113c0: 206e 702e 7069 2f32 290d 0a20 2020 2020   np.pi/2)..     
-000113d0: 2020 2061 6f70 2e5f 6669 785f 626f 7264     aop._fix_bord
-000113e0: 6572 2829 0d0a 2020 2020 2020 2020 616f  er()..        ao
-000113f0: 702e 7365 745f 7363 616c 6528 7365 6c66  p.set_scale(self
-00011400: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-00011410: 2020 2020 206f 7574 203d 2064 6963 7428       out = dict(
-00011420: 646f 6c70 3d64 6f6c 702c 2061 6f70 3d61  dolp=dolp, aop=a
-00011430: 6f70 290d 0a20 2020 2020 2020 2072 6574  op)..        ret
-00011440: 7572 6e20 6f75 740d 0a20 2020 200d 0a20  urn out..    .. 
-00011450: 2020 2040 5f64 6f63 732e 7772 6974 655f     @_docs.write_
-00011460: 646f 6373 0d0a 2020 2020 4064 696d 735f  docs..    @dims_
-00011470: 746f 5f73 7061 7469 616c 5f61 7865 730d  to_spatial_axes.
-00011480: 0a20 2020 2040 7361 6d65 5f64 7479 7065  .    @same_dtype
-00011490: 2861 7366 6c6f 6174 3d54 7275 6529 0d0a  (asfloat=True)..
-000114a0: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
-000114b0: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
-000114c0: 2064 6566 2069 6e70 6169 6e74 280d 0a20   def inpaint(.. 
-000114d0: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
-000114e0: 2020 2020 2020 6d61 736b 3a20 6e70 2e6e        mask: np.n
-000114f0: 6461 7272 6179 2c0d 0a20 2020 2020 2020  darray,..       
-00011500: 202a 2c0d 0a20 2020 2020 2020 206d 6574   *,..        met
-00011510: 686f 643a 204c 6974 6572 616c 5b22 6d65  hod: Literal["me
-00011520: 616e 222c 2022 6269 6861 726d 6f6e 6963  an", "biharmonic
-00011530: 225d 203d 2262 6968 6172 6d6f 6e69 6322  "] ="biharmonic"
-00011540: 2c0d 0a20 2020 2020 2020 2064 696d 733a  ,..        dims:
-00011550: 2044 696d 7320 3d20 4e6f 6e65 2c0d 0a20   Dims = None,.. 
-00011560: 2020 2020 2020 2075 7064 6174 653a 2062         update: b
-00011570: 6f6f 6c20 3d20 4661 6c73 652c 0d0a 2020  ool = False,..  
-00011580: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
-00011590: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000115a0: 2020 2020 2020 2049 6d61 6765 2069 6e70         Image inp
-000115b0: 6169 6e74 696e 672e 0d0a 0d0a 2020 2020  ainting.....    
-000115c0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-000115d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000115e0: 2d2d 0d0a 2020 2020 2020 2020 6d61 736b  --..        mask
-000115f0: 203a 206e 702e 6e64 6172 7261 790d 0a20   : np.ndarray.. 
-00011600: 2020 2020 2020 2020 2020 204d 6173 6b20             Mask 
-00011610: 696d 6167 652e 2054 6865 2054 7275 6520  image. The True 
-00011620: 7265 6769 6f6e 2077 696c 6c20 6265 2069  region will be i
-00011630: 6e70 6169 6e74 6564 2e0d 0a20 2020 2020  npainted...     
-00011640: 2020 206d 6574 686f 6420 3a20 226d 6561     method : "mea
-00011650: 6e22 206f 7220 2262 6968 6172 6d6f 6e69  n" or "biharmoni
-00011660: 6322 2c20 6465 6661 756c 7420 6973 2022  c", default is "
-00011670: 6269 6861 726d 6f6e 6963 220d 0a20 2020  biharmonic"..   
-00011680: 2020 2020 2020 2020 2049 6e70 6169 6e74           Inpaint
-00011690: 696e 6720 6d65 7468 6f64 2e0d 0a20 2020  ing method...   
-000116a0: 2020 2020 207b 6469 6d73 7d7b 7570 6461       {dims}{upda
-000116b0: 7465 7d0d 0a0d 0a20 2020 2020 2020 2052  te}....        R
-000116c0: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-000116d0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-000116e0: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
-000116f0: 2020 2020 2020 2049 6e70 6169 6e74 6564         Inpainted
-00011700: 2069 6d61 6765 206f 6620 7361 6d65 2064   image of same d
-00011710: 6174 6120 7479 7065 2e0d 0a20 2020 2020  ata type...     
-00011720: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00011730: 6966 206d 6574 686f 6420 3d3d 2022 6269  if method == "bi
-00011740: 6861 726d 6f6e 6963 223a 0d0a 2020 2020  harmonic":..    
-00011750: 2020 2020 2020 2020 6675 6e63 203d 2073          func = s
-00011760: 6b72 6573 2e69 6e70 6169 6e74 2e69 6e70  kres.inpaint.inp
-00011770: 6169 6e74 5f62 6968 6172 6d6f 6e69 630d  aint_biharmonic.
-00011780: 0a20 2020 2020 2020 2065 6c69 6620 6d65  .        elif me
-00011790: 7468 6f64 203d 3d20 226d 6561 6e22 3a0d  thod == "mean":.
-000117a0: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
-000117b0: 6320 3d20 5f6d 6973 632e 696e 7061 696e  c = _misc.inpain
-000117c0: 745f 6d65 616e 0d0a 2020 2020 2020 2020  t_mean..        
-000117d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-000117e0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000117f0: 726f 7228 6622 556e 6b6e 6f77 6e20 6d65  ror(f"Unknown me
-00011800: 7468 6f64 3a20 7b6d 6574 686f 647d 2229  thod: {method}")
-00011810: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00011820: 2073 656c 662e 5f61 7070 6c79 5f64 6173   self._apply_das
-00011830: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
-00011840: 6675 6e63 2c20 0d0a 2020 2020 2020 2020  func, ..        
-00011850: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
-00011860: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
-00011870: 2073 656c 662e 6178 6573 292c 0d0a 2020   self.axes),..  
-00011880: 2020 2020 2020 2020 2020 6172 6773 3d28            args=(
-00011890: 6d61 736b 2c29 2c0d 0a20 2020 2020 2020  mask,),..       
-000118a0: 2029 0d0a 0d0a 2020 2020 405f 646f 6373   )....    @_docs
-000118b0: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
-000118c0: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
-000118d0: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
-000118e0: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
-000118f0: 7075 740d 0a20 2020 2064 6566 2070 6561  put..    def pea
-00011900: 6b5f 6c6f 6361 6c5f 6d61 7828 0d0a 2020  k_local_max(..  
-00011910: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
-00011920: 2020 2020 202a 2c20 0d0a 2020 2020 2020       *, ..      
-00011930: 2020 6d69 6e5f 6469 7374 616e 6365 3a20    min_distance: 
-00011940: 666c 6f61 7420 3d20 312e 302c 0d0a 2020  float = 1.0,..  
-00011950: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
-00011960: 3a20 666c 6f61 7420 7c20 4e6f 6e65 203d  : float | None =
-00011970: 204e 6f6e 652c 200d 0a20 2020 2020 2020   None, ..       
-00011980: 2074 6f70 6e3a 2069 6e74 203d 206e 702e   topn: int = np.
-00011990: 696e 662c 0d0a 2020 2020 2020 2020 746f  inf,..        to
-000119a0: 706e 5f70 6572 5f6c 6162 656c 3a20 696e  pn_per_label: in
-000119b0: 7420 3d20 6e70 2e69 6e66 2c0d 0a20 2020  t = np.inf,..   
-000119c0: 2020 2020 2065 7863 6c75 6465 5f62 6f72       exclude_bor
-000119d0: 6465 723a 2062 6f6f 6c20 3d54 7275 652c  der: bool =True,
-000119e0: 0d0a 2020 2020 2020 2020 7573 655f 6c61  ..        use_la
-000119f0: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
-00011a00: 652c 0d0a 2020 2020 2020 2020 6469 6d73  e,..        dims
-00011a10: 3a20 4469 6d73 203d 204e 6f6e 650d 0a20  : Dims = None.. 
-00011a20: 2020 2029 202d 3e20 4d61 726b 6572 4672     ) -> MarkerFr
-00011a30: 616d 653a 0d0a 2020 2020 2020 2020 2222  ame:..        ""
-00011a40: 220d 0a20 2020 2020 2020 2046 696e 6420  "..        Find 
-00011a50: 6c6f 6361 6c20 6d61 7869 6d61 2e20 5468  local maxima. Th
-00011a60: 6973 2061 6c67 6f72 6974 686d 2063 6f72  is algorithm cor
-00011a70: 7265 7370 6f6e 6473 2074 6f20 496d 6167  responds to Imag
-00011a80: 654a 2773 2027 4669 6e64 204d 6178 696d  eJ's 'Find Maxim
-00011a90: 6127 2062 7574 2069 7320 6d6f 7265 2066  a' but is more f
-00011aa0: 6c65 7869 626c 652e 0d0a 0d0a 2020 2020  lexible.....    
-00011ab0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-00011ac0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00011ad0: 2d2d 0d0a 2020 2020 2020 2020 6d69 6e5f  --..        min_
-00011ae0: 6469 7374 616e 6365 203a 2066 6c6f 6174  distance : float
-00011af0: 2c20 6465 6661 756c 7420 6973 2031 2e30  , default is 1.0
-00011b00: 0d0a 2020 2020 2020 2020 2020 2020 4d69  ..            Mi
-00011b10: 6e69 6d75 6d20 6469 7374 616e 6365 2061  nimum distance a
-00011b20: 6c6c 6f77 6564 2066 6f72 2065 6163 6820  llowed for each 
-00011b30: 7477 6f20 7065 616b 732e 2054 6869 7320  two peaks. This 
-00011b40: 7061 7261 6d65 7465 7220 6973 2073 6c69  parameter is sli
-00011b50: 6768 746c 790d 0a20 2020 2020 2020 2020  ghtly..         
-00011b60: 2020 2064 6966 6665 7265 6e74 2066 726f     different fro
-00011b70: 6d20 7468 6174 2069 6e20 6060 736b 696d  m that in ``skim
-00011b80: 6167 652e 6665 6174 7572 652e 7065 616b  age.feature.peak
-00011b90: 5f6c 6f63 616c 5f6d 6178 6060 2062 6563  _local_max`` bec
-00011ba0: 6175 7365 2068 6572 6520 666c 6f61 740d  ause here float.
-00011bb0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-00011bc0: 7574 2069 7320 616c 6c6f 7765 6420 616e  ut is allowed an
-00011bd0: 6420 6576 6572 7920 7469 6d65 2066 6f6f  d every time foo
-00011be0: 7470 7269 6e74 2069 7320 6361 6c63 756c  tprint is calcul
-00011bf0: 6174 6564 2e0d 0a20 2020 2020 2020 2070  ated...        p
-00011c00: 6572 6365 6e74 696c 6520 3a20 666c 6f61  ercentile : floa
-00011c10: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
-00011c20: 2020 2020 2020 2020 2050 6572 6365 6e74           Percent
-00011c30: 696c 6520 746f 2063 6f6d 7075 7465 2061  ile to compute a
-00011c40: 6273 6f6c 7574 6520 7468 7265 7368 6f6c  bsolute threshol
-00011c50: 642e 0d0a 2020 2020 2020 2020 746f 706e  d...        topn
-00011c60: 203a 2069 6e74 2c20 6f70 7469 6f6e 616c   : int, optional
-00011c70: 0d0a 2020 2020 2020 2020 2020 2020 4d61  ..            Ma
-00011c80: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
-00011c90: 7065 616b 7320 2a2a 666f 7220 6561 6368  peaks **for each
-00011ca0: 2069 7465 7261 7469 6f6e 2a2a 2e0d 0a20   iteration**... 
-00011cb0: 2020 2020 2020 2074 6f70 6e5f 7065 725f         topn_per_
-00011cc0: 6c61 6265 6c20 3a20 696e 742c 2064 6566  label : int, def
-00011cd0: 6175 6c74 2069 7320 6e70 2e69 6e66 0d0a  ault is np.inf..
-00011ce0: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
-00011cf0: 6d75 6d20 6e75 6d62 6572 206f 6620 7065  mum number of pe
-00011d00: 616b 7320 7065 7220 6c61 6265 6c2e 0d0a  aks per label...
-00011d10: 2020 2020 2020 2020 7573 655f 6c61 6265          use_labe
-00011d20: 6c73 203a 2062 6f6f 6c2c 2064 6566 6175  ls : bool, defau
-00011d30: 6c74 2069 7320 5472 7565 0d0a 2020 2020  lt is True..    
-00011d40: 2020 2020 2020 2020 4966 2075 7365 2073          If use s
-00011d50: 656c 662e 6c61 6265 6c73 2077 6865 6e20  elf.labels when 
-00011d60: 6974 2065 7869 7374 732e 0d0a 2020 2020  it exists...    
-00011d70: 2020 2020 7b64 696d 737d 0d0a 2020 2020      {dims}..    
-00011d80: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00011d90: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00011da0: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00011db0: 2020 2020 4d61 726b 6572 4672 616d 650d      MarkerFrame.
-00011dc0: 0a20 2020 2020 2020 2020 2020 2044 6174  .            Dat
-00011dd0: 6146 7261 6d65 2077 6974 6820 636f 6c75  aFrame with colu
-00011de0: 6d6e 7320 7361 6d65 2061 7320 6178 6573  mns same as axes
-00011df0: 206f 6620 7365 6c66 2e20 466f 7220 6578   of self. For ex
-00011e00: 616d 706c 652c 2069 6620 7365 6c66 2e61  ample, if self.a
-00011e10: 7865 7320 6973 2022 7463 7978 2220 7468  xes is "tcyx" th
-00011e20: 656e 0d0a 2020 2020 2020 2020 2020 2020  en..            
-00011e30: 7265 7475 726e 2076 616c 7565 2068 6173  return value has
-00011e40: 2022 7422 2c20 2263 222c 2022 7922 2061   "t", "c", "y" a
-00011e50: 6e64 2022 7822 2063 6f6c 756d 6e73 2c20  nd "x" columns, 
-00011e60: 616e 6420 7375 622d 6672 616d 6520 6174  and sub-frame at
-00011e70: 2074 3d30 2c20 633d 3020 636f 6e74 6169   t=0, c=0 contai
-00011e80: 6e73 2061 6c6c 0d0a 2020 2020 2020 2020  ns all..        
-00011e90: 2020 2020 7468 6520 636f 6f72 6469 6e61      the coordina
-00011ea0: 7465 7320 6f66 2070 6561 6b73 2069 6e20  tes of peaks in 
-00011eb0: 7468 6520 736c 6963 6520 6174 2074 3d30  the slice at t=0
-00011ec0: 2c20 633d 302e 0d0a 2020 2020 2020 2020  , c=0...        
-00011ed0: 2222 2220 2020 2020 2020 200d 0a20 2020  """        ..   
-00011ee0: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
-00011ef0: 2073 6570 6172 6174 6520 7370 6174 6961   separate spatia
-00011f00: 6c20 6469 6d65 6e73 696f 6e73 2061 6e64  l dimensions and
-00011f10: 206f 7468 6572 730d 0a20 2020 2020 2020   others..       
-00011f20: 206e 6469 6d20 3d20 6c65 6e28 6469 6d73   ndim = len(dims
-00011f30: 290d 0a20 2020 2020 2020 2064 696d 735f  )..        dims_
-00011f40: 6c69 7374 203d 206c 6973 7428 6469 6d73  list = list(dims
-00011f50: 290d 0a20 2020 2020 2020 2063 5f61 7865  )..        c_axe
-00011f60: 7320 3d20 636f 6d70 6c65 6d65 6e74 5f61  s = complement_a
-00011f70: 7865 7328 6469 6d73 2c20 7365 6c66 2e61  xes(dims, self.a
-00011f80: 7865 7329 0d0a 2020 2020 2020 2020 635f  xes)..        c_
-00011f90: 6178 6573 5f6c 6973 7420 3d20 6c69 7374  axes_list = list
-00011fa0: 2863 5f61 7865 7329 0d0a 2020 2020 2020  (c_axes)..      
-00011fb0: 2020 0d0a 2020 2020 2020 2020 6966 2069    ..        if i
-00011fc0: 7369 6e73 7461 6e63 6528 6578 636c 7564  sinstance(exclud
-00011fd0: 655f 626f 7264 6572 2c20 626f 6f6c 293a  e_border, bool):
-00011fe0: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00011ff0: 636c 7564 655f 626f 7264 6572 203d 2069  clude_border = i
-00012000: 6e74 286d 696e 5f64 6973 7461 6e63 6529  nt(min_distance)
-00012010: 2069 6620 6578 636c 7564 655f 626f 7264   if exclude_bord
-00012020: 6572 2065 6c73 6520 4661 6c73 650d 0a20  er else False.. 
-00012030: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00012040: 2074 6872 203d 204e 6f6e 6520 6966 2070   thr = None if p
-00012050: 6572 6365 6e74 696c 6520 6973 204e 6f6e  ercentile is Non
-00012060: 6520 656c 7365 206e 702e 7065 7263 656e  e else np.percen
-00012070: 7469 6c65 2873 656c 662e 7661 6c75 652c  tile(self.value,
-00012080: 2070 6572 6365 6e74 696c 6529 0d0a 2020   percentile)..  
-00012090: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000120a0: 696d 706f 7274 2070 616e 6461 7320 6173  import pandas as
-000120b0: 2070 640d 0a20 2020 2020 2020 2066 726f   pd..        fro
-000120c0: 6d20 696d 7079 2e66 7261 6d65 2069 6d70  m impy.frame imp
-000120d0: 6f72 7420 4d61 726b 6572 4672 616d 650d  ort MarkerFrame.
-000120e0: 0a0d 0a20 2020 2020 2020 2064 665f 616c  ...        df_al
-000120f0: 6c3a 206c 6973 745b 7064 2e44 6174 6146  l: list[pd.DataF
-00012100: 7261 6d65 5d20 3d20 5b5d 0d0a 2020 2020  rame] = []..    
-00012110: 2020 2020 666f 7220 736c 2c20 696d 6720      for sl, img 
-00012120: 696e 2073 656c 662e 6974 6572 2863 5f61  in self.iter(c_a
-00012130: 7865 732c 2069 7372 6177 3d54 7275 652c  xes, israw=True,
-00012140: 2065 7863 6c75 6465 3d64 696d 7329 3a0d   exclude=dims):.
-00012150: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-00012160: 6b66 6561 742e 7065 616b 5f6c 6f63 616c  kfeat.peak_local
-00012170: 5f6d 6178 206f 7665 7277 7269 7465 2073  _max overwrite s
-00012180: 6f6d 6574 6869 6e67 2073 6f20 7765 206e  omething so we n
-00012190: 6565 6420 746f 2067 6976 6520 636f 7079  eed to give copy
-000121a0: 206f 6620 696d 672e 0d0a 2020 2020 2020   of img...      
-000121b0: 2020 2020 2020 6966 2075 7365 5f6c 6162        if use_lab
-000121c0: 656c 7320 616e 6420 696d 672e 6c61 6265  els and img.labe
-000121d0: 6c73 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ls is not None:.
-000121e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000121f0: 206c 6162 656c 7320 3d20 7870 2e61 736e   labels = xp.asn
-00012200: 756d 7079 2869 6d67 2e6c 6162 656c 7329  umpy(img.labels)
-00012210: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00012220: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00012230: 2020 2020 206c 6162 656c 7320 3d20 4e6f       labels = No
-00012240: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00012250: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-00012260: 6469 6365 7320 3d20 736b 6665 6174 2e70  dices = skfeat.p
-00012270: 6561 6b5f 6c6f 6361 6c5f 6d61 7828 0d0a  eak_local_max(..
-00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012290: 7870 2e61 736e 756d 7079 2869 6d67 292c  xp.asnumpy(img),
-000122a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000122b0: 2020 666f 6f74 7072 696e 743d 7870 2e61    footprint=xp.a
-000122c0: 736e 756d 7079 285f 7374 7275 6374 7572  snumpy(_structur
-000122d0: 6573 2e62 616c 6c5f 6c69 6b65 286d 696e  es.ball_like(min
-000122e0: 5f64 6973 7461 6e63 652c 206e 6469 6d29  _distance, ndim)
-000122f0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00012300: 2020 2020 7468 7265 7368 6f6c 645f 6162      threshold_ab
-00012310: 733d 7468 722c 0d0a 2020 2020 2020 2020  s=thr,..        
-00012320: 2020 2020 2020 2020 6e75 6d5f 7065 616b          num_peak
-00012330: 733d 746f 706e 2c0d 0a20 2020 2020 2020  s=topn,..       
-00012340: 2020 2020 2020 2020 206e 756d 5f70 6561           num_pea
-00012350: 6b73 5f70 6572 5f6c 6162 656c 3d74 6f70  ks_per_label=top
-00012360: 6e5f 7065 725f 6c61 6265 6c2c 0d0a 2020  n_per_label,..  
-00012370: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00012380: 6265 6c73 3d6c 6162 656c 732c 0d0a 2020  bels=labels,..  
-00012390: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000123a0: 636c 7564 655f 626f 7264 6572 3d65 7863  clude_border=exc
-000123b0: 6c75 6465 5f62 6f72 6465 720d 0a20 2020  lude_border..   
-000123c0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-000123d0: 2020 2020 2020 2020 696e 6469 6365 7320          indices 
-000123e0: 3d20 7064 2e44 6174 6146 7261 6d65 2869  = pd.DataFrame(i
-000123f0: 6e64 6963 6573 2c20 636f 6c75 6d6e 733d  ndices, columns=
-00012400: 6469 6d73 5f6c 6973 7429 0d0a 2020 2020  dims_list)..    
-00012410: 2020 2020 2020 2020 696e 6469 6365 735b          indices[
-00012420: 635f 6178 6573 5f6c 6973 745d 203d 2073  c_axes_list] = s
-00012430: 6c0d 0a20 2020 2020 2020 2020 2020 2064  l..            d
-00012440: 665f 616c 6c2e 6170 7065 6e64 2869 6e64  f_all.append(ind
-00012450: 6963 6573 290d 0a20 2020 2020 2020 2020  ices)..         
-00012460: 2020 200d 0a20 2020 2020 2020 206f 7574     ..        out
-00012470: 203d 2070 642e 636f 6e63 6174 2864 665f   = pd.concat(df_
-00012480: 616c 6c2c 2061 7869 733d 3029 0d0a 2020  all, axis=0)..  
-00012490: 2020 2020 2020 6f75 7420 3d20 4d61 726b        out = Mark
-000124a0: 6572 4672 616d 6528 6f75 742c 2063 6f6c  erFrame(out, col
-000124b0: 756d 6e73 3d73 656c 662e 6178 6573 2c20  umns=self.axes, 
-000124c0: 6474 7970 653d 6e70 2e75 696e 7431 3629  dtype=np.uint16)
-000124d0: 0d0a 2020 2020 2020 2020 6f75 742e 7365  ..        out.se
-000124e0: 745f 7363 616c 6528 7365 6c66 290d 0a20  t_scale(self).. 
-000124f0: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
-00012500: 740d 0a20 2020 200d 0a20 2020 2040 5f64  t..    ..    @_d
-00012510: 6f63 732e 7772 6974 655f 646f 6373 0d0a  ocs.write_docs..
-00012520: 2020 2020 4064 696d 735f 746f 5f73 7061      @dims_to_spa
-00012530: 7469 616c 5f61 7865 730d 0a20 2020 2040  tial_axes..    @
-00012540: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
-00012550: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
-00012560: 636f 726e 6572 5f68 6172 7269 7328 0d0a  corner_harris(..
-00012570: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
-00012580: 2020 2020 2020 2073 6967 6d61 3a20 6e44         sigma: nD
-00012590: 466c 6f61 7420 3d20 312c 0d0a 2020 2020  Float = 1,..    
-000125a0: 2020 2020 6b3a 2066 6c6f 6174 203d 2030      k: float = 0
-000125b0: 2e30 352c 200d 0a20 2020 2020 2020 202a  .05, ..        *
-000125c0: 2c20 0d0a 2020 2020 2020 2020 6469 6d73  , ..        dims
-000125d0: 3a20 4469 6d73 203d 204e 6f6e 650d 0a20  : Dims = None.. 
-000125e0: 2020 2029 202d 3e20 496d 6741 7272 6179     ) -> ImgArray
-000125f0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-00012600: 2020 2020 2020 2020 4361 6c63 756c 6174          Calculat
-00012610: 6520 4861 7272 6973 2072 6573 706f 6e73  e Harris respons
-00012620: 6520 696d 6167 652e 0d0a 0d0a 2020 2020  e image.....    
-00012630: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-00012640: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00012650: 2d2d 0d0a 2020 2020 2020 2020 7b73 6967  --..        {sig
-00012660: 6d61 7d0d 0a20 2020 2020 2020 206b 203a  ma}..        k :
-00012670: 2066 6c6f 6174 2c20 6f70 7469 6f6e 616c   float, optional
-00012680: 0d0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
-00012690: 6e73 6974 6976 6974 7920 6661 6374 6f72  nsitivity factor
-000126a0: 2074 6f20 7365 7061 7261 7465 2063 6f72   to separate cor
-000126b0: 6e65 7273 2066 726f 6d20 6564 6765 732c  ners from edges,
-000126c0: 2074 7970 6963 616c 6c79 2069 6e20 7261   typically in ra
-000126d0: 6e67 6520 5b30 2c20 302e 325d 2e0d 0a20  nge [0, 0.2]... 
-000126e0: 2020 2020 2020 2020 2020 2053 6d61 6c6c             Small
-000126f0: 2076 616c 7565 7320 6f66 206b 2072 6573   values of k res
-00012700: 756c 7420 696e 2064 6574 6563 7469 6f6e  ult in detection
-00012710: 206f 6620 7368 6172 7020 636f 726e 6572   of sharp corner
-00012720: 732e 0d0a 2020 2020 2020 2020 7b64 696d  s...        {dim
-00012730: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
-00012740: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-00012750: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00012760: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00012770: 2020 2020 2020 4861 7272 6973 2072 6573        Harris res
-00012780: 706f 6e73 650d 0a20 2020 2020 2020 2022  ponse..        "
-00012790: 2222 2020 2020 2020 2020 0d0a 2020 2020  ""        ..    
-000127a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000127b0: 5f61 7070 6c79 5f64 6173 6b28 0d0a 2020  _apply_dask(..  
-000127c0: 2020 2020 2020 2020 2020 736b 6665 6174            skfeat
-000127d0: 2e63 6f72 6e65 725f 6861 7272 6973 2c20  .corner_harris, 
-000127e0: 0d0a 2020 2020 2020 2020 2020 2020 635f  ..            c_
-000127f0: 6178 6573 3d63 6f6d 706c 656d 656e 745f  axes=complement_
-00012800: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-00012810: 6178 6573 292c 200d 0a20 2020 2020 2020  axes), ..       
-00012820: 2020 2020 206b 7761 7267 733d 6469 6374       kwargs=dict
-00012830: 286b 3d6b 2c20 7369 676d 613d 7369 676d  (k=k, sigma=sigm
-00012840: 6129 0d0a 2020 2020 2020 2020 290d 0a20  a)..        ).. 
-00012850: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
-00012860: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
-00012870: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-00012880: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
-00012890: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-000128a0: 7574 0d0a 2020 2020 6465 6620 766f 726f  ut..    def voro
-000128b0: 6e6f 6928 0d0a 2020 2020 2020 2020 7365  noi(..        se
-000128c0: 6c66 2c0d 0a20 2020 2020 2020 2063 6f6f  lf,..        coo
-000128d0: 7264 733a 2043 6f6f 7264 732c 0d0a 2020  rds: Coords,..  
-000128e0: 2020 2020 2020 2a2c 200d 0a20 2020 2020        *, ..     
-000128f0: 2020 2069 6e66 3a20 6e44 496e 7420 7c20     inf: nDInt | 
-00012900: 4e6f 6e65 203d 204e 6f6e 652c 0d0a 2020  None = None,..  
-00012910: 2020 2020 2020 6469 6d73 3a20 4469 6d73        dims: Dims
-00012920: 203d 2032 0d0a 2020 2020 2920 2d3e 2049   = 2..    ) -> I
-00012930: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
-00012940: 2020 2222 220d 0a20 2020 2020 2020 2056    """..        V
-00012950: 6f72 6f6e 6f69 2073 6567 6d65 6e74 6174  oronoi segmentat
-00012960: 696f 6e20 6f66 2061 6e20 696d 6167 652e  ion of an image.
-00012970: 200d 0a20 2020 2020 2020 200d 0a20 2020   ..        ..   
-00012980: 2020 2020 2049 6d61 6765 2072 6567 696f       Image regio
-00012990: 6e20 6c61 6265 6c65 6420 7769 7468 2024  n labeled with $
-000129a0: 6924 206d 6561 6e73 2074 6861 7420 616c  i$ means that al
-000129b0: 6c20 7468 6520 706f 696e 7473 2069 6e20  l the points in 
-000129c0: 7468 6520 7265 6769 6f6e 2061 7265 0d0a  the region are..
-000129d0: 2020 2020 2020 2020 636c 6f73 6572 2074          closer t
-000129e0: 6f20 7468 6520 2469 242d 7468 2070 6f69  o the $i$-th poi
-000129f0: 6e74 2074 6861 6e20 616e 7920 6f74 6865  nt than any othe
-00012a00: 7220 706f 696e 7473 2e0d 0a0d 0a20 2020  r points.....   
-00012a10: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-00012a20: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00012a30: 2d2d 2d0d 0a20 2020 2020 2020 2063 6f6f  ---..        coo
-00012a40: 7264 7320 3a20 4d61 726b 6572 4672 616d  rds : MarkerFram
-00012a50: 6520 6f72 2028 4e2c 2032 2920 6172 7261  e or (N, 2) arra
-00012a60: 792d 6c69 6b65 0d0a 2020 2020 2020 2020  y-like..        
-00012a70: 2020 2020 436f 6f72 6469 6e61 7465 7320      Coordinates 
-00012a80: 6f66 2070 6f69 6e74 732e 0d0a 2020 2020  of points...    
-00012a90: 2020 2020 696e 6620 3a20 696e 742c 2061      inf : int, a
-00012aa0: 7272 6179 206f 6620 696e 742c 206f 7074  rray of int, opt
-00012ab0: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
-00012ac0: 2020 2044 6973 7461 6e63 6520 746f 2069     Distance to i
-00012ad0: 6e66 696e 6974 7920 706f 696e 7473 2e20  nfinity points. 
-00012ae0: 4966 206e 6f74 2070 726f 7669 6465 642c  If not provided,
-00012af0: 2069 6e66 696e 6974 7920 706f 696e 7473   infinity points
-00012b00: 2061 7265 200d 0a20 2020 2020 2020 2020   are ..         
-00012b10: 2020 2070 6c61 6365 6420 6174 2031 3030     placed at 100
-00012b20: 2074 696d 6573 2066 7572 7468 6572 2070   times further p
-00012b30: 6f73 6974 696f 6e73 2072 656c 6174 6976  ositions relativ
-00012b40: 6520 746f 2074 6865 2069 6d61 6765 2073  e to the image s
-00012b50: 6861 7065 2e0d 0a20 2020 2020 2020 207b  hape...        {
-00012b60: 6469 6d73 7d0d 0a0d 0a20 2020 2020 2020  dims}....       
-00012b70: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
-00012b80: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
-00012b90: 2020 204c 6162 656c 0d0a 2020 2020 2020     Label..      
-00012ba0: 2020 2020 2020 5365 676d 656e 7461 7469        Segmentati
-00012bb0: 6f6e 206c 6162 656c 7320 6f66 2069 6d61  on labels of ima
-00012bc0: 6765 2e0d 0a20 2020 2020 2020 2022 2222  ge...        """
-00012bd0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00012be0: 2020 6672 6f6d 2073 6369 7079 2e73 7061    from scipy.spa
-00012bf0: 7469 616c 2069 6d70 6f72 7420 566f 726f  tial import Voro
-00012c00: 6e6f 690d 0a20 2020 2020 2020 2063 6f6f  noi..        coo
-00012c10: 7264 7320 3d20 5f63 6865 636b 5f63 6f6f  rds = _check_coo
-00012c20: 7264 696e 6174 6573 2863 6f6f 7264 732c  rdinates(coords,
-00012c30: 2073 656c 662c 2064 696d 733d 7365 6c66   self, dims=self
-00012c40: 2e61 7865 7329 0d0a 2020 2020 2020 2020  .axes)..        
-00012c50: 0d0a 2020 2020 2020 2020 6e79 2c20 6e78  ..        ny, nx
-00012c60: 203d 2073 656c 662e 7369 7a65 736f 6628   = self.sizesof(
-00012c70: 6469 6d73 290d 0a20 2020 2020 2020 200d  dims)..        .
-00012c80: 0a20 2020 2020 2020 2069 6620 696e 6620  .        if inf 
-00012c90: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00012ca0: 2020 2020 2020 696e 6679 203d 206e 7920        infy = ny 
-00012cb0: 2a20 3130 300d 0a20 2020 2020 2020 2020  * 100..         
-00012cc0: 2020 2069 6e66 7820 3d20 6e78 202a 2031     infx = nx * 1
-00012cd0: 3030 0d0a 2020 2020 2020 2020 656c 6966  00..        elif
-00012ce0: 2069 7369 6e73 7461 6e63 6528 696e 662c   isinstance(inf,
-00012cf0: 2069 6e74 293a 0d0a 2020 2020 2020 2020   int):..        
-00012d00: 2020 2020 696e 6679 203d 2069 6e66 7820      infy = infx 
-00012d10: 3d20 696e 660d 0a20 2020 2020 2020 2065  = inf..        e
-00012d20: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00012d30: 2020 696e 6679 2c20 696e 6678 203d 2069    infy, infx = i
-00012d40: 6e66 0d0a 2020 2020 2020 2020 0d0a 2020  nf..        ..  
-00012d50: 2020 2020 2020 696e 6670 6f69 6e74 7320        infpoints 
-00012d60: 3d20 6e70 2e61 7272 6179 280d 0a20 2020  = np.array(..   
-00012d70: 2020 2020 2020 2020 205b 5b2d 696e 6679           [[-infy
-00012d80: 2c20 2d69 6e66 785d 2c0d 0a20 2020 2020  , -infx],..     
-00012d90: 2020 2020 2020 2020 5b2d 696e 6679 2c20          [-infy, 
-00012da0: 6e78 202b 2069 6e66 785d 2c0d 0a20 2020  nx + infx],..   
-00012db0: 2020 2020 2020 2020 2020 5b6e 7920 2b20            [ny + 
-00012dc0: 696e 6679 2c20 2d69 6e66 785d 2c0d 0a20  infy, -infx],.. 
-00012dd0: 2020 2020 2020 2020 2020 2020 5b6e 7920              [ny 
-00012de0: 2b20 696e 6679 2c20 6e78 202b 2069 6e66  + infy, nx + inf
-00012df0: 785d 5d2c 0d0a 2020 2020 2020 2020 2020  x]],..          
-00012e00: 2020 6474 7970 653d 6e70 2e66 6c6f 6174    dtype=np.float
-00012e10: 3332 2c0d 0a20 2020 2020 2020 2029 0d0a  32,..        )..
-00012e20: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00012e30: 2020 6c61 6265 6c73 203d 206c 6172 6765    labels = large
-00012e40: 7374 5f7a 6572 6f73 2873 656c 662e 7368  st_zeros(self.sh
-00012e50: 6170 6529 0d0a 2020 2020 2020 2020 6e5f  ape)..        n_
-00012e60: 6c61 6265 6c20 3d20 310d 0a20 2020 2020  label = 1..     
-00012e70: 2020 2066 6f72 2073 6c2c 2063 7264 7320     for sl, crds 
-00012e80: 696e 2063 6f6f 7264 732e 6974 6572 2863  in coords.iter(c
-00012e90: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
-00012ea0: 696d 732c 2073 656c 662e 6178 6573 2929  ims, self.axes))
-00012eb0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00012ec0: 6e70 7574 5f63 6f6f 7264 7320 3d20 6e70  nput_coords = np
-00012ed0: 2e63 6f6e 6361 7465 6e61 7465 285b 6372  .concatenate([cr
-00012ee0: 6473 2e76 616c 7565 732c 2069 6e66 706f  ds.values, infpo
-00012ef0: 696e 7473 5d2c 2061 7869 733d 3029 0d0a  ints], axis=0)..
-00012f00: 2020 2020 2020 2020 2020 2020 766f 7220              vor 
-00012f10: 3d20 566f 726f 6e6f 6928 696e 7075 745f  = Voronoi(input_
-00012f20: 636f 6f72 6473 290d 0a20 2020 2020 2020  coords)..       
-00012f30: 2020 2020 2066 6f72 2072 2069 6e20 766f       for r in vo
-00012f40: 722e 7265 6769 6f6e 733a 0d0a 2020 2020  r.regions:..    
-00012f50: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00012f60: 6c6c 2872 3020 3e20 3020 666f 7220 7230  ll(r0 > 0 for r0
-00012f70: 2069 6e20 7229 3a0d 0a20 2020 2020 2020   in r):..       
-00012f80: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-00012f90: 7920 3d20 766f 722e 7665 7274 6963 6573  y = vor.vertices
-00012fa0: 5b72 5d0d 0a20 2020 2020 2020 2020 2020  [r]..           
-00012fb0: 2020 2020 2020 2020 2067 7269 6473 203d           grids =
-00012fc0: 2073 6b6d 6573 2e67 7269 645f 706f 696e   skmes.grid_poin
-00012fd0: 7473 5f69 6e5f 706f 6c79 2873 656c 662e  ts_in_poly(self.
-00012fe0: 7369 7a65 736f 6628 6469 6d73 292c 2070  sizesof(dims), p
-00012ff0: 6f6c 7929 0d0a 2020 2020 2020 2020 2020  oly)..          
-00013000: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
-00013010: 5b73 6c5d 5b67 7269 6473 5d20 3d20 6e5f  [sl][grids] = n_
-00013020: 6c61 6265 6c0d 0a20 2020 2020 2020 2020  label..         
-00013030: 2020 2020 2020 2020 2020 206e 5f6c 6162             n_lab
-00013040: 656c 202b 3d20 310d 0a20 2020 2020 2020  el += 1..       
-00013050: 2073 656c 662e 6c61 6265 6c73 203d 204c   self.labels = L
-00013060: 6162 656c 280d 0a20 2020 2020 2020 2020  abel(..         
-00013070: 2020 206c 6162 656c 732c 206e 616d 653d     labels, name=
-00013080: 7365 6c66 2e6e 616d 652b 222d 6c61 6265  self.name+"-labe
-00013090: 6c22 2c20 6178 6573 3d73 656c 662e 6178  l", axes=self.ax
-000130a0: 6573 2c20 736f 7572 6365 3d73 656c 662e  es, source=self.
-000130b0: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
-000130c0: 292e 6f70 7469 6d69 7a65 2829 0d0a 2020  ).optimize()..  
-000130d0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
-000130e0: 732e 7365 745f 7363 616c 6528 7365 6c66  s.set_scale(self
-000130f0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00013100: 6e20 7365 6c66 2e6c 6162 656c 730d 0a20  n self.labels.. 
-00013110: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
-00013120: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
-00013130: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-00013140: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
-00013150: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-00013160: 7574 0d0a 2020 2020 6465 6620 666c 6f6f  ut..    def floo
-00013170: 6428 0d0a 2020 2020 2020 2020 7365 6c66  d(..        self
-00013180: 2c0d 0a20 2020 2020 2020 2073 6565 6473  ,..        seeds
-00013190: 3a20 436f 6f72 6473 2c20 0d0a 2020 2020  : Coords, ..    
-000131a0: 2020 2020 2a2c 0d0a 2020 2020 2020 2020      *,..        
-000131b0: 636f 6e6e 6563 7469 7669 7479 3a20 696e  connectivity: in
-000131c0: 7420 3d20 312c 0d0a 2020 2020 2020 2020  t = 1,..        
-000131d0: 746f 6c65 7261 6e63 653a 2066 6c6f 6174  tolerance: float
-000131e0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
-000131f0: 2020 6469 6d73 3a20 4469 6d73 203d 204e    dims: Dims = N
-00013200: 6f6e 650d 0a20 2020 2029 3a0d 0a20 2020  one..    ):..   
-00013210: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00013220: 2020 466c 6f6f 6420 6669 6c6c 696e 6720    Flood filling 
-00013230: 7769 7468 2061 206c 6973 7420 6f66 2073  with a list of s
-00013240: 6565 6420 706f 696e 7473 2e20 4279 2072  eed points. By r
-00013250: 6570 6561 7469 6e67 2073 6b69 6d61 6765  epeating skimage
-00013260: 2773 2060 6066 6c6f 6f64 6060 2066 756e  's ``flood`` fun
-00013270: 6374 696f 6e2c 0d0a 2020 2020 2020 2020  ction,..        
-00013280: 7468 6973 206d 6574 686f 6420 6361 6e20  this method can 
-00013290: 7065 7266 6f72 6d20 7365 676d 656e 7461  perform segmenta
-000132a0: 7469 6f6e 206f 6620 616e 2069 6d61 6765  tion of an image
-000132b0: 2e0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
-000132c0: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
-000132d0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-000132e0: 2020 2020 2073 6565 6473 203a 204d 6172       seeds : Mar
-000132f0: 6b65 7246 7261 6d65 206f 7220 284e 2c20  kerFrame or (N, 
-00013300: 4429 2061 7272 6179 2d6c 696b 650d 0a20  D) array-like.. 
-00013310: 2020 2020 2020 2020 2020 2053 6565 6420             Seed 
-00013320: 706f 696e 7473 2074 6f20 7374 6172 7420  points to start 
-00013330: 666c 6f6f 6420 6669 6c6c 696e 672e 0d0a  flood filling...
-00013340: 2020 2020 2020 2020 7b63 6f6e 6e65 6374          {connect
-00013350: 6976 6974 797d 0d0a 2020 2020 2020 2020  ivity}..        
-00013360: 746f 6c65 7261 6e63 6520 3a20 666c 6f61  tolerance : floa
-00013370: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
-00013380: 2020 2020 2020 2020 2049 6e74 656e 7369           Intensi
-00013390: 7479 2064 6576 6961 7469 6f6e 2077 6974  ty deviation wit
-000133a0: 6869 6e20 7468 6973 2076 616c 7565 2077  hin this value w
-000133b0: 696c 6c20 6265 2066 696c 6c65 642e 0d0a  ill be filled...
-000133c0: 2020 2020 2020 2020 7b64 696d 737d 0d0a          {dims}..
-000133d0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000133e0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-000133f0: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
-00013400: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
-00013410: 2020 4c61 6265 6c65 6420 696d 6167 652e    Labeled image.
-00013420: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00013430: 2020 2020 2020 2066 726f 6d20 736b 696d         from skim
-00013440: 6167 652e 6d6f 7270 686f 6c6f 6779 2069  age.morphology i
-00013450: 6d70 6f72 7420 666c 6f6f 640d 0a20 2020  mport flood..   
-00013460: 2020 2020 2073 6565 6473 203d 205f 6368       seeds = _ch
-00013470: 6563 6b5f 636f 6f72 6469 6e61 7465 7328  eck_coordinates(
-00013480: 7365 6564 732c 2073 656c 662c 2064 696d  seeds, self, dim
-00013490: 733d 7365 6c66 2e61 7865 7329 0d0a 2020  s=self.axes)..  
-000134a0: 2020 2020 2020 6c61 6265 6c73 203d 206c        labels = l
-000134b0: 6172 6765 7374 5f7a 6572 6f73 2873 656c  argest_zeros(sel
-000134c0: 662e 7368 6170 6529 0d0a 2020 2020 2020  f.shape)..      
-000134d0: 2020 6e5f 6c61 6265 6c5f 6e65 7874 203d    n_label_next =
-000134e0: 2031 0d0a 2020 2020 2020 2020 666f 7220   1..        for 
-000134f0: 736c 2c20 6372 6473 2069 6e20 7365 6564  sl, crds in seed
-00013500: 732e 6974 6572 2863 6f6d 706c 656d 656e  s.iter(complemen
-00013510: 745f 6178 6573 2864 696d 732c 2073 656c  t_axes(dims, sel
-00013520: 662e 6178 6573 2929 3a0d 0a20 2020 2020  f.axes)):..     
-00013530: 2020 2020 2020 2066 6f72 2063 7264 2069         for crd i
-00013540: 6e20 6372 6473 2e76 616c 7565 733a 0d0a  n crds.values:..
-00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013560: 6372 6420 3d20 7475 706c 6528 6372 6429  crd = tuple(crd)
-00013570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013580: 2020 6966 206c 6162 656c 735b 736c 5d5b    if labels[sl][
-00013590: 6372 645d 203e 2030 3a0d 0a20 2020 2020  crd] > 0:..     
-000135a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000135b0: 5f6c 6162 656c 203d 206c 6162 656c 735b  _label = labels[
-000135c0: 736c 5d5b 6372 645d 0d0a 2020 2020 2020  sl][crd]..      
-000135d0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-000135e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000135f0: 2020 2020 206e 5f6c 6162 656c 203d 206e       n_label = n
-00013600: 5f6c 6162 656c 5f6e 6578 740d 0a20 2020  _label_next..   
-00013610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013620: 206e 5f6c 6162 656c 5f6e 6578 7420 2b3d   n_label_next +=
-00013630: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-00013640: 2020 2020 6669 6c6c 5f61 7265 6120 3d20      fill_area = 
-00013650: 666c 6f6f 6428 0d0a 2020 2020 2020 2020  flood(..        
-00013660: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013670: 2e76 616c 7565 5b73 6c5d 2c20 0d0a 2020  .value[sl], ..  
-00013680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013690: 2020 7365 6564 5f70 6f69 6e74 3d63 7264    seed_point=crd
-000136a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000136b0: 2020 2020 2020 2063 6f6e 6e65 6374 6976         connectiv
-000136c0: 6974 793d 636f 6e6e 6563 7469 7669 7479  ity=connectivity
-000136d0: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
-000136e0: 2020 2020 2020 2020 746f 6c65 7261 6e63          toleranc
-000136f0: 653d 746f 6c65 7261 6e63 650d 0a20 2020  e=tolerance..   
-00013700: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00013710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013720: 6c61 6265 6c73 5b73 6c5d 5b66 696c 6c5f  labels[sl][fill_
-00013730: 6172 6561 5d20 3d20 6e5f 6c61 6265 6c0d  area] = n_label.
-00013740: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00013750: 2020 2073 656c 662e 6c61 6265 6c73 203d     self.labels =
-00013760: 204c 6162 656c 280d 0a20 2020 2020 2020   Label(..       
-00013770: 2020 2020 206c 6162 656c 732c 206e 616d       labels, nam
-00013780: 653d 7365 6c66 2e6e 616d 652b 222d 6c61  e=self.name+"-la
-00013790: 6265 6c22 2c20 6178 6573 3d73 656c 662e  bel", axes=self.
-000137a0: 6178 6573 2c20 736f 7572 6365 3d73 656c  axes, source=sel
-000137b0: 662e 736f 7572 6365 0d0a 2020 2020 2020  f.source..      
-000137c0: 2020 292e 6f70 7469 6d69 7a65 2829 0d0a    ).optimize()..
-000137d0: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
-000137e0: 656c 732e 7365 745f 7363 616c 6528 7365  els.set_scale(se
-000137f0: 6c66 290d 0a20 2020 2020 2020 2072 6574  lf)..        ret
-00013800: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
-00013810: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-00013820: 5f61 7865 730d 0a20 2020 2064 6566 2066  _axes..    def f
-00013830: 696e 645f 736d 280d 0a20 2020 2020 2020  ind_sm(..       
-00013840: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
-00013850: 7369 676d 613a 206e 4446 6c6f 6174 203d  sigma: nDFloat =
-00013860: 2031 2e35 2c0d 0a20 2020 2020 2020 202a   1.5,..        *
-00013870: 2c20 0d0a 2020 2020 2020 2020 6d65 7468  , ..        meth
-00013880: 6f64 3a20 7374 7220 3d20 2264 6f67 222c  od: str = "dog",
-00013890: 0d0a 2020 2020 2020 2020 6375 746f 6666  ..        cutoff
-000138a0: 3a20 666c 6f61 7420 3d20 4e6f 6e65 2c0d  : float = None,.
-000138b0: 0a20 2020 2020 2020 2070 6572 6365 6e74  .        percent
-000138c0: 696c 653a 2066 6c6f 6174 203d 2039 352c  ile: float = 95,
-000138d0: 0d0a 2020 2020 2020 2020 746f 706e 3a20  ..        topn: 
-000138e0: 696e 7420 3d20 6e70 2e69 6e66 2c0d 0a20  int = np.inf,.. 
-000138f0: 2020 2020 2020 2065 7863 6c75 6465 5f62         exclude_b
-00013900: 6f72 6465 723a 2062 6f6f 6c20 3d20 5472  order: bool = Tr
-00013910: 7565 2c0d 0a20 2020 2020 2020 2064 696d  ue,..        dim
-00013920: 733a 2044 696d 7320 3d20 4e6f 6e65 0d0a  s: Dims = None..
-00013930: 2020 2020 2920 2d3e 204d 6172 6b65 7246      ) -> MarkerF
-00013940: 7261 6d65 3a0d 0a20 2020 2020 2020 2022  rame:..        "
-00013950: 2222 0d0a 2020 2020 2020 2020 5369 6e67  ""..        Sing
-00013960: 6c65 206d 6f6c 6563 756c 6520 6465 7465  le molecule dete
-00013970: 6374 696f 6e20 7573 696e 6720 6469 6666  ction using diff
-00013980: 6572 656e 6365 206f 6620 4761 7573 7369  erence of Gaussi
-00013990: 616e 2c20 6465 7465 726d 696e 616e 7420  an, determinant 
-000139a0: 6f66 2048 6573 7369 616e 2c20 4c61 706c  of Hessian, Lapl
-000139b0: 6163 6961 6e20 6f66 200d 0a20 2020 2020  acian of ..     
-000139c0: 2020 2047 6175 7373 6961 6e20 6f72 206e     Gaussian or n
-000139d0: 6f72 6d61 6c69 7a65 6420 6372 6f73 7320  ormalized cross 
-000139e0: 636f 7272 656c 6174 696f 6e20 6d65 7468  correlation meth
-000139f0: 6f64 2e0d 0a0d 0a20 2020 2020 2020 2050  od.....        P
-00013a00: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-00013a10: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00013a20: 2020 2020 2020 2073 6967 6d61 203a 2066         sigma : f
-00013a30: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0d0a  loat, optional..
-00013a40: 2020 2020 2020 2020 2020 2020 5374 616e              Stan
-00013a50: 6461 7264 2064 6576 6961 7469 6f6e 206f  dard deviation o
-00013a60: 6620 7075 6e63 7461 2e0d 0a20 2020 2020  f puncta...     
-00013a70: 2020 206d 6574 686f 6420 3a20 7374 7220     method : str 
-00013a80: 7b22 646f 6722 2c20 2264 6f68 222c 2022  {"dog", "doh", "
-00013a90: 6c6f 6722 2c20 2267 6175 7373 6961 6e22  log", "gaussian"
-00013aa0: 2c20 226e 6363 227d 2c20 6465 6661 756c  , "ncc"}, defaul
-00013ab0: 7420 6973 2022 646f 6722 0d0a 2020 2020  t is "dog"..    
-00013ac0: 2020 2020 2020 2020 5768 6963 6820 6669          Which fi
-00013ad0: 6c74 6572 2069 7320 7573 6564 2070 7269  lter is used pri
-00013ae0: 6f72 2074 6f20 6669 6e64 696e 6720 6c6f  or to finding lo
-00013af0: 6361 6c20 6d61 7869 6d61 2e20 4966 2022  cal maxima. If "
-00013b00: 6e63 6322 2c20 6120 4761 7573 7369 616e  ncc", a Gaussian
-00013b10: 2070 6172 7469 636c 6520 6973 2075 7365   particle is use
-00013b20: 6420 6173 0d0a 2020 2020 2020 2020 2020  d as..          
-00013b30: 2020 7468 6520 7465 6d70 6c61 7465 2069    the template i
-00013b40: 6d61 6765 2e0d 0a20 2020 2020 2020 2063  mage...        c
-00013b50: 7574 6f66 6620 3a20 666c 6f61 742c 206f  utoff : float, o
-00013b60: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-00013b70: 2020 2020 2043 7574 6f66 6620 7661 6c75       Cutoff valu
-00013b80: 6520 6f66 2066 696c 7465 7265 6420 696d  e of filtered im
-00013b90: 6167 6520 6765 6e65 7261 7465 6420 6279  age generated by
-00013ba0: 2060 6d65 7468 6f64 602e 0d0a 2020 2020   `method`...    
-00013bb0: 2020 2020 7065 7263 656e 7469 6c65 2c20      percentile, 
-00013bc0: 746f 706e 2c20 6578 636c 7564 655f 626f  topn, exclude_bo
-00013bd0: 7264 6572 2c20 6469 6d73 0d0a 2020 2020  rder, dims..    
-00013be0: 2020 2020 2020 2020 5061 7373 6564 2074          Passed t
-00013bf0: 6f20 6060 7065 616b 5f6c 6f63 616c 5f6d  o ``peak_local_m
-00013c00: 6178 2829 6060 0d0a 0d0a 2020 2020 2020  ax()``....      
-00013c10: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00013c20: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00013c30: 2020 2020 4d61 726b 6572 4672 616d 650d      MarkerFrame.
-00013c40: 0a20 2020 2020 2020 2020 2020 2050 6561  .            Pea
-00013c50: 6b73 2069 6e20 7569 6e74 3136 2074 7970  ks in uint16 typ
-00013c60: 652e 0d0a 2020 2020 2020 2020 0d0a 2020  e...        ..  
-00013c70: 2020 2020 2020 4578 616d 706c 6573 0d0a        Examples..
-00013c80: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00013c90: 0d0a 2020 2020 2020 2020 5472 6163 6b20  ..        Track 
-00013ca0: 7369 6e67 6c65 206d 6f6c 6563 756c 6573  single molecules
-00013cb0: 2061 6e64 2076 6965 7720 7468 6520 7472   and view the tr
-00013cc0: 6163 6b73 2077 6974 6820 6e61 7061 7269  acks with napari
-00013cd0: 2e0d 0a20 2020 2020 2020 200d 0a20 2020  ...        ..   
-00013ce0: 2020 2020 2020 2020 203e 3e3e 2063 6f6f           >>> coo
-00013cf0: 7264 7320 3d20 696d 672e 6669 6e64 5f73  rds = img.find_s
-00013d00: 6d28 290d 0a20 2020 2020 2020 2020 2020  m()..           
-00013d10: 203e 3e3e 206c 6e6b 203d 2063 6f6f 7264   >>> lnk = coord
-00013d20: 732e 6c69 6e6b 2833 2c20 6d69 6e5f 6477  s.link(3, min_dw
-00013d30: 656c 6c3d 3130 290d 0a20 2020 2020 2020  ell=10)..       
-00013d40: 2020 2020 203e 3e3e 2069 702e 6775 692e       >>> ip.gui.
-00013d50: 6164 6428 696d 6729 0d0a 2020 2020 2020  add(img)..      
-00013d60: 2020 2020 2020 3e3e 3e20 6970 2e67 7569        >>> ip.gui
-00013d70: 2e61 6464 286c 6e6b 290d 0a20 2020 2020  .add(lnk)..     
-00013d80: 2020 200d 0a20 2020 2020 2020 2053 6565     ..        See
-00013d90: 2041 6c73 6f0d 0a20 2020 2020 2020 202d   Also..        -
-00013da0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-00013db0: 2063 656e 7472 6f69 645f 736d 0d0a 2020   centroid_sm..  
-00013dc0: 2020 2020 2020 7265 6669 6e65 5f73 6d0d        refine_sm.
-00013dd0: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
-00013de0: 2020 2020 0d0a 2020 2020 2020 2020 6d65      ..        me
-00013df0: 7468 6f64 203d 206d 6574 686f 642e 6c6f  thod = method.lo
-00013e00: 7765 7228 290d 0a20 2020 2020 2020 2069  wer()..        i
-00013e10: 6620 6d65 7468 6f64 2069 6e20 2822 646f  f method in ("do
-00013e20: 6722 2c20 2264 6f68 222c 2022 6c6f 6722  g", "doh", "log"
-00013e30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00013e40: 6375 746f 6666 203d 2030 2e30 2069 6620  cutoff = 0.0 if 
-00013e50: 6375 746f 6666 2069 7320 4e6f 6e65 2065  cutoff is None e
-00013e60: 6c73 6520 6375 746f 6666 0d0a 2020 2020  lse cutoff..    
-00013e70: 2020 2020 2020 2020 6669 6c5f 696d 6720          fil_img 
-00013e80: 3d20 6765 7461 7474 7228 7365 6c66 2c20  = getattr(self, 
-00013e90: 6d65 7468 6f64 2b22 5f66 696c 7465 7222  method+"_filter"
-00013ea0: 2928 7369 676d 612c 2064 696d 733d 6469  )(sigma, dims=di
-00013eb0: 6d73 290d 0a20 2020 2020 2020 2065 6c69  ms)..        eli
-00013ec0: 6620 6d65 7468 6f64 2069 6e20 2822 6761  f method in ("ga
-00013ed0: 7573 7369 616e 222c 293a 0d0a 2020 2020  ussian",):..    
-00013ee0: 2020 2020 2020 2020 6375 746f 6666 203d          cutoff =
-00013ef0: 202d 6e70 2e69 6e66 2069 6620 6375 746f   -np.inf if cuto
-00013f00: 6666 2069 7320 4e6f 6e65 2065 6c73 6520  ff is None else 
-00013f10: 6375 746f 6666 0d0a 2020 2020 2020 2020  cutoff..        
-00013f20: 2020 2020 6669 6c5f 696d 6720 3d20 6765      fil_img = ge
-00013f30: 7461 7474 7228 7365 6c66 2c20 6d65 7468  tattr(self, meth
-00013f40: 6f64 2b22 5f66 696c 7465 7222 2928 7369  od+"_filter")(si
-00013f50: 676d 612c 2064 696d 733d 6469 6d73 290d  gma, dims=dims).
-00013f60: 0a20 2020 2020 2020 2065 6c69 6620 6d65  .        elif me
-00013f70: 7468 6f64 203d 3d20 226e 6363 223a 0d0a  thod == "ncc":..
-00013f80: 2020 2020 2020 2020 2020 2020 2320 6d61              # ma
-00013f90: 6b65 2074 656d 706c 6174 6520 4761 7573  ke template Gaus
-00013fa0: 7369 616e 0d0a 2020 2020 2020 2020 2020  sian..          
-00013fb0: 2020 6375 746f 6666 203d 2030 2e35 2069    cutoff = 0.5 i
-00013fc0: 6620 6375 746f 6666 2069 7320 4e6f 6e65  f cutoff is None
-00013fd0: 2065 6c73 6520 6375 746f 6666 0d0a 2020   else cutoff..  
-00013fe0: 2020 2020 2020 2020 2020 7369 676d 6120            sigma 
-00013ff0: 3d20 6e70 2e61 7272 6179 2863 6865 636b  = np.array(check
-00014000: 5f6e 6428 7369 676d 612c 206c 656e 2864  _nd(sigma, len(d
-00014010: 696d 7329 2929 0d0a 2020 2020 2020 2020  ims)))..        
-00014020: 2020 2020 7368 6170 6520 3d20 7475 706c      shape = tupl
-00014030: 6528 2873 6967 6d61 2a34 292e 6173 7479  e((sigma*4).asty
-00014040: 7065 286e 702e 696e 7433 3229 290d 0a20  pe(np.int32)).. 
-00014050: 2020 2020 2020 2020 2020 2067 203d 2047             g = G
-00014060: 6175 7373 6961 6e50 6172 7469 636c 6528  aussianParticle(
-00014070: 5b28 6e70 2e61 7272 6179 2873 6861 7065  [(np.array(shape
-00014080: 292d 3129 2f32 2c20 7369 676d 612c 2031  )-1)/2, sigma, 1
-00014090: 2e30 2c20 302e 305d 290d 0a20 2020 2020  .0, 0.0])..     
-000140a0: 2020 2020 2020 2074 656d 706c 6174 6520         template 
-000140b0: 3d20 672e 6765 6e65 7261 7465 2873 6861  = g.generate(sha
-000140c0: 7065 290d 0a20 2020 2020 2020 2020 2020  pe)..           
-000140d0: 2023 2074 656d 706c 6174 6520 6d61 7463   # template matc
-000140e0: 6869 6e67 0d0a 2020 2020 2020 2020 2020  hing..          
-000140f0: 2020 6669 6c5f 696d 6720 3d20 7365 6c66    fil_img = self
-00014100: 2e6e 6363 5f66 696c 7465 7228 7465 6d70  .ncc_filter(temp
-00014110: 6c61 7465 290d 0a20 2020 2020 2020 2065  late)..        e
-00014120: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00014130: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00014140: 6f72 2822 606d 6574 686f 6460 206d 7573  or("`method` mus
-00014150: 7420 6265 2027 646f 6727 2c20 2764 6f68  t be 'dog', 'doh
-00014160: 272c 2027 6c6f 6727 2c20 2767 6175 7373  ', 'log', 'gauss
-00014170: 6961 6e27 206f 7220 276e 6363 272e 2229  ian' or 'ncc'.")
-00014180: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00014190: 2020 2020 6669 6c5f 696d 675b 6669 6c5f      fil_img[fil_
-000141a0: 696d 673c 6375 746f 6666 5d20 3d20 6375  img<cutoff] = cu
-000141b0: 746f 6666 0d0a 2020 2020 2020 2020 0d0a  toff..        ..
-000141c0: 2020 2020 2020 2020 6966 206e 702e 6973          if np.is
-000141d0: 7363 616c 6172 2873 6967 6d61 293a 0d0a  scalar(sigma):..
-000141e0: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-000141f0: 6420 3d20 7369 676d 612a 320d 0a20 2020  d = sigma*2..   
-00014200: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00014210: 2020 2020 2020 2020 6d69 6e5f 6420 3d20          min_d = 
-00014220: 6d61 7828 7369 676d 6129 2a32 0d0a 2020  max(sigma)*2..  
-00014230: 2020 2020 2020 636f 6f72 6473 203d 2066        coords = f
-00014240: 696c 5f69 6d67 2e70 6561 6b5f 6c6f 6361  il_img.peak_loca
-00014250: 6c5f 6d61 7828 6d69 6e5f 6469 7374 616e  l_max(min_distan
-00014260: 6365 3d6d 696e 5f64 2c20 7065 7263 656e  ce=min_d, percen
-00014270: 7469 6c65 3d70 6572 6365 6e74 696c 652c  tile=percentile,
-00014280: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142a0: 2020 2020 2020 2020 2020 2074 6f70 6e3d             topn=
-000142b0: 746f 706e 2c20 6469 6d73 3d64 696d 732c  topn, dims=dims,
-000142c0: 2065 7863 6c75 6465 5f62 6f72 6465 723d   exclude_border=
-000142d0: 6578 636c 7564 655f 626f 7264 6572 290d  exclude_border).
-000142e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000142f0: 636f 6f72 6473 0d0a 2020 2020 0d0a 2020  coords..    ..  
-00014300: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
-00014310: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
-00014320: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
-00014330: 6178 6573 0d0a 2020 2020 6465 6620 6365  axes..    def ce
-00014340: 6e74 726f 6964 5f73 6d28 0d0a 2020 2020  ntroid_sm(..    
-00014350: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00014360: 2020 2063 6f6f 7264 733a 2043 6f6f 7264     coords: Coord
-00014370: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
-00014380: 2020 202a 2c0d 0a20 2020 2020 2020 2072     *,..        r
-00014390: 6164 6975 733a 206e 4449 6e74 203d 2034  adius: nDInt = 4
-000143a0: 2c0d 0a20 2020 2020 2020 2066 696c 743a  ,..        filt:
-000143b0: 2043 616c 6c61 626c 655b 5b49 6d67 4172   Callable[[ImgAr
-000143c0: 7261 795d 2c20 626f 6f6c 5d20 3d20 4e6f  ray], bool] = No
-000143d0: 6e65 2c0d 0a20 2020 2020 2020 2064 696d  ne,..        dim
-000143e0: 733a 2044 696d 7320 3d20 4e6f 6e65 2c0d  s: Dims = None,.
-000143f0: 0a20 2020 2020 2020 202a 2a66 696e 645f  .        **find_
-00014400: 736d 5f6b 7761 7267 732c 0d0a 2020 2020  sm_kwargs,..    
-00014410: 2920 2d3e 204d 6172 6b65 7246 7261 6d65  ) -> MarkerFrame
-00014420: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-00014430: 2020 2020 2020 2020 4361 6c63 756c 6174          Calculat
-00014440: 6520 706f 7369 7469 6f6e 7320 6f66 2070  e positions of p
-00014450: 6172 7469 636c 6573 2069 6e20 7375 6270  articles in subp
-00014460: 6978 656c 2070 7265 6369 7369 6f6e 2075  ixel precision u
-00014470: 7369 6e67 2063 656e 7472 6f69 642e 0d0a  sing centroid...
-00014480: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00014490: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-000144a0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-000144b0: 2020 636f 6f72 6473 203a 204d 6172 6b65    coords : Marke
-000144c0: 7246 7261 6d65 206f 7220 284e 2c20 3229  rFrame or (N, 2)
-000144d0: 2061 7272 6179 2c20 6f70 7469 6f6e 616c   array, optional
-000144e0: 0d0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
-000144f0: 6f72 6469 6e61 7465 7320 6f66 2070 6561  ordinates of pea
-00014500: 6b73 2e20 4966 204e 6f6e 652c 2074 6869  ks. If None, thi
-00014510: 7320 7769 6c6c 2062 6520 6465 7465 726d  s will be determ
-00014520: 696e 6564 2062 7920 6669 6e64 5f73 6d2e  ined by find_sm.
-00014530: 0d0a 2020 2020 2020 2020 7261 6469 7573  ..        radius
-00014540: 203a 2069 6e74 2c20 6465 6661 756c 7420   : int, default 
-00014550: 6973 2034 2e0d 0a20 2020 2020 2020 2020  is 4...         
-00014560: 2020 2052 616e 6765 2074 6f20 6361 6c63     Range to calc
-00014570: 756c 6174 6520 6365 6e74 726f 6964 732e  ulate centroids.
-00014580: 2052 6563 7461 6e67 756c 6172 2069 6d61   Rectangular ima
-00014590: 6765 2077 6974 6820 7369 7a65 2032 722b  ge with size 2r+
-000145a0: 3120 7820 3272 2b31 2077 696c 6c20 6265  1 x 2r+1 will be
-000145b0: 2073 656e 6420 0d0a 2020 2020 2020 2020   send ..        
-000145c0: 2020 2020 746f 2063 616c 6375 6c61 7465      to calculate
-000145d0: 206d 6f6d 656e 7473 2e0d 0a20 2020 2020   moments...     
-000145e0: 2020 2066 696c 7420 3a20 6361 6c6c 6162     filt : callab
-000145f0: 6c65 2c20 6f70 7469 6f6e 616c 0d0a 2020  le, optional..  
-00014600: 2020 2020 2020 2020 2020 466f 7220 6576            For ev
-00014610: 6572 7920 736c 6963 6520 6060 736c 6060  ery slice ``sl``
-00014620: 2c20 6c61 6265 6c20 6973 2061 6464 6564  , label is added
-00014630: 206f 6e6c 7920 7768 656e 2066 696c 7428   only when filt(
-00014640: 6069 6e70 7574 6029 203d 3d20 5472 7565  `input`) == True
-00014650: 2069 7320 7361 7469 7366 6965 642e 0d0a   is satisfied...
-00014660: 2020 2020 2020 2020 6669 6e64 5f73 6d5f          find_sm_
-00014670: 6b77 6172 6773 203a 206b 6579 776f 7264  kwargs : keyword
-00014680: 2061 7267 756d 656e 7473 0d0a 2020 2020   arguments..    
-00014690: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000146a0: 7273 2070 6173 7365 6420 746f 203a 6675  rs passed to :fu
-000146b0: 6e63 3a60 6669 6e64 5f73 6d60 2e0d 0a20  nc:`find_sm`... 
-000146c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000146d0: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
-000146e0: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
-000146f0: 2020 204d 6172 6b65 7246 7261 6d65 0d0a     MarkerFrame..
-00014700: 2020 2020 2020 2020 2020 2020 436f 6f72              Coor
-00014710: 6469 6e61 7465 7320 6f66 2070 6561 6b73  dinates of peaks
-00014720: 2e0d 0a20 2020 2020 2020 200d 0a20 2020  ...        ..   
-00014730: 2020 2020 2053 6565 2041 6c73 6f0d 0a20       See Also.. 
-00014740: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0d         --------.
-00014750: 0a20 2020 2020 2020 2066 696e 645f 736d  .        find_sm
-00014760: 0d0a 2020 2020 2020 2020 7265 6669 6e65  ..        refine
-00014770: 5f73 6d0d 0a20 2020 2020 2020 2022 2222  _sm..        """
-00014780: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
-00014790: 6d70 6f72 7420 7061 6e64 6173 2061 7320  mport pandas as 
-000147a0: 7064 0d0a 2020 2020 2020 2020 6672 6f6d  pd..        from
-000147b0: 202e 2e66 7261 6d65 2069 6d70 6f72 7420   ..frame import 
-000147c0: 4d61 726b 6572 4672 616d 650d 0a20 2020  MarkerFrame..   
-000147d0: 2020 2020 2069 6620 636f 6f72 6473 2069       if coords i
-000147e0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-000147f0: 2020 2020 2063 6f6f 7264 7320 3d20 7365       coords = se
-00014800: 6c66 2e66 696e 645f 736d 2864 696d 733d  lf.find_sm(dims=
-00014810: 6469 6d73 2c20 2a2a 6669 6e64 5f73 6d5f  dims, **find_sm_
-00014820: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
-00014830: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00014840: 2020 2020 636f 6f72 6473 203d 205f 6368      coords = _ch
-00014850: 6563 6b5f 636f 6f72 6469 6e61 7465 7328  eck_coordinates(
-00014860: 636f 6f72 6473 2c20 7365 6c66 290d 0a20  coords, self).. 
-00014870: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-00014880: 2020 2020 206e 6469 6d20 3d20 6c65 6e28       ndim = len(
-00014890: 6469 6d73 290d 0a20 2020 2020 2020 2066  dims)..        f
-000148a0: 696c 7420 3d20 6368 6563 6b5f 6669 6c74  ilt = check_filt
-000148b0: 6572 5f66 756e 6328 6669 6c74 290d 0a20  er_func(filt).. 
-000148c0: 2020 2020 2020 2072 6164 6975 7320 3d20         radius = 
-000148d0: 6e70 2e61 7272 6179 2863 6865 636b 5f6e  np.array(check_n
-000148e0: 6428 7261 6469 7573 2c20 6e64 696d 2929  d(radius, ndim))
-000148f0: 0d0a 2020 2020 2020 2020 7368 6170 6520  ..        shape 
-00014900: 3d20 7365 6c66 2e73 697a 6573 6f66 2864  = self.sizesof(d
-00014910: 696d 7329 0d0a 2020 2020 2020 2020 6f75  ims)..        ou
-00014920: 7420 3d20 5b5d 0d0a 2020 2020 2020 2020  t = []..        
-00014930: 636f 6c75 6d6e 7320 3d20 6c69 7374 2864  columns = list(d
-00014940: 696d 7329 0d0a 2020 2020 2020 2020 635f  ims)..        c_
-00014950: 6178 6573 203d 2063 6f6d 706c 656d 656e  axes = complemen
-00014960: 745f 6178 6573 2864 696d 732c 2063 6f6f  t_axes(dims, coo
-00014970: 7264 732e 5f61 7865 7329 0d0a 2020 2020  rds._axes)..    
-00014980: 2020 2020 666f 7220 736c 2c20 6372 6473      for sl, crds
-00014990: 2069 6e20 636f 6f72 6473 2e69 7465 7228   in coords.iter(
-000149a0: 635f 6178 6573 293a 0d0a 2020 2020 2020  c_axes):..      
-000149b0: 2020 2020 2020 6365 6e74 726f 6964 7320        centroids 
-000149c0: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
-000149d0: 2020 666f 7220 6365 6e74 6572 2069 6e20    for center in 
-000149e0: 6372 6473 2e76 616c 7565 733a 0d0a 2020  crds.values:..  
-000149f0: 2020 2020 2020 2020 2020 2020 2020 6262                bb
-00014a00: 6f78 203d 205f 7370 6563 6966 795f 6f6e  ox = _specify_on
-00014a10: 6528 6365 6e74 6572 2c20 7261 6469 7573  e(center, radius
-00014a20: 2c20 7368 6170 6529 0d0a 2020 2020 2020  , shape)..      
-00014a30: 2020 2020 2020 2020 2020 696e 7075 745f            input_
-00014a40: 696d 6720 3d20 7365 6c66 2e76 616c 7565  img = self.value
-00014a50: 5b73 6c5d 5b62 626f 785d 0d0a 2020 2020  [sl][bbox]..    
-00014a60: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00014a70: 6e70 7574 5f69 6d67 2e73 697a 6520 3d3d  nput_img.size ==
-00014a80: 2030 206f 7220 6e6f 7420 6669 6c74 2869   0 or not filt(i
-00014a90: 6e70 7574 5f69 6d67 293a 0d0a 2020 2020  nput_img):..    
-00014aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ab0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
-00014ac0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00014ad0: 2020 2020 2020 2020 2020 2020 7368 6966              shif
-00014ae0: 7420 3d20 6365 6e74 6572 202d 2072 6164  t = center - rad
-00014af0: 6975 730d 0a20 2020 2020 2020 2020 2020  ius..           
-00014b00: 2020 2020 2063 656e 7472 6f69 6420 3d20       centroid = 
-00014b10: 5f63 616c 635f 6365 6e74 726f 6964 2869  _calc_centroid(i
-00014b20: 6e70 7574 5f69 6d67 2c20 6e64 696d 2920  nput_img, ndim) 
-00014b30: 2b20 7368 6966 740d 0a20 2020 2020 2020  + shift..       
-00014b40: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00014b50: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-00014b60: 6f69 6473 2e61 7070 656e 6428 6365 6e74  oids.append(cent
-00014b70: 726f 6964 2e74 6f6c 6973 7428 2929 0d0a  roid.tolist())..
-00014b80: 2020 2020 2020 2020 2020 2020 6466 203d              df =
-00014b90: 2070 642e 4461 7461 4672 616d 6528 6365   pd.DataFrame(ce
-00014ba0: 6e74 726f 6964 732c 2063 6f6c 756d 6e73  ntroids, columns
-00014bb0: 3d63 6f6c 756d 6e73 290d 0a20 2020 2020  =columns)..     
-00014bc0: 2020 2020 2020 2064 665b 6c69 7374 2863         df[list(c
-00014bd0: 5f61 7865 7329 5d20 3d20 736c 5b3a 2d6e  _axes)] = sl[:-n
-00014be0: 6469 6d5d 0d0a 2020 2020 2020 2020 2020  dim]..          
-00014bf0: 2020 6f75 742e 6170 7065 6e64 2864 6629    out.append(df)
-00014c00: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00014c10: 286f 7574 2920 3d3d 2030 3a0d 0a20 2020  (out) == 0:..   
-00014c20: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00014c30: 616c 7565 4572 726f 7228 224e 6f20 6d6f  alueError("No mo
-00014c40: 6c65 6375 6c65 2066 6f75 6e64 2e22 290d  lecule found.").
-00014c50: 0a20 2020 2020 2020 206f 7574 203d 2070  .        out = p
-00014c60: 642e 636f 6e63 6174 286f 7574 2c20 6178  d.concat(out, ax
-00014c70: 6973 3d30 290d 0a20 2020 2020 2020 200d  is=0)..        .
-00014c80: 0a20 2020 2020 2020 206f 7574 203d 204d  .        out = M
-00014c90: 6172 6b65 7246 7261 6d65 286f 7574 2e72  arkerFrame(out.r
-00014ca0: 6569 6e64 6578 2863 6f6c 756d 6e73 3d6c  eindex(columns=l
-00014cb0: 6973 7428 636f 6f72 6473 2e5f 6178 6573  ist(coords._axes
-00014cc0: 2929 2c0d 0a20 2020 2020 2020 2020 2020  )),..           
-00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ce0: 2063 6f6c 756d 6e73 3d73 7472 2863 6f6f   columns=str(coo
-00014cf0: 7264 732e 5f61 7865 7329 2c20 6474 7970  rds._axes), dtyp
-00014d00: 653d 6e70 2e66 6c6f 6174 3332 292e 6173  e=np.float32).as
-00014d10: 5f73 7461 6e64 6172 645f 7479 7065 2829  _standard_type()
-00014d20: 0d0a 2020 2020 2020 2020 6f75 742e 7365  ..        out.se
-00014d30: 745f 7363 616c 6528 636f 6f72 6473 2e73  t_scale(coords.s
-00014d40: 6361 6c65 290d 0a0d 0a20 2020 2020 2020  cale)....       
-00014d50: 2072 6574 7572 6e20 6f75 740d 0a20 2020   return out..   
-00014d60: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
-00014d70: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
-00014d80: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
-00014d90: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
-00014da0: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
-00014db0: 0d0a 2020 2020 6465 6620 6564 6765 5f67  ..    def edge_g
-00014dc0: 7261 6428 0d0a 2020 2020 2020 2020 7365  rad(..        se
-00014dd0: 6c66 2c0d 0a20 2020 2020 2020 2073 6967  lf,..        sig
-00014de0: 6d61 3a20 6e44 466c 6f61 7420 3d20 312e  ma: nDFloat = 1.
-00014df0: 302c 0d0a 2020 2020 2020 2020 6d65 7468  0,..        meth
-00014e00: 6f64 3a20 7374 7220 3d20 2273 6f62 656c  od: str = "sobel
-00014e10: 222c 200d 0a20 2020 2020 2020 202a 2c20  ", ..        *, 
-00014e20: 0d0a 2020 2020 2020 2020 6465 673a 2062  ..        deg: b
-00014e30: 6f6f 6c20 3d20 4661 6c73 652c 0d0a 2020  ool = False,..  
-00014e40: 2020 2020 2020 6469 6d73 3a20 4469 6d73        dims: Dims
-00014e50: 203d 2032 0d0a 2020 2020 2920 2d3e 2050   = 2..    ) -> P
-00014e60: 6861 7365 4172 7261 793a 0d0a 2020 2020  haseArray:..    
-00014e70: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00014e80: 2043 616c 6375 6c61 7465 2067 7261 6469   Calculate gradi
-00014e90: 656e 7420 6469 7265 6374 696f 6e20 7573  ent direction us
-00014ea0: 696e 6720 686f 7269 7a6f 6e74 616c 2061  ing horizontal a
-00014eb0: 6e64 2076 6572 7469 6361 6c20 6564 6765  nd vertical edge
-00014ec0: 206f 7065 7261 7469 6f6e 2e20 4772 6164   operation. Grad
-00014ed0: 6965 6e74 2064 6972 6563 7469 6f6e 0d0a  ient direction..
-00014ee0: 2020 2020 2020 2020 6973 2074 6865 2064          is the d
-00014ef0: 6972 6563 7469 6f6e 2077 6974 6820 6d61  irection with ma
-00014f00: 7869 6d75 6d20 6772 6164 6965 6e74 2c20  ximum gradient, 
-00014f10: 692e 652e 2c20 696e 7465 6e73 6974 7920  i.e., intensity 
-00014f20: 696e 6372 6561 7365 2069 7320 6c61 7267  increase is larg
-00014f30: 6573 742e 200d 0a0d 0a20 2020 2020 2020  est. ....       
-00014f40: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
-00014f50: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
-00014f60: 0a20 2020 2020 2020 207b 7369 676d 617d  .        {sigma}
-00014f70: 0d0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-00014f80: 203a 2073 7472 2c20 7b22 736f 6265 6c22   : str, {"sobel"
-00014f90: 2c20 2266 6172 6964 222c 2022 7363 6861  , "farid", "scha
-00014fa0: 7272 222c 2022 7072 6577 6974 7422 7d2c  rr", "prewitt"},
-00014fb0: 2064 6566 6175 6c74 2069 7320 2273 6f62   default is "sob
-00014fc0: 656c 220d 0a20 2020 2020 2020 2020 2020  el"..           
-00014fd0: 2045 6467 6520 6f70 6572 6174 6f72 206e   Edge operator n
-00014fe0: 616d 652e 0d0a 2020 2020 2020 2020 6465  ame...        de
-00014ff0: 6720 3a20 626f 6f6c 2c20 6465 6661 756c  g : bool, defaul
-00015000: 7420 6973 2054 7275 650d 0a20 2020 2020  t is True..     
-00015010: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00015020: 6465 6772 6565 2072 6174 6865 7220 7468  degree rather th
-00015030: 616e 2072 6164 6961 6e20 6973 2072 6574  an radian is ret
-00015040: 7572 6e65 642e 0d0a 2020 2020 2020 2020  urned...        
-00015050: 7b64 696d 737d 0d0a 0d0a 2020 2020 2020  {dims}....      
-00015060: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00015070: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00015080: 2020 2020 5068 6173 6541 7272 6179 0d0a      PhaseArray..
-00015090: 2020 2020 2020 2020 2020 2020 5068 6173              Phas
-000150a0: 6520 696d 6167 6520 7769 7468 2072 616e  e image with ran
-000150b0: 6765 205b 2d31 3830 2c20 3138 3029 2069  ge [-180, 180) i
-000150c0: 6620 6465 673d 3d54 7275 652c 206f 7468  f deg==True, oth
-000150d0: 6572 7769 7365 205b 2d70 692c 2070 6929  erwise [-pi, pi)
-000150e0: 2e0d 0a20 2020 2020 2020 2020 2020 200d  ...            .
-000150f0: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00015100: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-00015110: 2d2d 2d0d 0a20 2020 2020 2020 2031 2e20  ---..        1. 
-00015120: 5072 6f66 696c 6520 6669 6c61 6d65 6e74  Profile filament
-00015130: 206f 7269 656e 7461 7469 6f6e 2064 6973   orientation dis
-00015140: 7472 6962 7574 696f 6e20 7573 696e 6720  tribution using 
-00015150: 6869 7374 6f67 7261 6d20 6f66 2065 6467  histogram of edg
-00015160: 6520 6772 6164 6965 6e74 2e0d 0a20 2020  e gradient...   
-00015170: 2020 2020 2020 2020 203e 3e3e 2067 7261           >>> gra
-00015180: 6420 3d20 696d 672e 6564 6765 5f67 7261  d = img.edge_gra
-00015190: 6428 6465 673d 5472 7565 290d 0a20 2020  d(deg=True)..   
-000151a0: 2020 2020 2020 2020 203e 3e3e 2070 6c74           >>> plt
-000151b0: 2e68 6973 7428 6772 6164 2e72 6176 656c  .hist(grad.ravel
-000151c0: 2829 2c20 6269 6e73 3d31 3030 290d 0a20  (), bins=100).. 
-000151d0: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-000151e0: 2020 0d0a 2020 2020 2020 2020 2320 4765    ..        # Ge
-000151f0: 7420 6f70 6572 6174 6f72 0d0a 2020 2020  t operator..    
-00015200: 2020 2020 6d65 7468 6f64 5f64 6963 7420      method_dict 
-00015210: 3d20 7b22 736f 6265 6c22 3a20 2873 6b66  = {"sobel": (skf
-00015220: 696c 2e73 6f62 656c 5f68 2c20 736b 6669  il.sobel_h, skfi
-00015230: 6c2e 736f 6265 6c5f 7629 2c0d 0a20 2020  l.sobel_v),..   
-00015240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015250: 2020 2020 2266 6172 6964 223a 2028 736b      "farid": (sk
-00015260: 6669 6c2e 6661 7269 645f 682c 2073 6b66  fil.farid_h, skf
-00015270: 696c 2e66 6172 6964 5f76 292c 0d0a 2020  il.farid_v),..  
-00015280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015290: 2020 2020 2022 7363 6861 7272 223a 2028       "scharr": (
-000152a0: 736b 6669 6c2e 7363 6861 7272 5f68 2c20  skfil.scharr_h, 
-000152b0: 736b 6669 6c2e 7363 6861 7272 5f76 292c  skfil.scharr_v),
-000152c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000152d0: 2020 2020 2020 2020 2022 7072 6577 6974           "prewit
-000152e0: 7422 3a20 2873 6b66 696c 2e70 7265 7769  t": (skfil.prewi
-000152f0: 7474 5f68 2c20 736b 6669 6c2e 7072 6577  tt_h, skfil.prew
-00015300: 6974 745f 7629 7d0d 0a20 2020 2020 2020  itt_v)}..       
-00015310: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00015320: 2020 206f 705f 682c 206f 705f 7620 3d20     op_h, op_v = 
-00015330: 6d65 7468 6f64 5f64 6963 745b 6d65 7468  method_dict[meth
-00015340: 6f64 5d0d 0a20 2020 2020 2020 2065 7863  od]..        exc
-00015350: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00015360: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00015370: 2056 616c 7565 4572 726f 7228 2260 6d65   ValueError("`me
-00015380: 7468 6f64 6020 6d75 7374 2062 6520 2773  thod` must be 's
-00015390: 6f62 656c 272c 2027 6661 7269 6427 2027  obel', 'farid' '
-000153a0: 7363 6861 7272 272c 206f 7220 2770 7265  scharr', or 'pre
-000153b0: 7769 7474 272e 2229 0d0a 2020 2020 2020  witt'.")..      
-000153c0: 2020 0d0a 2020 2020 2020 2020 2320 5374    ..        # St
-000153d0: 6172 740d 0a20 2020 2020 2020 2063 5f61  art..        c_a
-000153e0: 7865 7320 3d20 636f 6d70 6c65 6d65 6e74  xes = complement
-000153f0: 5f61 7865 7328 6469 6d73 2c20 7365 6c66  _axes(dims, self
-00015400: 2e61 7865 7329 0d0a 2020 2020 2020 2020  .axes)..        
-00015410: 6966 2073 6967 6d61 203e 2030 3a0d 0a20  if sigma > 0:.. 
-00015420: 2020 2020 2020 2020 2020 2073 656c 6620             self 
-00015430: 3d20 7365 6c66 2e67 6175 7373 6961 6e5f  = self.gaussian_
-00015440: 6669 6c74 6572 2873 6967 6d61 2c20 6469  filter(sigma, di
-00015450: 6d73 3d64 696d 7329 0d0a 2020 2020 2020  ms=dims)..      
-00015460: 2020 6772 6164 5f68 203d 2073 656c 662e    grad_h = self.
-00015470: 5f61 7070 6c79 5f64 6173 6b28 6f70 5f68  _apply_dask(op_h
-00015480: 2c20 635f 6178 6573 3d63 5f61 7865 7329  , c_axes=c_axes)
-00015490: 0d0a 2020 2020 2020 2020 6772 6164 5f76  ..        grad_v
-000154a0: 203d 2073 656c 662e 5f61 7070 6c79 5f64   = self._apply_d
-000154b0: 6173 6b28 6f70 5f76 2c20 635f 6178 6573  ask(op_v, c_axes
-000154c0: 3d63 5f61 7865 7329 0d0a 2020 2020 2020  =c_axes)..      
-000154d0: 2020 6772 6164 203d 206e 702e 6172 6374    grad = np.arct
-000154e0: 616e 3228 2d67 7261 645f 682c 2067 7261  an2(-grad_h, gra
-000154f0: 645f 7629 0d0a 2020 2020 2020 2020 0d0a  d_v)..        ..
-00015500: 2020 2020 2020 2020 6772 6164 203d 2050          grad = P
-00015510: 6861 7365 4172 7261 7928 6772 6164 2c20  haseArray(grad, 
-00015520: 626f 7264 6572 3d28 2d6e 702e 7069 2c20  border=(-np.pi, 
-00015530: 6e70 2e70 6929 290d 0a20 2020 2020 2020  np.pi))..       
-00015540: 2067 7261 642e 5f66 6978 5f62 6f72 6465   grad._fix_borde
-00015550: 7228 290d 0a20 2020 2020 2020 2064 6567  r()..        deg
-00015560: 2061 6e64 2067 7261 642e 7261 6432 6465   and grad.rad2de
-00015570: 6728 290d 0a20 2020 2020 2020 2072 6574  g()..        ret
-00015580: 7572 6e20 6772 6164 0d0a 2020 2020 0d0a  urn grad..    ..
-00015590: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
-000155a0: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
-000155b0: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
-000155c0: 0d0a 2020 2020 4063 6865 636b 5f69 6e70  ..    @check_inp
-000155d0: 7574 5f61 6e64 5f6f 7574 7075 740d 0a20  ut_and_output.. 
-000155e0: 2020 2064 6566 2068 6573 7369 616e 5f61     def hessian_a
-000155f0: 6e67 6c65 280d 0a20 2020 2020 2020 2073  ngle(..        s
-00015600: 656c 662c 0d0a 2020 2020 2020 2020 7369  elf,..        si
-00015610: 676d 613a 206e 4446 6c6f 6174 203d 2031  gma: nDFloat = 1
-00015620: 2e2c 0d0a 2020 2020 2020 2020 2a2c 200d  .,..        *, .
-00015630: 0a20 2020 2020 2020 2064 6567 3a20 626f  .        deg: bo
-00015640: 6f6c 203d 2046 616c 7365 2c0d 0a20 2020  ol = False,..   
-00015650: 2020 2020 2064 696d 733a 2044 696d 7320       dims: Dims 
-00015660: 3d20 322c 0d0a 2020 2020 2920 2d3e 2050  = 2,..    ) -> P
-00015670: 6861 7365 4172 7261 793a 0d0a 2020 2020  haseArray:..    
-00015680: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00015690: 2043 616c 6375 6c61 7465 2066 696c 616d   Calculate filam
-000156a0: 656e 7420 616e 676c 6573 2075 7369 6e67  ent angles using
-000156b0: 2048 6573 7369 616e 2773 2065 6967 656e   Hessian's eigen
-000156c0: 7665 6374 6f72 732e 0d0a 0d0a 2020 2020  vectors.....    
-000156d0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-000156e0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000156f0: 2d2d 0d0a 2020 2020 2020 2020 7b73 6967  --..        {sig
-00015700: 6d61 7d0d 0a20 2020 2020 2020 2064 6567  ma}..        deg
-00015710: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00015720: 2069 7320 4661 6c73 650d 0a20 2020 2020   is False..     
-00015730: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00015740: 7265 7475 726e 6564 2061 7272 6179 2077  returned array w
-00015750: 696c 6c20 6265 2069 6e20 6465 6772 6565  ill be in degree
-00015760: 2e20 4f74 6865 7277 6973 652c 2072 6164  . Otherwise, rad
-00015770: 6961 6e20 7769 6c6c 2062 6520 7468 6520  ian will be the 
-00015780: 756e 6974 0d0a 2020 2020 2020 2020 2020  unit..          
-00015790: 2020 6f66 2061 6e67 6c65 2e0d 0a20 2020    of angle...   
-000157a0: 2020 2020 207b 6469 6d73 7d0d 0a0d 0a20       {dims}.... 
-000157b0: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
-000157c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
-000157d0: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
-000157e0: 790d 0a20 2020 2020 2020 2020 2020 2050  y..            P
-000157f0: 6861 7365 2069 6d61 6765 2077 6974 6820  hase image with 
-00015800: 7261 6e67 6520 5b2d 3930 2c20 3930 5d20  range [-90, 90] 
-00015810: 6966 2060 6064 6567 3d3d 5472 7565 6060  if ``deg==True``
-00015820: 2c20 6f74 6865 7277 6973 6520 5b2d 7069  , otherwise [-pi
-00015830: 2f32 2c20 7069 2f32 5d2e 0d0a 2020 2020  /2, pi/2]...    
-00015840: 2020 2020 0d0a 2020 2020 2020 2020 5365      ..        Se
-00015850: 6520 416c 736f 0d0a 2020 2020 2020 2020  e Also..        
-00015860: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00015870: 2020 6761 626f 725f 616e 676c 650d 0a20    gabor_angle.. 
-00015880: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-00015890: 2020 0d0a 2020 2020 2020 2020 5f2c 2065    ..        _, e
-000158a0: 6967 7665 6320 3d20 7365 6c66 2e68 6573  igvec = self.hes
-000158b0: 7369 616e 5f65 6967 2873 6967 6d61 3d73  sian_eig(sigma=s
-000158c0: 6967 6d61 2c20 6469 6d73 3d64 696d 7329  igma, dims=dims)
-000158d0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000158e0: 2020 2020 666d 7420 3d20 736c 6963 6572      fmt = slicer
-000158f0: 2e67 6574 5f66 6f72 6d61 7474 6572 285b  .get_formatter([
-00015900: 2264 696d 222c 2022 6261 7365 225d 290d  "dim", "base"]).
-00015910: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00015920: 2020 2061 7267 203d 202d 6e70 2e61 7263     arg = -np.arc
-00015930: 7461 6e32 2865 6967 7665 635b 666d 745b  tan2(eigvec[fmt[
-00015940: 302c 2031 5d5d 2c20 6569 6776 6563 5b66  0, 1]], eigvec[f
-00015950: 6d74 5b31 2c20 315d 5d29 0d0a 2020 2020  mt[1, 1]])..    
-00015960: 2020 2020 6172 6720 3d20 5068 6173 6541      arg = PhaseA
-00015970: 7272 6179 2861 7267 2c20 626f 7264 6572  rray(arg, border
-00015980: 3d28 2d6e 702e 7069 2f32 2c20 6e70 2e70  =(-np.pi/2, np.p
-00015990: 692f 3229 290d 0a20 2020 2020 2020 2061  i/2))..        a
-000159a0: 7267 2e5f 6669 785f 626f 7264 6572 2829  rg._fix_border()
-000159b0: 0d0a 2020 2020 2020 2020 6465 6720 616e  ..        deg an
-000159c0: 6420 6172 672e 7261 6432 6465 6728 290d  d arg.rad2deg().
-000159d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000159e0: 6172 670d 0a20 2020 200d 0a20 2020 2040  arg..    ..    @
-000159f0: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
-00015a00: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
-00015a10: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
-00015a20: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
-00015a30: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
-00015a40: 6620 6761 626f 725f 616e 676c 6528 0d0a  f gabor_angle(..
-00015a50: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
-00015a60: 2020 2020 2020 206e 5f73 616d 706c 653a         n_sample:
-00015a70: 2069 6e74 203d 2031 3830 2c0d 0a20 2020   int = 180,..   
-00015a80: 2020 2020 206c 6d64 3a20 666c 6f61 7420       lmd: float 
-00015a90: 3d20 352c 0d0a 2020 2020 2020 2020 7369  = 5,..        si
-00015aa0: 676d 613a 2066 6c6f 6174 203d 2032 2e35  gma: float = 2.5
-00015ab0: 2c0d 0a20 2020 2020 2020 2067 616d 6d61  ,..        gamma
-00015ac0: 3a20 666c 6f61 7420 3d20 312c 200d 0a20  : float = 1, .. 
-00015ad0: 2020 2020 2020 2070 6869 3a20 666c 6f61         phi: floa
-00015ae0: 7420 3d20 302c 0d0a 2020 2020 2020 2020  t = 0,..        
-00015af0: 2a2c 200d 0a20 2020 2020 2020 2064 6567  *, ..        deg
-00015b00: 3a20 626f 6f6c 203d 2046 616c 7365 2c20  : bool = False, 
-00015b10: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
-00015b20: 4469 6d73 203d 2032 0d0a 2020 2020 2920  Dims = 2..    ) 
-00015b30: 2d3e 2050 6861 7365 4172 7261 793a 0d0a  -> PhaseArray:..
-00015b40: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00015b50: 2020 2020 2043 616c 6375 6c61 7465 2066       Calculate f
-00015b60: 696c 616d 656e 7420 616e 676c 6573 2075  ilament angles u
-00015b70: 7369 6e67 2047 6162 6f72 2066 696c 7465  sing Gabor filte
-00015b80: 722e 2046 6f72 2061 6c6c 2074 6865 2063  r. For all the c
-00015b90: 616e 6469 6461 7465 7320 6f66 2061 6e67  andidates of ang
-00015ba0: 6c65 732c 2047 6162 6f72 2072 6573 706f  les, Gabor respo
-00015bb0: 6e73 6520 6973 0d0a 2020 2020 2020 2020  nse is..        
-00015bc0: 6361 6c63 756c 6174 6564 2c20 616e 6420  calculated, and 
-00015bd0: 7468 6520 7374 726f 6e67 6573 7420 7265  the strongest re
-00015be0: 7370 6f6e 7365 2069 7320 7265 7475 726e  sponse is return
-00015bf0: 6564 2061 7320 6f75 7470 7574 2061 7272  ed as output arr
-00015c00: 6179 2e0d 0a0d 0a20 2020 2020 2020 2050  ay.....        P
-00015c10: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-00015c20: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00015c30: 2020 2020 2020 206e 5f73 616d 706c 6520         n_sample 
-00015c40: 3a20 696e 742c 2064 6566 6175 6c74 2069  : int, default i
-00015c50: 7320 3138 300d 0a20 2020 2020 2020 2020  s 180..         
-00015c60: 2020 204e 756d 6265 7220 6f66 2060 7468     Number of `th
-00015c70: 6574 6160 7320 746f 2063 616c 6375 6c61  eta`s to calcula
-00015c80: 7465 2e20 4279 2064 6566 6175 6c74 2c20  te. By default, 
-00015c90: 2d39 302c 202d 3839 2c20 2e2e 2e2c 2038  -90, -89, ..., 8
-00015ca0: 3920 6465 6772 6565 2061 7265 2063 616c  9 degree are cal
-00015cb0: 6375 6c61 7465 642e 0d0a 2020 2020 2020  culated...      
-00015cc0: 2020 6c6d 6420 3a20 666c 6f61 742c 2064    lmd : float, d
-00015cd0: 6566 6175 6c74 2069 7320 350d 0a20 2020  efault is 5..   
-00015ce0: 2020 2020 2020 2020 2057 6176 6520 6c65           Wave le
-00015cf0: 6e67 7468 206f 6620 4761 626f 7220 6b65  ngth of Gabor ke
-00015d00: 726e 656c 2e20 4d61 6b65 2073 7572 6520  rnel. Make sure 
-00015d10: 7468 6174 2074 6865 2064 6961 6d65 7465  that the diamete
-00015d20: 7220 6f66 2074 6865 206f 626a 6563 7473  r of the objects
-00015d30: 2079 6f75 2077 616e 7420 746f 2064 6574   you want to det
-00015d40: 6563 7420 6973 0d0a 2020 2020 2020 2020  ect is..        
-00015d50: 2020 2020 6172 6f75 6e64 2060 6c6d 642f      around `lmd/
-00015d60: 3260 2e0d 0a20 2020 2020 2020 2073 6967  2`...        sig
-00015d70: 6d61 203a 2066 6c6f 6174 2c20 6465 6661  ma : float, defa
-00015d80: 756c 7420 6973 2032 2e35 0d0a 2020 2020  ult is 2.5..    
-00015d90: 2020 2020 2020 2020 5374 616e 6461 7264          Standard
-00015da0: 2064 6576 6961 7469 6f6e 206f 6620 4761   deviation of Ga
-00015db0: 7573 7369 616e 2066 6163 746f 7220 6f66  ussian factor of
-00015dc0: 2047 6162 6f72 206b 6572 6e65 6c2e 0d0a   Gabor kernel...
-00015dd0: 2020 2020 2020 2020 6761 6d6d 6120 3a20          gamma : 
-00015de0: 666c 6f61 742c 2064 6566 6175 6c74 2069  float, default i
-00015df0: 7320 310d 0a20 2020 2020 2020 2020 2020  s 1..           
-00015e00: 2041 6e69 736f 7472 6f70 7920 6f66 2047   Anisotropy of G
-00015e10: 6162 6f72 206b 6572 6e65 6c2c 2069 2e65  abor kernel, i.e
-00015e20: 2e20 7468 6520 7374 616e 6461 7264 2064  . the standard d
-00015e30: 6576 6961 7469 6f6e 206f 7274 686f 676f  eviation orthogo
-00015e40: 6e61 6c20 746f 2074 6865 7461 2077 696c  nal to theta wil
-00015e50: 6c20 6265 2073 6967 6d61 2f67 616d 6d61  l be sigma/gamma
-00015e60: 2e0d 0a20 2020 2020 2020 2070 6869 203a  ...        phi :
-00015e70: 2066 6c6f 6174 2c20 6465 6661 756c 7420   float, default 
-00015e80: 6973 2030 0d0a 2020 2020 2020 2020 2020  is 0..          
-00015e90: 2020 5068 6173 6520 6f66 6673 6574 206f    Phase offset o
-00015ea0: 6620 6861 726d 6f6e 6963 2066 6163 746f  f harmonic facto
-00015eb0: 7220 6f66 2047 6162 6f72 206b 6572 6e65  r of Gabor kerne
-00015ec0: 6c2e 0d0a 2020 2020 2020 2020 6465 6720  l...        deg 
-00015ed0: 3a20 626f 6f6c 2c20 6465 6661 756c 7420  : bool, default 
-00015ee0: 6973 2046 616c 7365 0d0a 2020 2020 2020  is False..      
-00015ef0: 2020 2020 2020 4966 2054 7275 652c 2064        If True, d
-00015f00: 6567 7265 6520 7261 7468 6572 2074 6861  egree rather tha
-00015f10: 6e20 7261 6469 616e 2069 7320 7265 7475  n radian is retu
-00015f20: 726e 6564 2e0d 0a20 2020 2020 2020 207b  rned...        {
-00015f30: 6469 6d73 7d0d 0a20 2020 2020 2020 2020  dims}..         
-00015f40: 2020 200d 0a20 2020 2020 2020 2052 6574     ..        Ret
-00015f50: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
-00015f60: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
-00015f70: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
-00015f80: 2020 2020 2050 6861 7365 2069 6d61 6765       Phase image
-00015f90: 2077 6974 6820 7261 6e67 6520 5b2d 3930   with range [-90
-00015fa0: 2c20 3930 2920 6966 2064 6567 3d3d 5472  , 90) if deg==Tr
-00015fb0: 7565 2c20 6f74 6865 7277 6973 6520 5b2d  ue, otherwise [-
-00015fc0: 7069 2f32 2c20 7069 2f32 292e 0d0a 2020  pi/2, pi/2)...  
-00015fd0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00015fe0: 5365 6520 416c 736f 0d0a 2020 2020 2020  See Also..      
-00015ff0: 2020 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020    --------..    
-00016000: 2020 2020 6865 7373 6961 6e5f 616e 676c      hessian_angl
-00016010: 650d 0a20 2020 2020 2020 2022 2222 2020  e..        """  
-00016020: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00016030: 7468 6574 6173 203d 206e 702e 6c69 6e73  thetas = np.lins
-00016040: 7061 6365 2830 2c20 6e70 2e70 692c 206e  pace(0, np.pi, n
-00016050: 5f73 616d 706c 652c 2046 616c 7365 290d  _sample, False).
-00016060: 0a20 2020 2020 2020 206d 6178 5f20 3d20  .        max_ = 
-00016070: 6e70 2e65 6d70 7479 2873 656c 662e 7368  np.empty(self.sh
-00016080: 6170 652c 2064 7479 7065 3d6e 702e 666c  ape, dtype=np.fl
-00016090: 6f61 7433 3229 0d0a 2020 2020 2020 2020  oat32)..        
-000160a0: 6172 676d 6178 5f20 3d20 6e70 2e7a 6572  argmax_ = np.zer
-000160b0: 6f73 2873 656c 662e 7368 6170 652c 2064  os(self.shape, d
-000160c0: 7479 7065 3d6e 702e 666c 6f61 7433 3229  type=np.float32)
-000160d0: 2023 2054 6869 7320 6973 2066 6c6f 6174   # This is float
-000160e0: 3332 2062 6563 6175 7365 2066 696e 616c  32 because final
-000160f0: 6c79 2074 6869 7320 6265 636f 6d65 7320  ly this becomes 
-00016100: 616e 676c 6520 6172 7261 792e 0d0a 2020  angle array...  
-00016110: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00016120: 635f 6178 6573 203d 2063 6f6d 706c 656d  c_axes = complem
-00016130: 656e 745f 6178 6573 2864 696d 732c 2073  ent_axes(dims, s
-00016140: 656c 662e 6178 6573 290d 0a20 2020 2020  elf.axes)..     
-00016150: 2020 2066 6f72 2069 2c20 7468 6574 6120     for i, theta 
-00016160: 696e 2065 6e75 6d65 7261 7465 2874 6865  in enumerate(the
-00016170: 7461 7329 3a0d 0a20 2020 2020 2020 2020  tas):..         
-00016180: 2020 206b 6572 203d 2073 6b66 696c 2e67     ker = skfil.g
-00016190: 6162 6f72 5f6b 6572 6e65 6c28 312f 6c6d  abor_kernel(1/lm
-000161a0: 642c 2074 6865 7461 2c20 302c 2073 6967  d, theta, 0, sig
-000161b0: 6d61 2c20 7369 676d 612f 6761 6d6d 612c  ma, sigma/gamma,
-000161c0: 2033 2c20 7068 6929 2e61 7374 7970 6528   3, phi).astype(
-000161d0: 6e70 2e63 6f6d 706c 6578 3634 290d 0a20  np.complex64).. 
-000161e0: 2020 2020 2020 2020 2020 206f 7574 5f20             out_ 
-000161f0: 3d20 7365 6c66 2e61 735f 666c 6f61 7428  = self.as_float(
-00016200: 292e 5f61 7070 6c79 5f64 6173 6b28 5f66  )._apply_dask(_f
-00016210: 696c 7465 7273 2e63 6f6e 766f 6c76 652c  ilters.convolve,
-00016220: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00016230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016250: 2063 5f61 7865 733d 635f 6178 6573 2c20   c_axes=c_axes, 
-00016260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016290: 6172 6773 3d28 6b65 722e 7265 616c 2c29  args=(ker.real,)
-000162a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000162b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162d0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-000162e0: 6620 6920 3e20 303a 0d0a 2020 2020 2020  f i > 0:..      
-000162f0: 2020 2020 2020 2020 2020 7768 6572 655f            where_
-00016300: 7570 6461 7465 203d 206f 7574 5f20 3e20  update = out_ > 
-00016310: 6d61 785f 0d0a 2020 2020 2020 2020 2020  max_..          
-00016320: 2020 2020 2020 6d61 785f 5b77 6865 7265        max_[where
-00016330: 5f75 7064 6174 655d 203d 206f 7574 5f5b  _update] = out_[
-00016340: 7768 6572 655f 7570 6461 7465 5d0d 0a20  where_update].. 
-00016350: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00016360: 7267 6d61 785f 5b77 6865 7265 5f75 7064  rgmax_[where_upd
-00016370: 6174 655d 203d 2069 0d0a 2020 2020 2020  ate] = i..      
-00016380: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00016390: 2020 2020 2020 2020 2020 2020 206d 6178               max
-000163a0: 5f20 3d20 6f75 745f 0d0a 2020 2020 2020  _ = out_..      
-000163b0: 2020 6172 676d 6178 5f20 2a3d 2028 7468    argmax_ *= (th
-000163c0: 6574 6173 5b31 5d20 2d20 7468 6574 6173  etas[1] - thetas
-000163d0: 5b30 5d29 0d0a 2020 2020 2020 2020 6172  [0])..        ar
-000163e0: 676d 6178 5f5b 3a5d 203d 206e 702e 7069  gmax_[:] = np.pi
-000163f0: 2f32 202d 2061 7267 6d61 785f 0d0a 2020  /2 - argmax_..  
-00016400: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00016410: 6172 676d 6178 5f20 3d20 5068 6173 6541  argmax_ = PhaseA
-00016420: 7272 6179 2861 7267 6d61 785f 2c20 626f  rray(argmax_, bo
-00016430: 7264 6572 3d28 2d6e 702e 7069 2f32 2c20  rder=(-np.pi/2, 
-00016440: 6e70 2e70 692f 3229 290d 0a20 2020 2020  np.pi/2))..     
-00016450: 2020 2061 7267 6d61 785f 2e5f 6669 785f     argmax_._fix_
-00016460: 626f 7264 6572 2829 0d0a 2020 2020 2020  border()..      
-00016470: 2020 6465 6720 616e 6420 6172 676d 6178    deg and argmax
-00016480: 5f2e 7261 6432 6465 6728 290d 0a20 2020  _.rad2deg()..   
-00016490: 2020 2020 2072 6574 7572 6e20 6172 676d       return argm
-000164a0: 6178 5f0d 0a20 2020 200d 0a20 2020 2040  ax_..    ..    @
-000164b0: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
-000164c0: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
-000164d0: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
-000164e0: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
-000164f0: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
-00016500: 6620 6761 626f 725f 6669 6c74 6572 280d  f gabor_filter(.
-00016510: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
-00016520: 2020 2020 2020 2020 6c6d 643a 2066 6c6f          lmd: flo
-00016530: 6174 203d 2035 2c0d 0a20 2020 2020 2020  at = 5,..       
-00016540: 2074 6865 7461 3a20 666c 6f61 7420 3d20   theta: float = 
-00016550: 302c 0d0a 2020 2020 2020 2020 7369 676d  0,..        sigm
-00016560: 613a 2066 6c6f 6174 203d 2032 2e35 2c0d  a: float = 2.5,.
-00016570: 0a20 2020 2020 2020 2067 616d 6d61 3a20  .        gamma: 
-00016580: 666c 6f61 7420 3d20 312c 0d0a 2020 2020  float = 1,..    
-00016590: 2020 2020 7068 693a 2066 6c6f 6174 203d      phi: float =
-000165a0: 2030 2c20 0d0a 2020 2020 2020 2020 2a2c   0, ..        *,
-000165b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000165c0: 5f69 6d61 673a 2062 6f6f 6c20 3d20 4661  _imag: bool = Fa
-000165d0: 6c73 652c 0d0a 2020 2020 2020 2020 6469  lse,..        di
-000165e0: 6d73 3a20 4469 6d73 203d 2032 0d0a 2020  ms: Dims = 2..  
-000165f0: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
-00016600: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00016610: 2020 2020 2020 204d 616b 6520 6120 4761         Make a Ga
-00016620: 626f 7220 6b65 726e 656c 2061 6e64 2063  bor kernel and c
-00016630: 6f6e 766f 6c76 6520 6974 2e0d 0a0d 0a20  onvolve it..... 
-00016640: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00016650: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-00016660: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 206c  -----..        l
-00016670: 6d64 203a 2066 6c6f 6174 2c20 6465 6661  md : float, defa
-00016680: 756c 7420 6973 2035 0d0a 2020 2020 2020  ult is 5..      
-00016690: 2020 2020 2020 5761 7665 206c 656e 6774        Wave lengt
-000166a0: 6820 6f66 2047 6162 6f72 206b 6572 6e65  h of Gabor kerne
-000166b0: 6c2e 204d 616b 6520 7375 7265 2074 6861  l. Make sure tha
-000166c0: 7420 7468 6520 6469 616d 6574 6572 206f  t the diameter o
-000166d0: 6620 7468 6520 6f62 6a65 6374 7320 796f  f the objects yo
-000166e0: 7520 7761 6e74 2074 6f20 6465 7465 6374  u want to detect
-000166f0: 2069 730d 0a20 2020 2020 2020 2020 2020   is..           
-00016700: 2061 726f 756e 6420 606c 6d64 2f32 602e   around `lmd/2`.
-00016710: 0d0a 2020 2020 2020 2020 7468 6574 6120  ..        theta 
-00016720: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-00016730: 2069 7320 300d 0a20 2020 2020 2020 2020   is 0..         
-00016740: 2020 204f 7269 656e 7461 7469 6f6e 206f     Orientation o
-00016750: 6620 6861 726d 6f6e 6963 2066 6163 746f  f harmonic facto
-00016760: 7220 6f66 2047 6162 6f72 206b 6572 6e65  r of Gabor kerne
-00016770: 6c20 696e 2072 6164 6961 6e20 2878 2d64  l in radian (x-d
-00016780: 6972 6563 7469 6f6e 616c 2069 6620 6074  irectional if `t
-00016790: 6865 7461 3d3d 3060 292e 0d0a 2020 2020  heta==0`)...    
-000167a0: 2020 2020 7b73 6967 6d61 7d0d 0a20 2020      {sigma}..   
-000167b0: 2020 2020 2067 616d 6d61 203a 2066 6c6f       gamma : flo
-000167c0: 6174 2c20 6465 6661 756c 7420 6973 2031  at, default is 1
-000167d0: 0d0a 2020 2020 2020 2020 2020 2020 416e  ..            An
-000167e0: 6973 6f74 726f 7079 206f 6620 4761 626f  isotropy of Gabo
-000167f0: 7220 6b65 726e 656c 2c20 692e 652e 2074  r kernel, i.e. t
-00016800: 6865 2073 7461 6e64 6172 6420 6465 7669  he standard devi
-00016810: 6174 696f 6e20 6f72 7468 6f67 6f6e 616c  ation orthogonal
-00016820: 2074 6f20 7468 6574 6120 7769 6c6c 2062   to theta will b
-00016830: 6520 7369 676d 612f 6761 6d6d 612e 0d0a  e sigma/gamma...
-00016840: 2020 2020 2020 2020 7068 6920 3a20 666c          phi : fl
-00016850: 6f61 742c 2064 6566 6175 6c74 2069 7320  oat, default is 
-00016860: 300d 0a20 2020 2020 2020 2020 2020 2050  0..            P
-00016870: 6861 7365 206f 6666 7365 7420 6f66 2068  hase offset of h
-00016880: 6172 6d6f 6e69 6320 6661 6374 6f72 206f  armonic factor o
-00016890: 6620 4761 626f 7220 6b65 726e 656c 2e0d  f Gabor kernel..
-000168a0: 0a20 2020 2020 2020 2072 6574 7572 6e5f  .        return_
-000168b0: 696d 6167 203a 2062 6f6f 6c2c 2064 6566  imag : bool, def
-000168c0: 6175 6c74 2069 7320 4661 6c73 650d 0a20  ault is False.. 
-000168d0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-000168e0: 7565 2c20 6120 636f 6d70 6c65 7820 696d  ue, a complex im
-000168f0: 6167 6520 7468 6174 2063 6f6e 7461 696e  age that contain
-00016900: 7320 626f 7468 2072 6561 6c20 616e 6420  s both real and 
-00016910: 696d 6167 696e 6172 7920 7061 7274 206f  imaginary part o
-00016920: 6620 4761 626f 7220 7265 7370 6f6e 7365  f Gabor response
-00016930: 2069 7320 7265 7475 726e 6564 2e0d 0a20   is returned... 
-00016940: 2020 2020 2020 207b 6469 6d73 7d0d 0a0d         {dims}...
-00016950: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00016960: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-00016970: 2d0d 0a20 2020 2020 2020 2049 6d67 4172  -..        ImgAr
-00016980: 7261 7920 2864 7479 7065 2069 7320 666c  ray (dtype is fl
-00016990: 6f61 7433 3220 6f72 2063 6f6d 706c 6578  oat32 or complex
-000169a0: 3634 290d 0a20 2020 2020 2020 2020 2020  64)..           
-000169b0: 2046 696c 7465 7265 6420 696d 6167 652e   Filtered image.
-000169c0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000169d0: 2020 2020 4578 616d 706c 6573 0d0a 2020      Examples..  
-000169e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
-000169f0: 2020 2020 2020 2020 4564 6765 2044 6574          Edge Det
-00016a00: 6563 7469 6f6e 2075 7369 6e67 206d 756c  ection using mul
-00016a10: 7469 2d61 6e67 6c65 2047 6162 6f72 2066  ti-angle Gabor f
-00016a20: 696c 7465 7269 6e67 2e0d 0a20 2020 2020  iltering...     
-00016a30: 2020 2020 2020 203e 3e3e 2074 6865 7461         >>> theta
-00016a40: 7320 3d20 6e70 2e64 6567 3272 6164 285b  s = np.deg2rad([
-00016a50: 302c 2034 352c 2039 302c 2031 3335 5d29  0, 45, 90, 135])
-00016a60: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-00016a70: 3e20 6f75 7420 3d20 6e70 2e7a 6572 6f73  > out = np.zeros
-00016a80: 2828 342c 292b 696d 672e 7368 6170 652c  ((4,)+img.shape,
-00016a90: 2064 7479 7065 3d6e 702e 666c 6f61 7433   dtype=np.float3
-00016aa0: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
-00016ab0: 3e3e 3e20 666f 7220 692c 2074 6865 7461  >>> for i, theta
-00016ac0: 2069 6e20 656e 756d 6572 6174 6528 7468   in enumerate(th
-00016ad0: 6574 6173 293a 0d0a 2020 2020 2020 2020  etas):..        
-00016ae0: 2020 2020 3e3e 3e20 2020 2020 6f75 745b      >>>     out[
-00016af0: 695d 203d 2069 6d67 2e67 6162 6f72 5f66  i] = img.gabor_f
-00016b00: 696c 7465 7228 7468 6574 613d 7468 6574  ilter(theta=thet
-00016b10: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-00016b20: 3e3e 3e20 6f75 7420 3d20 6e70 2e6d 6178  >>> out = np.max
-00016b30: 286f 7574 2c20 6178 6973 3d30 290d 0a20  (out, axis=0).. 
-00016b40: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-00016b50: 2020 0d0a 2020 2020 2020 2020 2320 544f    ..        # TO
-00016b60: 444f 3a20 3344 2047 6162 6f72 2066 696c  DO: 3D Gabor fil
-00016b70: 7465 720d 0a20 2020 2020 2020 206b 6572  ter..        ker
-00016b80: 203d 2073 6b66 696c 2e67 6162 6f72 5f6b   = skfil.gabor_k
-00016b90: 6572 6e65 6c28 312f 6c6d 642c 2074 6865  ernel(1/lmd, the
-00016ba0: 7461 2c20 302c 2073 6967 6d61 2c20 7369  ta, 0, sigma, si
-00016bb0: 676d 612f 6761 6d6d 612c 2033 2c20 7068  gma/gamma, 3, ph
-00016bc0: 6929 2e61 7374 7970 6528 6e70 2e63 6f6d  i).astype(np.com
-00016bd0: 706c 6578 3634 290d 0a20 2020 2020 2020  plex64)..       
-00016be0: 2069 6620 7265 7475 726e 5f69 6d61 673a   if return_imag:
-00016bf0: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-00016c00: 7420 3d20 7365 6c66 2e61 735f 666c 6f61  t = self.as_floa
-00016c10: 7428 292e 5f61 7070 6c79 5f64 6173 6b28  t()._apply_dask(
-00016c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016c30: 2020 5f66 696c 7465 7273 2e67 6162 6f72    _filters.gabor
-00016c40: 5f66 696c 7465 722c 200d 0a20 2020 2020  _filter, ..     
-00016c50: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
-00016c60: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
-00016c70: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
-00016c80: 7329 2c20 0d0a 2020 2020 2020 2020 2020  s), ..          
-00016c90: 2020 2020 2020 6172 6773 3d28 6b65 722c        args=(ker,
-00016ca0: 292c 200d 0a20 2020 2020 2020 2020 2020  ), ..           
-00016cb0: 2020 2020 2064 7479 7065 3d6e 702e 636f       dtype=np.co
-00016cc0: 6d70 6c65 7836 340d 0a20 2020 2020 2020  mplex64..       
-00016cd0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00016ce0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00016cf0: 2020 206f 7574 203d 2073 656c 662e 6173     out = self.as
-00016d00: 5f66 6c6f 6174 2829 2e5f 6170 706c 795f  _float()._apply_
-00016d10: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
-00016d20: 2020 2020 2020 205f 6669 6c74 6572 732e         _filters.
-00016d30: 636f 6e76 6f6c 7665 2c20 0d0a 2020 2020  convolve, ..    
-00016d40: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
-00016d50: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
-00016d60: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
-00016d70: 6573 292c 0d0a 2020 2020 2020 2020 2020  es),..          
-00016d80: 2020 2020 2020 6172 6773 3d28 6b65 722e        args=(ker.
-00016d90: 7265 616c 2c29 2c20 0d0a 2020 2020 2020  real,), ..      
-00016da0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
-00016db0: 6e70 2e66 6c6f 6174 3332 0d0a 2020 2020  np.float32..    
-00016dc0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00016dd0: 2020 2072 6574 7572 6e20 6f75 740d 0a20     return out.. 
-00016de0: 2020 200d 0a20 2020 2040 5f64 6f63 732e     ..    @_docs.
-00016df0: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
-00016e00: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-00016e10: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
-00016e20: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-00016e30: 7574 0d0a 2020 2020 6465 6620 6666 7428  ut..    def fft(
-00016e40: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
-00016e50: 0a20 2020 2020 2020 202a 2c20 0d0a 2020  .        *, ..  
-00016e60: 2020 2020 2020 7368 6170 653a 2069 6e74        shape: int
-00016e70: 207c 2049 7465 7261 626c 655b 696e 745d   | Iterable[int]
-00016e80: 207c 2046 6674 5368 6170 6520 3d20 2273   | FftShape = "s
-00016e90: 616d 6522 2c0d 0a20 2020 2020 2020 2073  ame",..        s
-00016ea0: 6869 6674 3a20 626f 6f6c 203d 2054 7275  hift: bool = Tru
-00016eb0: 652c 200d 0a20 2020 2020 2020 2064 6f75  e, ..        dou
-00016ec0: 626c 655f 7072 6563 6973 696f 6e3a 2062  ble_precision: b
-00016ed0: 6f6f 6c20 3d20 4661 6c73 652c 0d0a 2020  ool = False,..  
-00016ee0: 2020 2020 2020 6469 6d73 3a20 4469 6d73        dims: Dims
-00016ef0: 203d 204e 6f6e 650d 0a20 2020 2029 202d   = None..    ) -
-00016f00: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
-00016f10: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00016f20: 2020 4661 7374 2046 6f75 7269 6572 2074    Fast Fourier t
-00016f30: 7261 6e73 666f 726d 6174 696f 6e2e 2054  ransformation. T
-00016f40: 6869 7320 6675 6e63 7469 6f6e 2072 6574  his function ret
-00016f50: 7572 6e73 2063 6f6d 706c 6578 2061 7272  urns complex arr
-00016f60: 6179 2c20 7768 6963 6820 6973 0d0a 2020  ay, which is..  
-00016f70: 2020 2020 2020 696e 636f 6e70 6174 6962        inconpatib
-00016f80: 6c65 2077 6974 6820 736f 6d65 2049 6d67  le with some Img
-00016f90: 4172 7261 7920 6675 6e63 7469 6f6e 732e  Array functions.
-00016fa0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00016fb0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-00016fc0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00016fd0: 2d2d 0d0a 2020 2020 2020 2020 7368 6170  --..        shap
-00016fe0: 6520 3a20 696e 742c 2069 7465 7261 626c  e : int, iterabl
-00016ff0: 6520 6f66 2069 6e74 2c20 2273 7175 6172  e of int, "squar
-00017000: 6522 206f 7220 2273 616d 6522 0d0a 2020  e" or "same"..  
-00017010: 2020 2020 2020 2020 2020 4f75 7470 7574            Output
-00017020: 2073 6861 7065 2e20 496e 7075 7420 696d   shape. Input im
-00017030: 6167 6520 6973 2070 6164 6465 6420 6f72  age is padded or
-00017040: 2063 726f 7070 6564 2061 6363 6f72 6469   cropped accordi
-00017050: 6e67 2074 6f20 7468 6973 2076 616c 7565  ng to this value
-00017060: 3a0d 0a20 2020 2020 2020 2020 2020 202d  :..            -
-00017070: 2069 6e74 6567 6572 733a 2070 6164 6465   integers: padde
-00017080: 6420 6f72 2063 726f 7070 6564 2074 6f20  d or cropped to 
-00017090: 7468 6520 7370 6563 6966 6965 6420 7368  the specified sh
-000170a0: 6170 652e 0d0a 2020 2020 2020 2020 2020  ape...          
-000170b0: 2020 2d20 2273 7175 6172 6522 3a20 7061    - "square": pa
-000170c0: 6464 6564 2074 6f20 736d 616c 6c65 7374  dded to smallest
-000170d0: 2032 5e4e 2d6c 6f6e 6720 7371 7561 7265   2^N-long square
-000170e0: 2e0d 0a20 2020 2020 2020 2020 2020 202d  ...            -
-000170f0: 2022 7361 6d65 2220 2864 6566 6175 6c74   "same" (default
-00017100: 293a 206e 6f20 7061 6464 696e 6720 6f72  ): no padding or
-00017110: 2063 726f 7070 696e 672e 0d0a 2020 2020   cropping...    
-00017120: 2020 2020 7368 6966 7420 3a20 626f 6f6c      shift : bool
-00017130: 2c20 6465 6661 756c 7420 6973 2054 7275  , default is Tru
-00017140: 650d 0a20 2020 2020 2020 2020 2020 2049  e..            I
-00017150: 6620 5472 7565 2c20 6361 6c6c 2060 606e  f True, call ``n
-00017160: 702e 6666 742e 6666 7473 6869 6674 6060  p.fft.fftshift``
-00017170: 2069 6e20 7468 6520 656e 642e 0d0a 2020   in the end...  
-00017180: 2020 2020 2020 7b64 6f75 626c 655f 7072        {double_pr
-00017190: 6563 6973 696f 6e7d 0d0a 2020 2020 2020  ecision}..      
-000171a0: 2020 7b64 696d 737d 0d0a 2020 2020 2020    {dims}..      
-000171b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000171c0: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-000171d0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
-000171e0: 2020 496d 6741 7272 6179 0d0a 2020 2020    ImgArray..    
-000171f0: 2020 2020 2020 2020 4646 5420 696d 6167          FFT imag
-00017200: 652e 0d0a 2020 2020 2020 2020 0d0a 2020  e...        ..  
-00017210: 2020 2020 2020 5365 6520 416c 736f 0d0a        See Also..
-00017220: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00017230: 0d0a 2020 2020 2020 2020 6c6f 6361 6c5f  ..        local_
-00017240: 6466 740d 0a20 2020 2020 2020 2022 2222  dft..        """
-00017250: 0d0a 2020 2020 2020 2020 6178 6573 203d  ..        axes =
-00017260: 205b 7365 6c66 2e61 7869 736f 6628 6129   [self.axisof(a)
-00017270: 2066 6f72 2061 2069 6e20 6469 6d73 5d0d   for a in dims].
-00017280: 0a20 2020 2020 2020 2069 6620 7368 6170  .        if shap
-00017290: 6520 3d3d 2022 7371 7561 7265 223a 0d0a  e == "square":..
-000172a0: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
-000172b0: 322a 2a69 6e74 286e 702e 6365 696c 286e  2**int(np.ceil(n
-000172c0: 702e 6d61 7828 7365 6c66 2e73 697a 6573  p.max(self.sizes
-000172d0: 6f66 2864 696d 7329 2929 290d 0a20 2020  of(dims))))..   
-000172e0: 2020 2020 2020 2020 2073 6861 7065 203d           shape =
-000172f0: 2028 732c 2920 2a20 6c65 6e28 6469 6d73   (s,) * len(dims
-00017300: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00017310: 7368 6170 6520 3d3d 2022 7361 6d65 223a  shape == "same":
-00017320: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-00017330: 6170 6520 3d20 4e6f 6e65 0d0a 2020 2020  ape = None..    
-00017340: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00017350: 2020 2020 2020 2073 6861 7065 203d 2063         shape = c
-00017360: 6865 636b 5f6e 6428 7368 6170 652c 206c  heck_nd(shape, l
-00017370: 656e 2864 696d 7329 290d 0a20 2020 2020  en(dims))..     
-00017380: 2020 2064 7479 7065 203d 206e 702e 666c     dtype = np.fl
-00017390: 6f61 7436 3420 6966 2064 6f75 626c 655f  oat64 if double_
-000173a0: 7072 6563 6973 696f 6e20 656c 7365 206e  precision else n
-000173b0: 702e 666c 6f61 7433 320d 0a20 2020 2020  p.float32..     
-000173c0: 2020 2066 7265 7120 3d20 7870 2e66 6674     freq = xp.fft
-000173d0: 2e66 6674 6e28 7870 2e61 7361 7272 6179  .fftn(xp.asarray
-000173e0: 2873 656c 662e 7661 6c75 652c 2064 7479  (self.value, dty
-000173f0: 7065 3d64 7479 7065 292c 2073 3d73 6861  pe=dtype), s=sha
-00017400: 7065 2c20 6178 6573 3d61 7865 7329 0d0a  pe, axes=axes)..
-00017410: 2020 2020 2020 2020 6966 2073 6869 6674          if shift
-00017420: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00017430: 7265 715b 3a5d 203d 2078 702e 6666 742e  req[:] = xp.fft.
-00017440: 6666 7473 6869 6674 2866 7265 712c 2061  fftshift(freq, a
-00017450: 7865 733d 6178 6573 290d 0a20 2020 2020  xes=axes)..     
-00017460: 2020 2072 6574 7572 6e20 7870 2e61 736e     return xp.asn
-00017470: 756d 7079 2866 7265 712c 2064 7479 7065  umpy(freq, dtype
-00017480: 3d6e 702e 636f 6d70 6c65 7836 3429 0d0a  =np.complex64)..
-00017490: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
-000174a0: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
-000174b0: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
-000174c0: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
-000174d0: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
-000174e0: 7075 740d 0a20 2020 2064 6566 206c 6f63  put..    def loc
-000174f0: 616c 5f64 6674 280d 0a20 2020 2020 2020  al_dft(..       
-00017500: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
-00017510: 6b65 793a 2041 7865 7354 6172 6765 7465  key: AxesTargete
-00017520: 6453 6c69 6365 7220 7c20 4e6f 6e65 203d  dSlicer | None =
-00017530: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-00017540: 7570 7361 6d70 6c65 5f66 6163 746f 723a  upsample_factor:
-00017550: 206e 4449 6e74 203d 2031 2c0d 0a20 2020   nDInt = 1,..   
-00017560: 2020 2020 202a 2c0d 0a20 2020 2020 2020       *,..       
-00017570: 2064 6f75 626c 655f 7072 6563 6973 696f   double_precisio
-00017580: 6e3a 2062 6f6f 6c20 3d20 4661 6c73 652c  n: bool = False,
-00017590: 200d 0a20 2020 2020 2020 2064 696d 733a   ..        dims:
-000175a0: 2044 696d 7320 3d20 4e6f 6e65 0d0a 2020   Dims = None..  
-000175b0: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
-000175c0: 0d0a 2020 2020 2020 2020 7222 2222 0d0a  ..        r"""..
-000175d0: 2020 2020 2020 2020 4c6f 6361 6c20 6469          Local di
-000175e0: 7363 7265 7465 2046 6f75 7269 6572 2074  screte Fourier t
-000175f0: 7261 6e73 666f 726d 6174 696f 6e20 2844  ransformation (D
-00017600: 4654 292e 2054 6869 7320 6675 6e63 7469  FT). This functi
-00017610: 6f6e 2077 696c 6c20 6265 2075 7365 6675  on will be usefu
-00017620: 6c20 0d0a 2020 2020 2020 2020 666f 7220  l ..        for 
-00017630: 466f 7572 6965 7220 7472 616e 7366 6f72  Fourier transfor
-00017640: 6d61 7469 6f6e 206f 6620 736d 616c 6c20  mation of small 
-00017650: 7265 6769 6f6e 206f 6620 616e 2069 6d61  region of an ima
-00017660: 6765 2077 6974 6820 6120 6365 7274 6169  ge with a certai
-00017670: 6e0d 0a20 2020 2020 2020 2066 6163 746f  n..        facto
-00017680: 7220 6f66 2075 702d 7361 6d70 6c69 6e67  r of up-sampling
-00017690: 2e20 496e 2067 656e 6572 616c 2046 4654  . In general FFT
-000176a0: 2074 616b 6573 203a 6d61 7468 3a60 4f28   takes :math:`O(
-000176b0: 4e5c 6c6f 677b 4e7d 2960 2074 696d 652c  N\log{N})` time,
-000176c0: 206d 7563 680d 0a20 2020 2020 2020 2066   much..        f
-000176d0: 6173 7465 7220 636f 6d70 6172 6564 2074  aster compared t
-000176e0: 6f20 6e6f 726d 616c 2044 4654 2028 3a6d  o normal DFT (:m
-000176f0: 6174 683a 604f 284e 5e32 2960 292e 2048  ath:`O(N^2)`). H
-00017700: 6f77 6576 6572 2c20 4966 2079 6f75 2061  owever, If you a
-00017710: 7265 200d 0a20 2020 2020 2020 2069 6e74  re ..        int
-00017720: 6572 6573 7465 6420 696e 2063 6572 7461  erested in certa
-00017730: 696e 2072 6567 696f 6e20 6f66 2046 6f75  in region of Fou
-00017740: 7269 6572 2073 7061 6365 2c20 796f 7520  rier space, you 
-00017750: 646f 6e27 7420 6861 7665 2074 6f20 6361  don't have to ca
-00017760: 6c63 756c 6174 6520 0d0a 2020 2020 2020  lculate ..      
-00017770: 2020 616c 6c20 7468 6520 7370 6563 7472    all the spectr
-00017780: 612e 2049 6e20 7468 6973 2063 6173 6520  a. In this case 
-00017790: 4446 5420 6973 2066 6173 7465 7220 616e  DFT is faster an
-000177a0: 6420 6c65 7373 206d 656d 6f72 7920 636f  d less memory co
-000177b0: 6d73 756d 696e 672e 0d0a 2020 2020 2020  msuming...      
-000177c0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-000177d0: 2e2e 2077 6172 6e69 6e67 3a3a 0d0a 2020  .. warning::..  
-000177e0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-000177f0: 6520 7265 7375 6c74 206f 6620 6060 6c6f  e result of ``lo
-00017800: 6361 6c5f 6466 7460 6020 7769 6c6c 202a  cal_dft`` will *
-00017810: 2a4e 4f54 2a2a 2062 6520 7368 6966 7465  *NOT** be shifte
-00017820: 6420 7769 7468 200d 0a20 2020 2020 2020  d with ..       
-00017830: 2020 2020 2020 2020 2060 606e 702e 6666           ``np.ff
-00017840: 742e 6666 7473 6869 6674 6060 2062 6563  t.fftshift`` bec
-00017850: 6175 7365 2069 6e20 6765 6e65 7261 6c20  ause in general 
-00017860: 7468 6520 6365 6e74 6572 206f 6620 6172  the center of ar
-00017870: 7261 7973 2061 7265 0d0a 2020 2020 2020  rays are..      
-00017880: 2020 2020 2020 2020 2020 756e 6b6e 6f77            unknow
-00017890: 6e2e 2041 6c73 6f2c 2069 7420 6973 2065  n. Also, it is e
-000178a0: 6173 6965 7220 746f 2075 6e64 6572 7374  asier to underst
-000178b0: 616e 6420 6078 3d30 6020 636f 7272 6573  and `x=0` corres
-000178c0: 706f 6e64 7320 746f 2074 6865 0d0a 2020  ponds to the..  
-000178d0: 2020 2020 2020 2020 2020 2020 2020 6365                ce
-000178e0: 6e74 6572 2e0d 0a20 2020 2020 2020 200d  nter...        .
-000178f0: 0a20 2020 2020 2020 2045 7665 6e20 7768  .        Even wh
-00017900: 6f6c 6520 7370 6563 7472 756d 2069 7320  ole spectrum is 
-00017910: 7265 7475 726e 6564 2c20 6060 6c6f 6361  returned, ``loca
-00017920: 6c5f 6466 7460 6020 6d61 7920 6265 2066  l_dft`` may be f
-00017930: 6173 7465 7220 7468 616e 2046 4654 2077  aster than FFT w
-00017940: 6974 6820 0d0a 2020 2020 2020 2020 736d  ith ..        sm
-00017950: 616c 6c20 616e 642f 6f72 206e 6f6e 2d46  all and/or non-F
-00017960: 4654 2d66 7269 656e 646c 7920 7368 6170  FT-friendly shap
-00017970: 6564 2069 6d61 6765 2e0d 0a0d 0a20 2020  ed image.....   
-00017980: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-00017990: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000179a0: 2d2d 2d0d 0a20 2020 2020 2020 206b 6579  ---..        key
-000179b0: 203a 2073 7472 0d0a 2020 2020 2020 2020   : str..        
-000179c0: 2020 2020 4b65 7920 7374 7269 6e67 2074      Key string t
-000179d0: 6861 7420 7370 6563 6966 7920 7265 6769  hat specify regi
-000179e0: 6f6e 2074 6f20 4446 542c 2073 7563 6820  on to DFT, such 
-000179f0: 6173 2022 793d 2d35 303a 3130 3b78 3d3a  as "y=-50:10;x=:
-00017a00: 3830 222e 2057 6974 680d 0a20 2020 2020  80". With..     
-00017a10: 2020 2020 2020 2075 7073 616d 706c 6564         upsampled
-00017a20: 2073 7065 6374 7261 2c20 6b65 7973 2063   spectra, keys c
-00017a30: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
-00017a40: 6520 636f 6f72 6469 6e61 7465 202a 2a62  e coordinate **b
-00017a50: 6566 6f72 652a 2a20 0d0a 2020 2020 2020  efore** ..      
-00017a60: 2020 2020 2020 7570 2d73 616d 706c 696e        up-samplin
-00017a70: 672e 2049 6620 796f 7520 7761 6e74 2063  g. If you want c
-00017a80: 6572 7461 696e 2072 6567 696f 6e2c 2073  ertain region, s
-00017a90: 6179 2022 783d 3130 3a32 3022 2c20 7468  ay "x=10:20", th
-00017aa0: 6973 2076 616c 7565 200d 0a20 2020 2020  is value ..     
-00017ab0: 2020 2020 2020 2077 696c 6c20 6e6f 7420         will not 
-00017ac0: 6368 616e 6765 2077 6974 6820 6469 6666  change with diff
-00017ad0: 6572 656e 7420 6060 7570 7361 6d70 6c65  erent ``upsample
-00017ae0: 5f66 6163 746f 7260 602e 0d0a 2020 2020  _factor``...    
-00017af0: 2020 2020 7570 7361 6d70 6c65 5f66 6163      upsample_fac
-00017b00: 746f 7220 3a20 696e 7420 6f72 2061 7272  tor : int or arr
-00017b10: 6179 206f 6620 696e 742c 2064 6566 6175  ay of int, defau
-00017b20: 6c74 2069 7320 310d 0a20 2020 2020 2020  lt is 1..       
-00017b30: 2020 2020 2055 702d 7361 6d70 6c69 6e67       Up-sampling
-00017b40: 2066 6163 746f 722e 2046 6f72 2069 6e73   factor. For ins
-00017b50: 7461 6e63 652c 2077 6865 6e20 6060 7570  tance, when ``up
-00017b60: 7361 6d70 6c65 5f66 6163 746f 723d 3130  sample_factor=10
-00017b70: 6060 2061 2073 696e 676c 650d 0a20 2020  `` a single..   
-00017b80: 2020 2020 2020 2020 2070 6978 656c 2077           pixel w
-00017b90: 696c 6c20 6265 2065 7870 616e 6465 6420  ill be expanded 
-00017ba0: 746f 2031 3020 7069 7865 6c73 2e0d 0a20  to 10 pixels... 
-00017bb0: 2020 2020 2020 207b 646f 7562 6c65 5f70         {double_p
-00017bc0: 7265 6369 7369 6f6e 7d0d 0a20 2020 2020  recision}..     
-00017bd0: 2020 207b 6469 6d73 7d0d 0a0d 0a20 2020     {dims}....   
-00017be0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-00017bf0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-00017c00: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
-00017c10: 0a20 2020 2020 2020 2020 2020 2044 4654  .            DFT
-00017c20: 206f 7574 7075 742e 0d0a 2020 2020 2020   output...      
-00017c30: 2020 0d0a 2020 2020 2020 2020 5365 6520    ..        See 
-00017c40: 416c 736f 0d0a 2020 2020 2020 2020 2d2d  Also..        --
-00017c50: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00017c60: 6666 740d 0a20 2020 2020 2020 2022 2222  fft..        """
-00017c70: 0d0a 2020 2020 2020 2020 6e64 696d 203d  ..        ndim =
-00017c80: 206c 656e 2864 696d 7329 0d0a 2020 2020   len(dims)..    
-00017c90: 2020 2020 7570 7361 6d70 6c65 5f66 6163      upsample_fac
-00017ca0: 746f 7220 3d20 6368 6563 6b5f 6e64 2875  tor = check_nd(u
-00017cb0: 7073 616d 706c 655f 6661 6374 6f72 2c20  psample_factor, 
-00017cc0: 6e64 696d 290d 0a20 2020 2020 2020 200d  ndim)..        .
-00017cd0: 0a20 2020 2020 2020 2023 2064 6574 6572  .        # deter
-00017ce0: 6d69 6e65 2068 6f77 2074 6f20 736c 6963  mine how to slic
-00017cf0: 6520 7468 6520 7265 7375 6c74 206f 6620  e the result of 
-00017d00: 4646 540d 0a20 2020 2020 2020 2069 6620  FFT..        if 
-00017d10: 6b65 7920 6973 204e 6f6e 653a 0d0a 2020  key is None:..  
-00017d20: 2020 2020 2020 2020 2020 736c 6963 6573            slices
-00017d30: 203d 2028 736c 6963 6528 4e6f 6e65 292c   = (slice(None),
-00017d40: 2029 202a 206e 6469 6d0d 0a20 2020 2020   ) * ndim..     
-00017d50: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00017d60: 2020 2020 2020 736c 6963 6573 203d 2073        slices = s
-00017d70: 6f6c 7665 5f73 6c69 6365 7228 6b65 792c  olve_slicer(key,
-00017d80: 2041 7865 7328 6469 6d73 2929 0d0a 2020   Axes(dims))..  
-00017d90: 2020 2020 2020 6474 7970 6520 3d20 6e70        dtype = np
-00017da0: 2e63 6f6d 706c 6578 3132 3820 6966 2064  .complex128 if d
-00017db0: 6f75 626c 655f 7072 6563 6973 696f 6e20  ouble_precision 
-00017dc0: 656c 7365 206e 702e 636f 6d70 6c65 7836  else np.complex6
-00017dd0: 340d 0a20 2020 2020 2020 200d 0a20 2020  4..        ..   
-00017de0: 2020 2020 2023 2043 616c 6375 6c61 7465       # Calculate
-00017df0: 2065 7870 282d 696b 7829 0d0a 2020 2020   exp(-ikx)..    
-00017e00: 2020 2020 2320 546f 206d 696e 696d 697a      # To minimiz
-00017e10: 6520 666c 6f61 7469 6e67 2065 7272 6f72  e floating error
-00017e20: 2c20 7468 6520 4120 7465 726d 2069 6e20  , the A term in 
-00017e30: 6578 7028 2d32 2a70 692a 692a 4129 2073  exp(-2*pi*i*A) s
-00017e40: 686f 756c 6420 6265 2069 6e20 7468 6520  hould be in the 
-00017e50: 7261 6e67 6520 6f66 200d 0a20 2020 2020  range of ..     
-00017e60: 2020 2023 2030 203c 3d20 4120 3c20 312e     # 0 <= A < 1.
-00017e70: 0d0a 2020 2020 2020 2020 6578 7073 3a20  ..        exps: 
-00017e80: 6c69 7374 5b78 702e 6e64 6172 7261 795d  list[xp.ndarray]
-00017e90: 203d 205c 0d0a 2020 2020 2020 2020 2020   = \..          
-00017ea0: 2020 5b78 702e 6578 7028 2d32 6a20 2a20    [xp.exp(-2j * 
-00017eb0: 6e70 2e70 6920 2a20 7870 2e6d 6f64 2877  np.pi * xp.mod(w
-00017ec0: 6176 655f 6e75 6d28 736c 2c20 732c 2075  ave_num(sl, s, u
-00017ed0: 6629 202a 2078 702e 6172 616e 6765 2873  f) * xp.arange(s
-00017ee0: 292f 732c 2031 2e29 2c20 6474 7970 653d  )/s, 1.), dtype=
-00017ef0: 6474 7970 6529 0d0a 2020 2020 2020 2020  dtype)..        
-00017f00: 2020 2020 2066 6f72 2073 6c2c 2073 2c20       for sl, s, 
-00017f10: 7566 2069 6e20 7a69 7028 736c 6963 6573  uf in zip(slices
-00017f20: 2c20 7365 6c66 2e73 697a 6573 6f66 2864  , self.sizesof(d
-00017f30: 696d 7329 2c20 7570 7361 6d70 6c65 5f66  ims), upsample_f
-00017f40: 6163 746f 7229 5d0d 0a20 2020 2020 2020  actor)]..       
-00017f50: 200d 0a20 2020 2020 2020 2023 2043 616c   ..        # Cal
-00017f60: 6375 6c61 7465 2063 6875 6e6b 2073 697a  culate chunk siz
-00017f70: 6520 666f 7220 7072 6f70 6572 206f 7574  e for proper out
-00017f80: 7075 7420 7368 6170 6573 0d0a 2020 2020  put shapes..    
-00017f90: 2020 2020 6f75 745f 6368 756e 6b73 203d      out_chunks =
-00017fa0: 206e 702e 6f6e 6573 2873 656c 662e 6e64   np.ones(self.nd
-00017fb0: 696d 2c20 6474 7970 653d 6e70 2e69 6e74  im, dtype=np.int
-00017fc0: 3634 290d 0a20 2020 2020 2020 2066 6f72  64)..        for
-00017fd0: 2069 2c20 6120 696e 2065 6e75 6d65 7261   i, a in enumera
-00017fe0: 7465 2864 696d 7329 3a0d 0a20 2020 2020  te(dims):..     
-00017ff0: 2020 2020 2020 2069 6e64 203d 2073 656c         ind = sel
-00018000: 662e 6178 6973 6f66 2861 290d 0a20 2020  f.axisof(a)..   
-00018010: 2020 2020 2020 2020 206f 7574 5f63 6875           out_chu
-00018020: 6e6b 735b 696e 645d 203d 2065 7870 735b  nks[ind] = exps[
-00018030: 695d 2e73 6861 7065 5b30 5d0d 0a20 2020  i].shape[0]..   
-00018040: 2020 2020 206f 7574 5f63 6875 6e6b 7320       out_chunks 
-00018050: 3d20 7475 706c 6528 6f75 745f 6368 756e  = tuple(out_chun
-00018060: 6b73 290d 0a20 2020 2020 2020 200d 0a20  ks)..        .. 
-00018070: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00018080: 6c66 2e61 735f 666c 6f61 7428 292e 5f61  lf.as_float()._a
-00018090: 7070 6c79 5f64 6173 6b28 0d0a 2020 2020  pply_dask(..    
-000180a0: 2020 2020 2020 2020 5f6d 6973 632e 6466          _misc.df
-000180b0: 742c 200d 0a20 2020 2020 2020 2020 2020  t, ..           
-000180c0: 2063 6f6d 706c 656d 656e 745f 6178 6573   complement_axes
-000180d0: 2864 696d 732c 2073 656c 662e 6178 6573  (dims, self.axes
-000180e0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-000180f0: 6474 7970 653d 6e70 2e63 6f6d 706c 6578  dtype=np.complex
-00018100: 3634 2c20 0d0a 2020 2020 2020 2020 2020  64, ..          
-00018110: 2020 6f75 745f 6368 756e 6b73 3d6f 7574    out_chunks=out
-00018120: 5f63 6875 6e6b 732c 0d0a 2020 2020 2020  _chunks,..      
-00018130: 2020 2020 2020 6b77 6172 6773 3d64 6963        kwargs=dic
-00018140: 7428 6578 7073 3d65 7870 7329 0d0a 2020  t(exps=exps)..  
-00018150: 2020 2020 2020 290d 0a20 2020 200d 0a20        )..    .. 
-00018160: 2020 2040 5f64 6f63 732e 7772 6974 655f     @_docs.write_
-00018170: 646f 6373 0d0a 2020 2020 4064 696d 735f  docs..    @dims_
-00018180: 746f 5f73 7061 7469 616c 5f61 7865 730d  to_spatial_axes.
-00018190: 0a20 2020 2040 6368 6563 6b5f 696e 7075  .    @check_inpu
-000181a0: 745f 616e 645f 6f75 7470 7574 0d0a 2020  t_and_output..  
-000181b0: 2020 6465 6620 6c6f 6361 6c5f 706f 7765    def local_powe
-000181c0: 725f 7370 6563 7472 6128 0d0a 2020 2020  r_spectra(..    
-000181d0: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-000181e0: 2020 206b 6579 3a20 4178 6573 5461 7267     key: AxesTarg
-000181f0: 6574 6564 536c 6963 6572 207c 204e 6f6e  etedSlicer | Non
-00018200: 6520 3d20 4e6f 6e65 2c0d 0a20 2020 2020  e = None,..     
-00018210: 2020 2075 7073 616d 706c 655f 6661 6374     upsample_fact
-00018220: 6f72 3a20 6e44 496e 7420 3d20 312c 0d0a  or: nDInt = 1,..
-00018230: 2020 2020 2020 2020 6e6f 726d 3a20 626f          norm: bo
-00018240: 6f6c 203d 2046 616c 7365 2c0d 0a20 2020  ol = False,..   
-00018250: 2020 2020 202a 2c20 0d0a 2020 2020 2020       *, ..      
-00018260: 2020 646f 7562 6c65 5f70 7265 6369 7369    double_precisi
-00018270: 6f6e 3a20 626f 6f6c 203d 2046 616c 7365  on: bool = False
-00018280: 2c0d 0a20 2020 2020 2020 2064 696d 733a  ,..        dims:
-00018290: 2044 696d 7320 3d20 4e6f 6e65 0d0a 2020   Dims = None..  
-000182a0: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
-000182b0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000182c0: 2020 2020 2020 2052 6574 7572 6e20 6c6f         Return lo
-000182d0: 6361 6c20 6e2d 4420 706f 7765 7220 7370  cal n-D power sp
-000182e0: 6563 7472 6120 6f66 2069 6d61 6765 732e  ectra of images.
-000182f0: 2053 6565 2060 606c 6f63 616c 5f64 6674   See ``local_dft
-00018300: 6060 2e0d 0a0d 0a20 2020 2020 2020 2050  ``.....        P
-00018310: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-00018320: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00018330: 2020 2020 2020 206b 6579 203a 2073 7472         key : str
-00018340: 0d0a 2020 2020 2020 2020 2020 2020 4b65  ..            Ke
-00018350: 7920 7374 7269 6e67 2074 6861 7420 7370  y string that sp
-00018360: 6563 6966 7920 7265 6769 6f6e 2074 6f20  ecify region to 
-00018370: 4446 542c 2073 7563 6820 6173 2022 793d  DFT, such as "y=
-00018380: 2d35 303a 3130 3b78 3d3a 3830 222e 2057  -50:10;x=:80". W
-00018390: 6974 6820 5570 7361 6d70 6c65 6420 7370  ith Upsampled sp
-000183a0: 6563 7472 612c 206b 6579 730d 0a20 2020  ectra, keys..   
-000183b0: 2020 2020 2020 2020 2063 6f72 7265 7370           corresp
-000183c0: 6f6e 6473 2074 6f20 7468 6520 636f 6f72  onds to the coor
-000183d0: 6469 6e61 7465 202a 2a62 6566 6f72 652a  dinate **before*
-000183e0: 2a20 7570 2d73 616d 706c 696e 672e 2049  * up-sampling. I
-000183f0: 6620 796f 7520 7761 6e74 2063 6572 7461  f you want certa
-00018400: 696e 2072 6567 696f 6e2c 2073 6179 2022  in region, say "
-00018410: 783d 3130 3a32 3022 2c0d 0a20 2020 2020  x=10:20",..     
-00018420: 2020 2020 2020 2074 6869 7320 7661 6c75         this valu
-00018430: 6520 7769 6c6c 206e 6f74 2063 6861 6e67  e will not chang
-00018440: 6520 7769 7468 2064 6966 6665 7265 6e74  e with different
-00018450: 2060 6075 7073 616d 706c 655f 6661 6374   ``upsample_fact
-00018460: 6f72 6060 2e0d 0a20 2020 2020 2020 2075  or``...        u
-00018470: 7073 616d 706c 655f 6661 6374 6f72 203a  psample_factor :
-00018480: 2069 6e74 206f 7220 6172 7261 7920 6f66   int or array of
-00018490: 2069 6e74 2c20 6465 6661 756c 7420 6973   int, default is
-000184a0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-000184b0: 5570 2d73 616d 706c 696e 6720 6661 6374  Up-sampling fact
-000184c0: 6f72 2e20 466f 7220 696e 7374 616e 6365  or. For instance
-000184d0: 2c20 7768 656e 2060 6075 7073 616d 706c  , when ``upsampl
-000184e0: 655f 6661 6374 6f72 3d31 3060 6020 6120  e_factor=10`` a 
-000184f0: 7369 6e67 6c65 2070 6978 656c 2077 696c  single pixel wil
-00018500: 6c20 6265 2065 7870 616e 6465 6420 746f  l be expanded to
-00018510: 0d0a 2020 2020 2020 2020 2020 2020 3130  ..            10
-00018520: 2070 6978 656c 732e 0d0a 2020 2020 2020   pixels...      
-00018530: 2020 6e6f 726d 203a 2062 6f6f 6c2c 2064    norm : bool, d
-00018540: 6566 6175 6c74 2069 7320 4661 6c73 650d  efault is False.
-00018550: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00018560: 5472 7565 2c20 6d61 7869 6d75 6d20 7661  True, maximum va
-00018570: 6c75 6520 6f66 2070 6f77 6572 2073 7065  lue of power spe
-00018580: 6374 7261 2069 7320 6164 6a75 7374 6564  ctra is adjusted
-00018590: 2074 6f20 312e 0d0a 2020 2020 2020 2020   to 1...        
-000185a0: 7b64 6f75 626c 655f 7072 6563 6973 696f  {double_precisio
-000185b0: 6e7d 0d0a 2020 2020 2020 2020 7b64 696d  n}..        {dim
-000185c0: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
-000185d0: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-000185e0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-000185f0: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00018600: 2020 2020 2020 506f 7765 7220 7370 6563        Power spec
-00018610: 7472 610d 0a20 2020 2020 2020 200d 0a20  tra..        .. 
-00018620: 2020 2020 2020 2053 6565 2041 6c73 6f0d         See Also.
-00018630: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00018640: 2d0d 0a20 2020 2020 2020 2070 6f77 6572  -..        power
-00018650: 5f73 7065 6374 7261 0d0a 2020 2020 2020  _spectra..      
-00018660: 2020 2222 2220 2020 2020 2020 200d 0a20    """        .. 
-00018670: 2020 2020 2020 2066 7265 7120 3d20 7365         freq = se
-00018680: 6c66 2e6c 6f63 616c 5f64 6674 286b 6579  lf.local_dft(key
-00018690: 2c20 7570 7361 6d70 6c65 5f66 6163 746f  , upsample_facto
-000186a0: 723d 7570 7361 6d70 6c65 5f66 6163 746f  r=upsample_facto
-000186b0: 722c 200d 0a20 2020 2020 2020 2020 2020  r, ..           
-000186c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186d0: 2020 2064 6f75 626c 655f 7072 6563 6973     double_precis
-000186e0: 696f 6e3d 646f 7562 6c65 5f70 7265 6369  ion=double_preci
-000186f0: 7369 6f6e 2c20 6469 6d73 3d64 696d 7329  sion, dims=dims)
-00018700: 0d0a 2020 2020 2020 2020 7077 203d 2066  ..        pw = f
-00018710: 7265 712e 7265 616c 2a2a 3220 2b20 6672  req.real**2 + fr
-00018720: 6571 2e69 6d61 672a 2a32 0d0a 2020 2020  eq.imag**2..    
-00018730: 2020 2020 6966 206e 6f72 6d3a 0d0a 2020      if norm:..  
-00018740: 2020 2020 2020 2020 2020 7077 202f 3d20            pw /= 
-00018750: 7077 2e6d 6178 2829 0d0a 2020 2020 2020  pw.max()..      
-00018760: 2020 7265 7475 726e 2070 770d 0a20 2020    return pw..   
-00018770: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
-00018780: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
-00018790: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
-000187a0: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
-000187b0: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
-000187c0: 0d0a 2020 2020 6465 6620 6966 6674 280d  ..    def ifft(.
-000187d0: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
-000187e0: 2020 2020 2020 2020 7265 616c 3a20 626f          real: bo
-000187f0: 6f6c 203d 2054 7275 652c 0d0a 2020 2020  ol = True,..    
-00018800: 2020 2020 2a2c 0d0a 2020 2020 2020 2020      *,..        
-00018810: 7368 6966 743a 2062 6f6f 6c20 3d20 5472  shift: bool = Tr
-00018820: 7565 2c0d 0a20 2020 2020 2020 2064 6f75  ue,..        dou
-00018830: 626c 655f 7072 6563 6973 696f 6e20 3d20  ble_precision = 
-00018840: 4661 6c73 652c 200d 0a20 2020 2020 2020  False, ..       
-00018850: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
-00018860: 6e65 0d0a 2020 2020 2920 2d3e 2049 6d67  ne..    ) -> Img
-00018870: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
-00018880: 2222 220d 0a20 2020 2020 2020 2046 6173  """..        Fas
-00018890: 7420 496e 7665 7273 6520 466f 7572 6965  t Inverse Fourie
-000188a0: 7220 7472 616e 7366 6f72 6d61 7469 6f6e  r transformation
-000188b0: 2e20 436f 6d70 6c65 6d65 6e74 6172 7920  . Complementary 
-000188c0: 6675 6e63 7469 6f6e 2077 6974 6820 6066  function with `f
-000188d0: 6674 2829 602e 0d0a 2020 2020 2020 2020  ft()`...        
-000188e0: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-000188f0: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00018900: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00018910: 2020 7265 616c 203a 2062 6f6f 6c2c 2064    real : bool, d
-00018920: 6566 6175 6c74 2069 7320 5472 7565 0d0a  efault is True..
-00018930: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00018940: 7275 652c 206f 6e6c 7920 7468 6520 7265  rue, only the re
-00018950: 616c 2070 6172 7420 6973 2072 6574 7572  al part is retur
-00018960: 6e65 642e 0d0a 2020 2020 2020 2020 7368  ned...        sh
-00018970: 6966 7420 3a20 626f 6f6c 2c20 6465 6661  ift : bool, defa
-00018980: 756c 7420 6973 2054 7275 650d 0a20 2020  ult is True..   
-00018990: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-000189a0: 2c20 6361 6c6c 2060 606e 702e 6666 742e  , call ``np.fft.
-000189b0: 6966 6674 7368 6966 7460 6020 6174 2074  ifftshift`` at t
-000189c0: 6865 2066 6972 7374 2e0d 0a20 2020 2020  he first...     
-000189d0: 2020 207b 646f 7562 6c65 5f70 7265 6369     {double_preci
-000189e0: 7369 6f6e 7d0d 0a20 2020 2020 2020 207b  sion}..        {
-000189f0: 6469 6d73 7d0d 0a20 2020 2020 2020 2020  dims}..         
-00018a00: 2020 200d 0a20 2020 2020 2020 2052 6574     ..        Ret
-00018a10: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
-00018a20: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
-00018a30: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
-00018a40: 2020 2020 2049 4646 5420 696d 6167 652e       IFFT image.
-00018a50: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00018a60: 2020 2020 2020 2061 7865 7320 3d20 5b73         axes = [s
-00018a70: 656c 662e 6178 6973 6f66 2861 2920 666f  elf.axisof(a) fo
-00018a80: 7220 6120 696e 2064 696d 735d 0d0a 2020  r a in dims]..  
-00018a90: 2020 2020 2020 6966 2073 6869 6674 3a0d        if shift:.
-00018aa0: 0a20 2020 2020 2020 2020 2020 2066 7265  .            fre
-00018ab0: 7120 3d20 6e70 2e66 6674 2e69 6666 7473  q = np.fft.iffts
-00018ac0: 6869 6674 2873 656c 662e 7661 6c75 652c  hift(self.value,
-00018ad0: 2061 7865 733d 6178 6573 290d 0a20 2020   axes=axes)..   
-00018ae0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00018af0: 2020 2020 2020 2020 6672 6571 203d 2073          freq = s
-00018b00: 656c 662e 7661 6c75 650d 0a20 2020 2020  elf.value..     
-00018b10: 2020 2064 7479 7065 203d 206e 702e 636f     dtype = np.co
-00018b20: 6d70 6c65 7831 3238 2069 6620 646f 7562  mplex128 if doub
-00018b30: 6c65 5f70 7265 6369 7369 6f6e 2065 6c73  le_precision els
-00018b40: 6520 6e70 2e63 6f6d 706c 6578 3634 0d0a  e np.complex64..
-00018b50: 2020 2020 2020 2020 6f75 7420 3d20 7870          out = xp
-00018b60: 2e66 6674 2e69 6666 746e 280d 0a20 2020  .fft.ifftn(..   
-00018b70: 2020 2020 2020 2020 2078 702e 6173 6172           xp.asar
-00018b80: 7261 7928 6672 6571 2c20 6474 7970 653d  ray(freq, dtype=
-00018b90: 6474 7970 6529 2c20 0d0a 2020 2020 2020  dtype), ..      
-00018ba0: 2020 2020 2020 6178 6573 3d61 7865 730d        axes=axes.
-00018bb0: 0a20 2020 2020 2020 2029 2e61 7374 7970  .        ).astyp
-00018bc0: 6528 6e70 2e63 6f6d 706c 6578 3634 290d  e(np.complex64).
-00018bd0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00018be0: 2020 2069 6620 7265 616c 3a0d 0a20 2020     if real:..   
-00018bf0: 2020 2020 2020 2020 206f 7574 203d 206e           out = n
-00018c00: 702e 7265 616c 286f 7574 290d 0a20 2020  p.real(out)..   
-00018c10: 2020 2020 2072 6574 7572 6e20 7870 2e61       return xp.a
-00018c20: 736e 756d 7079 286f 7574 290d 0a20 2020  snumpy(out)..   
-00018c30: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
-00018c40: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
-00018c50: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
-00018c60: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
-00018c70: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
-00018c80: 0d0a 2020 2020 6465 6620 706f 7765 725f  ..    def power_
-00018c90: 7370 6563 7472 6128 0d0a 2020 2020 2020  spectra(..      
-00018ca0: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-00018cb0: 2073 6861 7065 3a20 696e 7420 7c20 4974   shape: int | It
-00018cc0: 6572 6162 6c65 5b69 6e74 5d20 7c20 4666  erable[int] | Ff
-00018cd0: 7453 6861 7065 203d 2022 7361 6d65 222c  tShape = "same",
-00018ce0: 0d0a 2020 2020 2020 2020 6e6f 726d 3a20  ..        norm: 
-00018cf0: 626f 6f6c 203d 2046 616c 7365 2c20 0d0a  bool = False, ..
-00018d00: 2020 2020 2020 2020 7a65 726f 5f6e 6f72          zero_nor
-00018d10: 6d3a 2062 6f6f 6c20 3d20 4661 6c73 652c  m: bool = False,
-00018d20: 202a 2c0d 0a20 2020 2020 2020 2064 6f75   *,..        dou
-00018d30: 626c 655f 7072 6563 6973 696f 6e3a 2062  ble_precision: b
-00018d40: 6f6f 6c20 3d20 4661 6c73 652c 0d0a 2020  ool = False,..  
-00018d50: 2020 2020 2020 6469 6d73 3a20 4469 6d73        dims: Dims
-00018d60: 203d 204e 6f6e 650d 0a20 2020 2029 202d   = None..    ) -
-00018d70: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
-00018d80: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00018d90: 2020 5265 7475 726e 206e 2d44 2070 6f77    Return n-D pow
-00018da0: 6572 2073 7065 6374 7261 206f 6620 696d  er spectra of im
-00018db0: 6167 6573 2c20 7768 6963 6820 6973 2064  ages, which is d
-00018dc0: 6566 696e 6564 2061 733a 0d0a 2020 2020  efined as:..    
-00018dd0: 2020 2020 0d0a 2020 2020 2020 2020 2e2e      ..        ..
-00018de0: 206d 6174 683a 3a0d 0a20 2020 2020 2020   math::..       
-00018df0: 200d 0a20 2020 2020 2020 2020 2020 2050   ..            P
-00018e00: 203d 2052 6528 465b 495f 7b69 6d67 7d5d   = Re(F[I_{img}]
-00018e10: 295e 3220 2b20 496d 2846 5b49 5f7b 696d  )^2 + Im(F[I_{im
-00018e20: 677d 5d29 5e32 0d0a 0d0a 2020 2020 2020  g}])^2....      
-00018e30: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-00018e40: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00018e50: 0d0a 2020 2020 2020 2020 7368 6170 6520  ..        shape 
-00018e60: 3a20 696e 742c 2069 7465 7261 626c 6520  : int, iterable 
-00018e70: 6f66 2069 6e74 2c20 2273 7175 6172 6522  of int, "square"
-00018e80: 206f 7220 2273 616d 6522 0d0a 2020 2020   or "same"..    
-00018e90: 2020 2020 2020 2020 4f75 7470 7574 2073          Output s
-00018ea0: 6861 7065 2e20 496e 7075 7420 696d 6167  hape. Input imag
-00018eb0: 6520 6973 2070 6164 6465 6420 6f72 2063  e is padded or c
-00018ec0: 726f 7070 6564 2061 6363 6f72 6469 6e67  ropped according
-00018ed0: 2074 6f20 7468 6973 2076 616c 7565 3a0d   to this value:.
-00018ee0: 0a20 2020 2020 2020 2020 2020 202d 2069  .            - i
-00018ef0: 6e74 6567 6572 733a 2070 6164 6465 6420  ntegers: padded 
-00018f00: 6f72 2063 726f 7070 6564 2074 6f20 7468  or cropped to th
-00018f10: 6520 7370 6563 6966 6965 6420 7368 6170  e specified shap
-00018f20: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
-00018f30: 2d20 2273 7175 6172 6522 3a20 7061 6464  - "square": padd
-00018f40: 6564 2074 6f20 736d 616c 6c65 7374 2032  ed to smallest 2
-00018f50: 5e4e 2d6c 6f6e 6720 7371 7561 7265 2e0d  ^N-long square..
-00018f60: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
-00018f70: 7361 6d65 2220 2864 6566 6175 6c74 293a  same" (default):
-00018f80: 206e 6f20 7061 6464 696e 6720 6f72 2063   no padding or c
-00018f90: 726f 7070 696e 672e 0d0a 2020 2020 2020  ropping...      
-00018fa0: 2020 6e6f 726d 203a 2062 6f6f 6c2c 2064    norm : bool, d
-00018fb0: 6566 6175 6c74 2069 7320 4661 6c73 650d  efault is False.
-00018fc0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00018fd0: 5472 7565 2c20 6d61 7869 6d75 6d20 7661  True, maximum va
-00018fe0: 6c75 6520 6f66 2070 6f77 6572 2073 7065  lue of power spe
-00018ff0: 6374 7261 2069 7320 6164 6a75 7374 6564  ctra is adjusted
-00019000: 2074 6f20 312e 0d0a 2020 2020 2020 2020   to 1...        
-00019010: 7b64 6f75 626c 655f 7072 6563 6973 696f  {double_precisio
-00019020: 6e7d 0d0a 2020 2020 2020 2020 7b64 696d  n}..        {dim
-00019030: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
-00019040: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-00019050: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00019060: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00019070: 2020 2020 2020 506f 7765 7220 7370 6563        Power spec
-00019080: 7472 610d 0a20 2020 2020 2020 200d 0a20  tra..        .. 
-00019090: 2020 2020 2020 2053 6565 2041 6c73 6f0d         See Also.
-000190a0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000190b0: 2d0d 0a20 2020 2020 2020 206c 6f63 616c  -..        local
-000190c0: 5f70 6f77 6572 5f73 7065 6374 7261 0d0a  _power_spectra..
-000190d0: 2020 2020 2020 2020 2222 2220 2020 2020          """     
-000190e0: 2020 200d 0a20 2020 2020 2020 2066 7265     ..        fre
-000190f0: 7120 3d20 7365 6c66 2e66 6674 2864 696d  q = self.fft(dim
-00019100: 733d 6469 6d73 2c20 7368 6170 653d 7368  s=dims, shape=sh
-00019110: 6170 652c 2064 6f75 626c 655f 7072 6563  ape, double_prec
-00019120: 6973 696f 6e3d 646f 7562 6c65 5f70 7265  ision=double_pre
-00019130: 6369 7369 6f6e 290d 0a20 2020 2020 2020  cision)..       
-00019140: 2070 7720 3d20 6672 6571 2e72 6561 6c2a   pw = freq.real*
-00019150: 2a32 202b 2066 7265 712e 696d 6167 2a2a  *2 + freq.imag**
-00019160: 320d 0a20 2020 2020 2020 2069 6620 6e6f  2..        if no
-00019170: 726d 3a0d 0a20 2020 2020 2020 2020 2020  rm:..           
-00019180: 2070 7720 2f3d 2070 772e 6d61 7828 290d   pw /= pw.max().
-00019190: 0a20 2020 2020 2020 2070 773a 2049 6d67  .        pw: Img
-000191a0: 4172 7261 790d 0a20 2020 2020 2020 2069  Array..        i
-000191b0: 6620 7a65 726f 5f6e 6f72 6d3a 0d0a 2020  f zero_norm:..  
-000191c0: 2020 2020 2020 2020 2020 736c 203d 2073            sl = s
-000191d0: 7769 7463 685f 736c 6963 6528 6469 6d73  witch_slice(dims
-000191e0: 2c20 7077 2e61 7865 732c 2069 6669 6e3d  , pw.axes, ifin=
-000191f0: 6e70 2e61 7272 6179 2870 772e 7368 6170  np.array(pw.shap
-00019200: 6529 2f2f 322c 2069 666e 6f74 3d73 6c69  e)//2, ifnot=sli
-00019210: 6365 284e 6f6e 6529 290d 0a20 2020 2020  ce(None))..     
-00019220: 2020 2020 2020 2070 775b 736c 5d20 3d20         pw[sl] = 
-00019230: 300d 0a20 2020 2020 2020 2072 6574 7572  0..        retur
-00019240: 6e20 7077 0d0a 0d0a 2020 2020 405f 646f  n pw....    @_do
-00019250: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
-00019260: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
-00019270: 6961 6c5f 6178 6573 0d0a 2020 2020 6465  ial_axes..    de
-00019280: 6620 7261 646f 6e28 0d0a 2020 2020 2020  f radon(..      
-00019290: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-000192a0: 2064 6567 7265 6573 3a20 666c 6f61 7420   degrees: float 
-000192b0: 7c20 4974 6572 6162 6c65 5b66 6c6f 6174  | Iterable[float
-000192c0: 5d2c 200d 0a20 2020 2020 2020 202a 2c0d  ], ..        *,.
-000192d0: 0a20 2020 2020 2020 2063 656e 7472 616c  .        central
-000192e0: 5f61 7869 733a 2041 7869 734c 696b 6520  _axis: AxisLike 
-000192f0: 7c20 5365 7175 656e 6365 5b66 6c6f 6174  | Sequence[float
-00019300: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-00019310: 0d0a 2020 2020 2020 2020 6f72 6465 723a  ..        order:
-00019320: 2069 6e74 203d 2033 2c0d 0a20 2020 2020   int = 3,..     
-00019330: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
-00019340: 4e6f 6e65 2c0d 0a20 2020 2029 202d 3e20  None,..    ) -> 
-00019350: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
-00019360: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00019370: 4469 7363 7265 7465 2052 6164 6f6e 2074  Discrete Radon t
-00019380: 7261 6e73 666f 726d 6174 696f 6e20 6f66  ransformation of
-00019390: 2032 4420 6f72 2033 4420 696d 6167 652e   2D or 3D image.
-000193a0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000193b0: 2020 2020 5261 646f 6e20 7472 616e 7366      Radon transf
-000193c0: 6f72 6d61 7469 6f6e 2069 7320 6120 6c69  ormation is a li
-000193d0: 7374 206f 6620 7072 6f6a 6563 7469 6f6e  st of projection
-000193e0: 206f 6620 6120 7361 6d65 2069 6d61 6765   of a same image
-000193f0: 2066 726f 6d20 6469 6666 6572 656e 7420   from different 
-00019400: 616e 676c 6573 2e0d 0a20 2020 2020 2020  angles...       
-00019410: 2049 7420 6765 6e65 7261 7465 7320 746f   It generates to
-00019420: 6d6f 6772 6170 6869 6320 6e2d 4420 696d  mographic n-D im
-00019430: 6167 6520 736c 6963 6573 2066 726f 6d20  age slices from 
-00019440: 286e 2b31 292d 4420 696d 6167 652e 0d0a  (n+1)-D image...
-00019450: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00019460: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00019470: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00019480: 2020 6465 6772 6565 7320 3a20 666c 6f61    degrees : floa
-00019490: 7420 6f72 2069 7465 7261 626c 6520 6f66  t or iterable of
-000194a0: 2066 6c6f 6174 0d0a 2020 2020 2020 2020   float..        
-000194b0: 2020 2020 526f 7461 7469 6f6e 2061 6e67      Rotation ang
-000194c0: 6c65 7320 6172 6f75 6e64 2074 6865 2063  les around the c
-000194d0: 656e 7472 616c 2061 7869 7320 696e 2064  entral axis in d
-000194e0: 6567 7265 6573 2e0d 0a20 2020 2020 2020  egrees...       
-000194f0: 2063 656e 7472 616c 5f61 7869 7320 3a20   central_axis : 
-00019500: 6178 6973 2d6c 696b 6520 6f72 2073 6571  axis-like or seq
-00019510: 7565 6e63 6520 6f66 2066 6c6f 6174 2c20  uence of float, 
-00019520: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00019530: 2020 2020 2020 5665 6374 6f72 2074 6861        Vector tha
-00019540: 7420 6465 6669 6e65 7320 7468 6520 6365  t defines the ce
-00019550: 6e74 7261 6c20 6178 6973 206f 6620 726f  ntral axis of ro
-00019560: 7461 7469 6f6e 2e0d 0a20 2020 2020 2020  tation...       
-00019570: 207b 6f72 6465 727d 7b64 696d 737d 0d0a   {order}{dims}..
-00019580: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00019590: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-000195a0: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
-000195b0: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
-000195c0: 2020 546f 6d6f 6772 6170 6869 6320 696d    Tomographic im
-000195d0: 6167 6520 736c 6963 6573 2e20 5468 6520  age slices. The 
-000195e0: 6669 7273 7420 7370 6174 6961 6c20 6178  first spatial ax
-000195f0: 6973 2028 227a 2220 666f 7220 7a79 782d  is ("z" for zyx-
-00019600: 696d 6167 6529 2077 696c 6c20 6265 2064  image) will be d
-00019610: 726f 7070 6564 2e0d 0a20 2020 2020 2020  ropped...       
-00019620: 2020 2020 2049 6620 7365 7175 656e 6365       If sequence
-00019630: 206f 6620 666c 6f61 7420 6973 2067 6976   of float is giv
-00019640: 656e 2061 7320 6060 6465 6772 6565 7360  en as ``degrees`
-00019650: 602c 2022 6465 6772 6565 2220 6178 6973  `, "degree" axis
-00019660: 2077 696c 6c20 6265 206e 6577 6c79 2061   will be newly a
-00019670: 6464 6564 2061 740d 0a20 2020 2020 2020  dded at..       
-00019680: 2020 2020 2074 6865 2070 6f73 6974 696f       the positio
-00019690: 6e20 302e 2046 6f72 2069 6e73 7461 6e63  n 0. For instanc
-000196a0: 652c 2069 6620 6120 7a79 782d 696d 6167  e, if a zyx-imag
-000196b0: 6520 616e 6420 6060 6465 6772 6565 733d  e and ``degrees=
-000196c0: 6e70 2e6c 696e 7370 6163 6528 302c 2031  np.linspace(0, 1
-000196d0: 3830 2c20 3130 3029 6060 0d0a 2020 2020  80, 100)``..    
-000196e0: 2020 2020 2020 2020 6172 6520 6769 7665          are give
-000196f0: 6e2c 2072 6574 7572 6e65 6420 696d 6167  n, returned imag
-00019700: 6520 6861 7320 6178 6573 205b 2264 6567  e has axes ["deg
-00019710: 7265 6522 2c20 2279 222c 2022 7822 5d2e  ree", "y", "x"].
-00019720: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00019730: 2020 2020 5365 6520 416c 736f 0d0a 2020      See Also..  
-00019740: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
-00019750: 2020 2020 2020 2020 6972 6164 6f6e 0d0a          iradon..
-00019760: 2020 2020 2020 2020 2222 2220 2020 2020          """     
-00019770: 2020 200d 0a20 2020 2020 2020 2066 726f     ..        fro
-00019780: 6d20 6461 736b 2069 6d70 6f72 7420 6172  m dask import ar
-00019790: 7261 7920 6173 2064 612c 2064 656c 6179  ray as da, delay
-000197a0: 6564 0d0a 2020 2020 2020 2020 0d0a 2020  ed..        ..  
-000197b0: 2020 2020 2020 7061 7261 6d73 2c20 6f75        params, ou
-000197c0: 7470 7574 5f73 6861 7065 2c20 7371 7565  tput_shape, sque
-000197d0: 657a 6520 3d20 5f74 7261 6e73 666f 726d  eze = _transform
-000197e0: 2e6e 6f72 6d61 6c69 7a65 5f72 6164 6f6e  .normalize_radon
-000197f0: 5f69 6e70 7574 280d 0a20 2020 2020 2020  _input(..       
-00019800: 2020 2020 2073 656c 662c 2064 696d 732c       self, dims,
-00019810: 2063 656e 7472 616c 5f61 7869 732c 2064   central_axis, d
-00019820: 6567 7265 6573 0d0a 2020 2020 2020 2020  egrees..        
-00019830: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-00019840: 2020 2020 2023 2061 7070 6c79 2073 706c       # apply spl
-00019850: 696e 6520 6669 6c74 6572 2069 6e20 6164  ine filter in ad
-00019860: 7661 6e63 652e 0d0a 2020 2020 2020 2020  vance...        
-00019870: 696e 7075 7420 3d20 7365 6c66 2e61 735f  input = self.as_
-00019880: 666c 6f61 7428 292e 7370 6c69 6e65 5f66  float().spline_f
-00019890: 696c 7465 7228 6f72 6465 723d 6f72 6465  ilter(order=orde
-000198a0: 7229 0d0a 2020 2020 2020 2020 6465 6c61  r)..        dela
-000198b0: 7965 645f 6675 6e63 203d 2064 656c 6179  yed_func = delay
-000198c0: 6564 285f 7472 616e 7366 6f72 6d2e 7261  ed(_transform.ra
-000198d0: 646f 6e5f 7369 6e67 6c65 290d 0a20 2020  don_single)..   
-000198e0: 2020 2020 2074 6173 6b73 203d 205b 0d0a       tasks = [..
-000198f0: 2020 2020 2020 2020 2020 2020 6465 6c61              dela
-00019900: 7965 645f 6675 6e63 2869 6e70 7574 2c20  yed_func(input, 
-00019910: 702c 206f 7264 6572 3d6f 7264 6572 2c20  p, order=order, 
-00019920: 6f75 7470 7574 5f73 6861 7065 3d6f 7574  output_shape=out
-00019930: 7075 745f 7368 6170 6529 200d 0a20 2020  put_shape) ..   
-00019940: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
-00019950: 6e20 7061 7261 6d73 0d0a 2020 2020 2020  n params..      
-00019960: 2020 5d0d 0a20 2020 2020 2020 206f 7574    ]..        out
-00019970: 203d 2078 702e 7374 6163 6b28 6461 2e63   = xp.stack(da.c
-00019980: 6f6d 7075 7465 2874 6173 6b73 295b 305d  ompute(tasks)[0]
-00019990: 2c20 6178 6973 3d30 290d 0a0d 0a20 2020  , axis=0)....   
-000199a0: 2020 2020 206f 7574 203d 2078 702e 6173       out = xp.as
-000199b0: 6e75 6d70 7928 6f75 7429 2e76 6965 7728  numpy(out).view(
-000199c0: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 290d  self.__class__).
-000199d0: 0a20 2020 2020 2020 206f 7574 2e5f 7365  .        out._se
-000199e0: 745f 696e 666f 2873 656c 662c 2073 656c  t_info(self, sel
-000199f0: 662e 6178 6573 2e64 726f 7028 3029 2e69  f.axes.drop(0).i
-00019a00: 6e73 6572 7428 302c 2022 6465 6772 6565  nsert(0, "degree
-00019a10: 2229 290d 0a20 2020 2020 2020 206f 7574  "))..        out
-00019a20: 2e61 7865 735b 305d 2e6c 6162 656c 7320  .axes[0].labels 
-00019a30: 3d20 6c69 7374 2864 6567 7265 6573 290d  = list(degrees).
-00019a40: 0a20 2020 2020 2020 2069 6620 7371 7565  .        if sque
-00019a50: 657a 653a 0d0a 2020 2020 2020 2020 2020  eze:..          
-00019a60: 2020 6f75 7420 3d20 6f75 745b 305d 0d0a    out = out[0]..
-00019a70: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-00019a80: 7574 0d0a 2020 2020 0d0a 2020 2020 405f  ut..    ..    @_
-00019a90: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-00019aa0: 0a20 2020 2064 6566 2069 7261 646f 6e28  .    def iradon(
-00019ab0: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
-00019ac0: 0a20 2020 2020 2020 2064 6567 7265 6573  .        degrees
-00019ad0: 3a20 5365 7175 656e 6365 5b66 6c6f 6174  : Sequence[float
-00019ae0: 5d2c 0d0a 2020 2020 2020 2020 2a2c 0d0a  ],..        *,..
-00019af0: 2020 2020 2020 2020 6365 6e74 7261 6c5f          central_
-00019b00: 6178 6973 3a20 4178 6973 4c69 6b65 203d  axis: AxisLike =
-00019b10: 2022 7922 2c0d 0a20 2020 2020 2020 2064   "y",..        d
-00019b20: 6567 7265 655f 6178 6973 3a20 4178 6973  egree_axis: Axis
-00019b30: 4c69 6b65 207c 204e 6f6e 6520 3d20 4e6f  Like | None = No
-00019b40: 6e65 2c0d 0a20 2020 2020 2020 2068 6569  ne,..        hei
-00019b50: 6768 745f 6178 6973 3a20 4178 6973 4c69  ght_axis: AxisLi
-00019b60: 6b65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ke | None = None
-00019b70: 2c0d 0a20 2020 2020 2020 2068 6569 6768  ,..        heigh
-00019b80: 743a 2069 6e74 207c 204e 6f6e 6520 3d20  t: int | None = 
-00019b90: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2077  None,..        w
-00019ba0: 696e 646f 773a 2073 7472 203d 2022 6861  indow: str = "ha
-00019bb0: 6d6d 696e 6722 2c0d 0a20 2020 2020 2020  mming",..       
-00019bc0: 206f 7264 6572 3a20 696e 7420 3d20 332c   order: int = 3,
-00019bd0: 0d0a 2020 2020 2920 2d3e 2049 6d67 4172  ..    ) -> ImgAr
-00019be0: 7261 793a 0d0a 2020 2020 2020 2020 2222  ray:..        ""
-00019bf0: 220d 0a20 2020 2020 2020 2049 6e76 6572  "..        Inver
-00019c00: 7365 2052 6164 6f6e 2074 7261 6e73 666f  se Radon transfo
-00019c10: 726d 6174 696f 6e20 2877 6569 6768 7465  rmation (weighte
-00019c20: 6420 6261 636b 2070 726f 6a65 6374 696f  d back projectio
-00019c30: 6e29 206f 6620 6120 7469 6c65 2073 6572  n) of a tile ser
-00019c40: 6965 732e 0d0a 2020 2020 2020 2020 0d0a  ies...        ..
-00019c50: 2020 2020 2020 2020 496e 7075 7420 6172          Input ar
-00019c60: 7261 7920 6d75 7374 2062 6520 6120 7469  ray must be a ti
-00019c70: 6c74 2073 6572 6965 7320 6f66 2031 4420  lt series of 1D 
-00019c80: 6f72 2032 4420 696d 6167 6573 2e20 5468  or 2D images. Th
-00019c90: 6579 2061 7265 2062 6163 6b2d 0d0a 2020  ey are back-..  
-00019ca0: 2020 2020 2020 7072 6f6a 6563 7465 6420        projected 
-00019cb0: 696e 746f 2061 2032 4420 6f72 2033 4420  into a 2D or 3D 
-00019cc0: 696d 6167 6520 7769 7468 2061 7262 6974  image with arbit
-00019cd0: 7261 7279 2068 6569 6768 742e 0d0a 0d0a  rary height.....
-00019ce0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00019cf0: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-00019d00: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00019d10: 6465 6772 6565 7320 3a20 7365 7175 656e  degrees : sequen
-00019d20: 6365 206f 6620 666c 6f61 740d 0a20 2020  ce of float..   
-00019d30: 2020 2020 2020 2020 2050 726f 6a65 6374           Project
-00019d40: 696f 6e20 616e 676c 6573 2069 6e20 6465  ion angles in de
-00019d50: 6772 6565 2e20 4c65 6e67 7468 206d 7573  gree. Length mus
-00019d60: 7420 6d61 7463 6820 7468 6520 6c65 6e67  t match the leng
-00019d70: 7468 206f 6620 7468 6520 6465 6772 6565  th of the degree
-00019d80: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-00019d90: 6973 206f 6620 7468 6520 696e 7075 7420  is of the input 
-00019da0: 696d 6167 652e 0d0a 2020 2020 2020 2020  image...        
-00019db0: 6365 6e74 7261 6c5f 6178 6973 203a 2041  central_axis : A
-00019dc0: 7869 734c 696b 652c 206f 7074 696f 6e61  xisLike, optiona
-00019dd0: 6c0d 0a20 2020 2020 2020 2020 2020 2041  l..            A
-00019de0: 7869 7320 7061 7261 6c6c 656c 2074 6f20  xis parallel to 
-00019df0: 7468 6520 726f 7461 7469 6f6e 2061 7869  the rotation axi
-00019e00: 732e 0d0a 2020 2020 2020 2020 6465 6772  s...        degr
-00019e10: 6565 5f61 7869 7320 3a20 4178 6973 4c69  ee_axis : AxisLi
-00019e20: 6b65 2c20 6f70 7469 6f6e 616c 0d0a 2020  ke, optional..  
-00019e30: 2020 2020 2020 2020 2020 4178 6973 206f            Axis o
-00019e40: 6620 726f 7461 7469 6f6e 2064 6567 7265  f rotation degre
-00019e50: 652e 2042 7920 6465 6661 756c 742c 2074  e. By default, t
-00019e60: 6865 2066 6972 7374 2061 7869 7320 7769  he first axis wi
-00019e70: 6c6c 2062 6520 7573 6564 2e0d 0a20 2020  ll be used...   
-00019e80: 2020 2020 2068 6569 6768 745f 6178 6973       height_axis
-00019e90: 203a 2041 7869 734c 696b 652c 206f 7074   : AxisLike, opt
-00019ea0: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
-00019eb0: 2020 2041 7869 7320 7468 6174 2077 696c     Axis that wil
-00019ec0: 6c20 6265 2075 7365 6420 746f 206c 6162  l be used to lab
-00019ed0: 656c 2074 6865 206e 6577 2061 7869 7320  el the new axis 
-00019ee0: 6166 7465 7220 7265 636f 6e73 7472 7563  after reconstruc
-00019ef0: 7469 6f6e 2e20 466f 720d 0a20 2020 2020  tion. For..     
-00019f00: 2020 2020 2020 2069 6e73 7461 6e63 652c         instance,
-00019f10: 2069 6620 696e 7075 7420 696d 6167 6520   if input image 
-00019f20: 6861 7320 6178 6573 2060 605b 2264 6567  has axes ``["deg
-00019f30: 7265 6522 2c20 2279 222c 2022 7822 5d60  ree", "y", "x"]`
-00019f40: 6020 616e 6420 0d0a 2020 2020 2020 2020  ` and ..        
-00019f50: 2020 2020 6060 6865 6967 6874 5f61 7869      ``height_axi
-00019f60: 733d 227a 2260 6020 7468 656e 2072 6563  s="z"`` then rec
-00019f70: 6f6e 7374 7275 6374 6564 2069 6d61 6765  onstructed image
-00019f80: 2077 696c 6c20 6861 7665 2061 7865 7320   will have axes 
-00019f90: 0d0a 2020 2020 2020 2020 2020 2020 6060  ..            ``
-00019fa0: 5b22 7a22 2c20 2279 222c 2022 7822 5d60  ["z", "y", "x"]`
-00019fb0: 602e 2042 7920 6465 6661 756c 742c 2022  `. By default, "
-00019fc0: 7922 2077 696c 6c20 6265 2075 7365 6420  y" will be used 
-00019fd0: 666f 7220 3244 2069 6e70 7574 206f 7220  for 2D input or 
-00019fe0: 227a 2220 666f 720d 0a20 2020 2020 2020  "z" for..       
-00019ff0: 2020 2020 2033 4420 696e 7075 742e 0d0a       3D input...
-0001a000: 2020 2020 2020 2020 6865 6967 6874 203a          height :
-0001a010: 2069 6e74 2c20 6f70 7469 6f6e 616c 0d0a   int, optional..
-0001a020: 2020 2020 2020 2020 2020 2020 4865 6967              Heig
-0001a030: 6874 206f 6620 7265 636f 6e73 7472 7563  ht of reconstruc
-0001a040: 7469 6f6e 2e20 4279 2064 6566 6175 6c74  tion. By default
-0001a050: 2c20 7369 7a65 2065 7175 616c 2074 6f20  , size equal to 
-0001a060: 7468 6520 6178 6973 2070 6572 7065 6e64  the axis perpend
-0001a070: 6963 756c 6172 0d0a 2020 2020 2020 2020  icular..        
-0001a080: 2020 2020 746f 2074 6865 2072 6f74 6174      to the rotat
-0001a090: 696f 6e20 6178 6973 2077 696c 6c20 6265  ion axis will be
-0001a0a0: 2075 7365 642e 0d0a 2020 2020 2020 2020   used...        
-0001a0b0: 7769 6e64 6f77 203a 2073 7472 2c20 6465  window : str, de
-0001a0c0: 6661 756c 7420 6973 2022 6861 6d6d 696e  fault is "hammin
-0001a0d0: 6722 0d0a 2020 2020 2020 2020 2020 2020  g"..            
-0001a0e0: 5769 6e64 6f77 2066 756e 6374 696f 6e20  Window function 
-0001a0f0: 7468 6174 2077 696c 6c20 6265 2061 7070  that will be app
-0001a100: 6c69 6564 2074 6f20 7468 6520 466f 7572  lied to the Four
-0001a110: 6965 7220 646f 6d61 696e 2061 6c6f 6e67  ier domain along
-0001a120: 2074 6865 2061 7869 730d 0a20 2020 2020   the axis..     
-0001a130: 2020 2020 2020 2070 6572 7065 6e64 6963         perpendic
-0001a140: 756c 6172 2074 6f20 7468 6520 726f 7461  ular to the rota
-0001a150: 7469 6f6e 2061 7869 732e 0d0a 2020 2020  tion axis...    
-0001a160: 2020 2020 7b6f 7264 6572 7d0d 0a0d 0a20      {order}.... 
-0001a170: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
-0001a180: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
-0001a190: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
-0001a1a0: 790d 0a20 2020 2020 2020 2020 2020 2052  y..            R
-0001a1b0: 6563 6f6e 7374 7275 6374 696f 6e2e 0d0a  econstruction...
-0001a1c0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0001a1d0: 2020 2020 2020 5365 6520 416c 736f 0d0a        See Also..
-0001a1e0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0001a1f0: 0d0a 2020 2020 2020 2020 7261 646f 6e0d  ..        radon.
-0001a200: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0001a210: 2020 2020 2020 696e 7465 7270 203d 207b        interp = {
-0001a220: 303a 2022 6e65 6172 6573 7422 2c20 313a  0: "nearest", 1:
-0001a230: 2022 6c69 6e65 6172 222c 2033 3a20 2263   "linear", 3: "c
-0001a240: 7562 6963 227d 5b6f 7264 6572 5d0d 0a20  ubic"}[order].. 
-0001a250: 2020 2020 2020 2063 656e 7472 616c 5f61         central_a
-0001a260: 7869 732c 2064 6567 7265 655f 6178 6973  xis, degree_axis
-0001a270: 2c20 6f75 7470 7574 5f73 6861 7065 2c20  , output_shape, 
-0001a280: 6e65 775f 6178 6573 203d 205f 7472 616e  new_axes = _tran
-0001a290: 7366 6f72 6d2e 6e6f 726d 616c 697a 655f  sform.normalize_
-0001a2a0: 6972 6164 6f6e 5f69 6e70 7574 280d 0a20  iradon_input(.. 
-0001a2b0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-0001a2c0: 2063 656e 7472 616c 5f61 7869 732c 2068   central_axis, h
-0001a2d0: 6569 6768 745f 6178 6973 2c20 6465 6772  eight_axis, degr
-0001a2e0: 6565 5f61 7869 732c 2068 6569 6768 740d  ee_axis, height.
-0001a2f0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0001a300: 2020 2020 7365 6c66 3a20 496d 6741 7272      self: ImgArr
-0001a310: 6179 203d 206e 702e 6d6f 7665 6178 6973  ay = np.moveaxis
-0001a320: 2873 656c 662c 2073 656c 662e 6178 6973  (self, self.axis
-0001a330: 6f66 2864 6567 7265 655f 6178 6973 292c  of(degree_axis),
-0001a340: 202d 3129 0d0a 2020 2020 2020 2020 6669   -1)..        fi
-0001a350: 6c74 6572 5f66 756e 6320 3d20 5f74 7261  lter_func = _tra
-0001a360: 6e73 666f 726d 2e67 6574 5f66 6f75 7269  nsform.get_fouri
-0001a370: 6572 5f66 696c 7465 7228 7365 6c66 2e73  er_filter(self.s
-0001a380: 6861 7065 5b2d 325d 2c20 7769 6e64 6f77  hape[-2], window
-0001a390: 290d 0a20 2020 2020 2020 206f 7574 203d  )..        out =
-0001a3a0: 2073 656c 662e 5f61 7070 6c79 5f64 6173   self._apply_das
-0001a3b0: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
-0001a3c0: 5f74 7261 6e73 666f 726d 2e69 7261 646f  _transform.irado
-0001a3d0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0001a3e0: 635f 6178 6573 3d5b 6365 6e74 7261 6c5f  c_axes=[central_
-0001a3f0: 6178 6973 5d2c 0d0a 2020 2020 2020 2020  axis],..        
-0001a400: 2020 2020 6b77 6172 6773 3d64 6963 7428      kwargs=dict(
-0001a410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a420: 2020 6465 6772 6565 733d 6465 6772 6565    degrees=degree
-0001a430: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0001a440: 2020 2020 696e 7465 7270 6f6c 6174 696f      interpolatio
-0001a450: 6e3d 696e 7465 7270 2c0d 0a20 2020 2020  n=interp,..     
-0001a460: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-0001a470: 725f 6675 6e63 3d66 696c 7465 725f 6675  r_func=filter_fu
-0001a480: 6e63 2c0d 0a20 2020 2020 2020 2020 2020  nc,..           
-0001a490: 2020 2020 206f 7574 7075 745f 7368 6170       output_shap
-0001a4a0: 653d 6f75 7470 7574 5f73 6861 7065 2c0d  e=output_shape,.
-0001a4b0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-0001a4c0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0001a4d0: 2020 200d 0a20 2020 2020 2020 2069 6620     ..        if 
-0001a4e0: 6f75 742e 6e64 696d 203d 3d20 333a 0d0a  out.ndim == 3:..
-0001a4f0: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
-0001a500: 3d20 6e70 2e6d 6f76 6561 7869 7328 6f75  = np.moveaxis(ou
-0001a510: 742c 2030 2c20 3129 0d0a 2020 2020 2020  t, 0, 1)..      
-0001a520: 2020 6f75 7420 3d20 6f75 745b 3a3a 2d31    out = out[::-1
-0001a530: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
-0001a540: 6e20 6f75 742e 5f73 6574 5f69 6e66 6f28  n out._set_info(
-0001a550: 7365 6c66 2c20 6e65 775f 6178 6573 290d  self, new_axes).
-0001a560: 0a0d 0a20 2020 2040 6368 6563 6b5f 696e  ...    @check_in
-0001a570: 7075 745f 616e 645f 6f75 7470 7574 0d0a  put_and_output..
-0001a580: 2020 2020 6465 6620 7468 7265 7368 6f6c      def threshol
-0001a590: 6428 0d0a 2020 2020 2020 2020 7365 6c66  d(..        self
-0001a5a0: 2c0d 0a20 2020 2020 2020 2074 6872 3a20  ,..        thr: 
-0001a5b0: 666c 6f61 7420 7c20 7374 7220 7c20 5468  float | str | Th
-0001a5c0: 7265 6173 686f 6c64 4d65 7468 6f64 203d  reasholdMethod =
-0001a5d0: 2022 6f74 7375 222c 0d0a 2020 2020 2020   "otsu",..      
-0001a5e0: 2020 2a2c 0d0a 2020 2020 2020 2020 616c    *,..        al
-0001a5f0: 6f6e 673a 2041 7869 734c 696b 6520 7c20  ong: AxisLike | 
-0001a600: 4e6f 6e65 203d 204e 6f6e 652c 0d0a 2020  None = None,..  
-0001a610: 2020 2020 2020 2a2a 6b77 6172 6773 0d0a        **kwargs..
-0001a620: 2020 2020 2920 2d3e 2049 6d67 4172 7261      ) -> ImgArra
-0001a630: 793a 0d0a 2020 2020 2020 2020 2222 220d  y:..        """.
-0001a640: 0a20 2020 2020 2020 2041 7070 6c79 2074  .        Apply t
-0001a650: 6872 6573 686f 6c64 696e 6720 746f 2074  hresholding to t
-0001a660: 6865 2069 6d61 6765 2061 6e64 2063 7265  he image and cre
-0001a670: 6174 6520 6120 6269 6e61 7279 2069 6d61  ate a binary ima
-0001a680: 6765 2e0d 0a20 2020 2020 2020 200d 0a20  ge...        .. 
-0001a690: 2020 2020 2020 2054 6865 2074 6872 6573         The thres
-0001a6a0: 686f 6c64 2076 616c 7565 2063 616e 2062  hold value can b
-0001a6b0: 6520 6769 7665 6e20 7769 7468 2061 2066  e given with a f
-0001a6c0: 6c6f 6174 206f 7220 6120 7374 7269 6e67  loat or a string
-0001a6d0: 2074 6861 7420 696e 6469 6361 7465 7320   that indicates 
-0001a6e0: 7768 6174 0d0a 2020 2020 2020 2020 7468  what..        th
-0001a6f0: 7265 7368 6f6c 6469 6e67 206d 6574 686f  resholding metho
-0001a700: 6420 7769 6c6c 2062 6520 7573 6564 2e0d  d will be used..
-0001a710: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-0001a720: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-0001a730: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001a740: 2d0d 0a20 2020 2020 2020 2074 6872 3a20  -..        thr: 
-0001a750: 666c 6f61 7420 6f72 2073 7472 2c20 6f70  float or str, op
-0001a760: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-0001a770: 2020 2020 5468 7265 7368 6f6c 6420 7661      Threshold va
-0001a780: 6c75 652c 2070 6572 6365 6e74 6167 6520  lue, percentage 
-0001a790: 6f72 2074 6872 6573 686f 6c64 696e 6720  or thresholding 
-0001a7a0: 616c 676f 7269 7468 6d2e 0d0a 2020 2020  algorithm...    
-0001a7b0: 2020 2020 616c 6f6e 6720 3a20 4178 6973      along : Axis
-0001a7c0: 4c69 6b65 2c20 6f70 7469 6f6e 616c 0d0a  Like, optional..
-0001a7d0: 2020 2020 2020 2020 2020 2020 4469 6d65              Dime
-0001a7e0: 6e73 696f 6e73 2074 6861 7420 7769 6c6c  nsions that will
-0001a7f0: 206e 6f74 2073 6861 7265 2074 6865 2073   not share the s
-0001a800: 616d 6520 7468 7265 7368 6f6c 642e 2046  ame threshold. F
-0001a810: 6f72 2069 6e73 7461 6e63 652c 2069 660d  or instance, if.
-0001a820: 0a20 2020 2020 2020 2020 2020 2060 6061  .            ``a
-0001a830: 6c6f 6e67 3d22 6322 6060 2074 6865 6e20  long="c"`` then 
-0001a840: 7468 7265 7368 6f6c 6420 696e 7465 6e73  threshold intens
-0001a850: 6974 6965 7320 6172 6520 6465 7465 726d  ities are determ
-0001a860: 696e 6564 2066 6f72 2065 7665 7279 2063  ined for every c
-0001a870: 6861 6e6e 656c 2e0d 0a20 2020 2020 2020  hannel...       
-0001a880: 2020 2020 2049 6620 6060 7468 7260 6020       If ``thr`` 
-0001a890: 6973 2066 6c6f 6174 2c20 6060 616c 6f6e  is float, ``alon
-0001a8a0: 6760 6020 7769 6c6c 2062 6520 6967 6e6f  g`` will be igno
-0001a8b0: 7265 642e 0d0a 2020 2020 2020 2020 2a2a  red...        **
-0001a8c0: 6b77 6172 6773 3a0d 0a20 2020 2020 2020  kwargs:..       
-0001a8d0: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
-0001a8e0: 756d 656e 7473 2074 6861 7420 7769 6c6c  uments that will
-0001a8f0: 2070 6173 7365 6420 746f 2066 756e 6374   passed to funct
-0001a900: 696f 6e20 696e 6469 6361 7465 6420 696e  ion indicated in
-0001a910: 2027 6d65 7468 6f64 272e 0d0a 0d0a 2020   'method'.....  
-0001a920: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
-0001a930: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
-0001a940: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
-0001a950: 0d0a 2020 2020 2020 2020 2020 2020 426f  ..            Bo
-0001a960: 6f6c 6961 6e20 6172 7261 792e 0d0a 2020  olian array...  
-0001a970: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0001a980: 4578 616d 706c 6573 0d0a 2020 2020 2020  Examples..      
-0001a990: 2020 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020    --------..    
-0001a9a0: 2020 2020 5375 6273 7469 7475 7465 206f      Substitute o
-0001a9b0: 7574 6c69 6572 7320 746f 2030 2e0d 0a20  utliers to 0... 
-0001a9c0: 2020 2020 2020 2020 2020 203e 3e3e 2074             >>> t
-0001a9d0: 6872 203d 2069 6d67 2e74 6872 6573 686f  hr = img.thresho
-0001a9e0: 6c64 2822 3939 2522 290d 0a20 2020 2020  ld("99%")..     
-0001a9f0: 2020 2020 2020 203e 3e3e 2069 6d67 5b74         >>> img[t
-0001aa00: 6872 5d20 3d20 300d 0a20 2020 2020 2020  hr] = 0..       
-0001aa10: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-0001aa20: 2073 656c 662e 6474 7970 6520 3d3d 2062   self.dtype == b
-0001aa30: 6f6f 6c3a 0d0a 2020 2020 2020 2020 2020  ool:..          
-0001aa40: 2020 7265 7475 726e 2073 656c 660d 0a20    return self.. 
-0001aa50: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0001aa60: 2069 6620 616c 6f6e 6720 6973 204e 6f6e   if along is Non
-0001aa70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001aa80: 616c 6f6e 6720 3d20 2263 2220 6966 2022  along = "c" if "
-0001aa90: 6322 2069 6e20 7365 6c66 2e61 7865 7320  c" in self.axes 
-0001aaa0: 656c 7365 2022 220d 0a0d 0a20 2020 2020  else ""....     
-0001aab0: 2020 206d 6574 686f 6473 5f20 3d20 7b22     methods_ = {"
-0001aac0: 6973 6f64 6174 6122 3a20 736b 6669 6c2e  isodata": skfil.
-0001aad0: 7468 7265 7368 6f6c 645f 6973 6f64 6174  threshold_isodat
-0001aae0: 612c 0d0a 2020 2020 2020 2020 2020 2020  a,..            
-0001aaf0: 2020 2020 2020 2020 226c 6922 3a20 736b          "li": sk
-0001ab00: 6669 6c2e 7468 7265 7368 6f6c 645f 6c69  fil.threshold_li
-0001ab10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001ab20: 2020 2020 2020 2022 6c6f 6361 6c22 3a20         "local": 
-0001ab30: 736b 6669 6c2e 7468 7265 7368 6f6c 645f  skfil.threshold_
-0001ab40: 6c6f 6361 6c2c 0d0a 2020 2020 2020 2020  local,..        
-0001ab50: 2020 2020 2020 2020 2020 2020 226d 6561              "mea
-0001ab60: 6e22 3a20 736b 6669 6c2e 7468 7265 7368  n": skfil.thresh
-0001ab70: 6f6c 645f 6d65 616e 2c0d 0a20 2020 2020  old_mean,..     
-0001ab80: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001ab90: 6d69 6e22 3a20 736b 6669 6c2e 7468 7265  min": skfil.thre
-0001aba0: 7368 6f6c 645f 6d69 6e69 6d75 6d2c 0d0a  shold_minimum,..
-0001abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abc0: 2020 2020 226d 696e 696d 756d 223a 2073      "minimum": s
-0001abd0: 6b66 696c 2e74 6872 6573 686f 6c64 5f6d  kfil.threshold_m
-0001abe0: 696e 696d 756d 2c0d 0a20 2020 2020 2020  inimum,..       
-0001abf0: 2020 2020 2020 2020 2020 2020 2022 6e69               "ni
-0001ac00: 626c 6163 6b22 3a20 736b 6669 6c2e 7468  black": skfil.th
-0001ac10: 7265 7368 6f6c 645f 6e69 626c 6163 6b2c  reshold_niblack,
-0001ac20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001ac30: 2020 2020 2020 226f 7473 7522 3a20 736b        "otsu": sk
-0001ac40: 6669 6c2e 7468 7265 7368 6f6c 645f 6f74  fil.threshold_ot
-0001ac50: 7375 2c0d 0a20 2020 2020 2020 2020 2020  su,..           
-0001ac60: 2020 2020 2020 2020 2022 7361 7576 6f6c           "sauvol
-0001ac70: 6122 3a20 736b 6669 6c2e 7468 7265 7368  a": skfil.thresh
-0001ac80: 6f6c 645f 7361 7576 6f6c 612c 0d0a 2020  old_sauvola,..  
-0001ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aca0: 2020 2274 7269 616e 676c 6522 3a20 736b    "triangle": sk
-0001acb0: 6669 6c2e 7468 7265 7368 6f6c 645f 7472  fil.threshold_tr
-0001acc0: 6961 6e67 6c65 2c0d 0a20 2020 2020 2020  iangle,..       
-0001acd0: 2020 2020 2020 2020 2020 2020 2022 7965               "ye
-0001ace0: 6e22 3a20 736b 6669 6c2e 7468 7265 7368  n": skfil.thresh
-0001acf0: 6f6c 645f 7965 6e0d 0a20 2020 2020 2020  old_yen..       
-0001ad00: 2020 2020 2020 2020 2020 2020 207d 0d0a               }..
-0001ad10: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001ad20: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0001ad30: 7468 722c 2073 7472 2920 616e 6420 7468  thr, str) and th
-0001ad40: 722e 656e 6473 7769 7468 2822 2522 293a  r.endswith("%"):
-0001ad50: 0d0a 2020 2020 2020 2020 2020 2020 7020  ..            p 
-0001ad60: 3d20 666c 6f61 7428 7468 725b 3a2d 315d  = float(thr[:-1]
-0001ad70: 2e73 7472 6970 2829 290d 0a20 2020 2020  .strip())..     
-0001ad80: 2020 2020 2020 206f 7574 203d 206e 702e         out = np.
-0001ad90: 7a65 726f 7328 7365 6c66 2e73 6861 7065  zeros(self.shape
-0001ada0: 2c20 6474 7970 653d 626f 6f6c 290d 0a20  , dtype=bool).. 
-0001adb0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0001adc0: 6c2c 2069 6d67 2069 6e20 7365 6c66 2e69  l, img in self.i
-0001add0: 7465 7228 616c 6f6e 6729 3a0d 0a20 2020  ter(along):..   
-0001ade0: 2020 2020 2020 2020 2020 2020 2074 6872               thr
-0001adf0: 203d 206e 702e 7065 7263 656e 7469 6c65   = np.percentile
-0001ae00: 2869 6d67 2c20 7029 0d0a 2020 2020 2020  (img, p)..      
-0001ae10: 2020 2020 2020 2020 2020 6f75 745b 736c            out[sl
-0001ae20: 5d20 3d20 696d 6720 3e3d 2074 6872 0d0a  ] = img >= thr..
-0001ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae40: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-0001ae50: 7369 6e73 7461 6e63 6528 7468 722c 2073  sinstance(thr, s
-0001ae60: 7472 293a 0d0a 2020 2020 2020 2020 2020  tr):..          
-0001ae70: 2020 6d65 7468 6f64 203d 2074 6872 2e6c    method = thr.l
-0001ae80: 6f77 6572 2829 0d0a 2020 2020 2020 2020  ower()..        
-0001ae90: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0001aea0: 2020 2020 2020 2020 2020 6675 6e63 203d            func =
-0001aeb0: 206d 6574 686f 6473 5f5b 6d65 7468 6f64   methods_[method
-0001aec0: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-0001aed0: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-0001aee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aef0: 2073 203d 2022 2c20 222e 6a6f 696e 286c   s = ", ".join(l
-0001af00: 6973 7428 6d65 7468 6f64 735f 2e6b 6579  ist(methods_.key
-0001af10: 7328 2929 290d 0a20 2020 2020 2020 2020  s()))..         
-0001af20: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
-0001af30: 4572 726f 7228 6622 7b6d 6574 686f 647d  Error(f"{method}
-0001af40: 5c6e 6d65 7468 6f64 206d 7573 7420 6265  \nmethod must be
-0001af50: 3a20 7b73 7d22 290d 0a20 2020 2020 2020  : {s}")..       
-0001af60: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-0001af70: 2020 206f 7574 203d 206e 702e 7a65 726f     out = np.zero
-0001af80: 7328 7365 6c66 2e73 6861 7065 2c20 6474  s(self.shape, dt
-0001af90: 7970 653d 626f 6f6c 290d 0a20 2020 2020  ype=bool)..     
-0001afa0: 2020 2020 2020 2066 6f72 2073 6c2c 2069         for sl, i
-0001afb0: 6d67 2069 6e20 7365 6c66 2e69 7465 7228  mg in self.iter(
-0001afc0: 616c 6f6e 6729 3a0d 0a20 2020 2020 2020  along):..       
-0001afd0: 2020 2020 2020 2020 2074 6872 203d 2066           thr = f
-0001afe0: 756e 6328 696d 672c 202a 2a6b 7761 7267  unc(img, **kwarg
-0001aff0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0001b000: 2020 2020 6f75 745b 736c 5d20 3d20 696d      out[sl] = im
-0001b010: 6720 3e3d 2074 6872 0d0a 2020 2020 2020  g >= thr..      
-0001b020: 2020 2020 2020 0d0a 0d0a 2020 2020 2020        ....      
-0001b030: 2020 656c 6966 206e 702e 6973 7363 616c    elif np.isscal
-0001b040: 6172 2874 6872 293a 0d0a 2020 2020 2020  ar(thr):..      
-0001b050: 2020 2020 2020 6f75 7420 3d20 7365 6c66        out = self
-0001b060: 203e 3d20 7468 720d 0a20 2020 2020 2020   >= thr..       
-0001b070: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0001b080: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-0001b090: 726f 7228 0d0a 2020 2020 2020 2020 2020  ror(..          
-0001b0a0: 2020 2020 2020 2227 7468 7227 206d 7573        "'thr' mus
-0001b0b0: 7420 6265 206e 756d 6572 6963 2c20 6f72  t be numeric, or
-0001b0c0: 2073 7472 2073 7065 6369 6679 696e 6720   str specifying 
-0001b0d0: 6120 7468 7265 7368 6f6c 6469 6e67 206d  a thresholding m
-0001b0e0: 6574 686f 642e 220d 0a20 2020 2020 2020  ethod."..       
-0001b0f0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0001b100: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001b110: 206f 7574 0d0a 2020 2020 0d0a 2020 2020   out..    ..    
-0001b120: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
-0001b130: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
-0001b140: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
-0001b150: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
-0001b160: 6e64 5f6f 7574 7075 7428 6f6e 6c79 5f62  nd_output(only_b
-0001b170: 696e 6172 793d 5472 7565 290d 0a20 2020  inary=True)..   
-0001b180: 2064 6566 2064 6973 7461 6e63 655f 6d61   def distance_ma
-0001b190: 7028 7365 6c66 2c20 2a2c 2064 696d 733a  p(self, *, dims:
-0001b1a0: 2044 696d 7320 3d20 4e6f 6e65 2920 2d3e   Dims = None) ->
-0001b1b0: 2049 6d67 4172 7261 793a 0d0a 2020 2020   ImgArray:..    
-0001b1c0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0001b1d0: 2043 616c 6375 6c61 7465 2064 6973 7461   Calculate dista
-0001b1e0: 6e63 6520 6d61 7020 6672 6f6d 2062 696e  nce map from bin
-0001b1f0: 6172 7920 696d 6167 6573 2e0d 0a20 2020  ary images...   
-0001b200: 2020 2020 2046 6f72 2069 6e73 7461 6e63       For instanc
-0001b210: 652c 2060 605b 312c 2031 2c20 312c 2030  e, ``[1, 1, 1, 0
-0001b220: 2c20 302c 2030 2c20 312c 2031 2c20 315d  , 0, 0, 1, 1, 1]
-0001b230: 6060 2077 696c 6c20 6265 2063 6f6e 7665  `` will be conve
-0001b240: 7274 6564 2074 6f20 0d0a 2020 2020 2020  rted to ..      
-0001b250: 2020 6060 5b33 2c20 322c 2031 2c20 302c    ``[3, 2, 1, 0,
-0001b260: 2030 2c20 302c 2031 2c20 322c 2033 5d60   0, 0, 1, 2, 3]`
-0001b270: 602e 204e 6f74 6520 7468 6174 2072 6574  `. Note that ret
-0001b280: 7572 6e65 6420 6172 7261 7920 7769 6c6c  urned array will
-0001b290: 2062 6520 666c 6f61 7420 696e 206e 2d44   be float in n-D
-0001b2a0: 200d 0a20 2020 2020 2020 2069 6d61 6765   ..        image
-0001b2b0: 732e 0d0a 0d0a 2020 2020 2020 2020 5061  s.....        Pa
-0001b2c0: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
-0001b2d0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-0001b2e0: 2020 2020 2020 7b64 696d 737d 0d0a 0d0a        {dims}....
-0001b2f0: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
-0001b300: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0001b310: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
-0001b320: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
-0001b330: 4469 7374 616e 6365 206d 6170 2c20 7468  Distance map, th
-0001b340: 6520 6675 7274 6865 7220 7468 6520 6272  e further the br
-0001b350: 6967 6874 6572 0d0a 2020 2020 2020 2020  ighter..        
-0001b360: 2222 2220 2020 2020 2020 200d 0a20 2020  """        ..   
-0001b370: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001b380: 2e5f 6170 706c 795f 6461 736b 286e 6469  ._apply_dask(ndi
-0001b390: 2e64 6973 7461 6e63 655f 7472 616e 7366  .distance_transf
-0001b3a0: 6f72 6d5f 6564 742c 200d 0a20 2020 2020  orm_edt, ..     
-0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3c0: 2020 2020 2020 2020 2020 635f 6178 6573            c_axes
-0001b3d0: 3d63 6f6d 706c 656d 656e 745f 6178 6573  =complement_axes
-0001b3e0: 2864 696d 732c 2073 656c 662e 6178 6573  (dims, self.axes
-0001b3f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b410: 2020 290d 0a20 2020 2020 2020 200d 0a20    )..        .. 
-0001b420: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
-0001b430: 6961 6c5f 6178 6573 0d0a 2020 2020 4063  ial_axes..    @c
-0001b440: 6865 636b 5f69 6e70 7574 5f61 6e64 5f6f  heck_input_and_o
-0001b450: 7574 7075 740d 0a20 2020 2064 6566 206e  utput..    def n
-0001b460: 6363 5f66 696c 7465 7228 0d0a 2020 2020  cc_filter(..    
-0001b470: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-0001b480: 2020 2074 656d 706c 6174 653a 206e 702e     template: np.
-0001b490: 6e64 6172 7261 792c 0d0a 2020 2020 2020  ndarray,..      
-0001b4a0: 2020 6d6f 6465 3a20 7374 7220 3d20 2263    mode: str = "c
-0001b4b0: 6f6e 7374 616e 7422 2c20 0d0a 2020 2020  onstant", ..    
-0001b4c0: 2020 2020 6376 616c 3a20 666c 6f61 7420      cval: float 
-0001b4d0: 7c20 7374 7220 7c20 4361 6c6c 6162 6c65  | str | Callable
-0001b4e0: 5b5b 6e70 2e6e 6461 7272 6179 5d2c 2066  [[np.ndarray], f
-0001b4f0: 6c6f 6174 5d20 3d20 6e70 2e6d 6561 6e2c  loat] = np.mean,
-0001b500: 200d 0a20 2020 2020 2020 202a 2c20 0d0a   ..        *, ..
-0001b510: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
-0001b520: 6d73 203d 204e 6f6e 650d 0a20 2020 2029  ms = None..    )
-0001b530: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
-0001b540: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0001b550: 2020 2020 5465 6d70 6c61 7465 206d 6174      Template mat
-0001b560: 6368 696e 6720 7573 696e 6720 6e6f 726d  ching using norm
-0001b570: 616c 697a 6564 2063 726f 7373 2063 6f72  alized cross cor
-0001b580: 7265 6c61 7469 6f6e 2028 4e43 4329 206d  relation (NCC) m
-0001b590: 6574 686f 642e 2054 6869 7320 6675 6e63  ethod. This func
-0001b5a0: 7469 6f6e 2069 7320 6261 7369 6361 6c6c  tion is basicall
-0001b5b0: 790d 0a20 2020 2020 2020 2069 6465 6e74  y..        ident
-0001b5c0: 6963 616c 2074 6f20 7468 6174 2069 6e20  ical to that in 
-0001b5d0: 6073 6b69 6d61 6765 2e66 6561 7475 7265  `skimage.feature
-0001b5e0: 602c 2062 7574 2069 7320 6f70 7469 6d69  `, but is optimi
-0001b5f0: 7a65 6420 666f 7220 6261 7463 6820 7072  zed for batch pr
-0001b600: 6f63 6573 7369 6e67 2061 6e64 2069 6d70  ocessing and imp
-0001b610: 726f 7665 6420 0d0a 2020 2020 2020 2020  roved ..        
-0001b620: 7265 6164 6162 696c 6974 792e 0d0a 0d0a  readability.....
-0001b630: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-0001b640: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-0001b650: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-0001b660: 7465 6d70 6c61 7465 203a 206e 702e 6e64  template : np.nd
-0001b670: 6172 7261 790d 0a20 2020 2020 2020 2020  array..         
-0001b680: 2020 2054 656d 706c 6174 6520 696d 6167     Template imag
-0001b690: 652e 204d 7573 7420 6265 2032 206f 7220  e. Must be 2 or 
-0001b6a0: 3320 6469 6d65 6e73 696f 6e61 6c2e 200d  3 dimensional. .
-0001b6b0: 0a20 2020 2020 2020 207b 6d6f 6465 7d0d  .        {mode}.
-0001b6c0: 0a20 2020 2020 2020 2063 7661 6c20 3a20  .        cval : 
-0001b6d0: 666c 6f61 742c 206f 7074 696f 6e61 6c0d  float, optional.
-0001b6e0: 0a20 2020 2020 2020 2020 2020 2042 6163  .            Bac
-0001b6f0: 6b67 726f 756e 6420 696e 7465 6e73 6974  kground intensit
-0001b700: 792e 2049 6620 6e6f 7420 6769 7665 6e2c  y. If not given,
-0001b710: 2069 7420 7769 6c6c 2063 616c 6375 6c61   it will calcula
-0001b720: 7465 6420 6173 2074 6865 206d 6561 6e20  ted as the mean 
-0001b730: 7661 6c75 6520 6f66 200d 0a20 2020 2020  value of ..     
-0001b740: 2020 2020 2020 2074 6865 206f 7269 6769         the origi
-0001b750: 6e61 6c20 696d 6167 652e 0d0a 2020 2020  nal image...    
-0001b760: 2020 2020 7b64 696d 737d 0d0a 0d0a 2020      {dims}....  
-0001b770: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
-0001b780: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
-0001b790: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
-0001b7a0: 0d0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
-0001b7b0: 7370 6f6e 7365 2069 6d61 6765 2077 6974  sponse image wit
-0001b7c0: 6820 7661 6c75 6573 2062 6574 7765 656e  h values between
-0001b7d0: 202d 3120 616e 6420 312e 0d0a 2020 2020   -1 and 1...    
-0001b7e0: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
-0001b7f0: 0a20 2020 2020 2020 2074 656d 706c 6174  .        templat
-0001b800: 6520 3d20 5f63 6865 636b 5f74 656d 706c  e = _check_templ
-0001b810: 6174 6528 7465 6d70 6c61 7465 290d 0a20  ate(template).. 
-0001b820: 2020 2020 2020 2069 6620 6361 6c6c 6162         if callab
-0001b830: 6c65 2863 7661 6c29 3a0d 0a20 2020 2020  le(cval):..     
-0001b840: 2020 2020 2020 2063 7661 6c20 3d20 6376         cval = cv
-0001b850: 616c 2873 656c 6629 0d0a 2020 2020 2020  al(self)..      
-0001b860: 2020 6376 616c 203d 205f 6368 6563 6b5f    cval = _check_
-0001b870: 6267 2873 656c 662c 2063 7661 6c29 0d0a  bg(self, cval)..
-0001b880: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
-0001b890: 696d 7329 2021 3d20 7465 6d70 6c61 7465  ims) != template
-0001b8a0: 2e6e 6469 6d3a 0d0a 2020 2020 2020 2020  .ndim:..        
-0001b8b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0001b8c0: 7272 6f72 2822 6469 6d73 2061 6e64 2074  rror("dims and t
-0001b8d0: 6865 206e 756d 6265 7220 6f66 2074 656d  he number of tem
-0001b8e0: 706c 6174 6520 6469 6d65 6e73 696f 6e20  plate dimension 
-0001b8f0: 646f 6e27 7420 6d61 7463 682e 2229 0d0a  don't match.")..
-0001b900: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001b910: 2020 7265 7475 726e 2073 656c 662e 6173    return self.as
-0001b920: 5f66 6c6f 6174 2829 2e5f 6170 706c 795f  _float()._apply_
-0001b930: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
-0001b940: 2020 205f 6669 6c74 6572 732e 6e63 635f     _filters.ncc_
-0001b950: 6669 6c74 6572 2c0d 0a20 2020 2020 2020  filter,..       
-0001b960: 2020 2020 2063 5f61 7865 733d 636f 6d70       c_axes=comp
-0001b970: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
-0001b980: 2c20 7365 6c66 2e61 7865 7329 2c20 0d0a  , self.axes), ..
-0001b990: 2020 2020 2020 2020 2020 2020 6172 6773              args
-0001b9a0: 3d28 7465 6d70 6c61 7465 2c20 6376 616c  =(template, cval
-0001b9b0: 2c20 6d6f 6465 290d 0a20 2020 2020 2020  , mode)..       
-0001b9c0: 2029 0d0a 2020 2020 0d0a 2020 2020 405f   )..    ..    @_
-0001b9d0: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-0001b9e0: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-0001b9f0: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-0001ba00: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
-0001ba10: 5f6f 7574 7075 7428 6f6e 6c79 5f62 696e  _output(only_bin
-0001ba20: 6172 793d 5472 7565 290d 0a20 2020 2064  ary=True)..    d
-0001ba30: 6566 2072 656d 6f76 655f 6c61 7267 655f  ef remove_large_
-0001ba40: 6f62 6a65 6374 7328 7365 6c66 2c20 7261  objects(self, ra
-0001ba50: 6469 7573 3a20 666c 6f61 7420 3d20 352c  dius: float = 5,
-0001ba60: 202a 2c20 6469 6d73 3a20 4469 6d73 203d   *, dims: Dims =
-0001ba70: 204e 6f6e 652c 2075 7064 6174 653a 2062   None, update: b
-0001ba80: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
-0001ba90: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
-0001baa0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0001bab0: 5265 6d6f 7665 206c 6172 6765 206f 626a  Remove large obj
-0001bac0: 6563 7473 2075 7369 6e67 206f 7065 6e69  ects using openi
-0001bad0: 6e67 2e20 5468 6f73 6520 6f62 6a65 6374  ng. Those object
-0001bae0: 7320 7468 6174 2077 6572 6520 6e6f 7420  s that were not 
-0001baf0: 7265 6d6f 7665 6420 6279 206f 7065 6e69  removed by openi
-0001bb00: 6e67 0d0a 2020 2020 2020 2020 7769 6c6c  ng..        will
-0001bb10: 2062 6520 7265 6d6f 7665 6420 696e 206f   be removed in o
-0001bb20: 7574 7075 742e 0d0a 0d0a 2020 2020 2020  utput.....      
-0001bb30: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-0001bb40: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0001bb50: 0d0a 2020 2020 2020 2020 7261 6469 7573  ..        radius
-0001bb60: 203a 2066 6c6f 6174 2c20 6f70 7469 6f6e   : float, option
-0001bb70: 616c 0d0a 2020 2020 2020 2020 2020 2020  al..            
-0001bb80: 4f62 6a65 6374 7320 7769 7468 2072 6164  Objects with rad
-0001bb90: 6975 7320 6c61 7267 6572 2074 6861 6e20  ius larger than 
-0001bba0: 7468 6973 2076 616c 7565 2077 696c 6c20  this value will 
-0001bbb0: 6265 2072 656d 6f76 6564 2e0d 0a20 2020  be removed...   
-0001bbc0: 2020 2020 207b 6469 6d73 7d7b 7570 6461       {dims}{upda
-0001bbd0: 7465 7d0d 0a0d 0a20 2020 2020 2020 2052  te}....        R
-0001bbe0: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-0001bbf0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0001bc00: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
-0001bc10: 2020 2020 2020 2049 6d61 6765 2077 6974         Image wit
-0001bc20: 6820 6c61 7267 6520 6f62 6a65 6374 7320  h large objects 
-0001bc30: 7265 6d6f 7665 642e 0d0a 0d0a 2020 2020  removed.....    
-0001bc40: 2020 2020 5365 6520 416c 736f 0d0a 2020      See Also..  
-0001bc50: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
-0001bc60: 2020 2020 2020 2020 7265 6d6f 7665 5f66          remove_f
-0001bc70: 696e 655f 6f62 6a65 6374 730d 0a20 2020  ine_objects..   
-0001bc80: 2020 2020 2022 2222 2020 2020 2020 2020       """        
-0001bc90: 0d0a 2020 2020 2020 2020 6f75 7420 3d20  ..        out = 
-0001bca0: 7365 6c66 2e63 6f70 7928 290d 0a20 2020  self.copy()..   
-0001bcb0: 2020 2020 206c 6172 6765 5f6f 626a 203d       large_obj =
-0001bcc0: 2073 656c 662e 6f70 656e 696e 6728 7261   self.opening(ra
-0001bcd0: 6469 7573 2c20 6469 6d73 3d64 696d 7329  dius, dims=dims)
-0001bce0: 0d0a 2020 2020 2020 2020 6f75 742e 7661  ..        out.va
-0001bcf0: 6c75 655b 6c61 7267 655f 6f62 6a5d 203d  lue[large_obj] =
-0001bd00: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-0001bd10: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001bd20: 206f 7574 0d0a 2020 2020 0d0a 2020 2020   out..    ..    
-0001bd30: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
-0001bd40: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
-0001bd50: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
-0001bd60: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
-0001bd70: 6e64 5f6f 7574 7075 7428 6f6e 6c79 5f62  nd_output(only_b
-0001bd80: 696e 6172 793d 5472 7565 290d 0a20 2020  inary=True)..   
-0001bd90: 2064 6566 2072 656d 6f76 655f 6669 6e65   def remove_fine
-0001bda0: 5f6f 626a 6563 7473 2873 656c 662c 206c  _objects(self, l
-0001bdb0: 656e 6774 683a 2066 6c6f 6174 203d 2031  ength: float = 1
-0001bdc0: 302c 202a 2c20 6469 6d73 3a20 4469 6d73  0, *, dims: Dims
-0001bdd0: 203d 204e 6f6e 652c 2075 7064 6174 653a   = None, update:
-0001bde0: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
-0001bdf0: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
-0001be00: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0001be10: 2020 5265 6d6f 7665 2066 696e 6520 6f62    Remove fine ob
-0001be20: 6a65 6374 7320 7573 696e 6720 6469 616d  jects using diam
-0001be30: 6574 6572 5f6f 7065 6e69 6e67 2e0d 0a0d  eter_opening....
-0001be40: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0001be50: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-0001be60: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0001be70: 206c 656e 6774 6820 3a20 666c 6f61 742c   length : float,
-0001be80: 2064 6566 6175 6c74 2069 7320 3130 0d0a   default is 10..
-0001be90: 2020 2020 2020 2020 2020 2020 4f62 6a65              Obje
-0001bea0: 6374 7320 6c6f 6e67 6572 2074 6861 6e20  cts longer than 
-0001beb0: 7468 6973 2077 696c 6c20 6265 2072 656d  this will be rem
-0001bec0: 6f76 6564 2e0d 0a20 2020 2020 2020 207b  oved...        {
-0001bed0: 6469 6d73 7d7b 7570 6461 7465 7d0d 0a0d  dims}{update}...
-0001bee0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0001bef0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0001bf00: 2d0d 0a20 2020 2020 2020 2049 6d67 4172  -..        ImgAr
-0001bf10: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
-0001bf20: 2049 6d61 6765 2077 6974 6820 6c61 7267   Image with larg
-0001bf30: 6520 6f62 6a65 6374 7320 7265 6d6f 7665  e objects remove
-0001bf40: 642e 0d0a 2020 2020 2020 2020 0d0a 2020  d...        ..  
-0001bf50: 2020 2020 2020 5365 6520 416c 736f 0d0a        See Also..
-0001bf60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0001bf70: 0d0a 2020 2020 2020 2020 7265 6d6f 7665  ..        remove
-0001bf80: 5f6c 6172 6765 5f6f 626a 6563 7473 0d0a  _large_objects..
-0001bf90: 2020 2020 2020 2020 2222 2220 2020 2020          """     
-0001bfa0: 2020 200d 0a20 2020 2020 2020 206f 7574     ..        out
-0001bfb0: 203d 2073 656c 662e 636f 7079 2829 0d0a   = self.copy()..
-0001bfc0: 2020 2020 2020 2020 6669 6e65 5f6f 626a          fine_obj
-0001bfd0: 203d 2073 656c 662e 6469 616d 6574 6572   = self.diameter
-0001bfe0: 5f6f 7065 6e69 6e67 286c 656e 6774 682c  _opening(length,
-0001bff0: 2063 6f6e 6e65 6374 6976 6974 793d 6c65   connectivity=le
-0001c000: 6e28 6469 6d73 2929 0d0a 2020 2020 2020  n(dims))..      
-0001c010: 2020 6c61 7267 655f 6f62 6a20 3d20 7365    large_obj = se
-0001c020: 6c66 2e6f 7065 6e69 6e67 286c 656e 6774  lf.opening(lengt
-0001c030: 682f 2f32 290d 0a20 2020 2020 2020 206f  h//2)..        o
-0001c040: 7574 2e76 616c 7565 5b7e 6c61 7267 655f  ut.value[~large_
-0001c050: 6f62 6a20 2620 6669 6e65 5f6f 626a 5d20  obj & fine_obj] 
-0001c060: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
-0001c070: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
-0001c080: 6e20 6f75 740d 0a20 2020 200d 0a20 2020  n out..    ..   
-0001c090: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
-0001c0a0: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
-0001c0b0: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
-0001c0c0: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
-0001c0d0: 616e 645f 6f75 7470 7574 286f 6e6c 795f  and_output(only_
-0001c0e0: 6269 6e61 7279 3d54 7275 6529 0d0a 2020  binary=True)..  
-0001c0f0: 2020 6465 6620 636f 6e76 6578 5f68 756c    def convex_hul
-0001c100: 6c28 7365 6c66 2c20 2a2c 2064 696d 733a  l(self, *, dims:
-0001c110: 2044 696d 7320 3d20 4e6f 6e65 2c20 7570   Dims = None, up
-0001c120: 6461 7465 3d46 616c 7365 2920 2d3e 2049  date=False) -> I
-0001c130: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
-0001c140: 2020 2222 220d 0a20 2020 2020 2020 2043    """..        C
-0001c150: 6f6d 7075 7465 2063 6f6e 7665 7820 6875  ompute convex hu
-0001c160: 6c6c 2069 6d61 6765 2e0d 0a0d 0a20 2020  ll image.....   
-0001c170: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-0001c180: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0001c190: 2d2d 2d0d 0a20 2020 2020 2020 207b 6469  ---..        {di
-0001c1a0: 6d73 7d7b 7570 6461 7465 7d0d 0a0d 0a20  ms}{update}.... 
-0001c1b0: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
-0001c1c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
-0001c1d0: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
-0001c1e0: 790d 0a20 2020 2020 2020 2020 2020 2043  y..            C
-0001c1f0: 6f6e 7665 7820 6875 6c6c 2069 6d61 6765  onvex hull image
-0001c200: 2e0d 0a20 2020 2020 2020 2022 2222 2020  ...        """  
-0001c210: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0001c220: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
-0001c230: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
-0001c240: 2020 2020 2020 736b 696d 6167 652e 6d6f        skimage.mo
-0001c250: 7270 686f 6c6f 6779 2e63 6f6e 7665 785f  rphology.convex_
-0001c260: 6875 6c6c 5f69 6d61 6765 2c20 0d0a 2020  hull_image, ..  
-0001c270: 2020 2020 2020 2020 2020 635f 6178 6573            c_axes
-0001c280: 3d63 6f6d 706c 656d 656e 745f 6178 6573  =complement_axes
-0001c290: 2864 696d 732c 2073 656c 662e 6178 6573  (dims, self.axes
-0001c2a0: 292c 200d 0a20 2020 2020 2020 2020 2020  ), ..           
-0001c2b0: 2064 7479 7065 3d62 6f6f 6c2c 0d0a 2020   dtype=bool,..  
-0001c2c0: 2020 2020 2020 292e 6173 7479 7065 2862        ).astype(b
-0001c2d0: 6f6f 6c29 0d0a 2020 2020 2020 2020 0d0a  ool)..        ..
-0001c2e0: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
-0001c2f0: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
-0001c300: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
-0001c310: 0d0a 2020 2020 4063 6865 636b 5f69 6e70  ..    @check_inp
-0001c320: 7574 5f61 6e64 5f6f 7574 7075 7428 6f6e  ut_and_output(on
-0001c330: 6c79 5f62 696e 6172 793d 5472 7565 290d  ly_binary=True).
-0001c340: 0a20 2020 2064 6566 2073 6b65 6c65 746f  .    def skeleto
-0001c350: 6e69 7a65 2873 656c 662c 2072 6164 6975  nize(self, radiu
-0001c360: 733a 2066 6c6f 6174 203d 2030 2c20 2a2c  s: float = 0, *,
-0001c370: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
-0001c380: 6e65 2c20 7570 6461 7465 3d46 616c 7365  ne, update=False
-0001c390: 2920 2d3e 2049 6d67 4172 7261 793a 0d0a  ) -> ImgArray:..
-0001c3a0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0001c3b0: 2020 2020 2053 6b65 6c65 746f 6e69 7a65       Skeletonize
-0001c3c0: 2069 6d61 6765 732e 204f 6e6c 7920 776f   images. Only wo
-0001c3d0: 726b 7320 666f 7220 6269 6e61 7279 2069  rks for binary i
-0001c3e0: 6d61 6765 732e 0d0a 0d0a 2020 2020 2020  mages.....      
-0001c3f0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-0001c400: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0001c410: 0d0a 2020 2020 2020 2020 7261 6469 7573  ..        radius
-0001c420: 203a 2066 6c6f 6174 2c20 6f70 7469 6f6e   : float, option
-0001c430: 616c 0d0a 2020 2020 2020 2020 2020 2020  al..            
-0001c440: 5261 6469 7573 206f 6620 736b 656c 6574  Radius of skelet
-0001c450: 6f6e 2e20 5468 6973 2069 7320 6163 6869  on. This is achi
-0001c460: 6576 6564 2073 696d 706c 7920 6279 2064  eved simply by d
-0001c470: 696c 6174 696f 6e20 6f66 2073 6b65 6c65  ilation of skele
-0001c480: 746f 6e69 7a65 6420 7265 7375 6c74 732e  tonized results.
+0000db60: 2c20 2a2c 2064 696d 733a 2044 696d 7320  , *, dims: Dims 
+0000db70: 3d20 4e6f 6e65 2920 2d3e 2049 6d67 4172  = None) -> ImgAr
+0000db80: 7261 793a 0d0a 2020 2020 2020 2020 2222  ray:..        ""
+0000db90: 220d 0a20 2020 2020 2020 2044 6574 6572  "..        Deter
+0000dba0: 6d69 6e61 6e74 206f 6620 4865 7373 6961  minant of Hessia
+0000dbb0: 6e20 6669 6c74 6572 2e20 5468 6973 2066  n filter. This f
+0000dbc0: 756e 6374 696f 6e20 646f 6573 206e 6f74  unction does not
+0000dbd0: 2073 7570 706f 7274 2060 7570 6461 7465   support `update
+0000dbe0: 600d 0a20 2020 2020 2020 2061 7267 756d  `..        argum
+0000dbf0: 656e 7420 6265 6361 7573 6520 6f75 7470  ent because outp
+0000dc00: 7574 2068 6173 2074 6f74 616c 2064 6966  ut has total dif
+0000dc10: 6665 7265 6e74 2073 6361 6c65 206f 6620  ferent scale of 
+0000dc20: 696e 7465 6e73 6974 792e 200d 0a20 2020  intensity. ..   
+0000dc30: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0000dc40: 2020 202e 2e20 7761 726e 696e 673a 3a0d     .. warning::.
+0000dc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dc60: 2042 6563 6175 7365 2069 6e20 6d6f 7374   Because in most
+0000dc70: 2063 6173 6573 2077 6520 7761 6e74 2074   cases we want t
+0000dc80: 6f20 6669 6e64 206f 6e6c 7920 6272 6967  o find only brig
+0000dc90: 6874 2064 6f74 732c 2065 6967 656e 7661  ht dots, eigenva
+0000dca0: 6c75 6573 206c 6172 6765 7220 0d0a 2020  lues larger ..  
+0000dcb0: 2020 2020 2020 2020 2020 2020 2020 7468                th
+0000dcc0: 616e 2030 2069 7320 6967 6e6f 7265 6420  an 0 is ignored 
+0000dcd0: 6265 666f 7265 2063 6f6d 7075 7469 6e67  before computing
+0000dce0: 2064 6574 6572 6d69 6e61 6e74 2e0d 0a0d   determinant....
+0000dcf0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0000dd00: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
+0000dd10: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+0000dd20: 207b 7369 676d 617d 7b64 696d 737d 0d0a   {sigma}{dims}..
+0000dd30: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0000dd40: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+0000dd50: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
+0000dd60: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
+0000dd70: 2020 4669 6c74 6572 6564 2069 6d61 6765    Filtered image
+0000dd80: 2e0d 0a20 2020 2020 2020 2022 2222 2020  ...        """  
+0000dd90: 2020 0d0a 2020 2020 2020 2020 7369 676d    ..        sigm
+0000dda0: 6120 3d20 6368 6563 6b5f 6e64 2873 6967  a = check_nd(sig
+0000ddb0: 6d61 2c20 6c65 6e28 6469 6d73 2929 0d0a  ma, len(dims))..
+0000ddc0: 2020 2020 2020 2020 7078 7369 7a65 203d          pxsize =
+0000ddd0: 206e 702e 6172 7261 7928 5b73 656c 662e   np.array([self.
+0000dde0: 7363 616c 655b 615d 2066 6f72 2061 2069  scale[a] for a i
+0000ddf0: 6e20 6469 6d73 5d29 0d0a 2020 2020 2020  n dims])..      
+0000de00: 2020 7265 7475 726e 2073 656c 662e 6173    return self.as
+0000de10: 5f66 6c6f 6174 2829 2e5f 6170 706c 795f  _float()._apply_
+0000de20: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
+0000de30: 2020 205f 6669 6c74 6572 732e 646f 685f     _filters.doh_
+0000de40: 6669 6c74 6572 2c20 0d0a 2020 2020 2020  filter, ..      
+0000de50: 2020 2020 2020 635f 6178 6573 3d63 6f6d        c_axes=com
+0000de60: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
+0000de70: 732c 2073 656c 662e 6178 6573 292c 200d  s, self.axes), .
+0000de80: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
+0000de90: 733d 2873 6967 6d61 2c20 7078 7369 7a65  s=(sigma, pxsize
+0000dea0: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
+0000deb0: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
+0000dec0: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
+0000ded0: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
+0000dee0: 6178 6573 0d0a 2020 2020 4063 6865 636b  axes..    @check
+0000def0: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
+0000df00: 740d 0a20 2020 2064 6566 206c 6f67 5f66  t..    def log_f
+0000df10: 696c 7465 7228 7365 6c66 2c20 7369 676d  ilter(self, sigm
+0000df20: 613a 206e 4446 6c6f 6174 203d 2031 2c20  a: nDFloat = 1, 
+0000df30: 2a2c 2064 696d 733a 2044 696d 7320 3d20  *, dims: Dims = 
+0000df40: 4e6f 6e65 2920 2d3e 2049 6d67 4172 7261  None) -> ImgArra
+0000df50: 793a 0d0a 2020 2020 2020 2020 2222 220d  y:..        """.
+0000df60: 0a20 2020 2020 2020 204c 6170 6c61 6369  .        Laplaci
+0000df70: 616e 206f 6620 4761 7573 7369 616e 2066  an of Gaussian f
+0000df80: 696c 7465 722e 0d0a 0d0a 2020 2020 2020  ilter.....      
+0000df90: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+0000dfa0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0000dfb0: 0d0a 2020 2020 2020 2020 7b73 6967 6d61  ..        {sigma
+0000dfc0: 7d7b 6469 6d73 7d0d 0a0d 0a20 2020 2020  }{dims}....     
+0000dfd0: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
+0000dfe0: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
+0000dff0: 2020 2020 2049 6d67 4172 7261 790d 0a20       ImgArray.. 
+0000e000: 2020 2020 2020 2020 2020 2046 696c 7465             Filte
+0000e010: 7265 6420 696d 6167 652e 0d0a 2020 2020  red image...    
+0000e020: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0000e030: 2072 6574 7572 6e20 2d73 656c 662e 6173   return -self.as
+0000e040: 5f66 6c6f 6174 2829 2e5f 6170 706c 795f  _float()._apply_
+0000e050: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
+0000e060: 2020 205f 6669 6c74 6572 732e 6761 7573     _filters.gaus
+0000e070: 7369 616e 5f6c 6170 6c61 6365 2c0d 0a20  sian_laplace,.. 
+0000e080: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
+0000e090: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
+0000e0a0: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+0000e0b0: 7329 2c20 0d0a 2020 2020 2020 2020 2020  s), ..          
+0000e0c0: 2020 6172 6773 3d28 7369 676d 612c 290d    args=(sigma,).
+0000e0d0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+0000e0e0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
+0000e0f0: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
+0000e100: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+0000e110: 6573 0d0a 2020 2020 4073 616d 655f 6474  es..    @same_dt
+0000e120: 7970 6528 6173 666c 6f61 743d 5472 7565  ype(asfloat=True
+0000e130: 290d 0a20 2020 2040 6368 6563 6b5f 696e  )..    @check_in
+0000e140: 7075 745f 616e 645f 6f75 7470 7574 0d0a  put_and_output..
+0000e150: 2020 2020 6465 6620 726f 6c6c 696e 675f      def rolling_
+0000e160: 6261 6c6c 280d 0a20 2020 2020 2020 2073  ball(..        s
+0000e170: 656c 662c 0d0a 2020 2020 2020 2020 7261  elf,..        ra
+0000e180: 6469 7573 3a20 666c 6f61 7420 3d20 3330  dius: float = 30
+0000e190: 2c0d 0a20 2020 2020 2020 2070 7265 6669  ,..        prefi
+0000e1a0: 6c74 6572 3a20 4c69 7465 7261 6c5b 226d  lter: Literal["m
+0000e1b0: 6561 6e22 2c20 226d 6564 6961 6e22 2c20  ean", "median", 
+0000e1c0: 226e 6f6e 6522 5d20 3d20 226d 6561 6e22  "none"] = "mean"
+0000e1d0: 2c0d 0a20 2020 2020 2020 202a 2c0d 0a20  ,..        *,.. 
+0000e1e0: 2020 2020 2020 2072 6574 7572 6e5f 6267         return_bg
+0000e1f0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0d  : bool = False,.
+0000e200: 0a20 2020 2020 2020 2064 696d 733a 2044  .        dims: D
+0000e210: 696d 7320 3d20 4e6f 6e65 2c0d 0a20 2020  ims = None,..   
+0000e220: 2020 2020 2075 7064 6174 653a 2062 6f6f       update: boo
+0000e230: 6c20 3d20 4661 6c73 650d 0a20 2020 2029  l = False..    )
+0000e240: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+0000e250: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0000e260: 2020 2020 5375 6274 7261 6374 2042 6163      Subtract Bac
+0000e270: 6b67 726f 756e 6420 7573 696e 6720 726f  kground using ro
+0000e280: 6c6c 696e 672d 6261 6c6c 2061 6c67 6f72  lling-ball algor
+0000e290: 6974 686d 2e0d 0a0d 0a20 2020 2020 2020  ithm.....       
+0000e2a0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+0000e2b0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+0000e2c0: 0a20 2020 2020 2020 207b 7261 6469 7573  .        {radius
+0000e2d0: 7d0d 0a20 2020 2020 2020 2070 7265 6669  }..        prefi
+0000e2e0: 6c74 6572 203a 2022 6d65 616e 222c 2022  lter : "mean", "
+0000e2f0: 6d65 6469 616e 2220 6f72 2022 6e6f 6e65  median" or "none
+0000e300: 220d 0a20 2020 2020 2020 2020 2020 2049  "..            I
+0000e310: 6620 6170 706c 7920 3378 3320 6176 6572  f apply 3x3 aver
+0000e320: 6167 696e 6720 6265 666f 7265 2063 7265  aging before cre
+0000e330: 6174 696e 6720 6261 636b 6772 6f75 6e64  ating background
+0000e340: 2e0d 0a20 2020 2020 2020 207b 6469 6d73  ...        {dims
+0000e350: 7d7b 7570 6461 7465 7d0d 0a20 2020 2020  }{update}..     
+0000e360: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000e370: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+0000e380: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+0000e390: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
+0000e3a0: 2020 2020 2020 2020 2042 6163 6b67 726f           Backgro
+0000e3b0: 756e 6420 7375 6274 7261 6374 6564 2069  und subtracted i
+0000e3c0: 6d61 6765 2e0d 0a20 2020 2020 2020 2022  mage...        "
+0000e3d0: 2222 2020 2020 2020 2020 0d0a 2020 2020  ""        ..    
+0000e3e0: 2020 2020 635f 6178 6573 203d 2063 6f6d      c_axes = com
+0000e3f0: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
+0000e400: 732c 2073 656c 662e 6178 6573 290d 0a20  s, self.axes).. 
+0000e410: 2020 2020 2020 2069 6620 7072 6566 696c         if prefil
+0000e420: 7465 7220 3d3d 2022 6d65 616e 223a 0d0a  ter == "mean":..
+0000e430: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+0000e440: 203d 2073 656c 662e 5f61 7070 6c79 5f64   = self._apply_d
+0000e450: 6173 6b28 0d0a 2020 2020 2020 2020 2020  ask(..          
+0000e460: 2020 2020 2020 5f66 696c 7465 7273 2e6d        _filters.m
+0000e470: 6561 6e5f 6669 6c74 6572 2c20 0d0a 2020  ean_filter, ..  
+0000e480: 2020 2020 2020 2020 2020 2020 2020 635f                c_
+0000e490: 6178 6573 3d63 5f61 7865 732c 200d 0a20  axes=c_axes, .. 
+0000e4a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000e4b0: 7761 7267 733d 6469 6374 2873 656c 656d  wargs=dict(selem
+0000e4c0: 3d6e 702e 6f6e 6573 2828 332c 292a 6c65  =np.ones((3,)*le
+0000e4d0: 6e28 6469 6d73 2929 290d 0a20 2020 2020  n(dims)))..     
+0000e4e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000e4f0: 2020 656c 6966 2070 7265 6669 6c74 6572    elif prefilter
+0000e500: 203d 3d20 226d 6564 6961 6e22 3a0d 0a20   == "median":.. 
+0000e510: 2020 2020 2020 2020 2020 2066 696c 7420             filt 
+0000e520: 3d20 7365 6c66 2e5f 6170 706c 795f 6461  = self._apply_da
+0000e530: 736b 280d 0a20 2020 2020 2020 2020 2020  sk(..           
+0000e540: 2020 2020 205f 6669 6c74 6572 732e 6d65       _filters.me
+0000e550: 6469 616e 5f66 696c 7465 722c 200d 0a20  dian_filter, .. 
+0000e560: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000e570: 5f61 7865 733d 635f 6178 6573 2c20 0d0a  _axes=c_axes, ..
+0000e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e590: 6b77 6172 6773 3d64 6963 7428 666f 6f74  kwargs=dict(foot
+0000e5a0: 7072 696e 743d 6e70 2e6f 6e65 7328 2833  print=np.ones((3
+0000e5b0: 2c29 2a6c 656e 2864 696d 7329 2929 0d0a  ,)*len(dims)))..
+0000e5c0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000e5d0: 2020 2020 2020 2065 6c69 6620 7072 6566         elif pref
+0000e5e0: 696c 7465 7220 3d3d 2022 6e6f 6e65 223a  ilter == "none":
+0000e5f0: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+0000e600: 6c74 203d 2073 656c 660d 0a20 2020 2020  lt = self..     
+0000e610: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000e620: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000e630: 6545 7272 6f72 2822 6070 7265 6669 6c74  eError("`prefilt
+0000e640: 6572 6020 6d75 7374 2062 6520 276d 6561  er` must be 'mea
+0000e650: 6e27 2c20 276d 6564 6961 6e27 206f 7220  n', 'median' or 
+0000e660: 276e 6f6e 6527 2e22 290d 0a20 2020 2020  'none'.")..     
+0000e670: 2020 2066 696c 742e 6178 6573 203d 2073     filt.axes = s
+0000e680: 656c 662e 6178 6573 0d0a 2020 2020 2020  elf.axes..      
+0000e690: 2020 6261 636b 203d 2066 696c 742e 5f61    back = filt._a
+0000e6a0: 7070 6c79 5f64 6173 6b28 0d0a 2020 2020  pply_dask(..    
+0000e6b0: 2020 2020 2020 2020 736b 7265 732e 726f          skres.ro
+0000e6c0: 6c6c 696e 675f 6261 6c6c 2c20 0d0a 2020  lling_ball, ..  
+0000e6d0: 2020 2020 2020 2020 2020 635f 6178 6573            c_axes
+0000e6e0: 3d63 5f61 7865 732c 200d 0a20 2020 2020  =c_axes, ..     
+0000e6f0: 2020 2020 2020 206b 7761 7267 733d 6469         kwargs=di
+0000e700: 6374 2872 6164 6975 733d 7261 6469 7573  ct(radius=radius
+0000e710: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
+0000e720: 2020 2020 2020 6966 206e 6f74 2072 6574        if not ret
+0000e730: 7572 6e5f 6267 3a0d 0a20 2020 2020 2020  urn_bg:..       
+0000e740: 2020 2020 206f 7574 203d 2073 656c 662e       out = self.
+0000e750: 7661 6c75 6520 2d20 6261 636b 0d0a 2020  value - back..  
+0000e760: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000e770: 206f 7574 0d0a 2020 2020 2020 2020 656c   out..        el
+0000e780: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000e790: 2072 6574 7572 6e20 6261 636b 0d0a 2020   return back..  
+0000e7a0: 2020 0d0a 2020 2020 405f 646f 6373 2e77    ..    @_docs.w
+0000e7b0: 7269 7465 5f64 6f63 730d 0a20 2020 2040  rite_docs..    @
+0000e7c0: 6469 6d73 5f74 6f5f 7370 6174 6961 6c5f  dims_to_spatial_
+0000e7d0: 6178 6573 0d0a 2020 2020 4073 616d 655f  axes..    @same_
+0000e7e0: 6474 7970 6528 6173 666c 6f61 743d 5472  dtype(asfloat=Tr
+0000e7f0: 7565 290d 0a20 2020 2040 6368 6563 6b5f  ue)..    @check_
+0000e800: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
+0000e810: 0d0a 2020 2020 6465 6620 726f 665f 6669  ..    def rof_fi
+0000e820: 6c74 6572 280d 0a20 2020 2020 2020 2073  lter(..        s
+0000e830: 656c 662c 0d0a 2020 2020 2020 2020 6c6d  elf,..        lm
+0000e840: 643a 2066 6c6f 6174 203d 2030 2e30 352c  d: float = 0.05,
+0000e850: 0d0a 2020 2020 2020 2020 746f 6c3a 2066  ..        tol: f
+0000e860: 6c6f 6174 203d 2031 652d 342c 0d0a 2020  loat = 1e-4,..  
+0000e870: 2020 2020 2020 6d61 785f 6974 6572 3a20        max_iter: 
+0000e880: 696e 7420 3d20 3530 2c20 0d0a 2020 2020  int = 50, ..    
+0000e890: 2020 2020 2a2c 200d 0a20 2020 2020 2020      *, ..       
+0000e8a0: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
+0000e8b0: 6e65 2c0d 0a20 2020 2020 2020 2075 7064  ne,..        upd
+0000e8c0: 6174 653a 2062 6f6f 6c20 3d20 4661 6c73  ate: bool = Fals
+0000e8d0: 652c 0d0a 2020 2020 2920 2d3e 2049 6d67  e,..    ) -> Img
+0000e8e0: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
+0000e8f0: 2222 220d 0a20 2020 2020 2020 2052 7564  """..        Rud
+0000e900: 696e 2d4f 7368 6572 2d46 6174 656d 6927  in-Osher-Fatemi'
+0000e910: 7320 746f 7461 6c20 7661 7269 6174 696f  s total variatio
+0000e920: 6e20 6465 6e6f 6973 696e 672e 0d0a 0d0a  n denoising.....
+0000e930: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0000e940: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
+0000e950: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
+0000e960: 6c6d 6420 3a20 666c 6f61 742c 2064 6566  lmd : float, def
+0000e970: 6175 6c74 2069 7320 302e 3035 0d0a 2020  ault is 0.05..  
+0000e980: 2020 2020 2020 2020 2020 436f 6e73 7461            Consta
+0000e990: 6e74 2076 616c 7565 2069 6e20 746f 7461  nt value in tota
+0000e9a0: 6c20 7661 7269 6174 696f 6e2e 0d0a 2020  l variation...  
+0000e9b0: 2020 2020 2020 746f 6c20 3a20 666c 6f61        tol : floa
+0000e9c0: 742c 2064 6566 6175 6c74 2069 7320 3165  t, default is 1e
+0000e9d0: 2d34 0d0a 2020 2020 2020 2020 2020 2020  -4..            
+0000e9e0: 4974 6572 6174 696f 6e20 7374 6f70 7320  Iteration stops 
+0000e9f0: 7768 656e 2067 6169 6e20 6973 2075 6e64  when gain is und
+0000ea00: 6572 2074 6869 7320 7661 6c75 652e 0d0a  er this value...
+0000ea10: 2020 2020 2020 2020 6d61 785f 6974 6572          max_iter
+0000ea20: 203a 2069 6e74 2c20 6465 6661 756c 7420   : int, default 
+0000ea30: 6973 2035 300d 0a20 2020 2020 2020 2020  is 50..         
+0000ea40: 2020 204d 6178 696d 756d 206e 756d 6265     Maximum numbe
+0000ea50: 7220 6f66 2069 7465 7261 7469 6f6e 732e  r of iterations.
+0000ea60: 0d0a 2020 2020 2020 2020 7b64 696d 737d  ..        {dims}
+0000ea70: 7b75 7064 6174 657d 0d0a 2020 2020 2020  {update}..      
+0000ea80: 2020 0d0a 2020 2020 2020 2020 5265 7475    ..        Retu
+0000ea90: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+0000eaa0: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+0000eab0: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+0000eac0: 2020 2020 4669 6c74 6572 6564 2069 6d61      Filtered ima
+0000ead0: 6765 0d0a 2020 2020 2020 2020 2222 2220  ge..        """ 
+0000eae0: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+0000eaf0: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
+0000eb00: 5f64 6173 6b28 0d0a 2020 2020 2020 2020  _dask(..        
+0000eb10: 2020 2020 736b 7265 732e 5f64 656e 6f69      skres._denoi
+0000eb20: 7365 2e5f 6465 6e6f 6973 655f 7476 5f63  se._denoise_tv_c
+0000eb30: 6861 6d62 6f6c 6c65 5f6e 642c 200d 0a20  hambolle_nd, .. 
+0000eb40: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
+0000eb50: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
+0000eb60: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+0000eb70: 7329 2c0d 0a20 2020 2020 2020 2020 2020  s),..           
+0000eb80: 206b 7761 7267 733d 6469 6374 2877 6569   kwargs=dict(wei
+0000eb90: 6768 743d 6c6d 642c 2065 7073 3d74 6f6c  ght=lmd, eps=tol
+0000eba0: 2c20 6d61 785f 6e75 6d5f 6974 6572 3d6d  , max_num_iter=m
+0000ebb0: 6178 5f69 7465 7229 0d0a 2020 2020 2020  ax_iter)..      
+0000ebc0: 2020 290d 0a20 2020 2020 2020 200d 0a20    )..        .. 
+0000ebd0: 2020 2040 5f64 6f63 732e 7772 6974 655f     @_docs.write_
+0000ebe0: 646f 6373 0d0a 2020 2020 4064 696d 735f  docs..    @dims_
+0000ebf0: 746f 5f73 7061 7469 616c 5f61 7865 730d  to_spatial_axes.
+0000ec00: 0a20 2020 2040 7361 6d65 5f64 7479 7065  .    @same_dtype
+0000ec10: 2861 7366 6c6f 6174 3d54 7275 6529 0d0a  (asfloat=True)..
+0000ec20: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
+0000ec30: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
+0000ec40: 2064 6566 2077 6176 656c 6574 5f64 656e   def wavelet_den
+0000ec50: 6f69 7369 6e67 280d 0a20 2020 2020 2020  oising(..       
+0000ec60: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+0000ec70: 6e6f 6973 655f 7369 676d 613a 2066 6c6f  noise_sigma: flo
+0000ec80: 6174 207c 204e 6f6e 6520 3d20 4e6f 6e65  at | None = None
+0000ec90: 2c0d 0a20 2020 2020 2020 202a 2c20 0d0a  ,..        *, ..
+0000eca0: 2020 2020 2020 2020 7761 7665 6c65 743a          wavelet:
+0000ecb0: 2073 7472 203d 2022 6462 3122 2c0d 0a20   str = "db1",.. 
+0000ecc0: 2020 2020 2020 206d 6f64 653a 204c 6974         mode: Lit
+0000ecd0: 6572 616c 5b22 736f 6674 222c 2022 6861  eral["soft", "ha
+0000ece0: 7264 225d 203d 2022 736f 6674 222c 200d  rd"] = "soft", .
+0000ecf0: 0a20 2020 2020 2020 2077 6176 656c 6574  .        wavelet
+0000ed00: 5f6c 6576 656c 733a 2069 6e74 207c 204e  _levels: int | N
+0000ed10: 6f6e 6520 3d20 4e6f 6e65 2c0d 0a20 2020  one = None,..   
+0000ed20: 2020 2020 206d 6574 686f 643a 204c 6974       method: Lit
+0000ed30: 6572 616c 5b22 4261 7965 7353 6872 696e  eral["BayesShrin
+0000ed40: 6b22 2c20 2256 6973 7553 6872 696e 6b22  k", "VisuShrink"
+0000ed50: 5d20 3d20 2242 6179 6573 5368 7269 6e6b  ] = "BayesShrink
+0000ed60: 222c 0d0a 2020 2020 2020 2020 6d61 785f  ",..        max_
+0000ed70: 7368 6966 7473 3a20 696e 7420 7c20 7475  shifts: int | tu
+0000ed80: 706c 655b 696e 742c 202e 2e2e 5d20 3d20  ple[int, ...] = 
+0000ed90: 302c 0d0a 2020 2020 2020 2020 7368 6966  0,..        shif
+0000eda0: 745f 7374 6570 733a 2069 6e74 207c 2074  t_steps: int | t
+0000edb0: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 203d  uple[int, ...] =
+0000edc0: 2031 2c0d 0a20 2020 2020 2020 2064 696d   1,..        dim
+0000edd0: 733a 2044 696d 7320 3d20 4e6f 6e65 2c0d  s: Dims = None,.
+0000ede0: 0a20 2020 2029 202d 3e20 496d 6741 7272  .    ) -> ImgArr
+0000edf0: 6179 3a0d 0a20 2020 2020 2020 2022 2222  ay:..        """
+0000ee00: 0d0a 2020 2020 2020 2020 5761 7665 6c65  ..        Wavele
+0000ee10: 7420 6465 6e6f 6973 696e 672e 2042 6563  t denoising. Bec
+0000ee20: 6175 7365 2069 7420 6973 206e 6f74 2073  ause it is not s
+0000ee30: 6869 6674 2069 6e76 6172 6961 6e74 2c20  hift invariant, 
+0000ee40: 6060 6379 636c 655f 7370 696e 6060 2069  ``cycle_spin`` i
+0000ee50: 7320 6361 6c6c 6564 2069 6e73 6964 6520  s called inside 
+0000ee60: 7468 6520 0d0a 2020 2020 2020 2020 6675  the ..        fu
+0000ee70: 6e63 7469 6f6e 2e0d 0a0d 0a20 2020 2020  nction.....     
+0000ee80: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+0000ee90: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0000eea0: 2d0d 0a20 2020 2020 2020 206e 6f69 7365  -..        noise
+0000eeb0: 5f73 6967 6d61 203a 2066 6c6f 6174 2c20  _sigma : float, 
+0000eec0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+0000eed0: 2020 2020 2020 5374 616e 6461 7264 2064        Standard d
+0000eee0: 6576 6961 7469 6f6e 206f 6620 6e6f 6973  eviation of nois
+0000eef0: 652c 2069 6620 6b6e 6f77 6e2e 0d0a 2020  e, if known...  
+0000ef00: 2020 2020 2020 7761 7665 6c65 7420 3a20        wavelet : 
+0000ef10: 7374 722c 2064 6566 6175 6c74 2069 7320  str, default is 
+0000ef20: 2264 6231 220d 0a20 2020 2020 2020 2020  "db1"..         
+0000ef30: 2020 2041 6e79 206f 7074 696f 6e73 206f     Any options o
+0000ef40: 6620 6070 7977 742e 7761 7665 6c69 7374  f `pywt.wavelist
+0000ef50: 602e 0d0a 2020 2020 2020 2020 6d6f 6465  `...        mode
+0000ef60: 203a 207b 2273 6f66 7422 2c20 2268 6172   : {"soft", "har
+0000ef70: 6422 7d2c 2064 6566 6175 6c74 2069 7320  d"}, default is 
+0000ef80: 2273 6f66 7422 0d0a 2020 2020 2020 2020  "soft"..        
+0000ef90: 2020 2020 5479 7065 206f 6620 6465 6e6f      Type of deno
+0000efa0: 6973 696e 672e 0d0a 2020 2020 2020 2020  ising...        
+0000efb0: 7761 7665 6c65 745f 6c65 7665 6c73 203a  wavelet_levels :
+0000efc0: 2069 6e74 2c20 6f70 7469 6f6e 616c 0d0a   int, optional..
+0000efd0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0000efe0: 6e75 6d62 6572 206f 6620 7761 7665 6c65  number of wavele
+0000eff0: 7420 6465 636f 6d70 6f73 6974 696f 6e20  t decomposition 
+0000f000: 6c65 7665 6c73 2074 6f20 7573 652e 0d0a  levels to use...
+0000f010: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+0000f020: 207b 2242 6179 6573 5368 7269 6e6b 222c   {"BayesShrink",
+0000f030: 2022 5669 7375 5368 7269 6e6b 227d 2c20   "VisuShrink"}, 
+0000f040: 6465 6661 756c 7420 6973 2022 4261 7965  default is "Baye
+0000f050: 7353 6872 696e 6b22 0d0a 2020 2020 2020  sShrink"..      
+0000f060: 2020 2020 2020 5468 7265 7368 6f6c 6469        Thresholdi
+0000f070: 6e67 206d 6574 686f 6420 746f 2062 6520  ng method to be 
+0000f080: 7573 6564 0d0a 2020 2020 2020 2020 6d61  used..        ma
+0000f090: 785f 7368 6966 7473 203a 2069 6e74 206f  x_shifts : int o
+0000f0a0: 7220 7475 706c 652c 2064 6566 6175 6c74  r tuple, default
+0000f0b0: 2069 7320 300d 0a20 2020 2020 2020 2020   is 0..         
+0000f0c0: 2020 2053 6869 6674 7320 696e 2072 616e     Shifts in ran
+0000f0d0: 6765 2830 2c20 6d61 785f 7368 6966 7473  ge(0, max_shifts
+0000f0e0: 2b31 2920 7769 6c6c 2062 6520 7573 6564  +1) will be used
+0000f0f0: 2e0d 0a20 2020 2020 2020 2073 6869 6674  ...        shift
+0000f100: 5f73 7465 7073 203a 2069 6e74 206f 7220  _steps : int or 
+0000f110: 7475 706c 652c 2064 6566 6175 6c74 2069  tuple, default i
+0000f120: 7320 310d 0a20 2020 2020 2020 2020 2020  s 1..           
+0000f130: 2053 7465 7020 7369 7a65 206f 6620 7368   Step size of sh
+0000f140: 6966 7473 2e0d 0a20 2020 2020 2020 207b  ifts...        {
+0000f150: 6469 6d73 7d0d 0a0d 0a20 2020 2020 2020  dims}....       
+0000f160: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+0000f170: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+0000f180: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
+0000f190: 2020 2020 2020 2020 2044 656e 6f69 7365           Denoise
+0000f1a0: 6420 696d 6167 652e 0d0a 2020 2020 2020  d image...      
+0000f1b0: 2020 2222 2220 2020 2020 2020 200d 0a20    """        .. 
+0000f1c0: 2020 2020 2020 2066 756e 635f 6b77 203d         func_kw =
+0000f1d0: 2064 6963 7428 0d0a 2020 2020 2020 2020   dict(..        
+0000f1e0: 2020 2020 7369 676d 613d 6e6f 6973 655f      sigma=noise_
+0000f1f0: 7369 676d 612c 200d 0a20 2020 2020 2020  sigma, ..       
+0000f200: 2020 2020 2077 6176 656c 6574 3d77 6176       wavelet=wav
+0000f210: 656c 6574 2c20 0d0a 2020 2020 2020 2020  elet, ..        
+0000f220: 2020 2020 6d6f 6465 3d6d 6f64 652c 200d      mode=mode, .
+0000f230: 0a20 2020 2020 2020 2020 2020 2077 6176  .            wav
+0000f240: 656c 6574 5f6c 6576 656c 733d 7761 7665  elet_levels=wave
+0000f250: 6c65 745f 6c65 7665 6c73 2c0d 0a20 2020  let_levels,..   
+0000f260: 2020 2020 2020 2020 206d 6574 686f 643d           method=
+0000f270: 6d65 7468 6f64 0d0a 2020 2020 2020 2020  method..        
+0000f280: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000f290: 6e20 7365 6c66 2e5f 6170 706c 795f 6461  n self._apply_da
+0000f2a0: 736b 280d 0a20 2020 2020 2020 2020 2020  sk(..           
+0000f2b0: 2073 6b72 6573 2e63 7963 6c65 5f73 7069   skres.cycle_spi
+0000f2c0: 6e2c 200d 0a20 2020 2020 2020 2020 2020  n, ..           
+0000f2d0: 2063 5f61 7865 733d 636f 6d70 6c65 6d65   c_axes=compleme
+0000f2e0: 6e74 5f61 7865 7328 6469 6d73 2c20 7365  nt_axes(dims, se
+0000f2f0: 6c66 2e61 7865 7329 2c20 0d0a 2020 2020  lf.axes), ..    
+0000f300: 2020 2020 2020 2020 6172 6773 3d28 736b          args=(sk
+0000f310: 7265 732e 6465 6e6f 6973 655f 7761 7665  res.denoise_wave
+0000f320: 6c65 742c 292c 0d0a 2020 2020 2020 2020  let,),..        
+0000f330: 2020 2020 6b77 6172 6773 3d64 6963 7428      kwargs=dict(
+0000f340: 6675 6e63 5f6b 773d 6675 6e63 5f6b 772c  func_kw=func_kw,
+0000f350: 206d 6178 5f73 6869 6674 733d 6d61 785f   max_shifts=max_
+0000f360: 7368 6966 7473 2c20 7368 6966 745f 7374  shifts, shift_st
+0000f370: 6570 733d 7368 6966 745f 7374 6570 7329  eps=shift_steps)
+0000f380: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+0000f390: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
+0000f3a0: 6974 655f 646f 6373 0d0a 2020 2020 6465  ite_docs..    de
+0000f3b0: 6620 7370 6c69 745f 7069 7865 6c5f 756e  f split_pixel_un
+0000f3c0: 6974 280d 0a20 2020 2020 2020 2073 656c  it(..        sel
+0000f3d0: 662c 0d0a 2020 2020 2020 2020 6365 6e74  f,..        cent
+0000f3e0: 6572 3a20 7475 706c 655b 666c 6f61 742c  er: tuple[float,
+0000f3f0: 2066 6c6f 6174 5d20 3d20 2830 2e35 2c20   float] = (0.5, 
+0000f400: 302e 3529 2c0d 0a20 2020 2020 2020 202a  0.5),..        *
+0000f410: 2c20 0d0a 2020 2020 2020 2020 6f72 6465  , ..        orde
+0000f420: 723a 2069 6e74 203d 2031 2c0d 0a20 2020  r: int = 1,..   
+0000f430: 2020 2020 2061 6e67 6c65 5f6f 7264 6572       angle_order
+0000f440: 3a20 6c69 7374 5b69 6e74 5d20 7c20 4e6f  : list[int] | No
+0000f450: 6e65 203d 204e 6f6e 652c 0d0a 2020 2020  ne = None,..    
+0000f460: 2020 2020 6e65 7761 7869 733a 2041 7869      newaxis: Axi
+0000f470: 734c 696b 6520 3d20 2261 222c 0d0a 2020  sLike = "a",..  
+0000f480: 2020 2920 2d3e 2049 6d67 4172 7261 793a    ) -> ImgArray:
+0000f490: 0d0a 2020 2020 2020 2020 7222 2222 0d0a  ..        r"""..
+0000f4a0: 2020 2020 2020 2020 5370 6c69 7420 6120          Split a 
+0000f4b0: 2832 4e2c 2032 4d29 2d69 6d61 6765 2069  (2N, 2M)-image i
+0000f4c0: 6e74 6f20 666f 7572 2028 4e2c 204d 292d  nto four (N, M)-
+0000f4d0: 696d 6167 6573 2066 6f72 2065 6163 6820  images for each 
+0000f4e0: 6f74 6865 7220 7069 7865 6c73 2e0d 0a20  other pixels... 
+0000f4f0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000f500: 2047 656e 6572 616c 6c79 2c20 696d 6167   Generally, imag
+0000f510: 6520 6163 7175 6973 6974 696f 6e20 7769  e acquisition wi
+0000f520: 7468 2061 2070 6f6c 6172 697a 6174 696f  th a polarizatio
+0000f530: 6e20 6361 6d65 7261 2077 696c 6c20 6f75  n camera will ou
+0000f540: 7470 7574 200d 0a20 2020 2020 2020 203a  tput ..        :
+0000f550: 6d61 7468 3a60 2832 4e2c 2032 4d29 602d  math:`(2N, 2M)`-
+0000f560: 696d 6167 6520 7769 7468 203a 6d61 7468  image with :math
+0000f570: 3a60 4e20 5c74 696d 6573 204d 6020 7069  :`N \times M` pi
+0000f580: 7865 6c20 756e 6974 733a 0d0a 2020 2020  xel units:..    
+0000f590: 2020 2020 0d0a 2020 2020 2020 2020 2b2d      ..        +-
+0000f5a0: 2b2d 2b2d 2b2d 2b2d 2b2d 2b0d 0a20 2020  +-+-+-+-+-+..   
+0000f5b0: 2020 2020 207c 307c 317c 307c 317c 307c       |0|1|0|1|0|
+0000f5c0: 317c 0d0a 2020 2020 2020 2020 2b2d 2b2d  1|..        +-+-
+0000f5d0: 2b2d 2b2d 2b2d 2b2d 2b0d 0a20 2020 2020  +-+-+-+-+..     
+0000f5e0: 2020 207c 337c 327c 337c 327c 337c 327c     |3|2|3|2|3|2|
+0000f5f0: 0d0a 2020 2020 2020 2020 2b2d 2b2d 2b2d  ..        +-+-+-
+0000f600: 2b2d 2b2d 2b2d 2b0d 0a20 2020 2020 2020  +-+-+-+..       
+0000f610: 207c 307c 317c 307c 317c 307c 317c 0d0a   |0|1|0|1|0|1|..
+0000f620: 2020 2020 2020 2020 2b2d 2b2d 2b2d 2b2d          +-+-+-+-
+0000f630: 2b2d 2b2d 2b0d 0a20 2020 2020 2020 207c  +-+-+..        |
+0000f640: 337c 327c 337c 327c 337c 327c 0d0a 2020  3|2|3|2|3|2|..  
+0000f650: 2020 2020 2020 2b2d 2b2d 2b2d 2b2d 2b2d        +-+-+-+-+-
+0000f660: 2b2d 2b0d 0a20 2020 2020 2020 200d 0a20  +-+..        .. 
+0000f670: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
+0000f680: 7469 6f6e 2067 656e 6572 6174 6573 2069  tion generates i
+0000f690: 6d61 6765 7320 6f6e 6c79 2063 6f6e 7369  mages only consi
+0000f6a0: 7374 206f 6620 706f 7369 7469 6f6e 7320  st of positions 
+0000f6b0: 6f66 205b 305d 2c20 5b31 5d2c 200d 0a20  of [0], [1], .. 
+0000f6c0: 2020 2020 2020 205b 325d 206f 7220 5b33         [2] or [3
+0000f6d0: 5d2e 2053 7472 6963 746c 792c 2065 6163  ]. Strictly, eac
+0000f6e0: 6820 696d 6167 6520 6973 2061 6371 7569  h image is acqui
+0000f6f0: 7265 6420 6672 6f6d 2064 6966 6665 7265  red from differe
+0000f700: 6e74 2070 6f73 6974 696f 6e20 0d0a 2020  nt position ..  
+0000f710: 2020 2020 2020 2874 6865 2070 6978 656c        (the pixel
+0000f720: 2028 692c 206a 2920 696e 205b 305d 2d69   (i, j) in [0]-i
+0000f730: 6d61 6765 2061 6e64 2074 6865 2070 6978  mage and the pix
+0000f740: 656c 2028 692c 206a 2920 696e 205b 315d  el (i, j) in [1]
+0000f750: 2d69 6d61 6765 2061 7265 200d 0a20 2020  -image are ..   
+0000f760: 2020 2020 2061 6371 7569 7265 6420 6672       acquired fr
+0000f770: 6f6d 2064 6966 6665 7265 6e74 2070 6f73  om different pos
+0000f780: 6974 696f 6e73 292e 2054 6869 7320 6675  itions). This fu
+0000f790: 6e63 7469 6f6e 2061 6c73 6f20 636f 6d70  nction also comp
+0000f7a0: 6c65 6d65 6e74 7320 666f 720d 0a20 2020  lements for..   
+0000f7b0: 2020 2020 2074 6869 7320 6469 6666 6572       this differ
+0000f7c0: 656e 6365 2062 7920 696e 7465 7270 6f6c  ence by interpol
+0000f7d0: 6174 696f 6e2e 0d0a 2020 2020 2020 2020  ation...        
+0000f7e0: 200d 0a20 2020 2020 2020 2050 6172 616d   ..        Param
+0000f7f0: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
+0000f800: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
+0000f810: 2020 2063 656e 7465 7220 3a20 7475 706c     center : tupl
+0000f820: 652c 2064 6566 6175 6c74 2069 7320 2830  e, default is (0
+0000f830: 2c20 3029 0d0a 2020 2020 2020 2020 2020  , 0)..          
+0000f840: 2020 436f 6f72 6469 6e61 7465 2074 6861    Coordinate tha
+0000f850: 7420 7769 6c6c 2062 6520 636f 6e73 6964  t will be consid
+0000f860: 6572 6564 2061 7320 7468 6520 6365 6e74  ered as the cent
+0000f870: 6572 206f 6620 7468 6520 7265 7475 726e  er of the return
+0000f880: 6564 200d 0a20 2020 2020 2020 2020 2020  ed ..           
+0000f890: 2069 6d61 6765 2e20 496e 7075 7420 2861   image. Input (a
+0000f8a0: 2c20 6229 206d 7573 7420 7361 7469 7366  , b) must satisf
+0000f8b0: 7920 3020 3c20 6120 3c20 3120 616e 6420  y 0 < a < 1 and 
+0000f8c0: 3020 3c20 6220 3c20 312e 2046 6f72 2065  0 < b < 1. For e
+0000f8d0: 7861 6d70 6c65 2c0d 0a20 2020 2020 2020  xample,..       
+0000f8e0: 2020 2020 2063 656e 7465 723d 2830 2c20       center=(0, 
+0000f8f0: 3029 206d 6561 6e73 2074 6865 206d 6f73  0) means the mos
+0000f900: 7420 7570 7065 7220 6c65 6674 2070 6978  t upper left pix
+0000f910: 656c 2c20 616e 6420 6365 6e74 6572 3d28  el, and center=(
+0000f920: 302e 352c 2030 2e35 290d 0a20 2020 2020  0.5, 0.5)..     
+0000f930: 2020 2020 2020 206d 6561 6e73 2074 6865         means the
+0000f940: 206d 6964 646c 6520 706f 696e 7420 6f66   middle point of
+0000f950: 2061 2070 6978 656c 2075 6e69 742e 2060   a pixel unit. `
+0000f960: 5b5b 302c 2031 5d2c 205b 332c 2032 5d5d  [[0, 1], [3, 2]]
+0000f970: 6020 6265 636f 6d65 730d 0a20 2020 2020  ` becomes..     
+0000f980: 2020 2020 2020 2060 5b5b 2830 2c20 3029         `[[(0, 0)
+0000f990: 2c20 2830 2c20 3129 5d2c 205b 2831 2c20  , (0, 1)], [(1, 
+0000f9a0: 3029 2c20 2831 2c20 3129 5d5d 602e 0d0a  0), (1, 1)]]`...
+0000f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9c0: 2020 2020 0d0a 2020 2020 2020 2020 7b6f      ..        {o
+0000f9d0: 7264 6572 7d0d 0a20 2020 2020 2020 2061  rder}..        a
+0000f9e0: 6e67 6c65 5f6f 7264 6572 203a 206c 6973  ngle_order : lis
+0000f9f0: 7420 6f66 2069 6e74 2c20 6465 6661 756c  t of int, defaul
+0000fa00: 7420 6973 205b 322c 2031 2c20 302c 2033  t is [2, 1, 0, 3
+0000fa10: 5d0d 0a20 2020 2020 2020 2020 2020 2053  ]..            S
+0000fa20: 7065 6369 6679 2077 6869 6368 2070 6978  pecify which pix
+0000fa30: 656c 7320 636f 7272 6573 706f 6e64 2074  els correspond t
+0000fa40: 6f20 7768 6963 6820 706f 6c61 7269 7a61  o which polariza
+0000fa50: 7469 6f6e 2061 6e67 6c65 732e 2030 2c20  tion angles. 0, 
+0000fa60: 312c 2032 200d 0a20 2020 2020 2020 2020  1, 2 ..         
+0000fa70: 2020 2061 6e64 2033 2063 6f72 7265 7370     and 3 corresp
+0000fa80: 6f6e 6473 2074 6f20 706f 6c61 7269 7a61  onds to polariza
+0000fa90: 7469 6f6e 206f 6620 302c 2034 352c 2039  tion of 0, 45, 9
+0000faa0: 3020 616e 6420 3133 3520 6465 6772 6565  0 and 135 degree
+0000fab0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000fac0: 7370 6563 7469 7665 6c79 2e20 5468 6973  spectively. This
+0000fad0: 206c 6973 7420 7769 6c6c 2062 6520 6469   list will be di
+0000fae0: 7265 6374 6c79 2070 6173 7365 6420 746f  rectly passed to
+0000faf0: 2060 606e 702e 6e64 6172 7261 7960 6020   ``np.ndarray`` 
+0000fb00: 6c69 6b65 0d0a 2020 2020 2020 2020 2020  like..          
+0000fb10: 2020 6060 6172 725b 616e 676c 655f 6f72    ``arr[angle_or
+0000fb20: 6465 725d 6060 2074 6f20 736f 7274 2069  der]`` to sort i
+0000fb30: 742e 2046 6f72 2065 7861 6d70 6c65 2c20  t. For example, 
+0000fb40: 6966 2061 2070 6978 656c 2075 6e69 7420  if a pixel unit 
+0000fb50: 7265 6365 6976 6573 200d 0a20 2020 2020  receives ..     
+0000fb60: 2020 2020 2020 2070 6f6c 6172 697a 6564         polarized
+0000fb70: 206c 6967 6874 206c 696b 6520 6265 6c6f   light like belo
+0000fb80: 773a 0d0a 2020 2020 2020 2020 2020 2020  w:..            
+0000fb90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fba0: 2020 2e2e 2063 6f64 652d 626c 6f63 6b3a    .. code-block:
+0000fbb0: 3a0d 0a20 2020 2020 2020 2020 2020 200d  :..            .
+0000fbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fbd0: 2020 2020 205b 305d 205b 315d 2020 2020       [0] [1]    
+0000fbe0: 5b20 3930 5d20 5b20 3435 5d20 2020 205b  [ 90] [ 45]    [
+0000fbf0: 7c5d 205b 2f5d 0d0a 2020 2020 2020 2020  |] [/]..        
+0000fc00: 2020 2020 2020 2020 2020 2020 5b32 5d20              [2] 
+0000fc10: 5b33 5d20 2d3e 205b 3133 355d 205b 2020  [3] -> [135] [  
+0000fc20: 305d 206f 7220 5b5c 5d20 5b2d 5d0d 0a20  0] or [\] [-].. 
+0000fc30: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+0000fc40: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0000fc50: 6e20 6060 616e 676c 655f 6f72 6465 7260  n ``angle_order`
+0000fc60: 6020 7368 6f75 6c64 2062 6520 5b32 2c20  ` should be [2, 
+0000fc70: 312c 2030 2c20 335d 2e0d 0a20 2020 2020  1, 0, 3]...     
+0000fc80: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000fc90: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+0000fca0: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+0000fcb0: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
+0000fcc0: 2020 2020 2020 2020 2041 7869 7320 2261           Axis "a
+0000fcd0: 2220 6973 2061 6464 6564 2069 6e20 7468  " is added in th
+0000fce0: 6520 6669 7273 7420 6469 6d65 6e73 696f  e first dimensio
+0000fcf0: 6e2e 2046 6f72 2065 7861 6d70 6c65 2c20  n. For example, 
+0000fd00: 4966 2069 6e70 7574 2069 730d 0a20 2020  If input is..   
+0000fd10: 2020 2020 2020 2020 2022 7479 7822 2d61           "tyx"-a
+0000fd20: 7865 732c 2074 6865 6e20 6f75 7470 7574  xes, then output
+0000fd30: 2077 696c 6c20 6265 2022 6174 7978 222d   will be "atyx"-
+0000fd40: 6178 6573 2e0d 0a20 2020 2020 2020 200d  axes...        .
+0000fd50: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+0000fd60: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+0000fd70: 2d2d 2d0d 0a20 2020 2020 2020 2045 7874  ---..        Ext
+0000fd80: 7261 6374 2070 6f6c 6172 697a 6174 696f  ract polarizatio
+0000fd90: 6e20 696e 2030 2d2c 2034 352d 2c20 3930  n in 0-, 45-, 90
+0000fda0: 2d20 616e 6420 3133 352d 6465 6772 6565  - and 135-degree
+0000fdb0: 2064 6972 6563 7469 6f6e 7320 6672 6f6d   directions from
+0000fdc0: 2061 6e20 0d0a 2020 2020 2020 2020 696d   an ..        im
+0000fdd0: 6167 6520 7468 6174 2069 7320 6163 7175  age that is acqu
+0000fde0: 6972 6564 2066 726f 6d20 6120 706f 6c61  ired from a pola
+0000fdf0: 7269 7a61 7469 6f6e 2063 616d 6572 612c  rization camera,
+0000fe00: 2061 6e64 2063 616c 6375 6c61 7465 2074   and calculate t
+0000fe10: 6f74 616c 200d 0a20 2020 2020 2020 2069  otal ..        i
+0000fe20: 6e74 656e 7369 7479 206f 6620 6c69 6768  ntensity of ligh
+0000fe30: 7420 6279 2061 7665 7261 6769 6e67 2e0d  t by averaging..
+0000fe40: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000fe50: 2020 2020 2020 203e 3e3e 2069 6d67 5f70         >>> img_p
+0000fe60: 6f6c 203d 2069 6d67 2e73 706c 6974 5f70  ol = img.split_p
+0000fe70: 6978 656c 5f75 6e69 7428 290d 0a20 2020  ixel_unit()..   
+0000fe80: 2020 2020 2020 2020 203e 3e3e 2069 6d67           >>> img
+0000fe90: 5f74 6f74 616c 203d 2069 6d67 5f70 6f6c  _total = img_pol
+0000fea0: 2e70 726f 6a28 6178 6973 3d22 6122 290d  .proj(axis="a").
+0000feb0: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
+0000fec0: 2020 2020 0d0a 2020 2020 2020 2020 7963      ..        yc
+0000fed0: 2c20 7863 203d 2063 656e 7465 720d 0a20  , xc = center.. 
+0000fee0: 2020 2020 2020 2069 6620 616e 676c 655f         if angle_
+0000fef0: 6f72 6465 7220 6973 204e 6f6e 653a 0d0a  order is None:..
+0000ff00: 2020 2020 2020 2020 2020 2020 616e 676c              angl
+0000ff10: 655f 6f72 6465 7220 3d20 5b32 2c20 312c  e_order = [2, 1,
+0000ff20: 2030 2c20 335d 0d0a 2020 2020 2020 2020   0, 3]..        
+0000ff30: 2020 2020 0d0a 2020 2020 2020 2020 6966      ..        if
+0000ff40: 206e 6f74 2073 656c 662e 7368 6170 652e   not self.shape.
+0000ff50: 7820 2520 3220 3d3d 2073 656c 662e 7368  x % 2 == self.sh
+0000ff60: 6170 652e 7920 2520 3220 3d3d 2030 3a0d  ape.y % 2 == 0:.
+0000ff70: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000ff80: 7365 2056 616c 7565 4572 726f 7228 0d0a  se ValueError(..
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffa0: 6622 496d 6167 6520 7069 7865 6c20 7369  f"Image pixel si
+0000ffb0: 7a65 7320 6d75 7374 2062 6520 6576 656e  zes must be even
+0000ffc0: 206e 756d 6265 7273 2c20 676f 7420 7b73   numbers, got {s
+0000ffd0: 656c 662e 7369 7a65 736f 6628 2779 7827  elf.sizesof('yx'
+0000ffe0: 297d 220d 0a20 2020 2020 2020 2020 2020  )}"..           
+0000fff0: 2029 0d0a 2020 2020 2020 2020 696d 6773   )..        imgs
+00010000: 3a20 6c69 7374 5b49 6d67 4172 7261 795d  : list[ImgArray]
+00010010: 203d 205b 5d0d 0a20 2020 2020 2020 2066   = []..        f
+00010020: 6d74 203d 2073 6c69 6365 722e 6765 745f  mt = slicer.get_
+00010030: 666f 726d 6174 7465 7228 5b22 7922 2c20  formatter(["y", 
+00010040: 2278 225d 290d 0a20 2020 2020 2020 2066  "x"])..        f
+00010050: 6f72 2079 2c20 7820 696e 205b 2830 2c20  or y, x in [(0, 
+00010060: 3029 2c20 2830 2c20 3129 2c20 2831 2c20  0), (0, 1), (1, 
+00010070: 3129 2c20 2831 2c20 3029 5d3a 0d0a 2020  1), (1, 0)]:..  
+00010080: 2020 2020 2020 2020 2020 6472 203d 205b            dr = [
+00010090: 2879 6320 2d20 7929 2f32 2c20 2878 6320  (yc - y)/2, (xc 
+000100a0: 2d20 7829 2f32 5d0d 0a20 2020 2020 2020  - x)/2]..       
+000100b0: 2020 2020 2069 6d67 732e 6170 7065 6e64       imgs.append
+000100c0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000100d0: 2020 2073 656c 665b 666d 745b 793a 3a32     self[fmt[y::2
+000100e0: 2c20 783a 3a32 5d5d 2e61 6666 696e 6528  , x::2]].affine(
+000100f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010100: 2020 2020 2020 7472 616e 736c 6174 696f        translatio
+00010110: 6e3d 6472 2c20 6f72 6465 723d 6f72 6465  n=dr, order=orde
+00010120: 722c 2064 696d 733d 2279 7822 0d0a 2020  r, dims="yx"..  
+00010130: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00010140: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00010150: 2020 2020 2020 2020 6f75 743a 2049 6d67          out: Img
+00010160: 4172 7261 7920 3d20 6e70 2e73 7461 636b  Array = np.stack
+00010170: 2869 6d67 732c 2061 7869 733d 6e65 7761  (imgs, axis=newa
+00010180: 7869 7329 0d0a 2020 2020 2020 2020 6966  xis)..        if
+00010190: 206f 7574 2e6c 6162 656c 7320 6973 206e   out.labels is n
+000101a0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+000101b0: 2020 2020 2020 6465 6c20 6f75 742e 6c61        del out.la
+000101c0: 6265 6c73 0d0a 2020 2020 2020 2020 2020  bels..          
+000101d0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+000101e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000101f0: 2020 224f 7574 7075 7420 696d 6167 6520    "Output image 
+00010200: 6c61 6265 6c73 2061 7265 2064 656c 6574  labels are delet
+00010210: 6564 2062 6563 6175 7365 2069 7420 6973  ed because it is
+00010220: 2069 6e63 6f6d 7061 7469 626c 6520 7769   incompatible wi
+00010230: 7468 2022 0d0a 2020 2020 2020 2020 2020  th "..          
+00010240: 2020 2020 2020 2273 706c 6974 5f70 6978        "split_pix
+00010250: 656c 5f75 6e69 7422 2c0d 0a20 2020 2020  el_unit",..     
+00010260: 2020 2020 2020 2020 2020 2055 7365 7257             UserW
+00010270: 6172 6e69 6e67 2c0d 0a20 2020 2020 2020  arning,..       
+00010280: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00010290: 6f75 7420 3d20 6f75 745b 6622 7b6e 6577  out = out[f"{new
+000102a0: 6178 6973 7d3d 7b73 7472 2861 6e67 6c65  axis}={str(angle
+000102b0: 5f6f 7264 6572 295b 313a 2d31 5d7d 225d  _order)[1:-1]}"]
+000102c0: 0d0a 2020 2020 2020 2020 6f75 742e 5f73  ..        out._s
+000102d0: 6574 5f69 6e66 6f28 7365 6c66 2c20 6e65  et_info(self, ne
+000102e0: 775f 6178 6573 3d6f 7574 2e61 7865 7329  w_axes=out.axes)
+000102f0: 0d0a 2020 2020 2020 2020 6f75 742e 7365  ..        out.se
+00010300: 745f 7363 616c 6528 793d 7365 6c66 2e73  t_scale(y=self.s
+00010310: 6361 6c65 2e79 2a32 2c20 783d 7365 6c66  cale.y*2, x=self
+00010320: 2e73 6361 6c65 2e78 2a32 290d 0a20 2020  .scale.x*2)..   
+00010330: 2020 2020 2072 6574 7572 6e20 6f75 740d       return out.
+00010340: 0a20 2020 2020 2020 200d 0a20 2020 2064  .        ..    d
+00010350: 6566 2073 746f 6b65 7328 7365 6c66 2c20  ef stokes(self, 
+00010360: 2a2c 2061 6c6f 6e67 3a20 4178 6973 4c69  *, along: AxisLi
+00010370: 6b65 203d 2022 6122 2920 2d3e 2064 6963  ke = "a") -> dic
+00010380: 743a 0d0a 2020 2020 2020 2020 2222 220d  t:..        """.
+00010390: 0a20 2020 2020 2020 2047 656e 6572 6174  .        Generat
+000103a0: 6520 7374 6f63 6b73 2069 6d61 6765 7320  e stocks images 
+000103b0: 6672 6f6d 2061 6e20 696d 6167 6520 7374  from an image st
+000103c0: 6163 6b20 7769 7468 2070 6f6c 6172 697a  ack with polariz
+000103d0: 6564 2069 6d61 6765 732e 200d 0a20 2020  ed images. ..   
+000103e0: 2020 2020 200d 0a20 2020 2020 2020 2043       ..        C
+000103f0: 7572 7265 6e74 6c79 2c20 4465 6772 6565  urrently, Degree
+00010400: 206f 6620 4c69 6e65 6172 2050 6f6c 6172   of Linear Polar
+00010410: 697a 6174 696f 6e20 2844 6f4c 5029 2061  ization (DoLP) a
+00010420: 6e64 2041 6e67 6c65 206f 6620 0d0a 2020  nd Angle of ..  
+00010430: 2020 2020 2020 506f 6c61 7269 7a61 7469        Polarizati
+00010440: 6f6e 2028 416f 5029 2077 696c 6c20 6265  on (AoP) will be
+00010450: 2063 616c 6375 6c61 7465 642e 2054 686f   calculated. Tho
+00010460: 7365 2069 7272 6567 756c 6172 2076 616c  se irregular val
+00010470: 7565 7320 0d0a 2020 2020 2020 2020 286e  ues ..        (n
+00010480: 702e 6e61 6e2c 206e 702e 696e 6629 2077  p.nan, np.inf) w
+00010490: 696c 6c20 6265 2072 6570 6c61 6365 6420  ill be replaced 
+000104a0: 7769 7468 2030 2e20 4265 2073 7572 6520  with 0. Be sure 
+000104b0: 7468 6174 2074 6f20 6361 6c63 756c 6174  that to calculat
+000104c0: 650d 0a20 2020 2020 2020 2044 6f50 4c20  e..        DoPL 
+000104d0: 636f 7272 6563 746c 7920 6261 636b 6772  correctly backgr
+000104e0: 6f75 6e64 2073 7562 7472 6163 7469 6f6e  ound subtraction
+000104f0: 206d 7573 7420 6265 2061 7070 6c69 6564   must be applied
+00010500: 2062 6566 6f72 6568 616e 6420 6265 6361   beforehand beca
+00010510: 7573 6520 0d0a 2020 2020 2020 2020 7374  use ..        st
+00010520: 6f6b 6573 2070 6172 616d 6574 6572 2060  okes parameter `
+00010530: 6073 3060 6020 6973 2061 6666 6563 7465  `s0`` is affecte
+00010540: 6420 6279 2061 6273 6f6c 7574 6520 696e  d by absolute in
+00010550: 7465 6e73 6974 6965 732e 0d0a 0d0a 2020  tensities.....  
+00010560: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00010570: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+00010580: 2d2d 2d2d 0d0a 2020 2020 2020 2020 616c  ----..        al
+00010590: 6f6e 6720 3a20 4178 6973 4c69 6b65 2c20  ong : AxisLike, 
+000105a0: 6465 6661 756c 7420 6973 2022 6122 0d0a  default is "a"..
+000105b0: 2020 2020 2020 2020 2020 2020 546f 2064              To d
+000105c0: 6566 696e 6520 7768 6963 6820 6178 6973  efine which axis
+000105d0: 2069 7320 706f 6c61 7269 7a61 7469 6f6e   is polarization
+000105e0: 2061 6e67 6c65 2061 7869 732e 2041 6c6f   angle axis. Alo
+000105f0: 6e67 2074 6869 7320 6178 6973 200d 0a20  ng this axis .. 
+00010600: 2020 2020 2020 2020 2020 2074 6865 2061             the a
+00010610: 6e67 6c65 206f 6620 706f 6c61 7269 7a65  ngle of polarize
+00010620: 7220 6d75 7374 2062 6520 696e 206f 7264  r must be in ord
+00010630: 6572 206f 6620 302c 2034 352c 2039 302c  er of 0, 45, 90,
+00010640: 2031 3335 2064 6567 7265 652e 0d0a 0d0a   135 degree.....
+00010650: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
+00010660: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00010670: 0d0a 2020 2020 2020 2020 6469 6374 0d0a  ..        dict..
+00010680: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
+00010690: 696f 6e61 6c79 2077 6974 6820 6b65 7973  ionaly with keys
+000106a0: 2022 646f 6c70 2220 616e 6420 2261 6f70   "dolp" and "aop
+000106b0: 222c 2077 6869 6368 2063 6f72 7265 7370  ", which corresp
+000106c0: 6f6e 6420 746f 2044 6f50 4c20 616e 6420  ond to DoPL and 
+000106d0: 0d0a 2020 2020 2020 2020 2020 2020 416f  ..            Ao
+000106e0: 5020 7265 7370 6563 7469 7665 6c79 2e0d  P respectively..
+000106f0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00010700: 2020 2045 7861 6d70 6c65 730d 0a20 2020     Examples..   
+00010710: 2020 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20       --------.. 
+00010720: 2020 2020 2020 2043 616c 6375 6c61 7465         Calculate
+00010730: 2041 6f50 2069 6d61 6765 2066 726f 6d20   AoP image from 
+00010740: 7468 6520 7261 7720 696d 6167 6520 616e  the raw image an
+00010750: 6420 6469 7370 6c61 7920 7468 656d 2e0d  d display them..
+00010760: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00010770: 2020 2020 2020 203e 3e3e 2069 6d67 5f70         >>> img_p
+00010780: 6f6c 203d 2069 6d67 2e73 706c 6974 5f70  ol = img.split_p
+00010790: 6f6c 6172 697a 6174 696f 6e28 290d 0a20  olarization().. 
+000107a0: 2020 2020 2020 2020 2020 203e 3e3e 2064             >>> d
+000107b0: 706f 6c20 3d20 696d 675f 706f 6c2e 7374  pol = img_pol.st
+000107c0: 6f6b 6573 2829 0d0a 2020 2020 2020 2020  okes()..        
+000107d0: 2020 2020 3e3e 3e20 6970 2e67 7569 2e61      >>> ip.gui.a
+000107e0: 6464 2869 6d67 5f70 6f6c 2e70 726f 6a28  dd(img_pol.proj(
+000107f0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00010800: 3e3e 3e20 6970 2e67 7569 2e61 6464 2864  >>> ip.gui.add(d
+00010810: 706f 6c2e 616f 702e 7261 6432 6465 6728  pol.aop.rad2deg(
+00010820: 2929 0d0a 2020 2020 2020 2020 0d0a 2020  ))..        ..  
+00010830: 2020 2020 2020 5265 6665 7265 6e63 6573        References
+00010840: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+00010850: 2d2d 2d2d 0d0a 2020 2020 2020 2020 2d20  ----..        - 
+00010860: 6874 7470 733a 2f2f 6d61 7669 632e 6e65  https://mavic.ne
+00010870: 2e6a 702f 696e 6475 7472 6961 6c63 616d  .jp/indutrialcam
+00010880: 6572 612d 706f 6c61 7269 7a61 7469 6f6e  era-polarization
+00010890: 2d69 6e6c 696e 652f 0d0a 2020 2020 2020  -inline/..      
+000108a0: 2020 2d20 5961 6e67 2c20 4a2e 2c20 5169    - Yang, J., Qi
+000108b0: 752c 2053 2e2c 204a 696e 2c20 572e 2c20  u, S., Jin, W., 
+000108c0: 5761 6e67 2c20 582e 2c20 2620 5875 652c  Wang, X., & Xue,
+000108d0: 2046 2e20 2832 3032 3029 2e20 506f 6c61   F. (2020). Pola
+000108e0: 7269 7a61 7469 6f6e 2069 6d61 6769 6e67  rization imaging
+000108f0: 206d 6f64 656c 2063 6f6e 7369 6465 7269   model consideri
+00010900: 6e67 2074 6865 200d 0a20 2020 2020 2020  ng the ..       
+00010910: 2020 206e 6f6e 2d69 6465 616c 6974 7920     non-ideality 
+00010920: 6f66 2070 6f6c 6172 697a 6572 732e 2041  of polarizers. A
+00010930: 7070 6c69 6564 206f 7074 6963 732c 2035  pplied optics, 5
+00010940: 3928 3229 2c20 3330 362d 3331 342e 0d0a  9(2), 306-314...
+00010950: 2020 2020 2020 2020 2d20 4665 6e67 2c20          - Feng, 
+00010960: 422e 2c20 4775 6f2c 2052 2e2c 205a 6861  B., Guo, R., Zha
+00010970: 6e67 2c20 462e 2c20 5a68 616f 2c20 462e  ng, F., Zhao, F.
+00010980: 2c20 2620 446f 6e67 2c20 592e 2028 3230  , & Dong, Y. (20
+00010990: 3231 292e 2043 616c 6375 6c61 7469 6f6e  21). Calculation
+000109a0: 2061 6e64 2068 7565 206d 6170 7069 6e67   and hue mapping
+000109b0: 206f 6620 416f 5020 696e 200d 0a20 2020   of AoP in ..   
+000109c0: 2020 2020 2020 2070 6f6c 6172 697a 6174         polarizat
+000109d0: 696f 6e20 696d 6167 696e 672e 204d 6179  ion imaging. May
+000109e0: 2e20 6874 7470 733a 2f2f 646f 692e 6f72  . https://doi.or
+000109f0: 672f 3130 2e31 3131 372f 3132 2e32 3532  g/10.1117/12.252
+00010a00: 3336 3433 0d0a 2020 2020 2020 2020 2222  3643..        ""
+00010a10: 220d 0a20 2020 2020 2020 206e 6577 5f61  "..        new_a
+00010a20: 7865 7320 3d20 636f 6d70 6c65 6d65 6e74  xes = complement
+00010a30: 5f61 7865 7328 616c 6f6e 672c 2073 656c  _axes(along, sel
+00010a40: 662e 6178 6573 290d 0a20 2020 2020 2020  f.axes)..       
+00010a50: 2069 6d67 302c 2069 6d67 3435 2c20 696d   img0, img45, im
+00010a60: 6739 302c 2069 6d67 3133 3520 3d20 5b61  g90, img135 = [a
+00010a70: 2e61 735f 666c 6f61 7428 292e 7661 6c75  .as_float().valu
+00010a80: 6520 666f 7220 6120 696e 2073 656c 662e  e for a in self.
+00010a90: 7370 6c69 7428 616c 6f6e 6729 5d0d 0a20  split(along)].. 
+00010aa0: 2020 2020 2020 2023 2053 746f 6b65 7320         # Stokes 
+00010ab0: 7061 7261 6d65 7465 7273 0d0a 2020 2020  parameters..    
+00010ac0: 2020 2020 7330 203d 2028 696d 6730 202b      s0 = (img0 +
+00010ad0: 2069 6d67 3435 202b 2069 6d67 3930 202b   img45 + img90 +
+00010ae0: 2069 6d67 3133 3529 2f32 0d0a 2020 2020   img135)/2..    
+00010af0: 2020 2020 7331 203d 2069 6d67 3020 2d20      s1 = img0 - 
+00010b00: 696d 6739 300d 0a20 2020 2020 2020 2073  img90..        s
+00010b10: 3220 3d20 696d 6734 3520 2d20 696d 6731  2 = img45 - img1
+00010b20: 3335 0d0a 2020 2020 2020 2020 0d0a 2020  35..        ..  
+00010b30: 2020 2020 2020 2320 4465 6772 6565 206f        # Degree o
+00010b40: 6620 4c69 6e65 6172 2050 6f6c 6172 697a  f Linear Polariz
+00010b50: 6174 696f 6e20 2844 6f4c 5029 0d0a 2020  ation (DoLP)..  
+00010b60: 2020 2020 2020 2320 446f 4c50 2069 7320        # DoLP is 
+00010b70: 6465 6669 6e65 6420 6173 3a0d 0a20 2020  defined as:..   
+00010b80: 2020 2020 2023 2044 6f4c 5020 3d20 7371       # DoLP = sq
+00010b90: 7274 2873 315e 3220 2b20 7332 5e32 292f  rt(s1^2 + s2^2)/
+00010ba0: 7330 0d0a 2020 2020 2020 2020 7330 5b73  s0..        s0[s
+00010bb0: 303d 3d30 5d20 3d20 6e70 2e69 6e66 0d0a  0==0] = np.inf..
+00010bc0: 2020 2020 2020 2020 646f 6c70 3a20 496d          dolp: Im
+00010bd0: 6741 7272 6179 203d 206e 702e 7371 7274  gArray = np.sqrt
+00010be0: 2873 312a 2a32 202b 2073 322a 2a32 2920  (s1**2 + s2**2) 
+00010bf0: 2f20 7330 0d0a 2020 2020 2020 2020 646f  / s0..        do
+00010c00: 6c70 203d 2064 6f6c 702e 7669 6577 2873  lp = dolp.view(s
+00010c10: 656c 662e 5f5f 636c 6173 735f 5f29 0d0a  elf.__class__)..
+00010c20: 2020 2020 2020 2020 646f 6c70 2e5f 7365          dolp._se
+00010c30: 745f 696e 666f 2873 656c 662c 206e 6577  t_info(self, new
+00010c40: 5f61 7865 733d 6e65 775f 6178 6573 290d  _axes=new_axes).
+00010c50: 0a20 2020 2020 2020 2064 6f6c 702e 7365  .        dolp.se
+00010c60: 745f 7363 616c 6528 7365 6c66 290d 0a20  t_scale(self).. 
+00010c70: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00010c80: 2023 2041 6e67 6c65 206f 6620 506f 6c61   # Angle of Pola
+00010c90: 7269 7a61 7469 6f6e 2028 416f 5029 0d0a  rization (AoP)..
+00010ca0: 2020 2020 2020 2020 2320 416f 5020 6973          # AoP is
+00010cb0: 2075 7375 616c 6c79 2063 616c 6375 6c61   usually calcula
+00010cc0: 7465 6420 6173 2070 7369 203d 2031 2f32  ted as psi = 1/2
+00010cd0: 6172 6774 616e 2873 312f 7332 292c 2062  argtan(s1/s2), b
+00010ce0: 7574 2074 6869 7320 6973 2077 726f 6e67  ut this is wrong
+00010cf0: 2062 6563 6175 7365 200d 0a20 2020 2020   because ..     
+00010d00: 2020 2023 206c 6566 7420 7369 6465 2068     # left side h
+00010d10: 6173 2072 616e 6765 206f 6620 5b30 2c20  as range of [0, 
+00010d20: 7069 2920 7768 696c 6520 7269 6768 7420  pi) while right 
+00010d30: 7369 6465 2068 6173 2072 616e 6765 206f  side has range o
+00010d40: 6620 5b2d 7069 2f34 2c20 7069 2f34 292e  f [-pi/4, pi/4).
+00010d50: 2054 6865 0d0a 2020 2020 2020 2020 2320   The..        # 
+00010d60: 636f 7272 6563 7420 666f 726d 756c 6174  correct formulat
+00010d70: 696f 6e20 6973 3a0d 0a20 2020 2020 2020  ion is:..       
+00010d80: 2023 2020 2020 2020 207b 2031 2f32 6172   #       { 1/2ar
+00010d90: 6774 616e 2873 322f 7331 2920 2020 2020  gtan(s2/s1)     
+00010da0: 2020 2020 2028 7331 3e30 2061 6e64 2073       (s1>0 and s
+00010db0: 323e 3029 0d0a 2020 2020 2020 2020 2320  2>0)..        # 
+00010dc0: 416f 5020 3d20 7b20 312f 3261 7267 7461  AoP = { 1/2argta
+00010dd0: 6e28 7332 2f73 3129 202b 2070 692f 3220  n(s2/s1) + pi/2 
+00010de0: 2020 2873 313c 3029 0d0a 2020 2020 2020    (s1<0)..      
+00010df0: 2020 2320 2020 2020 2020 7b20 312f 3261    #       { 1/2a
+00010e00: 7267 7461 6e28 7332 2f73 3129 202b 2070  rgtan(s2/s1) + p
+00010e10: 6920 2020 2020 2873 313e 3020 616e 6420  i     (s1>0 and 
+00010e20: 7332 3c30 290d 0a20 2020 2020 2020 2023  s2<0)..        #
+00010e30: 2042 7574 2068 6572 652c 206e 702e 6172   But here, np.ar
+00010e40: 6374 616e 3220 6361 6e20 6465 7465 6374  ctan2 can detect
+00010e50: 2074 6865 2073 6967 6e73 206f 6620 696e   the signs of in
+00010e60: 7075 7473 2073 3120 616e 6420 7332 2c20  puts s1 and s2, 
+00010e70: 736f 2074 6861 7420 6974 2072 6574 7572  so that it retur
+00010e80: 6e73 200d 0a20 2020 2020 2020 2023 2063  ns ..        # c
+00010e90: 6f72 7265 6374 2076 616c 7565 732e 0d0a  orrect values...
+00010ea0: 2020 2020 2020 2020 616f 7020 3d20 6e70          aop = np
+00010eb0: 2e61 7263 7461 6e32 2873 322c 2073 3129  .arctan2(s2, s1)
+00010ec0: 2f32 0d0a 2020 2020 2020 2020 616f 703a  /2..        aop:
+00010ed0: 2050 6861 7365 4172 7261 7920 3d20 616f   PhaseArray = ao
+00010ee0: 702e 7669 6577 2850 6861 7365 4172 7261  p.view(PhaseArra
+00010ef0: 7929 0d0a 2020 2020 2020 2020 616f 702e  y)..        aop.
+00010f00: 5f73 6574 5f69 6e66 6f28 7365 6c66 2c20  _set_info(self, 
+00010f10: 6e65 775f 6178 6573 3d6e 6577 5f61 7865  new_axes=new_axe
+00010f20: 7329 0d0a 2020 2020 2020 2020 616f 702e  s)..        aop.
+00010f30: 756e 6974 203d 2022 7261 6422 0d0a 2020  unit = "rad"..  
+00010f40: 2020 2020 2020 616f 702e 626f 7264 6572        aop.border
+00010f50: 203d 2028 2d6e 702e 7069 2f32 2c20 6e70   = (-np.pi/2, np
+00010f60: 2e70 692f 3229 0d0a 2020 2020 2020 2020  .pi/2)..        
+00010f70: 616f 702e 5f66 6978 5f62 6f72 6465 7228  aop._fix_border(
+00010f80: 290d 0a20 2020 2020 2020 2061 6f70 2e73  )..        aop.s
+00010f90: 6574 5f73 6361 6c65 2873 656c 6629 0d0a  et_scale(self)..
+00010fa0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00010fb0: 2020 6f75 7420 3d20 6469 6374 2864 6f6c    out = dict(dol
+00010fc0: 703d 646f 6c70 2c20 616f 703d 616f 7029  p=dolp, aop=aop)
+00010fd0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00010fe0: 206f 7574 0d0a 2020 2020 0d0a 2020 2020   out..    ..    
+00010ff0: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+00011000: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+00011010: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+00011020: 2020 4073 616d 655f 6474 7970 6528 6173    @same_dtype(as
+00011030: 666c 6f61 743d 5472 7565 290d 0a20 2020  float=True)..   
+00011040: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
+00011050: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
+00011060: 6620 696e 7061 696e 7428 0d0a 2020 2020  f inpaint(..    
+00011070: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
+00011080: 2020 206d 6173 6b3a 206e 702e 6e64 6172     mask: np.ndar
+00011090: 7261 792c 0d0a 2020 2020 2020 2020 2a2c  ray,..        *,
+000110a0: 0d0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
+000110b0: 3a20 4c69 7465 7261 6c5b 226d 6561 6e22  : Literal["mean"
+000110c0: 2c20 2262 6968 6172 6d6f 6e69 6322 5d20  , "biharmonic"] 
+000110d0: 3d22 6269 6861 726d 6f6e 6963 222c 0d0a  ="biharmonic",..
+000110e0: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
+000110f0: 6d73 203d 204e 6f6e 652c 0d0a 2020 2020  ms = None,..    
+00011100: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
+00011110: 203d 2046 616c 7365 2c0d 0a20 2020 2029   = False,..    )
+00011120: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+00011130: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00011140: 2020 2020 496d 6167 6520 696e 7061 696e      Image inpain
+00011150: 7469 6e67 2e0d 0a0d 0a20 2020 2020 2020  ting.....       
+00011160: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+00011170: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+00011180: 0a20 2020 2020 2020 206d 6173 6b20 3a20  .        mask : 
+00011190: 6e70 2e6e 6461 7272 6179 0d0a 2020 2020  np.ndarray..    
+000111a0: 2020 2020 2020 2020 4d61 736b 2069 6d61          Mask ima
+000111b0: 6765 2e20 5468 6520 5472 7565 2072 6567  ge. The True reg
+000111c0: 696f 6e20 7769 6c6c 2062 6520 696e 7061  ion will be inpa
+000111d0: 696e 7465 642e 0d0a 2020 2020 2020 2020  inted...        
+000111e0: 6d65 7468 6f64 203a 2022 6d65 616e 2220  method : "mean" 
+000111f0: 6f72 2022 6269 6861 726d 6f6e 6963 222c  or "biharmonic",
+00011200: 2064 6566 6175 6c74 2069 7320 2262 6968   default is "bih
+00011210: 6172 6d6f 6e69 6322 0d0a 2020 2020 2020  armonic"..      
+00011220: 2020 2020 2020 496e 7061 696e 7469 6e67        Inpainting
+00011230: 206d 6574 686f 642e 0d0a 2020 2020 2020   method...      
+00011240: 2020 7b64 696d 737d 7b75 7064 6174 657d    {dims}{update}
+00011250: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+00011260: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+00011270: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+00011280: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+00011290: 2020 2020 496e 7061 696e 7465 6420 696d      Inpainted im
+000112a0: 6167 6520 6f66 2073 616d 6520 6461 7461  age of same data
+000112b0: 2074 7970 652e 0d0a 2020 2020 2020 2020   type...        
+000112c0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+000112d0: 6d65 7468 6f64 203d 3d20 2262 6968 6172  method == "bihar
+000112e0: 6d6f 6e69 6322 3a0d 0a20 2020 2020 2020  monic":..       
+000112f0: 2020 2020 2066 756e 6320 3d20 736b 7265       func = skre
+00011300: 732e 696e 7061 696e 742e 696e 7061 696e  s.inpaint.inpain
+00011310: 745f 6269 6861 726d 6f6e 6963 0d0a 2020  t_biharmonic..  
+00011320: 2020 2020 2020 656c 6966 206d 6574 686f        elif metho
+00011330: 6420 3d3d 2022 6d65 616e 223a 0d0a 2020  d == "mean":..  
+00011340: 2020 2020 2020 2020 2020 6675 6e63 203d            func =
+00011350: 205f 6d69 7363 2e69 6e70 6169 6e74 5f6d   _misc.inpaint_m
+00011360: 6561 6e0d 0a20 2020 2020 2020 2065 6c73  ean..        els
+00011370: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00011380: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00011390: 2866 2255 6e6b 6e6f 776e 206d 6574 686f  (f"Unknown metho
+000113a0: 643a 207b 6d65 7468 6f64 7d22 290d 0a20  d: {method}").. 
+000113b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000113c0: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
+000113d0: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
+000113e0: 632c 200d 0a20 2020 2020 2020 2020 2020  c, ..           
+000113f0: 2063 5f61 7865 733d 636f 6d70 6c65 6d65   c_axes=compleme
+00011400: 6e74 5f61 7865 7328 6469 6d73 2c20 7365  nt_axes(dims, se
+00011410: 6c66 2e61 7865 7329 2c0d 0a20 2020 2020  lf.axes),..     
+00011420: 2020 2020 2020 2061 7267 733d 286d 6173         args=(mas
+00011430: 6b2c 292c 0d0a 2020 2020 2020 2020 290d  k,),..        ).
+00011440: 0a0d 0a20 2020 2040 5f64 6f63 732e 7772  ...    @_docs.wr
+00011450: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
+00011460: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
+00011470: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
+00011480: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
+00011490: 0d0a 2020 2020 6465 6620 7065 616b 5f6c  ..    def peak_l
+000114a0: 6f63 616c 5f6d 6178 280d 0a20 2020 2020  ocal_max(..     
+000114b0: 2020 2073 656c 662c 0d0a 2020 2020 2020     self,..      
+000114c0: 2020 2a2c 200d 0a20 2020 2020 2020 206d    *, ..        m
+000114d0: 696e 5f64 6973 7461 6e63 653a 2066 6c6f  in_distance: flo
+000114e0: 6174 203d 2031 2e30 2c0d 0a20 2020 2020  at = 1.0,..     
+000114f0: 2020 2070 6572 6365 6e74 696c 653a 2066     percentile: f
+00011500: 6c6f 6174 207c 204e 6f6e 6520 3d20 4e6f  loat | None = No
+00011510: 6e65 2c20 0d0a 2020 2020 2020 2020 746f  ne, ..        to
+00011520: 706e 3a20 696e 7420 3d20 6e70 2e69 6e66  pn: int = np.inf
+00011530: 2c0d 0a20 2020 2020 2020 2074 6f70 6e5f  ,..        topn_
+00011540: 7065 725f 6c61 6265 6c3a 2069 6e74 203d  per_label: int =
+00011550: 206e 702e 696e 662c 0d0a 2020 2020 2020   np.inf,..      
+00011560: 2020 6578 636c 7564 655f 626f 7264 6572    exclude_border
+00011570: 3a20 626f 6f6c 203d 5472 7565 2c0d 0a20  : bool =True,.. 
+00011580: 2020 2020 2020 2075 7365 5f6c 6162 656c         use_label
+00011590: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0d  s: bool = True,.
+000115a0: 0a20 2020 2020 2020 2064 696d 733a 2044  .        dims: D
+000115b0: 696d 7320 3d20 4e6f 6e65 0d0a 2020 2020  ims = None..    
+000115c0: 2920 2d3e 204d 6172 6b65 7246 7261 6d65  ) -> MarkerFrame
+000115d0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+000115e0: 2020 2020 2020 2020 4669 6e64 206c 6f63          Find loc
+000115f0: 616c 206d 6178 696d 612e 2054 6869 7320  al maxima. This 
+00011600: 616c 676f 7269 7468 6d20 636f 7272 6573  algorithm corres
+00011610: 706f 6e64 7320 746f 2049 6d61 6765 4a27  ponds to ImageJ'
+00011620: 7320 2746 696e 6420 4d61 7869 6d61 2720  s 'Find Maxima' 
+00011630: 6275 7420 6973 206d 6f72 6520 666c 6578  but is more flex
+00011640: 6962 6c65 2e0d 0a0d 0a20 2020 2020 2020  ible.....       
+00011650: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+00011660: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+00011670: 0a20 2020 2020 2020 206d 696e 5f64 6973  .        min_dis
+00011680: 7461 6e63 6520 3a20 666c 6f61 742c 2064  tance : float, d
+00011690: 6566 6175 6c74 2069 7320 312e 300d 0a20  efault is 1.0.. 
+000116a0: 2020 2020 2020 2020 2020 204d 696e 696d             Minim
+000116b0: 756d 2064 6973 7461 6e63 6520 616c 6c6f  um distance allo
+000116c0: 7765 6420 666f 7220 6561 6368 2074 776f  wed for each two
+000116d0: 2070 6561 6b73 2e20 5468 6973 2070 6172   peaks. This par
+000116e0: 616d 6574 6572 2069 7320 736c 6967 6874  ameter is slight
+000116f0: 6c79 0d0a 2020 2020 2020 2020 2020 2020  ly..            
+00011700: 6469 6666 6572 656e 7420 6672 6f6d 2074  different from t
+00011710: 6861 7420 696e 2060 6073 6b69 6d61 6765  hat in ``skimage
+00011720: 2e66 6561 7475 7265 2e70 6561 6b5f 6c6f  .feature.peak_lo
+00011730: 6361 6c5f 6d61 7860 6020 6265 6361 7573  cal_max`` becaus
+00011740: 6520 6865 7265 2066 6c6f 6174 0d0a 2020  e here float..  
+00011750: 2020 2020 2020 2020 2020 696e 7075 7420            input 
+00011760: 6973 2061 6c6c 6f77 6564 2061 6e64 2065  is allowed and e
+00011770: 7665 7279 2074 696d 6520 666f 6f74 7072  very time footpr
+00011780: 696e 7420 6973 2063 616c 6375 6c61 7465  int is calculate
+00011790: 642e 0d0a 2020 2020 2020 2020 7065 7263  d...        perc
+000117a0: 656e 7469 6c65 203a 2066 6c6f 6174 2c20  entile : float, 
+000117b0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+000117c0: 2020 2020 2020 5065 7263 656e 7469 6c65        Percentile
+000117d0: 2074 6f20 636f 6d70 7574 6520 6162 736f   to compute abso
+000117e0: 6c75 7465 2074 6872 6573 686f 6c64 2e0d  lute threshold..
+000117f0: 0a20 2020 2020 2020 2074 6f70 6e20 3a20  .        topn : 
+00011800: 696e 742c 206f 7074 696f 6e61 6c0d 0a20  int, optional.. 
+00011810: 2020 2020 2020 2020 2020 204d 6178 696d             Maxim
+00011820: 756d 206e 756d 6265 7220 6f66 2070 6561  um number of pea
+00011830: 6b73 202a 2a66 6f72 2065 6163 6820 6974  ks **for each it
+00011840: 6572 6174 696f 6e2a 2a2e 0d0a 2020 2020  eration**...    
+00011850: 2020 2020 746f 706e 5f70 6572 5f6c 6162      topn_per_lab
+00011860: 656c 203a 2069 6e74 2c20 6465 6661 756c  el : int, defaul
+00011870: 7420 6973 206e 702e 696e 660d 0a20 2020  t is np.inf..   
+00011880: 2020 2020 2020 2020 204d 6178 696d 756d           Maximum
+00011890: 206e 756d 6265 7220 6f66 2070 6561 6b73   number of peaks
+000118a0: 2070 6572 206c 6162 656c 2e0d 0a20 2020   per label...   
+000118b0: 2020 2020 2075 7365 5f6c 6162 656c 7320       use_labels 
+000118c0: 3a20 626f 6f6c 2c20 6465 6661 756c 7420  : bool, default 
+000118d0: 6973 2054 7275 650d 0a20 2020 2020 2020  is True..       
+000118e0: 2020 2020 2049 6620 7573 6520 7365 6c66       If use self
+000118f0: 2e6c 6162 656c 7320 7768 656e 2069 7420  .labels when it 
+00011900: 6578 6973 7473 2e0d 0a20 2020 2020 2020  exists...       
+00011910: 207b 6469 6d73 7d0d 0a20 2020 2020 2020   {dims}..       
+00011920: 2020 2020 200d 0a20 2020 2020 2020 2052       ..        R
+00011930: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
+00011940: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00011950: 204d 6172 6b65 7246 7261 6d65 0d0a 2020   MarkerFrame..  
+00011960: 2020 2020 2020 2020 2020 4461 7461 4672            DataFr
+00011970: 616d 6520 7769 7468 2063 6f6c 756d 6e73  ame with columns
+00011980: 2073 616d 6520 6173 2061 7865 7320 6f66   same as axes of
+00011990: 2073 656c 662e 2046 6f72 2065 7861 6d70   self. For examp
+000119a0: 6c65 2c20 6966 2073 656c 662e 6178 6573  le, if self.axes
+000119b0: 2069 7320 2274 6379 7822 2074 6865 6e0d   is "tcyx" then.
+000119c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000119d0: 7572 6e20 7661 6c75 6520 6861 7320 2274  urn value has "t
+000119e0: 222c 2022 6322 2c20 2279 2220 616e 6420  ", "c", "y" and 
+000119f0: 2278 2220 636f 6c75 6d6e 732c 2061 6e64  "x" columns, and
+00011a00: 2073 7562 2d66 7261 6d65 2061 7420 743d   sub-frame at t=
+00011a10: 302c 2063 3d30 2063 6f6e 7461 696e 7320  0, c=0 contains 
+00011a20: 616c 6c0d 0a20 2020 2020 2020 2020 2020  all..           
+00011a30: 2074 6865 2063 6f6f 7264 696e 6174 6573   the coordinates
+00011a40: 206f 6620 7065 616b 7320 696e 2074 6865   of peaks in the
+00011a50: 2073 6c69 6365 2061 7420 743d 302c 2063   slice at t=0, c
+00011a60: 3d30 2e0d 0a20 2020 2020 2020 2022 2222  =0...        """
+00011a70: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00011a80: 2020 0d0a 2020 2020 2020 2020 2320 7365    ..        # se
+00011a90: 7061 7261 7465 2073 7061 7469 616c 2064  parate spatial d
+00011aa0: 696d 656e 7369 6f6e 7320 616e 6420 6f74  imensions and ot
+00011ab0: 6865 7273 0d0a 2020 2020 2020 2020 6e64  hers..        nd
+00011ac0: 696d 203d 206c 656e 2864 696d 7329 0d0a  im = len(dims)..
+00011ad0: 2020 2020 2020 2020 6469 6d73 5f6c 6973          dims_lis
+00011ae0: 7420 3d20 6c69 7374 2864 696d 7329 0d0a  t = list(dims)..
+00011af0: 2020 2020 2020 2020 635f 6178 6573 203d          c_axes =
+00011b00: 2063 6f6d 706c 656d 656e 745f 6178 6573   complement_axes
+00011b10: 2864 696d 732c 2073 656c 662e 6178 6573  (dims, self.axes
+00011b20: 290d 0a20 2020 2020 2020 2063 5f61 7865  )..        c_axe
+00011b30: 735f 6c69 7374 203d 206c 6973 7428 635f  s_list = list(c_
+00011b40: 6178 6573 290d 0a20 2020 2020 2020 200d  axes)..        .
+00011b50: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00011b60: 7374 616e 6365 2865 7863 6c75 6465 5f62  stance(exclude_b
+00011b70: 6f72 6465 722c 2062 6f6f 6c29 3a0d 0a20  order, bool):.. 
+00011b80: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00011b90: 6465 5f62 6f72 6465 7220 3d20 696e 7428  de_border = int(
+00011ba0: 6d69 6e5f 6469 7374 616e 6365 2920 6966  min_distance) if
+00011bb0: 2065 7863 6c75 6465 5f62 6f72 6465 7220   exclude_border 
+00011bc0: 656c 7365 2046 616c 7365 0d0a 2020 2020  else False..    
+00011bd0: 2020 2020 0d0a 2020 2020 2020 2020 7468      ..        th
+00011be0: 7220 3d20 4e6f 6e65 2069 6620 7065 7263  r = None if perc
+00011bf0: 656e 7469 6c65 2069 7320 4e6f 6e65 2065  entile is None e
+00011c00: 6c73 6520 6e70 2e70 6572 6365 6e74 696c  lse np.percentil
+00011c10: 6528 7365 6c66 2e76 616c 7565 2c20 7065  e(self.value, pe
+00011c20: 7263 656e 7469 6c65 290d 0a20 2020 2020  rcentile)..     
+00011c30: 2020 200d 0a20 2020 2020 2020 2069 6d70     ..        imp
+00011c40: 6f72 7420 7061 6e64 6173 2061 7320 7064  ort pandas as pd
+00011c50: 0d0a 2020 2020 2020 2020 6672 6f6d 2069  ..        from i
+00011c60: 6d70 792e 6672 616d 6520 696d 706f 7274  mpy.frame import
+00011c70: 204d 6172 6b65 7246 7261 6d65 0d0a 0d0a   MarkerFrame....
+00011c80: 2020 2020 2020 2020 6466 5f61 6c6c 3a20          df_all: 
+00011c90: 6c69 7374 5b70 642e 4461 7461 4672 616d  list[pd.DataFram
+00011ca0: 655d 203d 205b 5d0d 0a20 2020 2020 2020  e] = []..       
+00011cb0: 2066 6f72 2073 6c2c 2069 6d67 2069 6e20   for sl, img in 
+00011cc0: 7365 6c66 2e69 7465 7228 635f 6178 6573  self.iter(c_axes
+00011cd0: 2c20 6973 7261 773d 5472 7565 2c20 6578  , israw=True, ex
+00011ce0: 636c 7564 653d 6469 6d73 293a 0d0a 2020  clude=dims):..  
+00011cf0: 2020 2020 2020 2020 2020 2320 736b 6665            # skfe
+00011d00: 6174 2e70 6561 6b5f 6c6f 6361 6c5f 6d61  at.peak_local_ma
+00011d10: 7820 6f76 6572 7772 6974 6520 736f 6d65  x overwrite some
+00011d20: 7468 696e 6720 736f 2077 6520 6e65 6564  thing so we need
+00011d30: 2074 6f20 6769 7665 2063 6f70 7920 6f66   to give copy of
+00011d40: 2069 6d67 2e0d 0a20 2020 2020 2020 2020   img...         
+00011d50: 2020 2069 6620 7573 655f 6c61 6265 6c73     if use_labels
+00011d60: 2061 6e64 2069 6d67 2e6c 6162 656c 7320   and img.labels 
+00011d70: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00011d80: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00011d90: 6265 6c73 203d 2078 702e 6173 6e75 6d70  bels = xp.asnump
+00011da0: 7928 696d 672e 6c61 6265 6c73 290d 0a20  y(img.labels).. 
+00011db0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011dd0: 2020 6c61 6265 6c73 203d 204e 6f6e 650d    labels = None.
+00011de0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00011df0: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00011e00: 6573 203d 2073 6b66 6561 742e 7065 616b  es = skfeat.peak
+00011e10: 5f6c 6f63 616c 5f6d 6178 280d 0a20 2020  _local_max(..   
+00011e20: 2020 2020 2020 2020 2020 2020 2078 702e               xp.
+00011e30: 6173 6e75 6d70 7928 696d 6729 2c0d 0a20  asnumpy(img),.. 
+00011e40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00011e50: 6f6f 7470 7269 6e74 3d78 702e 6173 6e75  ootprint=xp.asnu
+00011e60: 6d70 7928 5f73 7472 7563 7475 7265 732e  mpy(_structures.
+00011e70: 6261 6c6c 5f6c 696b 6528 6d69 6e5f 6469  ball_like(min_di
+00011e80: 7374 616e 6365 2c20 6e64 696d 2929 2c0d  stance, ndim)),.
+00011e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ea0: 2074 6872 6573 686f 6c64 5f61 6273 3d74   threshold_abs=t
+00011eb0: 6872 2c0d 0a20 2020 2020 2020 2020 2020  hr,..           
+00011ec0: 2020 2020 206e 756d 5f70 6561 6b73 3d74       num_peaks=t
+00011ed0: 6f70 6e2c 0d0a 2020 2020 2020 2020 2020  opn,..          
+00011ee0: 2020 2020 2020 6e75 6d5f 7065 616b 735f        num_peaks_
+00011ef0: 7065 725f 6c61 6265 6c3d 746f 706e 5f70  per_label=topn_p
+00011f00: 6572 5f6c 6162 656c 2c0d 0a20 2020 2020  er_label,..     
+00011f10: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00011f20: 733d 6c61 6265 6c73 2c0d 0a20 2020 2020  s=labels,..     
+00011f30: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00011f40: 6465 5f62 6f72 6465 723d 6578 636c 7564  de_border=exclud
+00011f50: 655f 626f 7264 6572 0d0a 2020 2020 2020  e_border..      
+00011f60: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00011f70: 2020 2020 2069 6e64 6963 6573 203d 2070       indices = p
+00011f80: 642e 4461 7461 4672 616d 6528 696e 6469  d.DataFrame(indi
+00011f90: 6365 732c 2063 6f6c 756d 6e73 3d64 696d  ces, columns=dim
+00011fa0: 735f 6c69 7374 290d 0a20 2020 2020 2020  s_list)..       
+00011fb0: 2020 2020 2069 6e64 6963 6573 5b63 5f61       indices[c_a
+00011fc0: 7865 735f 6c69 7374 5d20 3d20 736c 0d0a  xes_list] = sl..
+00011fd0: 2020 2020 2020 2020 2020 2020 6466 5f61              df_a
+00011fe0: 6c6c 2e61 7070 656e 6428 696e 6469 6365  ll.append(indice
+00011ff0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00012000: 0d0a 2020 2020 2020 2020 6f75 7420 3d20  ..        out = 
+00012010: 7064 2e63 6f6e 6361 7428 6466 5f61 6c6c  pd.concat(df_all
+00012020: 2c20 6178 6973 3d30 290d 0a20 2020 2020  , axis=0)..     
+00012030: 2020 206f 7574 203d 204d 6172 6b65 7246     out = MarkerF
+00012040: 7261 6d65 286f 7574 2c20 636f 6c75 6d6e  rame(out, column
+00012050: 733d 7365 6c66 2e61 7865 732c 2064 7479  s=self.axes, dty
+00012060: 7065 3d6e 702e 7569 6e74 3136 290d 0a20  pe=np.uint16).. 
+00012070: 2020 2020 2020 206f 7574 2e73 6574 5f73         out.set_s
+00012080: 6361 6c65 2873 656c 6629 0d0a 2020 2020  cale(self)..    
+00012090: 2020 2020 7265 7475 726e 206f 7574 0d0a      return out..
+000120a0: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
+000120b0: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
+000120c0: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
+000120d0: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
+000120e0: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
+000120f0: 7075 740d 0a20 2020 2064 6566 2063 6f72  put..    def cor
+00012100: 6e65 725f 6861 7272 6973 280d 0a20 2020  ner_harris(..   
+00012110: 2020 2020 2073 656c 662c 0d0a 2020 2020       self,..    
+00012120: 2020 2020 7369 676d 613a 206e 4446 6c6f      sigma: nDFlo
+00012130: 6174 203d 2031 2c0d 0a20 2020 2020 2020  at = 1,..       
+00012140: 206b 3a20 666c 6f61 7420 3d20 302e 3035   k: float = 0.05
+00012150: 2c20 0d0a 2020 2020 2020 2020 2a2c 200d  , ..        *, .
+00012160: 0a20 2020 2020 2020 2064 696d 733a 2044  .        dims: D
+00012170: 696d 7320 3d20 4e6f 6e65 0d0a 2020 2020  ims = None..    
+00012180: 2920 2d3e 2049 6d67 4172 7261 793a 0d0a  ) -> ImgArray:..
+00012190: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+000121a0: 2020 2020 2043 616c 6375 6c61 7465 2048       Calculate H
+000121b0: 6172 7269 7320 7265 7370 6f6e 7365 2069  arris response i
+000121c0: 6d61 6765 2e0d 0a0d 0a20 2020 2020 2020  mage.....       
+000121d0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+000121e0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+000121f0: 0a20 2020 2020 2020 207b 7369 676d 617d  .        {sigma}
+00012200: 0d0a 2020 2020 2020 2020 6b20 3a20 666c  ..        k : fl
+00012210: 6f61 742c 206f 7074 696f 6e61 6c0d 0a20  oat, optional.. 
+00012220: 2020 2020 2020 2020 2020 2053 656e 7369             Sensi
+00012230: 7469 7669 7479 2066 6163 746f 7220 746f  tivity factor to
+00012240: 2073 6570 6172 6174 6520 636f 726e 6572   separate corner
+00012250: 7320 6672 6f6d 2065 6467 6573 2c20 7479  s from edges, ty
+00012260: 7069 6361 6c6c 7920 696e 2072 616e 6765  pically in range
+00012270: 205b 302c 2030 2e32 5d2e 0d0a 2020 2020   [0, 0.2]...    
+00012280: 2020 2020 2020 2020 536d 616c 6c20 7661          Small va
+00012290: 6c75 6573 206f 6620 6b20 7265 7375 6c74  lues of k result
+000122a0: 2069 6e20 6465 7465 6374 696f 6e20 6f66   in detection of
+000122b0: 2073 6861 7270 2063 6f72 6e65 7273 2e0d   sharp corners..
+000122c0: 0a20 2020 2020 2020 207b 6469 6d73 7d0d  .        {dims}.
+000122d0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+000122e0: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
+000122f0: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
+00012300: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
+00012310: 2020 2048 6172 7269 7320 7265 7370 6f6e     Harris respon
+00012320: 7365 0d0a 2020 2020 2020 2020 2222 2220  se..        """ 
+00012330: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00012340: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
+00012350: 706c 795f 6461 736b 280d 0a20 2020 2020  ply_dask(..     
+00012360: 2020 2020 2020 2073 6b66 6561 742e 636f         skfeat.co
+00012370: 726e 6572 5f68 6172 7269 732c 200d 0a20  rner_harris, .. 
+00012380: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
+00012390: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
+000123a0: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+000123b0: 7329 2c20 0d0a 2020 2020 2020 2020 2020  s), ..          
+000123c0: 2020 6b77 6172 6773 3d64 6963 7428 6b3d    kwargs=dict(k=
+000123d0: 6b2c 2073 6967 6d61 3d73 6967 6d61 290d  k, sigma=sigma).
+000123e0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+000123f0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
+00012400: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
+00012410: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+00012420: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
+00012430: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
+00012440: 0a20 2020 2064 6566 2076 6f72 6f6e 6f69  .    def voronoi
+00012450: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
+00012460: 0d0a 2020 2020 2020 2020 636f 6f72 6473  ..        coords
+00012470: 3a20 436f 6f72 6473 2c0d 0a20 2020 2020  : Coords,..     
+00012480: 2020 202a 2c20 0d0a 2020 2020 2020 2020     *, ..        
+00012490: 696e 663a 206e 4449 6e74 207c 204e 6f6e  inf: nDInt | Non
+000124a0: 6520 3d20 4e6f 6e65 2c0d 0a20 2020 2020  e = None,..     
+000124b0: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
+000124c0: 320d 0a20 2020 2029 202d 3e20 496d 6741  2..    ) -> ImgA
+000124d0: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
+000124e0: 2222 0d0a 2020 2020 2020 2020 566f 726f  ""..        Voro
+000124f0: 6e6f 6920 7365 676d 656e 7461 7469 6f6e  noi segmentation
+00012500: 206f 6620 616e 2069 6d61 6765 2e20 0d0a   of an image. ..
+00012510: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00012520: 2020 496d 6167 6520 7265 6769 6f6e 206c    Image region l
+00012530: 6162 656c 6564 2077 6974 6820 2469 2420  abeled with $i$ 
+00012540: 6d65 616e 7320 7468 6174 2061 6c6c 2074  means that all t
+00012550: 6865 2070 6f69 6e74 7320 696e 2074 6865  he points in the
+00012560: 2072 6567 696f 6e20 6172 650d 0a20 2020   region are..   
+00012570: 2020 2020 2063 6c6f 7365 7220 746f 2074       closer to t
+00012580: 6865 2024 6924 2d74 6820 706f 696e 7420  he $i$-th point 
+00012590: 7468 616e 2061 6e79 206f 7468 6572 2070  than any other p
+000125a0: 6f69 6e74 732e 0d0a 0d0a 2020 2020 2020  oints.....      
+000125b0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+000125c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+000125d0: 0d0a 2020 2020 2020 2020 636f 6f72 6473  ..        coords
+000125e0: 203a 204d 6172 6b65 7246 7261 6d65 206f   : MarkerFrame o
+000125f0: 7220 284e 2c20 3229 2061 7272 6179 2d6c  r (N, 2) array-l
+00012600: 696b 650d 0a20 2020 2020 2020 2020 2020  ike..           
+00012610: 2043 6f6f 7264 696e 6174 6573 206f 6620   Coordinates of 
+00012620: 706f 696e 7473 2e0d 0a20 2020 2020 2020  points...       
+00012630: 2069 6e66 203a 2069 6e74 2c20 6172 7261   inf : int, arra
+00012640: 7920 6f66 2069 6e74 2c20 6f70 7469 6f6e  y of int, option
+00012650: 616c 0d0a 2020 2020 2020 2020 2020 2020  al..            
+00012660: 4469 7374 616e 6365 2074 6f20 696e 6669  Distance to infi
+00012670: 6e69 7479 2070 6f69 6e74 732e 2049 6620  nity points. If 
+00012680: 6e6f 7420 7072 6f76 6964 6564 2c20 696e  not provided, in
+00012690: 6669 6e69 7479 2070 6f69 6e74 7320 6172  finity points ar
+000126a0: 6520 0d0a 2020 2020 2020 2020 2020 2020  e ..            
+000126b0: 706c 6163 6564 2061 7420 3130 3020 7469  placed at 100 ti
+000126c0: 6d65 7320 6675 7274 6865 7220 706f 7369  mes further posi
+000126d0: 7469 6f6e 7320 7265 6c61 7469 7665 2074  tions relative t
+000126e0: 6f20 7468 6520 696d 6167 6520 7368 6170  o the image shap
+000126f0: 652e 0d0a 2020 2020 2020 2020 7b64 696d  e...        {dim
+00012700: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
+00012710: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
+00012720: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
+00012730: 4c61 6265 6c0d 0a20 2020 2020 2020 2020  Label..         
+00012740: 2020 2053 6567 6d65 6e74 6174 696f 6e20     Segmentation 
+00012750: 6c61 6265 6c73 206f 6620 696d 6167 652e  labels of image.
+00012760: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
+00012770: 2020 2020 200d 0a20 2020 2020 2020 2066       ..        f
+00012780: 726f 6d20 7363 6970 792e 7370 6174 6961  rom scipy.spatia
+00012790: 6c20 696d 706f 7274 2056 6f72 6f6e 6f69  l import Voronoi
+000127a0: 0d0a 2020 2020 2020 2020 636f 6f72 6473  ..        coords
+000127b0: 203d 205f 6368 6563 6b5f 636f 6f72 6469   = _check_coordi
+000127c0: 6e61 7465 7328 636f 6f72 6473 2c20 7365  nates(coords, se
+000127d0: 6c66 2c20 6469 6d73 3d73 656c 662e 6178  lf, dims=self.ax
+000127e0: 6573 290d 0a20 2020 2020 2020 200d 0a20  es)..        .. 
+000127f0: 2020 2020 2020 206e 792c 206e 7820 3d20         ny, nx = 
+00012800: 7365 6c66 2e73 697a 6573 6f66 2864 696d  self.sizesof(dim
+00012810: 7329 0d0a 2020 2020 2020 2020 0d0a 2020  s)..        ..  
+00012820: 2020 2020 2020 6966 2069 6e66 2069 7320        if inf is 
+00012830: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00012840: 2020 2069 6e66 7920 3d20 6e79 202a 2031     infy = ny * 1
+00012850: 3030 0d0a 2020 2020 2020 2020 2020 2020  00..            
+00012860: 696e 6678 203d 206e 7820 2a20 3130 300d  infx = nx * 100.
+00012870: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00012880: 696e 7374 616e 6365 2869 6e66 2c20 696e  instance(inf, in
+00012890: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+000128a0: 2069 6e66 7920 3d20 696e 6678 203d 2069   infy = infx = i
+000128b0: 6e66 0d0a 2020 2020 2020 2020 656c 7365  nf..        else
+000128c0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+000128d0: 6e66 792c 2069 6e66 7820 3d20 696e 660d  nfy, infx = inf.
+000128e0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+000128f0: 2020 2069 6e66 706f 696e 7473 203d 206e     infpoints = n
+00012900: 702e 6172 7261 7928 0d0a 2020 2020 2020  p.array(..      
+00012910: 2020 2020 2020 5b5b 2d69 6e66 792c 202d        [[-infy, -
+00012920: 696e 6678 5d2c 0d0a 2020 2020 2020 2020  infx],..        
+00012930: 2020 2020 205b 2d69 6e66 792c 206e 7820       [-infy, nx 
+00012940: 2b20 696e 6678 5d2c 0d0a 2020 2020 2020  + infx],..      
+00012950: 2020 2020 2020 205b 6e79 202b 2069 6e66         [ny + inf
+00012960: 792c 202d 696e 6678 5d2c 0d0a 2020 2020  y, -infx],..    
+00012970: 2020 2020 2020 2020 205b 6e79 202b 2069           [ny + i
+00012980: 6e66 792c 206e 7820 2b20 696e 6678 5d5d  nfy, nx + infx]]
+00012990: 2c0d 0a20 2020 2020 2020 2020 2020 2064  ,..            d
+000129a0: 7479 7065 3d6e 702e 666c 6f61 7433 322c  type=np.float32,
+000129b0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+000129c0: 2020 2020 200d 0a20 2020 2020 2020 206c       ..        l
+000129d0: 6162 656c 7320 3d20 6c61 7267 6573 745f  abels = largest_
+000129e0: 7a65 726f 7328 7365 6c66 2e73 6861 7065  zeros(self.shape
+000129f0: 290d 0a20 2020 2020 2020 206e 5f6c 6162  )..        n_lab
+00012a00: 656c 203d 2031 0d0a 2020 2020 2020 2020  el = 1..        
+00012a10: 666f 7220 736c 2c20 6372 6473 2069 6e20  for sl, crds in 
+00012a20: 636f 6f72 6473 2e69 7465 7228 636f 6d70  coords.iter(comp
+00012a30: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
+00012a40: 2c20 7365 6c66 2e61 7865 7329 293a 0d0a  , self.axes)):..
+00012a50: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+00012a60: 745f 636f 6f72 6473 203d 206e 702e 636f  t_coords = np.co
+00012a70: 6e63 6174 656e 6174 6528 5b63 7264 732e  ncatenate([crds.
+00012a80: 7661 6c75 6573 2c20 696e 6670 6f69 6e74  values, infpoint
+00012a90: 735d 2c20 6178 6973 3d30 290d 0a20 2020  s], axis=0)..   
+00012aa0: 2020 2020 2020 2020 2076 6f72 203d 2056           vor = V
+00012ab0: 6f72 6f6e 6f69 2869 6e70 7574 5f63 6f6f  oronoi(input_coo
+00012ac0: 7264 7329 0d0a 2020 2020 2020 2020 2020  rds)..          
+00012ad0: 2020 666f 7220 7220 696e 2076 6f72 2e72    for r in vor.r
+00012ae0: 6567 696f 6e73 3a0d 0a20 2020 2020 2020  egions:..       
+00012af0: 2020 2020 2020 2020 2069 6620 616c 6c28           if all(
+00012b00: 7230 203e 2030 2066 6f72 2072 3020 696e  r0 > 0 for r0 in
+00012b10: 2072 293a 0d0a 2020 2020 2020 2020 2020   r):..          
+00012b20: 2020 2020 2020 2020 2020 706f 6c79 203d            poly =
+00012b30: 2076 6f72 2e76 6572 7469 6365 735b 725d   vor.vertices[r]
+00012b40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012b50: 2020 2020 2020 6772 6964 7320 3d20 736b        grids = sk
+00012b60: 6d65 732e 6772 6964 5f70 6f69 6e74 735f  mes.grid_points_
+00012b70: 696e 5f70 6f6c 7928 7365 6c66 2e73 697a  in_poly(self.siz
+00012b80: 6573 6f66 2864 696d 7329 2c20 706f 6c79  esof(dims), poly
+00012b90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00012ba0: 2020 2020 2020 206c 6162 656c 735b 736c         labels[sl
+00012bb0: 5d5b 6772 6964 735d 203d 206e 5f6c 6162  ][grids] = n_lab
+00012bc0: 656c 0d0a 2020 2020 2020 2020 2020 2020  el..            
+00012bd0: 2020 2020 2020 2020 6e5f 6c61 6265 6c20          n_label 
+00012be0: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
+00012bf0: 6c66 2e6c 6162 656c 7320 3d20 4c61 6265  lf.labels = Labe
+00012c00: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
+00012c10: 6c61 6265 6c73 2c20 6e61 6d65 3d73 656c  labels, name=sel
+00012c20: 662e 6e61 6d65 2b22 2d6c 6162 656c 222c  f.name+"-label",
+00012c30: 2061 7865 733d 7365 6c66 2e61 7865 732c   axes=self.axes,
+00012c40: 2073 6f75 7263 653d 7365 6c66 2e73 6f75   source=self.sou
+00012c50: 7263 650d 0a20 2020 2020 2020 2029 2e6f  rce..        ).o
+00012c60: 7074 696d 697a 6528 290d 0a20 2020 2020  ptimize()..     
+00012c70: 2020 2073 656c 662e 6c61 6265 6c73 2e73     self.labels.s
+00012c80: 6574 5f73 6361 6c65 2873 656c 6629 0d0a  et_scale(self)..
+00012c90: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00012ca0: 656c 662e 6c61 6265 6c73 0d0a 2020 2020  elf.labels..    
+00012cb0: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
+00012cc0: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
+00012cd0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+00012ce0: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
+00012cf0: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
+00012d00: 0a20 2020 2064 6566 2066 6c6f 6f64 280d  .    def flood(.
+00012d10: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+00012d20: 2020 2020 2020 2020 7365 6564 733a 2043          seeds: C
+00012d30: 6f6f 7264 732c 200d 0a20 2020 2020 2020  oords, ..       
+00012d40: 202a 2c0d 0a20 2020 2020 2020 2063 6f6e   *,..        con
+00012d50: 6e65 6374 6976 6974 793a 2069 6e74 203d  nectivity: int =
+00012d60: 2031 2c0d 0a20 2020 2020 2020 2074 6f6c   1,..        tol
+00012d70: 6572 616e 6365 3a20 666c 6f61 7420 3d20  erance: float = 
+00012d80: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2064  None,..        d
+00012d90: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
+00012da0: 0d0a 2020 2020 293a 0d0a 2020 2020 2020  ..    ):..      
+00012db0: 2020 2222 220d 0a20 2020 2020 2020 2046    """..        F
+00012dc0: 6c6f 6f64 2066 696c 6c69 6e67 2077 6974  lood filling wit
+00012dd0: 6820 6120 6c69 7374 206f 6620 7365 6564  h a list of seed
+00012de0: 2070 6f69 6e74 732e 2042 7920 7265 7065   points. By repe
+00012df0: 6174 696e 6720 736b 696d 6167 6527 7320  ating skimage's 
+00012e00: 6060 666c 6f6f 6460 6020 6675 6e63 7469  ``flood`` functi
+00012e10: 6f6e 2c0d 0a20 2020 2020 2020 2074 6869  on,..        thi
+00012e20: 7320 6d65 7468 6f64 2063 616e 2070 6572  s method can per
+00012e30: 666f 726d 2073 6567 6d65 6e74 6174 696f  form segmentatio
+00012e40: 6e20 6f66 2061 6e20 696d 6167 652e 0d0a  n of an image...
+00012e50: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00012e60: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
+00012e70: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
+00012e80: 2020 7365 6564 7320 3a20 4d61 726b 6572    seeds : Marker
+00012e90: 4672 616d 6520 6f72 2028 4e2c 2044 2920  Frame or (N, D) 
+00012ea0: 6172 7261 792d 6c69 6b65 0d0a 2020 2020  array-like..    
+00012eb0: 2020 2020 2020 2020 5365 6564 2070 6f69          Seed poi
+00012ec0: 6e74 7320 746f 2073 7461 7274 2066 6c6f  nts to start flo
+00012ed0: 6f64 2066 696c 6c69 6e67 2e0d 0a20 2020  od filling...   
+00012ee0: 2020 2020 207b 636f 6e6e 6563 7469 7669       {connectivi
+00012ef0: 7479 7d0d 0a20 2020 2020 2020 2074 6f6c  ty}..        tol
+00012f00: 6572 616e 6365 203a 2066 6c6f 6174 2c20  erance : float, 
+00012f10: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+00012f20: 2020 2020 2020 496e 7465 6e73 6974 7920        Intensity 
+00012f30: 6465 7669 6174 696f 6e20 7769 7468 696e  deviation within
+00012f40: 2074 6869 7320 7661 6c75 6520 7769 6c6c   this value will
+00012f50: 2062 6520 6669 6c6c 6564 2e0d 0a20 2020   be filled...   
+00012f60: 2020 2020 207b 6469 6d73 7d0d 0a0d 0a20       {dims}.... 
+00012f70: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
+00012f80: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
+00012f90: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
+00012fa0: 790d 0a20 2020 2020 2020 2020 2020 204c  y..            L
+00012fb0: 6162 656c 6564 2069 6d61 6765 2e0d 0a20  abeled image... 
+00012fc0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00012fd0: 2020 2020 6672 6f6d 2073 6b69 6d61 6765      from skimage
+00012fe0: 2e6d 6f72 7068 6f6c 6f67 7920 696d 706f  .morphology impo
+00012ff0: 7274 2066 6c6f 6f64 0d0a 2020 2020 2020  rt flood..      
+00013000: 2020 7365 6564 7320 3d20 5f63 6865 636b    seeds = _check
+00013010: 5f63 6f6f 7264 696e 6174 6573 2873 6565  _coordinates(see
+00013020: 6473 2c20 7365 6c66 2c20 6469 6d73 3d73  ds, self, dims=s
+00013030: 656c 662e 6178 6573 290d 0a20 2020 2020  elf.axes)..     
+00013040: 2020 206c 6162 656c 7320 3d20 6c61 7267     labels = larg
+00013050: 6573 745f 7a65 726f 7328 7365 6c66 2e73  est_zeros(self.s
+00013060: 6861 7065 290d 0a20 2020 2020 2020 206e  hape)..        n
+00013070: 5f6c 6162 656c 5f6e 6578 7420 3d20 310d  _label_next = 1.
+00013080: 0a20 2020 2020 2020 2066 6f72 2073 6c2c  .        for sl,
+00013090: 2063 7264 7320 696e 2073 6565 6473 2e69   crds in seeds.i
+000130a0: 7465 7228 636f 6d70 6c65 6d65 6e74 5f61  ter(complement_a
+000130b0: 7865 7328 6469 6d73 2c20 7365 6c66 2e61  xes(dims, self.a
+000130c0: 7865 7329 293a 0d0a 2020 2020 2020 2020  xes)):..        
+000130d0: 2020 2020 666f 7220 6372 6420 696e 2063      for crd in c
+000130e0: 7264 732e 7661 6c75 6573 3a0d 0a20 2020  rds.values:..   
+000130f0: 2020 2020 2020 2020 2020 2020 2063 7264               crd
+00013100: 203d 2074 7570 6c65 2863 7264 290d 0a20   = tuple(crd).. 
+00013110: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013120: 6620 6c61 6265 6c73 5b73 6c5d 5b63 7264  f labels[sl][crd
+00013130: 5d20 3e20 303a 0d0a 2020 2020 2020 2020  ] > 0:..        
+00013140: 2020 2020 2020 2020 2020 2020 6e5f 6c61              n_la
+00013150: 6265 6c20 3d20 6c61 6265 6c73 5b73 6c5d  bel = labels[sl]
+00013160: 5b63 7264 5d0d 0a20 2020 2020 2020 2020  [crd]..         
+00013170: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00013180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013190: 2020 6e5f 6c61 6265 6c20 3d20 6e5f 6c61    n_label = n_la
+000131a0: 6265 6c5f 6e65 7874 0d0a 2020 2020 2020  bel_next..      
+000131b0: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+000131c0: 6c61 6265 6c5f 6e65 7874 202b 3d20 310d  label_next += 1.
+000131d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000131e0: 2066 696c 6c5f 6172 6561 203d 2066 6c6f   fill_area = flo
+000131f0: 6f64 280d 0a20 2020 2020 2020 2020 2020  od(..           
+00013200: 2020 2020 2020 2020 2073 656c 662e 7661           self.va
+00013210: 6c75 655b 736c 5d2c 200d 0a20 2020 2020  lue[sl], ..     
+00013220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013230: 6565 645f 706f 696e 743d 6372 642c 0d0a  eed_point=crd,..
+00013240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013250: 2020 2020 636f 6e6e 6563 7469 7669 7479      connectivity
+00013260: 3d63 6f6e 6e65 6374 6976 6974 792c 200d  =connectivity, .
+00013270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013280: 2020 2020 2074 6f6c 6572 616e 6365 3d74       tolerance=t
+00013290: 6f6c 6572 616e 6365 0d0a 2020 2020 2020  olerance..      
+000132a0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+000132b0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+000132c0: 656c 735b 736c 5d5b 6669 6c6c 5f61 7265  els[sl][fill_are
+000132d0: 615d 203d 206e 5f6c 6162 656c 0d0a 2020  a] = n_label..  
+000132e0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000132f0: 7365 6c66 2e6c 6162 656c 7320 3d20 4c61  self.labels = La
+00013300: 6265 6c28 0d0a 2020 2020 2020 2020 2020  bel(..          
+00013310: 2020 6c61 6265 6c73 2c20 6e61 6d65 3d73    labels, name=s
+00013320: 656c 662e 6e61 6d65 2b22 2d6c 6162 656c  elf.name+"-label
+00013330: 222c 2061 7865 733d 7365 6c66 2e61 7865  ", axes=self.axe
+00013340: 732c 2073 6f75 7263 653d 7365 6c66 2e73  s, source=self.s
+00013350: 6f75 7263 650d 0a20 2020 2020 2020 2029  ource..        )
+00013360: 2e6f 7074 696d 697a 6528 290d 0a20 2020  .optimize()..   
+00013370: 2020 2020 2073 656c 662e 6c61 6265 6c73       self.labels
+00013380: 2e73 6574 5f73 6361 6c65 2873 656c 6629  .set_scale(self)
+00013390: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000133a0: 2073 656c 660d 0a0d 0a20 2020 2040 6469   self....    @di
+000133b0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+000133c0: 6573 0d0a 2020 2020 6465 6620 6669 6e64  es..    def find
+000133d0: 5f73 6d28 0d0a 2020 2020 2020 2020 7365  _sm(..        se
+000133e0: 6c66 2c0d 0a20 2020 2020 2020 2073 6967  lf,..        sig
+000133f0: 6d61 3a20 6e44 466c 6f61 7420 3d20 312e  ma: nDFloat = 1.
+00013400: 352c 0d0a 2020 2020 2020 2020 2a2c 200d  5,..        *, .
+00013410: 0a20 2020 2020 2020 206d 6574 686f 643a  .        method:
+00013420: 2073 7472 203d 2022 646f 6722 2c0d 0a20   str = "dog",.. 
+00013430: 2020 2020 2020 2063 7574 6f66 663a 2066         cutoff: f
+00013440: 6c6f 6174 203d 204e 6f6e 652c 0d0a 2020  loat = None,..  
+00013450: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
+00013460: 3a20 666c 6f61 7420 3d20 3935 2c0d 0a20  : float = 95,.. 
+00013470: 2020 2020 2020 2074 6f70 6e3a 2069 6e74         topn: int
+00013480: 203d 206e 702e 696e 662c 0d0a 2020 2020   = np.inf,..    
+00013490: 2020 2020 6578 636c 7564 655f 626f 7264      exclude_bord
+000134a0: 6572 3a20 626f 6f6c 203d 2054 7275 652c  er: bool = True,
+000134b0: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
+000134c0: 4469 6d73 203d 204e 6f6e 650d 0a20 2020  Dims = None..   
+000134d0: 2029 202d 3e20 4d61 726b 6572 4672 616d   ) -> MarkerFram
+000134e0: 653a 0d0a 2020 2020 2020 2020 2222 220d  e:..        """.
+000134f0: 0a20 2020 2020 2020 2053 696e 676c 6520  .        Single 
+00013500: 6d6f 6c65 6375 6c65 2064 6574 6563 7469  molecule detecti
+00013510: 6f6e 2075 7369 6e67 2064 6966 6665 7265  on using differe
+00013520: 6e63 6520 6f66 2047 6175 7373 6961 6e2c  nce of Gaussian,
+00013530: 2064 6574 6572 6d69 6e61 6e74 206f 6620   determinant of 
+00013540: 4865 7373 6961 6e2c 204c 6170 6c61 6369  Hessian, Laplaci
+00013550: 616e 206f 6620 0d0a 2020 2020 2020 2020  an of ..        
+00013560: 4761 7573 7369 616e 206f 7220 6e6f 726d  Gaussian or norm
+00013570: 616c 697a 6564 2063 726f 7373 2063 6f72  alized cross cor
+00013580: 7265 6c61 7469 6f6e 206d 6574 686f 642e  relation method.
+00013590: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
+000135a0: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+000135b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+000135c0: 2020 2020 7369 676d 6120 3a20 666c 6f61      sigma : floa
+000135d0: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
+000135e0: 2020 2020 2020 2020 2053 7461 6e64 6172           Standar
+000135f0: 6420 6465 7669 6174 696f 6e20 6f66 2070  d deviation of p
+00013600: 756e 6374 612e 0d0a 2020 2020 2020 2020  uncta...        
+00013610: 6d65 7468 6f64 203a 2073 7472 207b 2264  method : str {"d
+00013620: 6f67 222c 2022 646f 6822 2c20 226c 6f67  og", "doh", "log
+00013630: 222c 2022 6761 7573 7369 616e 222c 2022  ", "gaussian", "
+00013640: 6e63 6322 7d2c 2064 6566 6175 6c74 2069  ncc"}, default i
+00013650: 7320 2264 6f67 220d 0a20 2020 2020 2020  s "dog"..       
+00013660: 2020 2020 2057 6869 6368 2066 696c 7465       Which filte
+00013670: 7220 6973 2075 7365 6420 7072 696f 7220  r is used prior 
+00013680: 746f 2066 696e 6469 6e67 206c 6f63 616c  to finding local
+00013690: 206d 6178 696d 612e 2049 6620 226e 6363   maxima. If "ncc
+000136a0: 222c 2061 2047 6175 7373 6961 6e20 7061  ", a Gaussian pa
+000136b0: 7274 6963 6c65 2069 7320 7573 6564 2061  rticle is used a
+000136c0: 730d 0a20 2020 2020 2020 2020 2020 2074  s..            t
+000136d0: 6865 2074 656d 706c 6174 6520 696d 6167  he template imag
+000136e0: 652e 0d0a 2020 2020 2020 2020 6375 746f  e...        cuto
+000136f0: 6666 203a 2066 6c6f 6174 2c20 6f70 7469  ff : float, opti
+00013700: 6f6e 616c 0d0a 2020 2020 2020 2020 2020  onal..          
+00013710: 2020 4375 746f 6666 2076 616c 7565 206f    Cutoff value o
+00013720: 6620 6669 6c74 6572 6564 2069 6d61 6765  f filtered image
+00013730: 2067 656e 6572 6174 6564 2062 7920 606d   generated by `m
+00013740: 6574 686f 6460 2e0d 0a20 2020 2020 2020  ethod`...       
+00013750: 2070 6572 6365 6e74 696c 652c 2074 6f70   percentile, top
+00013760: 6e2c 2065 7863 6c75 6465 5f62 6f72 6465  n, exclude_borde
+00013770: 722c 2064 696d 730d 0a20 2020 2020 2020  r, dims..       
+00013780: 2020 2020 2050 6173 7365 6420 746f 2060       Passed to `
+00013790: 6070 6561 6b5f 6c6f 6361 6c5f 6d61 7828  `peak_local_max(
+000137a0: 2960 600d 0a0d 0a20 2020 2020 2020 2052  )``....        R
+000137b0: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
+000137c0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+000137d0: 204d 6172 6b65 7246 7261 6d65 0d0a 2020   MarkerFrame..  
+000137e0: 2020 2020 2020 2020 2020 5065 616b 7320            Peaks 
+000137f0: 696e 2075 696e 7431 3620 7479 7065 2e0d  in uint16 type..
+00013800: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00013810: 2020 2045 7861 6d70 6c65 730d 0a20 2020     Examples..   
+00013820: 2020 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20       --------.. 
+00013830: 2020 2020 2020 2054 7261 636b 2073 696e         Track sin
+00013840: 676c 6520 6d6f 6c65 6375 6c65 7320 616e  gle molecules an
+00013850: 6420 7669 6577 2074 6865 2074 7261 636b  d view the track
+00013860: 7320 7769 7468 206e 6170 6172 692e 0d0a  s with napari...
+00013870: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00013880: 2020 2020 2020 3e3e 3e20 636f 6f72 6473        >>> coords
+00013890: 203d 2069 6d67 2e66 696e 645f 736d 2829   = img.find_sm()
+000138a0: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
+000138b0: 3e20 6c6e 6b20 3d20 636f 6f72 6473 2e6c  > lnk = coords.l
+000138c0: 696e 6b28 332c 206d 696e 5f64 7765 6c6c  ink(3, min_dwell
+000138d0: 3d31 3029 0d0a 2020 2020 2020 2020 2020  =10)..          
+000138e0: 2020 3e3e 3e20 6970 2e67 7569 2e61 6464    >>> ip.gui.add
+000138f0: 2869 6d67 290d 0a20 2020 2020 2020 2020  (img)..         
+00013900: 2020 203e 3e3e 2069 702e 6775 692e 6164     >>> ip.gui.ad
+00013910: 6428 6c6e 6b29 0d0a 2020 2020 2020 2020  d(lnk)..        
+00013920: 0d0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+00013930: 736f 0d0a 2020 2020 2020 2020 2d2d 2d2d  so..        ----
+00013940: 2d2d 2d2d 0d0a 2020 2020 2020 2020 6365  ----..        ce
+00013950: 6e74 726f 6964 5f73 6d0d 0a20 2020 2020  ntroid_sm..     
+00013960: 2020 2072 6566 696e 655f 736d 0d0a 2020     refine_sm..  
+00013970: 2020 2020 2020 2222 2220 2020 2020 2020        """       
+00013980: 200d 0a20 2020 2020 2020 206d 6574 686f   ..        metho
+00013990: 6420 3d20 6d65 7468 6f64 2e6c 6f77 6572  d = method.lower
+000139a0: 2829 0d0a 2020 2020 2020 2020 6966 206d  ()..        if m
+000139b0: 6574 686f 6420 696e 2028 2264 6f67 222c  ethod in ("dog",
+000139c0: 2022 646f 6822 2c20 226c 6f67 2229 3a0d   "doh", "log"):.
+000139d0: 0a20 2020 2020 2020 2020 2020 2063 7574  .            cut
+000139e0: 6f66 6620 3d20 302e 3020 6966 2063 7574  off = 0.0 if cut
+000139f0: 6f66 6620 6973 204e 6f6e 6520 656c 7365  off is None else
+00013a00: 2063 7574 6f66 660d 0a20 2020 2020 2020   cutoff..       
+00013a10: 2020 2020 2066 696c 5f69 6d67 203d 2067       fil_img = g
+00013a20: 6574 6174 7472 2873 656c 662c 206d 6574  etattr(self, met
+00013a30: 686f 642b 225f 6669 6c74 6572 2229 2873  hod+"_filter")(s
+00013a40: 6967 6d61 2c20 6469 6d73 3d64 696d 7329  igma, dims=dims)
+00013a50: 0d0a 2020 2020 2020 2020 656c 6966 206d  ..        elif m
+00013a60: 6574 686f 6420 696e 2028 2267 6175 7373  ethod in ("gauss
+00013a70: 6961 6e22 2c29 3a0d 0a20 2020 2020 2020  ian",):..       
+00013a80: 2020 2020 2063 7574 6f66 6620 3d20 2d6e       cutoff = -n
+00013a90: 702e 696e 6620 6966 2063 7574 6f66 6620  p.inf if cutoff 
+00013aa0: 6973 204e 6f6e 6520 656c 7365 2063 7574  is None else cut
+00013ab0: 6f66 660d 0a20 2020 2020 2020 2020 2020  off..           
+00013ac0: 2066 696c 5f69 6d67 203d 2067 6574 6174   fil_img = getat
+00013ad0: 7472 2873 656c 662c 206d 6574 686f 642b  tr(self, method+
+00013ae0: 225f 6669 6c74 6572 2229 2873 6967 6d61  "_filter")(sigma
+00013af0: 2c20 6469 6d73 3d64 696d 7329 0d0a 2020  , dims=dims)..  
+00013b00: 2020 2020 2020 656c 6966 206d 6574 686f        elif metho
+00013b10: 6420 3d3d 2022 6e63 6322 3a0d 0a20 2020  d == "ncc":..   
+00013b20: 2020 2020 2020 2020 2023 206d 616b 6520           # make 
+00013b30: 7465 6d70 6c61 7465 2047 6175 7373 6961  template Gaussia
+00013b40: 6e0d 0a20 2020 2020 2020 2020 2020 2063  n..            c
+00013b50: 7574 6f66 6620 3d20 302e 3520 6966 2063  utoff = 0.5 if c
+00013b60: 7574 6f66 6620 6973 204e 6f6e 6520 656c  utoff is None el
+00013b70: 7365 2063 7574 6f66 660d 0a20 2020 2020  se cutoff..     
+00013b80: 2020 2020 2020 2073 6967 6d61 203d 206e         sigma = n
+00013b90: 702e 6172 7261 7928 6368 6563 6b5f 6e64  p.array(check_nd
+00013ba0: 2873 6967 6d61 2c20 6c65 6e28 6469 6d73  (sigma, len(dims
+00013bb0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+00013bc0: 2073 6861 7065 203d 2074 7570 6c65 2828   shape = tuple((
+00013bd0: 7369 676d 612a 3429 2e61 7374 7970 6528  sigma*4).astype(
+00013be0: 6e70 2e69 6e74 3332 2929 0d0a 2020 2020  np.int32))..    
+00013bf0: 2020 2020 2020 2020 6720 3d20 4761 7573          g = Gaus
+00013c00: 7369 616e 5061 7274 6963 6c65 285b 286e  sianParticle([(n
+00013c10: 702e 6172 7261 7928 7368 6170 6529 2d31  p.array(shape)-1
+00013c20: 292f 322c 2073 6967 6d61 2c20 312e 302c  )/2, sigma, 1.0,
+00013c30: 2030 2e30 5d29 0d0a 2020 2020 2020 2020   0.0])..        
+00013c40: 2020 2020 7465 6d70 6c61 7465 203d 2067      template = g
+00013c50: 2e67 656e 6572 6174 6528 7368 6170 6529  .generate(shape)
+00013c60: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00013c70: 7465 6d70 6c61 7465 206d 6174 6368 696e  template matchin
+00013c80: 670d 0a20 2020 2020 2020 2020 2020 2066  g..            f
+00013c90: 696c 5f69 6d67 203d 2073 656c 662e 6e63  il_img = self.nc
+00013ca0: 635f 6669 6c74 6572 2874 656d 706c 6174  c_filter(templat
+00013cb0: 6529 0d0a 2020 2020 2020 2020 656c 7365  e)..        else
+00013cc0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00013cd0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00013ce0: 2260 6d65 7468 6f64 6020 6d75 7374 2062  "`method` must b
+00013cf0: 6520 2764 6f67 272c 2027 646f 6827 2c20  e 'dog', 'doh', 
+00013d00: 276c 6f67 272c 2027 6761 7573 7369 616e  'log', 'gaussian
+00013d10: 2720 6f72 2027 6e63 6327 2e22 290d 0a20  ' or 'ncc'.").. 
+00013d20: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00013d30: 2066 696c 5f69 6d67 5b66 696c 5f69 6d67   fil_img[fil_img
+00013d40: 3c63 7574 6f66 665d 203d 2063 7574 6f66  <cutoff] = cutof
+00013d50: 660d 0a20 2020 2020 2020 200d 0a20 2020  f..        ..   
+00013d60: 2020 2020 2069 6620 6e70 2e69 7373 6361       if np.issca
+00013d70: 6c61 7228 7369 676d 6129 3a0d 0a20 2020  lar(sigma):..   
+00013d80: 2020 2020 2020 2020 206d 696e 5f64 203d           min_d =
+00013d90: 2073 6967 6d61 2a32 0d0a 2020 2020 2020   sigma*2..      
+00013da0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00013db0: 2020 2020 206d 696e 5f64 203d 206d 6178       min_d = max
+00013dc0: 2873 6967 6d61 292a 320d 0a20 2020 2020  (sigma)*2..     
+00013dd0: 2020 2063 6f6f 7264 7320 3d20 6669 6c5f     coords = fil_
+00013de0: 696d 672e 7065 616b 5f6c 6f63 616c 5f6d  img.peak_local_m
+00013df0: 6178 286d 696e 5f64 6973 7461 6e63 653d  ax(min_distance=
+00013e00: 6d69 6e5f 642c 2070 6572 6365 6e74 696c  min_d, percentil
+00013e10: 653d 7065 7263 656e 7469 6c65 2c20 0d0a  e=percentile, ..
+00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e40: 2020 2020 2020 2020 746f 706e 3d74 6f70          topn=top
+00013e50: 6e2c 2064 696d 733d 6469 6d73 2c20 6578  n, dims=dims, ex
+00013e60: 636c 7564 655f 626f 7264 6572 3d65 7863  clude_border=exc
+00013e70: 6c75 6465 5f62 6f72 6465 7229 0d0a 2020  lude_border)..  
+00013e80: 2020 2020 2020 7265 7475 726e 2063 6f6f        return coo
+00013e90: 7264 730d 0a20 2020 200d 0a20 2020 200d  rds..    ..    .
+00013ea0: 0a20 2020 2040 5f64 6f63 732e 7772 6974  .    @_docs.writ
+00013eb0: 655f 646f 6373 0d0a 2020 2020 4064 696d  e_docs..    @dim
+00013ec0: 735f 746f 5f73 7061 7469 616c 5f61 7865  s_to_spatial_axe
+00013ed0: 730d 0a20 2020 2064 6566 2063 656e 7472  s..    def centr
+00013ee0: 6f69 645f 736d 280d 0a20 2020 2020 2020  oid_sm(..       
+00013ef0: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+00013f00: 636f 6f72 6473 3a20 436f 6f72 6473 203d  coords: Coords =
+00013f10: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
+00013f20: 2a2c 0d0a 2020 2020 2020 2020 7261 6469  *,..        radi
+00013f30: 7573 3a20 6e44 496e 7420 3d20 342c 0d0a  us: nDInt = 4,..
+00013f40: 2020 2020 2020 2020 6669 6c74 3a20 4361          filt: Ca
+00013f50: 6c6c 6162 6c65 5b5b 496d 6741 7272 6179  llable[[ImgArray
+00013f60: 5d2c 2062 6f6f 6c5d 203d 204e 6f6e 652c  ], bool] = None,
+00013f70: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
+00013f80: 4469 6d73 203d 204e 6f6e 652c 0d0a 2020  Dims = None,..  
+00013f90: 2020 2020 2020 2a2a 6669 6e64 5f73 6d5f        **find_sm_
+00013fa0: 6b77 6172 6773 2c0d 0a20 2020 2029 202d  kwargs,..    ) -
+00013fb0: 3e20 4d61 726b 6572 4672 616d 653a 0d0a  > MarkerFrame:..
+00013fc0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00013fd0: 2020 2020 2043 616c 6375 6c61 7465 2070       Calculate p
+00013fe0: 6f73 6974 696f 6e73 206f 6620 7061 7274  ositions of part
+00013ff0: 6963 6c65 7320 696e 2073 7562 7069 7865  icles in subpixe
+00014000: 6c20 7072 6563 6973 696f 6e20 7573 696e  l precision usin
+00014010: 6720 6365 6e74 726f 6964 2e0d 0a0d 0a20  g centroid..... 
+00014020: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00014030: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00014040: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2063  -----..        c
+00014050: 6f6f 7264 7320 3a20 4d61 726b 6572 4672  oords : MarkerFr
+00014060: 616d 6520 6f72 2028 4e2c 2032 2920 6172  ame or (N, 2) ar
+00014070: 7261 792c 206f 7074 696f 6e61 6c0d 0a20  ray, optional.. 
+00014080: 2020 2020 2020 2020 2020 2043 6f6f 7264             Coord
+00014090: 696e 6174 6573 206f 6620 7065 616b 732e  inates of peaks.
+000140a0: 2049 6620 4e6f 6e65 2c20 7468 6973 2077   If None, this w
+000140b0: 696c 6c20 6265 2064 6574 6572 6d69 6e65  ill be determine
+000140c0: 6420 6279 2066 696e 645f 736d 2e0d 0a20  d by find_sm... 
+000140d0: 2020 2020 2020 2072 6164 6975 7320 3a20         radius : 
+000140e0: 696e 742c 2064 6566 6175 6c74 2069 7320  int, default is 
+000140f0: 342e 0d0a 2020 2020 2020 2020 2020 2020  4...            
+00014100: 5261 6e67 6520 746f 2063 616c 6375 6c61  Range to calcula
+00014110: 7465 2063 656e 7472 6f69 6473 2e20 5265  te centroids. Re
+00014120: 6374 616e 6775 6c61 7220 696d 6167 6520  ctangular image 
+00014130: 7769 7468 2073 697a 6520 3272 2b31 2078  with size 2r+1 x
+00014140: 2032 722b 3120 7769 6c6c 2062 6520 7365   2r+1 will be se
+00014150: 6e64 200d 0a20 2020 2020 2020 2020 2020  nd ..           
+00014160: 2074 6f20 6361 6c63 756c 6174 6520 6d6f   to calculate mo
+00014170: 6d65 6e74 732e 0d0a 2020 2020 2020 2020  ments...        
+00014180: 6669 6c74 203a 2063 616c 6c61 626c 652c  filt : callable,
+00014190: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
+000141a0: 2020 2020 2020 2046 6f72 2065 7665 7279         For every
+000141b0: 2073 6c69 6365 2060 6073 6c60 602c 206c   slice ``sl``, l
+000141c0: 6162 656c 2069 7320 6164 6465 6420 6f6e  abel is added on
+000141d0: 6c79 2077 6865 6e20 6669 6c74 2860 696e  ly when filt(`in
+000141e0: 7075 7460 2920 3d3d 2054 7275 6520 6973  put`) == True is
+000141f0: 2073 6174 6973 6669 6564 2e0d 0a20 2020   satisfied...   
+00014200: 2020 2020 2066 696e 645f 736d 5f6b 7761       find_sm_kwa
+00014210: 7267 7320 3a20 6b65 7977 6f72 6420 6172  rgs : keyword ar
+00014220: 6775 6d65 6e74 730d 0a20 2020 2020 2020  guments..       
+00014230: 2020 2020 2050 6172 616d 6574 6572 7320       Parameters 
+00014240: 7061 7373 6564 2074 6f20 3a66 756e 633a  passed to :func:
+00014250: 6066 696e 645f 736d 602e 0d0a 2020 2020  `find_sm`...    
+00014260: 2020 2020 0d0a 2020 2020 2020 2020 5265      ..        Re
+00014270: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
+00014280: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
+00014290: 4d61 726b 6572 4672 616d 650d 0a20 2020  MarkerFrame..   
+000142a0: 2020 2020 2020 2020 2043 6f6f 7264 696e           Coordin
+000142b0: 6174 6573 206f 6620 7065 616b 732e 0d0a  ates of peaks...
+000142c0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000142d0: 2020 5365 6520 416c 736f 0d0a 2020 2020    See Also..    
+000142e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a 2020      --------..  
+000142f0: 2020 2020 2020 6669 6e64 5f73 6d0d 0a20        find_sm.. 
+00014300: 2020 2020 2020 2072 6566 696e 655f 736d         refine_sm
+00014310: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
+00014320: 2020 0d0a 2020 2020 2020 2020 696d 706f    ..        impo
+00014330: 7274 2070 616e 6461 7320 6173 2070 640d  rt pandas as pd.
+00014340: 0a20 2020 2020 2020 2066 726f 6d20 2e2e  .        from ..
+00014350: 6672 616d 6520 696d 706f 7274 204d 6172  frame import Mar
+00014360: 6b65 7246 7261 6d65 0d0a 2020 2020 2020  kerFrame..      
+00014370: 2020 6966 2063 6f6f 7264 7320 6973 204e    if coords is N
+00014380: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00014390: 2020 636f 6f72 6473 203d 2073 656c 662e    coords = self.
+000143a0: 6669 6e64 5f73 6d28 6469 6d73 3d64 696d  find_sm(dims=dim
+000143b0: 732c 202a 2a66 696e 645f 736d 5f6b 7761  s, **find_sm_kwa
+000143c0: 7267 7329 0d0a 2020 2020 2020 2020 656c  rgs)..        el
+000143d0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000143e0: 2063 6f6f 7264 7320 3d20 5f63 6865 636b   coords = _check
+000143f0: 5f63 6f6f 7264 696e 6174 6573 2863 6f6f  _coordinates(coo
+00014400: 7264 732c 2073 656c 6629 0d0a 2020 2020  rds, self)..    
+00014410: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00014420: 2020 6e64 696d 203d 206c 656e 2864 696d    ndim = len(dim
+00014430: 7329 0d0a 2020 2020 2020 2020 6669 6c74  s)..        filt
+00014440: 203d 2063 6865 636b 5f66 696c 7465 725f   = check_filter_
+00014450: 6675 6e63 2866 696c 7429 0d0a 2020 2020  func(filt)..    
+00014460: 2020 2020 7261 6469 7573 203d 206e 702e      radius = np.
+00014470: 6172 7261 7928 6368 6563 6b5f 6e64 2872  array(check_nd(r
+00014480: 6164 6975 732c 206e 6469 6d29 290d 0a20  adius, ndim)).. 
+00014490: 2020 2020 2020 2073 6861 7065 203d 2073         shape = s
+000144a0: 656c 662e 7369 7a65 736f 6628 6469 6d73  elf.sizesof(dims
+000144b0: 290d 0a20 2020 2020 2020 206f 7574 203d  )..        out =
+000144c0: 205b 5d0d 0a20 2020 2020 2020 2063 6f6c   []..        col
+000144d0: 756d 6e73 203d 206c 6973 7428 6469 6d73  umns = list(dims
+000144e0: 290d 0a20 2020 2020 2020 2063 5f61 7865  )..        c_axe
+000144f0: 7320 3d20 636f 6d70 6c65 6d65 6e74 5f61  s = complement_a
+00014500: 7865 7328 6469 6d73 2c20 636f 6f72 6473  xes(dims, coords
+00014510: 2e5f 6178 6573 290d 0a20 2020 2020 2020  ._axes)..       
+00014520: 2066 6f72 2073 6c2c 2063 7264 7320 696e   for sl, crds in
+00014530: 2063 6f6f 7264 732e 6974 6572 2863 5f61   coords.iter(c_a
+00014540: 7865 7329 3a0d 0a20 2020 2020 2020 2020  xes):..         
+00014550: 2020 2063 656e 7472 6f69 6473 203d 205b     centroids = [
+00014560: 5d0d 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+00014570: 6f72 2063 656e 7465 7220 696e 2063 7264  or center in crd
+00014580: 732e 7661 6c75 6573 3a0d 0a20 2020 2020  s.values:..     
+00014590: 2020 2020 2020 2020 2020 2062 626f 7820             bbox 
+000145a0: 3d20 5f73 7065 6369 6679 5f6f 6e65 2863  = _specify_one(c
+000145b0: 656e 7465 722c 2072 6164 6975 732c 2073  enter, radius, s
+000145c0: 6861 7065 290d 0a20 2020 2020 2020 2020  hape)..         
+000145d0: 2020 2020 2020 2069 6e70 7574 5f69 6d67         input_img
+000145e0: 203d 2073 656c 662e 7661 6c75 655b 736c   = self.value[sl
+000145f0: 5d5b 6262 6f78 5d0d 0a20 2020 2020 2020  ][bbox]..       
+00014600: 2020 2020 2020 2020 2069 6620 696e 7075           if inpu
+00014610: 745f 696d 672e 7369 7a65 203d 3d20 3020  t_img.size == 0 
+00014620: 6f72 206e 6f74 2066 696c 7428 696e 7075  or not filt(inpu
+00014630: 745f 696d 6729 3a0d 0a20 2020 2020 2020  t_img):..       
+00014640: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00014650: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
+00014660: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00014670: 2020 2020 2020 2020 2073 6869 6674 203d           shift =
+00014680: 2063 656e 7465 7220 2d20 7261 6469 7573   center - radius
+00014690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000146a0: 2020 6365 6e74 726f 6964 203d 205f 6361    centroid = _ca
+000146b0: 6c63 5f63 656e 7472 6f69 6428 696e 7075  lc_centroid(inpu
+000146c0: 745f 696d 672c 206e 6469 6d29 202b 2073  t_img, ndim) + s
+000146d0: 6869 6674 0d0a 2020 2020 2020 2020 2020  hift..          
+000146e0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000146f0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00014700: 732e 6170 7065 6e64 2863 656e 7472 6f69  s.append(centroi
+00014710: 642e 746f 6c69 7374 2829 290d 0a20 2020  d.tolist())..   
+00014720: 2020 2020 2020 2020 2064 6620 3d20 7064           df = pd
+00014730: 2e44 6174 6146 7261 6d65 2863 656e 7472  .DataFrame(centr
+00014740: 6f69 6473 2c20 636f 6c75 6d6e 733d 636f  oids, columns=co
+00014750: 6c75 6d6e 7329 0d0a 2020 2020 2020 2020  lumns)..        
+00014760: 2020 2020 6466 5b6c 6973 7428 635f 6178      df[list(c_ax
+00014770: 6573 295d 203d 2073 6c5b 3a2d 6e64 696d  es)] = sl[:-ndim
+00014780: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
+00014790: 7574 2e61 7070 656e 6428 6466 290d 0a20  ut.append(df).. 
+000147a0: 2020 2020 2020 2069 6620 6c65 6e28 6f75         if len(ou
+000147b0: 7429 203d 3d20 303a 0d0a 2020 2020 2020  t) == 0:..      
+000147c0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000147d0: 6545 7272 6f72 2822 4e6f 206d 6f6c 6563  eError("No molec
+000147e0: 756c 6520 666f 756e 642e 2229 0d0a 2020  ule found.")..  
+000147f0: 2020 2020 2020 6f75 7420 3d20 7064 2e63        out = pd.c
+00014800: 6f6e 6361 7428 6f75 742c 2061 7869 733d  oncat(out, axis=
+00014810: 3029 0d0a 2020 2020 2020 2020 0d0a 2020  0)..        ..  
+00014820: 2020 2020 2020 6f75 7420 3d20 4d61 726b        out = Mark
+00014830: 6572 4672 616d 6528 6f75 742e 7265 696e  erFrame(out.rein
+00014840: 6465 7828 636f 6c75 6d6e 733d 6c69 7374  dex(columns=list
+00014850: 2863 6f6f 7264 732e 5f61 7865 7329 292c  (coords._axes)),
+00014860: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014870: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00014880: 6c75 6d6e 733d 7374 7228 636f 6f72 6473  lumns=str(coords
+00014890: 2e5f 6178 6573 292c 2064 7479 7065 3d6e  ._axes), dtype=n
+000148a0: 702e 666c 6f61 7433 3229 2e61 735f 7374  p.float32).as_st
+000148b0: 616e 6461 7264 5f74 7970 6528 290d 0a20  andard_type().. 
+000148c0: 2020 2020 2020 206f 7574 2e73 6574 5f73         out.set_s
+000148d0: 6361 6c65 2863 6f6f 7264 732e 7363 616c  cale(coords.scal
+000148e0: 6529 0d0a 0d0a 2020 2020 2020 2020 7265  e)....        re
+000148f0: 7475 726e 206f 7574 0d0a 2020 2020 0d0a  turn out..    ..
+00014900: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
+00014910: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
+00014920: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
+00014930: 0d0a 2020 2020 4063 6865 636b 5f69 6e70  ..    @check_inp
+00014940: 7574 5f61 6e64 5f6f 7574 7075 740d 0a20  ut_and_output.. 
+00014950: 2020 2064 6566 2065 6467 655f 6772 6164     def edge_grad
+00014960: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
+00014970: 0d0a 2020 2020 2020 2020 7369 676d 613a  ..        sigma:
+00014980: 206e 4446 6c6f 6174 203d 2031 2e30 2c0d   nDFloat = 1.0,.
+00014990: 0a20 2020 2020 2020 206d 6574 686f 643a  .        method:
+000149a0: 2073 7472 203d 2022 736f 6265 6c22 2c20   str = "sobel", 
+000149b0: 0d0a 2020 2020 2020 2020 2a2c 200d 0a20  ..        *, .. 
+000149c0: 2020 2020 2020 2064 6567 3a20 626f 6f6c         deg: bool
+000149d0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+000149e0: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
+000149f0: 320d 0a20 2020 2029 202d 3e20 5068 6173  2..    ) -> Phas
+00014a00: 6541 7272 6179 3a0d 0a20 2020 2020 2020  eArray:..       
+00014a10: 2022 2222 0d0a 2020 2020 2020 2020 4361   """..        Ca
+00014a20: 6c63 756c 6174 6520 6772 6164 6965 6e74  lculate gradient
+00014a30: 2064 6972 6563 7469 6f6e 2075 7369 6e67   direction using
+00014a40: 2068 6f72 697a 6f6e 7461 6c20 616e 6420   horizontal and 
+00014a50: 7665 7274 6963 616c 2065 6467 6520 6f70  vertical edge op
+00014a60: 6572 6174 696f 6e2e 2047 7261 6469 656e  eration. Gradien
+00014a70: 7420 6469 7265 6374 696f 6e0d 0a20 2020  t direction..   
+00014a80: 2020 2020 2069 7320 7468 6520 6469 7265       is the dire
+00014a90: 6374 696f 6e20 7769 7468 206d 6178 696d  ction with maxim
+00014aa0: 756d 2067 7261 6469 656e 742c 2069 2e65  um gradient, i.e
+00014ab0: 2e2c 2069 6e74 656e 7369 7479 2069 6e63  ., intensity inc
+00014ac0: 7265 6173 6520 6973 206c 6172 6765 7374  rease is largest
+00014ad0: 2e20 0d0a 0d0a 2020 2020 2020 2020 5061  . ....        Pa
+00014ae0: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+00014af0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00014b00: 2020 2020 2020 7b73 6967 6d61 7d0d 0a20        {sigma}.. 
+00014b10: 2020 2020 2020 206d 6574 686f 6420 3a20         method : 
+00014b20: 7374 722c 207b 2273 6f62 656c 222c 2022  str, {"sobel", "
+00014b30: 6661 7269 6422 2c20 2273 6368 6172 7222  farid", "scharr"
+00014b40: 2c20 2270 7265 7769 7474 227d 2c20 6465  , "prewitt"}, de
+00014b50: 6661 756c 7420 6973 2022 736f 6265 6c22  fault is "sobel"
+00014b60: 0d0a 2020 2020 2020 2020 2020 2020 4564  ..            Ed
+00014b70: 6765 206f 7065 7261 746f 7220 6e61 6d65  ge operator name
+00014b80: 2e0d 0a20 2020 2020 2020 2064 6567 203a  ...        deg :
+00014b90: 2062 6f6f 6c2c 2064 6566 6175 6c74 2069   bool, default i
+00014ba0: 7320 5472 7565 0d0a 2020 2020 2020 2020  s True..        
+00014bb0: 2020 2020 4966 2054 7275 652c 2064 6567      If True, deg
+00014bc0: 7265 6520 7261 7468 6572 2074 6861 6e20  ree rather than 
+00014bd0: 7261 6469 616e 2069 7320 7265 7475 726e  radian is return
+00014be0: 6564 2e0d 0a20 2020 2020 2020 207b 6469  ed...        {di
+00014bf0: 6d73 7d0d 0a0d 0a20 2020 2020 2020 2052  ms}....        R
+00014c00: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
+00014c10: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00014c20: 2050 6861 7365 4172 7261 790d 0a20 2020   PhaseArray..   
+00014c30: 2020 2020 2020 2020 2050 6861 7365 2069           Phase i
+00014c40: 6d61 6765 2077 6974 6820 7261 6e67 6520  mage with range 
+00014c50: 5b2d 3138 302c 2031 3830 2920 6966 2064  [-180, 180) if d
+00014c60: 6567 3d3d 5472 7565 2c20 6f74 6865 7277  eg==True, otherw
+00014c70: 6973 6520 5b2d 7069 2c20 7069 292e 0d0a  ise [-pi, pi)...
+00014c80: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00014c90: 2020 2020 2020 4578 616d 706c 6573 0d0a        Examples..
+00014ca0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00014cb0: 0d0a 2020 2020 2020 2020 312e 2050 726f  ..        1. Pro
+00014cc0: 6669 6c65 2066 696c 616d 656e 7420 6f72  file filament or
+00014cd0: 6965 6e74 6174 696f 6e20 6469 7374 7269  ientation distri
+00014ce0: 6275 7469 6f6e 2075 7369 6e67 2068 6973  bution using his
+00014cf0: 746f 6772 616d 206f 6620 6564 6765 2067  togram of edge g
+00014d00: 7261 6469 656e 742e 0d0a 2020 2020 2020  radient...      
+00014d10: 2020 2020 2020 3e3e 3e20 6772 6164 203d        >>> grad =
+00014d20: 2069 6d67 2e65 6467 655f 6772 6164 2864   img.edge_grad(d
+00014d30: 6567 3d54 7275 6529 0d0a 2020 2020 2020  eg=True)..      
+00014d40: 2020 2020 2020 3e3e 3e20 706c 742e 6869        >>> plt.hi
+00014d50: 7374 2867 7261 642e 7261 7665 6c28 292c  st(grad.ravel(),
+00014d60: 2062 696e 733d 3130 3029 0d0a 2020 2020   bins=100)..    
+00014d70: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+00014d80: 0a20 2020 2020 2020 2023 2047 6574 206f  .        # Get o
+00014d90: 7065 7261 746f 720d 0a20 2020 2020 2020  perator..       
+00014da0: 206d 6574 686f 645f 6469 6374 203d 207b   method_dict = {
+00014db0: 2273 6f62 656c 223a 2028 736b 6669 6c2e  "sobel": (skfil.
+00014dc0: 736f 6265 6c5f 682c 2073 6b66 696c 2e73  sobel_h, skfil.s
+00014dd0: 6f62 656c 5f76 292c 0d0a 2020 2020 2020  obel_v),..      
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 2022 6661 7269 6422 3a20 2873 6b66 696c   "farid": (skfil
+00014e00: 2e66 6172 6964 5f68 2c20 736b 6669 6c2e  .farid_h, skfil.
+00014e10: 6661 7269 645f 7629 2c0d 0a20 2020 2020  farid_v),..     
+00014e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e30: 2020 2273 6368 6172 7222 3a20 2873 6b66    "scharr": (skf
+00014e40: 696c 2e73 6368 6172 725f 682c 2073 6b66  il.scharr_h, skf
+00014e50: 696c 2e73 6368 6172 725f 7629 2c0d 0a20  il.scharr_v),.. 
+00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e70: 2020 2020 2020 2270 7265 7769 7474 223a        "prewitt":
+00014e80: 2028 736b 6669 6c2e 7072 6577 6974 745f   (skfil.prewitt_
+00014e90: 682c 2073 6b66 696c 2e70 7265 7769 7474  h, skfil.prewitt
+00014ea0: 5f76 297d 0d0a 2020 2020 2020 2020 7472  _v)}..        tr
+00014eb0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00014ec0: 6f70 5f68 2c20 6f70 5f76 203d 206d 6574  op_h, op_v = met
+00014ed0: 686f 645f 6469 6374 5b6d 6574 686f 645d  hod_dict[method]
+00014ee0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+00014ef0: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+00014f00: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00014f10: 6c75 6545 7272 6f72 2822 606d 6574 686f  lueError("`metho
+00014f20: 6460 206d 7573 7420 6265 2027 736f 6265  d` must be 'sobe
+00014f30: 6c27 2c20 2766 6172 6964 2720 2773 6368  l', 'farid' 'sch
+00014f40: 6172 7227 2c20 6f72 2027 7072 6577 6974  arr', or 'prewit
+00014f50: 7427 2e22 290d 0a20 2020 2020 2020 200d  t'.")..        .
+00014f60: 0a20 2020 2020 2020 2023 2053 7461 7274  .        # Start
+00014f70: 0d0a 2020 2020 2020 2020 635f 6178 6573  ..        c_axes
+00014f80: 203d 2063 6f6d 706c 656d 656e 745f 6178   = complement_ax
+00014f90: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
+00014fa0: 6573 290d 0a20 2020 2020 2020 2069 6620  es)..        if 
+00014fb0: 7369 676d 6120 3e20 303a 0d0a 2020 2020  sigma > 0:..    
+00014fc0: 2020 2020 2020 2020 7365 6c66 203d 2073          self = s
+00014fd0: 656c 662e 6761 7573 7369 616e 5f66 696c  elf.gaussian_fil
+00014fe0: 7465 7228 7369 676d 612c 2064 696d 733d  ter(sigma, dims=
+00014ff0: 6469 6d73 290d 0a20 2020 2020 2020 2067  dims)..        g
+00015000: 7261 645f 6820 3d20 7365 6c66 2e5f 6170  rad_h = self._ap
+00015010: 706c 795f 6461 736b 286f 705f 682c 2063  ply_dask(op_h, c
+00015020: 5f61 7865 733d 635f 6178 6573 290d 0a20  _axes=c_axes).. 
+00015030: 2020 2020 2020 2067 7261 645f 7620 3d20         grad_v = 
+00015040: 7365 6c66 2e5f 6170 706c 795f 6461 736b  self._apply_dask
+00015050: 286f 705f 762c 2063 5f61 7865 733d 635f  (op_v, c_axes=c_
+00015060: 6178 6573 290d 0a20 2020 2020 2020 2067  axes)..        g
+00015070: 7261 6420 3d20 6e70 2e61 7263 7461 6e32  rad = np.arctan2
+00015080: 282d 6772 6164 5f68 2c20 6772 6164 5f76  (-grad_h, grad_v
+00015090: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+000150a0: 2020 2020 2067 7261 6420 3d20 5068 6173       grad = Phas
+000150b0: 6541 7272 6179 2867 7261 642c 2062 6f72  eArray(grad, bor
+000150c0: 6465 723d 282d 6e70 2e70 692c 206e 702e  der=(-np.pi, np.
+000150d0: 7069 2929 0d0a 2020 2020 2020 2020 6772  pi))..        gr
+000150e0: 6164 2e5f 6669 785f 626f 7264 6572 2829  ad._fix_border()
+000150f0: 0d0a 2020 2020 2020 2020 6465 6720 616e  ..        deg an
+00015100: 6420 6772 6164 2e72 6164 3264 6567 2829  d grad.rad2deg()
+00015110: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00015120: 2067 7261 640d 0a20 2020 200d 0a20 2020   grad..    ..   
+00015130: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
+00015140: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
+00015150: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
+00015160: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
+00015170: 616e 645f 6f75 7470 7574 0d0a 2020 2020  and_output..    
+00015180: 6465 6620 6865 7373 6961 6e5f 616e 676c  def hessian_angl
+00015190: 6528 0d0a 2020 2020 2020 2020 7365 6c66  e(..        self
+000151a0: 2c0d 0a20 2020 2020 2020 2073 6967 6d61  ,..        sigma
+000151b0: 3a20 6e44 466c 6f61 7420 3d20 312e 2c0d  : nDFloat = 1.,.
+000151c0: 0a20 2020 2020 2020 202a 2c20 0d0a 2020  .        *, ..  
+000151d0: 2020 2020 2020 6465 673a 2062 6f6f 6c20        deg: bool 
+000151e0: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
+000151f0: 2020 6469 6d73 3a20 4469 6d73 203d 2032    dims: Dims = 2
+00015200: 2c0d 0a20 2020 2029 202d 3e20 5068 6173  ,..    ) -> Phas
+00015210: 6541 7272 6179 3a0d 0a20 2020 2020 2020  eArray:..       
+00015220: 2022 2222 0d0a 2020 2020 2020 2020 4361   """..        Ca
+00015230: 6c63 756c 6174 6520 6669 6c61 6d65 6e74  lculate filament
+00015240: 2061 6e67 6c65 7320 7573 696e 6720 4865   angles using He
+00015250: 7373 6961 6e27 7320 6569 6765 6e76 6563  ssian's eigenvec
+00015260: 746f 7273 2e0d 0a0d 0a20 2020 2020 2020  tors.....       
+00015270: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+00015280: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+00015290: 0a20 2020 2020 2020 207b 7369 676d 617d  .        {sigma}
+000152a0: 0d0a 2020 2020 2020 2020 6465 6720 3a20  ..        deg : 
+000152b0: 626f 6f6c 2c20 6465 6661 756c 7420 6973  bool, default is
+000152c0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+000152d0: 2020 2020 4966 2054 7275 652c 2072 6574      If True, ret
+000152e0: 7572 6e65 6420 6172 7261 7920 7769 6c6c  urned array will
+000152f0: 2062 6520 696e 2064 6567 7265 652e 204f   be in degree. O
+00015300: 7468 6572 7769 7365 2c20 7261 6469 616e  therwise, radian
+00015310: 2077 696c 6c20 6265 2074 6865 2075 6e69   will be the uni
+00015320: 740d 0a20 2020 2020 2020 2020 2020 206f  t..            o
+00015330: 6620 616e 676c 652e 0d0a 2020 2020 2020  f angle...      
+00015340: 2020 7b64 696d 737d 0d0a 0d0a 2020 2020    {dims}....    
+00015350: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00015360: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+00015370: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
+00015380: 2020 2020 2020 2020 2020 2020 5068 6173              Phas
+00015390: 6520 696d 6167 6520 7769 7468 2072 616e  e image with ran
+000153a0: 6765 205b 2d39 302c 2039 305d 2069 6620  ge [-90, 90] if 
+000153b0: 6060 6465 673d 3d54 7275 6560 602c 206f  ``deg==True``, o
+000153c0: 7468 6572 7769 7365 205b 2d70 692f 322c  therwise [-pi/2,
+000153d0: 2070 692f 325d 2e0d 0a20 2020 2020 2020   pi/2]...       
+000153e0: 200d 0a20 2020 2020 2020 2053 6565 2041   ..        See A
+000153f0: 6c73 6f0d 0a20 2020 2020 2020 202d 2d2d  lso..        ---
+00015400: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2067  -----..        g
+00015410: 6162 6f72 5f61 6e67 6c65 0d0a 2020 2020  abor_angle..    
+00015420: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+00015430: 0a20 2020 2020 2020 205f 2c20 6569 6776  .        _, eigv
+00015440: 6563 203d 2073 656c 662e 6865 7373 6961  ec = self.hessia
+00015450: 6e5f 6569 6728 7369 676d 613d 7369 676d  n_eig(sigma=sigm
+00015460: 612c 2064 696d 733d 6469 6d73 290d 0a20  a, dims=dims).. 
+00015470: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00015480: 2066 6d74 203d 2073 6c69 6365 722e 6765   fmt = slicer.ge
+00015490: 745f 666f 726d 6174 7465 7228 5b22 6469  t_formatter(["di
+000154a0: 6d22 2c20 2262 6173 6522 5d29 0d0a 2020  m", "base"])..  
+000154b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000154c0: 6172 6720 3d20 2d6e 702e 6172 6374 616e  arg = -np.arctan
+000154d0: 3228 6569 6776 6563 5b66 6d74 5b30 2c20  2(eigvec[fmt[0, 
+000154e0: 315d 5d2c 2065 6967 7665 635b 666d 745b  1]], eigvec[fmt[
+000154f0: 312c 2031 5d5d 290d 0a20 2020 2020 2020  1, 1]])..       
+00015500: 2061 7267 203d 2050 6861 7365 4172 7261   arg = PhaseArra
+00015510: 7928 6172 672c 2062 6f72 6465 723d 282d  y(arg, border=(-
+00015520: 6e70 2e70 692f 322c 206e 702e 7069 2f32  np.pi/2, np.pi/2
+00015530: 2929 0d0a 2020 2020 2020 2020 6172 672e  ))..        arg.
+00015540: 5f66 6978 5f62 6f72 6465 7228 290d 0a20  _fix_border().. 
+00015550: 2020 2020 2020 2064 6567 2061 6e64 2061         deg and a
+00015560: 7267 2e72 6164 3264 6567 2829 0d0a 2020  rg.rad2deg()..  
+00015570: 2020 2020 2020 7265 7475 726e 2061 7267        return arg
+00015580: 0d0a 2020 2020 0d0a 2020 2020 405f 646f  ..    ..    @_do
+00015590: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
+000155a0: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
+000155b0: 6961 6c5f 6178 6573 0d0a 2020 2020 4063  ial_axes..    @c
+000155c0: 6865 636b 5f69 6e70 7574 5f61 6e64 5f6f  heck_input_and_o
+000155d0: 7574 7075 740d 0a20 2020 2064 6566 2067  utput..    def g
+000155e0: 6162 6f72 5f61 6e67 6c65 280d 0a20 2020  abor_angle(..   
+000155f0: 2020 2020 2073 656c 662c 0d0a 2020 2020       self,..    
+00015600: 2020 2020 6e5f 7361 6d70 6c65 3a20 696e      n_sample: in
+00015610: 7420 3d20 3138 302c 0d0a 2020 2020 2020  t = 180,..      
+00015620: 2020 6c6d 643a 2066 6c6f 6174 203d 2035    lmd: float = 5
+00015630: 2c0d 0a20 2020 2020 2020 2073 6967 6d61  ,..        sigma
+00015640: 3a20 666c 6f61 7420 3d20 322e 352c 0d0a  : float = 2.5,..
+00015650: 2020 2020 2020 2020 6761 6d6d 613a 2066          gamma: f
+00015660: 6c6f 6174 203d 2031 2c20 0d0a 2020 2020  loat = 1, ..    
+00015670: 2020 2020 7068 693a 2066 6c6f 6174 203d      phi: float =
+00015680: 2030 2c0d 0a20 2020 2020 2020 202a 2c20   0,..        *, 
+00015690: 0d0a 2020 2020 2020 2020 6465 673a 2062  ..        deg: b
+000156a0: 6f6f 6c20 3d20 4661 6c73 652c 200d 0a20  ool = False, .. 
+000156b0: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
+000156c0: 7320 3d20 320d 0a20 2020 2029 202d 3e20  s = 2..    ) -> 
+000156d0: 5068 6173 6541 7272 6179 3a0d 0a20 2020  PhaseArray:..   
+000156e0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+000156f0: 2020 4361 6c63 756c 6174 6520 6669 6c61    Calculate fila
+00015700: 6d65 6e74 2061 6e67 6c65 7320 7573 696e  ment angles usin
+00015710: 6720 4761 626f 7220 6669 6c74 6572 2e20  g Gabor filter. 
+00015720: 466f 7220 616c 6c20 7468 6520 6361 6e64  For all the cand
+00015730: 6964 6174 6573 206f 6620 616e 676c 6573  idates of angles
+00015740: 2c20 4761 626f 7220 7265 7370 6f6e 7365  , Gabor response
+00015750: 2069 730d 0a20 2020 2020 2020 2063 616c   is..        cal
+00015760: 6375 6c61 7465 642c 2061 6e64 2074 6865  culated, and the
+00015770: 2073 7472 6f6e 6765 7374 2072 6573 706f   strongest respo
+00015780: 6e73 6520 6973 2072 6574 7572 6e65 6420  nse is returned 
+00015790: 6173 206f 7574 7075 7420 6172 7261 792e  as output array.
+000157a0: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
+000157b0: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+000157c0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+000157d0: 2020 2020 6e5f 7361 6d70 6c65 203a 2069      n_sample : i
+000157e0: 6e74 2c20 6465 6661 756c 7420 6973 2031  nt, default is 1
+000157f0: 3830 0d0a 2020 2020 2020 2020 2020 2020  80..            
+00015800: 4e75 6d62 6572 206f 6620 6074 6865 7461  Number of `theta
+00015810: 6073 2074 6f20 6361 6c63 756c 6174 652e  `s to calculate.
+00015820: 2042 7920 6465 6661 756c 742c 202d 3930   By default, -90
+00015830: 2c20 2d38 392c 202e 2e2e 2c20 3839 2064  , -89, ..., 89 d
+00015840: 6567 7265 6520 6172 6520 6361 6c63 756c  egree are calcul
+00015850: 6174 6564 2e0d 0a20 2020 2020 2020 206c  ated...        l
+00015860: 6d64 203a 2066 6c6f 6174 2c20 6465 6661  md : float, defa
+00015870: 756c 7420 6973 2035 0d0a 2020 2020 2020  ult is 5..      
+00015880: 2020 2020 2020 5761 7665 206c 656e 6774        Wave lengt
+00015890: 6820 6f66 2047 6162 6f72 206b 6572 6e65  h of Gabor kerne
+000158a0: 6c2e 204d 616b 6520 7375 7265 2074 6861  l. Make sure tha
+000158b0: 7420 7468 6520 6469 616d 6574 6572 206f  t the diameter o
+000158c0: 6620 7468 6520 6f62 6a65 6374 7320 796f  f the objects yo
+000158d0: 7520 7761 6e74 2074 6f20 6465 7465 6374  u want to detect
+000158e0: 2069 730d 0a20 2020 2020 2020 2020 2020   is..           
+000158f0: 2061 726f 756e 6420 606c 6d64 2f32 602e   around `lmd/2`.
+00015900: 0d0a 2020 2020 2020 2020 7369 676d 6120  ..        sigma 
+00015910: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00015920: 2069 7320 322e 350d 0a20 2020 2020 2020   is 2.5..       
+00015930: 2020 2020 2053 7461 6e64 6172 6420 6465       Standard de
+00015940: 7669 6174 696f 6e20 6f66 2047 6175 7373  viation of Gauss
+00015950: 6961 6e20 6661 6374 6f72 206f 6620 4761  ian factor of Ga
+00015960: 626f 7220 6b65 726e 656c 2e0d 0a20 2020  bor kernel...   
+00015970: 2020 2020 2067 616d 6d61 203a 2066 6c6f       gamma : flo
+00015980: 6174 2c20 6465 6661 756c 7420 6973 2031  at, default is 1
+00015990: 0d0a 2020 2020 2020 2020 2020 2020 416e  ..            An
+000159a0: 6973 6f74 726f 7079 206f 6620 4761 626f  isotropy of Gabo
+000159b0: 7220 6b65 726e 656c 2c20 692e 652e 2074  r kernel, i.e. t
+000159c0: 6865 2073 7461 6e64 6172 6420 6465 7669  he standard devi
+000159d0: 6174 696f 6e20 6f72 7468 6f67 6f6e 616c  ation orthogonal
+000159e0: 2074 6f20 7468 6574 6120 7769 6c6c 2062   to theta will b
+000159f0: 6520 7369 676d 612f 6761 6d6d 612e 0d0a  e sigma/gamma...
+00015a00: 2020 2020 2020 2020 7068 6920 3a20 666c          phi : fl
+00015a10: 6f61 742c 2064 6566 6175 6c74 2069 7320  oat, default is 
+00015a20: 300d 0a20 2020 2020 2020 2020 2020 2050  0..            P
+00015a30: 6861 7365 206f 6666 7365 7420 6f66 2068  hase offset of h
+00015a40: 6172 6d6f 6e69 6320 6661 6374 6f72 206f  armonic factor o
+00015a50: 6620 4761 626f 7220 6b65 726e 656c 2e0d  f Gabor kernel..
+00015a60: 0a20 2020 2020 2020 2064 6567 203a 2062  .        deg : b
+00015a70: 6f6f 6c2c 2064 6566 6175 6c74 2069 7320  ool, default is 
+00015a80: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+00015a90: 2020 2049 6620 5472 7565 2c20 6465 6772     If True, degr
+00015aa0: 6565 2072 6174 6865 7220 7468 616e 2072  ee rather than r
+00015ab0: 6164 6961 6e20 6973 2072 6574 7572 6e65  adian is returne
+00015ac0: 642e 0d0a 2020 2020 2020 2020 7b64 696d  d...        {dim
+00015ad0: 737d 0d0a 2020 2020 2020 2020 2020 2020  s}..            
+00015ae0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00015af0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00015b00: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
+00015b10: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
+00015b20: 2020 5068 6173 6520 696d 6167 6520 7769    Phase image wi
+00015b30: 7468 2072 616e 6765 205b 2d39 302c 2039  th range [-90, 9
+00015b40: 3029 2069 6620 6465 673d 3d54 7275 652c  0) if deg==True,
+00015b50: 206f 7468 6572 7769 7365 205b 2d70 692f   otherwise [-pi/
+00015b60: 322c 2070 692f 3229 2e0d 0a20 2020 2020  2, pi/2)...     
+00015b70: 2020 200d 0a20 2020 2020 2020 2053 6565     ..        See
+00015b80: 2041 6c73 6f0d 0a20 2020 2020 2020 202d   Also..        -
+00015b90: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+00015ba0: 2068 6573 7369 616e 5f61 6e67 6c65 0d0a   hessian_angle..
+00015bb0: 2020 2020 2020 2020 2222 2220 2020 2020          """     
+00015bc0: 2020 200d 0a20 2020 2020 2020 2074 6865     ..        the
+00015bd0: 7461 7320 3d20 6e70 2e6c 696e 7370 6163  tas = np.linspac
+00015be0: 6528 302c 206e 702e 7069 2c20 6e5f 7361  e(0, np.pi, n_sa
+00015bf0: 6d70 6c65 2c20 4661 6c73 6529 0d0a 2020  mple, False)..  
+00015c00: 2020 2020 2020 6d61 785f 203d 206e 702e        max_ = np.
+00015c10: 656d 7074 7928 7365 6c66 2e73 6861 7065  empty(self.shape
+00015c20: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
+00015c30: 3332 290d 0a20 2020 2020 2020 2061 7267  32)..        arg
+00015c40: 6d61 785f 203d 206e 702e 7a65 726f 7328  max_ = np.zeros(
+00015c50: 7365 6c66 2e73 6861 7065 2c20 6474 7970  self.shape, dtyp
+00015c60: 653d 6e70 2e66 6c6f 6174 3332 2920 2320  e=np.float32) # 
+00015c70: 5468 6973 2069 7320 666c 6f61 7433 3220  This is float32 
+00015c80: 6265 6361 7573 6520 6669 6e61 6c6c 7920  because finally 
+00015c90: 7468 6973 2062 6563 6f6d 6573 2061 6e67  this becomes ang
+00015ca0: 6c65 2061 7272 6179 2e0d 0a20 2020 2020  le array...     
+00015cb0: 2020 200d 0a20 2020 2020 2020 2063 5f61     ..        c_a
+00015cc0: 7865 7320 3d20 636f 6d70 6c65 6d65 6e74  xes = complement
+00015cd0: 5f61 7865 7328 6469 6d73 2c20 7365 6c66  _axes(dims, self
+00015ce0: 2e61 7865 7329 0d0a 2020 2020 2020 2020  .axes)..        
+00015cf0: 666f 7220 692c 2074 6865 7461 2069 6e20  for i, theta in 
+00015d00: 656e 756d 6572 6174 6528 7468 6574 6173  enumerate(thetas
+00015d10: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00015d20: 6b65 7220 3d20 736b 6669 6c2e 6761 626f  ker = skfil.gabo
+00015d30: 725f 6b65 726e 656c 2831 2f6c 6d64 2c20  r_kernel(1/lmd, 
+00015d40: 7468 6574 612c 2030 2c20 7369 676d 612c  theta, 0, sigma,
+00015d50: 2073 6967 6d61 2f67 616d 6d61 2c20 332c   sigma/gamma, 3,
+00015d60: 2070 6869 292e 6173 7479 7065 286e 702e   phi).astype(np.
+00015d70: 636f 6d70 6c65 7836 3429 0d0a 2020 2020  complex64)..    
+00015d80: 2020 2020 2020 2020 6f75 745f 203d 2073          out_ = s
+00015d90: 656c 662e 6173 5f66 6c6f 6174 2829 2e5f  elf.as_float()._
+00015da0: 6170 706c 795f 6461 736b 285f 6669 6c74  apply_dask(_filt
+00015db0: 6572 732e 636f 6e76 6f6c 7665 2c20 0d0a  ers.convolve, ..
+00015dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015de0: 2020 2020 2020 2020 2020 2020 2020 635f                c_
+00015df0: 6178 6573 3d63 5f61 7865 732c 200d 0a20  axes=c_axes, .. 
+00015e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e20: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+00015e30: 733d 286b 6572 2e72 6561 6c2c 290d 0a20  s=(ker.real,).. 
+00015e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e60: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00015e70: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00015e80: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
+00015e90: 2020 2020 2020 2077 6865 7265 5f75 7064         where_upd
+00015ea0: 6174 6520 3d20 6f75 745f 203e 206d 6178  ate = out_ > max
+00015eb0: 5f0d 0a20 2020 2020 2020 2020 2020 2020  _..             
+00015ec0: 2020 206d 6178 5f5b 7768 6572 655f 7570     max_[where_up
+00015ed0: 6461 7465 5d20 3d20 6f75 745f 5b77 6865  date] = out_[whe
+00015ee0: 7265 5f75 7064 6174 655d 0d0a 2020 2020  re_update]..    
+00015ef0: 2020 2020 2020 2020 2020 2020 6172 676d              argm
+00015f00: 6178 5f5b 7768 6572 655f 7570 6461 7465  ax_[where_update
+00015f10: 5d20 3d20 690d 0a20 2020 2020 2020 2020  ] = i..         
+00015f20: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00015f30: 2020 2020 2020 2020 2020 6d61 785f 203d            max_ =
+00015f40: 206f 7574 5f0d 0a20 2020 2020 2020 2061   out_..        a
+00015f50: 7267 6d61 785f 202a 3d20 2874 6865 7461  rgmax_ *= (theta
+00015f60: 735b 315d 202d 2074 6865 7461 735b 305d  s[1] - thetas[0]
+00015f70: 290d 0a20 2020 2020 2020 2061 7267 6d61  )..        argma
+00015f80: 785f 5b3a 5d20 3d20 6e70 2e70 692f 3220  x_[:] = np.pi/2 
+00015f90: 2d20 6172 676d 6178 5f0d 0a20 2020 2020  - argmax_..     
+00015fa0: 2020 200d 0a20 2020 2020 2020 2061 7267     ..        arg
+00015fb0: 6d61 785f 203d 2050 6861 7365 4172 7261  max_ = PhaseArra
+00015fc0: 7928 6172 676d 6178 5f2c 2062 6f72 6465  y(argmax_, borde
+00015fd0: 723d 282d 6e70 2e70 692f 322c 206e 702e  r=(-np.pi/2, np.
+00015fe0: 7069 2f32 2929 0d0a 2020 2020 2020 2020  pi/2))..        
+00015ff0: 6172 676d 6178 5f2e 5f66 6978 5f62 6f72  argmax_._fix_bor
+00016000: 6465 7228 290d 0a20 2020 2020 2020 2064  der()..        d
+00016010: 6567 2061 6e64 2061 7267 6d61 785f 2e72  eg and argmax_.r
+00016020: 6164 3264 6567 2829 0d0a 2020 2020 2020  ad2deg()..      
+00016030: 2020 7265 7475 726e 2061 7267 6d61 785f    return argmax_
+00016040: 0d0a 2020 2020 0d0a 2020 2020 405f 646f  ..    ..    @_do
+00016050: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
+00016060: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
+00016070: 6961 6c5f 6178 6573 0d0a 2020 2020 4063  ial_axes..    @c
+00016080: 6865 636b 5f69 6e70 7574 5f61 6e64 5f6f  heck_input_and_o
+00016090: 7574 7075 740d 0a20 2020 2064 6566 2067  utput..    def g
+000160a0: 6162 6f72 5f66 696c 7465 7228 0d0a 2020  abor_filter(..  
+000160b0: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
+000160c0: 2020 2020 206c 6d64 3a20 666c 6f61 7420       lmd: float 
+000160d0: 3d20 352c 0d0a 2020 2020 2020 2020 7468  = 5,..        th
+000160e0: 6574 613a 2066 6c6f 6174 203d 2030 2c0d  eta: float = 0,.
+000160f0: 0a20 2020 2020 2020 2073 6967 6d61 3a20  .        sigma: 
+00016100: 666c 6f61 7420 3d20 322e 352c 0d0a 2020  float = 2.5,..  
+00016110: 2020 2020 2020 6761 6d6d 613a 2066 6c6f        gamma: flo
+00016120: 6174 203d 2031 2c0d 0a20 2020 2020 2020  at = 1,..       
+00016130: 2070 6869 3a20 666c 6f61 7420 3d20 302c   phi: float = 0,
+00016140: 200d 0a20 2020 2020 2020 202a 2c0d 0a20   ..        *,.. 
+00016150: 2020 2020 2020 2072 6574 7572 6e5f 696d         return_im
+00016160: 6167 3a20 626f 6f6c 203d 2046 616c 7365  ag: bool = False
+00016170: 2c0d 0a20 2020 2020 2020 2064 696d 733a  ,..        dims:
+00016180: 2044 696d 7320 3d20 320d 0a20 2020 2029   Dims = 2..    )
+00016190: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+000161a0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000161b0: 2020 2020 4d61 6b65 2061 2047 6162 6f72      Make a Gabor
+000161c0: 206b 6572 6e65 6c20 616e 6420 636f 6e76   kernel and conv
+000161d0: 6f6c 7665 2069 742e 0d0a 0d0a 2020 2020  olve it.....    
+000161e0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+000161f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00016200: 2d2d 0d0a 2020 2020 2020 2020 6c6d 6420  --..        lmd 
+00016210: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00016220: 2069 7320 350d 0a20 2020 2020 2020 2020   is 5..         
+00016230: 2020 2057 6176 6520 6c65 6e67 7468 206f     Wave length o
+00016240: 6620 4761 626f 7220 6b65 726e 656c 2e20  f Gabor kernel. 
+00016250: 4d61 6b65 2073 7572 6520 7468 6174 2074  Make sure that t
+00016260: 6865 2064 6961 6d65 7465 7220 6f66 2074  he diameter of t
+00016270: 6865 206f 626a 6563 7473 2079 6f75 2077  he objects you w
+00016280: 616e 7420 746f 2064 6574 6563 7420 6973  ant to detect is
+00016290: 0d0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
+000162a0: 6f75 6e64 2060 6c6d 642f 3260 2e0d 0a20  ound `lmd/2`... 
+000162b0: 2020 2020 2020 2074 6865 7461 203a 2066         theta : f
+000162c0: 6c6f 6174 2c20 6465 6661 756c 7420 6973  loat, default is
+000162d0: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
+000162e0: 4f72 6965 6e74 6174 696f 6e20 6f66 2068  Orientation of h
+000162f0: 6172 6d6f 6e69 6320 6661 6374 6f72 206f  armonic factor o
+00016300: 6620 4761 626f 7220 6b65 726e 656c 2069  f Gabor kernel i
+00016310: 6e20 7261 6469 616e 2028 782d 6469 7265  n radian (x-dire
+00016320: 6374 696f 6e61 6c20 6966 2060 7468 6574  ctional if `thet
+00016330: 613d 3d30 6029 2e0d 0a20 2020 2020 2020  a==0`)...       
+00016340: 207b 7369 676d 617d 0d0a 2020 2020 2020   {sigma}..      
+00016350: 2020 6761 6d6d 6120 3a20 666c 6f61 742c    gamma : float,
+00016360: 2064 6566 6175 6c74 2069 7320 310d 0a20   default is 1.. 
+00016370: 2020 2020 2020 2020 2020 2041 6e69 736f             Aniso
+00016380: 7472 6f70 7920 6f66 2047 6162 6f72 206b  tropy of Gabor k
+00016390: 6572 6e65 6c2c 2069 2e65 2e20 7468 6520  ernel, i.e. the 
+000163a0: 7374 616e 6461 7264 2064 6576 6961 7469  standard deviati
+000163b0: 6f6e 206f 7274 686f 676f 6e61 6c20 746f  on orthogonal to
+000163c0: 2074 6865 7461 2077 696c 6c20 6265 2073   theta will be s
+000163d0: 6967 6d61 2f67 616d 6d61 2e0d 0a20 2020  igma/gamma...   
+000163e0: 2020 2020 2070 6869 203a 2066 6c6f 6174       phi : float
+000163f0: 2c20 6465 6661 756c 7420 6973 2030 0d0a  , default is 0..
+00016400: 2020 2020 2020 2020 2020 2020 5068 6173              Phas
+00016410: 6520 6f66 6673 6574 206f 6620 6861 726d  e offset of harm
+00016420: 6f6e 6963 2066 6163 746f 7220 6f66 2047  onic factor of G
+00016430: 6162 6f72 206b 6572 6e65 6c2e 0d0a 2020  abor kernel...  
+00016440: 2020 2020 2020 7265 7475 726e 5f69 6d61        return_ima
+00016450: 6720 3a20 626f 6f6c 2c20 6465 6661 756c  g : bool, defaul
+00016460: 7420 6973 2046 616c 7365 0d0a 2020 2020  t is False..    
+00016470: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00016480: 2061 2063 6f6d 706c 6578 2069 6d61 6765   a complex image
+00016490: 2074 6861 7420 636f 6e74 6169 6e73 2062   that contains b
+000164a0: 6f74 6820 7265 616c 2061 6e64 2069 6d61  oth real and ima
+000164b0: 6769 6e61 7279 2070 6172 7420 6f66 2047  ginary part of G
+000164c0: 6162 6f72 2072 6573 706f 6e73 6520 6973  abor response is
+000164d0: 2072 6574 7572 6e65 642e 0d0a 2020 2020   returned...    
+000164e0: 2020 2020 7b64 696d 737d 0d0a 0d0a 2020      {dims}....  
+000164f0: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+00016500: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
+00016510: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
+00016520: 2028 6474 7970 6520 6973 2066 6c6f 6174   (dtype is float
+00016530: 3332 206f 7220 636f 6d70 6c65 7836 3429  32 or complex64)
+00016540: 0d0a 2020 2020 2020 2020 2020 2020 4669  ..            Fi
+00016550: 6c74 6572 6564 2069 6d61 6765 2e0d 0a20  ltered image... 
+00016560: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00016570: 2045 7861 6d70 6c65 730d 0a20 2020 2020   Examples..     
+00016580: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
+00016590: 2020 2020 2045 6467 6520 4465 7465 6374       Edge Detect
+000165a0: 696f 6e20 7573 696e 6720 6d75 6c74 692d  ion using multi-
+000165b0: 616e 676c 6520 4761 626f 7220 6669 6c74  angle Gabor filt
+000165c0: 6572 696e 672e 0d0a 2020 2020 2020 2020  ering...        
+000165d0: 2020 2020 3e3e 3e20 7468 6574 6173 203d      >>> thetas =
+000165e0: 206e 702e 6465 6732 7261 6428 5b30 2c20   np.deg2rad([0, 
+000165f0: 3435 2c20 3930 2c20 3133 355d 290d 0a20  45, 90, 135]).. 
+00016600: 2020 2020 2020 2020 2020 203e 3e3e 206f             >>> o
+00016610: 7574 203d 206e 702e 7a65 726f 7328 2834  ut = np.zeros((4
+00016620: 2c29 2b69 6d67 2e73 6861 7065 2c20 6474  ,)+img.shape, dt
+00016630: 7970 653d 6e70 2e66 6c6f 6174 3332 290d  ype=np.float32).
+00016640: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+00016650: 2066 6f72 2069 2c20 7468 6574 6120 696e   for i, theta in
+00016660: 2065 6e75 6d65 7261 7465 2874 6865 7461   enumerate(theta
+00016670: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+00016680: 203e 3e3e 2020 2020 206f 7574 5b69 5d20   >>>     out[i] 
+00016690: 3d20 696d 672e 6761 626f 725f 6669 6c74  = img.gabor_filt
+000166a0: 6572 2874 6865 7461 3d74 6865 7461 290d  er(theta=theta).
+000166b0: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+000166c0: 206f 7574 203d 206e 702e 6d61 7828 6f75   out = np.max(ou
+000166d0: 742c 2061 7869 733d 3029 0d0a 2020 2020  t, axis=0)..    
+000166e0: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+000166f0: 0a20 2020 2020 2020 2023 2054 4f44 4f3a  .        # TODO:
+00016700: 2033 4420 4761 626f 7220 6669 6c74 6572   3D Gabor filter
+00016710: 0d0a 2020 2020 2020 2020 6b65 7220 3d20  ..        ker = 
+00016720: 736b 6669 6c2e 6761 626f 725f 6b65 726e  skfil.gabor_kern
+00016730: 656c 2831 2f6c 6d64 2c20 7468 6574 612c  el(1/lmd, theta,
+00016740: 2030 2c20 7369 676d 612c 2073 6967 6d61   0, sigma, sigma
+00016750: 2f67 616d 6d61 2c20 332c 2070 6869 292e  /gamma, 3, phi).
+00016760: 6173 7479 7065 286e 702e 636f 6d70 6c65  astype(np.comple
+00016770: 7836 3429 0d0a 2020 2020 2020 2020 6966  x64)..        if
+00016780: 2072 6574 7572 6e5f 696d 6167 3a0d 0a20   return_imag:.. 
+00016790: 2020 2020 2020 2020 2020 206f 7574 203d             out =
+000167a0: 2073 656c 662e 6173 5f66 6c6f 6174 2829   self.as_float()
+000167b0: 2e5f 6170 706c 795f 6461 736b 280d 0a20  ._apply_dask(.. 
+000167c0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+000167d0: 6669 6c74 6572 732e 6761 626f 725f 6669  filters.gabor_fi
+000167e0: 6c74 6572 2c20 0d0a 2020 2020 2020 2020  lter, ..        
+000167f0: 2020 2020 2020 2020 635f 6178 6573 3d63          c_axes=c
+00016800: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
+00016810: 696d 732c 2073 656c 662e 6178 6573 292c  ims, self.axes),
+00016820: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00016830: 2020 2061 7267 733d 286b 6572 2c29 2c20     args=(ker,), 
+00016840: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016850: 2020 6474 7970 653d 6e70 2e63 6f6d 706c    dtype=np.compl
+00016860: 6578 3634 0d0a 2020 2020 2020 2020 2020  ex64..          
+00016870: 2020 290d 0a20 2020 2020 2020 2065 6c73    )..        els
+00016880: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00016890: 6f75 7420 3d20 7365 6c66 2e61 735f 666c  out = self.as_fl
+000168a0: 6f61 7428 292e 5f61 7070 6c79 5f64 6173  oat()._apply_das
+000168b0: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
+000168c0: 2020 2020 5f66 696c 7465 7273 2e63 6f6e      _filters.con
+000168d0: 766f 6c76 652c 200d 0a20 2020 2020 2020  volve, ..       
+000168e0: 2020 2020 2020 2020 2063 5f61 7865 733d           c_axes=
+000168f0: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
+00016900: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
+00016910: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00016920: 2020 2061 7267 733d 286b 6572 2e72 6561     args=(ker.rea
+00016930: 6c2c 292c 200d 0a20 2020 2020 2020 2020  l,), ..         
+00016940: 2020 2020 2020 2064 7479 7065 3d6e 702e         dtype=np.
+00016950: 666c 6f61 7433 320d 0a20 2020 2020 2020  float32..       
+00016960: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00016970: 7265 7475 726e 206f 7574 0d0a 2020 2020  return out..    
+00016980: 0d0a 2020 2020 405f 646f 6373 2e77 7269  ..    @_docs.wri
+00016990: 7465 5f64 6f63 730d 0a20 2020 2040 6469  te_docs..    @di
+000169a0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+000169b0: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
+000169c0: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
+000169d0: 0a20 2020 2064 6566 2066 6674 280d 0a20  .    def fft(.. 
+000169e0: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
+000169f0: 2020 2020 2020 2a2c 200d 0a20 2020 2020        *, ..     
+00016a00: 2020 2073 6861 7065 3a20 696e 7420 7c20     shape: int | 
+00016a10: 4974 6572 6162 6c65 5b69 6e74 5d20 7c20  Iterable[int] | 
+00016a20: 4666 7453 6861 7065 203d 2022 7361 6d65  FftShape = "same
+00016a30: 222c 0d0a 2020 2020 2020 2020 7368 6966  ",..        shif
+00016a40: 743a 2062 6f6f 6c20 3d20 5472 7565 2c20  t: bool = True, 
+00016a50: 0d0a 2020 2020 2020 2020 646f 7562 6c65  ..        double
+00016a60: 5f70 7265 6369 7369 6f6e 3a20 626f 6f6c  _precision: bool
+00016a70: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+00016a80: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
+00016a90: 4e6f 6e65 0d0a 2020 2020 2920 2d3e 2049  None..    ) -> I
+00016aa0: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
+00016ab0: 2020 2222 220d 0a20 2020 2020 2020 2046    """..        F
+00016ac0: 6173 7420 466f 7572 6965 7220 7472 616e  ast Fourier tran
+00016ad0: 7366 6f72 6d61 7469 6f6e 2e20 5468 6973  sformation. This
+00016ae0: 2066 756e 6374 696f 6e20 7265 7475 726e   function return
+00016af0: 7320 636f 6d70 6c65 7820 6172 7261 792c  s complex array,
+00016b00: 2077 6869 6368 2069 730d 0a20 2020 2020   which is..     
+00016b10: 2020 2069 6e63 6f6e 7061 7469 626c 6520     inconpatible 
+00016b20: 7769 7468 2073 6f6d 6520 496d 6741 7272  with some ImgArr
+00016b30: 6179 2066 756e 6374 696f 6e73 2e0d 0a20  ay functions... 
+00016b40: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00016b50: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+00016b60: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+00016b70: 0a20 2020 2020 2020 2073 6861 7065 203a  .        shape :
+00016b80: 2069 6e74 2c20 6974 6572 6162 6c65 206f   int, iterable o
+00016b90: 6620 696e 742c 2022 7371 7561 7265 2220  f int, "square" 
+00016ba0: 6f72 2022 7361 6d65 220d 0a20 2020 2020  or "same"..     
+00016bb0: 2020 2020 2020 204f 7574 7075 7420 7368         Output sh
+00016bc0: 6170 652e 2049 6e70 7574 2069 6d61 6765  ape. Input image
+00016bd0: 2069 7320 7061 6464 6564 206f 7220 6372   is padded or cr
+00016be0: 6f70 7065 6420 6163 636f 7264 696e 6720  opped according 
+00016bf0: 746f 2074 6869 7320 7661 6c75 653a 0d0a  to this value:..
+00016c00: 2020 2020 2020 2020 2020 2020 2d20 696e              - in
+00016c10: 7465 6765 7273 3a20 7061 6464 6564 206f  tegers: padded o
+00016c20: 7220 6372 6f70 7065 6420 746f 2074 6865  r cropped to the
+00016c30: 2073 7065 6369 6669 6564 2073 6861 7065   specified shape
+00016c40: 2e0d 0a20 2020 2020 2020 2020 2020 202d  ...            -
+00016c50: 2022 7371 7561 7265 223a 2070 6164 6465   "square": padde
+00016c60: 6420 746f 2073 6d61 6c6c 6573 7420 325e  d to smallest 2^
+00016c70: 4e2d 6c6f 6e67 2073 7175 6172 652e 0d0a  N-long square...
+00016c80: 2020 2020 2020 2020 2020 2020 2d20 2273              - "s
+00016c90: 616d 6522 2028 6465 6661 756c 7429 3a20  ame" (default): 
+00016ca0: 6e6f 2070 6164 6469 6e67 206f 7220 6372  no padding or cr
+00016cb0: 6f70 7069 6e67 2e0d 0a20 2020 2020 2020  opping...       
+00016cc0: 2073 6869 6674 203a 2062 6f6f 6c2c 2064   shift : bool, d
+00016cd0: 6566 6175 6c74 2069 7320 5472 7565 0d0a  efault is True..
+00016ce0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00016cf0: 7275 652c 2063 616c 6c20 6060 6e70 2e66  rue, call ``np.f
+00016d00: 6674 2e66 6674 7368 6966 7460 6020 696e  ft.fftshift`` in
+00016d10: 2074 6865 2065 6e64 2e0d 0a20 2020 2020   the end...     
+00016d20: 2020 207b 646f 7562 6c65 5f70 7265 6369     {double_preci
+00016d30: 7369 6f6e 7d0d 0a20 2020 2020 2020 207b  sion}..        {
+00016d40: 6469 6d73 7d0d 0a20 2020 2020 2020 2020  dims}..         
+00016d50: 2020 200d 0a20 2020 2020 2020 2052 6574     ..        Ret
+00016d60: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
+00016d70: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
+00016d80: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
+00016d90: 2020 2020 2046 4654 2069 6d61 6765 2e0d       FFT image..
+00016da0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00016db0: 2020 2053 6565 2041 6c73 6f0d 0a20 2020     See Also..   
+00016dc0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20       --------.. 
+00016dd0: 2020 2020 2020 206c 6f63 616c 5f64 6674         local_dft
+00016de0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00016df0: 2020 2020 2020 2061 7865 7320 3d20 5b73         axes = [s
+00016e00: 656c 662e 6178 6973 6f66 2861 2920 666f  elf.axisof(a) fo
+00016e10: 7220 6120 696e 2064 696d 735d 0d0a 2020  r a in dims]..  
+00016e20: 2020 2020 2020 6966 2073 6861 7065 203d        if shape =
+00016e30: 3d20 2273 7175 6172 6522 3a0d 0a20 2020  = "square":..   
+00016e40: 2020 2020 2020 2020 2073 203d 2032 2a2a           s = 2**
+00016e50: 696e 7428 6e70 2e63 6569 6c28 6e70 2e6d  int(np.ceil(np.m
+00016e60: 6178 2873 656c 662e 7369 7a65 736f 6628  ax(self.sizesof(
+00016e70: 6469 6d73 2929 2929 0d0a 2020 2020 2020  dims))))..      
+00016e80: 2020 2020 2020 7368 6170 6520 3d20 2873        shape = (s
+00016e90: 2c29 202a 206c 656e 2864 696d 7329 0d0a  ,) * len(dims)..
+00016ea0: 2020 2020 2020 2020 656c 6966 2073 6861          elif sha
+00016eb0: 7065 203d 3d20 2273 616d 6522 3a0d 0a20  pe == "same":.. 
+00016ec0: 2020 2020 2020 2020 2020 2073 6861 7065             shape
+00016ed0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00016ee0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00016ef0: 2020 2020 7368 6170 6520 3d20 6368 6563      shape = chec
+00016f00: 6b5f 6e64 2873 6861 7065 2c20 6c65 6e28  k_nd(shape, len(
+00016f10: 6469 6d73 2929 0d0a 2020 2020 2020 2020  dims))..        
+00016f20: 6474 7970 6520 3d20 6e70 2e66 6c6f 6174  dtype = np.float
+00016f30: 3634 2069 6620 646f 7562 6c65 5f70 7265  64 if double_pre
+00016f40: 6369 7369 6f6e 2065 6c73 6520 6e70 2e66  cision else np.f
+00016f50: 6c6f 6174 3332 0d0a 2020 2020 2020 2020  loat32..        
+00016f60: 6672 6571 203d 2078 702e 6666 742e 6666  freq = xp.fft.ff
+00016f70: 746e 2878 702e 6173 6172 7261 7928 7365  tn(xp.asarray(se
+00016f80: 6c66 2e76 616c 7565 2c20 6474 7970 653d  lf.value, dtype=
+00016f90: 6474 7970 6529 2c20 733d 7368 6170 652c  dtype), s=shape,
+00016fa0: 2061 7865 733d 6178 6573 290d 0a20 2020   axes=axes)..   
+00016fb0: 2020 2020 2069 6620 7368 6966 743a 0d0a       if shift:..
+00016fc0: 2020 2020 2020 2020 2020 2020 6672 6571              freq
+00016fd0: 5b3a 5d20 3d20 7870 2e66 6674 2e66 6674  [:] = xp.fft.fft
+00016fe0: 7368 6966 7428 6672 6571 2c20 6178 6573  shift(freq, axes
+00016ff0: 3d61 7865 7329 0d0a 2020 2020 2020 2020  =axes)..        
+00017000: 7265 7475 726e 2078 702e 6173 6e75 6d70  return xp.asnump
+00017010: 7928 6672 6571 2c20 6474 7970 653d 6e70  y(freq, dtype=np
+00017020: 2e63 6f6d 706c 6578 3634 290d 0a20 2020  .complex64)..   
+00017030: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
+00017040: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
+00017050: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
+00017060: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
+00017070: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
+00017080: 0d0a 2020 2020 6465 6620 6c6f 6361 6c5f  ..    def local_
+00017090: 6466 7428 0d0a 2020 2020 2020 2020 7365  dft(..        se
+000170a0: 6c66 2c0d 0a20 2020 2020 2020 206b 6579  lf,..        key
+000170b0: 3a20 4178 6573 5461 7267 6574 6564 536c  : AxesTargetedSl
+000170c0: 6963 6572 207c 204e 6f6e 6520 3d20 4e6f  icer | None = No
+000170d0: 6e65 2c0d 0a20 2020 2020 2020 2075 7073  ne,..        ups
+000170e0: 616d 706c 655f 6661 6374 6f72 3a20 6e44  ample_factor: nD
+000170f0: 496e 7420 3d20 312c 0d0a 2020 2020 2020  Int = 1,..      
+00017100: 2020 2a2c 0d0a 2020 2020 2020 2020 646f    *,..        do
+00017110: 7562 6c65 5f70 7265 6369 7369 6f6e 3a20  uble_precision: 
+00017120: 626f 6f6c 203d 2046 616c 7365 2c20 0d0a  bool = False, ..
+00017130: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
+00017140: 6d73 203d 204e 6f6e 650d 0a20 2020 2029  ms = None..    )
+00017150: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+00017160: 2020 2020 2020 2072 2222 220d 0a20 2020         r"""..   
+00017170: 2020 2020 204c 6f63 616c 2064 6973 6372       Local discr
+00017180: 6574 6520 466f 7572 6965 7220 7472 616e  ete Fourier tran
+00017190: 7366 6f72 6d61 7469 6f6e 2028 4446 5429  sformation (DFT)
+000171a0: 2e20 5468 6973 2066 756e 6374 696f 6e20  . This function 
+000171b0: 7769 6c6c 2062 6520 7573 6566 756c 200d  will be useful .
+000171c0: 0a20 2020 2020 2020 2066 6f72 2046 6f75  .        for Fou
+000171d0: 7269 6572 2074 7261 6e73 666f 726d 6174  rier transformat
+000171e0: 696f 6e20 6f66 2073 6d61 6c6c 2072 6567  ion of small reg
+000171f0: 696f 6e20 6f66 2061 6e20 696d 6167 6520  ion of an image 
+00017200: 7769 7468 2061 2063 6572 7461 696e 0d0a  with a certain..
+00017210: 2020 2020 2020 2020 6661 6374 6f72 206f          factor o
+00017220: 6620 7570 2d73 616d 706c 696e 672e 2049  f up-sampling. I
+00017230: 6e20 6765 6e65 7261 6c20 4646 5420 7461  n general FFT ta
+00017240: 6b65 7320 3a6d 6174 683a 604f 284e 5c6c  kes :math:`O(N\l
+00017250: 6f67 7b4e 7d29 6020 7469 6d65 2c20 6d75  og{N})` time, mu
+00017260: 6368 0d0a 2020 2020 2020 2020 6661 7374  ch..        fast
+00017270: 6572 2063 6f6d 7061 7265 6420 746f 206e  er compared to n
+00017280: 6f72 6d61 6c20 4446 5420 283a 6d61 7468  ormal DFT (:math
+00017290: 3a60 4f28 4e5e 3229 6029 2e20 486f 7765  :`O(N^2)`). Howe
+000172a0: 7665 722c 2049 6620 796f 7520 6172 6520  ver, If you are 
+000172b0: 0d0a 2020 2020 2020 2020 696e 7465 7265  ..        intere
+000172c0: 7374 6564 2069 6e20 6365 7274 6169 6e20  sted in certain 
+000172d0: 7265 6769 6f6e 206f 6620 466f 7572 6965  region of Fourie
+000172e0: 7220 7370 6163 652c 2079 6f75 2064 6f6e  r space, you don
+000172f0: 2774 2068 6176 6520 746f 2063 616c 6375  't have to calcu
+00017300: 6c61 7465 200d 0a20 2020 2020 2020 2061  late ..        a
+00017310: 6c6c 2074 6865 2073 7065 6374 7261 2e20  ll the spectra. 
+00017320: 496e 2074 6869 7320 6361 7365 2044 4654  In this case DFT
+00017330: 2069 7320 6661 7374 6572 2061 6e64 206c   is faster and l
+00017340: 6573 7320 6d65 6d6f 7279 2063 6f6d 7375  ess memory comsu
+00017350: 6d69 6e67 2e0d 0a20 2020 2020 2020 200d  ming...        .
+00017360: 0a20 2020 2020 2020 2020 2020 202e 2e20  .            .. 
+00017370: 7761 726e 696e 673a 3a0d 0a20 2020 2020  warning::..     
+00017380: 2020 2020 2020 2020 2020 2054 6865 2072             The r
+00017390: 6573 756c 7420 6f66 2060 606c 6f63 616c  esult of ``local
+000173a0: 5f64 6674 6060 2077 696c 6c20 2a2a 4e4f  _dft`` will **NO
+000173b0: 542a 2a20 6265 2073 6869 6674 6564 2077  T** be shifted w
+000173c0: 6974 6820 0d0a 2020 2020 2020 2020 2020  ith ..          
+000173d0: 2020 2020 2020 6060 6e70 2e66 6674 2e66        ``np.fft.f
+000173e0: 6674 7368 6966 7460 6020 6265 6361 7573  ftshift`` becaus
+000173f0: 6520 696e 2067 656e 6572 616c 2074 6865  e in general the
+00017400: 2063 656e 7465 7220 6f66 2061 7272 6179   center of array
+00017410: 7320 6172 650d 0a20 2020 2020 2020 2020  s are..         
+00017420: 2020 2020 2020 2075 6e6b 6e6f 776e 2e20         unknown. 
+00017430: 416c 736f 2c20 6974 2069 7320 6561 7369  Also, it is easi
+00017440: 6572 2074 6f20 756e 6465 7273 7461 6e64  er to understand
+00017450: 2060 783d 3060 2063 6f72 7265 7370 6f6e   `x=0` correspon
+00017460: 6473 2074 6f20 7468 650d 0a20 2020 2020  ds to the..     
+00017470: 2020 2020 2020 2020 2020 2063 656e 7465             cente
+00017480: 722e 0d0a 2020 2020 2020 2020 0d0a 2020  r...        ..  
+00017490: 2020 2020 2020 4576 656e 2077 686f 6c65        Even whole
+000174a0: 2073 7065 6374 7275 6d20 6973 2072 6574   spectrum is ret
+000174b0: 7572 6e65 642c 2060 606c 6f63 616c 5f64  urned, ``local_d
+000174c0: 6674 6060 206d 6179 2062 6520 6661 7374  ft`` may be fast
+000174d0: 6572 2074 6861 6e20 4646 5420 7769 7468  er than FFT with
+000174e0: 200d 0a20 2020 2020 2020 2073 6d61 6c6c   ..        small
+000174f0: 2061 6e64 2f6f 7220 6e6f 6e2d 4646 542d   and/or non-FFT-
+00017500: 6672 6965 6e64 6c79 2073 6861 7065 6420  friendly shaped 
+00017510: 696d 6167 652e 0d0a 0d0a 2020 2020 2020  image.....      
+00017520: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00017530: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00017540: 0d0a 2020 2020 2020 2020 6b65 7920 3a20  ..        key : 
+00017550: 7374 720d 0a20 2020 2020 2020 2020 2020  str..           
+00017560: 204b 6579 2073 7472 696e 6720 7468 6174   Key string that
+00017570: 2073 7065 6369 6679 2072 6567 696f 6e20   specify region 
+00017580: 746f 2044 4654 2c20 7375 6368 2061 7320  to DFT, such as 
+00017590: 2279 3d2d 3530 3a31 303b 783d 3a38 3022  "y=-50:10;x=:80"
+000175a0: 2e20 5769 7468 0d0a 2020 2020 2020 2020  . With..        
+000175b0: 2020 2020 7570 7361 6d70 6c65 6420 7370      upsampled sp
+000175c0: 6563 7472 612c 206b 6579 7320 636f 7272  ectra, keys corr
+000175d0: 6573 706f 6e64 7320 746f 2074 6865 2063  esponds to the c
+000175e0: 6f6f 7264 696e 6174 6520 2a2a 6265 666f  oordinate **befo
+000175f0: 7265 2a2a 200d 0a20 2020 2020 2020 2020  re** ..         
+00017600: 2020 2075 702d 7361 6d70 6c69 6e67 2e20     up-sampling. 
+00017610: 4966 2079 6f75 2077 616e 7420 6365 7274  If you want cert
+00017620: 6169 6e20 7265 6769 6f6e 2c20 7361 7920  ain region, say 
+00017630: 2278 3d31 303a 3230 222c 2074 6869 7320  "x=10:20", this 
+00017640: 7661 6c75 6520 0d0a 2020 2020 2020 2020  value ..        
+00017650: 2020 2020 7769 6c6c 206e 6f74 2063 6861      will not cha
+00017660: 6e67 6520 7769 7468 2064 6966 6665 7265  nge with differe
+00017670: 6e74 2060 6075 7073 616d 706c 655f 6661  nt ``upsample_fa
+00017680: 6374 6f72 6060 2e0d 0a20 2020 2020 2020  ctor``...       
+00017690: 2075 7073 616d 706c 655f 6661 6374 6f72   upsample_factor
+000176a0: 203a 2069 6e74 206f 7220 6172 7261 7920   : int or array 
+000176b0: 6f66 2069 6e74 2c20 6465 6661 756c 7420  of int, default 
+000176c0: 6973 2031 0d0a 2020 2020 2020 2020 2020  is 1..          
+000176d0: 2020 5570 2d73 616d 706c 696e 6720 6661    Up-sampling fa
+000176e0: 6374 6f72 2e20 466f 7220 696e 7374 616e  ctor. For instan
+000176f0: 6365 2c20 7768 656e 2060 6075 7073 616d  ce, when ``upsam
+00017700: 706c 655f 6661 6374 6f72 3d31 3060 6020  ple_factor=10`` 
+00017710: 6120 7369 6e67 6c65 0d0a 2020 2020 2020  a single..      
+00017720: 2020 2020 2020 7069 7865 6c20 7769 6c6c        pixel will
+00017730: 2062 6520 6578 7061 6e64 6564 2074 6f20   be expanded to 
+00017740: 3130 2070 6978 656c 732e 0d0a 2020 2020  10 pixels...    
+00017750: 2020 2020 7b64 6f75 626c 655f 7072 6563      {double_prec
+00017760: 6973 696f 6e7d 0d0a 2020 2020 2020 2020  ision}..        
+00017770: 7b64 696d 737d 0d0a 0d0a 2020 2020 2020  {dims}....      
+00017780: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+00017790: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+000177a0: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
+000177b0: 2020 2020 2020 2020 2020 4446 5420 6f75            DFT ou
+000177c0: 7470 7574 2e0d 0a20 2020 2020 2020 200d  tput...        .
+000177d0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+000177e0: 6f0d 0a20 2020 2020 2020 202d 2d2d 2d2d  o..        -----
+000177f0: 2d2d 2d0d 0a20 2020 2020 2020 2066 6674  ---..        fft
+00017800: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00017810: 2020 2020 2020 206e 6469 6d20 3d20 6c65         ndim = le
+00017820: 6e28 6469 6d73 290d 0a20 2020 2020 2020  n(dims)..       
+00017830: 2075 7073 616d 706c 655f 6661 6374 6f72   upsample_factor
+00017840: 203d 2063 6865 636b 5f6e 6428 7570 7361   = check_nd(upsa
+00017850: 6d70 6c65 5f66 6163 746f 722c 206e 6469  mple_factor, ndi
+00017860: 6d29 0d0a 2020 2020 2020 2020 0d0a 2020  m)..        ..  
+00017870: 2020 2020 2020 2320 6465 7465 726d 696e        # determin
+00017880: 6520 686f 7720 746f 2073 6c69 6365 2074  e how to slice t
+00017890: 6865 2072 6573 756c 7420 6f66 2046 4654  he result of FFT
+000178a0: 0d0a 2020 2020 2020 2020 6966 206b 6579  ..        if key
+000178b0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000178c0: 2020 2020 2020 2073 6c69 6365 7320 3d20         slices = 
+000178d0: 2873 6c69 6365 284e 6f6e 6529 2c20 2920  (slice(None), ) 
+000178e0: 2a20 6e64 696d 0d0a 2020 2020 2020 2020  * ndim..        
+000178f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00017900: 2020 2073 6c69 6365 7320 3d20 736f 6c76     slices = solv
+00017910: 655f 736c 6963 6572 286b 6579 2c20 4178  e_slicer(key, Ax
+00017920: 6573 2864 696d 7329 290d 0a20 2020 2020  es(dims))..     
+00017930: 2020 2064 7479 7065 203d 206e 702e 636f     dtype = np.co
+00017940: 6d70 6c65 7831 3238 2069 6620 646f 7562  mplex128 if doub
+00017950: 6c65 5f70 7265 6369 7369 6f6e 2065 6c73  le_precision els
+00017960: 6520 6e70 2e63 6f6d 706c 6578 3634 0d0a  e np.complex64..
+00017970: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00017980: 2020 2320 4361 6c63 756c 6174 6520 6578    # Calculate ex
+00017990: 7028 2d69 6b78 290d 0a20 2020 2020 2020  p(-ikx)..       
+000179a0: 2023 2054 6f20 6d69 6e69 6d69 7a65 2066   # To minimize f
+000179b0: 6c6f 6174 696e 6720 6572 726f 722c 2074  loating error, t
+000179c0: 6865 2041 2074 6572 6d20 696e 2065 7870  he A term in exp
+000179d0: 282d 322a 7069 2a69 2a41 2920 7368 6f75  (-2*pi*i*A) shou
+000179e0: 6c64 2062 6520 696e 2074 6865 2072 616e  ld be in the ran
+000179f0: 6765 206f 6620 0d0a 2020 2020 2020 2020  ge of ..        
+00017a00: 2320 3020 3c3d 2041 203c 2031 2e0d 0a20  # 0 <= A < 1... 
+00017a10: 2020 2020 2020 2065 7870 733a 206c 6973         exps: lis
+00017a20: 745b 7870 2e6e 6461 7272 6179 5d20 3d20  t[xp.ndarray] = 
+00017a30: 5c0d 0a20 2020 2020 2020 2020 2020 205b  \..            [
+00017a40: 7870 2e65 7870 282d 326a 202a 206e 702e  xp.exp(-2j * np.
+00017a50: 7069 202a 2078 702e 6d6f 6428 7761 7665  pi * xp.mod(wave
+00017a60: 5f6e 756d 2873 6c2c 2073 2c20 7566 2920  _num(sl, s, uf) 
+00017a70: 2a20 7870 2e61 7261 6e67 6528 7329 2f73  * xp.arange(s)/s
+00017a80: 2c20 312e 292c 2064 7479 7065 3d64 7479  , 1.), dtype=dty
+00017a90: 7065 290d 0a20 2020 2020 2020 2020 2020  pe)..           
+00017aa0: 2020 666f 7220 736c 2c20 732c 2075 6620    for sl, s, uf 
+00017ab0: 696e 207a 6970 2873 6c69 6365 732c 2073  in zip(slices, s
+00017ac0: 656c 662e 7369 7a65 736f 6628 6469 6d73  elf.sizesof(dims
+00017ad0: 292c 2075 7073 616d 706c 655f 6661 6374  ), upsample_fact
+00017ae0: 6f72 295d 0d0a 2020 2020 2020 2020 0d0a  or)]..        ..
+00017af0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+00017b00: 6174 6520 6368 756e 6b20 7369 7a65 2066  ate chunk size f
+00017b10: 6f72 2070 726f 7065 7220 6f75 7470 7574  or proper output
+00017b20: 2073 6861 7065 730d 0a20 2020 2020 2020   shapes..       
+00017b30: 206f 7574 5f63 6875 6e6b 7320 3d20 6e70   out_chunks = np
+00017b40: 2e6f 6e65 7328 7365 6c66 2e6e 6469 6d2c  .ones(self.ndim,
+00017b50: 2064 7479 7065 3d6e 702e 696e 7436 3429   dtype=np.int64)
+00017b60: 0d0a 2020 2020 2020 2020 666f 7220 692c  ..        for i,
+00017b70: 2061 2069 6e20 656e 756d 6572 6174 6528   a in enumerate(
+00017b80: 6469 6d73 293a 0d0a 2020 2020 2020 2020  dims):..        
+00017b90: 2020 2020 696e 6420 3d20 7365 6c66 2e61      ind = self.a
+00017ba0: 7869 736f 6628 6129 0d0a 2020 2020 2020  xisof(a)..      
+00017bb0: 2020 2020 2020 6f75 745f 6368 756e 6b73        out_chunks
+00017bc0: 5b69 6e64 5d20 3d20 6578 7073 5b69 5d2e  [ind] = exps[i].
+00017bd0: 7368 6170 655b 305d 0d0a 2020 2020 2020  shape[0]..      
+00017be0: 2020 6f75 745f 6368 756e 6b73 203d 2074    out_chunks = t
+00017bf0: 7570 6c65 286f 7574 5f63 6875 6e6b 7329  uple(out_chunks)
+00017c00: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00017c10: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00017c20: 6173 5f66 6c6f 6174 2829 2e5f 6170 706c  as_float()._appl
+00017c30: 795f 6461 736b 280d 0a20 2020 2020 2020  y_dask(..       
+00017c40: 2020 2020 205f 6d69 7363 2e64 6674 2c20       _misc.dft, 
+00017c50: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00017c60: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
+00017c70: 6d73 2c20 7365 6c66 2e61 7865 7329 2c0d  ms, self.axes),.
+00017c80: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
+00017c90: 7065 3d6e 702e 636f 6d70 6c65 7836 342c  pe=np.complex64,
+00017ca0: 200d 0a20 2020 2020 2020 2020 2020 206f   ..            o
+00017cb0: 7574 5f63 6875 6e6b 733d 6f75 745f 6368  ut_chunks=out_ch
+00017cc0: 756e 6b73 2c0d 0a20 2020 2020 2020 2020  unks,..         
+00017cd0: 2020 206b 7761 7267 733d 6469 6374 2865     kwargs=dict(e
+00017ce0: 7870 733d 6578 7073 290d 0a20 2020 2020  xps=exps)..     
+00017cf0: 2020 2029 0d0a 2020 2020 0d0a 2020 2020     )..    ..    
+00017d00: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+00017d10: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+00017d20: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+00017d30: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
+00017d40: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
+00017d50: 6566 206c 6f63 616c 5f70 6f77 6572 5f73  ef local_power_s
+00017d60: 7065 6374 7261 280d 0a20 2020 2020 2020  pectra(..       
+00017d70: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+00017d80: 6b65 793a 2041 7865 7354 6172 6765 7465  key: AxesTargete
+00017d90: 6453 6c69 6365 7220 7c20 4e6f 6e65 203d  dSlicer | None =
+00017da0: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
+00017db0: 7570 7361 6d70 6c65 5f66 6163 746f 723a  upsample_factor:
+00017dc0: 206e 4449 6e74 203d 2031 2c0d 0a20 2020   nDInt = 1,..   
+00017dd0: 2020 2020 206e 6f72 6d3a 2062 6f6f 6c20       norm: bool 
+00017de0: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
+00017df0: 2020 2a2c 200d 0a20 2020 2020 2020 2064    *, ..        d
+00017e00: 6f75 626c 655f 7072 6563 6973 696f 6e3a  ouble_precision:
+00017e10: 2062 6f6f 6c20 3d20 4661 6c73 652c 0d0a   bool = False,..
+00017e20: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
+00017e30: 6d73 203d 204e 6f6e 650d 0a20 2020 2029  ms = None..    )
+00017e40: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
+00017e50: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00017e60: 2020 2020 5265 7475 726e 206c 6f63 616c      Return local
+00017e70: 206e 2d44 2070 6f77 6572 2073 7065 6374   n-D power spect
+00017e80: 7261 206f 6620 696d 6167 6573 2e20 5365  ra of images. Se
+00017e90: 6520 6060 6c6f 6361 6c5f 6466 7460 602e  e ``local_dft``.
+00017ea0: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
+00017eb0: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+00017ec0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00017ed0: 2020 2020 6b65 7920 3a20 7374 720d 0a20      key : str.. 
+00017ee0: 2020 2020 2020 2020 2020 204b 6579 2073             Key s
+00017ef0: 7472 696e 6720 7468 6174 2073 7065 6369  tring that speci
+00017f00: 6679 2072 6567 696f 6e20 746f 2044 4654  fy region to DFT
+00017f10: 2c20 7375 6368 2061 7320 2279 3d2d 3530  , such as "y=-50
+00017f20: 3a31 303b 783d 3a38 3022 2e20 5769 7468  :10;x=:80". With
+00017f30: 2055 7073 616d 706c 6564 2073 7065 6374   Upsampled spect
+00017f40: 7261 2c20 6b65 7973 0d0a 2020 2020 2020  ra, keys..      
+00017f50: 2020 2020 2020 636f 7272 6573 706f 6e64        correspond
+00017f60: 7320 746f 2074 6865 2063 6f6f 7264 696e  s to the coordin
+00017f70: 6174 6520 2a2a 6265 666f 7265 2a2a 2075  ate **before** u
+00017f80: 702d 7361 6d70 6c69 6e67 2e20 4966 2079  p-sampling. If y
+00017f90: 6f75 2077 616e 7420 6365 7274 6169 6e20  ou want certain 
+00017fa0: 7265 6769 6f6e 2c20 7361 7920 2278 3d31  region, say "x=1
+00017fb0: 303a 3230 222c 0d0a 2020 2020 2020 2020  0:20",..        
+00017fc0: 2020 2020 7468 6973 2076 616c 7565 2077      this value w
+00017fd0: 696c 6c20 6e6f 7420 6368 616e 6765 2077  ill not change w
+00017fe0: 6974 6820 6469 6666 6572 656e 7420 6060  ith different ``
+00017ff0: 7570 7361 6d70 6c65 5f66 6163 746f 7260  upsample_factor`
+00018000: 602e 0d0a 2020 2020 2020 2020 7570 7361  `...        upsa
+00018010: 6d70 6c65 5f66 6163 746f 7220 3a20 696e  mple_factor : in
+00018020: 7420 6f72 2061 7272 6179 206f 6620 696e  t or array of in
+00018030: 742c 2064 6566 6175 6c74 2069 7320 310d  t, default is 1.
+00018040: 0a20 2020 2020 2020 2020 2020 2055 702d  .            Up-
+00018050: 7361 6d70 6c69 6e67 2066 6163 746f 722e  sampling factor.
+00018060: 2046 6f72 2069 6e73 7461 6e63 652c 2077   For instance, w
+00018070: 6865 6e20 6060 7570 7361 6d70 6c65 5f66  hen ``upsample_f
+00018080: 6163 746f 723d 3130 6060 2061 2073 696e  actor=10`` a sin
+00018090: 676c 6520 7069 7865 6c20 7769 6c6c 2062  gle pixel will b
+000180a0: 6520 6578 7061 6e64 6564 2074 6f0d 0a20  e expanded to.. 
+000180b0: 2020 2020 2020 2020 2020 2031 3020 7069             10 pi
+000180c0: 7865 6c73 2e0d 0a20 2020 2020 2020 206e  xels...        n
+000180d0: 6f72 6d20 3a20 626f 6f6c 2c20 6465 6661  orm : bool, defa
+000180e0: 756c 7420 6973 2046 616c 7365 0d0a 2020  ult is False..  
+000180f0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00018100: 652c 206d 6178 696d 756d 2076 616c 7565  e, maximum value
+00018110: 206f 6620 706f 7765 7220 7370 6563 7472   of power spectr
+00018120: 6120 6973 2061 646a 7573 7465 6420 746f  a is adjusted to
+00018130: 2031 2e0d 0a20 2020 2020 2020 207b 646f   1...        {do
+00018140: 7562 6c65 5f70 7265 6369 7369 6f6e 7d0d  uble_precision}.
+00018150: 0a20 2020 2020 2020 207b 6469 6d73 7d0d  .        {dims}.
+00018160: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00018170: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
+00018180: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
+00018190: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
+000181a0: 2020 2050 6f77 6572 2073 7065 6374 7261     Power spectra
+000181b0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000181c0: 2020 2020 5365 6520 416c 736f 0d0a 2020      See Also..  
+000181d0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
+000181e0: 2020 2020 2020 2020 706f 7765 725f 7370          power_sp
+000181f0: 6563 7472 610d 0a20 2020 2020 2020 2022  ectra..        "
+00018200: 2222 2020 2020 2020 2020 0d0a 2020 2020  ""        ..    
+00018210: 2020 2020 6672 6571 203d 2073 656c 662e      freq = self.
+00018220: 6c6f 6361 6c5f 6466 7428 6b65 792c 2075  local_dft(key, u
+00018230: 7073 616d 706c 655f 6661 6374 6f72 3d75  psample_factor=u
+00018240: 7073 616d 706c 655f 6661 6374 6f72 2c20  psample_factor, 
+00018250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018270: 646f 7562 6c65 5f70 7265 6369 7369 6f6e  double_precision
+00018280: 3d64 6f75 626c 655f 7072 6563 6973 696f  =double_precisio
+00018290: 6e2c 2064 696d 733d 6469 6d73 290d 0a20  n, dims=dims).. 
+000182a0: 2020 2020 2020 2070 7720 3d20 6672 6571         pw = freq
+000182b0: 2e72 6561 6c2a 2a32 202b 2066 7265 712e  .real**2 + freq.
+000182c0: 696d 6167 2a2a 320d 0a20 2020 2020 2020  imag**2..       
+000182d0: 2069 6620 6e6f 726d 3a0d 0a20 2020 2020   if norm:..     
+000182e0: 2020 2020 2020 2070 7720 2f3d 2070 772e         pw /= pw.
+000182f0: 6d61 7828 290d 0a20 2020 2020 2020 2072  max()..        r
+00018300: 6574 7572 6e20 7077 0d0a 2020 2020 0d0a  eturn pw..    ..
+00018310: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
+00018320: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
+00018330: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
+00018340: 0d0a 2020 2020 4063 6865 636b 5f69 6e70  ..    @check_inp
+00018350: 7574 5f61 6e64 5f6f 7574 7075 740d 0a20  ut_and_output.. 
+00018360: 2020 2064 6566 2069 6666 7428 0d0a 2020     def ifft(..  
+00018370: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
+00018380: 2020 2020 2072 6561 6c3a 2062 6f6f 6c20       real: bool 
+00018390: 3d20 5472 7565 2c0d 0a20 2020 2020 2020  = True,..       
+000183a0: 202a 2c0d 0a20 2020 2020 2020 2073 6869   *,..        shi
+000183b0: 6674 3a20 626f 6f6c 203d 2054 7275 652c  ft: bool = True,
+000183c0: 0d0a 2020 2020 2020 2020 646f 7562 6c65  ..        double
+000183d0: 5f70 7265 6369 7369 6f6e 203d 2046 616c  _precision = Fal
+000183e0: 7365 2c20 0d0a 2020 2020 2020 2020 6469  se, ..        di
+000183f0: 6d73 3a20 4469 6d73 203d 204e 6f6e 650d  ms: Dims = None.
+00018400: 0a20 2020 2029 202d 3e20 496d 6741 7272  .    ) -> ImgArr
+00018410: 6179 3a0d 0a20 2020 2020 2020 2022 2222  ay:..        """
+00018420: 0d0a 2020 2020 2020 2020 4661 7374 2049  ..        Fast I
+00018430: 6e76 6572 7365 2046 6f75 7269 6572 2074  nverse Fourier t
+00018440: 7261 6e73 666f 726d 6174 696f 6e2e 2043  ransformation. C
+00018450: 6f6d 706c 656d 656e 7461 7279 2066 756e  omplementary fun
+00018460: 6374 696f 6e20 7769 7468 2060 6666 7428  ction with `fft(
+00018470: 2960 2e0d 0a20 2020 2020 2020 200d 0a20  )`...        .. 
+00018480: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00018490: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000184a0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2072  -----..        r
+000184b0: 6561 6c20 3a20 626f 6f6c 2c20 6465 6661  eal : bool, defa
+000184c0: 756c 7420 6973 2054 7275 650d 0a20 2020  ult is True..   
+000184d0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+000184e0: 2c20 6f6e 6c79 2074 6865 2072 6561 6c20  , only the real 
+000184f0: 7061 7274 2069 7320 7265 7475 726e 6564  part is returned
+00018500: 2e0d 0a20 2020 2020 2020 2073 6869 6674  ...        shift
+00018510: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00018520: 2069 7320 5472 7565 0d0a 2020 2020 2020   is True..      
+00018530: 2020 2020 2020 4966 2054 7275 652c 2063        If True, c
+00018540: 616c 6c20 6060 6e70 2e66 6674 2e69 6666  all ``np.fft.iff
+00018550: 7473 6869 6674 6060 2061 7420 7468 6520  tshift`` at the 
+00018560: 6669 7273 742e 0d0a 2020 2020 2020 2020  first...        
+00018570: 7b64 6f75 626c 655f 7072 6563 6973 696f  {double_precisio
+00018580: 6e7d 0d0a 2020 2020 2020 2020 7b64 696d  n}..        {dim
+00018590: 737d 0d0a 2020 2020 2020 2020 2020 2020  s}..            
+000185a0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000185b0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000185c0: 2d2d 0d0a 2020 2020 2020 2020 496d 6741  --..        ImgA
+000185d0: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
+000185e0: 2020 4946 4654 2069 6d61 6765 2e0d 0a20    IFFT image... 
+000185f0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00018600: 2020 2020 6178 6573 203d 205b 7365 6c66      axes = [self
+00018610: 2e61 7869 736f 6628 6129 2066 6f72 2061  .axisof(a) for a
+00018620: 2069 6e20 6469 6d73 5d0d 0a20 2020 2020   in dims]..     
+00018630: 2020 2069 6620 7368 6966 743a 0d0a 2020     if shift:..  
+00018640: 2020 2020 2020 2020 2020 6672 6571 203d            freq =
+00018650: 206e 702e 6666 742e 6966 6674 7368 6966   np.fft.ifftshif
+00018660: 7428 7365 6c66 2e76 616c 7565 2c20 6178  t(self.value, ax
+00018670: 6573 3d61 7865 7329 0d0a 2020 2020 2020  es=axes)..      
+00018680: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00018690: 2020 2020 2066 7265 7120 3d20 7365 6c66       freq = self
+000186a0: 2e76 616c 7565 0d0a 2020 2020 2020 2020  .value..        
+000186b0: 6474 7970 6520 3d20 6e70 2e63 6f6d 706c  dtype = np.compl
+000186c0: 6578 3132 3820 6966 2064 6f75 626c 655f  ex128 if double_
+000186d0: 7072 6563 6973 696f 6e20 656c 7365 206e  precision else n
+000186e0: 702e 636f 6d70 6c65 7836 340d 0a20 2020  p.complex64..   
+000186f0: 2020 2020 206f 7574 203d 2078 702e 6666       out = xp.ff
+00018700: 742e 6966 6674 6e28 0d0a 2020 2020 2020  t.ifftn(..      
+00018710: 2020 2020 2020 7870 2e61 7361 7272 6179        xp.asarray
+00018720: 2866 7265 712c 2064 7479 7065 3d64 7479  (freq, dtype=dty
+00018730: 7065 292c 200d 0a20 2020 2020 2020 2020  pe), ..         
+00018740: 2020 2061 7865 733d 6178 6573 0d0a 2020     axes=axes..  
+00018750: 2020 2020 2020 292e 6173 7479 7065 286e        ).astype(n
+00018760: 702e 636f 6d70 6c65 7836 3429 0d0a 2020  p.complex64)..  
+00018770: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00018780: 6966 2072 6561 6c3a 0d0a 2020 2020 2020  if real:..      
+00018790: 2020 2020 2020 6f75 7420 3d20 6e70 2e72        out = np.r
+000187a0: 6561 6c28 6f75 7429 0d0a 2020 2020 2020  eal(out)..      
+000187b0: 2020 7265 7475 726e 2078 702e 6173 6e75    return xp.asnu
+000187c0: 6d70 7928 6f75 7429 0d0a 2020 2020 0d0a  mpy(out)..    ..
+000187d0: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
+000187e0: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
+000187f0: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
+00018800: 0d0a 2020 2020 4063 6865 636b 5f69 6e70  ..    @check_inp
+00018810: 7574 5f61 6e64 5f6f 7574 7075 740d 0a20  ut_and_output.. 
+00018820: 2020 2064 6566 2070 6f77 6572 5f73 7065     def power_spe
+00018830: 6374 7261 280d 0a20 2020 2020 2020 2073  ctra(..        s
+00018840: 656c 662c 0d0a 2020 2020 2020 2020 7368  elf,..        sh
+00018850: 6170 653a 2069 6e74 207c 2049 7465 7261  ape: int | Itera
+00018860: 626c 655b 696e 745d 207c 2046 6674 5368  ble[int] | FftSh
+00018870: 6170 6520 3d20 2273 616d 6522 2c0d 0a20  ape = "same",.. 
+00018880: 2020 2020 2020 206e 6f72 6d3a 2062 6f6f         norm: boo
+00018890: 6c20 3d20 4661 6c73 652c 200d 0a20 2020  l = False, ..   
+000188a0: 2020 2020 207a 6572 6f5f 6e6f 726d 3a20       zero_norm: 
+000188b0: 626f 6f6c 203d 2046 616c 7365 2c20 2a2c  bool = False, *,
+000188c0: 0d0a 2020 2020 2020 2020 646f 7562 6c65  ..        double
+000188d0: 5f70 7265 6369 7369 6f6e 3a20 626f 6f6c  _precision: bool
+000188e0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+000188f0: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
+00018900: 4e6f 6e65 0d0a 2020 2020 2920 2d3e 2049  None..    ) -> I
+00018910: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
+00018920: 2020 2222 220d 0a20 2020 2020 2020 2052    """..        R
+00018930: 6574 7572 6e20 6e2d 4420 706f 7765 7220  eturn n-D power 
+00018940: 7370 6563 7472 6120 6f66 2069 6d61 6765  spectra of image
+00018950: 732c 2077 6869 6368 2069 7320 6465 6669  s, which is defi
+00018960: 6e65 6420 6173 3a0d 0a20 2020 2020 2020  ned as:..       
+00018970: 200d 0a20 2020 2020 2020 202e 2e20 6d61   ..        .. ma
+00018980: 7468 3a3a 0d0a 2020 2020 2020 2020 0d0a  th::..        ..
+00018990: 2020 2020 2020 2020 2020 2020 5020 3d20              P = 
+000189a0: 5265 2846 5b49 5f7b 696d 677d 5d29 5e32  Re(F[I_{img}])^2
+000189b0: 202b 2049 6d28 465b 495f 7b69 6d67 7d5d   + Im(F[I_{img}]
+000189c0: 295e 320d 0a0d 0a20 2020 2020 2020 2050  )^2....        P
+000189d0: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+000189e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+000189f0: 2020 2020 2020 2073 6861 7065 203a 2069         shape : i
+00018a00: 6e74 2c20 6974 6572 6162 6c65 206f 6620  nt, iterable of 
+00018a10: 696e 742c 2022 7371 7561 7265 2220 6f72  int, "square" or
+00018a20: 2022 7361 6d65 220d 0a20 2020 2020 2020   "same"..       
+00018a30: 2020 2020 204f 7574 7075 7420 7368 6170       Output shap
+00018a40: 652e 2049 6e70 7574 2069 6d61 6765 2069  e. Input image i
+00018a50: 7320 7061 6464 6564 206f 7220 6372 6f70  s padded or crop
+00018a60: 7065 6420 6163 636f 7264 696e 6720 746f  ped according to
+00018a70: 2074 6869 7320 7661 6c75 653a 0d0a 2020   this value:..  
+00018a80: 2020 2020 2020 2020 2020 2d20 696e 7465            - inte
+00018a90: 6765 7273 3a20 7061 6464 6564 206f 7220  gers: padded or 
+00018aa0: 6372 6f70 7065 6420 746f 2074 6865 2073  cropped to the s
+00018ab0: 7065 6369 6669 6564 2073 6861 7065 2e0d  pecified shape..
+00018ac0: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+00018ad0: 7371 7561 7265 223a 2070 6164 6465 6420  square": padded 
+00018ae0: 746f 2073 6d61 6c6c 6573 7420 325e 4e2d  to smallest 2^N-
+00018af0: 6c6f 6e67 2073 7175 6172 652e 0d0a 2020  long square...  
+00018b00: 2020 2020 2020 2020 2020 2d20 2273 616d            - "sam
+00018b10: 6522 2028 6465 6661 756c 7429 3a20 6e6f  e" (default): no
+00018b20: 2070 6164 6469 6e67 206f 7220 6372 6f70   padding or crop
+00018b30: 7069 6e67 2e0d 0a20 2020 2020 2020 206e  ping...        n
+00018b40: 6f72 6d20 3a20 626f 6f6c 2c20 6465 6661  orm : bool, defa
+00018b50: 756c 7420 6973 2046 616c 7365 0d0a 2020  ult is False..  
+00018b60: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00018b70: 652c 206d 6178 696d 756d 2076 616c 7565  e, maximum value
+00018b80: 206f 6620 706f 7765 7220 7370 6563 7472   of power spectr
+00018b90: 6120 6973 2061 646a 7573 7465 6420 746f  a is adjusted to
+00018ba0: 2031 2e0d 0a20 2020 2020 2020 207b 646f   1...        {do
+00018bb0: 7562 6c65 5f70 7265 6369 7369 6f6e 7d0d  uble_precision}.
+00018bc0: 0a20 2020 2020 2020 207b 6469 6d73 7d0d  .        {dims}.
+00018bd0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00018be0: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
+00018bf0: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
+00018c00: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
+00018c10: 2020 2050 6f77 6572 2073 7065 6374 7261     Power spectra
+00018c20: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00018c30: 2020 2020 5365 6520 416c 736f 0d0a 2020      See Also..  
+00018c40: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
+00018c50: 2020 2020 2020 2020 6c6f 6361 6c5f 706f          local_po
+00018c60: 7765 725f 7370 6563 7472 610d 0a20 2020  wer_spectra..   
+00018c70: 2020 2020 2022 2222 2020 2020 2020 2020       """        
+00018c80: 0d0a 2020 2020 2020 2020 6672 6571 203d  ..        freq =
+00018c90: 2073 656c 662e 6666 7428 6469 6d73 3d64   self.fft(dims=d
+00018ca0: 696d 732c 2073 6861 7065 3d73 6861 7065  ims, shape=shape
+00018cb0: 2c20 646f 7562 6c65 5f70 7265 6369 7369  , double_precisi
+00018cc0: 6f6e 3d64 6f75 626c 655f 7072 6563 6973  on=double_precis
+00018cd0: 696f 6e29 0d0a 2020 2020 2020 2020 7077  ion)..        pw
+00018ce0: 203d 2066 7265 712e 7265 616c 2a2a 3220   = freq.real**2 
+00018cf0: 2b20 6672 6571 2e69 6d61 672a 2a32 0d0a  + freq.imag**2..
+00018d00: 2020 2020 2020 2020 6966 206e 6f72 6d3a          if norm:
+00018d10: 0d0a 2020 2020 2020 2020 2020 2020 7077  ..            pw
+00018d20: 202f 3d20 7077 2e6d 6178 2829 0d0a 2020   /= pw.max()..  
+00018d30: 2020 2020 2020 7077 3a20 496d 6741 7272        pw: ImgArr
+00018d40: 6179 0d0a 2020 2020 2020 2020 6966 207a  ay..        if z
+00018d50: 6572 6f5f 6e6f 726d 3a0d 0a20 2020 2020  ero_norm:..     
+00018d60: 2020 2020 2020 2073 6c20 3d20 7377 6974         sl = swit
+00018d70: 6368 5f73 6c69 6365 2864 696d 732c 2070  ch_slice(dims, p
+00018d80: 772e 6178 6573 2c20 6966 696e 3d6e 702e  w.axes, ifin=np.
+00018d90: 6172 7261 7928 7077 2e73 6861 7065 292f  array(pw.shape)/
+00018da0: 2f32 2c20 6966 6e6f 743d 736c 6963 6528  /2, ifnot=slice(
+00018db0: 4e6f 6e65 2929 0d0a 2020 2020 2020 2020  None))..        
+00018dc0: 2020 2020 7077 5b73 6c5d 203d 2030 0d0a      pw[sl] = 0..
+00018dd0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+00018de0: 770d 0a0d 0a20 2020 2040 5f64 6f63 732e  w....    @_docs.
+00018df0: 7772 6974 655f 646f 6373 0d0a 2020 2020  write_docs..    
+00018e00: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
+00018e10: 5f61 7865 730d 0a20 2020 2064 6566 2072  _axes..    def r
+00018e20: 6164 6f6e 280d 0a20 2020 2020 2020 2073  adon(..        s
+00018e30: 656c 662c 0d0a 2020 2020 2020 2020 6465  elf,..        de
+00018e40: 6772 6565 733a 2066 6c6f 6174 207c 2049  grees: float | I
+00018e50: 7465 7261 626c 655b 666c 6f61 745d 2c20  terable[float], 
+00018e60: 0d0a 2020 2020 2020 2020 2a2c 0d0a 2020  ..        *,..  
+00018e70: 2020 2020 2020 6365 6e74 7261 6c5f 6178        central_ax
+00018e80: 6973 3a20 4178 6973 4c69 6b65 207c 2053  is: AxisLike | S
+00018e90: 6571 7565 6e63 655b 666c 6f61 745d 207c  equence[float] |
+00018ea0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0d 0a20   None = None,.. 
+00018eb0: 2020 2020 2020 206f 7264 6572 3a20 696e         order: in
+00018ec0: 7420 3d20 332c 0d0a 2020 2020 2020 2020  t = 3,..        
+00018ed0: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+00018ee0: 652c 0d0a 2020 2020 2920 2d3e 2049 6d67  e,..    ) -> Img
+00018ef0: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
+00018f00: 2222 220d 0a20 2020 2020 2020 2044 6973  """..        Dis
+00018f10: 6372 6574 6520 5261 646f 6e20 7472 616e  crete Radon tran
+00018f20: 7366 6f72 6d61 7469 6f6e 206f 6620 3244  sformation of 2D
+00018f30: 206f 7220 3344 2069 6d61 6765 2e0d 0a20   or 3D image... 
+00018f40: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00018f50: 2052 6164 6f6e 2074 7261 6e73 666f 726d   Radon transform
+00018f60: 6174 696f 6e20 6973 2061 206c 6973 7420  ation is a list 
+00018f70: 6f66 2070 726f 6a65 6374 696f 6e20 6f66  of projection of
+00018f80: 2061 2073 616d 6520 696d 6167 6520 6672   a same image fr
+00018f90: 6f6d 2064 6966 6665 7265 6e74 2061 6e67  om different ang
+00018fa0: 6c65 732e 0d0a 2020 2020 2020 2020 4974  les...        It
+00018fb0: 2067 656e 6572 6174 6573 2074 6f6d 6f67   generates tomog
+00018fc0: 7261 7068 6963 206e 2d44 2069 6d61 6765  raphic n-D image
+00018fd0: 2073 6c69 6365 7320 6672 6f6d 2028 6e2b   slices from (n+
+00018fe0: 3129 2d44 2069 6d61 6765 2e0d 0a0d 0a20  1)-D image..... 
+00018ff0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00019000: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00019010: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2064  -----..        d
+00019020: 6567 7265 6573 203a 2066 6c6f 6174 206f  egrees : float o
+00019030: 7220 6974 6572 6162 6c65 206f 6620 666c  r iterable of fl
+00019040: 6f61 740d 0a20 2020 2020 2020 2020 2020  oat..           
+00019050: 2052 6f74 6174 696f 6e20 616e 676c 6573   Rotation angles
+00019060: 2061 726f 756e 6420 7468 6520 6365 6e74   around the cent
+00019070: 7261 6c20 6178 6973 2069 6e20 6465 6772  ral axis in degr
+00019080: 6565 732e 0d0a 2020 2020 2020 2020 6365  ees...        ce
+00019090: 6e74 7261 6c5f 6178 6973 203a 2061 7869  ntral_axis : axi
+000190a0: 732d 6c69 6b65 206f 7220 7365 7175 656e  s-like or sequen
+000190b0: 6365 206f 6620 666c 6f61 742c 206f 7074  ce of float, opt
+000190c0: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
+000190d0: 2020 2056 6563 746f 7220 7468 6174 2064     Vector that d
+000190e0: 6566 696e 6573 2074 6865 2063 656e 7472  efines the centr
+000190f0: 616c 2061 7869 7320 6f66 2072 6f74 6174  al axis of rotat
+00019100: 696f 6e2e 0d0a 2020 2020 2020 2020 7b6f  ion...        {o
+00019110: 7264 6572 7d7b 6469 6d73 7d0d 0a0d 0a20  rder}{dims}.... 
+00019120: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
+00019130: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
+00019140: 0a20 2020 2020 2020 2049 6d67 4172 7261  .        ImgArra
+00019150: 790d 0a20 2020 2020 2020 2020 2020 2054  y..            T
+00019160: 6f6d 6f67 7261 7068 6963 2069 6d61 6765  omographic image
+00019170: 2073 6c69 6365 732e 2054 6865 2066 6972   slices. The fir
+00019180: 7374 2073 7061 7469 616c 2061 7869 7320  st spatial axis 
+00019190: 2822 7a22 2066 6f72 207a 7978 2d69 6d61  ("z" for zyx-ima
+000191a0: 6765 2920 7769 6c6c 2062 6520 6472 6f70  ge) will be drop
+000191b0: 7065 642e 0d0a 2020 2020 2020 2020 2020  ped...          
+000191c0: 2020 4966 2073 6571 7565 6e63 6520 6f66    If sequence of
+000191d0: 2066 6c6f 6174 2069 7320 6769 7665 6e20   float is given 
+000191e0: 6173 2060 6064 6567 7265 6573 6060 2c20  as ``degrees``, 
+000191f0: 2264 6567 7265 6522 2061 7869 7320 7769  "degree" axis wi
+00019200: 6c6c 2062 6520 6e65 776c 7920 6164 6465  ll be newly adde
+00019210: 6420 6174 0d0a 2020 2020 2020 2020 2020  d at..          
+00019220: 2020 7468 6520 706f 7369 7469 6f6e 2030    the position 0
+00019230: 2e20 466f 7220 696e 7374 616e 6365 2c20  . For instance, 
+00019240: 6966 2061 207a 7978 2d69 6d61 6765 2061  if a zyx-image a
+00019250: 6e64 2060 6064 6567 7265 6573 3d6e 702e  nd ``degrees=np.
+00019260: 6c69 6e73 7061 6365 2830 2c20 3138 302c  linspace(0, 180,
+00019270: 2031 3030 2960 600d 0a20 2020 2020 2020   100)``..       
+00019280: 2020 2020 2061 7265 2067 6976 656e 2c20       are given, 
+00019290: 7265 7475 726e 6564 2069 6d61 6765 2068  returned image h
+000192a0: 6173 2061 7865 7320 5b22 6465 6772 6565  as axes ["degree
+000192b0: 222c 2022 7922 2c20 2278 225d 2e0d 0a20  ", "y", "x"]... 
+000192c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000192d0: 2053 6565 2041 6c73 6f0d 0a20 2020 2020   See Also..     
+000192e0: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
+000192f0: 2020 2020 2069 7261 646f 6e0d 0a20 2020       iradon..   
+00019300: 2020 2020 2022 2222 2020 2020 2020 2020       """        
+00019310: 0d0a 2020 2020 2020 2020 6672 6f6d 2064  ..        from d
+00019320: 6173 6b20 696d 706f 7274 2061 7272 6179  ask import array
+00019330: 2061 7320 6461 2c20 6465 6c61 7965 640d   as da, delayed.
+00019340: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00019350: 2020 2070 6172 616d 732c 206f 7574 7075     params, outpu
+00019360: 745f 7368 6170 652c 2073 7175 6565 7a65  t_shape, squeeze
+00019370: 203d 205f 7472 616e 7366 6f72 6d2e 6e6f   = _transform.no
+00019380: 726d 616c 697a 655f 7261 646f 6e5f 696e  rmalize_radon_in
+00019390: 7075 7428 0d0a 2020 2020 2020 2020 2020  put(..          
+000193a0: 2020 7365 6c66 2c20 6469 6d73 2c20 6365    self, dims, ce
+000193b0: 6e74 7261 6c5f 6178 6973 2c20 6465 6772  ntral_axis, degr
+000193c0: 6565 730d 0a20 2020 2020 2020 2029 0d0a  ees..        )..
+000193d0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000193e0: 2020 2320 6170 706c 7920 7370 6c69 6e65    # apply spline
+000193f0: 2066 696c 7465 7220 696e 2061 6476 616e   filter in advan
+00019400: 6365 2e0d 0a20 2020 2020 2020 2069 6e70  ce...        inp
+00019410: 7574 203d 2073 656c 662e 6173 5f66 6c6f  ut = self.as_flo
+00019420: 6174 2829 2e73 706c 696e 655f 6669 6c74  at().spline_filt
+00019430: 6572 286f 7264 6572 3d6f 7264 6572 290d  er(order=order).
+00019440: 0a20 2020 2020 2020 2064 656c 6179 6564  .        delayed
+00019450: 5f66 756e 6320 3d20 6465 6c61 7965 6428  _func = delayed(
+00019460: 5f74 7261 6e73 666f 726d 2e72 6164 6f6e  _transform.radon
+00019470: 5f73 696e 676c 6529 0d0a 2020 2020 2020  _single)..      
+00019480: 2020 7461 736b 7320 3d20 5b0d 0a20 2020    tasks = [..   
+00019490: 2020 2020 2020 2020 2064 656c 6179 6564           delayed
+000194a0: 5f66 756e 6328 696e 7075 742c 2070 2c20  _func(input, p, 
+000194b0: 6f72 6465 723d 6f72 6465 722c 206f 7574  order=order, out
+000194c0: 7075 745f 7368 6170 653d 6f75 7470 7574  put_shape=output
+000194d0: 5f73 6861 7065 2920 0d0a 2020 2020 2020  _shape) ..      
+000194e0: 2020 2020 2020 666f 7220 7020 696e 2070        for p in p
+000194f0: 6172 616d 730d 0a20 2020 2020 2020 205d  arams..        ]
+00019500: 0d0a 2020 2020 2020 2020 6f75 7420 3d20  ..        out = 
+00019510: 7870 2e73 7461 636b 2864 612e 636f 6d70  xp.stack(da.comp
+00019520: 7574 6528 7461 736b 7329 5b30 5d2c 2061  ute(tasks)[0], a
+00019530: 7869 733d 3029 0d0a 0d0a 2020 2020 2020  xis=0)....      
+00019540: 2020 6f75 7420 3d20 7870 2e61 736e 756d    out = xp.asnum
+00019550: 7079 286f 7574 292e 7669 6577 2873 656c  py(out).view(sel
+00019560: 662e 5f5f 636c 6173 735f 5f29 0d0a 2020  f.__class__)..  
+00019570: 2020 2020 2020 6f75 742e 5f73 6574 5f69        out._set_i
+00019580: 6e66 6f28 7365 6c66 2c20 7365 6c66 2e61  nfo(self, self.a
+00019590: 7865 732e 6472 6f70 2830 292e 696e 7365  xes.drop(0).inse
+000195a0: 7274 2830 2c20 2264 6567 7265 6522 2929  rt(0, "degree"))
+000195b0: 0d0a 2020 2020 2020 2020 6f75 742e 6178  ..        out.ax
+000195c0: 6573 5b30 5d2e 6c61 6265 6c73 203d 206c  es[0].labels = l
+000195d0: 6973 7428 6465 6772 6565 7329 0d0a 2020  ist(degrees)..  
+000195e0: 2020 2020 2020 6966 2073 7175 6565 7a65        if squeeze
+000195f0: 3a0d 0a20 2020 2020 2020 2020 2020 206f  :..            o
+00019600: 7574 203d 206f 7574 5b30 5d0d 0a20 2020  ut = out[0]..   
+00019610: 2020 2020 2072 6574 7572 6e20 6f75 740d       return out.
+00019620: 0a20 2020 200d 0a20 2020 2040 5f64 6f63  .    ..    @_doc
+00019630: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
+00019640: 2020 6465 6620 6972 6164 6f6e 280d 0a20    def iradon(.. 
+00019650: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
+00019660: 2020 2020 2020 6465 6772 6565 733a 2053        degrees: S
+00019670: 6571 7565 6e63 655b 666c 6f61 745d 2c0d  equence[float],.
+00019680: 0a20 2020 2020 2020 202a 2c0d 0a20 2020  .        *,..   
+00019690: 2020 2020 2063 656e 7472 616c 5f61 7869       central_axi
+000196a0: 733a 2041 7869 734c 696b 6520 3d20 2279  s: AxisLike = "y
+000196b0: 222c 0d0a 2020 2020 2020 2020 6465 6772  ",..        degr
+000196c0: 6565 5f61 7869 733a 2041 7869 734c 696b  ee_axis: AxisLik
+000196d0: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+000196e0: 0d0a 2020 2020 2020 2020 6865 6967 6874  ..        height
+000196f0: 5f61 7869 733a 2041 7869 734c 696b 6520  _axis: AxisLike 
+00019700: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0d0a  | None = None,..
+00019710: 2020 2020 2020 2020 6865 6967 6874 3a20          height: 
+00019720: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
+00019730: 652c 0d0a 2020 2020 2020 2020 7769 6e64  e,..        wind
+00019740: 6f77 3a20 7374 7220 3d20 2268 616d 6d69  ow: str = "hammi
+00019750: 6e67 222c 0d0a 2020 2020 2020 2020 6f72  ng",..        or
+00019760: 6465 723a 2069 6e74 203d 2033 2c0d 0a20  der: int = 3,.. 
+00019770: 2020 2029 202d 3e20 496d 6741 7272 6179     ) -> ImgArray
+00019780: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00019790: 2020 2020 2020 2020 496e 7665 7273 6520          Inverse 
+000197a0: 5261 646f 6e20 7472 616e 7366 6f72 6d61  Radon transforma
+000197b0: 7469 6f6e 2028 7765 6967 6874 6564 2062  tion (weighted b
+000197c0: 6163 6b20 7072 6f6a 6563 7469 6f6e 2920  ack projection) 
+000197d0: 6f66 2061 2074 696c 6520 7365 7269 6573  of a tile series
+000197e0: 2e0d 0a20 2020 2020 2020 200d 0a20 2020  ...        ..   
+000197f0: 2020 2020 2049 6e70 7574 2061 7272 6179       Input array
+00019800: 206d 7573 7420 6265 2061 2074 696c 7420   must be a tilt 
+00019810: 7365 7269 6573 206f 6620 3144 206f 7220  series of 1D or 
+00019820: 3244 2069 6d61 6765 732e 2054 6865 7920  2D images. They 
+00019830: 6172 6520 6261 636b 2d0d 0a20 2020 2020  are back-..     
+00019840: 2020 2070 726f 6a65 6374 6564 2069 6e74     projected int
+00019850: 6f20 6120 3244 206f 7220 3344 2069 6d61  o a 2D or 3D ima
+00019860: 6765 2077 6974 6820 6172 6269 7472 6172  ge with arbitrar
+00019870: 7920 6865 6967 6874 2e0d 0a0d 0a20 2020  y height.....   
+00019880: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
+00019890: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000198a0: 2d2d 2d0d 0a20 2020 2020 2020 2064 6567  ---..        deg
+000198b0: 7265 6573 203a 2073 6571 7565 6e63 6520  rees : sequence 
+000198c0: 6f66 2066 6c6f 6174 0d0a 2020 2020 2020  of float..      
+000198d0: 2020 2020 2020 5072 6f6a 6563 7469 6f6e        Projection
+000198e0: 2061 6e67 6c65 7320 696e 2064 6567 7265   angles in degre
+000198f0: 652e 204c 656e 6774 6820 6d75 7374 206d  e. Length must m
+00019900: 6174 6368 2074 6865 206c 656e 6774 6820  atch the length 
+00019910: 6f66 2074 6865 2064 6567 7265 650d 0a20  of the degree.. 
+00019920: 2020 2020 2020 2020 2020 2061 7869 7320             axis 
+00019930: 6f66 2074 6865 2069 6e70 7574 2069 6d61  of the input ima
+00019940: 6765 2e0d 0a20 2020 2020 2020 2063 656e  ge...        cen
+00019950: 7472 616c 5f61 7869 7320 3a20 4178 6973  tral_axis : Axis
+00019960: 4c69 6b65 2c20 6f70 7469 6f6e 616c 0d0a  Like, optional..
+00019970: 2020 2020 2020 2020 2020 2020 4178 6973              Axis
+00019980: 2070 6172 616c 6c65 6c20 746f 2074 6865   parallel to the
+00019990: 2072 6f74 6174 696f 6e20 6178 6973 2e0d   rotation axis..
+000199a0: 0a20 2020 2020 2020 2064 6567 7265 655f  .        degree_
+000199b0: 6178 6973 203a 2041 7869 734c 696b 652c  axis : AxisLike,
+000199c0: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
+000199d0: 2020 2020 2020 2041 7869 7320 6f66 2072         Axis of r
+000199e0: 6f74 6174 696f 6e20 6465 6772 6565 2e20  otation degree. 
+000199f0: 4279 2064 6566 6175 6c74 2c20 7468 6520  By default, the 
+00019a00: 6669 7273 7420 6178 6973 2077 696c 6c20  first axis will 
+00019a10: 6265 2075 7365 642e 0d0a 2020 2020 2020  be used...      
+00019a20: 2020 6865 6967 6874 5f61 7869 7320 3a20    height_axis : 
+00019a30: 4178 6973 4c69 6b65 2c20 6f70 7469 6f6e  AxisLike, option
+00019a40: 616c 0d0a 2020 2020 2020 2020 2020 2020  al..            
+00019a50: 4178 6973 2074 6861 7420 7769 6c6c 2062  Axis that will b
+00019a60: 6520 7573 6564 2074 6f20 6c61 6265 6c20  e used to label 
+00019a70: 7468 6520 6e65 7720 6178 6973 2061 6674  the new axis aft
+00019a80: 6572 2072 6563 6f6e 7374 7275 6374 696f  er reconstructio
+00019a90: 6e2e 2046 6f72 0d0a 2020 2020 2020 2020  n. For..        
+00019aa0: 2020 2020 696e 7374 616e 6365 2c20 6966      instance, if
+00019ab0: 2069 6e70 7574 2069 6d61 6765 2068 6173   input image has
+00019ac0: 2061 7865 7320 6060 5b22 6465 6772 6565   axes ``["degree
+00019ad0: 222c 2022 7922 2c20 2278 225d 6060 2061  ", "y", "x"]`` a
+00019ae0: 6e64 200d 0a20 2020 2020 2020 2020 2020  nd ..           
+00019af0: 2060 6068 6569 6768 745f 6178 6973 3d22   ``height_axis="
+00019b00: 7a22 6060 2074 6865 6e20 7265 636f 6e73  z"`` then recons
+00019b10: 7472 7563 7465 6420 696d 6167 6520 7769  tructed image wi
+00019b20: 6c6c 2068 6176 6520 6178 6573 200d 0a20  ll have axes .. 
+00019b30: 2020 2020 2020 2020 2020 2060 605b 227a             ``["z
+00019b40: 222c 2022 7922 2c20 2278 225d 6060 2e20  ", "y", "x"]``. 
+00019b50: 4279 2064 6566 6175 6c74 2c20 2279 2220  By default, "y" 
+00019b60: 7769 6c6c 2062 6520 7573 6564 2066 6f72  will be used for
+00019b70: 2032 4420 696e 7075 7420 6f72 2022 7a22   2D input or "z"
+00019b80: 2066 6f72 0d0a 2020 2020 2020 2020 2020   for..          
+00019b90: 2020 3344 2069 6e70 7574 2e0d 0a20 2020    3D input...   
+00019ba0: 2020 2020 2068 6569 6768 7420 3a20 696e       height : in
+00019bb0: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
+00019bc0: 2020 2020 2020 2020 2048 6569 6768 7420           Height 
+00019bd0: 6f66 2072 6563 6f6e 7374 7275 6374 696f  of reconstructio
+00019be0: 6e2e 2042 7920 6465 6661 756c 742c 2073  n. By default, s
+00019bf0: 697a 6520 6571 7561 6c20 746f 2074 6865  ize equal to the
+00019c00: 2061 7869 7320 7065 7270 656e 6469 6375   axis perpendicu
+00019c10: 6c61 720d 0a20 2020 2020 2020 2020 2020  lar..           
+00019c20: 2074 6f20 7468 6520 726f 7461 7469 6f6e   to the rotation
+00019c30: 2061 7869 7320 7769 6c6c 2062 6520 7573   axis will be us
+00019c40: 6564 2e0d 0a20 2020 2020 2020 2077 696e  ed...        win
+00019c50: 646f 7720 3a20 7374 722c 2064 6566 6175  dow : str, defau
+00019c60: 6c74 2069 7320 2268 616d 6d69 6e67 220d  lt is "hamming".
+00019c70: 0a20 2020 2020 2020 2020 2020 2057 696e  .            Win
+00019c80: 646f 7720 6675 6e63 7469 6f6e 2074 6861  dow function tha
+00019c90: 7420 7769 6c6c 2062 6520 6170 706c 6965  t will be applie
+00019ca0: 6420 746f 2074 6865 2046 6f75 7269 6572  d to the Fourier
+00019cb0: 2064 6f6d 6169 6e20 616c 6f6e 6720 7468   domain along th
+00019cc0: 6520 6178 6973 0d0a 2020 2020 2020 2020  e axis..        
+00019cd0: 2020 2020 7065 7270 656e 6469 6375 6c61      perpendicula
+00019ce0: 7220 746f 2074 6865 2072 6f74 6174 696f  r to the rotatio
+00019cf0: 6e20 6178 6973 2e0d 0a20 2020 2020 2020  n axis...       
+00019d00: 207b 6f72 6465 727d 0d0a 0d0a 2020 2020   {order}....    
+00019d10: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00019d20: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+00019d30: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
+00019d40: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
+00019d50: 6e73 7472 7563 7469 6f6e 2e0d 0a20 2020  nstruction...   
+00019d60: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00019d70: 2020 2053 6565 2041 6c73 6f0d 0a20 2020     See Also..   
+00019d80: 2020 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20       --------.. 
+00019d90: 2020 2020 2020 2072 6164 6f6e 0d0a 2020         radon..  
+00019da0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00019db0: 2020 2069 6e74 6572 7020 3d20 7b30 3a20     interp = {0: 
+00019dc0: 226e 6561 7265 7374 222c 2031 3a20 226c  "nearest", 1: "l
+00019dd0: 696e 6561 7222 2c20 333a 2022 6375 6269  inear", 3: "cubi
+00019de0: 6322 7d5b 6f72 6465 725d 0d0a 2020 2020  c"}[order]..    
+00019df0: 2020 2020 6365 6e74 7261 6c5f 6178 6973      central_axis
+00019e00: 2c20 6465 6772 6565 5f61 7869 732c 206f  , degree_axis, o
+00019e10: 7574 7075 745f 7368 6170 652c 206e 6577  utput_shape, new
+00019e20: 5f61 7865 7320 3d20 5f74 7261 6e73 666f  _axes = _transfo
+00019e30: 726d 2e6e 6f72 6d61 6c69 7a65 5f69 7261  rm.normalize_ira
+00019e40: 646f 6e5f 696e 7075 7428 0d0a 2020 2020  don_input(..    
+00019e50: 2020 2020 2020 2020 7365 6c66 2c20 6365          self, ce
+00019e60: 6e74 7261 6c5f 6178 6973 2c20 6865 6967  ntral_axis, heig
+00019e70: 6874 5f61 7869 732c 2064 6567 7265 655f  ht_axis, degree_
+00019e80: 6178 6973 2c20 6865 6967 6874 0d0a 2020  axis, height..  
+00019e90: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00019ea0: 2073 656c 663a 2049 6d67 4172 7261 7920   self: ImgArray 
+00019eb0: 3d20 6e70 2e6d 6f76 6561 7869 7328 7365  = np.moveaxis(se
+00019ec0: 6c66 2c20 7365 6c66 2e61 7869 736f 6628  lf, self.axisof(
+00019ed0: 6465 6772 6565 5f61 7869 7329 2c20 2d31  degree_axis), -1
+00019ee0: 290d 0a20 2020 2020 2020 2066 696c 7465  )..        filte
+00019ef0: 725f 6675 6e63 203d 205f 7472 616e 7366  r_func = _transf
+00019f00: 6f72 6d2e 6765 745f 666f 7572 6965 725f  orm.get_fourier_
+00019f10: 6669 6c74 6572 2873 656c 662e 7368 6170  filter(self.shap
+00019f20: 655b 2d32 5d2c 2077 696e 646f 7729 0d0a  e[-2], window)..
+00019f30: 2020 2020 2020 2020 6f75 7420 3d20 7365          out = se
+00019f40: 6c66 2e5f 6170 706c 795f 6461 736b 280d  lf._apply_dask(.
+00019f50: 0a20 2020 2020 2020 2020 2020 205f 7472  .            _tr
+00019f60: 616e 7366 6f72 6d2e 6972 6164 6f6e 2c0d  ansform.iradon,.
+00019f70: 0a20 2020 2020 2020 2020 2020 2063 5f61  .            c_a
+00019f80: 7865 733d 5b63 656e 7472 616c 5f61 7869  xes=[central_axi
+00019f90: 735d 2c0d 0a20 2020 2020 2020 2020 2020  s],..           
+00019fa0: 206b 7761 7267 733d 6469 6374 280d 0a20   kwargs=dict(.. 
+00019fb0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00019fc0: 6567 7265 6573 3d64 6567 7265 6573 2c0d  egrees=degrees,.
+00019fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019fe0: 2069 6e74 6572 706f 6c61 7469 6f6e 3d69   interpolation=i
+00019ff0: 6e74 6572 702c 0d0a 2020 2020 2020 2020  nterp,..        
+0001a000: 2020 2020 2020 2020 6669 6c74 6572 5f66          filter_f
+0001a010: 756e 633d 6669 6c74 6572 5f66 756e 632c  unc=filter_func,
+0001a020: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a030: 2020 6f75 7470 7574 5f73 6861 7065 3d6f    output_shape=o
+0001a040: 7574 7075 745f 7368 6170 652c 0d0a 2020  utput_shape,..  
+0001a050: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+0001a060: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0001a070: 0d0a 2020 2020 2020 2020 6966 206f 7574  ..        if out
+0001a080: 2e6e 6469 6d20 3d3d 2033 3a0d 0a20 2020  .ndim == 3:..   
+0001a090: 2020 2020 2020 2020 206f 7574 203d 206e           out = n
+0001a0a0: 702e 6d6f 7665 6178 6973 286f 7574 2c20  p.moveaxis(out, 
+0001a0b0: 302c 2031 290d 0a20 2020 2020 2020 206f  0, 1)..        o
+0001a0c0: 7574 203d 206f 7574 5b3a 3a2d 315d 0d0a  ut = out[::-1]..
+0001a0d0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001a0e0: 7574 2e5f 7365 745f 696e 666f 2873 656c  ut._set_info(sel
+0001a0f0: 662c 206e 6577 5f61 7865 7329 0d0a 0d0a  f, new_axes)....
+0001a100: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
+0001a110: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
+0001a120: 2064 6566 2074 6872 6573 686f 6c64 280d   def threshold(.
+0001a130: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+0001a140: 2020 2020 2020 2020 7468 723a 2066 6c6f          thr: flo
+0001a150: 6174 207c 2073 7472 207c 2054 6872 6561  at | str | Threa
+0001a160: 7368 6f6c 644d 6574 686f 6420 3d20 226f  sholdMethod = "o
+0001a170: 7473 7522 2c0d 0a20 2020 2020 2020 202a  tsu",..        *
+0001a180: 2c0d 0a20 2020 2020 2020 2061 6c6f 6e67  ,..        along
+0001a190: 3a20 4178 6973 4c69 6b65 207c 204e 6f6e  : AxisLike | Non
+0001a1a0: 6520 3d20 4e6f 6e65 2c0d 0a20 2020 2020  e = None,..     
+0001a1b0: 2020 202a 2a6b 7761 7267 730d 0a20 2020     **kwargs..   
+0001a1c0: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
+0001a1d0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0001a1e0: 2020 2020 2020 4170 706c 7920 7468 7265        Apply thre
+0001a1f0: 7368 6f6c 6469 6e67 2074 6f20 7468 6520  sholding to the 
+0001a200: 696d 6167 6520 616e 6420 6372 6561 7465  image and create
+0001a210: 2061 2062 696e 6172 7920 696d 6167 652e   a binary image.
+0001a220: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0001a230: 2020 2020 5468 6520 7468 7265 7368 6f6c      The threshol
+0001a240: 6420 7661 6c75 6520 6361 6e20 6265 2067  d value can be g
+0001a250: 6976 656e 2077 6974 6820 6120 666c 6f61  iven with a floa
+0001a260: 7420 6f72 2061 2073 7472 696e 6720 7468  t or a string th
+0001a270: 6174 2069 6e64 6963 6174 6573 2077 6861  at indicates wha
+0001a280: 740d 0a20 2020 2020 2020 2074 6872 6573  t..        thres
+0001a290: 686f 6c64 696e 6720 6d65 7468 6f64 2077  holding method w
+0001a2a0: 696c 6c20 6265 2075 7365 642e 0d0a 2020  ill be used...  
+0001a2b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0001a2c0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+0001a2d0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+0001a2e0: 2020 2020 2020 2020 7468 723a 2066 6c6f          thr: flo
+0001a2f0: 6174 206f 7220 7374 722c 206f 7074 696f  at or str, optio
+0001a300: 6e61 6c0d 0a20 2020 2020 2020 2020 2020  nal..           
+0001a310: 2054 6872 6573 686f 6c64 2076 616c 7565   Threshold value
+0001a320: 2c20 7065 7263 656e 7461 6765 206f 7220  , percentage or 
+0001a330: 7468 7265 7368 6f6c 6469 6e67 2061 6c67  thresholding alg
+0001a340: 6f72 6974 686d 2e0d 0a20 2020 2020 2020  orithm...       
+0001a350: 2061 6c6f 6e67 203a 2041 7869 734c 696b   along : AxisLik
+0001a360: 652c 206f 7074 696f 6e61 6c0d 0a20 2020  e, optional..   
+0001a370: 2020 2020 2020 2020 2044 696d 656e 7369           Dimensi
+0001a380: 6f6e 7320 7468 6174 2077 696c 6c20 6e6f  ons that will no
+0001a390: 7420 7368 6172 6520 7468 6520 7361 6d65  t share the same
+0001a3a0: 2074 6872 6573 686f 6c64 2e20 466f 7220   threshold. For 
+0001a3b0: 696e 7374 616e 6365 2c20 6966 0d0a 2020  instance, if..  
+0001a3c0: 2020 2020 2020 2020 2020 6060 616c 6f6e            ``alon
+0001a3d0: 673d 2263 2260 6020 7468 656e 2074 6872  g="c"`` then thr
+0001a3e0: 6573 686f 6c64 2069 6e74 656e 7369 7469  eshold intensiti
+0001a3f0: 6573 2061 7265 2064 6574 6572 6d69 6e65  es are determine
+0001a400: 6420 666f 7220 6576 6572 7920 6368 616e  d for every chan
+0001a410: 6e65 6c2e 0d0a 2020 2020 2020 2020 2020  nel...          
+0001a420: 2020 4966 2060 6074 6872 6060 2069 7320    If ``thr`` is 
+0001a430: 666c 6f61 742c 2060 6061 6c6f 6e67 6060  float, ``along``
+0001a440: 2077 696c 6c20 6265 2069 676e 6f72 6564   will be ignored
+0001a450: 2e0d 0a20 2020 2020 2020 202a 2a6b 7761  ...        **kwa
+0001a460: 7267 733a 0d0a 2020 2020 2020 2020 2020  rgs:..          
+0001a470: 2020 4b65 7977 6f72 6420 6172 6775 6d65    Keyword argume
+0001a480: 6e74 7320 7468 6174 2077 696c 6c20 7061  nts that will pa
+0001a490: 7373 6564 2074 6f20 6675 6e63 7469 6f6e  ssed to function
+0001a4a0: 2069 6e64 6963 6174 6564 2069 6e20 276d   indicated in 'm
+0001a4b0: 6574 686f 6427 2e0d 0a0d 0a20 2020 2020  ethod'.....     
+0001a4c0: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
+0001a4d0: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
+0001a4e0: 2020 2020 2049 6d67 4172 7261 790d 0a20       ImgArray.. 
+0001a4f0: 2020 2020 2020 2020 2020 2042 6f6f 6c69             Booli
+0001a500: 616e 2061 7272 6179 2e0d 0a20 2020 2020  an array...     
+0001a510: 2020 200d 0a20 2020 2020 2020 2045 7861     ..        Exa
+0001a520: 6d70 6c65 730d 0a20 2020 2020 2020 202d  mples..        -
+0001a530: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+0001a540: 2053 7562 7374 6974 7574 6520 6f75 746c   Substitute outl
+0001a550: 6965 7273 2074 6f20 302e 0d0a 2020 2020  iers to 0...    
+0001a560: 2020 2020 2020 2020 3e3e 3e20 7468 7220          >>> thr 
+0001a570: 3d20 696d 672e 7468 7265 7368 6f6c 6428  = img.threshold(
+0001a580: 2239 3925 2229 0d0a 2020 2020 2020 2020  "99%")..        
+0001a590: 2020 2020 3e3e 3e20 696d 675b 7468 725d      >>> img[thr]
+0001a5a0: 203d 2030 0d0a 2020 2020 2020 2020 2222   = 0..        ""
+0001a5b0: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+0001a5c0: 6c66 2e64 7479 7065 203d 3d20 626f 6f6c  lf.dtype == bool
+0001a5d0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0001a5e0: 6574 7572 6e20 7365 6c66 0d0a 2020 2020  eturn self..    
+0001a5f0: 2020 2020 0d0a 2020 2020 2020 2020 6966      ..        if
+0001a600: 2061 6c6f 6e67 2069 7320 4e6f 6e65 3a0d   along is None:.
+0001a610: 0a20 2020 2020 2020 2020 2020 2061 6c6f  .            alo
+0001a620: 6e67 203d 2022 6322 2069 6620 2263 2220  ng = "c" if "c" 
+0001a630: 696e 2073 656c 662e 6178 6573 2065 6c73  in self.axes els
+0001a640: 6520 2222 0d0a 0d0a 2020 2020 2020 2020  e ""....        
+0001a650: 6d65 7468 6f64 735f 203d 207b 2269 736f  methods_ = {"iso
+0001a660: 6461 7461 223a 2073 6b66 696c 2e74 6872  data": skfil.thr
+0001a670: 6573 686f 6c64 5f69 736f 6461 7461 2c0d  eshold_isodata,.
+0001a680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a690: 2020 2020 2022 6c69 223a 2073 6b66 696c       "li": skfil
+0001a6a0: 2e74 6872 6573 686f 6c64 5f6c 692c 0d0a  .threshold_li,..
+0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6c0: 2020 2020 226c 6f63 616c 223a 2073 6b66      "local": skf
+0001a6d0: 696c 2e74 6872 6573 686f 6c64 5f6c 6f63  il.threshold_loc
+0001a6e0: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+0001a6f0: 2020 2020 2020 2020 2022 6d65 616e 223a           "mean":
+0001a700: 2073 6b66 696c 2e74 6872 6573 686f 6c64   skfil.threshold
+0001a710: 5f6d 6561 6e2c 0d0a 2020 2020 2020 2020  _mean,..        
+0001a720: 2020 2020 2020 2020 2020 2020 226d 696e              "min
+0001a730: 223a 2073 6b66 696c 2e74 6872 6573 686f  ": skfil.thresho
+0001a740: 6c64 5f6d 696e 696d 756d 2c0d 0a20 2020  ld_minimum,..   
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a760: 2022 6d69 6e69 6d75 6d22 3a20 736b 6669   "minimum": skfi
+0001a770: 6c2e 7468 7265 7368 6f6c 645f 6d69 6e69  l.threshold_mini
+0001a780: 6d75 6d2c 0d0a 2020 2020 2020 2020 2020  mum,..          
+0001a790: 2020 2020 2020 2020 2020 226e 6962 6c61            "nibla
+0001a7a0: 636b 223a 2073 6b66 696c 2e74 6872 6573  ck": skfil.thres
+0001a7b0: 686f 6c64 5f6e 6962 6c61 636b 2c0d 0a20  hold_niblack,.. 
+0001a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7d0: 2020 2022 6f74 7375 223a 2073 6b66 696c     "otsu": skfil
+0001a7e0: 2e74 6872 6573 686f 6c64 5f6f 7473 752c  .threshold_otsu,
+0001a7f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a800: 2020 2020 2020 2273 6175 766f 6c61 223a        "sauvola":
+0001a810: 2073 6b66 696c 2e74 6872 6573 686f 6c64   skfil.threshold
+0001a820: 5f73 6175 766f 6c61 2c0d 0a20 2020 2020  _sauvola,..     
+0001a830: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001a840: 7472 6961 6e67 6c65 223a 2073 6b66 696c  triangle": skfil
+0001a850: 2e74 6872 6573 686f 6c64 5f74 7269 616e  .threshold_trian
+0001a860: 676c 652c 0d0a 2020 2020 2020 2020 2020  gle,..          
+0001a870: 2020 2020 2020 2020 2020 2279 656e 223a            "yen":
+0001a880: 2073 6b66 696c 2e74 6872 6573 686f 6c64   skfil.threshold
+0001a890: 5f79 656e 0d0a 2020 2020 2020 2020 2020  _yen..          
+0001a8a0: 2020 2020 2020 2020 2020 7d0d 0a20 2020            }..   
+0001a8b0: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
+0001a8c0: 6620 6973 696e 7374 616e 6365 2874 6872  f isinstance(thr
+0001a8d0: 2c20 7374 7229 2061 6e64 2074 6872 2e65  , str) and thr.e
+0001a8e0: 6e64 7377 6974 6828 2225 2229 3a0d 0a20  ndswith("%"):.. 
+0001a8f0: 2020 2020 2020 2020 2020 2070 203d 2066             p = f
+0001a900: 6c6f 6174 2874 6872 5b3a 2d31 5d2e 7374  loat(thr[:-1].st
+0001a910: 7269 7028 2929 0d0a 2020 2020 2020 2020  rip())..        
+0001a920: 2020 2020 6f75 7420 3d20 6e70 2e7a 6572      out = np.zer
+0001a930: 6f73 2873 656c 662e 7368 6170 652c 2064  os(self.shape, d
+0001a940: 7479 7065 3d62 6f6f 6c29 0d0a 2020 2020  type=bool)..    
+0001a950: 2020 2020 2020 2020 666f 7220 736c 2c20          for sl, 
+0001a960: 696d 6720 696e 2073 656c 662e 6974 6572  img in self.iter
+0001a970: 2861 6c6f 6e67 293a 0d0a 2020 2020 2020  (along):..      
+0001a980: 2020 2020 2020 2020 2020 7468 7220 3d20            thr = 
+0001a990: 6e70 2e70 6572 6365 6e74 696c 6528 696d  np.percentile(im
+0001a9a0: 672c 2070 290d 0a20 2020 2020 2020 2020  g, p)..         
+0001a9b0: 2020 2020 2020 206f 7574 5b73 6c5d 203d         out[sl] =
+0001a9c0: 2069 6d67 203e 3d20 7468 720d 0a20 2020   img >= thr..   
+0001a9d0: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
+0001a9e0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0001a9f0: 7374 616e 6365 2874 6872 2c20 7374 7229  stance(thr, str)
+0001aa00: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+0001aa10: 6574 686f 6420 3d20 7468 722e 6c6f 7765  ethod = thr.lowe
+0001aa20: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
+0001aa30: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0001aa40: 2020 2020 2020 2066 756e 6320 3d20 6d65         func = me
+0001aa50: 7468 6f64 735f 5b6d 6574 686f 645d 0d0a  thods_[method]..
+0001aa60: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0001aa70: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
+0001aa80: 2020 2020 2020 2020 2020 2020 2020 7320                s 
+0001aa90: 3d20 222c 2022 2e6a 6f69 6e28 6c69 7374  = ", ".join(list
+0001aaa0: 286d 6574 686f 6473 5f2e 6b65 7973 2829  (methods_.keys()
+0001aab0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0001aac0: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
+0001aad0: 6f72 2866 227b 6d65 7468 6f64 7d5c 6e6d  or(f"{method}\nm
+0001aae0: 6574 686f 6420 6d75 7374 2062 653a 207b  ethod must be: {
+0001aaf0: 737d 2229 0d0a 2020 2020 2020 2020 2020  s}")..          
+0001ab00: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0001ab10: 6f75 7420 3d20 6e70 2e7a 6572 6f73 2873  out = np.zeros(s
+0001ab20: 656c 662e 7368 6170 652c 2064 7479 7065  elf.shape, dtype
+0001ab30: 3d62 6f6f 6c29 0d0a 2020 2020 2020 2020  =bool)..        
+0001ab40: 2020 2020 666f 7220 736c 2c20 696d 6720      for sl, img 
+0001ab50: 696e 2073 656c 662e 6974 6572 2861 6c6f  in self.iter(alo
+0001ab60: 6e67 293a 0d0a 2020 2020 2020 2020 2020  ng):..          
+0001ab70: 2020 2020 2020 7468 7220 3d20 6675 6e63        thr = func
+0001ab80: 2869 6d67 2c20 2a2a 6b77 6172 6773 290d  (img, **kwargs).
+0001ab90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aba0: 206f 7574 5b73 6c5d 203d 2069 6d67 203e   out[sl] = img >
+0001abb0: 3d20 7468 720d 0a20 2020 2020 2020 2020  = thr..         
+0001abc0: 2020 200d 0a0d 0a20 2020 2020 2020 2065     ....        e
+0001abd0: 6c69 6620 6e70 2e69 7373 6361 6c61 7228  lif np.isscalar(
+0001abe0: 7468 7229 3a0d 0a20 2020 2020 2020 2020  thr):..         
+0001abf0: 2020 206f 7574 203d 2073 656c 6620 3e3d     out = self >=
+0001ac00: 2074 6872 0d0a 2020 2020 2020 2020 656c   thr..        el
+0001ac10: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0001ac20: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0001ac30: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0001ac40: 2020 2022 2774 6872 2720 6d75 7374 2062     "'thr' must b
+0001ac50: 6520 6e75 6d65 7269 632c 206f 7220 7374  e numeric, or st
+0001ac60: 7220 7370 6563 6966 7969 6e67 2061 2074  r specifying a t
+0001ac70: 6872 6573 686f 6c64 696e 6720 6d65 7468  hresholding meth
+0001ac80: 6f64 2e22 0d0a 2020 2020 2020 2020 2020  od."..          
+0001ac90: 2020 290d 0a20 2020 2020 2020 200d 0a20    )..        .. 
+0001aca0: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
+0001acb0: 740d 0a20 2020 200d 0a20 2020 2040 5f64  t..    ..    @_d
+0001acc0: 6f63 732e 7772 6974 655f 646f 6373 0d0a  ocs.write_docs..
+0001acd0: 2020 2020 4064 696d 735f 746f 5f73 7061      @dims_to_spa
+0001ace0: 7469 616c 5f61 7865 730d 0a20 2020 2040  tial_axes..    @
+0001acf0: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
+0001ad00: 6f75 7470 7574 286f 6e6c 795f 6269 6e61  output(only_bina
+0001ad10: 7279 3d54 7275 6529 0d0a 2020 2020 6465  ry=True)..    de
+0001ad20: 6620 6469 7374 616e 6365 5f6d 6170 2873  f distance_map(s
+0001ad30: 656c 662c 202a 2c20 6469 6d73 3a20 4469  elf, *, dims: Di
+0001ad40: 6d73 203d 204e 6f6e 6529 202d 3e20 496d  ms = None) -> Im
+0001ad50: 6741 7272 6179 3a0d 0a20 2020 2020 2020  gArray:..       
+0001ad60: 2022 2222 0d0a 2020 2020 2020 2020 4361   """..        Ca
+0001ad70: 6c63 756c 6174 6520 6469 7374 616e 6365  lculate distance
+0001ad80: 206d 6170 2066 726f 6d20 6269 6e61 7279   map from binary
+0001ad90: 2069 6d61 6765 732e 0d0a 2020 2020 2020   images...      
+0001ada0: 2020 466f 7220 696e 7374 616e 6365 2c20    For instance, 
+0001adb0: 6060 5b31 2c20 312c 2031 2c20 302c 2030  ``[1, 1, 1, 0, 0
+0001adc0: 2c20 302c 2031 2c20 312c 2031 5d60 6020  , 0, 1, 1, 1]`` 
+0001add0: 7769 6c6c 2062 6520 636f 6e76 6572 7465  will be converte
+0001ade0: 6420 746f 200d 0a20 2020 2020 2020 2060  d to ..        `
+0001adf0: 605b 332c 2032 2c20 312c 2030 2c20 302c  `[3, 2, 1, 0, 0,
+0001ae00: 2030 2c20 312c 2032 2c20 335d 6060 2e20   0, 1, 2, 3]``. 
+0001ae10: 4e6f 7465 2074 6861 7420 7265 7475 726e  Note that return
+0001ae20: 6564 2061 7272 6179 2077 696c 6c20 6265  ed array will be
+0001ae30: 2066 6c6f 6174 2069 6e20 6e2d 4420 0d0a   float in n-D ..
+0001ae40: 2020 2020 2020 2020 696d 6167 6573 2e0d          images..
+0001ae50: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0001ae60: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
+0001ae70: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
+0001ae80: 2020 207b 6469 6d73 7d0d 0a0d 0a20 2020     {dims}....   
+0001ae90: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+0001aea0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
+0001aeb0: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
+0001aec0: 0a20 2020 2020 2020 2020 2020 2044 6973  .            Dis
+0001aed0: 7461 6e63 6520 6d61 702c 2074 6865 2066  tance map, the f
+0001aee0: 7572 7468 6572 2074 6865 2062 7269 6768  urther the brigh
+0001aef0: 7465 720d 0a20 2020 2020 2020 2022 2222  ter..        """
+0001af00: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0001af10: 2020 7265 7475 726e 2073 656c 662e 5f61    return self._a
+0001af20: 7070 6c79 5f64 6173 6b28 6e64 692e 6469  pply_dask(ndi.di
+0001af30: 7374 616e 6365 5f74 7261 6e73 666f 726d  stance_transform
+0001af40: 5f65 6474 2c20 0d0a 2020 2020 2020 2020  _edt, ..        
+0001af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af60: 2020 2020 2020 2063 5f61 7865 733d 636f         c_axes=co
+0001af70: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
+0001af80: 6d73 2c20 7365 6c66 2e61 7865 7329 0d0a  ms, self.axes)..
+0001af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afa0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001afb0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0001afc0: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
+0001afd0: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
+0001afe0: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
+0001aff0: 7574 0d0a 2020 2020 6465 6620 6e63 635f  ut..    def ncc_
+0001b000: 6669 6c74 6572 280d 0a20 2020 2020 2020  filter(..       
+0001b010: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+0001b020: 7465 6d70 6c61 7465 3a20 6e70 2e6e 6461  template: np.nda
+0001b030: 7272 6179 2c0d 0a20 2020 2020 2020 206d  rray,..        m
+0001b040: 6f64 653a 2073 7472 203d 2022 636f 6e73  ode: str = "cons
+0001b050: 7461 6e74 222c 200d 0a20 2020 2020 2020  tant", ..       
+0001b060: 2063 7661 6c3a 2066 6c6f 6174 207c 2073   cval: float | s
+0001b070: 7472 207c 2043 616c 6c61 626c 655b 5b6e  tr | Callable[[n
+0001b080: 702e 6e64 6172 7261 795d 2c20 666c 6f61  p.ndarray], floa
+0001b090: 745d 203d 206e 702e 6d65 616e 2c20 0d0a  t] = np.mean, ..
+0001b0a0: 2020 2020 2020 2020 2a2c 200d 0a20 2020          *, ..   
+0001b0b0: 2020 2020 2064 696d 733a 2044 696d 7320       dims: Dims 
+0001b0c0: 3d20 4e6f 6e65 0d0a 2020 2020 2920 2d3e  = None..    ) ->
+0001b0d0: 2049 6d67 4172 7261 793a 0d0a 2020 2020   ImgArray:..    
+0001b0e0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0001b0f0: 2054 656d 706c 6174 6520 6d61 7463 6869   Template matchi
+0001b100: 6e67 2075 7369 6e67 206e 6f72 6d61 6c69  ng using normali
+0001b110: 7a65 6420 6372 6f73 7320 636f 7272 656c  zed cross correl
+0001b120: 6174 696f 6e20 284e 4343 2920 6d65 7468  ation (NCC) meth
+0001b130: 6f64 2e20 5468 6973 2066 756e 6374 696f  od. This functio
+0001b140: 6e20 6973 2062 6173 6963 616c 6c79 0d0a  n is basically..
+0001b150: 2020 2020 2020 2020 6964 656e 7469 6361          identica
+0001b160: 6c20 746f 2074 6861 7420 696e 2060 736b  l to that in `sk
+0001b170: 696d 6167 652e 6665 6174 7572 6560 2c20  image.feature`, 
+0001b180: 6275 7420 6973 206f 7074 696d 697a 6564  but is optimized
+0001b190: 2066 6f72 2062 6174 6368 2070 726f 6365   for batch proce
+0001b1a0: 7373 696e 6720 616e 6420 696d 7072 6f76  ssing and improv
+0001b1b0: 6564 200d 0a20 2020 2020 2020 2072 6561  ed ..        rea
+0001b1c0: 6461 6269 6c69 7479 2e0d 0a0d 0a20 2020  dability.....   
+0001b1d0: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
+0001b1e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001b1f0: 2d2d 2d0d 0a20 2020 2020 2020 2074 656d  ---..        tem
+0001b200: 706c 6174 6520 3a20 6e70 2e6e 6461 7272  plate : np.ndarr
+0001b210: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+0001b220: 5465 6d70 6c61 7465 2069 6d61 6765 2e20  Template image. 
+0001b230: 4d75 7374 2062 6520 3220 6f72 2033 2064  Must be 2 or 3 d
+0001b240: 696d 656e 7369 6f6e 616c 2e20 0d0a 2020  imensional. ..  
+0001b250: 2020 2020 2020 7b6d 6f64 657d 0d0a 2020        {mode}..  
+0001b260: 2020 2020 2020 6376 616c 203a 2066 6c6f        cval : flo
+0001b270: 6174 2c20 6f70 7469 6f6e 616c 0d0a 2020  at, optional..  
+0001b280: 2020 2020 2020 2020 2020 4261 636b 6772            Backgr
+0001b290: 6f75 6e64 2069 6e74 656e 7369 7479 2e20  ound intensity. 
+0001b2a0: 4966 206e 6f74 2067 6976 656e 2c20 6974  If not given, it
+0001b2b0: 2077 696c 6c20 6361 6c63 756c 6174 6564   will calculated
+0001b2c0: 2061 7320 7468 6520 6d65 616e 2076 616c   as the mean val
+0001b2d0: 7565 206f 6620 0d0a 2020 2020 2020 2020  ue of ..        
+0001b2e0: 2020 2020 7468 6520 6f72 6967 696e 616c      the original
+0001b2f0: 2069 6d61 6765 2e0d 0a20 2020 2020 2020   image...       
+0001b300: 207b 6469 6d73 7d0d 0a0d 0a20 2020 2020   {dims}....     
+0001b310: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
+0001b320: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
+0001b330: 2020 2020 2049 6d67 4172 7261 790d 0a20       ImgArray.. 
+0001b340: 2020 2020 2020 2020 2020 2052 6573 706f             Respo
+0001b350: 6e73 6520 696d 6167 6520 7769 7468 2076  nse image with v
+0001b360: 616c 7565 7320 6265 7477 6565 6e20 2d31  alues between -1
+0001b370: 2061 6e64 2031 2e0d 0a20 2020 2020 2020   and 1...       
+0001b380: 2022 2222 2020 2020 2020 2020 0d0a 2020   """        ..  
+0001b390: 2020 2020 2020 7465 6d70 6c61 7465 203d        template =
+0001b3a0: 205f 6368 6563 6b5f 7465 6d70 6c61 7465   _check_template
+0001b3b0: 2874 656d 706c 6174 6529 0d0a 2020 2020  (template)..    
+0001b3c0: 2020 2020 6966 2063 616c 6c61 626c 6528      if callable(
+0001b3d0: 6376 616c 293a 0d0a 2020 2020 2020 2020  cval):..        
+0001b3e0: 2020 2020 6376 616c 203d 2063 7661 6c28      cval = cval(
+0001b3f0: 7365 6c66 290d 0a20 2020 2020 2020 2063  self)..        c
+0001b400: 7661 6c20 3d20 5f63 6865 636b 5f62 6728  val = _check_bg(
+0001b410: 7365 6c66 2c20 6376 616c 290d 0a20 2020  self, cval)..   
+0001b420: 2020 2020 2069 6620 6c65 6e28 6469 6d73       if len(dims
+0001b430: 2920 213d 2074 656d 706c 6174 652e 6e64  ) != template.nd
+0001b440: 696d 3a0d 0a20 2020 2020 2020 2020 2020  im:..           
+0001b450: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0001b460: 7228 2264 696d 7320 616e 6420 7468 6520  r("dims and the 
+0001b470: 6e75 6d62 6572 206f 6620 7465 6d70 6c61  number of templa
+0001b480: 7465 2064 696d 656e 7369 6f6e 2064 6f6e  te dimension don
+0001b490: 2774 206d 6174 6368 2e22 290d 0a20 2020  't match.")..   
+0001b4a0: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+0001b4b0: 6574 7572 6e20 7365 6c66 2e61 735f 666c  eturn self.as_fl
+0001b4c0: 6f61 7428 292e 5f61 7070 6c79 5f64 6173  oat()._apply_das
+0001b4d0: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
+0001b4e0: 5f66 696c 7465 7273 2e6e 6363 5f66 696c  _filters.ncc_fil
+0001b4f0: 7465 722c 0d0a 2020 2020 2020 2020 2020  ter,..          
+0001b500: 2020 635f 6178 6573 3d63 6f6d 706c 656d    c_axes=complem
+0001b510: 656e 745f 6178 6573 2864 696d 732c 2073  ent_axes(dims, s
+0001b520: 656c 662e 6178 6573 292c 200d 0a20 2020  elf.axes), ..   
+0001b530: 2020 2020 2020 2020 2061 7267 733d 2874           args=(t
+0001b540: 656d 706c 6174 652c 2063 7661 6c2c 206d  emplate, cval, m
+0001b550: 6f64 6529 0d0a 2020 2020 2020 2020 290d  ode)..        ).
+0001b560: 0a20 2020 200d 0a20 2020 2040 5f64 6f63  .    ..    @_doc
+0001b570: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
+0001b580: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
+0001b590: 616c 5f61 7865 730d 0a20 2020 2040 6368  al_axes..    @ch
+0001b5a0: 6563 6b5f 696e 7075 745f 616e 645f 6f75  eck_input_and_ou
+0001b5b0: 7470 7574 286f 6e6c 795f 6269 6e61 7279  tput(only_binary
+0001b5c0: 3d54 7275 6529 0d0a 2020 2020 6465 6620  =True)..    def 
+0001b5d0: 7265 6d6f 7665 5f6c 6172 6765 5f6f 626a  remove_large_obj
+0001b5e0: 6563 7473 2873 656c 662c 2072 6164 6975  ects(self, radiu
+0001b5f0: 733a 2066 6c6f 6174 203d 2035 2c20 2a2c  s: float = 5, *,
+0001b600: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
+0001b610: 6e65 2c20 7570 6461 7465 3a20 626f 6f6c  ne, update: bool
+0001b620: 203d 2046 616c 7365 2920 2d3e 2049 6d67   = False) -> Img
+0001b630: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
+0001b640: 2222 220d 0a20 2020 2020 2020 2052 656d  """..        Rem
+0001b650: 6f76 6520 6c61 7267 6520 6f62 6a65 6374  ove large object
+0001b660: 7320 7573 696e 6720 6f70 656e 696e 672e  s using opening.
+0001b670: 2054 686f 7365 206f 626a 6563 7473 2074   Those objects t
+0001b680: 6861 7420 7765 7265 206e 6f74 2072 656d  hat were not rem
+0001b690: 6f76 6564 2062 7920 6f70 656e 696e 670d  oved by opening.
+0001b6a0: 0a20 2020 2020 2020 2077 696c 6c20 6265  .        will be
+0001b6b0: 2072 656d 6f76 6564 2069 6e20 6f75 7470   removed in outp
+0001b6c0: 7574 2e0d 0a0d 0a20 2020 2020 2020 2050  ut.....        P
+0001b6d0: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+0001b6e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+0001b6f0: 2020 2020 2020 2072 6164 6975 7320 3a20         radius : 
+0001b700: 666c 6f61 742c 206f 7074 696f 6e61 6c0d  float, optional.
+0001b710: 0a20 2020 2020 2020 2020 2020 204f 626a  .            Obj
+0001b720: 6563 7473 2077 6974 6820 7261 6469 7573  ects with radius
+0001b730: 206c 6172 6765 7220 7468 616e 2074 6869   larger than thi
+0001b740: 7320 7661 6c75 6520 7769 6c6c 2062 6520  s value will be 
+0001b750: 7265 6d6f 7665 642e 0d0a 2020 2020 2020  removed...      
+0001b760: 2020 7b64 696d 737d 7b75 7064 6174 657d    {dims}{update}
+0001b770: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0001b780: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+0001b790: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+0001b7a0: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+0001b7b0: 2020 2020 496d 6167 6520 7769 7468 206c      Image with l
+0001b7c0: 6172 6765 206f 626a 6563 7473 2072 656d  arge objects rem
+0001b7d0: 6f76 6564 2e0d 0a0d 0a20 2020 2020 2020  oved.....       
+0001b7e0: 2053 6565 2041 6c73 6f0d 0a20 2020 2020   See Also..     
+0001b7f0: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
+0001b800: 2020 2020 2072 656d 6f76 655f 6669 6e65       remove_fine
+0001b810: 5f6f 626a 6563 7473 0d0a 2020 2020 2020  _objects..      
+0001b820: 2020 2222 2220 2020 2020 2020 200d 0a20    """        .. 
+0001b830: 2020 2020 2020 206f 7574 203d 2073 656c         out = sel
+0001b840: 662e 636f 7079 2829 0d0a 2020 2020 2020  f.copy()..      
+0001b850: 2020 6c61 7267 655f 6f62 6a20 3d20 7365    large_obj = se
+0001b860: 6c66 2e6f 7065 6e69 6e67 2872 6164 6975  lf.opening(radiu
+0001b870: 732c 2064 696d 733d 6469 6d73 290d 0a20  s, dims=dims).. 
+0001b880: 2020 2020 2020 206f 7574 2e76 616c 7565         out.value
+0001b890: 5b6c 6172 6765 5f6f 626a 5d20 3d20 300d  [large_obj] = 0.
+0001b8a0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+0001b8b0: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
+0001b8c0: 740d 0a20 2020 200d 0a20 2020 2040 5f64  t..    ..    @_d
+0001b8d0: 6f63 732e 7772 6974 655f 646f 6373 0d0a  ocs.write_docs..
+0001b8e0: 2020 2020 4064 696d 735f 746f 5f73 7061      @dims_to_spa
+0001b8f0: 7469 616c 5f61 7865 730d 0a20 2020 2040  tial_axes..    @
+0001b900: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
+0001b910: 6f75 7470 7574 286f 6e6c 795f 6269 6e61  output(only_bina
+0001b920: 7279 3d54 7275 6529 0d0a 2020 2020 6465  ry=True)..    de
+0001b930: 6620 7265 6d6f 7665 5f66 696e 655f 6f62  f remove_fine_ob
+0001b940: 6a65 6374 7328 7365 6c66 2c20 6c65 6e67  jects(self, leng
+0001b950: 7468 3a20 666c 6f61 7420 3d20 3130 2c20  th: float = 10, 
+0001b960: 2a2c 2064 696d 733a 2044 696d 7320 3d20  *, dims: Dims = 
+0001b970: 4e6f 6e65 2c20 7570 6461 7465 3a20 626f  None, update: bo
+0001b980: 6f6c 203d 2046 616c 7365 2920 2d3e 2049  ol = False) -> I
+0001b990: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
+0001b9a0: 2020 2222 220d 0a20 2020 2020 2020 2052    """..        R
+0001b9b0: 656d 6f76 6520 6669 6e65 206f 626a 6563  emove fine objec
+0001b9c0: 7473 2075 7369 6e67 2064 6961 6d65 7465  ts using diamete
+0001b9d0: 725f 6f70 656e 696e 672e 0d0a 0d0a 2020  r_opening.....  
+0001b9e0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0001b9f0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+0001ba00: 2d2d 2d2d 0d0a 2020 2020 2020 2020 6c65  ----..        le
+0001ba10: 6e67 7468 203a 2066 6c6f 6174 2c20 6465  ngth : float, de
+0001ba20: 6661 756c 7420 6973 2031 300d 0a20 2020  fault is 10..   
+0001ba30: 2020 2020 2020 2020 204f 626a 6563 7473           Objects
+0001ba40: 206c 6f6e 6765 7220 7468 616e 2074 6869   longer than thi
+0001ba50: 7320 7769 6c6c 2062 6520 7265 6d6f 7665  s will be remove
+0001ba60: 642e 0d0a 2020 2020 2020 2020 7b64 696d  d...        {dim
+0001ba70: 737d 7b75 7064 6174 657d 0d0a 0d0a 2020  s}{update}....  
+0001ba80: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+0001ba90: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
+0001baa0: 2020 2020 2020 2020 496d 6741 7272 6179          ImgArray
+0001bab0: 0d0a 2020 2020 2020 2020 2020 2020 496d  ..            Im
+0001bac0: 6167 6520 7769 7468 206c 6172 6765 206f  age with large o
+0001bad0: 626a 6563 7473 2072 656d 6f76 6564 2e0d  bjects removed..
+0001bae0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0001baf0: 2020 2053 6565 2041 6c73 6f0d 0a20 2020     See Also..   
+0001bb00: 2020 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20       --------.. 
+0001bb10: 2020 2020 2020 2072 656d 6f76 655f 6c61         remove_la
+0001bb20: 7267 655f 6f62 6a65 6374 730d 0a20 2020  rge_objects..   
+0001bb30: 2020 2020 2022 2222 2020 2020 2020 2020       """        
+0001bb40: 0d0a 2020 2020 2020 2020 6f75 7420 3d20  ..        out = 
+0001bb50: 7365 6c66 2e63 6f70 7928 290d 0a20 2020  self.copy()..   
+0001bb60: 2020 2020 2066 696e 655f 6f62 6a20 3d20       fine_obj = 
+0001bb70: 7365 6c66 2e64 6961 6d65 7465 725f 6f70  self.diameter_op
+0001bb80: 656e 696e 6728 6c65 6e67 7468 2c20 636f  ening(length, co
+0001bb90: 6e6e 6563 7469 7669 7479 3d6c 656e 2864  nnectivity=len(d
+0001bba0: 696d 7329 290d 0a20 2020 2020 2020 206c  ims))..        l
+0001bbb0: 6172 6765 5f6f 626a 203d 2073 656c 662e  arge_obj = self.
+0001bbc0: 6f70 656e 696e 6728 6c65 6e67 7468 2f2f  opening(length//
+0001bbd0: 3229 0d0a 2020 2020 2020 2020 6f75 742e  2)..        out.
+0001bbe0: 7661 6c75 655b 7e6c 6172 6765 5f6f 626a  value[~large_obj
+0001bbf0: 2026 2066 696e 655f 6f62 6a5d 203d 2030   & fine_obj] = 0
+0001bc00: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0001bc10: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001bc20: 7574 0d0a 2020 2020 0d0a 2020 2020 405f  ut..    ..    @_
+0001bc30: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
+0001bc40: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
+0001bc50: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
+0001bc60: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
+0001bc70: 5f6f 7574 7075 7428 6f6e 6c79 5f62 696e  _output(only_bin
+0001bc80: 6172 793d 5472 7565 290d 0a20 2020 2064  ary=True)..    d
+0001bc90: 6566 2063 6f6e 7665 785f 6875 6c6c 2873  ef convex_hull(s
+0001bca0: 656c 662c 202a 2c20 6469 6d73 3a20 4469  elf, *, dims: Di
+0001bcb0: 6d73 203d 204e 6f6e 652c 2075 7064 6174  ms = None, updat
+0001bcc0: 653d 4661 6c73 6529 202d 3e20 496d 6741  e=False) -> ImgA
+0001bcd0: 7272 6179 3a0d 0a20 2020 2020 2020 2022  rray:..        "
+0001bce0: 2222 0d0a 2020 2020 2020 2020 436f 6d70  ""..        Comp
+0001bcf0: 7574 6520 636f 6e76 6578 2068 756c 6c20  ute convex hull 
+0001bd00: 696d 6167 652e 0d0a 0d0a 2020 2020 2020  image.....      
+0001bd10: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+0001bd20: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0001bd30: 0d0a 2020 2020 2020 2020 7b64 696d 737d  ..        {dims}
+0001bd40: 7b75 7064 6174 657d 0d0a 0d0a 2020 2020  {update}....    
+0001bd50: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+0001bd60: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+0001bd70: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
+0001bd80: 2020 2020 2020 2020 2020 2020 436f 6e76              Conv
+0001bd90: 6578 2068 756c 6c20 696d 6167 652e 0d0a  ex hull image...
+0001bda0: 2020 2020 2020 2020 2222 2220 2020 2020          """     
+0001bdb0: 2020 200d 0a20 2020 2020 2020 2072 6574     ..        ret
+0001bdc0: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
+0001bdd0: 6461 736b 280d 0a20 2020 2020 2020 2020  dask(..         
+0001bde0: 2020 2073 6b69 6d61 6765 2e6d 6f72 7068     skimage.morph
+0001bdf0: 6f6c 6f67 792e 636f 6e76 6578 5f68 756c  ology.convex_hul
+0001be00: 6c5f 696d 6167 652c 200d 0a20 2020 2020  l_image, ..     
+0001be10: 2020 2020 2020 2063 5f61 7865 733d 636f         c_axes=co
+0001be20: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
+0001be30: 6d73 2c20 7365 6c66 2e61 7865 7329 2c20  ms, self.axes), 
+0001be40: 0d0a 2020 2020 2020 2020 2020 2020 6474  ..            dt
+0001be50: 7970 653d 626f 6f6c 2c0d 0a20 2020 2020  ype=bool,..     
+0001be60: 2020 2029 2e61 7374 7970 6528 626f 6f6c     ).astype(bool
+0001be70: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+0001be80: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
+0001be90: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
+0001bea0: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
+0001beb0: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
+0001bec0: 616e 645f 6f75 7470 7574 286f 6e6c 795f  and_output(only_
+0001bed0: 6269 6e61 7279 3d54 7275 6529 0d0a 2020  binary=True)..  
+0001bee0: 2020 6465 6620 736b 656c 6574 6f6e 697a    def skeletoniz
+0001bef0: 6528 7365 6c66 2c20 7261 6469 7573 3a20  e(self, radius: 
+0001bf00: 666c 6f61 7420 3d20 302c 202a 2c20 6469  float = 0, *, di
+0001bf10: 6d73 3a20 4469 6d73 203d 204e 6f6e 652c  ms: Dims = None,
+0001bf20: 2075 7064 6174 653d 4661 6c73 6529 202d   update=False) -
+0001bf30: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
+0001bf40: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0001bf50: 2020 536b 656c 6574 6f6e 697a 6520 696d    Skeletonize im
+0001bf60: 6167 6573 2e20 4f6e 6c79 2077 6f72 6b73  ages. Only works
+0001bf70: 2066 6f72 2062 696e 6172 7920 696d 6167   for binary imag
+0001bf80: 6573 2e0d 0a0d 0a20 2020 2020 2020 2050  es.....        P
+0001bf90: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+0001bfa0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+0001bfb0: 2020 2020 2020 2072 6164 6975 7320 3a20         radius : 
+0001bfc0: 666c 6f61 742c 206f 7074 696f 6e61 6c0d  float, optional.
+0001bfd0: 0a20 2020 2020 2020 2020 2020 2052 6164  .            Rad
+0001bfe0: 6975 7320 6f66 2073 6b65 6c65 746f 6e2e  ius of skeleton.
+0001bff0: 2054 6869 7320 6973 2061 6368 6965 7665   This is achieve
+0001c000: 6420 7369 6d70 6c79 2062 7920 6469 6c61  d simply by dila
+0001c010: 7469 6f6e 206f 6620 736b 656c 6574 6f6e  tion of skeleton
+0001c020: 697a 6564 2072 6573 756c 7473 2e0d 0a20  ized results... 
+0001c030: 2020 2020 2020 207b 6469 6d73 7d7b 7570         {dims}{up
+0001c040: 6461 7465 7d0d 0a0d 0a20 2020 2020 2020  date}....       
+0001c050: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+0001c060: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+0001c070: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
+0001c080: 2020 2020 2020 2020 2053 6b65 6c65 746f           Skeleto
+0001c090: 6e69 7a65 6420 696d 6167 652e 0d0a 2020  nized image...  
+0001c0a0: 2020 2020 2020 2222 2220 2020 2020 2020        """       
+0001c0b0: 200d 0a20 2020 2020 2020 2069 6620 7261   ..        if ra
+0001c0c0: 6469 7573 203e 3d20 313a 0d0a 2020 2020  dius >= 1:..    
+0001c0d0: 2020 2020 2020 2020 7365 6c65 6d20 3d20          selem = 
+0001c0e0: 7870 2e61 736e 756d 7079 285f 7374 7275  xp.asnumpy(_stru
+0001c0f0: 6374 7572 6573 2e62 616c 6c5f 6c69 6b65  ctures.ball_like
+0001c100: 2872 6164 6975 732c 206c 656e 2864 696d  (radius, len(dim
+0001c110: 7329 2929 0d0a 2020 2020 2020 2020 656c  s)))..        el
+0001c120: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0001c130: 2073 656c 656d 203d 204e 6f6e 650d 0a20   selem = None.. 
+0001c140: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001c150: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
+0001c160: 706c 795f 6461 736b 280d 0a20 2020 2020  ply_dask(..     
+0001c170: 2020 2020 2020 205f 6669 6c74 6572 732e         _filters.
+0001c180: 736b 656c 6574 6f6e 697a 652c 200d 0a20  skeletonize, .. 
+0001c190: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
+0001c1a0: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
+0001c1b0: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+0001c1c0: 7329 2c0d 0a20 2020 2020 2020 2020 2020  s),..           
+0001c1d0: 2061 7267 733d 2873 656c 656d 2c29 2c0d   args=(selem,),.
+0001c1e0: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
+0001c1f0: 7065 3d62 6f6f 6c0d 0a20 2020 2020 2020  pe=bool..       
+0001c200: 2029 2e61 7374 7970 6528 626f 6f6c 290d   ).astype(bool).
+0001c210: 0a20 2020 2020 2020 200d 0a20 2020 2040  .        ..    @
+0001c220: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
+0001c230: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
+0001c240: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
+0001c250: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
+0001c260: 645f 6f75 7470 7574 286f 6e6c 795f 6269  d_output(only_bi
+0001c270: 6e61 7279 3d54 7275 6529 0d0a 2020 2020  nary=True)..    
+0001c280: 6465 6620 636f 756e 745f 6e65 6967 6862  def count_neighb
+0001c290: 6f72 7328 0d0a 2020 2020 2020 2020 7365  ors(..        se
+0001c2a0: 6c66 2c0d 0a20 2020 2020 2020 202a 2c20  lf,..        *, 
+0001c2b0: 0d0a 2020 2020 2020 2020 636f 6e6e 6563  ..        connec
+0001c2c0: 7469 7669 7479 3a20 696e 7420 7c20 4e6f  tivity: int | No
+0001c2d0: 6e65 203d 204e 6f6e 652c 0d0a 2020 2020  ne = None,..    
+0001c2e0: 2020 2020 6d61 736b 3a20 626f 6f6c 203d      mask: bool =
+0001c2f0: 2054 7275 652c 0d0a 2020 2020 2020 2020   True,..        
+0001c300: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+0001c310: 652c 0d0a 2020 2020 2920 2d3e 2049 6d67  e,..    ) -> Img
+0001c320: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
+0001c330: 2222 220d 0a20 2020 2020 2020 2043 6f75  """..        Cou
+0001c340: 6e74 2074 6865 206e 756d 6265 7220 6f72  nt the number or
+0001c350: 206e 6569 6768 626f 7273 206f 6620 6269   neighbors of bi
+0001c360: 6e61 7279 2069 6d61 6765 732e 2054 6869  nary images. Thi
+0001c370: 7320 6675 6e63 7469 6f6e 2063 616e 2062  s function can b
+0001c380: 6520 7573 6564 2066 6f72 2063 726f 7373  e used for cross
+0001c390: 2073 6563 7469 6f6e 0d0a 2020 2020 2020   section..      
+0001c3a0: 2020 6f72 2062 7261 6e63 6820 6465 7465    or branch dete
+0001c3b0: 6374 696f 6e2e 204f 6e6c 7920 776f 726b  ction. Only work
+0001c3c0: 7320 666f 7220 6269 6e61 7279 2069 6d61  s for binary ima
+0001c3d0: 6765 732e 0d0a 0d0a 2020 2020 2020 2020  ges.....        
+0001c3e0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+0001c3f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+0001c400: 2020 2020 2020 2020 7b63 6f6e 6e65 6374          {connect
+0001c410: 6976 6974 797d 0d0a 2020 2020 2020 2020  ivity}..        
+0001c420: 6d61 736b 203a 2062 6f6f 6c2c 2064 6566  mask : bool, def
+0001c430: 6175 6c74 2069 7320 5472 7565 0d0a 2020  ault is True..  
+0001c440: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+0001c450: 652c 206f 6e6c 7920 6e65 6967 6862 6f72  e, only neighbor
+0001c460: 7320 6f66 2070 6978 656c 7320 7468 6174  s of pixels that
+0001c470: 2073 6174 6973 6679 2073 656c 663d 3d54   satisfy self==T
+0001c480: 7275 6520 6973 2072 6574 7572 6e65 642e  rue is returned.
 0001c490: 0d0a 2020 2020 2020 2020 7b64 696d 737d  ..        {dims}
-0001c4a0: 7b75 7064 6174 657d 0d0a 0d0a 2020 2020  {update}....    
-0001c4b0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0001c4c0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-0001c4d0: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-0001c4e0: 2020 2020 2020 2020 2020 2020 536b 656c              Skel
-0001c4f0: 6574 6f6e 697a 6564 2069 6d61 6765 2e0d  etonized image..
-0001c500: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
-0001c510: 2020 2020 0d0a 2020 2020 2020 2020 6966      ..        if
-0001c520: 2072 6164 6975 7320 3e3d 2031 3a0d 0a20   radius >= 1:.. 
-0001c530: 2020 2020 2020 2020 2020 2073 656c 656d             selem
-0001c540: 203d 2078 702e 6173 6e75 6d70 7928 5f73   = xp.asnumpy(_s
-0001c550: 7472 7563 7475 7265 732e 6261 6c6c 5f6c  tructures.ball_l
-0001c560: 696b 6528 7261 6469 7573 2c20 6c65 6e28  ike(radius, len(
-0001c570: 6469 6d73 2929 290d 0a20 2020 2020 2020  dims)))..       
-0001c580: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0001c590: 2020 2020 7365 6c65 6d20 3d20 4e6f 6e65      selem = None
-0001c5a0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0001c5b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001c5c0: 5f61 7070 6c79 5f64 6173 6b28 0d0a 2020  _apply_dask(..  
-0001c5d0: 2020 2020 2020 2020 2020 5f66 696c 7465            _filte
-0001c5e0: 7273 2e73 6b65 6c65 746f 6e69 7a65 2c20  rs.skeletonize, 
-0001c5f0: 0d0a 2020 2020 2020 2020 2020 2020 635f  ..            c_
-0001c600: 6178 6573 3d63 6f6d 706c 656d 656e 745f  axes=complement_
-0001c610: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-0001c620: 6178 6573 292c 0d0a 2020 2020 2020 2020  axes),..        
-0001c630: 2020 2020 6172 6773 3d28 7365 6c65 6d2c      args=(selem,
-0001c640: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0001c650: 6474 7970 653d 626f 6f6c 0d0a 2020 2020  dtype=bool..    
-0001c660: 2020 2020 292e 6173 7479 7065 2862 6f6f      ).astype(boo
-0001c670: 6c29 0d0a 2020 2020 2020 2020 0d0a 2020  l)..        ..  
-0001c680: 2020 405f 646f 6373 2e77 7269 7465 5f64    @_docs.write_d
-0001c690: 6f63 730d 0a20 2020 2040 6469 6d73 5f74  ocs..    @dims_t
-0001c6a0: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
-0001c6b0: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
-0001c6c0: 5f61 6e64 5f6f 7574 7075 7428 6f6e 6c79  _and_output(only
-0001c6d0: 5f62 696e 6172 793d 5472 7565 290d 0a20  _binary=True).. 
-0001c6e0: 2020 2064 6566 2063 6f75 6e74 5f6e 6569     def count_nei
-0001c6f0: 6768 626f 7273 280d 0a20 2020 2020 2020  ghbors(..       
-0001c700: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
-0001c710: 2a2c 200d 0a20 2020 2020 2020 2063 6f6e  *, ..        con
-0001c720: 6e65 6374 6976 6974 793a 2069 6e74 207c  nectivity: int |
-0001c730: 204e 6f6e 6520 3d20 4e6f 6e65 2c0d 0a20   None = None,.. 
-0001c740: 2020 2020 2020 206d 6173 6b3a 2062 6f6f         mask: boo
-0001c750: 6c20 3d20 5472 7565 2c0d 0a20 2020 2020  l = True,..     
-0001c760: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
-0001c770: 4e6f 6e65 2c0d 0a20 2020 2029 202d 3e20  None,..    ) -> 
-0001c780: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
-0001c790: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0001c7a0: 436f 756e 7420 7468 6520 6e75 6d62 6572  Count the number
-0001c7b0: 206f 7220 6e65 6967 6862 6f72 7320 6f66   or neighbors of
-0001c7c0: 2062 696e 6172 7920 696d 6167 6573 2e20   binary images. 
-0001c7d0: 5468 6973 2066 756e 6374 696f 6e20 6361  This function ca
-0001c7e0: 6e20 6265 2075 7365 6420 666f 7220 6372  n be used for cr
-0001c7f0: 6f73 7320 7365 6374 696f 6e0d 0a20 2020  oss section..   
-0001c800: 2020 2020 206f 7220 6272 616e 6368 2064       or branch d
-0001c810: 6574 6563 7469 6f6e 2e20 4f6e 6c79 2077  etection. Only w
-0001c820: 6f72 6b73 2066 6f72 2062 696e 6172 7920  orks for binary 
-0001c830: 696d 6167 6573 2e0d 0a0d 0a20 2020 2020  images.....     
-0001c840: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-0001c850: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001c860: 2d0d 0a20 2020 2020 2020 207b 636f 6e6e  -..        {conn
-0001c870: 6563 7469 7669 7479 7d0d 0a20 2020 2020  ectivity}..     
-0001c880: 2020 206d 6173 6b20 3a20 626f 6f6c 2c20     mask : bool, 
-0001c890: 6465 6661 756c 7420 6973 2054 7275 650d  default is True.
-0001c8a0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0001c8b0: 5472 7565 2c20 6f6e 6c79 206e 6569 6768  True, only neigh
-0001c8c0: 626f 7273 206f 6620 7069 7865 6c73 2074  bors of pixels t
-0001c8d0: 6861 7420 7361 7469 7366 7920 7365 6c66  hat satisfy self
-0001c8e0: 3d3d 5472 7565 2069 7320 7265 7475 726e  ==True is return
-0001c8f0: 6564 2e0d 0a20 2020 2020 2020 207b 6469  ed...        {di
-0001c900: 6d73 7d0d 0a0d 0a20 2020 2020 2020 2052  ms}....        R
-0001c910: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-0001c920: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0001c930: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
-0001c940: 2020 2020 2020 2075 696e 7438 2061 7272         uint8 arr
-0001c950: 6179 206f 6620 7468 6520 6e75 6d62 6572  ay of the number
-0001c960: 206f 6620 6e65 6967 6862 6f72 732e 0d0a   of neighbors...
-0001c970: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0001c980: 2020 2020 2020 4578 616d 706c 6573 0d0a        Examples..
-0001c990: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0001c9a0: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-0001c9b0: 3e20 736b 6c20 3d20 696d 672e 7468 7265  > skl = img.thre
-0001c9c0: 7368 6f6c 6428 292e 736b 656c 6574 6f6e  shold().skeleton
-0001c9d0: 697a 6528 290d 0a20 2020 2020 2020 2020  ize()..         
-0001c9e0: 2020 203e 3e3e 2065 6467 6520 3d20 736b     >>> edge = sk
-0001c9f0: 6c2e 636f 756e 745f 6e65 6967 6862 6f72  l.count_neighbor
-0001ca00: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
-0001ca10: 203e 3e3e 206e 702e 6172 6777 6865 7265   >>> np.argwhere
-0001ca20: 2865 6467 6520 3d3d 2031 2920 2320 6765  (edge == 1) # ge
-0001ca30: 7420 636f 6f72 6469 6e61 7465 7320 6f66  t coordinates of
-0001ca40: 2066 696c 616d 656e 7420 6564 6765 732e   filament edges.
-0001ca50: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-0001ca60: 3e20 6e70 2e61 7267 7768 6572 6528 6564  > np.argwhere(ed
-0001ca70: 6765 203e 3d20 3329 2023 2067 6574 2063  ge >= 3) # get c
-0001ca80: 6f6f 7264 696e 6174 6573 206f 6620 6669  oordinates of fi
-0001ca90: 6c61 6d65 6e74 2063 726f 7373 2073 6563  lament cross sec
-0001caa0: 7469 6f6e 732e 0d0a 2020 2020 2020 2020  tions...        
-0001cab0: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
-0001cac0: 2020 2020 200d 0a20 2020 2020 2020 206e       ..        n
-0001cad0: 6469 6d20 3d20 6c65 6e28 6469 6d73 290d  dim = len(dims).
-0001cae0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-0001caf0: 6976 6974 7920 3d20 6e64 696d 2069 6620  ivity = ndim if 
-0001cb00: 636f 6e6e 6563 7469 7669 7479 2069 7320  connectivity is 
-0001cb10: 4e6f 6e65 2065 6c73 6520 636f 6e6e 6563  None else connec
-0001cb20: 7469 7669 7479 0d0a 2020 2020 2020 2020  tivity..        
-0001cb30: 7365 6c65 6d20 3d20 6e64 692e 6d6f 7270  selem = ndi.morp
-0001cb40: 686f 6c6f 6779 2e67 656e 6572 6174 655f  hology.generate_
-0001cb50: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
-0001cb60: 286e 6469 6d2c 2063 6f6e 6e65 6374 6976  (ndim, connectiv
-0001cb70: 6974 7929 0d0a 2020 2020 2020 2020 7365  ity)..        se
-0001cb80: 6c65 6d5b 2831 2c29 2a6e 6469 6d5d 203d  lem[(1,)*ndim] =
-0001cb90: 2030 0d0a 2020 2020 2020 2020 6f75 7420   0..        out 
-0001cba0: 3d20 7365 6c66 2e61 735f 7569 6e74 3828  = self.as_uint8(
-0001cbb0: 292e 5f61 7070 6c79 5f64 6173 6b28 0d0a  )._apply_dask(..
-0001cbc0: 2020 2020 2020 2020 2020 2020 5f66 696c              _fil
-0001cbd0: 7465 7273 2e70 6f70 756c 6174 696f 6e2c  ters.population,
-0001cbe0: 200d 0a20 2020 2020 2020 2020 2020 2063   ..            c
-0001cbf0: 5f61 7865 733d 636f 6d70 6c65 6d65 6e74  _axes=complement
-0001cc00: 5f61 7865 7328 6469 6d73 2c20 7365 6c66  _axes(dims, self
-0001cc10: 2e61 7865 7329 2c20 0d0a 2020 2020 2020  .axes), ..      
-0001cc20: 2020 2020 2020 6172 6773 3d28 7365 6c65        args=(sele
-0001cc30: 6d2c 290d 0a20 2020 2020 2020 2029 0d0a  m,)..        )..
-0001cc40: 2020 2020 2020 2020 6966 206d 6173 6b3a          if mask:
-0001cc50: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-0001cc60: 745b 7e73 656c 662e 7661 6c75 655d 203d  t[~self.value] =
-0001cc70: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-0001cc80: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001cc90: 206f 7574 2e61 7374 7970 6528 6e70 2e75   out.astype(np.u
-0001cca0: 696e 7438 290d 0a20 2020 200d 0a20 2020  int8)..    ..   
-0001ccb0: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
-0001ccc0: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
-0001ccd0: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
-0001cce0: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
-0001ccf0: 616e 645f 6f75 7470 7574 286f 6e6c 795f  and_output(only_
-0001cd00: 6269 6e61 7279 3d54 7275 6529 0d0a 2020  binary=True)..  
-0001cd10: 2020 6465 6620 7265 6d6f 7665 5f73 6b65    def remove_ske
-0001cd20: 6c65 746f 6e5f 7374 7275 6374 7572 6528  leton_structure(
-0001cd30: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
-0001cd40: 0a20 2020 2020 2020 2073 7472 7563 7475  .        structu
-0001cd50: 7265 3a20 4c69 7465 7261 6c5b 2274 6970  re: Literal["tip
-0001cd60: 222c 2022 6272 616e 6368 222c 2022 6372  ", "branch", "cr
-0001cd70: 6f73 7322 5d20 3d20 2274 6970 222c 0d0a  oss"] = "tip",..
-0001cd80: 2020 2020 2020 2020 2a2c 0d0a 2020 2020          *,..    
-0001cd90: 2020 2020 636f 6e6e 6563 7469 7669 7479      connectivity
-0001cda0: 3a20 696e 7420 3d20 4e6f 6e65 2c0d 0a20  : int = None,.. 
-0001cdb0: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
-0001cdc0: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
-0001cdd0: 2020 2075 7064 6174 653a 2062 6f6f 6c20     update: bool 
-0001cde0: 3d20 4661 6c73 652c 0d0a 2020 2020 2920  = False,..    ) 
-0001cdf0: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
-0001ce00: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0001ce10: 2020 2052 656d 6f76 6520 6365 7274 6169     Remove certai
-0001ce20: 6e20 7374 7275 6374 7572 6520 6672 6f6d  n structure from
-0001ce30: 2073 6b65 6c65 746f 6e69 7a65 6420 696d   skeletonized im
-0001ce40: 6167 6573 2e0d 0a0d 0a20 2020 2020 2020  ages.....       
-0001ce50: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
-0001ce60: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
-0001ce70: 0a20 2020 2020 2020 2073 7472 7563 7475  .        structu
-0001ce80: 7265 203a 2073 7472 2c20 6465 6661 756c  re : str, defaul
-0001ce90: 7420 6973 2022 7469 7022 0d0a 2020 2020  t is "tip"..    
-0001cea0: 2020 2020 2020 2020 5768 6174 2074 7970          What typ
-0001ceb0: 6520 6f66 2073 7472 7563 7475 7265 2074  e of structure t
-0001cec0: 6f20 7265 6d6f 7665 2e0d 0a20 2020 2020  o remove...     
-0001ced0: 2020 207b 636f 6e6e 6563 7469 7669 7479     {connectivity
-0001cee0: 7d0d 0a20 2020 2020 2020 207b 6469 6d73  }..        {dims
-0001cef0: 7d7b 7570 6461 7465 7d0d 0a0d 0a20 2020  }{update}....   
-0001cf00: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-0001cf10: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-0001cf20: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
-0001cf30: 0a20 2020 2020 2020 2020 2020 2050 726f  .            Pro
-0001cf40: 6365 7373 6564 2069 6d61 6765 2e0d 0a20  cessed image... 
-0001cf50: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-0001cf60: 2020 0d0a 2020 2020 2020 2020 6f75 7420    ..        out 
-0001cf70: 3d20 7365 6c66 2e63 6f70 7928 290d 0a20  = self.copy().. 
-0001cf80: 2020 2020 2020 206e 6569 6768 626f 7220         neighbor 
-0001cf90: 3d20 7365 6c66 2e63 6f75 6e74 5f6e 6569  = self.count_nei
-0001cfa0: 6768 626f 7273 2863 6f6e 6e65 6374 6976  ghbors(connectiv
-0001cfb0: 6974 793d 636f 6e6e 6563 7469 7669 7479  ity=connectivity
-0001cfc0: 2c20 6469 6d73 3d64 696d 7329 0d0a 2020  , dims=dims)..  
-0001cfd0: 2020 2020 2020 6966 2073 7472 7563 7475        if structu
-0001cfe0: 7265 203d 3d20 2274 6970 223a 0d0a 2020  re == "tip":..  
-0001cff0: 2020 2020 2020 2020 2020 736c 203d 206e            sl = n
-0001d000: 6569 6768 626f 7220 3d3d 2031 0d0a 2020  eighbor == 1..  
-0001d010: 2020 2020 2020 656c 6966 2073 7472 7563        elif struc
-0001d020: 7475 7265 203d 3d20 2262 7261 6e63 6822  ture == "branch"
-0001d030: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0001d040: 6c20 3d20 6e65 6967 6862 6f72 203e 2032  l = neighbor > 2
-0001d050: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
-0001d060: 7472 7563 7475 7265 203d 3d20 2263 726f  tructure == "cro
-0001d070: 7373 223a 0d0a 2020 2020 2020 2020 2020  ss":..          
-0001d080: 2020 736c 203d 206e 6569 6768 626f 7220    sl = neighbor 
-0001d090: 3e20 330d 0a20 2020 2020 2020 2065 6c73  > 3..        els
-0001d0a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001d0b0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0001d0c0: 2822 606d 6f64 6560 206d 7573 7420 6265  ("`mode` must be
-0001d0d0: 206f 6e65 206f 6620 7b27 7469 7027 2c20   one of {'tip', 
-0001d0e0: 2762 7261 6e63 6827 2c20 2763 726f 7373  'branch', 'cross
-0001d0f0: 277d 2e22 290d 0a20 2020 2020 2020 206f  '}.")..        o
-0001d100: 7574 2e76 616c 7565 5b73 6c5d 203d 2030  ut.value[sl] = 0
-0001d110: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001d120: 206f 7574 0d0a 2020 2020 0d0a 2020 2020   out..    ..    
-0001d130: 4064 696d 735f 746f 5f73 7061 7469 616c  @dims_to_spatial
-0001d140: 5f61 7865 730d 0a20 2020 2040 6368 6563  _axes..    @chec
-0001d150: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-0001d160: 7574 286e 6565 645f 6c61 6265 6c73 3d54  ut(need_labels=T
-0001d170: 7275 6529 0d0a 2020 2020 6465 6620 7761  rue)..    def wa
-0001d180: 7465 7273 6865 6428 0d0a 2020 2020 2020  tershed(..      
-0001d190: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
-0001d1a0: 2063 6f6f 7264 733a 204d 6172 6b65 7246   coords: MarkerF
-0001d1b0: 7261 6d65 207c 204e 6f6e 6520 3d20 4e6f  rame | None = No
-0001d1c0: 6e65 2c0d 0a20 2020 2020 2020 202a 2c0d  ne,..        *,.
-0001d1d0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-0001d1e0: 6976 6974 793a 2069 6e74 203d 2031 2c0d  ivity: int = 1,.
-0001d1f0: 0a20 2020 2020 2020 2069 6e70 7574 3a20  .        input: 
-0001d200: 4c69 7465 7261 6c5b 2273 656c 6622 2c20  Literal["self", 
-0001d210: 2264 6973 7461 6e63 6522 5d20 3d20 2264  "distance"] = "d
-0001d220: 6973 7461 6e63 6522 2c20 0d0a 2020 2020  istance", ..    
-0001d230: 2020 2020 6d69 6e5f 6469 7374 616e 6365      min_distance
-0001d240: 3a20 666c 6f61 7420 3d20 322c 0d0a 2020  : float = 2,..  
-0001d250: 2020 2020 2020 6469 6d73 3a20 4469 6d73        dims: Dims
-0001d260: 203d 204e 6f6e 652c 0d0a 2020 2020 2920   = None,..    ) 
-0001d270: 2d3e 204c 6162 656c 3a0d 0a20 2020 2020  -> Label:..     
-0001d280: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0001d290: 4c61 6265 6c20 7365 676d 656e 7461 7469  Label segmentati
-0001d2a0: 6f6e 2075 7369 6e67 2077 6174 6572 7368  on using watersh
-0001d2b0: 6564 2061 6c67 6f72 6974 686d 2e0d 0a0d  ed algorithm....
-0001d2c0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0001d2d0: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-0001d2e0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0001d2f0: 2063 6f6f 7264 7320 3a20 4d61 726b 6572   coords : Marker
-0001d300: 4672 616d 652c 206f 7074 696f 6e61 6c0d  Frame, optional.
-0001d310: 0a20 2020 2020 2020 2020 2020 2052 6574  .            Ret
-0001d320: 7572 6e65 6420 6279 2073 7563 6820 6173  urned by such as
-0001d330: 2060 7065 616b 5f6c 6f63 616c 5f6d 6178   `peak_local_max
-0001d340: 2829 602e 2041 7272 6179 206f 6620 636f  ()`. Array of co
-0001d350: 6f72 6469 6e61 7465 7320 6f66 2070 6561  ordinates of pea
-0001d360: 6b73 2e0d 0a20 2020 2020 2020 207b 636f  ks...        {co
-0001d370: 6e6e 6563 7469 7669 7479 7d0d 0a20 2020  nnectivity}..   
-0001d380: 2020 2020 2069 6e70 7574 203a 2073 7472       input : str
-0001d390: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-0001d3a0: 2020 2020 2020 2020 5768 6174 2069 6d61          What ima
-0001d3b0: 6765 2077 696c 6c20 6265 2074 6865 2069  ge will be the i
-0001d3c0: 6e70 7574 206f 6620 7761 7465 7273 6865  nput of watershe
-0001d3d0: 6420 616c 676f 7269 7468 6d2e 2020 2020  d algorithm.    
-0001d3e0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001d3f0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0001d400: 2020 2020 2d20 2273 656c 6622 202e 2e2e      - "self" ...
-0001d410: 2073 656c 6620 6973 2075 7365 642e 0d0a   self is used...
-0001d420: 2020 2020 2020 2020 2020 2020 2d20 2264              - "d
-0001d430: 6973 7461 6e63 6522 202e 2e2e 2064 6973  istance" ... dis
-0001d440: 7461 6e63 6520 6d61 7020 6f66 2073 656c  tance map of sel
-0001d450: 662e 6c61 6265 6c73 2069 7320 7573 6564  f.labels is used
-0001d460: 2e0d 0a20 2020 2020 2020 2020 2020 200d  ...            .
-0001d470: 0a20 2020 2020 2020 207b 6469 6d73 7d0d  .        {dims}.
-0001d480: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-0001d490: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
-0001d4a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
-0001d4b0: 0a20 2020 2020 2020 204c 6162 656c 0d0a  .        Label..
-0001d4c0: 2020 2020 2020 2020 2020 2020 5570 6461              Upda
-0001d4d0: 7465 6420 6c61 6265 6c73 2e0d 0a20 2020  ted labels...   
-0001d4e0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0001d4f0: 2020 0d0a 2020 2020 2020 2020 2320 5072    ..        # Pr
-0001d500: 6570 6172 6520 7468 6520 696e 7075 7420  epare the input 
-0001d510: 696d 6167 652e 0d0a 2020 2020 2020 2020  image...        
-0001d520: 6966 2069 6e70 7574 203d 3d20 2273 656c  if input == "sel
-0001d530: 6622 3a0d 0a20 2020 2020 2020 2020 2020  f":..           
-0001d540: 2069 6e70 7574 5f69 6d67 203d 2073 656c   input_img = sel
-0001d550: 662e 636f 7079 2829 0d0a 2020 2020 2020  f.copy()..      
-0001d560: 2020 656c 6966 2069 6e70 7574 203d 3d20    elif input == 
-0001d570: 2264 6973 7461 6e63 6522 3a0d 0a20 2020  "distance":..   
-0001d580: 2020 2020 2020 2020 2069 6e70 7574 5f69           input_i
-0001d590: 6d67 203d 2073 656c 662e 5f5f 636c 6173  mg = self.__clas
-0001d5a0: 735f 5f28 7365 6c66 2e6c 6162 656c 733e  s__(self.labels>
-0001d5b0: 302c 2061 7865 733d 7365 6c66 2e61 7865  0, axes=self.axe
-0001d5c0: 7329 2e64 6973 7461 6e63 655f 6d61 7028  s).distance_map(
-0001d5d0: 6469 6d73 3d64 696d 7329 0d0a 2020 2020  dims=dims)..    
-0001d5e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0001d5f0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0001d600: 7565 4572 726f 7228 2227 696e 7075 745f  ueError("'input_
-0001d610: 2720 6d75 7374 2062 6520 6569 7468 6572  ' must be either
-0001d620: 2027 7365 6c66 2720 6f72 2027 6469 7374   'self' or 'dist
-0001d630: 616e 6365 272e 2229 0d0a 2020 2020 2020  ance'.")..      
-0001d640: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0001d650: 2020 2020 6966 2069 6e70 7574 5f69 6d67      if input_img
-0001d660: 2e64 7479 7065 203d 3d20 626f 6f6c 3a0d  .dtype == bool:.
-0001d670: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-0001d680: 7574 5f69 6d67 203d 2069 6e70 7574 5f69  ut_img = input_i
-0001d690: 6d67 2e61 7374 7970 6528 6e70 2e75 696e  mg.astype(np.uin
-0001d6a0: 7438 290d 0a20 2020 2020 2020 2020 2020  t8)..           
-0001d6b0: 200d 0a20 2020 2020 2020 2069 6e70 7574   ..        input
-0001d6c0: 5f69 6d67 2e6c 6162 656c 7320 3d20 7365  _img.labels = se
-0001d6d0: 6c66 2e6c 6162 656c 730d 0a20 2020 2020  lf.labels..     
-0001d6e0: 2020 200d 0a20 2020 2020 2020 2069 6620     ..        if 
-0001d6f0: 636f 6f72 6473 2069 7320 4e6f 6e65 3a0d  coords is None:.
-0001d700: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
-0001d710: 7264 7320 3d20 696e 7075 745f 696d 672e  rds = input_img.
-0001d720: 7065 616b 5f6c 6f63 616c 5f6d 6178 286d  peak_local_max(m
-0001d730: 696e 5f64 6973 7461 6e63 653d 6d69 6e5f  in_distance=min_
-0001d740: 6469 7374 616e 6365 2c20 6469 6d73 3d64  distance, dims=d
-0001d750: 696d 7329 0d0a 2020 2020 2020 2020 0d0a  ims)..        ..
-0001d760: 2020 2020 2020 2020 6c61 6265 6c73 203d          labels =
-0001d770: 206c 6172 6765 7374 5f7a 6572 6f73 2869   largest_zeros(i
-0001d780: 6e70 7574 5f69 6d67 2e73 6861 7065 290d  nput_img.shape).
-0001d790: 0a20 2020 2020 2020 2073 6861 7065 203d  .        shape =
-0001d7a0: 2073 656c 662e 7369 7a65 736f 6628 6469   self.sizesof(di
-0001d7b0: 6d73 290d 0a20 2020 2020 2020 206e 5f6c  ms)..        n_l
-0001d7c0: 6162 656c 7320 3d20 300d 0a20 2020 2020  abels = 0..     
-0001d7d0: 2020 2063 5f61 7865 7320 3d20 636f 6d70     c_axes = comp
-0001d7e0: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
-0001d7f0: 2c20 7365 6c66 2e61 7865 7329 0d0a 2020  , self.axes)..  
-0001d800: 2020 2020 2020 6d61 726b 6572 7320 3d20        markers = 
-0001d810: 6e70 2e7a 6572 6f73 2873 6861 7065 2c20  np.zeros(shape, 
-0001d820: 6474 7970 653d 6c61 6265 6c73 2e64 7479  dtype=labels.dty
-0001d830: 7065 2920 2320 706c 6163 6568 6f6c 6465  pe) # placeholde
-0001d840: 7220 666f 7220 6d61 7869 6d61 0d0a 2020  r for maxima..  
-0001d850: 2020 2020 2020 666f 7220 736c 2c20 6372        for sl, cr
-0001d860: 6420 696e 2063 6f6f 7264 732e 6974 6572  d in coords.iter
-0001d870: 2863 5f61 7865 7329 3a0d 0a20 2020 2020  (c_axes):..     
-0001d880: 2020 2020 2020 2023 2063 7264 2e76 616c         # crd.val
-0001d890: 7565 7320 6973 2028 4e2c 2032 2920 6172  ues is (N, 2) ar
-0001d8a0: 7261 7920 736f 2074 7570 6c65 2863 7264  ray so tuple(crd
-0001d8b0: 2e76 616c 7565 732e 542e 746f 6c69 7374  .values.T.tolist
-0001d8c0: 2829 2920 6973 2074 776f 2028 4e2c 2920  ()) is two (N,) 
-0001d8d0: 6c69 7374 2e0d 0a20 2020 2020 2020 2020  list...         
-0001d8e0: 2020 2063 7264 203d 2063 7264 2e76 616c     crd = crd.val
-0001d8f0: 7565 732e 542e 746f 6c69 7374 2829 0d0a  ues.T.tolist()..
-0001d900: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-0001d910: 6572 735b 7475 706c 6528 6372 6429 5d20  ers[tuple(crd)] 
-0001d920: 3d20 6e70 2e61 7261 6e67 6528 312c 206c  = np.arange(1, l
-0001d930: 656e 2863 7264 5b30 5d29 2b31 2c20 6474  en(crd[0])+1, dt
-0001d940: 7970 653d 6c61 6265 6c73 2e64 7479 7065  ype=labels.dtype
-0001d950: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
-0001d960: 6162 656c 735b 736c 5d20 3d20 736b 7365  abels[sl] = skse
-0001d970: 672e 7761 7465 7273 6865 6428 2d69 6e70  g.watershed(-inp
-0001d980: 7574 5f69 6d67 2e76 616c 7565 5b73 6c5d  ut_img.value[sl]
-0001d990: 2c20 6d61 726b 6572 732c 200d 0a20 2020  , markers, ..   
-0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9c0: 2020 2020 206d 6173 6b3d 696e 7075 745f       mask=input_
-0001d9d0: 696d 672e 6c61 6265 6c73 2e76 616c 7565  img.labels.value
-0001d9e0: 5b73 6c5d 2c20 0d0a 2020 2020 2020 2020  [sl], ..        
-0001d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da10: 636f 6e6e 6563 7469 7669 7479 3d63 6f6e  connectivity=con
-0001da20: 6e65 6374 6976 6974 7929 0d0a 2020 2020  nectivity)..    
-0001da30: 2020 2020 2020 2020 6c61 6265 6c73 5b73          labels[s
-0001da40: 6c5d 5b6c 6162 656c 735b 736c 5d3e 305d  l][labels[sl]>0]
-0001da50: 202b 3d20 6e5f 6c61 6265 6c73 0d0a 2020   += n_labels..  
-0001da60: 2020 2020 2020 2020 2020 6e5f 6c61 6265            n_labe
-0001da70: 6c73 203d 206c 6162 656c 735b 736c 5d2e  ls = labels[sl].
-0001da80: 6d61 7828 290d 0a20 2020 2020 2020 2020  max()..         
-0001da90: 2020 206d 6172 6b65 7273 5b3a 5d20 3d20     markers[:] = 
-0001daa0: 3020 2320 7265 7365 7420 706c 6163 6568  0 # reset placeh
-0001dab0: 6f6c 6465 720d 0a20 2020 2020 2020 200d  older..        .
-0001dac0: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
-0001dad0: 3d20 6c61 6265 6c73 2e76 6965 7728 4c61  = labels.view(La
-0001dae0: 6265 6c29 0d0a 2020 2020 2020 2020 7365  bel)..        se
-0001daf0: 6c66 2e6c 6162 656c 7320 3d20 6c61 6265  lf.labels = labe
-0001db00: 6c73 2e6f 7074 696d 697a 6528 290d 0a20  ls.optimize().. 
-0001db10: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
-0001db20: 6c73 2e5f 7365 745f 696e 666f 2873 656c  ls._set_info(sel
-0001db30: 6629 0d0a 2020 2020 2020 2020 7365 6c66  f)..        self
-0001db40: 2e6c 6162 656c 732e 7365 745f 7363 616c  .labels.set_scal
-0001db50: 6528 7365 6c66 290d 0a20 2020 2020 2020  e(self)..       
-0001db60: 2072 6574 7572 6e20 7365 6c66 2e6c 6162   return self.lab
-0001db70: 656c 730d 0a20 2020 200d 0a20 2020 2040  els..    ..    @
-0001db80: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
-0001db90: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
-0001dba0: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
-0001dbb0: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
-0001dbc0: 645f 6f75 7470 7574 286e 6565 645f 6c61  d_output(need_la
-0001dbd0: 6265 6c73 3d54 7275 6529 0d0a 2020 2020  bels=True)..    
-0001dbe0: 6465 6620 7261 6e64 6f6d 5f77 616c 6b65  def random_walke
-0001dbf0: 7228 0d0a 2020 2020 2020 2020 7365 6c66  r(..        self
-0001dc00: 2c0d 0a20 2020 2020 2020 2062 6574 613a  ,..        beta:
-0001dc10: 2066 6c6f 6174 203d 2031 3330 2c0d 0a20   float = 130,.. 
-0001dc20: 2020 2020 2020 206d 6f64 653a 204c 6974         mode: Lit
-0001dc30: 6572 616c 5b22 6367 222c 2022 6367 5f6a  eral["cg", "cg_j
-0001dc40: 222c 2022 6367 5f6d 6722 2c20 2262 6622  ", "cg_mg", "bf"
-0001dc50: 5d20 3d20 2263 675f 6a22 2c20 0d0a 2020  ] = "cg_j", ..  
-0001dc60: 2020 2020 2020 746f 6c3a 2066 6c6f 6174        tol: float
-0001dc70: 203d 2031 652d 332c 200d 0a20 2020 2020   = 1e-3, ..     
-0001dc80: 2020 202a 2c0d 0a20 2020 2020 2020 2064     *,..        d
-0001dc90: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
-0001dca0: 2c0d 0a20 2020 2029 202d 3e20 4c61 6265  ,..    ) -> Labe
-0001dcb0: 6c3a 0d0a 2020 2020 2020 2020 2222 220d  l:..        """.
-0001dcc0: 0a20 2020 2020 2020 2052 616e 646f 6d20  .        Random 
-0001dcd0: 7761 6c6b 6572 2073 6567 6d65 6e74 6174  walker segmentat
-0001dce0: 696f 6e2e 204f 6e6c 7920 7772 6170 7065  ion. Only wrappe
-0001dcf0: 6420 736b 696d 6167 6520 7365 676d 656e  d skimage segmen
-0001dd00: 7461 7469 6f6e 2e20 0d0a 2020 2020 2020  tation. ..      
-0001dd10: 2020 0d0a 2020 2020 2020 2020 6060 7365    ..        ``se
-0001dd20: 6c66 2e6c 6162 656c 7360 6020 7769 6c6c  lf.labels`` will
-0001dd30: 2062 6520 7365 676d 656e 7465 6420 616e   be segmented an
-0001dd40: 6420 7570 6461 7465 6420 696e 706c 6163  d updated inplac
-0001dd50: 652e 0d0a 0d0a 2020 2020 2020 2020 5061  e.....        Pa
-0001dd60: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
-0001dd70: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-0001dd80: 2020 2020 2020 6265 7461 2c20 6d6f 6465        beta, mode
-0001dd90: 2c20 746f 6c0d 0a20 2020 2020 2020 2020  , tol..         
-0001dda0: 2020 2073 6565 2073 6b69 6d61 6765 2e73     see skimage.s
-0001ddb0: 6567 6d65 6e74 6174 696f 6e2e 7261 6e64  egmentation.rand
-0001ddc0: 6f6d 5f77 616c 6b65 720d 0a20 2020 2020  om_walker..     
-0001ddd0: 2020 207b 6469 6d73 7d0d 0a0d 0a20 2020     {dims}....   
-0001dde0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-0001ddf0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-0001de00: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
-0001de10: 0a20 2020 2020 2020 2020 2020 2052 656c  .            Rel
-0001de20: 6162 656c 6564 2069 6d61 6765 2e0d 0a20  abeled image... 
-0001de30: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-0001de40: 2020 0d0a 2020 2020 2020 2020 635f 6178    ..        c_ax
-0001de50: 6573 203d 2063 6f6d 706c 656d 656e 745f  es = complement_
-0001de60: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-0001de70: 6178 6573 290d 0a20 2020 2020 2020 200d  axes)..        .
-0001de80: 0a20 2020 2020 2020 2066 6f72 2073 6c2c  .        for sl,
-0001de90: 2069 6d67 2069 6e20 7365 6c66 2e69 7465   img in self.ite
-0001dea0: 7228 635f 6178 6573 2c20 6973 7261 773d  r(c_axes, israw=
-0001deb0: 5472 7565 293a 0d0a 2020 2020 2020 2020  True):..        
-0001dec0: 2020 2020 696d 672e 6c61 6265 6c73 5b3a      img.labels[:
-0001ded0: 5d20 3d20 736b 7365 672e 7261 6e64 6f6d  ] = skseg.random
-0001dee0: 5f77 616c 6b65 7228 0d0a 2020 2020 2020  _walker(..      
-0001def0: 2020 2020 2020 2020 2020 696d 672e 7661            img.va
-0001df00: 6c75 652c 2069 6d67 2e6c 6162 656c 732e  lue, img.labels.
-0001df10: 7661 6c75 652c 2062 6574 613d 6265 7461  value, beta=beta
-0001df20: 2c20 6d6f 6465 3d6d 6f64 652c 2074 6f6c  , mode=mode, tol
-0001df30: 3d74 6f6c 0d0a 2020 2020 2020 2020 2020  =tol..          
-0001df40: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-0001df50: 200d 0a20 2020 2020 2020 2073 656c 662e   ..        self.
-0001df60: 6c61 6265 6c73 2e5f 7365 745f 696e 666f  labels._set_info
-0001df70: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
-0001df80: 7265 7475 726e 2073 656c 662e 6c61 6265  return self.labe
-0001df90: 6c73 0d0a 2020 2020 0d0a 2020 2020 6465  ls..    ..    de
-0001dfa0: 6620 6c61 6265 6c5f 7468 7265 7368 6f6c  f label_threshol
-0001dfb0: 6428 0d0a 2020 2020 2020 2020 7365 6c66  d(..        self
-0001dfc0: 2c0d 0a20 2020 2020 2020 2074 6872 3a20  ,..        thr: 
-0001dfd0: 666c 6f61 7420 7c20 5468 7265 6173 686f  float | Threasho
-0001dfe0: 6c64 4d65 7468 6f64 203d 2022 6f74 7375  ldMethod = "otsu
-0001dff0: 222c 0d0a 2020 2020 2020 2020 6669 6c74  ",..        filt
-0001e000: 3a20 4361 6c6c 6162 6c65 5b2e 2e2e 2c20  : Callable[..., 
-0001e010: 626f 6f6c 5d20 7c20 4e6f 6e65 203d 204e  bool] | None = N
-0001e020: 6f6e 652c 0d0a 2020 2020 2020 2020 2a2c  one,..        *,
-0001e030: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
-0001e040: 4469 6d73 203d 204e 6f6e 652c 0d0a 2020  Dims = None,..  
-0001e050: 2020 2020 2020 2a2a 6b77 6172 6773 2c0d        **kwargs,.
-0001e060: 0a20 2020 2029 202d 3e20 4c61 6265 6c3a  .    ) -> Label:
-0001e070: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0001e080: 2020 2020 2020 204d 616b 6520 6c61 6265         Make labe
-0001e090: 6c73 2077 6974 6820 7468 7265 7368 6f6c  ls with threshol
-0001e0a0: 6428 292e 2042 6520 7375 7265 2074 6861  d(). Be sure tha
-0001e0b0: 7420 6b65 7977 6f72 6420 6172 6775 6d65  t keyword argume
-0001e0c0: 6e74 2060 6064 696d 7360 6020 6361 6e20  nt ``dims`` can 
-0001e0d0: 6265 0d0a 2020 2020 2020 2020 6469 6666  be..        diff
-0001e0e0: 6572 656e 7420 2869 6e20 6d6f 7374 2063  erent (in most c
-0001e0f0: 6173 6573 2066 6f72 203e 3444 2069 6d61  ases for >4D ima
-0001e100: 6765 7329 2062 6574 7765 656e 2074 6872  ges) between thr
-0001e110: 6573 686f 6c64 2829 2061 6e64 206c 6162  eshold() and lab
-0001e120: 656c 2829 2e0d 0a20 2020 2020 2020 2049  el()...        I
-0001e130: 6e20 7468 6973 2066 756e 6374 696f 6e2c  n this function,
-0001e140: 2062 6f74 6820 6675 6e63 7469 6f6e 2077   both function w
-0001e150: 696c 6c20 6861 7665 2074 6865 2073 616d  ill have the sam
-0001e160: 6520 6060 6469 6d73 6060 2066 6f72 2073  e ``dims`` for s
-0001e170: 696d 706c 6963 6974 792e 0d0a 0d0a 2020  implicity.....  
-0001e180: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0001e190: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0001e1a0: 2d2d 2d2d 0d0a 2020 2020 2020 2020 7468  ----..        th
-0001e1b0: 723a 2066 6c6f 6174 206f 7220 7374 7220  r: float or str 
-0001e1c0: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
-0001e1d0: 6c0d 0a20 2020 2020 2020 2020 2020 2054  l..            T
-0001e1e0: 6872 6573 686f 6c64 2076 616c 7565 2c20  hreshold value, 
-0001e1f0: 6f72 2074 6872 6573 686f 6c64 696e 6720  or thresholding 
-0001e200: 616c 676f 7269 7468 6d2e 0d0a 2020 2020  algorithm...    
-0001e210: 2020 2020 7b64 696d 737d 0d0a 2020 2020      {dims}..    
-0001e220: 2020 2020 2a2a 6b77 6172 6773 3a0d 0a20      **kwargs:.. 
-0001e230: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
-0001e240: 7264 2061 7267 756d 656e 7473 2074 6861  rd arguments tha
-0001e250: 7420 7769 6c6c 2070 6173 7365 6420 746f  t will passed to
-0001e260: 2066 756e 6374 696f 6e20 696e 6469 6361   function indica
-0001e270: 7465 6420 696e 2027 6d65 7468 6f64 272e  ted in 'method'.
-0001e280: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0001e290: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0001e2a0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-0001e2b0: 2020 2020 2020 4c61 6265 6c0d 0a20 2020        Label..   
-0001e2c0: 2020 2020 2020 2020 204e 6577 6c79 2063           Newly c
-0001e2d0: 7265 6174 6564 206c 6162 656c 2e0d 0a20  reated label... 
-0001e2e0: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-0001e2f0: 2020 0d0a 2020 2020 2020 2020 6c61 6265    ..        labe
-0001e300: 6c73 203d 2073 656c 662e 7468 7265 7368  ls = self.thresh
-0001e310: 6f6c 6428 7468 723d 7468 722c 202a 2a6b  old(thr=thr, **k
-0001e320: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
-0001e330: 7265 7475 726e 2073 656c 662e 6c61 6265  return self.labe
-0001e340: 6c28 6c61 6265 6c73 2c20 6669 6c74 3d66  l(labels, filt=f
-0001e350: 696c 742c 2064 696d 733d 6469 6d73 290d  ilt, dims=dims).
-0001e360: 0a20 2020 200d 0a20 2020 2064 6566 2072  .    ..    def r
-0001e370: 6567 696f 6e70 726f 7073 280d 0a20 2020  egionprops(..   
-0001e380: 2020 2020 2073 656c 662c 0d0a 2020 2020       self,..    
-0001e390: 2020 2020 7072 6f70 6572 7469 6573 3a20      properties: 
-0001e3a0: 4974 6572 6162 6c65 5b73 7472 5d20 7c20  Iterable[str] | 
-0001e3b0: 7374 7220 3d20 2822 6d65 616e 5f69 6e74  str = ("mean_int
-0001e3c0: 656e 7369 7479 222c 292c 0d0a 2020 2020  ensity",),..    
-0001e3d0: 2020 2020 2a2c 200d 0a20 2020 2020 2020      *, ..       
-0001e3e0: 2065 7874 7261 5f70 726f 7065 7274 6965   extra_propertie
-0001e3f0: 733a 2049 7465 7261 626c 655b 4361 6c6c  s: Iterable[Call
-0001e400: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
-0001e410: 6f6e 652c 0d0a 2020 2020 2920 2d3e 2044  one,..    ) -> D
-0001e420: 6174 6144 6963 745b 7374 722c 2050 726f  ataDict[str, Pro
-0001e430: 7041 7272 6179 5d3a 0d0a 2020 2020 2020  pArray]:..      
-0001e440: 2020 2222 220d 0a20 2020 2020 2020 204d    """..        M
-0001e450: 756c 7469 2d64 696d 656e 7369 6f6e 616c  ulti-dimensional
-0001e460: 2072 6567 696f 6e20 7072 6f70 6572 7479   region property
-0001e470: 2071 7561 6e74 6966 6963 6174 696f 6e2e   quantification.
-0001e480: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0001e490: 2020 2020 5275 6e20 736b 696d 6167 6527      Run skimage'
-0001e4a0: 7320 7265 6769 6f6e 7072 6f70 7328 2920  s regionprops() 
-0001e4b0: 6675 6e63 7469 6f6e 2061 6e64 2072 6574  function and ret
-0001e4c0: 7572 6e20 7468 6520 7265 7375 6c74 7320  urn the results 
-0001e4d0: 6173 2050 726f 7041 7272 6179 2c20 736f  as PropArray, so
-0001e4e0: 0d0a 2020 2020 2020 2020 7468 6174 2079  ..        that y
-0001e4f0: 6f75 2063 616e 2061 6363 6573 7320 7573  ou can access us
-0001e500: 696e 6720 666c 6578 6962 6c65 2073 6c69  ing flexible sli
-0001e510: 6369 6e67 2e20 466f 7220 6578 616d 706c  cing. For exampl
-0001e520: 652c 2069 6620 6120 7463 7978 2d69 6d61  e, if a tcyx-ima
-0001e530: 6765 2069 730d 0a20 2020 2020 2020 2061  ge is..        a
-0001e540: 6e61 6c79 7a65 6420 7769 7468 2060 6070  nalyzed with ``p
-0001e550: 726f 7065 7274 6965 733d 2822 5822 2c20  roperties=("X", 
-0001e560: 2259 2229 6060 2c20 7468 656e 2079 6f75  "Y")``, then you
-0001e570: 2063 616e 2067 6574 2058 2773 2074 696d   can get X's tim
-0001e580: 652d 636f 7572 7365 2070 726f 6669 6c65  e-course profile
-0001e590: 0d0a 2020 2020 2020 2020 6f66 2063 6861  ..        of cha
-0001e5a0: 6e6e 656c 2031 2061 7420 6c61 6265 6c20  nnel 1 at label 
-0001e5b0: 3320 6279 2060 6070 726f 705b 2258 225d  3 by ``prop["X"]
-0001e5c0: 5b22 703d 353b 633d 3122 5d60 6020 6f72  ["p=5;c=1"]`` or
-0001e5d0: 2060 6070 726f 702e 585b 2270 3d35 3b63   ``prop.X["p=5;c
-0001e5e0: 3d31 225d 6060 2e0d 0a0d 0a20 2020 2020  =1"]``.....     
-0001e5f0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-0001e600: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001e610: 2d0d 0a20 2020 2020 2020 2070 726f 7065  -..        prope
-0001e620: 7274 6965 7320 3a20 6974 6572 6162 6c65  rties : iterable
-0001e630: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-0001e640: 2020 2020 2020 2020 7072 6f70 6572 7469          properti
-0001e650: 6573 2074 6f20 616e 616c 797a 652c 2073  es to analyze, s
-0001e660: 6565 2060 6073 6b69 6d61 6765 2e6d 6561  ee ``skimage.mea
-0001e670: 7375 7265 2e72 6567 696f 6e70 726f 7073  sure.regionprops
-0001e680: 6060 2e0d 0a20 2020 2020 2020 2065 7874  ``...        ext
-0001e690: 7261 5f70 726f 7065 7274 6965 7320 3a20  ra_properties : 
-0001e6a0: 6974 6572 6162 6c65 206f 6620 6361 6c6c  iterable of call
-0001e6b0: 6162 6c65 2c20 6f70 7469 6f6e 616c 0d0a  able, optional..
-0001e6c0: 2020 2020 2020 2020 2020 2020 6578 7472              extr
-0001e6d0: 6120 7072 6f70 6572 7469 6573 2074 6f20  a properties to 
-0001e6e0: 616e 616c 797a 652c 2073 6565 2060 6073  analyze, see ``s
-0001e6f0: 6b69 6d61 6765 2e6d 6561 7375 7265 2e72  kimage.measure.r
-0001e700: 6567 696f 6e70 726f 7073 6060 2e0d 0a0d  egionprops``....
-0001e710: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0001e720: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-0001e730: 2d0d 0a20 2020 2020 2020 2044 6174 6144  -..        DataD
-0001e740: 6963 7420 6f66 2050 726f 7041 7272 6179  ict of PropArray
-0001e750: 0d0a 2020 2020 2020 2020 2020 2020 4469  ..            Di
-0001e760: 6374 696f 6e61 7279 2068 6173 206b 6579  ctionary has key
-0001e770: 7320 6f66 2070 726f 7065 7274 6965 7320  s of properties 
-0001e780: 7468 6174 2061 7265 2073 7065 6369 6669  that are specifi
-0001e790: 6564 2062 7920 6070 726f 7065 7274 6965  ed by `propertie
-0001e7a0: 7360 2e20 4561 6368 2076 616c 7565 0d0a  s`. Each value..
-0001e7b0: 2020 2020 2020 2020 2020 2020 6861 7320              has 
-0001e7c0: 7468 6520 6172 7261 7920 6f66 2070 726f  the array of pro
-0001e7d0: 7065 7274 6965 732e 0d0a 2020 2020 2020  perties...      
-0001e7e0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0001e7f0: 4578 616d 706c 6573 0d0a 2020 2020 2020  Examples..      
-0001e800: 2020 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020    --------..    
-0001e810: 2020 2020 4d65 6173 7572 6520 7265 6769      Measure regi
-0001e820: 6f6e 2070 726f 7065 7274 6965 7320 6172  on properties ar
-0001e830: 6f75 6e64 2073 696e 676c 6520 6d6f 6c65  ound single mole
-0001e840: 6375 6c65 732e 0d0a 2020 2020 2020 2020  cules...        
-0001e850: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-0001e860: 3e20 636f 6f72 6473 203d 2069 6d67 2e63  > coords = img.c
-0001e870: 656e 7472 6f69 645f 736d 2829 0d0a 2020  entroid_sm()..  
-0001e880: 2020 2020 2020 2020 2020 3e3e 3e20 696d            >>> im
-0001e890: 672e 7370 6563 6966 7928 636f 6f72 6473  g.specify(coords
-0001e8a0: 2c20 332c 206c 6162 656c 7479 7065 3d22  , 3, labeltype="
-0001e8b0: 6369 7263 6c65 2229 0d0a 2020 2020 2020  circle")..      
-0001e8c0: 2020 2020 2020 3e3e 3e20 7072 6f70 7320        >>> props 
-0001e8d0: 3d20 696d 672e 7265 6769 6f6e 7072 6f70  = img.regionprop
-0001e8e0: 7328 290d 0a20 2020 2020 2020 2022 2222  s()..        """
-0001e8f0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001e900: 2020 6964 5f61 7869 7320 3d20 224e 220d    id_axis = "N".
-0001e910: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0001e920: 7374 616e 6365 2870 726f 7065 7274 6965  stance(propertie
-0001e930: 732c 2073 7472 293a 0d0a 2020 2020 2020  s, str):..      
-0001e940: 2020 2020 2020 7072 6f70 6572 7469 6573        properties
-0001e950: 203d 2028 7072 6f70 6572 7469 6573 2c29   = (properties,)
-0001e960: 0d0a 2020 2020 2020 2020 6966 2065 7874  ..        if ext
-0001e970: 7261 5f70 726f 7065 7274 6965 7320 6973  ra_properties is
-0001e980: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0001e990: 2020 2020 2020 2020 7072 6f70 6572 7469          properti
-0001e9a0: 6573 203d 2070 726f 7065 7274 6965 7320  es = properties 
-0001e9b0: 2b20 7475 706c 6528 6578 2e5f 5f6e 616d  + tuple(ex.__nam
-0001e9c0: 655f 5f20 666f 7220 6578 2069 6e20 6578  e__ for ex in ex
-0001e9d0: 7472 615f 7072 6f70 6572 7469 6573 290d  tra_properties).
-0001e9e0: 0a0d 0a20 2020 2020 2020 2069 6620 6964  ...        if id
-0001e9f0: 5f61 7869 7320 696e 2073 656c 662e 6178  _axis in self.ax
-0001ea00: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-0001ea10: 2023 2074 6869 7320 6469 6d65 6e73 696f   # this dimensio
-0001ea20: 6e20 7769 6c6c 2062 6520 6c61 6265 6c0d  n will be label.
-0001ea30: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001ea40: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-0001ea50: 6178 6973 2027 7b69 645f 6178 6973 7d27  axis '{id_axis}'
-0001ea60: 2069 7320 7573 6564 2066 6f72 206c 6162   is used for lab
-0001ea70: 656c 2049 4420 696e 2044 6174 6146 7261  el ID in DataFra
-0001ea80: 6d65 732e 2229 0d0a 2020 2020 2020 2020  mes.")..        
-0001ea90: 0d0a 2020 2020 2020 2020 7072 6f70 5f61  ..        prop_a
-0001eaa0: 7865 7320 3d20 636f 6d70 6c65 6d65 6e74  xes = complement
-0001eab0: 5f61 7865 7328 7365 6c66 2e6c 6162 656c  _axes(self.label
-0001eac0: 732e 6178 6573 2c20 7365 6c66 2e61 7865  s.axes, self.axe
-0001ead0: 7329 0d0a 2020 2020 2020 2020 7368 6170  s)..        shap
-0001eae0: 6520 3d20 7365 6c66 2e73 697a 6573 6f66  e = self.sizesof
-0001eaf0: 2870 726f 705f 6178 6573 290d 0a0d 0a20  (prop_axes).... 
-0001eb00: 2020 2020 2020 206f 7574 203d 2044 6174         out = Dat
-0001eb10: 6144 6963 7428 7b70 3a20 5072 6f70 4172  aDict({p: PropAr
-0001eb20: 7261 7928 0d0a 2020 2020 2020 2020 2020  ray(..          
-0001eb30: 2020 2020 2020 6e70 2e65 6d70 7479 2828        np.empty((
-0001eb40: 7365 6c66 2e6c 6162 656c 732e 6d61 7828  self.labels.max(
-0001eb50: 292c 2920 2b20 7368 6170 652c 2064 7479  ),) + shape, dty
-0001eb60: 7065 3d6e 702e 666c 6f61 7433 3229 2c0d  pe=np.float32),.
-0001eb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eb80: 206e 616d 653d 7365 6c66 2e6e 616d 652b   name=self.name+
-0001eb90: 222d 7072 6f70 222c 200d 0a20 2020 2020  "-prop", ..     
-0001eba0: 2020 2020 2020 2020 2020 2061 7865 733d             axes=
-0001ebb0: 5b69 645f 6178 6973 5d2b 7072 6f70 5f61  [id_axis]+prop_a
-0001ebc0: 7865 732c 0d0a 2020 2020 2020 2020 2020  xes,..          
-0001ebd0: 2020 2020 2020 736f 7572 6365 3d73 656c        source=sel
-0001ebe0: 662e 736f 7572 6365 2c0d 0a20 2020 2020  f.source,..     
-0001ebf0: 2020 2020 2020 2020 2020 2070 726f 706e             propn
-0001ec00: 616d 653d 700d 0a20 2020 2020 2020 2020  ame=p..         
-0001ec10: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0001ec20: 2020 2020 2020 2020 2020 666f 7220 7020            for p 
-0001ec30: 696e 2070 726f 7065 7274 6965 730d 0a20  in properties.. 
-0001ec40: 2020 2020 2020 2020 2020 207d 290d 0a20             }).. 
-0001ec50: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0001ec60: 2023 2063 616c 6375 6c61 7465 2070 726f   # calculate pro
-0001ec70: 7065 7274 7920 7661 6c75 6520 666f 7220  perty value for 
-0001ec80: 6561 6368 2073 6c69 6365 0d0a 2020 2020  each slice..    
-0001ec90: 2020 2020 666f 7220 736c 2c20 696d 6720      for sl, img 
-0001eca0: 696e 2073 656c 662e 6974 6572 2870 726f  in self.iter(pro
-0001ecb0: 705f 6178 6573 2c20 6578 636c 7564 653d  p_axes, exclude=
-0001ecc0: 7365 6c66 2e6c 6162 656c 732e 6178 6573  self.labels.axes
-0001ecd0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0001ece0: 7072 6f70 7320 3d20 736b 6d65 732e 7265  props = skmes.re
-0001ecf0: 6769 6f6e 7072 6f70 7328 7365 6c66 2e6c  gionprops(self.l
-0001ed00: 6162 656c 732e 7661 6c75 652c 2069 6d67  abels.value, img
-0001ed10: 2c20 6361 6368 653d 4661 6c73 652c 0d0a  , cache=False,..
-0001ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed40: 2020 2020 2020 6578 7472 615f 7072 6f70        extra_prop
-0001ed50: 6572 7469 6573 3d65 7874 7261 5f70 726f  erties=extra_pro
-0001ed60: 7065 7274 6965 7329 0d0a 2020 2020 2020  perties)..      
-0001ed70: 2020 2020 2020 6c61 6265 6c5f 736c 203d        label_sl =
-0001ed80: 2028 736c 6963 6528 4e6f 6e65 292c 2920   (slice(None),) 
-0001ed90: 2b20 736c 0d0a 2020 2020 2020 2020 2020  + sl..          
-0001eda0: 2020 666f 7220 7072 6f70 5f6e 616d 6520    for prop_name 
-0001edb0: 696e 2070 726f 7065 7274 6965 733a 0d0a  in properties:..
-0001edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001edd0: 2320 426f 7468 2073 6964 6573 2068 6176  # Both sides hav
-0001ede0: 6520 6c65 6e67 7468 206f 6620 6964 5f61  e length of id_a
-0001edf0: 7869 7320 286e 756d 6265 7220 6f66 206c  xis (number of l
-0001ee00: 6162 656c 7329 2073 6f20 7468 6174 2076  abels) so that v
-0001ee10: 616c 7565 730d 0a20 2020 2020 2020 2020  alues..         
-0001ee20: 2020 2020 2020 2023 2063 616e 2062 6520         # can be 
-0001ee30: 636f 7272 6563 746c 7920 7375 6273 7469  correctly substi
-0001ee40: 7475 7465 642e 0d0a 2020 2020 2020 2020  tuted...        
-0001ee50: 2020 2020 2020 2020 6f75 745b 7072 6f70          out[prop
-0001ee60: 5f6e 616d 655d 5b6c 6162 656c 5f73 6c5d  _name][label_sl]
-0001ee70: 203d 205b 6765 7461 7474 7228 7072 6f70   = [getattr(prop
-0001ee80: 2c20 7072 6f70 5f6e 616d 6529 2066 6f72  , prop_name) for
-0001ee90: 2070 726f 7020 696e 2070 726f 7073 5d0d   prop in props].
-0001eea0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-0001eeb0: 2020 2066 6f72 2070 6172 7220 696e 206f     for parr in o
-0001eec0: 7574 2e76 616c 7565 7328 293a 0d0a 2020  ut.values():..  
-0001eed0: 2020 2020 2020 2020 2020 7061 7272 2e73            parr.s
-0001eee0: 6574 5f73 6361 6c65 2873 656c 6629 0d0a  et_scale(self)..
-0001eef0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001ef00: 7574 0d0a 2020 2020 0d0a 2020 2020 405f  ut..    ..    @_
-0001ef10: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-0001ef20: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-0001ef30: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-0001ef40: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
-0001ef50: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
-0001ef60: 206c 6270 280d 0a20 2020 2020 2020 2073   lbp(..        s
-0001ef70: 656c 662c 0d0a 2020 2020 2020 2020 703a  elf,..        p:
-0001ef80: 2069 6e74 203d 2031 322c 0d0a 2020 2020   int = 12,..    
-0001ef90: 2020 2020 7261 6469 7573 3a20 696e 7420      radius: int 
-0001efa0: 3d20 312c 0d0a 2020 2020 2020 2020 2a2c  = 1,..        *,
-0001efb0: 0d0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-0001efc0: 3a20 4c69 7465 7261 6c5b 2264 6566 6175  : Literal["defau
-0001efd0: 6c74 222c 2022 726f 7222 2c20 2275 6e69  lt", "ror", "uni
-0001efe0: 666f 726d 222c 2022 7661 7222 5d20 3d20  form", "var"] = 
-0001eff0: 2264 6566 6175 6c74 222c 0d0a 2020 2020  "default",..    
-0001f000: 2020 2020 6469 6d73 3a20 4469 6d73 203d      dims: Dims =
-0001f010: 204e 6f6e 652c 0d0a 2020 2020 2920 2d3e   None,..    ) ->
-0001f020: 2049 6d67 4172 7261 793a 0d0a 2020 2020   ImgArray:..    
-0001f030: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0001f040: 204c 6f63 616c 2062 696e 6172 7920 7061   Local binary pa
-0001f050: 7474 6572 6e20 6665 6174 7572 6520 6578  ttern feature ex
-0001f060: 7472 6163 7469 6f6e 2e0d 0a0d 0a20 2020  traction.....   
-0001f070: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-0001f080: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0001f090: 2d2d 2d0d 0a20 2020 2020 2020 2070 203a  ---..        p :
-0001f0a0: 2069 6e74 2c20 6465 6661 756c 7420 6973   int, default is
-0001f0b0: 2031 320d 0a20 2020 2020 2020 2020 2020   12..           
-0001f0c0: 204e 756d 6265 7220 6f66 2063 6972 6375   Number of circu
-0001f0d0: 6c61 7220 6e65 6967 6862 6f72 730d 0a20  lar neighbors.. 
-0001f0e0: 2020 2020 2020 2072 6164 6975 7320 3a20         radius : 
-0001f0f0: 696e 742c 2064 6566 6175 6c74 2069 7320  int, default is 
-0001f100: 310d 0a20 2020 2020 2020 2020 2020 2052  1..            R
-0001f110: 6164 6975 7320 6f66 206e 6569 6768 626f  adius of neighbo
-0001f120: 7572 732e 0d0a 2020 2020 2020 2020 6d65  urs...        me
-0001f130: 7468 6f64 203a 2073 7472 2c20 6f70 7469  thod : str, opti
-0001f140: 6f6e 616c 0d0a 2020 2020 2020 2020 2020  onal..          
-0001f150: 2020 4d65 7468 6f64 2074 6f20 6465 7465    Method to dete
-0001f160: 726d 696e 6564 2074 6865 2070 6174 7465  rmined the patte
-0001f170: 726e 2e0d 0a20 2020 2020 2020 207b 6469  rn...        {di
-0001f180: 6d73 7d0d 0a0d 0a20 2020 2020 2020 2052  ms}....        R
-0001f190: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-0001f1a0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0001f1b0: 2049 6d67 4172 7261 790d 0a20 2020 2020   ImgArray..     
-0001f1c0: 2020 2020 2020 204c 6f63 616c 2062 696e         Local bin
-0001f1d0: 6172 7920 7061 7474 6572 6e20 696d 6167  ary pattern imag
-0001f1e0: 652e 0d0a 2020 2020 2020 2020 2222 2220  e...        """ 
-0001f1f0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0001f200: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
-0001f210: 6e20 7365 6c66 2e5f 6170 706c 795f 6461  n self._apply_da
-0001f220: 736b 280d 0a20 2020 2020 2020 2020 2020  sk(..           
-0001f230: 2073 6b66 6561 742e 6c6f 6361 6c5f 6269   skfeat.local_bi
-0001f240: 6e61 7279 5f70 6174 7465 726e 2c0d 0a20  nary_pattern,.. 
-0001f250: 2020 2020 2020 2020 2020 2063 5f61 7865             c_axe
-0001f260: 733d 636f 6d70 6c65 6d65 6e74 5f61 7865  s=complement_axe
-0001f270: 7328 6469 6d73 292c 200d 0a20 2020 2020  s(dims), ..     
-0001f280: 2020 2020 2020 2061 7267 733d 2870 2c20         args=(p, 
-0001f290: 7261 6469 7573 2c20 6d65 7468 6f64 290d  radius, method).
-0001f2a0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0001f2b0: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
-0001f2c0: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
-0001f2d0: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
-0001f2e0: 6c5f 6178 6573 0d0a 2020 2020 4063 6865  l_axes..    @che
-0001f2f0: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
-0001f300: 7075 740d 0a20 2020 2064 6566 2067 6c63  put..    def glc
-0001f310: 6d5f 7072 6f70 7328 7365 6c66 2c20 6469  m_props(self, di
-0001f320: 7374 616e 6365 732c 2061 6e67 6c65 732c  stances, angles,
-0001f330: 2072 6164 6975 733a 696e 742c 2070 726f   radius:int, pro
-0001f340: 7065 7274 6965 733a 7475 706c 653d 4e6f  perties:tuple=No
-0001f350: 6e65 2c20 0d0a 2020 2020 2020 2020 2020  ne, ..          
-0001f360: 2020 2020 2020 2020 202a 2c20 6269 6e73           *, bins
-0001f370: 3a69 6e74 3d4e 6f6e 652c 2072 6573 6361  :int=None, resca
-0001f380: 6c65 5f6d 6178 3a62 6f6f 6c3d 4661 6c73  le_max:bool=Fals
-0001f390: 652c 2064 696d 733a 2044 696d 7320 3d20  e, dims: Dims = 
-0001f3a0: 4e6f 6e65 2920 2d3e 2049 6d67 4172 7261  None) -> ImgArra
-0001f3b0: 793a 0d0a 2020 2020 2020 2020 2222 220d  y:..        """.
-0001f3c0: 0a20 2020 2020 2020 2043 6f6d 7075 7465  .        Compute
-0001f3d0: 2070 726f 7065 7274 6965 7320 6f66 2022   properties of "
-0001f3e0: 4772 6179 204c 6576 656c 2043 6f6f 6375  Gray Level Coocu
-0001f3f0: 7272 656e 6365 204d 6174 7269 7822 2e20  rrence Matrix". 
-0001f400: 5468 6973 2077 696c 6c20 7461 6b65 206c  This will take l
-0001f410: 6f6e 6720 7469 6d65 0d0a 2020 2020 2020  ong time..      
-0001f420: 2020 6265 6361 7573 6520 6f66 2070 7572    because of pur
-0001f430: 6520 5079 7468 6f6e 2066 6f72 2d6c 6f6f  e Python for-loo
-0001f440: 702e 0d0a 0d0a 2020 2020 2020 2020 5061  p.....        Pa
-0001f450: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
-0001f460: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-0001f470: 2020 2020 2020 6469 7374 616e 6365 7320        distances 
-0001f480: 3a20 6172 7261 795f 6c69 6b65 0d0a 2020  : array_like..  
-0001f490: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-0001f4a0: 6620 7069 7865 6c20 7061 6972 2064 6973  f pixel pair dis
-0001f4b0: 7461 6e63 6520 6f66 6673 6574 732e 0d0a  tance offsets...
-0001f4c0: 2020 2020 2020 2020 616e 676c 6573 203a          angles :
-0001f4d0: 2061 7272 6179 5f6c 696b 650d 0a20 2020   array_like..   
-0001f4e0: 2020 2020 2020 2020 204c 6973 7420 6f66           List of
-0001f4f0: 2070 6978 656c 2070 6169 7220 616e 676c   pixel pair angl
-0001f500: 6573 2069 6e20 7261 6469 616e 732e 0d0a  es in radians...
-0001f510: 2020 2020 2020 2020 7261 6469 7573 203a          radius :
-0001f520: 2069 6e74 0d0a 2020 2020 2020 2020 2020   int..          
-0001f530: 2020 5769 6e64 6f77 2072 6164 6975 732e    Window radius.
-0001f540: 0d0a 2020 2020 2020 2020 7072 6f70 6572  ..        proper
-0001f550: 7469 6573 203a 2074 7570 6c65 206f 6620  ties : tuple of 
-0001f560: 7374 720d 0a20 2020 2020 2020 2020 2020  str..           
-0001f570: 2063 6f6e 7472 6173 742c 2064 6973 7369   contrast, dissi
-0001f580: 6d69 6c61 7269 7479 2c20 686f 6d6f 6765  milarity, homoge
-0001f590: 6e65 6974 792c 2065 6e65 7267 792c 206d  neity, energy, m
-0001f5a0: 6561 6e2c 2073 7464 2c20 6173 6d2c 206d  ean, std, asm, m
-0001f5b0: 6178 2c20 656e 7472 6f70 790d 0a20 2020  ax, entropy..   
-0001f5c0: 2020 2020 2062 696e 7320 3a20 696e 742c       bins : int,
-0001f5d0: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
-0001f5e0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-0001f5f0: 2062 696e 732e 0d0a 2020 2020 2020 2020   bins...        
-0001f600: 7265 7363 616c 655f 6d61 7820 3a20 626f  rescale_max : bo
-0001f610: 6f6c 2c20 6465 6661 756c 7420 6973 2046  ol, default is F
-0001f620: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0001f630: 2020 4966 2054 7275 652c 2074 6865 2063    If True, the c
-0001f640: 6f6e 7472 6173 7420 6f66 2074 6865 2069  ontrast of the i
-0001f650: 6e70 7574 2069 6d61 6765 2069 7320 6d61  nput image is ma
-0001f660: 7869 6d69 7a65 6420 6279 206d 756c 7469  ximized by multi
-0001f670: 706c 7969 6e67 2061 6e20 696e 7465 6765  plying an intege
-0001f680: 722e 0d0a 2020 2020 2020 2020 7b64 696d  r...        {dim
-0001f690: 737d 0d0a 0d0a 2020 2020 2020 2020 5265  s}....        Re
-0001f6a0: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-0001f6b0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-0001f6c0: 4461 7461 4469 6374 206f 6620 496d 6741  DataDict of ImgA
-0001f6d0: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
-0001f6e0: 2020 474c 434d 2077 6974 6820 6164 6469    GLCM with addi
-0001f6f0: 7469 6f6e 616c 2061 7865 7320 2264 6122  tional axes "da"
-0001f700: 2c20 7768 6572 6520 2264 2220 6d65 616e  , where "d" mean
-0001f710: 7320 6469 7374 616e 6365 2061 6e64 2022  s distance and "
-0001f720: 6122 206d 6561 6e73 2061 6e67 6c65 2e0d  a" means angle..
-0001f730: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0001f740: 696e 7075 7420 696d 6167 6520 6861 7320  input image has 
-0001f750: 2274 7a79 7822 2061 7865 7320 7468 656e  "tzyx" axes then
-0001f760: 206f 7574 7075 7420 7769 6c6c 2068 6176   output will hav
-0001f770: 6520 2274 7a64 3c79 7822 2061 7865 732e  e "tzd<yx" axes.
-0001f780: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0001f790: 2020 2020 4578 616d 706c 6573 0d0a 2020      Examples..  
-0001f7a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
-0001f7b0: 2020 2020 2020 2020 506c 6f74 2047 4c43          Plot GLC
-0001f7c0: 4d27 7320 4944 4d20 616e 6420 4153 4d20  M's IDM and ASM 
-0001f7d0: 696d 6167 6573 0d0a 2020 2020 2020 2020  images..        
-0001f7e0: 2020 2020 3e3e 3e20 6f75 7420 3d20 696d      >>> out = im
-0001f7f0: 672e 676c 636d 5f70 726f 7073 285b 315d  g.glcm_props([1]
-0001f800: 2c20 5b30 5d2c 2033 2c20 7072 6f70 6572  , [0], 3, proper
-0001f810: 7469 6573 3d28 2269 646d 222c 2261 736d  ties=("idm","asm
-0001f820: 2229 290d 0a20 2020 2020 2020 2020 2020  "))..           
-0001f830: 203e 3e3e 206f 7574 2e69 646d 5b22 643d   >>> out.idm["d=
-0001f840: 303b 3c3d 3022 5d2e 696d 7368 6f77 2829  0;<=0"].imshow()
-0001f850: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-0001f860: 3e20 6f75 742e 6173 6d5b 2264 3d30 3b3c  > out.asm["d=0;<
-0001f870: 3d30 225d 2e69 6d73 686f 7728 290d 0a20  =0"].imshow().. 
-0001f880: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-0001f890: 2020 0d0a 2020 2020 2020 2020 7365 6c66    ..        self
-0001f8a0: 2c20 6269 6e73 2c20 7265 7363 616c 655f  , bins, rescale_
-0001f8b0: 6d61 7820 3d20 5f67 6c63 6d2e 6368 6563  max = _glcm.chec
-0001f8c0: 6b5f 676c 636d 2873 656c 662c 2062 696e  k_glcm(self, bin
-0001f8d0: 732c 2072 6573 6361 6c65 5f6d 6178 290d  s, rescale_max).
-0001f8e0: 0a20 2020 2020 2020 2069 6620 7072 6f70  .        if prop
-0001f8f0: 6572 7469 6573 2069 7320 4e6f 6e65 3a0d  erties is None:.
-0001f900: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-0001f910: 7065 7274 6965 7320 3d20 2822 636f 6e74  perties = ("cont
-0001f920: 7261 7374 222c 2022 6469 7373 696d 696c  rast", "dissimil
-0001f930: 6172 6974 7922 2c20 2269 646d 222c 200d  arity", "idm", .
-0001f940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f950: 2020 2020 2020 2020 2020 2022 6173 6d22             "asm"
-0001f960: 2c20 226d 6178 222c 2022 656e 7472 6f70  , "max", "entrop
-0001f970: 7922 2c20 2263 6f72 7265 6c61 7469 6f6e  y", "correlation
-0001f980: 2229 0d0a 2020 2020 2020 2020 635f 6178  ")..        c_ax
-0001f990: 6573 203d 2063 6f6d 706c 656d 656e 745f  es = complement_
-0001f9a0: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-0001f9b0: 6178 6573 290d 0a20 2020 2020 2020 2064  axes)..        d
-0001f9c0: 6973 7461 6e63 6573 203d 206e 702e 6173  istances = np.as
-0001f9d0: 6172 7261 7928 6469 7374 616e 6365 732c  array(distances,
-0001f9e0: 2064 7479 7065 3d6e 702e 7569 6e74 3829   dtype=np.uint8)
-0001f9f0: 0d0a 2020 2020 2020 2020 616e 676c 6573  ..        angles
-0001fa00: 203d 206e 702e 6173 6172 7261 7928 616e   = np.asarray(an
-0001fa10: 676c 6573 2c20 6474 7970 653d 6e70 2e66  gles, dtype=np.f
-0001fa20: 6c6f 6174 3332 290d 0a20 2020 2020 2020  loat32)..       
-0001fa30: 206f 7574 7368 6170 6520 3d20 7365 6c66   outshape = self
-0001fa40: 2e73 697a 6573 6f66 2863 5f61 7865 7329  .sizesof(c_axes)
-0001fa50: 202b 2028 6c65 6e28 6469 7374 616e 6365   + (len(distance
-0001fa60: 7329 2c20 6c65 6e28 616e 676c 6573 2929  s), len(angles))
-0001fa70: 202b 2073 656c 662e 7369 7a65 736f 6628   + self.sizesof(
-0001fa80: 6469 6d73 290d 0a20 2020 2020 2020 206f  dims)..        o
-0001fa90: 7574 203d 207b 7d0d 0a20 2020 2020 2020  ut = {}..       
-0001faa0: 2066 6f72 2070 726f 7020 696e 2070 726f   for prop in pro
-0001fab0: 7065 7274 6965 733a 0d0a 2020 2020 2020  perties:..      
-0001fac0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0001fad0: 6e63 6528 7072 6f70 2c20 7374 7229 3a0d  nce(prop, str):.
-0001fae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001faf0: 206f 7574 5b70 726f 705d 203d 206e 702e   out[prop] = np.
-0001fb00: 656d 7074 7928 6f75 7473 6861 7065 2c20  empty(outshape, 
-0001fb10: 6474 7970 653d 6e70 2e66 6c6f 6174 3332  dtype=np.float32
-0001fb20: 292e 7669 6577 2873 656c 662e 5f5f 636c  ).view(self.__cl
-0001fb30: 6173 735f 5f29 0d0a 2020 2020 2020 2020  ass__)..        
-0001fb40: 2020 2020 656c 6966 2063 616c 6c61 626c      elif callabl
-0001fb50: 6528 7072 6f70 293a 0d0a 2020 2020 2020  e(prop):..      
-0001fb60: 2020 2020 2020 2020 2020 6f75 745b 7072            out[pr
-0001fb70: 6f70 2e5f 5f6e 616d 655f 5f5d 203d 206e  op.__name__] = n
-0001fb80: 702e 656d 7074 7928 6f75 7473 6861 7065  p.empty(outshape
-0001fb90: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-0001fba0: 3332 292e 7669 6577 2873 656c 662e 5f5f  32).view(self.__
-0001fbb0: 636c 6173 735f 5f29 0d0a 2020 2020 2020  class__)..      
-0001fbc0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0001fbd0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001fbe0: 7365 2054 7970 6545 7272 6f72 2822 7072  se TypeError("pr
-0001fbf0: 6f70 6572 7469 6573 206d 7573 7420 6265  operties must be
-0001fc00: 2073 7472 206f 7220 6361 6c6c 6162 6c65   str or callable
-0001fc10: 2e22 290d 0a20 2020 2020 2020 206f 7574  .")..        out
-0001fc20: 203d 2044 6174 6144 6963 7428 6f75 7429   = DataDict(out)
-0001fc30: 0d0a 2020 2020 2020 2020 7365 6c66 203d  ..        self =
-0001fc40: 2073 656c 662e 7061 6428 7261 6469 7573   self.pad(radius
-0001fc50: 2c20 6d6f 6465 3d22 7265 666c 6563 7422  , mode="reflect"
-0001fc60: 2c20 6469 6d73 3d64 696d 7329 0d0a 2020  , dims=dims)..  
-0001fc70: 2020 2020 2020 666f 7220 736c 2c20 696d        for sl, im
-0001fc80: 6720 696e 2073 656c 662e 6974 6572 2863  g in self.iter(c
-0001fc90: 5f61 7865 7329 3a0d 0a20 2020 2020 2020  _axes):..       
-0001fca0: 2020 2020 2070 726f 706f 7574 203d 205f       propout = _
-0001fcb0: 676c 636d 2e67 6c63 6d5f 7072 6f70 735f  glcm.glcm_props_
-0001fcc0: 2869 6d67 2c20 6469 7374 616e 6365 732c  (img, distances,
-0001fcd0: 2061 6e67 6c65 732c 2062 696e 732c 2072   angles, bins, r
-0001fce0: 6164 6975 732c 2070 726f 7065 7274 6965  adius, propertie
-0001fcf0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0001fd00: 666f 7220 7072 6f70 2069 6e20 7072 6f70  for prop in prop
-0001fd10: 6572 7469 6573 3a0d 0a20 2020 2020 2020  erties:..       
-0001fd20: 2020 2020 2020 2020 206f 7574 5b70 726f           out[pro
-0001fd30: 705d 2e76 616c 7565 5b73 6c5d 203d 2070  p].value[sl] = p
-0001fd40: 726f 706f 7574 5b70 726f 705d 0d0a 2020  ropout[prop]..  
-0001fd50: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0001fd60: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
-0001fd70: 6f75 742e 6974 656d 7328 293a 0d0a 2020  out.items():..  
-0001fd80: 2020 2020 2020 2020 2020 762e 5f73 6574            v._set
-0001fd90: 5f69 6e66 6f28 7365 6c66 2c20 6e65 775f  _info(self, new_
-0001fda0: 6178 6573 3d63 5f61 7865 732b 2264 6122  axes=c_axes+"da"
-0001fdb0: 2b64 696d 7329 0d0a 2020 2020 2020 2020  +dims)..        
-0001fdc0: 7265 7475 726e 206f 7574 0d0a 2020 2020  return out..    
-0001fdd0: 0d0a 2020 2020 0d0a 2020 2020 4073 616d  ..    ..    @sam
-0001fde0: 655f 6474 7970 650d 0a20 2020 2064 6566  e_dtype..    def
-0001fdf0: 2070 726f 6a28 0d0a 2020 2020 2020 2020   proj(..        
-0001fe00: 7365 6c66 2c0d 0a20 2020 2020 2020 2061  self,..        a
-0001fe10: 7869 733a 2041 7869 734c 696b 6520 7c20  xis: AxisLike | 
-0001fe20: 4e6f 6e65 203d 204e 6f6e 652c 0d0a 2020  None = None,..  
-0001fe30: 2020 2020 2020 6d65 7468 6f64 3a20 7374        method: st
-0001fe40: 7220 7c20 4361 6c6c 6162 6c65 203d 2022  r | Callable = "
-0001fe50: 6d65 616e 222c 0d0a 2020 2020 2020 2020  mean",..        
-0001fe60: 6d61 736b 203d 204e 6f6e 652c 0d0a 2020  mask = None,..  
-0001fe70: 2020 2020 2020 2a2a 6b77 6172 6773 0d0a        **kwargs..
-0001fe80: 2020 2020 2920 2d3e 2049 6d67 4172 7261      ) -> ImgArra
-0001fe90: 793a 0d0a 2020 2020 2020 2020 2222 220d  y:..        """.
-0001fea0: 0a20 2020 2020 2020 2050 726f 6a65 6374  .        Project
-0001feb0: 696f 6e20 616c 6f6e 6720 616e 7920 6178  ion along any ax
-0001fec0: 6973 2e0d 0a0d 0a20 2020 2020 2020 2050  is.....        P
-0001fed0: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-0001fee0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-0001fef0: 2020 2020 2020 2061 7869 7320 3a20 7374         axis : st
-0001ff00: 722c 206f 7074 696f 6e61 6c0d 0a20 2020  r, optional..   
-0001ff10: 2020 2020 2020 2020 2041 6c6f 6e67 2077           Along w
-0001ff20: 6869 6368 2061 7869 7320 7072 6f6a 6563  hich axis projec
-0001ff30: 7469 6f6e 2077 696c 6c20 6265 2063 616c  tion will be cal
-0001ff40: 6375 6c61 7465 642e 2049 6620 4e6f 6e65  culated. If None
-0001ff50: 2c20 6d6f 7374 2070 6c61 7573 6962 6c65  , most plausible
-0001ff60: 206f 6e65 2077 696c 6c20 6265 2063 686f   one will be cho
-0001ff70: 7365 6e2e 0d0a 2020 2020 2020 2020 6d65  sen...        me
-0001ff80: 7468 6f64 203a 2073 7472 206f 7220 6361  thod : str or ca
-0001ff90: 6c6c 6162 6c65 2c20 6465 6661 756c 7420  llable, default 
-0001ffa0: 6973 206d 6561 6e2d 7072 6f6a 6563 7469  is mean-projecti
-0001ffb0: 6f6e 2e0d 0a20 2020 2020 2020 2020 2020  on...           
-0001ffc0: 2050 726f 6a65 6374 696f 6e20 6d65 7468   Projection meth
-0001ffd0: 6f64 2e20 4966 2073 7472 2069 7320 6769  od. If str is gi
-0001ffe0: 7665 6e2c 2069 7420 7769 6c6c 2063 6f6e  ven, it will con
-0001fff0: 7665 7274 6564 2074 6f20 6e75 6d70 7920  verted to numpy 
-00020000: 6675 6e63 7469 6f6e 2e0d 0a20 2020 2020  function...     
-00020010: 2020 206d 6173 6b20 3a20 6172 7261 792d     mask : array-
-00020020: 6c69 6b65 2c20 6f70 7469 6f6e 616c 0d0a  like, optional..
-00020030: 2020 2020 2020 2020 2020 2020 4966 2070              If p
-00020040: 726f 7669 6465 642c 2069 6e70 7574 2069  rovided, input i
-00020050: 6d61 6765 2077 696c 6c20 6265 2063 6f6e  mage will be con
-00020060: 7665 7274 6564 2074 6f20 6e70 2e6d 612e  verted to np.ma.
-00020070: 6172 7261 7920 616e 6420 6060 6d65 7468  array and ``meth
-00020080: 6f64 6060 2077 696c 6c20 616c 736f 2062  od`` will also b
-00020090: 6520 696e 7465 7270 7265 7465 640d 0a20  e interpreted.. 
-000200a0: 2020 2020 2020 2020 2020 2061 7320 616e             as an
-000200b0: 206d 6173 6b65 6420 6675 6e63 7469 6f20   masked functio 
-000200c0: 6966 2070 6f73 7369 626c 652e 0d0a 2020  if possible...  
-000200d0: 2020 2020 2020 2a2a 6b77 6172 6773 0d0a        **kwargs..
-000200e0: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
-000200f0: 7220 6b65 7977 6f72 6420 6172 6775 6d65  r keyword argume
-00020100: 6e74 7320 7468 6174 2077 696c 6c20 7061  nts that will pa
-00020110: 7373 6564 2074 6f20 7072 6f6a 6563 7469  ssed to projecti
-00020120: 6f6e 2066 756e 6374 696f 6e2e 0d0a 0d0a  on function.....
-00020130: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
-00020140: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00020150: 0d0a 2020 2020 2020 2020 496d 6741 7272  ..        ImgArr
-00020160: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
-00020170: 5072 6f6a 6563 7465 6420 696d 6167 652e  Projected image.
-00020180: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
-00020190: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
-000201a0: 2064 6574 6572 6d69 6e65 2066 756e 6374   determine funct
-000201b0: 696f 6e0d 0a20 2020 2020 2020 2069 6620  ion..        if 
-000201c0: 6d61 736b 2069 7320 6e6f 7420 4e6f 6e65  mask is not None
-000201d0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000201e0: 6620 6973 696e 7374 616e 6365 286d 6574  f isinstance(met
-000201f0: 686f 642c 2073 7472 293a 0d0a 2020 2020  hod, str):..    
-00020200: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-00020210: 203d 2067 6574 6174 7472 286e 702e 6d61   = getattr(np.ma
-00020220: 2c20 6d65 7468 6f64 290d 0a20 2020 2020  , method)..     
-00020230: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00020240: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-00020250: 6e63 203d 206d 6574 686f 640d 0a20 2020  nc = method..   
-00020260: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00020270: 2020 2020 2020 2020 6675 6e63 203d 205f          func = _
-00020280: 6368 6563 6b5f 6675 6e63 7469 6f6e 286d  check_function(m
-00020290: 6574 686f 6429 0d0a 2020 2020 2020 2020  ethod)..        
-000202a0: 0d0a 2020 2020 2020 2020 6966 2061 7869  ..        if axi
-000202b0: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
-000202c0: 2020 2020 2020 2020 6178 6973 203d 2066          axis = f
-000202d0: 696e 645f 6669 7273 745f 6170 7065 6172  ind_first_appear
-000202e0: 6564 2822 7a74 7069 6163 222c 2069 6e63  ed("ztpiac", inc
-000202f0: 6c75 6465 3d73 656c 662e 6178 6573 2c20  lude=self.axes, 
-00020300: 6578 636c 7564 653d 2279 7822 290d 0a20  exclude="yx").. 
-00020310: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-00020320: 6861 7361 7474 7228 6178 6973 2c20 225f  hasattr(axis, "_
-00020330: 5f69 7465 725f 5f22 293a 0d0a 2020 2020  _iter__"):..    
-00020340: 2020 2020 2020 2020 6178 6973 203d 205b          axis = [
-00020350: 6178 6973 5d0d 0a20 2020 2020 2020 2061  axis]..        a
-00020360: 7869 7369 6e74 203d 2074 7570 6c65 2873  xisint = tuple(s
-00020370: 656c 662e 6178 6973 6f66 2861 2920 666f  elf.axisof(a) fo
-00020380: 7220 6120 696e 2061 7869 7329 0d0a 2020  r a in axis)..  
-00020390: 2020 2020 2020 6966 2066 756e 632e 5f5f        if func.__
-000203a0: 6d6f 6475 6c65 5f5f 203d 3d20 226e 756d  module__ == "num
-000203b0: 7079 2e6d 612e 636f 7265 223a 0d0a 2020  py.ma.core":..  
-000203c0: 2020 2020 2020 2020 2020 6172 7220 3d20            arr = 
-000203d0: 6e70 2e6d 612e 6172 7261 7928 7365 6c66  np.ma.array(self
-000203e0: 2e76 616c 7565 2c20 6d61 736b 3d6d 6173  .value, mask=mas
-000203f0: 6b2c 2064 7479 7065 3d73 656c 662e 6474  k, dtype=self.dt
-00020400: 7970 6529 0d0a 2020 2020 2020 2020 2020  ype)..          
-00020410: 2020 6966 2066 756e 6320 6973 206e 702e    if func is np.
-00020420: 6d61 2e6d 6561 6e3a 0d0a 2020 2020 2020  ma.mean:..      
-00020430: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
-00020440: 6675 6e63 2861 7272 2c20 6178 6973 3d61  func(arr, axis=a
-00020450: 7869 7369 6e74 2c20 6474 7970 653d 6e70  xisint, dtype=np
-00020460: 2e66 6c6f 6174 3332 2c20 2a2a 6b77 6172  .float32, **kwar
-00020470: 6773 290d 0a20 2020 2020 2020 2020 2020  gs)..           
-00020480: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00020490: 2020 2020 2020 2020 6f75 7420 3d20 6675          out = fu
-000204a0: 6e63 2861 7272 2c20 6178 6973 3d61 7869  nc(arr, axis=axi
-000204b0: 7369 6e74 2c20 2a2a 6b77 6172 6773 290d  sint, **kwargs).
-000204c0: 0a20 2020 2020 2020 2065 6c69 6620 6675  .        elif fu
-000204d0: 6e63 2069 7320 6e70 2e6d 6561 6e3a 0d0a  nc is np.mean:..
-000204e0: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
-000204f0: 3d20 6675 6e63 2873 656c 662e 7661 6c75  = func(self.valu
-00020500: 652c 2061 7869 733d 6178 6973 696e 742c  e, axis=axisint,
-00020510: 2064 7479 7065 3d6e 702e 666c 6f61 7433   dtype=np.float3
-00020520: 322c 202a 2a6b 7761 7267 7329 0d0a 2020  2, **kwargs)..  
-00020530: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00020540: 2020 2020 2020 2020 206f 7574 203d 2066           out = f
-00020550: 756e 6328 7365 6c66 2e76 616c 7565 2c20  unc(self.value, 
-00020560: 6178 6973 3d61 7869 7369 6e74 2c20 2a2a  axis=axisint, **
-00020570: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
-00020580: 200d 0a20 2020 2020 2020 206f 7574 203d   ..        out =
-00020590: 206f 7574 2e76 6965 7728 7365 6c66 2e5f   out.view(self._
-000205a0: 5f63 6c61 7373 5f5f 290d 0a20 2020 2020  _class__)..     
-000205b0: 2020 206f 7574 2e5f 7365 745f 696e 666f     out._set_info
-000205c0: 2873 656c 662c 2073 656c 662e 6178 6573  (self, self.axes
-000205d0: 2e64 726f 7028 6178 6973 696e 7429 290d  .drop(axisint)).
-000205e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000205f0: 6f75 740d 0a0d 0a20 2020 2040 6368 6563  out....    @chec
-00020600: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-00020610: 7574 0d0a 2020 2020 6465 6620 636c 6970  ut..    def clip
-00020620: 2873 656c 662c 2069 6e5f 7261 6e67 653a  (self, in_range:
-00020630: 2074 7570 6c65 5b69 6e74 207c 2073 7472   tuple[int | str
-00020640: 2c20 696e 7420 7c20 7374 725d 203d 2028  , int | str] = (
-00020650: 2230 2522 2c20 2231 3030 2522 2929 202d  "0%", "100%")) -
-00020660: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
-00020670: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00020680: 2020 5361 7475 7261 7465 206c 6f77 2f68    Saturate low/h
-00020690: 6967 6820 696e 7465 6e73 6974 7920 7573  igh intensity us
-000206a0: 696e 6720 6e70 2e63 6c69 7028 292e 0d0a  ing np.clip()...
-000206b0: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-000206c0: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-000206d0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-000206e0: 2020 696e 5f72 616e 6765 203a 2074 776f    in_range : two
-000206f0: 2073 6361 6c61 7220 7661 6c75 6573 2c20   scalar values, 
-00020700: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00020710: 2020 2020 2020 7261 6e67 6520 6f66 206c        range of l
-00020720: 6f77 6572 2f75 7070 6572 206c 696d 6974  ower/upper limit
-00020730: 732c 2062 7920 6465 6661 756c 7420 2830  s, by default (0
-00020740: 252c 2031 3030 2529 2e0d 0a0d 0a20 2020  %, 100%).....   
-00020750: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-00020760: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-00020770: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
-00020780: 0a20 2020 2020 2020 2020 2020 2043 6c69  .            Cli
-00020790: 7070 6564 2069 6d61 6765 2077 6974 6820  pped image with 
-000207a0: 7465 6d70 6f72 616c 2061 7474 7269 6275  temporal attribu
-000207b0: 7465 0d0a 2020 2020 2020 2020 2222 2220  te..        """ 
-000207c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000207d0: 206c 6f77 6572 6c69 6d2c 2075 7070 6572   lowerlim, upper
-000207e0: 6c69 6d20 3d20 5f63 6865 636b 5f63 6c69  lim = _check_cli
-000207f0: 705f 7261 6e67 6528 696e 5f72 616e 6765  p_range(in_range
-00020800: 2c20 7365 6c66 2e76 616c 7565 290d 0a20  , self.value).. 
-00020810: 2020 2020 2020 206f 7574 203d 206e 702e         out = np.
-00020820: 636c 6970 2873 656c 662e 7661 6c75 652c  clip(self.value,
-00020830: 206c 6f77 6572 6c69 6d2c 2075 7070 6572   lowerlim, upper
-00020840: 6c69 6d29 0d0a 2020 2020 2020 2020 6f75  lim)..        ou
-00020850: 7420 3d20 6f75 742e 7669 6577 2873 656c  t = out.view(sel
-00020860: 662e 5f5f 636c 6173 735f 5f29 0d0a 2020  f.__class__)..  
-00020870: 2020 2020 2020 7265 7475 726e 206f 7574        return out
-00020880: 0d0a 2020 2020 0d0a 2020 2020 4063 6865  ..    ..    @che
-00020890: 636b 5f69 6e70 7574 5f61 6e64 5f6f 7574  ck_input_and_out
-000208a0: 7075 740d 0a20 2020 2064 6566 2072 6573  put..    def res
-000208b0: 6361 6c65 5f69 6e74 656e 7369 7479 280d  cale_intensity(.
-000208c0: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
-000208d0: 2020 2020 2020 2020 696e 5f72 616e 6765          in_range
-000208e0: 3a20 7475 706c 655b 696e 7420 7c20 7374  : tuple[int | st
-000208f0: 722c 2069 6e74 207c 2073 7472 5d20 3d20  r, int | str] = 
-00020900: 2822 3025 222c 2022 3130 3025 2229 2c20  ("0%", "100%"), 
-00020910: 0d0a 2020 2020 2020 2020 6474 7970 6520  ..        dtype 
-00020920: 3d20 6e70 2e75 696e 7431 360d 0a20 2020  = np.uint16..   
-00020930: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
-00020940: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00020950: 2020 2020 2020 5265 7363 616c 6520 7468        Rescale th
-00020960: 6520 696e 7465 6e73 6974 7920 6f66 2074  e intensity of t
-00020970: 6865 2069 6d61 6765 2075 7369 6e67 2073  he image using s
-00020980: 6b69 6d61 6765 2e65 7870 6f73 7572 652e  kimage.exposure.
-00020990: 7265 7363 616c 655f 696e 7465 6e73 6974  rescale_intensit
-000209a0: 7928 292e 0d0a 0d0a 2020 2020 2020 2020  y().....        
-000209b0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
-000209c0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
-000209d0: 2020 2020 2020 2020 696e 5f72 616e 6765          in_range
-000209e0: 203a 2074 776f 2073 6361 6c61 7220 7661   : two scalar va
-000209f0: 6c75 6573 2c20 6465 6661 756c 7420 6973  lues, default is
-00020a00: 2028 3025 2c20 3130 3025 290d 0a20 2020   (0%, 100%)..   
-00020a10: 2020 2020 2020 2020 2052 616e 6765 206f           Range o
-00020a20: 6620 6c6f 7765 722f 7570 7065 7220 6c69  f lower/upper li
-00020a30: 6d69 742e 0d0a 2020 2020 2020 2020 6474  mit...        dt
-00020a40: 7970 6520 3a20 6e75 6d70 7920 6474 7970  ype : numpy dtyp
-00020a50: 652c 2064 6566 6175 6c74 2069 7320 6e70  e, default is np
-00020a60: 2e75 696e 7431 360d 0a20 2020 2020 2020  .uint16..       
-00020a70: 2020 2020 204f 7574 7075 7420 6474 7970       Output dtyp
-00020a80: 652e 0d0a 0d0a 2020 2020 2020 2020 5265  e.....        Re
-00020a90: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-00020aa0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00020ab0: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00020ac0: 2020 2020 2020 5265 7363 616c 6564 2069        Rescaled i
-00020ad0: 6d61 6765 2077 6974 6820 7465 6d70 6f72  mage with tempor
-00020ae0: 616c 2061 7474 7269 6275 7465 0d0a 2020  al attribute..  
-00020af0: 2020 2020 2020 2222 2220 2020 2020 2020        """       
-00020b00: 200d 0a20 2020 2020 2020 206f 7574 203d   ..        out =
-00020b10: 2073 656c 662e 7669 6577 286e 702e 6e64   self.view(np.nd
-00020b20: 6172 7261 7929 2e61 7374 7970 6528 6e70  array).astype(np
-00020b30: 2e66 6c6f 6174 3332 290d 0a20 2020 2020  .float32)..     
-00020b40: 2020 206c 6f77 6572 6c69 6d2c 2075 7070     lowerlim, upp
-00020b50: 6572 6c69 6d20 3d20 5f63 6865 636b 5f63  erlim = _check_c
-00020b60: 6c69 705f 7261 6e67 6528 696e 5f72 616e  lip_range(in_ran
-00020b70: 6765 2c20 7365 6c66 2e76 616c 7565 290d  ge, self.value).
-00020b80: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-00020b90: 2020 2020 2020 206f 7574 203d 2073 6b65         out = ske
-00020ba0: 7870 2e72 6573 6361 6c65 5f69 6e74 656e  xp.rescale_inten
-00020bb0: 7369 7479 286f 7574 2c20 696e 5f72 616e  sity(out, in_ran
-00020bc0: 6765 3d28 6c6f 7765 726c 696d 2c20 7570  ge=(lowerlim, up
-00020bd0: 7065 726c 696d 292c 206f 7574 5f72 616e  perlim), out_ran
-00020be0: 6765 3d22 6474 7970 6522 290d 0a20 2020  ge="dtype")..   
-00020bf0: 2020 2020 200d 0a20 2020 2020 2020 206f       ..        o
-00020c00: 7574 203d 206f 7574 2e76 6965 7728 7365  ut = out.view(se
-00020c10: 6c66 2e5f 5f63 6c61 7373 5f5f 290d 0a20  lf.__class__).. 
-00020c20: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
-00020c30: 740d 0a20 2020 200d 0a20 2020 2040 6368  t..    ..    @ch
-00020c40: 6563 6b5f 696e 7075 745f 616e 645f 6f75  eck_input_and_ou
-00020c50: 7470 7574 0d0a 2020 2020 6465 6620 7472  tput..    def tr
-00020c60: 6163 6b5f 6472 6966 7428 0d0a 2020 2020  ack_drift(..    
-00020c70: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00020c80: 2020 2061 6c6f 6e67 3a20 4178 6973 4c69     along: AxisLi
-00020c90: 6b65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ke | None = None
-00020ca0: 2c0d 0a20 2020 2020 2020 2073 686f 775f  ,..        show_
-00020cb0: 6472 6966 743a 2062 6f6f 6c20 3d20 4661  drift: bool = Fa
-00020cc0: 6c73 652c 200d 0a20 2020 2020 2020 2075  lse, ..        u
-00020cd0: 7073 616d 706c 655f 6661 6374 6f72 3a20  psample_factor: 
-00020ce0: 696e 7420 3d20 3130 2c0d 0a20 2020 2029  int = 10,..    )
-00020cf0: 202d 3e20 4d61 726b 6572 4672 616d 653a   -> MarkerFrame:
-00020d00: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00020d10: 2020 2020 2020 2043 616c 6375 6c61 7465         Calculate
-00020d20: 2079 782d 6469 7265 6374 696f 6e61 6c20   yx-directional 
-00020d30: 6472 6966 7420 7573 696e 6720 7468 6520  drift using the 
-00020d40: 6d65 7468 6f64 2065 7175 6976 616c 656e  method equivalen
-00020d50: 7420 746f 0d0a 2020 2020 2020 2020 6060  t to..        ``
-00020d60: 736b 696d 6167 652e 7265 6769 7374 7261  skimage.registra
-00020d70: 7469 6f6e 2e70 6861 7365 5f63 726f 7373  tion.phase_cross
-00020d80: 5f63 6f72 7265 6c61 7469 6f6e 6060 2e0d  _correlation``..
-00020d90: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00020da0: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
-00020db0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
-00020dc0: 2020 2061 6c6f 6e67 203a 2041 7869 734c     along : AxisL
-00020dd0: 696b 652c 206f 7074 696f 6e61 6c0d 0a20  ike, optional.. 
-00020de0: 2020 2020 2020 2020 2020 2041 6c6f 6e67             Along
-00020df0: 2077 6869 6368 2061 7869 7320 6472 6966   which axis drif
-00020e00: 7420 7769 6c6c 2062 6520 6361 6c63 756c  t will be calcul
-00020e10: 6174 6564 2e0d 0a20 2020 2020 2020 2073  ated...        s
-00020e20: 686f 775f 6472 6966 7420 3a20 626f 6f6c  how_drift : bool
-00020e30: 2c20 6465 6661 756c 7420 6973 2046 616c  , default is Fal
-00020e40: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00020e50: 4966 2054 7275 652c 2070 6c6f 7420 7468  If True, plot th
-00020e60: 6520 7265 7375 6c74 2e0d 0a20 2020 2020  e result...     
-00020e70: 2020 2075 7073 616d 706c 655f 6661 6374     upsample_fact
-00020e80: 6f72 203a 2069 6e74 2c20 6465 6661 756c  or : int, defaul
-00020e90: 7420 6973 2031 300d 0a20 2020 2020 2020  t is 10..       
-00020ea0: 2020 2020 2055 702d 7361 6d70 6c69 6e67       Up-sampling
-00020eb0: 2066 6163 746f 7220 7768 656e 2063 616c   factor when cal
-00020ec0: 6375 6c61 7469 6e67 2070 6861 7365 2063  culating phase c
-00020ed0: 726f 7373 2063 6f72 7265 6c61 7469 6f6e  ross correlation
-00020ee0: 2e0d 0a20 2020 2020 2020 2020 2020 200d  ...            .
-00020ef0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00020f00: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-00020f10: 2d0d 0a20 2020 2020 2020 204d 6172 6b65  -..        Marke
-00020f20: 7246 7261 6d65 0d0a 2020 2020 2020 2020  rFrame..        
-00020f30: 2020 2020 4461 7461 4672 616d 6520 7374      DataFrame st
-00020f40: 7275 6374 7572 6520 7769 7468 2078 2c79  ructure with x,y
-00020f50: 2063 6f6c 756d 6e73 0d0a 2020 2020 2020   columns..      
-00020f60: 2020 2222 2220 2020 2020 2020 200d 0a20    """        .. 
-00020f70: 2020 2020 2020 2066 726f 6d20 2e2e 6672         from ..fr
-00020f80: 616d 6520 696d 706f 7274 204d 6172 6b65  ame import Marke
-00020f90: 7246 7261 6d65 0d0a 2020 2020 2020 2020  rFrame..        
-00020fa0: 0d0a 2020 2020 2020 2020 6966 2061 6c6f  ..        if alo
-00020fb0: 6e67 2069 7320 4e6f 6e65 3a0d 0a20 2020  ng is None:..   
-00020fc0: 2020 2020 2020 2020 2061 6c6f 6e67 203d           along =
-00020fd0: 2066 696e 645f 6669 7273 745f 6170 7065   find_first_appe
-00020fe0: 6172 6564 2822 7470 7a63 6961 222c 2069  ared("tpzcia", i
-00020ff0: 6e63 6c75 6465 3d73 656c 662e 6178 6573  nclude=self.axes
-00021000: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00021010: 6c65 6e28 616c 6f6e 6729 2021 3d20 313a  len(along) != 1:
-00021020: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-00021030: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00021040: 6061 6c6f 6e67 6020 6d75 7374 2062 6520  `along` must be 
-00021050: 7369 6e67 6c65 2063 6861 7261 6374 6572  single character
-00021060: 2e22 290d 0a20 2020 2020 2020 2069 6620  .")..        if 
-00021070: 6e6f 7420 6973 696e 7374 616e 6365 2875  not isinstance(u
-00021080: 7073 616d 706c 655f 6661 6374 6f72 2c20  psample_factor, 
-00021090: 696e 7429 3a0d 0a20 2020 2020 2020 2020  int):..         
-000210a0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-000210b0: 6f72 2866 2275 7073 616d 706c 652d 6661  or(f"upsample-fa
-000210c0: 6374 6f72 206d 7573 7420 6265 2069 6e74  ctor must be int
-000210d0: 6567 6572 2062 7574 2067 6f74 207b 7479  eger but got {ty
-000210e0: 7065 2875 7073 616d 706c 655f 6661 6374  pe(upsample_fact
-000210f0: 6f72 297d 2229 0d0a 2020 2020 2020 2020  or)}")..        
-00021100: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00021110: 2020 2020 2020 7265 7375 6c74 203d 206e        result = n
-00021120: 702e 7a65 726f 7328 2873 656c 662e 7369  p.zeros((self.si
-00021130: 7a65 6f66 2861 6c6f 6e67 292c 2073 656c  zeof(along), sel
-00021140: 662e 6e64 696d 2d31 292c 2064 7479 7065  f.ndim-1), dtype
-00021150: 3d6e 702e 666c 6f61 7433 3229 0d0a 2020  =np.float32)..  
-00021160: 2020 2020 2020 635f 6178 6573 203d 2063        c_axes = c
-00021170: 6f6d 706c 656d 656e 745f 6178 6573 2861  omplement_axes(a
-00021180: 6c6f 6e67 2c20 7365 6c66 2e61 7865 7329  long, self.axes)
-00021190: 0d0a 2020 2020 2020 2020 6c61 7374 5f69  ..        last_i
-000211a0: 6d67 203d 204e 6f6e 650d 0a20 2020 2020  mg = None..     
-000211b0: 2020 2069 6d67 5f66 6674 203d 2073 656c     img_fft = sel
-000211c0: 662e 6666 7428 7368 6966 743d 4661 6c73  f.fft(shift=Fals
-000211d0: 652c 2064 696d 733d 635f 6178 6573 290d  e, dims=c_axes).
-000211e0: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
-000211f0: 285f 2c20 696d 6729 2069 6e20 656e 756d  (_, img) in enum
-00021200: 6572 6174 6528 696d 675f 6666 742e 6974  erate(img_fft.it
-00021210: 6572 2861 6c6f 6e67 2929 3a0d 0a20 2020  er(along)):..   
-00021220: 2020 2020 2020 2020 2069 6d67 203d 2078           img = x
-00021230: 702e 6173 6172 7261 7928 696d 6729 0d0a  p.asarray(img)..
-00021240: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00021250: 6173 745f 696d 6720 6973 206e 6f74 204e  ast_img is not N
-00021260: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00021270: 2020 2020 2020 7265 7375 6c74 5b69 5d20        result[i] 
-00021280: 3d20 7870 2e61 736e 756d 7079 280d 0a20  = xp.asnumpy(.. 
-00021290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000212a0: 2020 205f 636f 7272 2e73 7562 7069 7865     _corr.subpixe
-000212b0: 6c5f 7063 6328 6c61 7374 5f69 6d67 2c20  l_pcc(last_img, 
-000212c0: 696d 672c 2075 7073 616d 706c 655f 6661  img, upsample_fa
-000212d0: 6374 6f72 3d75 7073 616d 706c 655f 6661  ctor=upsample_fa
-000212e0: 6374 6f72 295b 305d 0d0a 2020 2020 2020  ctor)[0]..      
-000212f0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00021300: 2020 2020 2020 2020 2020 2020 206c 6173               las
-00021310: 745f 696d 6720 3d20 696d 670d 0a20 2020  t_img = img..   
-00021320: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00021330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021340: 6c61 7374 5f69 6d67 203d 2069 6d67 0d0a  last_img = img..
-00021350: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00021360: 2020 7265 7375 6c74 203d 204d 6172 6b65    result = Marke
-00021370: 7246 7261 6d65 286e 702e 6375 6d73 756d  rFrame(np.cumsum
-00021380: 2872 6573 756c 742c 2061 7869 733d 3029  (result, axis=0)
-00021390: 2c20 636f 6c75 6d6e 733d 635f 6178 6573  , columns=c_axes
-000213a0: 290d 0a20 2020 2020 2020 2069 6620 7368  )..        if sh
-000213b0: 6f77 5f64 7269 6674 3a0d 0a20 2020 2020  ow_drift:..     
-000213c0: 2020 2020 2020 2066 726f 6d20 2e5f 7574         from ._ut
-000213d0: 696c 7320 696d 706f 7274 205f 706c 6f74  ils import _plot
-000213e0: 2061 7320 5f70 6c74 0d0a 2020 2020 2020   as _plt..      
-000213f0: 2020 2020 2020 5f70 6c74 2e70 6c6f 745f        _plt.plot_
-00021400: 6472 6966 7428 7265 7375 6c74 290d 0a20  drift(result).. 
-00021410: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00021420: 2072 6573 756c 742e 696e 6465 782e 6e61   result.index.na
-00021430: 6d65 203d 2073 7472 2861 6c6f 6e67 290d  me = str(along).
-00021440: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00021450: 7265 7375 6c74 0d0a 2020 2020 0d0a 2020  result..    ..  
-00021460: 2020 405f 646f 6373 2e77 7269 7465 5f64    @_docs.write_d
-00021470: 6f63 730d 0a20 2020 2040 6469 6d73 5f74  ocs..    @dims_t
-00021480: 6f5f 7370 6174 6961 6c5f 6178 6573 0d0a  o_spatial_axes..
-00021490: 2020 2020 4073 616d 655f 6474 7970 6528      @same_dtype(
-000214a0: 6173 666c 6f61 743d 5472 7565 290d 0a20  asfloat=True).. 
-000214b0: 2020 2040 6368 6563 6b5f 696e 7075 745f     @check_input_
-000214c0: 616e 645f 6f75 7470 7574 0d0a 2020 2020  and_output..    
-000214d0: 6465 6620 6472 6966 745f 636f 7272 6563  def drift_correc
-000214e0: 7469 6f6e 280d 0a20 2020 2020 2020 2073  tion(..        s
-000214f0: 656c 662c 0d0a 2020 2020 2020 2020 7368  elf,..        sh
-00021500: 6966 743a 2043 6f6f 7264 7320 3d20 4e6f  ift: Coords = No
-00021510: 6e65 2c0d 0a20 2020 2020 2020 2072 6566  ne,..        ref
-00021520: 3a20 496d 6741 7272 6179 203d 204e 6f6e  : ImgArray = Non
-00021530: 652c 0d0a 2020 2020 2020 2020 2a2c 0d0a  e,..        *,..
-00021540: 2020 2020 2020 2020 7a65 726f 5f61 7665          zero_ave
-00021550: 3a20 626f 6f6c 203d 2054 7275 652c 0d0a  : bool = True,..
-00021560: 2020 2020 2020 2020 616c 6f6e 673a 2041          along: A
-00021570: 7869 734c 696b 6520 7c20 4e6f 6e65 203d  xisLike | None =
-00021580: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-00021590: 6f72 6465 723a 2069 6e74 203d 2031 2c0d  order: int = 1,.
-000215a0: 0a20 2020 2020 2020 206d 6f64 653a 2073  .        mode: s
-000215b0: 7472 203d 2022 636f 6e73 7461 6e74 222c  tr = "constant",
-000215c0: 0d0a 2020 2020 2020 2020 6376 616c 3a20  ..        cval: 
-000215d0: 666c 6f61 7420 3d20 302c 0d0a 2020 2020  float = 0,..    
-000215e0: 2020 2020 6469 6d73 3a20 4469 6d73 203d      dims: Dims =
-000215f0: 2032 2c0d 0a20 2020 2020 2020 2075 7064   2,..        upd
-00021600: 6174 653a 2062 6f6f 6c20 3d20 4661 6c73  ate: bool = Fals
-00021610: 652c 0d0a 2020 2020 2920 2d3e 2049 6d67  e,..    ) -> Img
-00021620: 4172 7261 793a 0d0a 2020 2020 2020 2020  Array:..        
-00021630: 2222 220d 0a20 2020 2020 2020 2044 7269  """..        Dri
-00021640: 6674 2063 6f72 7265 6374 696f 6e20 7573  ft correction us
-00021650: 696e 6720 6974 6572 6174 6976 6520 4166  ing iterative Af
-00021660: 6669 6e65 2074 7261 6e73 6c61 7469 6f6e  fine translation
-00021670: 2e20 4966 2074 7261 6e73 6c61 7469 6f6e  . If translation
-00021680: 2076 6563 746f 7273 2060 6073 6869 6674   vectors ``shift
-00021690: 6060 0d0a 2020 2020 2020 2020 6973 206e  ``..        is n
-000216a0: 6f74 2067 6976 656e 2c20 7468 656e 2069  ot given, then i
-000216b0: 7420 7769 6c6c 2062 6520 6465 7465 726d  t will be determ
-000216c0: 696e 6564 2075 7369 6e67 2060 6074 7261  ined using ``tra
-000216d0: 636b 5f64 7269 6674 6060 206d 6574 686f  ck_drift`` metho
-000216e0: 6420 6f66 2049 6d67 4172 7261 792e 0d0a  d of ImgArray...
-000216f0: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00021700: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
-00021710: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00021720: 2020 7368 6966 7420 3a20 4461 7461 4672    shift : DataFr
-00021730: 616d 6520 6f72 2028 4e2c 2044 2920 6172  ame or (N, D) ar
-00021740: 7261 792c 206f 7074 696f 6e61 6c0d 0a20  ray, optional.. 
-00021750: 2020 2020 2020 2020 2020 2054 7261 6e73             Trans
-00021760: 6c61 7469 6f6e 2076 6563 746f 7273 2e20  lation vectors. 
-00021770: 4966 2044 6174 6146 7261 6d65 2c20 6974  If DataFrame, it
-00021780: 206d 7573 7420 6861 7665 2063 6f6c 756d   must have colum
-00021790: 6e73 206e 616d 6564 2077 6974 6820 616c  ns named with al
-000217a0: 6c20 7468 6520 7379 6d62 6f6c 730d 0a20  l the symbols.. 
-000217b0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-000217c0: 696e 6564 2069 6e20 6060 6469 6d73 6060  ined in ``dims``
-000217d0: 2e0d 0a20 2020 2020 2020 2072 6566 203a  ...        ref :
-000217e0: 2049 6d67 4172 7261 792c 206f 7074 696f   ImgArray, optio
-000217f0: 6e61 6c0d 0a20 2020 2020 2020 2020 2020  nal..           
-00021800: 2054 6865 2072 6566 6572 656e 6365 206e   The reference n
-00021810: 2d44 2069 6d61 6765 2074 6f20 6465 7465  -D image to dete
-00021820: 726d 696e 6520 6472 6966 742c 2069 6620  rmine drift, if 
-00021830: 6060 7368 6966 7460 6020 7761 7320 6e6f  ``shift`` was no
-00021840: 7420 6769 7665 6e2e 0d0a 2020 2020 2020  t given...      
-00021850: 2020 7a65 726f 5f61 7665 203a 2062 6f6f    zero_ave : boo
-00021860: 6c2c 2064 6566 6175 6c74 2069 7320 5472  l, default is Tr
-00021870: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00021880: 4966 2054 7275 652c 2061 7665 7261 6765  If True, average
-00021890: 2073 6869 6674 2077 696c 6c20 6265 207a   shift will be z
-000218a0: 6572 6f2e 0d0a 2020 2020 2020 2020 616c  ero...        al
-000218b0: 6f6e 6720 3a20 4178 6973 4c69 6b65 2c20  ong : AxisLike, 
-000218c0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-000218d0: 2020 2020 2020 416c 6f6e 6720 7768 6963        Along whic
-000218e0: 6820 6178 6973 2064 7269 6674 2077 696c  h axis drift wil
-000218f0: 6c20 6265 2063 6f72 7265 6374 6564 2e0d  l be corrected..
-00021900: 0a20 2020 2020 2020 207b 6469 6d73 7d7b  .        {dims}{
-00021910: 7570 6461 7465 7d0d 0a20 2020 2020 2020  update}..       
-00021920: 2061 6666 696e 655f 6b77 6172 6773 203a   affine_kwargs :
-00021930: 0d0a 2020 2020 2020 2020 2020 2020 4b65  ..            Ke
-00021940: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00021950: 7468 6174 2077 696c 6c20 6265 2070 6173  that will be pas
-00021960: 7365 6420 746f 2060 6077 6172 7060 602e  sed to ``warp``.
-00021970: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
-00021980: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
-00021990: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
-000219a0: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
-000219b0: 2020 2020 436f 7272 6563 7465 6420 696d      Corrected im
-000219c0: 6167 652e 0d0a 2020 2020 2020 2020 2020  age...          
-000219d0: 2020 0d0a 2020 2020 2020 2020 4578 616d    ..        Exam
-000219e0: 706c 6573 0d0a 2020 2020 2020 2020 2d2d  ples..        --
-000219f0: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00021a00: 4472 6966 7420 636f 7272 6563 7469 6f6e  Drift correction
-00021a10: 206f 6620 6d75 6c74 6963 6861 6e6e 656c   of multichannel
-00021a20: 2069 6d61 6765 2075 7369 6e67 2074 6865   image using the
-00021a30: 2066 6972 7374 2063 6861 6e6e 656c 2061   first channel a
-00021a40: 7320 7468 6520 7265 6665 7265 6e63 652e  s the reference.
-00021a50: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-00021a60: 3e20 696d 672e 6472 6966 745f 636f 7272  > img.drift_corr
-00021a70: 6563 7469 6f6e 2872 6566 3d69 6d67 5b22  ection(ref=img["
-00021a80: 633d 3022 5d29 0d0a 2020 2020 2020 2020  c=0"])..        
-00021a90: 2222 2220 2020 2020 2020 200d 0a20 2020  """        ..   
-00021aa0: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
-00021ab0: 6620 616c 6f6e 6720 6973 204e 6f6e 653a  f along is None:
-00021ac0: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
-00021ad0: 6f6e 6720 3d20 6669 6e64 5f66 6972 7374  ong = find_first
-00021ae0: 5f61 7070 6561 7265 6428 2274 707a 6369  _appeared("tpzci
-00021af0: 6122 2c20 696e 636c 7564 653d 7365 6c66  a", include=self
-00021b00: 2e61 7865 732c 2065 7863 6c75 6465 3d64  .axes, exclude=d
-00021b10: 696d 7329 0d0a 2020 2020 2020 2020 656c  ims)..        el
-00021b20: 6966 206c 656e 2861 6c6f 6e67 2920 213d  if len(along) !=
-00021b30: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-00021b40: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00021b50: 7228 2260 616c 6f6e 6760 206d 7573 7420  r("`along` must 
-00021b60: 6265 2073 696e 676c 6520 6368 6172 6163  be single charac
-00021b70: 7465 722e 2229 0d0a 2020 2020 2020 2020  ter.")..        
-00021b80: 0d0a 2020 2020 2020 2020 6966 2073 6869  ..        if shi
-00021b90: 6674 2069 7320 4e6f 6e65 3a0d 0a20 2020  ft is None:..   
-00021ba0: 2020 2020 2020 2020 2023 2064 6574 6572           # deter
-00021bb0: 6d69 6e65 2027 7265 6627 0d0a 2020 2020  mine 'ref'..    
-00021bc0: 2020 2020 2020 2020 6966 2072 6566 2069          if ref i
-00021bd0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00021be0: 2020 2020 2020 2020 2072 6566 203d 2073           ref = s
-00021bf0: 656c 660d 0a20 2020 2020 2020 2020 2020  elf..           
-00021c00: 2065 6c69 6620 6e6f 7420 6973 696e 7374   elif not isinst
-00021c10: 616e 6365 2872 6566 2c20 496d 6741 7272  ance(ref, ImgArr
-00021c20: 6179 293a 0d0a 2020 2020 2020 2020 2020  ay):..          
-00021c30: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-00021c40: 4572 726f 7228 6622 2772 6566 2720 6d75  Error(f"'ref' mu
-00021c50: 7374 2062 6520 616e 2049 6d67 4172 7261  st be an ImgArra
-00021c60: 7920 6f62 6a65 6374 2c20 6275 7420 676f  y object, but go
-00021c70: 7420 7b74 7970 6528 7265 6629 7d22 290d  t {type(ref)}").
-00021c80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00021c90: 7265 662e 6178 6573 2021 3d20 5b61 6c6f  ref.axes != [alo
-00021ca0: 6e67 5d20 2b20 6469 6d73 3a0d 0a20 2020  ng] + dims:..   
-00021cb0: 2020 2020 2020 2020 2020 2020 2066 726f               fro
-00021cc0: 6d20 6974 6572 746f 6f6c 7320 696d 706f  m itertools impo
-00021cd0: 7274 2070 726f 6475 6374 0d0a 2020 2020  rt product..    
-00021ce0: 2020 2020 2020 2020 2020 2020 5f63 5f61              _c_a
-00021cf0: 7865 7320 3d20 636f 6d70 6c65 6d65 6e74  xes = complement
-00021d00: 5f61 7865 7328 5b61 6c6f 6e67 5d20 2b20  _axes([along] + 
-00021d10: 6469 6d73 2c20 7374 7228 7265 662e 6178  dims, str(ref.ax
-00021d20: 6573 2929 0d0a 2020 2020 2020 2020 2020  es))..          
-00021d30: 2020 2020 2020 666d 7420 3d20 736c 6963        fmt = slic
-00021d40: 6572 2e67 6574 5f66 6f72 6d61 7474 6572  er.get_formatter
-00021d50: 285f 635f 6178 6573 290d 0a20 2020 2020  (_c_axes)..     
-00021d60: 2020 2020 2020 2020 2020 206f 7574 203d             out =
-00021d70: 206e 702e 656d 7074 795f 6c69 6b65 2873   np.empty_like(s
-00021d80: 656c 6629 0d0a 2020 2020 2020 2020 2020  elf)..          
-00021d90: 2020 2020 2020 666f 7220 6964 7820 696e        for idx in
-00021da0: 2070 726f 6475 6374 282a 2872 616e 6765   product(*(range
-00021db0: 2872 6566 2e73 697a 656f 6628 6129 2920  (ref.sizeof(a)) 
-00021dc0: 666f 7220 6120 696e 205f 635f 6178 6573  for a in _c_axes
-00021dd0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-00021de0: 2020 2020 2020 2020 2073 6c20 3d20 666d           sl = fm
-00021df0: 745b 6964 785d 0d0a 2020 2020 2020 2020  t[idx]..        
-00021e00: 2020 2020 2020 2020 2020 2020 6f75 745b              out[
-00021e10: 736c 5d20 3d20 7365 6c66 5b73 6c5d 2e64  sl] = self[sl].d
-00021e20: 7269 6674 5f63 6f72 7265 6374 696f 6e28  rift_correction(
-00021e30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00021e40: 2020 2020 2020 2020 2020 7265 663d 7265            ref=re
-00021e50: 665b 736c 5d2c 207a 6572 6f5f 6176 653d  f[sl], zero_ave=
-00021e60: 7a65 726f 5f61 7665 2c20 616c 6f6e 673d  zero_ave, along=
-00021e70: 616c 6f6e 672c 2064 696d 733d 6469 6d73  along, dims=dims
-00021e80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00021e90: 2020 2020 2020 2020 2020 2075 7064 6174             updat
-00021ea0: 653d 7570 6461 7465 2c20 6f72 6465 723d  e=update, order=
-00021eb0: 6f72 6465 722c 206d 6f64 653d 6d6f 6465  order, mode=mode
-00021ec0: 2c20 6376 616c 3d63 7661 6c2c 0d0a 2020  , cval=cval,..  
-00021ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ee0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00021ef0: 2020 2020 2072 6574 7572 6e20 6f75 740d       return out.
-00021f00: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
-00021f10: 6869 6674 203d 2072 6566 2e74 7261 636b  hift = ref.track
-00021f20: 5f64 7269 6674 2861 6c6f 6e67 3d61 6c6f  _drift(along=alo
-00021f30: 6e67 292e 7661 6c75 6573 0d0a 2020 2020  ng).values..    
-00021f40: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00021f50: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00021f60: 2020 2020 2073 6869 6674 203d 206e 702e       shift = np.
-00021f70: 6173 6172 7261 7928 7368 6966 742c 2064  asarray(shift, d
-00021f80: 7479 7065 3d6e 702e 666c 6f61 7433 3229  type=np.float32)
-00021f90: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00021fa0: 2028 7365 6c66 2e73 697a 656f 6628 616c   (self.sizeof(al
-00021fb0: 6f6e 6729 2c20 7365 6c66 2e6e 6469 6d29  ong), self.ndim)
-00021fc0: 2021 3d20 7368 6966 742e 7368 6170 653a   != shift.shape:
-00021fd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00021fe0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00021ff0: 6f72 2822 5772 6f6e 6720 7368 6170 6520  or("Wrong shape 
-00022000: 6f66 2060 7368 6966 7460 2e22 290d 0a0d  of `shift`.")...
-00022010: 0a20 2020 2020 2020 2069 6620 7a65 726f  .        if zero
-00022020: 5f61 7665 3a0d 0a20 2020 2020 2020 2020  _ave:..         
-00022030: 2020 2073 6869 6674 203d 2073 6869 6674     shift = shift
-00022040: 202d 206e 702e 6d65 616e 2873 6869 6674   - np.mean(shift
-00022050: 2c20 6178 6973 3d30 290d 0a20 2020 2020  , axis=0)..     
-00022060: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00022070: 206f 7574 203d 2078 702e 656d 7074 7928   out = xp.empty(
-00022080: 7365 6c66 2e73 6861 7065 290d 0a20 2020  self.shape)..   
-00022090: 2020 2020 2074 5f69 6e64 6578 203d 2073       t_index = s
-000220a0: 656c 662e 6178 6973 6f66 2861 6c6f 6e67  elf.axisof(along
-000220b0: 290d 0a20 2020 2020 2020 206e 6469 6d20  )..        ndim 
-000220c0: 3d20 6c65 6e28 6469 6d73 290d 0a20 2020  = len(dims)..   
-000220d0: 2020 2020 206d 7820 3d20 6e70 2e65 7965       mx = np.eye
-000220e0: 286e 6469 6d20 2b20 312c 2064 7479 7065  (ndim + 1, dtype
-000220f0: 3d6e 702e 666c 6f61 7433 3229 2023 2041  =np.float32) # A
-00022100: 6666 696e 6520 7472 616e 7366 6f72 6d61  ffine transforma
-00022110: 7469 6f6e 206d 6174 7269 780d 0a20 2020  tion matrix..   
-00022120: 2020 2020 2069 6e70 7574 5f69 6d67 203d       input_img =
-00022130: 2073 656c 662e 7370 6c69 6e65 5f66 696c   self.spline_fil
-00022140: 7465 7228 6d6f 6465 3d6d 6f64 652c 206f  ter(mode=mode, o
-00022150: 7264 6572 3d6f 7264 6572 290d 0a20 2020  rder=order)..   
-00022160: 2020 2020 2066 6f72 2073 6c2c 2069 6d67       for sl, img
-00022170: 2069 6e20 696e 7075 745f 696d 672e 6974   in input_img.it
-00022180: 6572 2863 6f6d 706c 656d 656e 745f 6178  er(complement_ax
-00022190: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
-000221a0: 6573 2929 3a0d 0a20 2020 2020 2020 2020  es)):..         
-000221b0: 2020 206d 785b 3a2d 312c 202d 315d 203d     mx[:-1, -1] =
-000221c0: 202d 7368 6966 745b 736c 5b74 5f69 6e64   -shift[sl[t_ind
-000221d0: 6578 5d5d 0d0a 2020 2020 2020 2020 2020  ex]]..          
-000221e0: 2020 6f75 745b 736c 5d20 3d20 5f74 7261    out[sl] = _tra
-000221f0: 6e73 666f 726d 2e77 6172 7028 696d 672c  nsform.warp(img,
-00022200: 206d 782c 206d 6f64 653d 6d6f 6465 2c20   mx, mode=mode, 
-00022210: 6376 616c 3d63 7661 6c2c 206f 7264 6572  cval=cval, order
-00022220: 3d6f 7264 6572 2c20 7072 6566 696c 7465  =order, prefilte
-00022230: 723d 4661 6c73 6529 0d0a 2020 2020 2020  r=False)..      
-00022240: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
-00022250: 726e 206f 7574 0d0a 0d0a 2020 2020 405f  rn out....    @_
-00022260: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
-00022270: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
-00022280: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
-00022290: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
-000222a0: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
-000222b0: 2065 7374 696d 6174 655f 7369 676d 6128   estimate_sigma(
-000222c0: 7365 6c66 2c20 2a2c 2073 7175 6565 7a65  self, *, squeeze
-000222d0: 3a20 626f 6f6c 203d 2054 7275 652c 2064  : bool = True, d
-000222e0: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
-000222f0: 2920 2d3e 2050 726f 7041 7272 6179 207c  ) -> PropArray |
-00022300: 2066 6c6f 6174 3a0d 0a20 2020 2020 2020   float:..       
-00022310: 2022 2222 0d0a 2020 2020 2020 2020 5761   """..        Wa
-00022320: 7665 6c65 742d 6261 7365 6420 6573 7469  velet-based esti
-00022330: 6d61 7469 6f6e 206f 6620 4761 7573 7369  mation of Gaussi
-00022340: 616e 206e 6f69 7365 2e0d 0a0d 0a20 2020  an noise.....   
-00022350: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-00022360: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00022370: 2d2d 2d0d 0a20 2020 2020 2020 2073 7175  ---..        squ
-00022380: 6565 7a65 203a 2062 6f6f 6c2c 2064 6566  eeze : bool, def
-00022390: 6175 6c74 2069 7320 5472 7565 0d0a 2020  ault is True..  
-000223a0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-000223b0: 6520 616e 6420 6f75 7470 7574 2063 616e  e and output can
-000223c0: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
-000223d0: 2061 2073 6361 6c61 722c 2074 6865 6e20   a scalar, then 
-000223e0: 636f 6e76 6572 7420 6974 2e0d 0a20 2020  convert it...   
-000223f0: 2020 2020 207b 6469 6d73 7d0d 0a0d 0a20       {dims}.... 
-00022400: 2020 2020 2020 2052 6574 7572 6e73 0d0a         Returns..
-00022410: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0d          -------.
-00022420: 0a20 2020 2020 2020 2050 726f 7041 7272  .        PropArr
-00022430: 6179 206f 7220 666c 6f61 740d 0a20 2020  ay or float..   
-00022440: 2020 2020 2020 2020 2045 7374 696d 6174           Estimat
-00022450: 6564 2073 7461 6e64 6172 6420 6465 7669  ed standard devi
-00022460: 6174 696f 6e2e 2073 6967 6d61 5b22 743d  ation. sigma["t=
-00022470: 303b 633d 3122 5d20 6d65 616e 7320 7468  0;c=1"] means th
-00022480: 6520 6573 7469 6d61 7465 6420 7661 6c75  e estimated valu
-00022490: 6520 6f66 0d0a 2020 2020 2020 2020 2020  e of..          
-000224a0: 2020 696d 6167 6520 736c 6963 6520 6174    image slice at
-000224b0: 2074 3d30 2061 6e64 2063 3d31 2e0d 0a20   t=0 and c=1... 
-000224c0: 2020 2020 2020 2022 2222 2020 2020 2020         """      
-000224d0: 2020 0d0a 2020 2020 2020 2020 635f 6178    ..        c_ax
-000224e0: 6573 203d 2063 6f6d 706c 656d 656e 745f  es = complement_
-000224f0: 6178 6573 2864 696d 732c 2073 656c 662e  axes(dims, self.
-00022500: 6178 6573 290d 0a20 2020 2020 2020 206f  axes)..        o
-00022510: 7574 203d 2073 656c 662e 5f61 7070 6c79  ut = self._apply
-00022520: 5f64 6173 6b28 0d0a 2020 2020 2020 2020  _dask(..        
-00022530: 2020 2020 736b 7265 732e 6573 7469 6d61      skres.estima
-00022540: 7465 5f73 6967 6d61 2c0d 0a20 2020 2020  te_sigma,..     
-00022550: 2020 2020 2020 2063 5f61 7865 733d 635f         c_axes=c_
-00022560: 6178 6573 2c0d 0a20 2020 2020 2020 2020  axes,..         
-00022570: 2020 2064 726f 705f 6178 6973 3d64 696d     drop_axis=dim
-00022580: 730d 0a20 2020 2020 2020 2029 0d0a 2020  s..        )..  
-00022590: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000225a0: 2020 2020 6966 206f 7574 2e6e 6469 6d20      if out.ndim 
-000225b0: 3d3d 2030 2061 6e64 2073 7175 6565 7a65  == 0 and squeeze
-000225c0: 3a0d 0a20 2020 2020 2020 2020 2020 206f  :..            o
-000225d0: 7574 203d 206f 7574 2e69 7465 6d28 290d  ut = out.item().
-000225e0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000225f0: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
-00022600: 3d20 5072 6f70 4172 7261 7928 0d0a 2020  = PropArray(..  
-00022610: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00022620: 742c 2064 7479 7065 3d6e 702e 666c 6f61  t, dtype=np.floa
-00022630: 7433 322c 206e 616d 653d 7365 6c66 2e6e  t32, name=self.n
-00022640: 616d 652c 2061 7865 733d 635f 6178 6573  ame, axes=c_axes
-00022650: 2c20 7072 6f70 6e61 6d65 3d22 6573 7469  , propname="esti
-00022660: 6d61 7465 5f73 6967 6d61 220d 0a20 2020  mate_sigma"..   
-00022670: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00022680: 2020 2020 2020 2020 6f75 742e 5f73 6574          out._set
-00022690: 5f69 6e66 6f28 7365 6c66 2c20 6e65 775f  _info(self, new_
-000226a0: 6178 6573 3d63 5f61 7865 7329 0d0a 2020  axes=c_axes)..  
-000226b0: 2020 2020 2020 7265 7475 726e 206f 7574        return out
-000226c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000226d0: 200d 0a20 2020 200d 0a20 2020 2040 6469   ..    ..    @di
-000226e0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
-000226f0: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
-00022700: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
-00022710: 0a20 2020 2064 6566 2070 6164 280d 0a20  .    def pad(.. 
-00022720: 2020 2020 2020 2073 656c 662c 200d 0a20         self, .. 
-00022730: 2020 2020 2020 2070 6164 5f77 6964 7468         pad_width
-00022740: 3a20 696e 7420 7c20 7475 706c 655b 696e  : int | tuple[in
-00022750: 742c 2069 6e74 5d20 7c20 5365 7175 656e  t, int] | Sequen
-00022760: 6365 5b74 7570 6c65 5b69 6e74 2c20 696e  ce[tuple[int, in
-00022770: 745d 5d2c 200d 0a20 2020 2020 2020 202a  t]], ..        *
-00022780: 2c20 0d0a 2020 2020 2020 2020 6d6f 6465  , ..        mode
-00022790: 3a20 5061 6464 696e 674d 6f64 6520 3d20  : PaddingMode = 
-000227a0: 2263 6f6e 7374 616e 7422 2c20 0d0a 2020  "constant", ..  
-000227b0: 2020 2020 2020 6469 6d73 3a20 4469 6d73        dims: Dims
-000227c0: 203d 204e 6f6e 652c 200d 0a20 2020 2020   = None, ..     
-000227d0: 2020 202a 2a6b 7761 7267 730d 0a20 2020     **kwargs..   
-000227e0: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
-000227f0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00022800: 2020 2020 2020 5061 6420 696d 6167 6520        Pad image 
-00022810: 6f6e 6c79 2066 6f72 2073 7061 7469 616c  only for spatial
-00022820: 2064 696d 656e 7369 6f6e 732e 0d0a 0d0a   dimensions.....
-00022830: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00022840: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-00022850: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00022860: 7061 645f 7769 6474 682c 206d 6f64 652c  pad_width, mode,
-00022870: 202a 2a6b 7761 7267 7320 3a20 0d0a 2020   **kwargs : ..  
-00022880: 2020 2020 2020 2020 2020 5365 6520 646f            See do
-00022890: 6375 6d65 6e74 6174 696f 6e20 6f66 206e  cumentation of n
-000228a0: 702e 7061 6428 292e 0d0a 2020 2020 2020  p.pad()...      
-000228b0: 2020 6469 6d73 203a 2069 6e74 206f 7220    dims : int or 
-000228c0: 7374 722c 206f 7074 696f 6e61 6c0d 0a20  str, optional.. 
-000228d0: 2020 2020 2020 2020 2020 2057 6869 6368             Which
-000228e0: 2064 696d 656e 7369 6f6e 2074 6f20 7061   dimension to pa
-000228f0: 642e 0d0a 0d0a 2020 2020 2020 2020 5265  d.....        Re
-00022900: 7475 726e 730d 0a20 2020 2020 2020 202d  turns..        -
-00022910: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00022920: 496d 6741 7272 6179 0d0a 2020 2020 2020  ImgArray..      
-00022930: 2020 2020 2020 5061 6464 6564 2069 6d61        Padded ima
-00022940: 6765 2e0d 0a20 2020 2020 2020 200d 0a20  ge...        .. 
-00022950: 2020 2020 2020 2045 7861 6d70 6c65 730d         Examples.
-00022960: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00022970: 2d0d 0a20 2020 2020 2020 2053 7570 706f  -..        Suppo
-00022980: 7365 2060 6069 6d67 6060 2068 6173 207a  se ``img`` has z
-00022990: 7978 2d61 7865 732e 0d0a 2020 2020 2020  yx-axes...      
-000229a0: 2020 0d0a 2020 2020 2020 2020 312e 2050    ..        1. P
-000229b0: 6164 6469 6e67 2035 2070 6978 656c 7320  adding 5 pixels 
-000229c0: 696e 207a 7978 2d64 6972 6563 7469 6f6e  in zyx-direction
-000229d0: 3a0d 0a20 2020 2020 2020 2020 2020 203e  :..            >
-000229e0: 3e3e 2069 6d67 2e70 6164 2835 290d 0a20  >> img.pad(5).. 
-000229f0: 2020 2020 2020 2032 2e20 5061 6464 696e         2. Paddin
-00022a00: 6720 3520 7069 7865 6c73 2069 6e20 7978  g 5 pixels in yx
-00022a10: 2d64 6972 6563 7469 6f6e 3a0d 0a20 2020  -direction:..   
-00022a20: 2020 2020 2020 2020 203e 3e3e 2069 6d67           >>> img
-00022a30: 2e70 6164 2835 2c20 6469 6d73 3d22 7978  .pad(5, dims="yx
-00022a40: 2229 0d0a 2020 2020 2020 2020 332e 2050  ")..        3. P
-00022a50: 6164 6469 6e67 2035 2070 6978 656c 7320  adding 5 pixels 
-00022a60: 696e 2079 782d 6469 7265 6374 696f 6e20  in yx-direction 
-00022a70: 616e 6420 3220 7069 7865 6c73 2069 6e20  and 2 pixels in 
-00022a80: 7a2d 6469 7265 6374 696f 6e3a 0d0a 2020  z-direction:..  
-00022a90: 2020 2020 2020 2020 2020 3e3e 3e20 696d            >>> im
-00022aa0: 672e 7061 6428 5b28 352c 3529 2c20 2834  g.pad([(5,5), (4
-00022ab0: 2c34 292c 2028 342c 3429 5d29 0d0a 2020  ,4), (4,4)])..  
-00022ac0: 2020 2020 2020 342e 2050 6164 6469 6e67        4. Padding
-00022ad0: 2031 3020 7069 7865 6c73 2069 6e20 7a2d   10 pixels in z-
-00022ae0: 282d 292d 6469 7265 6374 696f 6e20 616e  (-)-direction an
-00022af0: 6420 3520 7069 7865 6c73 2069 6e20 7a2d  d 5 pixels in z-
-00022b00: 282b 292d 6469 7265 6374 696f 6e2e 0d0a  (+)-direction...
-00022b10: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
-00022b20: 696d 672e 7061 6428 5b28 3130 2c20 3529  img.pad([(10, 5)
-00022b30: 5d2c 2064 696d 733d 227a 2229 0d0a 2020  ], dims="z")..  
-00022b40: 2020 2020 2020 2222 2220 2020 2020 2020        """       
-00022b50: 200d 0a20 2020 2020 2020 2070 6164 5f77   ..        pad_w
-00022b60: 6964 7468 203d 205f 6d69 7363 2e6d 616b  idth = _misc.mak
-00022b70: 655f 7061 6428 7061 645f 7769 6474 682c  e_pad(pad_width,
-00022b80: 2064 696d 732c 2073 656c 662e 6178 6573   dims, self.axes
-00022b90: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
-00022ba0: 2020 2020 2070 6164 696d 6720 3d20 6e70       padimg = np
-00022bb0: 2e70 6164 2873 656c 662e 7661 6c75 652c  .pad(self.value,
-00022bc0: 2070 6164 5f77 6964 7468 2c20 6d6f 6465   pad_width, mode
-00022bd0: 2c20 2a2a 6b77 6172 6773 292e 7669 6577  , **kwargs).view
-00022be0: 2873 656c 662e 5f5f 636c 6173 735f 5f29  (self.__class__)
-00022bf0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00022c00: 2070 6164 696d 670d 0a20 2020 200d 0a20   padimg..    .. 
-00022c10: 2020 2040 7361 6d65 5f64 7479 7065 2861     @same_dtype(a
-00022c20: 7366 6c6f 6174 3d54 7275 6529 0d0a 2020  sfloat=True)..  
-00022c30: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
-00022c40: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
-00022c50: 6566 2070 6164 5f64 6566 6f63 7573 2873  ef pad_defocus(s
-00022c60: 656c 662c 206b 6572 6e65 6c2c 202a 2c20  elf, kernel, *, 
-00022c70: 6465 7074 683a 2069 6e74 203d 2033 2c20  depth: int = 3, 
-00022c80: 7769 6474 683a 2069 6e74 203d 2036 2c20  width: int = 6, 
-00022c90: 6267 3a20 666c 6f61 7420 3d20 4e6f 6e65  bg: float = None
-00022ca0: 2920 2d3e 2049 6d67 4172 7261 793a 0d0a  ) -> ImgArray:..
-00022cb0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00022cc0: 2020 2020 204d 616b 6520 6120 7a2d 6469       Make a z-di
-00022cd0: 7265 6374 696f 6e61 6c20 7061 6464 6564  rectional padded
-00022ce0: 2069 6d61 6765 2062 7920 6465 666f 6375   image by defocu
-00022cf0: 7369 6e67 2074 6865 206f 7269 6769 6e61  sing the origina
-00022d00: 6c20 696d 6167 652e 2054 6869 7320 7061  l image. This pa
-00022d10: 6464 696e 6720 6973 0d0a 2020 2020 2020  dding is..      
-00022d20: 2020 7573 6566 756c 2077 6865 6e20 6170    useful when ap
-00022d30: 706c 7969 6e67 2046 4654 2074 6f20 6120  plying FFT to a 
-00022d40: 3344 2069 6d61 6765 2e0d 0a20 2020 2020  3D image...     
-00022d50: 2020 200d 0a20 2020 2020 2020 2050 6172     ..        Par
-00022d60: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
-00022d70: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-00022d80: 2020 2020 206b 6572 6e65 6c20 3a20 302d       kernel : 0-
-00022d90: 2c20 312d 206f 7220 332d 6469 6d65 6e73  , 1- or 3-dimens
-00022da0: 696f 6e61 6c20 6172 7261 792e 0d0a 2020  ional array...  
-00022db0: 2020 2020 2020 2020 2020 4966 2030 2d20            If 0- 
-00022dc0: 2873 6361 6c61 7229 206f 7220 312d 6469  (scalar) or 1-di
-00022dd0: 6d65 6e73 696f 6e61 6c20 6172 7261 7920  mensional array 
-00022de0: 7761 7320 6769 7665 6e2c 2074 6869 7320  was given, this 
-00022df0: 6973 2069 6e74 6572 7072 6574 6564 2061  is interpreted a
-00022e00: 7320 7374 616e 6461 7264 0d0a 2020 2020  s standard..    
-00022e10: 2020 2020 2020 2020 6465 7669 6174 696f          deviatio
-00022e20: 6e20 6f66 2047 6175 7373 6961 6e20 6b65  n of Gaussian ke
-00022e30: 726e 656c 2e20 4966 2033 2d64 696d 656e  rnel. If 3-dimen
-00022e40: 7369 6f6e 616c 2061 7272 6179 2077 6173  sional array was
-00022e50: 2067 6976 656e 2c20 7468 6973 2069 7320   given, this is 
-00022e60: 6469 7265 6374 6c79 0d0a 2020 2020 2020  directly..      
-00022e70: 2020 2020 2020 7573 6564 2061 7320 636f        used as co
-00022e80: 6e76 6f6c 7574 696f 6e20 6b65 726e 656c  nvolution kernel
-00022e90: 2e20 4f74 6865 7220 6469 6d65 6e73 696f  . Other dimensio
-00022ea0: 6e20 7769 6c6c 2072 6169 7365 2056 616c  n will raise Val
-00022eb0: 7565 4572 726f 722e 0d0a 2020 2020 2020  ueError...      
-00022ec0: 2020 6465 7074 6820 3a20 696e 742c 2064    depth : int, d
-00022ed0: 6566 6175 6c74 2069 7320 330d 0a20 2020  efault is 3..   
-00022ee0: 2020 2020 2020 2020 2044 6570 7468 206f           Depth o
-00022ef0: 6620 6465 666f 6375 7369 6e67 2e20 466f  f defocusing. Fo
-00022f00: 7220 616e 2069 6d61 6765 2077 6974 6820  r an image with 
-00022f10: 7a2d 6178 6973 2073 697a 6520 4c2c 2074  z-axis size L, t
-00022f20: 6865 6e20 6f75 7470 7574 2069 6d61 6765  hen output image
-00022f30: 2077 696c 6c20 6861 7665 0d0a 2020 2020   will have..    
-00022f40: 2020 2020 2020 2020 7369 7a65 204c 202b          size L +
-00022f50: 2032 2a64 6570 7468 2e0d 0a20 2020 2020   2*depth...     
-00022f60: 2020 2077 6964 7468 203a 2069 6e74 2c20     width : int, 
-00022f70: 6465 6661 756c 7420 6973 2036 0d0a 2020  default is 6..  
-00022f80: 2020 2020 2020 2020 2020 5769 6474 6820            Width 
-00022f90: 6f66 2064 6566 6f63 7573 696e 672e 2046  of defocusing. F
-00022fa0: 6f72 2061 6e20 696d 6167 6520 7769 7468  or an image with
-00022fb0: 2079 782d 7368 6170 6520 284d 2c20 4e29   yx-shape (M, N)
-00022fc0: 2c20 7468 656e 206f 7574 7075 7420 696d  , then output im
-00022fd0: 6167 6520 7769 6c6c 2068 6176 650d 0a20  age will have.. 
-00022fe0: 2020 2020 2020 2020 2020 2073 6861 7065             shape
-00022ff0: 2028 4d20 2a20 322a 7769 6474 682c 204e   (M * 2*width, N
-00023000: 202b 2032 2a77 6964 7468 292e 0d0a 2020   + 2*width)...  
-00023010: 2020 2020 2020 6267 203a 2066 6c6f 6174        bg : float
-00023020: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-00023030: 2020 2020 2020 2020 4261 636b 6772 6f75          Backgrou
-00023040: 6e64 2069 6e74 656e 7369 7479 2e20 4966  nd intensity. If
-00023050: 206e 6f74 2067 6976 656e 2c20 6974 2077   not given, it w
-00023060: 696c 6c20 6361 6c63 756c 6174 6564 2061  ill calculated a
-00023070: 7320 7468 6520 6d69 6e69 6d75 6d20 7661  s the minimum va
-00023080: 6c75 6520 6f66 200d 0a20 2020 2020 2020  lue of ..       
-00023090: 2020 2020 2074 6865 206f 7269 6769 6e61       the origina
-000230a0: 6c20 696d 6167 652e 0d0a 0d0a 2020 2020  l image.....    
-000230b0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-000230c0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-000230d0: 2020 2020 2020 496d 6741 7272 6179 0d0a        ImgArray..
-000230e0: 2020 2020 2020 2020 2020 2020 5061 6464              Padd
-000230f0: 6564 2069 6d61 6765 2e0d 0a20 2020 2020  ed image...     
-00023100: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00023110: 2045 7861 6d70 6c65 730d 0a20 2020 2020   Examples..     
-00023120: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
-00023130: 2020 2020 2064 6570 7468 203d 2032 0d0a       depth = 2..
-00023140: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00023150: 2020 2e2e 2063 6f64 652d 626c 6f63 6b3a    .. code-block:
-00023160: 3a0d 0a20 2020 2020 2020 200d 0a20 2020  :..        ..   
-00023170: 2020 2020 2020 2020 202d 2d2d 2d7c 2020           ----|  
-00023180: 207c 2d2d 2d2d 7c20 6f20 7c2d 2d20 2020   |----| o |--   
-00023190: 2020 6f20 2e2e 2e20 6365 6e74 6572 206f    o ... center o
-000231a0: 6620 6b65 726e 656c 0d0a 2020 2020 2020  f kernel..      
-000231b0: 2020 2020 2020 2d2d 2d2d 7c20 6f20 7c2d        ----| o |-
-000231c0: 2d2d 2d7c 2020 207c 2d2d 0d0a 2020 2020  ---|   |--..    
-000231d0: 2020 2020 2020 2020 2b2b 2b2b 7c20 2020          ++++|   
-000231e0: 7c2b 2b2b 2b7c 5f5f 5f7c 2b2b 2020 3c2d  |++++|___|++  <-
-000231f0: 2074 6865 2075 7070 6572 2065 6467 6520   the upper edge 
-00023200: 6f66 206f 7269 6769 6e61 6c20 696d 6167  of original imag
-00023210: 6520 0d0a 2020 2020 2020 2020 2020 2020  e ..            
-00023220: 2b2b 2b2b 7c5f 5f5f 7c2b 2b2b 2b2b 2b2b  ++++|___|+++++++
-00023230: 2b2b 2b2b 0d0a 0d0a 2020 2020 2020 2020  ++++....        
-00023240: 2222 220d 0a20 2020 2020 2020 2062 6720  """..        bg 
-00023250: 3d20 5f63 6865 636b 5f62 6728 7365 6c66  = _check_bg(self
-00023260: 2c20 6267 290d 0a20 2020 2020 2020 200d  , bg)..        .
-00023270: 0a20 2020 2020 2020 2069 6620 6e70 2e69  .        if np.i
-00023280: 7373 6361 6c61 7228 6b65 726e 656c 293a  sscalar(kernel):
-00023290: 0d0a 2020 2020 2020 2020 2020 2020 6b65  ..            ke
-000232a0: 726e 656c 203d 206e 702e 6172 7261 7928  rnel = np.array(
-000232b0: 5b6b 6572 6e65 6c5d 2a33 290d 0a20 2020  [kernel]*3)..   
-000232c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000232d0: 2020 2020 2020 2020 6b65 726e 656c 203d          kernel =
-000232e0: 206e 702e 6173 6172 7261 7928 6b65 726e   np.asarray(kern
-000232f0: 656c 290d 0a20 2020 2020 2020 200d 0a20  el)..        .. 
-00023300: 2020 2020 2020 2069 6620 6b65 726e 656c         if kernel
-00023310: 2e6e 6469 6d20 3c3d 2031 3a0d 0a20 2020  .ndim <= 1:..   
-00023320: 2020 2020 2020 2020 2064 6566 2066 696c           def fil
-00023330: 7465 725f 6675 6e63 2869 6d67 293a 0d0a  ter_func(img):..
-00023340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023350: 7265 7475 726e 2078 702e 6173 6e75 6d70  return xp.asnump
-00023360: 7928 5f66 696c 7465 7273 2e67 6175 7373  y(_filters.gauss
-00023370: 6961 6e5f 6669 6c74 6572 2869 6d67 2c20  ian_filter(img, 
-00023380: 6b65 726e 656c 2c20 6d6f 6465 3d22 636f  kernel, mode="co
-00023390: 6e73 7461 6e74 222c 2063 7661 6c3d 6267  nstant", cval=bg
-000233a0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-000233b0: 647a 2c20 6479 2c20 6478 203d 206b 6572  dz, dy, dx = ker
-000233c0: 6e65 6c2a 3320 2320 332d 7369 676d 610d  nel*3 # 3-sigma.
-000233d0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-000233e0: 2020 2020 2020 2065 6c69 6620 6b65 726e         elif kern
-000233f0: 656c 2e6e 6469 6d20 3d3d 2033 3a0d 0a20  el.ndim == 3:.. 
-00023400: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
-00023410: 6c20 3d20 6b65 726e 656c 2e61 7374 7970  l = kernel.astyp
-00023420: 6528 6e70 2e66 6c6f 6174 3332 290d 0a20  e(np.float32).. 
-00023430: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
-00023440: 6c20 3d20 6b65 726e 656c 202f 206e 702e  l = kernel / np.
-00023450: 7375 6d28 6b65 726e 656c 290d 0a20 2020  sum(kernel)..   
-00023460: 2020 2020 2020 2020 2064 6566 2066 696c           def fil
-00023470: 7465 725f 6675 6e63 2869 6d67 293a 0d0a  ter_func(img):..
-00023480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023490: 7265 7475 726e 2078 702e 6173 6e75 6d70  return xp.asnump
-000234a0: 7928 5f66 696c 7465 7273 2e63 6f6e 766f  y(_filters.convo
-000234b0: 6c76 6528 696d 672c 206b 6572 6e65 6c2c  lve(img, kernel,
-000234c0: 206d 6f64 653d 2263 6f6e 7374 616e 7422   mode="constant"
-000234d0: 2c20 6376 616c 3d62 6729 290d 0a20 2020  , cval=bg))..   
-000234e0: 2020 2020 2020 2020 2064 7a2c 2064 792c           dz, dy,
-000234f0: 2064 7820 3d20 6e70 2e61 7272 6179 286b   dx = np.array(k
-00023500: 6572 6e65 6c2e 7368 6170 6529 2f2f 320d  ernel.shape)//2.
-00023510: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00023520: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00023530: 6520 5661 6c75 6545 7272 6f72 2822 606b  e ValueError("`k
-00023540: 6572 6e65 6c60 206f 6e6c 7920 7461 6b65  ernel` only take
-00023550: 2030 2c20 312c 2033 2064 696d 656e 7369   0, 1, 3 dimensi
-00023560: 6f6e 616c 2061 7272 6179 2061 7320 616e  onal array as an
-00023570: 2069 6e70 7574 2e22 290d 0a20 2020 2020   input.")..     
-00023580: 2020 200d 0a20 2020 2020 2020 2070 6164     ..        pad
-00023590: 5f77 6964 7468 203d 205b 2864 6570 7468  _width = [(depth
-000235a0: 2c20 6465 7074 6829 2c20 2877 6964 7468  , depth), (width
-000235b0: 2c20 7769 6474 6829 2c20 2877 6964 7468  , width), (width
-000235c0: 2c20 7769 6474 6829 5d0d 0a20 2020 2020  , width)]..     
-000235d0: 2020 2070 6164 696d 6720 3d20 7365 6c66     padimg = self
-000235e0: 2e70 6164 2870 6164 5f77 6964 7468 2c20  .pad(pad_width, 
-000235f0: 6d6f 6465 3d22 636f 6e73 7461 6e74 222c  mode="constant",
-00023600: 2063 6f6e 7374 616e 745f 7661 6c75 6573   constant_values
-00023610: 3d62 672c 2064 696d 733d 227a 7978 2229  =bg, dims="zyx")
-00023620: 0d0a 2020 2020 2020 2020 6f75 7420 3d20  ..        out = 
-00023630: 6e70 2e63 6f70 7928 7061 6469 6d67 2e76  np.copy(padimg.v
-00023640: 616c 7565 290d 0a20 2020 2020 2020 2023  alue)..        #
-00023650: 2063 6f6e 766f 6c76 6520 7073 660d 0a20   convolve psf.. 
-00023660: 2020 2020 2020 207a 5f65 6467 6530 203d         z_edge0 =
-00023670: 2073 6c69 6365 284e 6f6e 652c 2064 6570   slice(None, dep
-00023680: 7468 2c20 4e6f 6e65 290d 0a20 2020 2020  th, None)..     
-00023690: 2020 207a 5f6d 6964 203d 2073 6c69 6365     z_mid = slice
-000236a0: 2864 6570 7468 2c20 2d64 6570 7468 2c20  (depth, -depth, 
-000236b0: 4e6f 6e65 290d 0a20 2020 2020 2020 207a  None)..        z
-000236c0: 5f65 6467 6531 203d 2073 6c69 6365 282d  _edge1 = slice(-
-000236d0: 6465 7074 682c 204e 6f6e 652c 204e 6f6e  depth, None, Non
-000236e0: 6529 0d0a 2020 2020 2020 2020 795f 6564  e)..        y_ed
-000236f0: 6765 3020 3d20 785f 6564 6765 3020 3d20  ge0 = x_edge0 = 
-00023700: 736c 6963 6528 4e6f 6e65 2c20 7769 6474  slice(None, widt
-00023710: 682c 204e 6f6e 6529 0d0a 2020 2020 2020  h, None)..      
-00023720: 2020 795f 6d69 6420 3d20 736c 6963 6528    y_mid = slice(
-00023730: 7769 6474 682c 202d 7769 6474 682c 204e  width, -width, N
-00023740: 6f6e 6529 0d0a 2020 2020 2020 2020 795f  one)..        y_
-00023750: 6564 6765 3120 3d20 785f 6564 6765 3120  edge1 = x_edge1 
-00023760: 3d20 736c 6963 6528 2d77 6964 7468 2c20  = slice(-width, 
-00023770: 4e6f 6e65 2c20 4e6f 6e65 290d 0a20 2020  None, None)..   
-00023780: 2020 2020 200d 0a20 2020 2020 2020 2066       ..        f
-00023790: 6f72 2073 6c2c 2069 6d67 2069 6e20 7061  or sl, img in pa
-000237a0: 6469 6d67 2e69 7465 7228 636f 6d70 6c65  dimg.iter(comple
-000237b0: 6d65 6e74 5f61 7865 7328 227a 7978 222c  ment_axes("zyx",
-000237c0: 2073 656c 662e 6178 6573 2929 3a0d 0a20   self.axes)):.. 
-000237d0: 2020 2020 2020 2020 2020 206f 7574 5f20             out_ 
-000237e0: 3d20 6f75 745b 736c 5d0d 0a20 2020 2020  = out[sl]..     
-000237f0: 2020 2020 2020 206f 7574 5f5b 7a5f 6564         out_[z_ed
-00023800: 6765 305d 203d 2066 696c 7465 725f 6675  ge0] = filter_fu
-00023810: 6e63 2869 6d67 5b3a 6465 7074 682b 647a  nc(img[:depth+dz
-00023820: 205d 295b 7a5f 6564 6765 305d 0d0a 2020   ])[z_edge0]..  
-00023830: 2020 2020 2020 2020 2020 6f75 745f 5b7a            out_[z
-00023840: 5f65 6467 6531 5d20 3d20 6669 6c74 6572  _edge1] = filter
-00023850: 5f66 756e 6328 696d 675b 2d64 6570 7468  _func(img[-depth
-00023860: 2d64 7a3a 5d29 5b7a 5f65 6467 6531 5d0d  -dz:])[z_edge1].
-00023870: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00023880: 5f5b 7a5f 6d69 642c 2079 5f65 6467 6530  _[z_mid, y_edge0
-00023890: 5d20 3d20 6669 6c74 6572 5f66 756e 6328  ] = filter_func(
-000238a0: 696d 675b 3a2c 203a 7769 6474 682b 6479  img[:, :width+dy
-000238b0: 205d 295b 7a5f 6d69 642c 2079 5f65 6467   ])[z_mid, y_edg
-000238c0: 6530 5d0d 0a20 2020 2020 2020 2020 2020  e0]..           
-000238d0: 206f 7574 5f5b 7a5f 6d69 642c 2079 5f65   out_[z_mid, y_e
-000238e0: 6467 6531 5d20 3d20 6669 6c74 6572 5f66  dge1] = filter_f
-000238f0: 756e 6328 696d 675b 3a2c 202d 7769 6474  unc(img[:, -widt
-00023900: 682d 6479 3a5d 295b 7a5f 6d69 642c 2079  h-dy:])[z_mid, y
-00023910: 5f65 6467 6531 5d0d 0a20 2020 2020 2020  _edge1]..       
-00023920: 2020 2020 206f 7574 5f5b 7a5f 6d69 642c       out_[z_mid,
-00023930: 2079 5f6d 6964 2c20 785f 6564 6765 305d   y_mid, x_edge0]
-00023940: 203d 2066 696c 7465 725f 6675 6e63 2869   = filter_func(i
-00023950: 6d67 5b3a 2c20 3a2c 203a 7769 6474 682b  mg[:, :, :width+
-00023960: 6478 205d 295b 7a5f 6d69 642c 2079 5f6d  dx ])[z_mid, y_m
-00023970: 6964 2c20 785f 6564 6765 305d 0d0a 2020  id, x_edge0]..  
-00023980: 2020 2020 2020 2020 2020 6f75 745f 5b7a            out_[z
-00023990: 5f6d 6964 2c20 795f 6d69 642c 2078 5f65  _mid, y_mid, x_e
-000239a0: 6467 6531 5d20 3d20 6669 6c74 6572 5f66  dge1] = filter_f
-000239b0: 756e 6328 696d 675b 3a2c 203a 2c20 2d77  unc(img[:, :, -w
-000239c0: 6964 7468 2d64 783a 5d29 5b7a 5f6d 6964  idth-dx:])[z_mid
-000239d0: 2c20 795f 6d69 642c 2078 5f65 6467 6531  , y_mid, x_edge1
-000239e0: 5d0d 0a20 2020 2020 2020 2020 2020 200d  ]..            .
-000239f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00023a00: 6f75 742e 7669 6577 2873 656c 662e 5f5f  out.view(self.__
-00023a10: 636c 6173 735f 5f29 0d0a 2020 2020 0d0a  class__)..    ..
-00023a20: 2020 2020 0d0a 2020 2020 405f 646f 6373      ..    @_docs
-00023a30: 2e77 7269 7465 5f64 6f63 730d 0a20 2020  .write_docs..   
-00023a40: 2040 6469 6d73 5f74 6f5f 7370 6174 6961   @dims_to_spatia
-00023a50: 6c5f 6178 6573 0d0a 2020 2020 4073 616d  l_axes..    @sam
-00023a60: 655f 6474 7970 6528 6173 666c 6f61 743d  e_dtype(asfloat=
-00023a70: 5472 7565 290d 0a20 2020 2040 6368 6563  True)..    @chec
-00023a80: 6b5f 696e 7075 745f 616e 645f 6f75 7470  k_input_and_outp
-00023a90: 7574 0d0a 2020 2020 6465 6620 7769 656e  ut..    def wien
-00023aa0: 6572 280d 0a20 2020 2020 2020 2073 656c  er(..        sel
-00023ab0: 662c 0d0a 2020 2020 2020 2020 7073 663a  f,..        psf:
-00023ac0: 206e 702e 6e64 6172 7261 7920 7c20 4361   np.ndarray | Ca
-00023ad0: 6c6c 6162 6c65 5b5b 7475 706c 655b 696e  llable[[tuple[in
-00023ae0: 742c 202e 2e2e 5d5d 2c20 6e70 2e6e 6461  t, ...]], np.nda
-00023af0: 7272 6179 5d2c 0d0a 2020 2020 2020 2020  rray],..        
-00023b00: 6c6d 643a 2066 6c6f 6174 203d 2030 2e31  lmd: float = 0.1
-00023b10: 2c0d 0a20 2020 2020 2020 202a 2c20 0d0a  ,..        *, ..
-00023b20: 2020 2020 2020 2020 6469 6d73 3a20 4469          dims: Di
-00023b30: 6d73 203d 204e 6f6e 652c 200d 0a20 2020  ms = None, ..   
-00023b40: 2020 2020 2075 7064 6174 653a 2062 6f6f       update: boo
-00023b50: 6c20 3d20 4661 6c73 650d 0a20 2020 2029  l = False..    )
-00023b60: 202d 3e20 496d 6741 7272 6179 3a0d 0a20   -> ImgArray:.. 
-00023b70: 2020 2020 2020 2072 2222 220d 0a20 2020         r"""..   
-00023b80: 2020 2020 2043 6c61 7373 6963 616c 2077       Classical w
-00023b90: 6965 6e65 7220 6465 636f 6e76 6f6c 7574  iener deconvolut
-00023ba0: 696f 6e2e 2054 6869 7320 616c 676f 7269  ion. This algori
-00023bb0: 7468 6d20 6861 7320 7468 6520 7365 7269  thm has the seri
-00023bc0: 6f75 7320 7269 6e67 696e 6720 7072 6f62  ous ringing prob
-00023bd0: 6c65 6d0d 0a20 2020 2020 2020 2069 6620  lem..        if 
-00023be0: 7061 7261 6d65 7465 7273 2061 7265 2073  parameters are s
-00023bf0: 6574 2074 6f20 7772 6f6e 6720 7661 6c75  et to wrong valu
-00023c00: 6573 2e0d 0a20 2020 2020 2020 200d 0a20  es...        .. 
-00023c10: 2020 2020 2020 203a 6d61 7468 3a60 465b         :math:`F[
-00023c20: 595f 7b72 6573 7d5d 203d 205c 6672 6163  Y_{res}] = \frac
-00023c30: 7b46 5b59 5f7b 6f62 737d 5d20 5c63 646f  {F[Y_{obs}] \cdo
-00023c40: 7420 5c62 6172 7b48 7d7d 7b7c 487c 5e32  t \bar{H}}{|H|^2
-00023c50: 202b 205c 6c61 6d62 6461 7d60 0d0a 2020   + \lambda}`..  
-00023c60: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00023c70: 2020 2020 3a6d 6174 683a 6059 5f7b 6f62      :math:`Y_{ob
-00023c80: 737d 603a 206f 6273 6572 7665 6420 696d  s}`: observed im
-00023c90: 6167 653b 0d0a 2020 2020 2020 2020 3a6d  age;..        :m
-00023ca0: 6174 683a 6059 5f7b 7265 737d 603a 2072  ath:`Y_{res}`: r
-00023cb0: 6573 746f 7265 6420 696d 6167 653b 0d0a  estored image;..
-00023cc0: 2020 2020 2020 2020 3a6d 6174 683a 6048          :math:`H
-00023cd0: 6020 3a20 4646 5420 6f66 2070 6f69 6e74  ` : FFT of point
-00023ce0: 2073 7072 6561 6420 6675 6e63 7469 6f6e   spread function
-00023cf0: 2028 5053 4629 3b0d 0a0d 0a20 2020 2020   (PSF);....     
-00023d00: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-00023d10: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00023d20: 2d0d 0a20 2020 2020 2020 2070 7366 203a  -..        psf :
-00023d30: 206e 6461 7272 6179 206f 7220 6361 6c6c   ndarray or call
-00023d40: 6162 6c65 0d0a 2020 2020 2020 2020 2020  able..          
-00023d50: 2020 506f 696e 7420 7370 7265 6164 2066    Point spread f
-00023d60: 756e 6374 696f 6e2e 2049 6620 6120 6675  unction. If a fu
-00023d70: 6e63 7469 6f6e 2069 7320 6769 7665 6e2c  nction is given,
-00023d80: 2060 7073 6628 7368 6170 6529 6020 7769   `psf(shape)` wi
-00023d90: 6c6c 2062 650d 0a20 2020 2020 2020 2020  ll be..         
-00023da0: 2020 2063 616c 6c65 6420 746f 2067 656e     called to gen
-00023db0: 6572 6174 6520 7468 6520 5053 462e 0d0a  erate the PSF...
-00023dc0: 2020 2020 2020 2020 6c6d 6420 3a20 666c          lmd : fl
-00023dd0: 6f61 742c 2064 6566 6175 6c74 2069 7320  oat, default is 
-00023de0: 302e 310d 0a20 2020 2020 2020 2020 2020  0.1..           
-00023df0: 2043 6f6e 7374 616e 7420 7661 6c75 6520   Constant value 
-00023e00: 7573 6564 2069 6e20 7468 6520 6465 636f  used in the deco
-00023e10: 6e76 6f6c 7574 696f 6e2e 2053 6565 2046  nvolution. See F
-00023e20: 6f72 6d75 6c61 7469 6f6e 2062 656c 6f77  ormulation below
-00023e30: 2e0d 0a20 2020 2020 2020 207b 6469 6d73  ...        {dims
-00023e40: 7d7b 7570 6461 7465 7d0d 0a0d 0a20 2020  }{update}....   
-00023e50: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-00023e60: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-00023e70: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
-00023e80: 0a20 2020 2020 2020 2020 2020 2044 6563  .            Dec
-00023e90: 6f6e 766f 6c76 6564 2069 6d61 6765 2e0d  onvolved image..
-00023ea0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00023eb0: 2020 200d 0a20 2020 2020 2020 2053 6565     ..        See
-00023ec0: 2041 6c73 6f0d 0a20 2020 2020 2020 202d   Also..        -
-00023ed0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-00023ee0: 206c 7563 790d 0a20 2020 2020 2020 206c   lucy..        l
-00023ef0: 7563 795f 7476 0d0a 2020 2020 2020 2020  ucy_tv..        
-00023f00: 2222 2220 2020 2020 2020 200d 0a20 2020  """        ..   
-00023f10: 2020 2020 2069 6620 6c6d 6420 3c3d 2030       if lmd <= 0
-00023f20: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00023f30: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00023f40: 6622 6c6d 6420 6d75 7374 2062 6520 706f  f"lmd must be po
-00023f50: 7369 7469 7665 2c20 6275 7420 676f 743a  sitive, but got:
-00023f60: 207b 6c6d 647d 2229 0d0a 2020 2020 2020   {lmd}")..      
-00023f70: 2020 0d0a 2020 2020 2020 2020 7073 665f    ..        psf_
-00023f80: 6674 2c20 7073 665f 6674 5f63 6f6e 6a20  ft, psf_ft_conj 
-00023f90: 3d20 5f64 6563 6f6e 762e 6368 6563 6b5f  = _deconv.check_
-00023fa0: 7073 6628 0d0a 2020 2020 2020 2020 2020  psf(..          
-00023fb0: 2020 7365 6c66 2e73 697a 6573 6f66 2864    self.sizesof(d
-00023fc0: 696d 7329 2c20 7475 706c 6528 7365 6c66  ims), tuple(self
-00023fd0: 2e73 6361 6c65 5b61 7869 735d 2066 6f72  .scale[axis] for
-00023fe0: 2061 7869 7320 696e 2064 696d 7329 2c20   axis in dims), 
-00023ff0: 7073 662c 0d0a 2020 2020 2020 2020 290d  psf,..        ).
-00024000: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00024010: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00024020: 6170 706c 795f 6461 736b 280d 0a20 2020  apply_dask(..   
-00024030: 2020 2020 2020 2020 205f 6465 636f 6e76           _deconv
-00024040: 2e77 6965 6e65 722c 200d 0a20 2020 2020  .wiener, ..     
-00024050: 2020 2020 2020 2063 5f61 7865 733d 636f         c_axes=co
-00024060: 6d70 6c65 6d65 6e74 5f61 7865 7328 6469  mplement_axes(di
-00024070: 6d73 2c20 7365 6c66 2e61 7865 7329 2c0d  ms, self.axes),.
-00024080: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-00024090: 733d 2870 7366 5f66 742c 2070 7366 5f66  s=(psf_ft, psf_f
-000240a0: 745f 636f 6e6a 2c20 6c6d 6429 0d0a 2020  t_conj, lmd)..  
-000240b0: 2020 2020 2020 2920 2020 200d 0a0d 0a20        )    .... 
-000240c0: 2020 2040 5f64 6f63 732e 7772 6974 655f     @_docs.write_
-000240d0: 646f 6373 0d0a 2020 2020 4064 696d 735f  docs..    @dims_
-000240e0: 746f 5f73 7061 7469 616c 5f61 7865 730d  to_spatial_axes.
-000240f0: 0a20 2020 2040 7361 6d65 5f64 7479 7065  .    @same_dtype
-00024100: 2861 7366 6c6f 6174 3d54 7275 6529 0d0a  (asfloat=True)..
-00024110: 2020 2020 4063 6865 636b 5f69 6e70 7574      @check_input
-00024120: 5f61 6e64 5f6f 7574 7075 740d 0a20 2020  _and_output..   
-00024130: 2064 6566 206c 7563 7928 0d0a 2020 2020   def lucy(..    
-00024140: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00024150: 2020 2070 7366 3a20 6e70 2e6e 6461 7272     psf: np.ndarr
-00024160: 6179 207c 2043 616c 6c61 626c 655b 5b74  ay | Callable[[t
-00024170: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 5d2c  uple[int, ...]],
-00024180: 206e 702e 6e64 6172 7261 795d 2c0d 0a20   np.ndarray],.. 
-00024190: 2020 2020 2020 206e 6974 6572 3a20 696e         niter: in
-000241a0: 7420 3d20 3530 2c0d 0a20 2020 2020 2020  t = 50,..       
-000241b0: 2065 7073 3a20 666c 6f61 7420 3d20 3165   eps: float = 1e
-000241c0: 2d35 2c0d 0a20 2020 2020 2020 202a 2c20  -5,..        *, 
-000241d0: 0d0a 2020 2020 2020 2020 6469 6d73 3a20  ..        dims: 
-000241e0: 4469 6d73 203d 204e 6f6e 652c 200d 0a20  Dims = None, .. 
-000241f0: 2020 2020 2020 2075 7064 6174 653a 2062         update: b
-00024200: 6f6f 6c20 3d20 4661 6c73 650d 0a20 2020  ool = False..   
-00024210: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
-00024220: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00024230: 2020 2020 2020 4465 636f 6e76 6f6c 7574        Deconvolut
-00024240: 696f 6e20 6f66 204e 2d64 696d 656e 7369  ion of N-dimensi
-00024250: 6f6e 616c 2069 6d61 6765 2c20 7573 696e  onal image, usin
-00024260: 6720 5269 6368 6172 6473 6f6e 2d4c 7563  g Richardson-Luc
-00024270: 7927 7320 616c 676f 7269 7468 6d2e 0d0a  y's algorithm...
-00024280: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00024290: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-000242a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-000242b0: 0d0a 2020 2020 2020 2020 7073 6620 3a20  ..        psf : 
-000242c0: 6e64 6172 7261 7920 6f72 2063 616c 6c61  ndarray or calla
-000242d0: 626c 650d 0a20 2020 2020 2020 2020 2020  ble..           
-000242e0: 2050 6f69 6e74 2073 7072 6561 6420 6675   Point spread fu
-000242f0: 6e63 7469 6f6e 2e20 4966 2061 2066 756e  nction. If a fun
-00024300: 6374 696f 6e20 6973 2067 6976 656e 2c20  ction is given, 
-00024310: 6070 7366 2873 6861 7065 2960 2077 696c  `psf(shape)` wil
-00024320: 6c20 6265 0d0a 2020 2020 2020 2020 2020  l be..          
-00024330: 2020 6361 6c6c 6564 2074 6f20 6765 6e65    called to gene
-00024340: 7261 7465 2074 6865 2050 5346 2e0d 0a20  rate the PSF... 
-00024350: 2020 2020 2020 206e 6974 6572 203a 2069         niter : i
-00024360: 6e74 2c20 6465 6661 756c 7420 6973 2035  nt, default is 5
-00024370: 302e 0d0a 2020 2020 2020 2020 2020 2020  0...            
-00024380: 4e75 6d62 6572 206f 6620 6974 6572 6174  Number of iterat
-00024390: 696f 6e73 2e0d 0a20 2020 2020 2020 2065  ions...        e
-000243a0: 7073 203a 2066 6c6f 6174 2c20 6465 6661  ps : float, defa
-000243b0: 756c 7420 6973 2031 652d 350d 0a20 2020  ult is 1e-5..   
-000243c0: 2020 2020 2020 2020 2044 7572 696e 6720           During 
-000243d0: 6465 636f 6e76 6f6c 7574 696f 6e2c 2064  deconvolution, d
-000243e0: 6976 6973 696f 6e20 6279 2073 6d61 6c6c  ivision by small
-000243f0: 2076 616c 7565 7320 696e 2074 6865 2063   values in the c
-00024400: 6f6e 766f 6c76 6520 696d 6167 6520 0d0a  onvolve image ..
-00024410: 2020 2020 2020 2020 2020 2020 6f66 2065              of e
-00024420: 7374 696d 6174 696f 6e20 616e 6420 5053  stimation and PS
-00024430: 4620 6d61 7920 6361 7573 6520 6469 7665  F may cause dive
-00024440: 7267 656e 6365 2e20 5468 6572 6566 6f72  rgence. Therefor
-00024450: 652c 2064 6976 6973 696f 6e20 6279 200d  e, division by .
-00024460: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00024470: 7565 7320 756e 6465 7220 6065 7073 6020  ues under `eps` 
-00024480: 6973 2073 7562 7374 6974 7574 6564 2074  is substituted t
-00024490: 6f20 7a65 726f 2e0d 0a20 2020 2020 2020  o zero...       
-000244a0: 207b 6469 6d73 7d7b 7570 6461 7465 7d0d   {dims}{update}.
-000244b0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-000244c0: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-000244d0: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
-000244e0: 2020 2020 2049 6d67 4172 7261 790d 0a20       ImgArray.. 
-000244f0: 2020 2020 2020 2020 2020 2044 6563 6f6e             Decon
-00024500: 766f 6c76 6564 2069 6d61 6765 2e0d 0a20  volved image... 
-00024510: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00024520: 2053 6565 2041 6c73 6f0d 0a20 2020 2020   See Also..     
-00024530: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
-00024540: 2020 2020 206c 7563 795f 7476 0d0a 2020       lucy_tv..  
-00024550: 2020 2020 2020 7769 656e 6572 0d0a 2020        wiener..  
-00024560: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00024570: 2020 200d 0a20 2020 2020 2020 2070 7366     ..        psf
-00024580: 5f66 742c 2070 7366 5f66 745f 636f 6e6a  _ft, psf_ft_conj
-00024590: 203d 205f 6465 636f 6e76 2e63 6865 636b   = _deconv.check
-000245a0: 5f70 7366 280d 0a20 2020 2020 2020 2020  _psf(..         
-000245b0: 2020 2073 656c 662e 7369 7a65 736f 6628     self.sizesof(
-000245c0: 6469 6d73 292c 2074 7570 6c65 2873 656c  dims), tuple(sel
-000245d0: 662e 7363 616c 655b 6178 6973 5d20 666f  f.scale[axis] fo
-000245e0: 7220 6178 6973 2069 6e20 6469 6d73 292c  r axis in dims),
-000245f0: 2070 7366 2c0d 0a20 2020 2020 2020 2029   psf,..        )
-00024600: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-00024610: 726e 2073 656c 662e 5f61 7070 6c79 5f64  rn self._apply_d
-00024620: 6173 6b28 0d0a 2020 2020 2020 2020 2020  ask(..          
-00024630: 2020 5f64 6563 6f6e 762e 7269 6368 6172    _deconv.richar
-00024640: 6473 6f6e 5f6c 7563 792c 200d 0a20 2020  dson_lucy, ..   
-00024650: 2020 2020 2020 2020 2063 5f61 7865 733d           c_axes=
-00024660: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
-00024670: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
-00024680: 2c0d 0a20 2020 2020 2020 2020 2020 2061  ,..            a
-00024690: 7267 733d 2870 7366 5f66 742c 2070 7366  rgs=(psf_ft, psf
-000246a0: 5f66 745f 636f 6e6a 2c20 6e69 7465 722c  _ft_conj, niter,
-000246b0: 2065 7073 290d 0a20 2020 2020 2020 2029   eps)..        )
-000246c0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000246d0: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
-000246e0: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
-000246f0: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
-00024700: 2020 4073 616d 655f 6474 7970 6528 6173    @same_dtype(as
-00024710: 666c 6f61 743d 5472 7565 290d 0a20 2020  float=True)..   
-00024720: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
-00024730: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
-00024740: 6620 6c75 6379 5f74 7628 0d0a 2020 2020  f lucy_tv(..    
-00024750: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00024760: 2020 2070 7366 3a20 6e70 2e6e 6461 7272     psf: np.ndarr
-00024770: 6179 207c 2043 616c 6c61 626c 655b 5b74  ay | Callable[[t
-00024780: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 5d2c  uple[int, ...]],
-00024790: 206e 702e 6e64 6172 7261 795d 2c0d 0a20   np.ndarray],.. 
-000247a0: 2020 2020 2020 206d 6178 5f69 7465 723a         max_iter:
-000247b0: 2069 6e74 203d 2035 302c 0d0a 2020 2020   int = 50,..    
-000247c0: 2020 2020 6c6d 643a 2066 6c6f 6174 203d      lmd: float =
-000247d0: 2031 652d 332c 0d0a 2020 2020 2020 2020   1e-3,..        
-000247e0: 746f 6c3a 2066 6c6f 6174 203d 2031 652d  tol: float = 1e-
-000247f0: 332c 0d0a 2020 2020 2020 2020 6570 733a  3,..        eps:
-00024800: 2066 6c6f 6174 203d 2031 652d 352c 0d0a   float = 1e-5,..
-00024810: 2020 2020 2020 2020 2a2c 0d0a 2020 2020          *,..    
-00024820: 2020 2020 6469 6d73 3a20 4469 6d73 203d      dims: Dims =
-00024830: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-00024840: 7570 6461 7465 3a20 626f 6f6c 203d 2046  update: bool = F
-00024850: 616c 7365 0d0a 2020 2020 2920 2d3e 2049  alse..    ) -> I
-00024860: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
-00024870: 2020 7222 2222 0d0a 2020 2020 2020 2020    r"""..        
-00024880: 4465 636f 6e76 6f6c 7574 696f 6e20 6f66  Deconvolution of
-00024890: 204e 2d64 696d 656e 7369 6f6e 616c 2069   N-dimensional i
-000248a0: 6d61 6765 2c20 7573 696e 6720 5269 6368  mage, using Rich
-000248b0: 6172 6473 6f6e 2d4c 7563 7927 7320 616c  ardson-Lucy's al
-000248c0: 676f 7269 7468 6d20 7769 7468 0d0a 2020  gorithm with..  
-000248d0: 2020 2020 2020 746f 7461 6c20 7661 7269        total vari
-000248e0: 616e 6365 2072 6567 756c 6172 697a 6174  ance regularizat
-000248f0: 696f 6e20 2873 6f20 6361 6c6c 6564 2052  ion (so called R
-00024900: 4c2d 5456 2061 6c67 6f72 6974 686d 292e  L-TV algorithm).
-00024910: 2054 6865 2054 5620 7265 6775 6c61 7269   The TV regulari
-00024920: 7a61 7469 6f6e 0d0a 2020 2020 2020 2020  zation..        
-00024930: 6661 6374 6f72 2061 7420 7069 7865 6c20  factor at pixel 
-00024940: 706f 7369 7469 6f6e 203a 6d61 7468 3a60  position :math:`
-00024950: 7860 2c20 3a6d 6174 683a 6046 5f7b 7265  x`, :math:`F_{re
-00024960: 677d 2878 2960 2c20 6973 2063 616c 6375  g}(x)`, is calcu
-00024970: 6c61 7465 6420 6173 3a0d 0a20 2020 2020  lated as:..     
-00024980: 2020 200d 0a20 2020 2020 2020 202e 2e20     ..        .. 
-00024990: 6d61 7468 3a3a 0d0a 2020 2020 2020 2020  math::..        
-000249a0: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-000249b0: 2020 465f 7b72 6567 7d28 7829 203d 205c    F_{reg}(x) = \
-000249c0: 6672 6163 7b31 7d7b 312d 5c6c 616d 6264  frac{1}{1-\lambd
-000249d0: 6120 5c63 646f 7420 6469 7628 5c66 7261  a \cdot div(\fra
-000249e0: 637b 6772 6164 2849 2878 297d 7b7c 6772  c{grad(I(x)}{|gr
-000249f0: 6164 2849 2878 2929 7c7d 297d 0d0a 2020  ad(I(x))|})}..  
-00024a00: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00024a10: 283a 6d61 7468 3a60 4928 7829 603a 2069  (:math:`I(x)`: i
-00024a20: 6d61 6765 2c20 3a6d 6174 683a 605c 6c61  mage, :math:`\la
-00024a30: 6d62 6461 603a 2063 6f6e 7374 616e 7429  mbda`: constant)
-00024a40: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00024a50: 2020 2020 616e 6420 7468 6973 2066 6163      and this fac
-00024a60: 746f 7220 6973 206d 756c 7469 706c 6965  tor is multiplie
-00024a70: 6420 666f 7220 6576 6572 7920 6573 7469  d for every esti
-00024a80: 6d61 7469 6f6e 206d 6164 6520 696e 2065  mation made in e
-00024a90: 6163 6820 6974 6572 6174 696f 6e2e 0d0a  ach iteration...
-00024aa0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00024ab0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-00024ac0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00024ad0: 0d0a 2020 2020 2020 2020 7073 6620 3a20  ..        psf : 
-00024ae0: 6e64 6172 7261 7920 6f72 2063 616c 6c61  ndarray or calla
-00024af0: 626c 650d 0a20 2020 2020 2020 2020 2020  ble..           
-00024b00: 2050 6f69 6e74 2073 7072 6561 6420 6675   Point spread fu
-00024b10: 6e63 7469 6f6e 2e20 4966 2061 2066 756e  nction. If a fun
-00024b20: 6374 696f 6e20 6973 2067 6976 656e 2c20  ction is given, 
-00024b30: 6070 7366 2873 6861 7065 2960 2077 696c  `psf(shape)` wil
-00024b40: 6c20 6265 0d0a 2020 2020 2020 2020 2020  l be..          
-00024b50: 2020 6361 6c6c 6564 2074 6f20 6765 6e65    called to gene
-00024b60: 7261 7465 2074 6865 2050 5346 2e0d 0a20  rate the PSF... 
-00024b70: 2020 2020 2020 206d 6178 5f69 7465 7220         max_iter 
-00024b80: 3a20 696e 742c 2064 6566 6175 6c74 2069  : int, default i
-00024b90: 7320 3530 2e0d 0a20 2020 2020 2020 2020  s 50...         
-00024ba0: 2020 204d 6178 696d 756d 206e 756d 6265     Maximum numbe
-00024bb0: 7220 6f66 2069 7465 7261 7469 6f6e 732e  r of iterations.
-00024bc0: 0d0a 2020 2020 2020 2020 6c6d 6420 3a20  ..        lmd : 
-00024bd0: 666c 6f61 742c 2064 6566 6175 6c74 2069  float, default i
-00024be0: 7320 3165 2d33 0d0a 2020 2020 2020 2020  s 1e-3..        
-00024bf0: 2020 2020 5468 6520 636f 6e73 7461 6e74      The constant
-00024c00: 206c 616d 6264 6120 6f66 2054 5620 7265   lambda of TV re
-00024c10: 6775 6c61 7269 7a61 7469 6f6e 2066 6163  gularization fac
-00024c20: 746f 722e 0d0a 2020 2020 2020 2020 746f  tor...        to
-00024c30: 6c20 3a20 666c 6f61 742c 2064 6566 6175  l : float, defau
-00024c40: 6c74 2069 7320 3165 2d33 0d0a 2020 2020  lt is 1e-3..    
-00024c50: 2020 2020 2020 2020 4974 6572 6174 696f          Iteratio
-00024c60: 6e20 7374 6f70 7320 6966 2072 6567 756c  n stops if regul
-00024c70: 6172 697a 6564 2061 6273 6f6c 7574 6520  arized absolute 
-00024c80: 7375 6d6d 6174 696f 6e20 6973 206c 6f77  summation is low
-00024c90: 6572 2074 6861 6e20 7468 6973 200d 0a20  er than this .. 
-00024ca0: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00024cb0: 2e0d 0a20 2020 2020 2020 2020 2020 200d  ...            .
-00024cc0: 0a20 2020 2020 2020 2020 2020 203a 6d61  .            :ma
-00024cd0: 7468 3a60 5c66 7261 637b 5c73 756d 5f7b  th:`\frac{\sum_{
-00024ce0: 787d 7c49 2728 7829 202d 2049 2878 297c  x}|I'(x) - I(x)|
-00024cf0: 7d7b 5c73 756d 5f7b 787d 7c49 2878 297c  }{\sum_{x}|I(x)|
-00024d00: 7d60 0d0a 2020 2020 2020 2020 2020 2020  }`..            
-00024d10: 0d0a 2020 2020 2020 2020 2020 2020 283a  ..            (:
-00024d20: 6d61 7468 3a60 4927 2878 2960 3a20 6573  math:`I'(x)`: es
-00024d30: 7469 6d61 7469 6f6e 206f 6620 3a6d 6174  timation of :mat
-00024d40: 683a 606b 2b31 602d 7468 2069 7465 7261  h:`k+1`-th itera
-00024d50: 7469 6f6e 2c20 3a6d 6174 683a 6049 2878  tion, :math:`I(x
-00024d60: 2960 3a20 0d0a 2020 2020 2020 2020 2020  )`: ..          
-00024d70: 2020 6573 7469 6d61 7469 6f6e 206f 6620    estimation of 
-00024d80: 3a6d 6174 683a 606b 602d 7468 2069 7465  :math:`k`-th ite
-00024d90: 7261 7469 6f6e 290d 0a20 2020 2020 2020  ration)..       
-00024da0: 200d 0a20 2020 2020 2020 2065 7073 203a   ..        eps :
-00024db0: 2066 6c6f 6174 2c20 6465 6661 756c 7420   float, default 
-00024dc0: 6973 2031 652d 350d 0a20 2020 2020 2020  is 1e-5..       
-00024dd0: 2020 2020 2044 7572 696e 6720 6465 636f       During deco
-00024de0: 6e76 6f6c 7574 696f 6e2c 2064 6976 6973  nvolution, divis
-00024df0: 696f 6e20 6279 2073 6d61 6c6c 2076 616c  ion by small val
-00024e00: 7565 7320 696e 2074 6865 2063 6f6e 766f  ues in the convo
-00024e10: 6c76 6520 696d 6167 6520 6f66 0d0a 2020  lve image of..  
-00024e20: 2020 2020 2020 2020 2020 6573 7469 6d61            estima
-00024e30: 7469 6f6e 2061 6e64 2050 5346 206d 6179  tion and PSF may
-00024e40: 2063 6175 7365 2064 6976 6572 6765 6e63   cause divergenc
-00024e50: 652e 2054 6865 7265 666f 7265 2c20 6469  e. Therefore, di
-00024e60: 7669 7369 6f6e 2062 7920 7661 6c75 6573  vision by values
-00024e70: 200d 0a20 2020 2020 2020 2020 2020 2075   ..            u
-00024e80: 6e64 6572 2060 6065 7073 6060 2069 7320  nder ``eps`` is 
-00024e90: 7375 6273 7469 7475 7465 6420 746f 207a  substituted to z
-00024ea0: 6572 6f2e 0d0a 2020 2020 2020 2020 7b64  ero...        {d
-00024eb0: 696d 737d 7b75 7064 6174 657d 0d0a 2020  ims}{update}..  
-00024ec0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00024ed0: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-00024ee0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
-00024ef0: 2020 496d 6741 7272 6179 0d0a 2020 2020    ImgArray..    
-00024f00: 2020 2020 2020 2020 4465 636f 6e76 6f6c          Deconvol
-00024f10: 7665 6420 696d 6167 652e 0d0a 2020 2020  ved image...    
-00024f20: 2020 2020 0d0a 2020 2020 2020 2020 5265      ..        Re
-00024f30: 6665 7265 6e63 6573 0d0a 2020 2020 2020  ferences..      
-00024f40: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-00024f50: 2020 2020 2020 2d20 4465 792c 204e 2e2c        - Dey, N.,
-00024f60: 2042 6c61 6e63 2d46 c3a9 7261 7564 2c20   Blanc-F..raud, 
-00024f70: 4c2e 2c20 5a69 6d6d 6572 2c20 432e 2c20  L., Zimmer, C., 
-00024f80: 526f 7578 2c20 502e 2c20 4b61 6d2c 205a  Roux, P., Kam, Z
-00024f90: 2e2c 204f 6c69 766f 2d4d 6172 696e 2c20  ., Olivo-Marin, 
-00024fa0: 4a2e 2043 2e2c 200d 0a20 2020 2020 2020  J. C., ..       
-00024fb0: 2020 2026 205a 6572 7562 6961 2c20 4a2e     & Zerubia, J.
-00024fc0: 2028 3230 3034 292e 2033 4420 6d69 6372   (2004). 3D micr
-00024fd0: 6f73 636f 7079 2064 6563 6f6e 766f 6c75  oscopy deconvolu
-00024fe0: 7469 6f6e 2075 7369 6e67 2052 6963 6861  tion using Richa
-00024ff0: 7264 736f 6e2d 4c75 6379 2061 6c67 6f72  rdson-Lucy algor
-00025000: 6974 686d 200d 0a20 2020 2020 2020 2020  ithm ..         
-00025010: 2077 6974 6820 746f 7461 6c20 7661 7269   with total vari
-00025020: 6174 696f 6e20 7265 6775 6c61 7269 7a61  ation regulariza
-00025030: 7469 6f6e 2028 446f 6374 6f72 616c 2064  tion (Doctoral d
-00025040: 6973 7365 7274 6174 696f 6e2c 2049 4e52  issertation, INR
-00025050: 4941 292e 0d0a 2020 2020 2020 2020 0d0a  IA)...        ..
-00025060: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00025070: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-00025080: 2d2d 0d0a 2020 2020 2020 2020 6c75 6379  --..        lucy
-00025090: 0d0a 2020 2020 2020 2020 7769 656e 6572  ..        wiener
-000250a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000250b0: 2020 2020 2020 2069 6620 6c6d 6420 3c3d         if lmd <=
-000250c0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-000250d0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000250e0: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
-000250f0: 2020 2020 2249 6e20 5269 6368 6164 736f      "In Richadso
-00025100: 6e2d 4c75 6379 2077 6974 6820 746f 7461  n-Lucy with tota
-00025110: 6c2d 7661 7269 616e 6365 2d72 6567 756c  l-variance-regul
-00025120: 6172 697a 6174 696f 6e2c 2022 0d0a 2020  arization, "..  
-00025130: 2020 2020 2020 2020 2020 2020 2020 2270                "p
-00025140: 6172 616d 6574 6572 2060 6c6d 6460 206d  arameter `lmd` m
-00025150: 7573 7420 6265 2070 6f73 6974 6976 652e  ust be positive.
-00025160: 220d 0a20 2020 2020 2020 2020 2020 2029  "..            )
-00025170: 0d0a 2020 2020 2020 2020 7073 665f 6674  ..        psf_ft
-00025180: 2c20 7073 665f 6674 5f63 6f6e 6a20 3d20  , psf_ft_conj = 
-00025190: 5f64 6563 6f6e 762e 6368 6563 6b5f 7073  _deconv.check_ps
-000251a0: 6628 0d0a 2020 2020 2020 2020 2020 2020  f(..            
-000251b0: 7365 6c66 2e73 697a 6573 6f66 2864 696d  self.sizesof(dim
-000251c0: 7329 2c20 7475 706c 6528 7365 6c66 2e73  s), tuple(self.s
-000251d0: 6361 6c65 5b61 7869 735d 2066 6f72 2061  cale[axis] for a
-000251e0: 7869 7320 696e 2064 696d 7329 2c20 7073  xis in dims), ps
-000251f0: 660d 0a20 2020 2020 2020 2029 0d0a 0d0a  f..        )....
-00025200: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00025210: 656c 662e 5f61 7070 6c79 5f64 6173 6b28  elf._apply_dask(
-00025220: 0d0a 2020 2020 2020 2020 2020 2020 5f64  ..            _d
-00025230: 6563 6f6e 762e 7269 6368 6172 6473 6f6e  econv.richardson
-00025240: 5f6c 7563 795f 7476 2c20 0d0a 2020 2020  _lucy_tv, ..    
-00025250: 2020 2020 2020 2020 635f 6178 6573 3d63          c_axes=c
-00025260: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
-00025270: 696d 732c 2073 656c 662e 6178 6573 292c  ims, self.axes),
-00025280: 0d0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
-00025290: 6773 3d28 7073 665f 6674 2c20 7073 665f  gs=(psf_ft, psf_
-000252a0: 6674 5f63 6f6e 6a2c 206d 6178 5f69 7465  ft_conj, max_ite
-000252b0: 722c 206c 6d64 2c20 746f 6c2c 2065 7073  r, lmd, tol, eps
-000252c0: 290d 0a20 2020 2020 2020 2029 0d0a 0d0a  )..        )....
-000252d0: 2020 2020 405f 646f 6373 2e77 7269 7465      @_docs.write
-000252e0: 5f64 6f63 730d 0a20 2020 2040 6469 6d73  _docs..    @dims
-000252f0: 5f74 6f5f 7370 6174 6961 6c5f 6178 6573  _to_spatial_axes
-00025300: 0d0a 2020 2020 4073 616d 655f 6474 7970  ..    @same_dtyp
-00025310: 6528 6173 666c 6f61 743d 5472 7565 290d  e(asfloat=True).
-00025320: 0a20 2020 2040 6368 6563 6b5f 696e 7075  .    @check_inpu
-00025330: 745f 616e 645f 6f75 7470 7574 0d0a 2020  t_and_output..  
-00025340: 2020 6465 6620 7469 6c65 645f 6c75 6379    def tiled_lucy
-00025350: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
-00025360: 0d0a 2020 2020 2020 2020 7073 663a 206e  ..        psf: n
-00025370: 702e 6e64 6172 7261 7920 7c20 4361 6c6c  p.ndarray | Call
-00025380: 6162 6c65 5b5b 7475 706c 655b 696e 742c  able[[tuple[int,
-00025390: 202e 2e2e 5d5d 2c20 6e70 2e6e 6461 7272   ...]], np.ndarr
-000253a0: 6179 5d2c 0d0a 2020 2020 2020 2020 6e69  ay],..        ni
-000253b0: 7465 723a 2069 6e74 203d 2035 302c 0d0a  ter: int = 50,..
-000253c0: 2020 2020 2020 2020 6570 733a 2066 6c6f          eps: flo
-000253d0: 6174 203d 2031 652d 352c 0d0a 2020 2020  at = 1e-5,..    
-000253e0: 2020 2020 6368 756e 6b73 203d 2022 6175      chunks = "au
-000253f0: 746f 222c 0d0a 2020 2020 2020 2020 6f76  to",..        ov
-00025400: 6572 6c61 703a 2069 6e74 203d 2033 322c  erlap: int = 32,
-00025410: 0d0a 2020 2020 2020 2020 2a2c 200d 0a20  ..        *, .. 
-00025420: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
-00025430: 7320 3d20 4e6f 6e65 2c20 0d0a 2020 2020  s = None, ..    
-00025440: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
-00025450: 203d 2046 616c 7365 0d0a 2020 2020 2920   = False..    ) 
-00025460: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
-00025470: 2020 2020 2020 6672 6f6d 2064 6173 6b20        from dask 
-00025480: 696d 706f 7274 2061 7272 6179 2061 7320  import array as 
-00025490: 6461 0d0a 0d0a 2020 2020 2020 2020 696e  da....        in
-000254a0: 7075 7420 3d20 6461 2e66 726f 6d5f 6172  put = da.from_ar
-000254b0: 7261 7928 7365 6c66 2e76 616c 7565 2c20  ray(self.value, 
-000254c0: 6368 756e 6b73 3d63 6875 6e6b 7329 0d0a  chunks=chunks)..
-000254d0: 2020 2020 2020 2020 6465 7074 6820 3d20          depth = 
-000254e0: 7377 6974 6368 5f73 6c69 6365 2864 696d  switch_slice(dim
-000254f0: 732c 2073 656c 662e 6178 6573 2c20 6f76  s, self.axes, ov
-00025500: 6572 6c61 702c 2030 290d 0a20 2020 2020  erlap, 0)..     
-00025510: 2020 2073 6361 6c65 203d 2074 7570 6c65     scale = tuple
-00025520: 2873 656c 662e 7363 616c 655b 6178 6973  (self.scale[axis
-00025530: 5d20 666f 7220 6178 6973 2069 6e20 6469  ] for axis in di
-00025540: 6d73 290d 0a20 2020 2020 2020 200d 0a20  ms)..        .. 
-00025550: 2020 2020 2020 2064 6566 2066 756e 6328         def func(
-00025560: 6172 723a 206e 702e 6e64 6172 7261 7929  arr: np.ndarray)
-00025570: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00025580: 7366 5f66 742c 2070 7366 5f66 745f 636f  sf_ft, psf_ft_co
-00025590: 6e6a 203d 205f 6465 636f 6e76 2e63 6865  nj = _deconv.che
-000255a0: 636b 5f70 7366 2861 7272 2e73 6861 7065  ck_psf(arr.shape
-000255b0: 2c20 7363 616c 652c 2070 7366 290d 0a20  , scale, psf).. 
-000255c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000255d0: 6e20 5f64 6563 6f6e 762e 7269 6368 6172  n _deconv.richar
-000255e0: 6473 6f6e 5f6c 7563 7928 6172 722c 2070  dson_lucy(arr, p
-000255f0: 7366 5f66 742c 2070 7366 5f66 745f 636f  sf_ft, psf_ft_co
-00025600: 6e6a 2c20 6e69 7465 722c 2065 7073 290d  nj, niter, eps).
-00025610: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-00025620: 2020 2020 2020 206f 7574 203d 2064 612e         out = da.
-00025630: 6d61 705f 6f76 6572 6c61 7028 0d0a 2020  map_overlap(..  
-00025640: 2020 2020 2020 2020 2020 6675 6e63 2c20            func, 
-00025650: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-00025660: 7075 742c 0d0a 2020 2020 2020 2020 2020  put,..          
-00025670: 2020 6465 7074 683d 6465 7074 682c 0d0a    depth=depth,..
-00025680: 2020 2020 2020 2020 2020 2020 626f 756e              boun
-00025690: 6461 7279 3d22 7265 666c 6563 7422 2c0d  dary="reflect",.
-000256a0: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
-000256b0: 7065 3d73 656c 662e 6474 7970 652c 0d0a  pe=self.dtype,..
-000256c0: 2020 2020 2020 2020 292e 636f 6d70 7574          ).comput
-000256d0: 6528 290d 0a20 2020 2020 2020 2072 6574  e()..        ret
-000256e0: 7572 6e20 6f75 740d 0a0d 0a64 6566 205f  urn out....def _
-000256f0: 6368 6563 6b5f 636f 6f72 6469 6e61 7465  check_coordinate
-00025700: 7328 636f 6f72 6473 2c20 696d 673a 2049  s(coords, img: I
-00025710: 6d67 4172 7261 792c 2064 696d 733a 2044  mgArray, dims: D
-00025720: 696d 7320 3d20 4e6f 6e65 293a 0d0a 2020  ims = None):..  
-00025730: 2020 6672 6f6d 2069 6d70 792e 6672 616d    from impy.fram
-00025740: 6520 696d 706f 7274 204d 6172 6b65 7246  e import MarkerF
-00025750: 7261 6d65 0d0a 0d0a 2020 2020 6966 206e  rame....    if n
-00025760: 6f74 2069 7369 6e73 7461 6e63 6528 636f  ot isinstance(co
-00025770: 6f72 6473 2c20 4d61 726b 6572 4672 616d  ords, MarkerFram
-00025780: 6529 3a0d 0a20 2020 2020 2020 2063 6f6f  e):..        coo
-00025790: 7264 7320 3d20 6e70 2e61 7361 7272 6179  rds = np.asarray
-000257a0: 2863 6f6f 7264 7329 0d0a 2020 2020 2020  (coords)..      
-000257b0: 2020 6966 2063 6f6f 7264 732e 6e64 696d    if coords.ndim
-000257c0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
-000257d0: 2020 2020 636f 6f72 6473 203d 2063 6f6f      coords = coo
-000257e0: 7264 732e 7265 7368 6170 6528 312c 202d  rds.reshape(1, -
-000257f0: 3129 0d0a 2020 2020 2020 2020 656c 6966  1)..        elif
-00025800: 2063 6f6f 7264 732e 6e64 696d 2021 3d20   coords.ndim != 
-00025810: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
-00025820: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00025830: 2822 496e 7075 7420 6361 6e6e 6f74 2062  ("Input cannot b
-00025840: 6520 696e 7465 7270 7265 7465 6420 6173  e interpreted as
-00025850: 2063 6f6f 7264 696e 6174 6528 7329 2e22   coordinate(s)."
-00025860: 290d 0a20 2020 2020 2020 2069 6620 6469  )..        if di
-00025870: 6d73 2069 7320 4e6f 6e65 3a0d 0a20 2020  ms is None:..   
-00025880: 2020 2020 2020 2020 206e 6469 6d20 3d20           ndim = 
-00025890: 636f 6f72 6473 2e73 6861 7065 5b31 5d0d  coords.shape[1].
-000258a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000258b0: 6e64 696d 203d 3d20 696d 672e 6e64 696d  ndim == img.ndim
-000258c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000258d0: 2020 2064 696d 7320 3d20 696d 672e 6178     dims = img.ax
-000258e0: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
-000258f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00025900: 2020 2020 2020 2064 696d 7320 3d20 636f         dims = co
-00025910: 6d70 6c65 6d65 6e74 5f61 7865 7328 2263  mplement_axes("c
-00025920: 222c 2069 6d67 2e61 7865 7329 5b2d 6e64  ", img.axes)[-nd
-00025930: 696d 3a5d 0d0a 2020 2020 2020 2020 636f  im:]..        co
-00025940: 6f72 6473 203d 204d 6172 6b65 7246 7261  ords = MarkerFra
-00025950: 6d65 2863 6f6f 7264 732c 2063 6f6c 756d  me(coords, colum
-00025960: 6e73 3d64 696d 732c 2064 7479 7065 3d6e  ns=dims, dtype=n
-00025970: 702e 7569 6e74 3136 290d 0a20 2020 2020  p.uint16)..     
-00025980: 2020 2063 6f6f 7264 732e 7365 745f 7363     coords.set_sc
-00025990: 616c 6528 696d 6729 0d0a 2020 2020 0d0a  ale(img)..    ..
-000259a0: 2020 2020 7265 7475 726e 2063 6f6f 7264      return coord
-000259b0: 730d 0a0d 0a64 6566 205f 6368 6563 6b5f  s....def _check_
-000259c0: 6675 6e63 7469 6f6e 2866 756e 6329 3a0d  function(func):.
-000259d0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-000259e0: 6365 2866 756e 632c 2073 7472 293a 0d0a  ce(func, str):..
-000259f0: 2020 2020 2020 2020 6675 6e63 203d 2067          func = g
-00025a00: 6574 6174 7472 286e 702c 2066 756e 632c  etattr(np, func,
-00025a10: 204e 6f6e 6529 0d0a 2020 2020 6966 2063   None)..    if c
-00025a20: 616c 6c61 626c 6528 6675 6e63 293a 0d0a  allable(func):..
-00025a30: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00025a40: 756e 630d 0a20 2020 2065 6c73 653a 0d0a  unc..    else:..
-00025a50: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00025a60: 7065 4572 726f 7228 224d 7573 7420 6265  peError("Must be
-00025a70: 206f 6e65 206f 6620 6e75 6d70 7920 6d65   one of numpy me
-00025a80: 7468 6f64 7320 6f72 2063 616c 6c61 626c  thods or callabl
-00025a90: 6520 6f62 6a65 6374 2e22 290d 0a20 2020  e object.")..   
-00025aa0: 200d 0a64 6566 205f 6368 6563 6b5f 6267   ..def _check_bg
-00025ab0: 2869 6d67 3a20 496d 6741 7272 6179 2c20  (img: ImgArray, 
-00025ac0: 6267 293a 0d0a 2020 2020 2320 6465 7465  bg):..    # dete
-00025ad0: 726d 696e 6520 6267 0d0a 2020 2020 6966  rmine bg..    if
-00025ae0: 2062 6720 6973 204e 6f6e 653a 0d0a 2020   bg is None:..  
-00025af0: 2020 2020 2020 6267 203d 2069 6d67 2e6d        bg = img.m
-00025b00: 696e 2829 0d0a 2020 2020 656c 6966 2069  in()..    elif i
-00025b10: 7369 6e73 7461 6e63 6528 6267 2c20 7374  sinstance(bg, st
-00025b20: 7229 2061 6e64 2062 672e 656e 6473 7769  r) and bg.endswi
-00025b30: 7468 2822 2522 293a 0d0a 2020 2020 2020  th("%"):..      
-00025b40: 2020 6267 203d 206e 702e 7065 7263 656e    bg = np.percen
-00025b50: 7469 6c65 2869 6d67 2e76 616c 7565 2c20  tile(img.value, 
-00025b60: 666c 6f61 7428 6267 5b3a 2d31 5d29 290d  float(bg[:-1])).
-00025b70: 0a20 2020 2065 6c69 6620 6e6f 7420 6e70  .    elif not np
-00025b80: 2e69 7373 6361 6c61 7228 6267 293a 0d0a  .isscalar(bg):..
-00025b90: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00025ba0: 7065 4572 726f 7228 2257 726f 6e67 2074  peError("Wrong t
-00025bb0: 7970 6520 6f66 2060 6267 602e 2229 0d0a  ype of `bg`.")..
-00025bc0: 2020 2020 7265 7475 726e 2062 670d 0a0d      return bg...
-00025bd0: 0a64 6566 205f 6368 6563 6b5f 7465 6d70  .def _check_temp
-00025be0: 6c61 7465 2874 656d 706c 6174 6529 3a0d  late(template):.
-00025bf0: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
-00025c00: 7374 616e 6365 2874 656d 706c 6174 652c  stance(template,
-00025c10: 206e 702e 6e64 6172 7261 7929 3a0d 0a20   np.ndarray):.. 
-00025c20: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00025c30: 6545 7272 6f72 2866 2260 7465 6d70 6c61  eError(f"`templa
-00025c40: 7465 6020 6d75 7374 2062 6520 6e70 2e6e  te` must be np.n
-00025c50: 6461 7272 6179 2c20 6275 7420 676f 7420  darray, but got 
-00025c60: 7b74 7970 6528 7465 6d70 6c61 7465 297d  {type(template)}
-00025c70: 2229 0d0a 2020 2020 656c 6966 2074 656d  ")..    elif tem
-00025c80: 706c 6174 652e 6e64 696d 206e 6f74 2069  plate.ndim not i
-00025c90: 6e20 2832 2c20 3329 3a0d 0a20 2020 2020  n (2, 3):..     
-00025ca0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00025cb0: 726f 7228 2260 7465 6d70 6c61 7465 206d  ror("`template m
-00025cc0: 7573 7420 6265 2032 206f 7220 3320 6469  ust be 2 or 3 di
-00025cd0: 6d65 6e73 696f 6e61 6c2e 6022 290d 0a20  mensional.`").. 
-00025ce0: 2020 2074 656d 706c 6174 6520 3d20 6e70     template = np
-00025cf0: 2e61 7361 7272 6179 2874 656d 706c 6174  .asarray(templat
-00025d00: 6529 2e61 7374 7970 6528 6e70 2e66 6c6f  e).astype(np.flo
-00025d10: 6174 3332 2c20 636f 7079 3d54 7275 6529  at32, copy=True)
-00025d20: 0d0a 2020 2020 7265 7475 726e 2074 656d  ..    return tem
-00025d30: 706c 6174 650d 0a0d 0a64 6566 205f 6361  plate....def _ca
-00025d40: 6c63 5f63 656e 7472 6f69 6428 696d 673a  lc_centroid(img:
-00025d50: 206e 702e 6e64 6172 7261 792c 206e 6469   np.ndarray, ndi
-00025d60: 6d3a 2069 6e74 2920 2d3e 206e 702e 6e64  m: int) -> np.nd
-00025d70: 6172 7261 793a 0d0a 2020 2020 6d6f 6d20  array:..    mom 
-00025d80: 3d20 736b 6d65 732e 6d6f 6d65 6e74 7328  = skmes.moments(
-00025d90: 696d 672c 206f 7264 6572 3d31 290d 0a20  img, order=1).. 
-00025da0: 2020 2063 656e 7472 6f69 6420 3d20 6e70     centroid = np
-00025db0: 2e61 7272 6179 285b 6d6f 6d5b 2830 2c29  .array([mom[(0,)
-00025dc0: 2a69 202b 2028 312c 2920 2b20 2830 2c29  *i + (1,) + (0,)
-00025dd0: 2a28 6e64 696d 2d69 2d31 295d 200d 0a20  *(ndim-i-1)] .. 
-00025de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025df0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00025e00: 7261 6e67 6528 6e64 696d 295d 2920 2f20  range(ndim)]) / 
-00025e10: 6d6f 6d5b 2830 2c29 2a6e 6469 6d5d 0d0a  mom[(0,)*ndim]..
-00025e20: 2020 2020 7265 7475 726e 2063 656e 7472      return centr
-00025e30: 6f69 640d 0a0d 0a64 6566 205f 6368 6563  oid....def _chec
-00025e40: 6b5f 636c 6970 5f72 616e 6765 2869 6e5f  k_clip_range(in_
-00025e50: 7261 6e67 652c 2069 6d67 2920 2d3e 2074  range, img) -> t
-00025e60: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
-00025e70: 745d 3a0d 0a20 2020 2022 2222 0d0a 2020  t]:..    """..  
-00025e80: 2020 4361 6c6c 6564 2069 6e20 636c 6970    Called in clip
-00025e90: 5f6f 7574 6c69 6572 7328 2920 616e 6420  _outliers() and 
-00025ea0: 7265 7363 616c 655f 696e 7465 6e73 6974  rescale_intensit
-00025eb0: 7928 292e 0d0a 2020 2020 2222 2220 2020  y()...    """   
-00025ec0: 200d 0a20 2020 206c 6f77 6572 2c20 7570   ..    lower, up
-00025ed0: 7065 7220 3d20 696e 5f72 616e 6765 0d0a  per = in_range..
-00025ee0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00025ef0: 6528 6c6f 7765 722c 2073 7472 2920 616e  e(lower, str) an
-00025f00: 6420 6c6f 7765 722e 656e 6473 7769 7468  d lower.endswith
-00025f10: 2822 2522 293a 0d0a 2020 2020 2020 2020  ("%"):..        
-00025f20: 6c6f 7765 7220 3d20 666c 6f61 7428 6c6f  lower = float(lo
-00025f30: 7765 725b 3a2d 315d 290d 0a20 2020 2020  wer[:-1])..     
-00025f40: 2020 206c 6f77 6572 6c69 6d20 3d20 6e70     lowerlim = np
-00025f50: 2e70 6572 6365 6e74 696c 6528 696d 672c  .percentile(img,
-00025f60: 206c 6f77 6572 290d 0a20 2020 2065 6c69   lower)..    eli
-00025f70: 6620 6c6f 7765 7220 6973 204e 6f6e 653a  f lower is None:
-00025f80: 0d0a 2020 2020 2020 2020 6c6f 7765 726c  ..        lowerl
-00025f90: 696d 203d 206e 702e 6d69 6e28 696d 6729  im = np.min(img)
-00025fa0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-00025fb0: 2020 2020 206c 6f77 6572 6c69 6d20 3d20       lowerlim = 
-00025fc0: 666c 6f61 7428 6c6f 7765 7229 0d0a 2020  float(lower)..  
-00025fd0: 2020 0d0a 2020 2020 6966 2069 7369 6e73    ..    if isins
-00025fe0: 7461 6e63 6528 7570 7065 722c 2073 7472  tance(upper, str
-00025ff0: 2920 616e 6420 7570 7065 722e 656e 6473  ) and upper.ends
-00026000: 7769 7468 2822 2522 293a 0d0a 2020 2020  with("%"):..    
-00026010: 2020 2020 7570 7065 7220 3d20 666c 6f61      upper = floa
-00026020: 7428 7570 7065 725b 3a2d 315d 290d 0a20  t(upper[:-1]).. 
-00026030: 2020 2020 2020 2075 7070 6572 6c69 6d20         upperlim 
-00026040: 3d20 6e70 2e70 6572 6365 6e74 696c 6528  = np.percentile(
-00026050: 696d 672c 2075 7070 6572 290d 0a20 2020  img, upper)..   
-00026060: 2065 6c69 6620 7570 7065 7220 6973 204e   elif upper is N
-00026070: 6f6e 653a 0d0a 2020 2020 2020 2020 7570  one:..        up
-00026080: 7065 726c 696d 203d 206e 702e 6d61 7828  perlim = np.max(
-00026090: 696d 6729 0d0a 2020 2020 656c 7365 3a0d  img)..    else:.
-000260a0: 0a20 2020 2020 2020 2075 7070 6572 6c69  .        upperli
-000260b0: 6d20 3d20 666c 6f61 7428 7570 7065 7229  m = float(upper)
-000260c0: 0d0a 2020 2020 0d0a 2020 2020 6966 206c  ..    ..    if l
-000260d0: 6f77 6572 6c69 6d20 3e3d 2075 7070 6572  owerlim >= upper
-000260e0: 6c69 6d3a 0d0a 2020 2020 2020 2020 7261  lim:..        ra
-000260f0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00026100: 226c 6f77 6572 6c69 6d20 6973 206c 6172  "lowerlim is lar
-00026110: 6765 7220 7468 616e 2075 7070 6572 6c69  ger than upperli
-00026120: 6d3a 207b 6c6f 7765 726c 696d 7d20 3e3d  m: {lowerlim} >=
-00026130: 207b 7570 7065 726c 696d 7d22 290d 0a20   {upperlim}").. 
-00026140: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
-00026150: 6c6f 7765 726c 696d 2c20 7570 7065 726c  lowerlim, upperl
-00026160: 696d 0d0a 0d0a 6465 6620 5f73 7065 6369  im....def _speci
-00026170: 6679 5f6f 6e65 2863 656e 7465 722c 2072  fy_one(center, r
-00026180: 6164 6975 732c 2073 6861 7065 3a74 7570  adius, shape:tup
-00026190: 6c65 2920 2d3e 2074 7570 6c65 5b73 6c69  le) -> tuple[sli
-000261a0: 6365 5d3a 0d0a 2020 2020 736c 203d 2074  ce]:..    sl = t
-000261b0: 7570 6c65 2873 6c69 6365 286d 6178 2830  uple(slice(max(0
-000261c0: 2c20 7863 2d72 292c 206d 696e 2878 632b  , xc-r), min(xc+
-000261d0: 722b 312c 2073 6829 2c20 4e6f 6e65 2920  r+1, sh), None) 
-000261e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000261f0: 2020 2020 2020 2020 2020 666f 7220 7863            for xc
-00026200: 2c20 722c 2073 6820 696e 207a 6970 2863  , r, sh in zip(c
-00026210: 656e 7465 722c 2072 6164 6975 732c 2073  enter, radius, s
-00026220: 6861 7065 2929 0d0a 2020 2020 7265 7475  hape))..    retu
-00026230: 726e 2073 6c0d 0a0d 0a64 6566 2063 6865  rn sl....def che
-00026240: 636b 5f66 696c 7465 725f 6675 6e63 2866  ck_filter_func(f
-00026250: 293a 0d0a 2020 2020 6966 2066 2069 7320  ):..    if f is 
-00026260: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2066  None:..        f
-00026270: 203d 206c 616d 6264 6120 783a 2054 7275   = lambda x: Tru
-00026280: 650d 0a20 2020 2065 6c69 6620 6e6f 7420  e..    elif not 
-00026290: 6361 6c6c 6162 6c65 2866 293a 0d0a 2020  callable(f):..  
-000262a0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-000262b0: 4572 726f 7228 2260 6669 6c74 6020 6d75  Error("`filt` mu
-000262c0: 7374 2062 6520 6361 6c6c 6162 6c65 2e22  st be callable."
-000262d0: 290d 0a20 2020 2072 6574 7572 6e20 660d  )..    return f.
-000262e0: 0a0d 0a0d 0a64 6566 2077 6176 655f 6e75  .....def wave_nu
-000262f0: 6d28 736c 3a20 736c 6963 652c 2073 3a20  m(sl: slice, s: 
-00026300: 696e 742c 2075 663a 2069 6e74 2920 2d3e  int, uf: int) ->
-00026310: 2078 702e 6e64 6172 7261 793a 0d0a 2020   xp.ndarray:..  
-00026320: 2020 2222 220d 0a20 2020 2041 2066 756e    """..    A fun
-00026330: 6374 696f 6e20 7468 6174 206d 616b 6573  ction that makes
-00026340: 2077 6176 6520 6e75 6d62 6572 2076 6572   wave number ver
-00026350: 7469 6361 6c20 7665 6374 6f72 2e20 5265  tical vector. Re
-00026360: 7475 726e 6564 2076 6563 746f 7220 7769  turned vector wi
-00026370: 6c6c 0d0a 2020 2020 6265 205b 6b2f 732c  ll..    be [k/s,
-00026380: 2028 6b20 2b20 312f 7566 292f 732c 2028   (k + 1/uf)/s, (
-00026390: 6b20 2b20 322f 7566 292f 732c 202e 2e2e  k + 2/uf)/s, ...
-000263a0: 5d20 2877 6865 7265 206b 203d 2073 6c2e  ] (where k = sl.
-000263b0: 7374 6172 7429 0d0a 0d0a 2020 2020 5061  start)....    Pa
-000263c0: 7261 6d65 7465 7273 0d0a 2020 2020 2d2d  rameters..    --
-000263d0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 736c  --------..    sl
-000263e0: 203a 2073 6c69 6365 0d0a 2020 2020 2020   : slice..      
-000263f0: 2020 536c 6963 6520 7468 6174 2073 7065    Slice that spe
-00026400: 6369 6679 2077 6869 6368 2070 6172 7420  cify which part 
-00026410: 6f66 2074 6865 2069 6d61 6765 2077 696c  of the image wil
-00026420: 6c20 6265 2074 7261 6e73 666f 726d 6564  l be transformed
-00026430: 2e0d 0a20 2020 2073 203a 2069 6e74 0d0a  ...    s : int..
-00026440: 2020 2020 2020 2020 5369 7a65 2061 6c6f          Size alo
-00026450: 6e67 2063 6572 7461 696e 2064 696d 656e  ng certain dimen
-00026460: 7369 6f6e 2e0d 0a20 2020 2075 6620 3a20  sion...    uf : 
-00026470: 696e 740d 0a20 2020 2020 2020 2055 702d  int..        Up-
-00026480: 7361 6d70 6c69 6e67 2066 6163 746f 7220  sampling factor 
-00026490: 6f66 2063 6572 7461 696e 2064 696d 656e  of certain dimen
-000264a0: 7369 6f6e 2e0d 0a20 2020 2022 2222 0d0a  sion...    """..
-000264b0: 2020 2020 7374 6172 7420 3d20 3020 6966      start = 0 if
-000264c0: 2073 6c2e 7374 6172 7420 6973 204e 6f6e   sl.start is Non
-000264d0: 6520 656c 7365 2073 6c2e 7374 6172 740d  e else sl.start.
-000264e0: 0a20 2020 2073 746f 7020 3d20 7320 6966  .    stop = s if
-000264f0: 2073 6c2e 7374 6f70 2069 7320 4e6f 6e65   sl.stop is None
-00026500: 2065 6c73 6520 736c 2e73 746f 700d 0a20   else sl.stop.. 
-00026510: 2020 200d 0a20 2020 2069 6620 736c 2e73     ..    if sl.s
-00026520: 7461 7274 2061 6e64 2073 6c2e 7374 6f70  tart and sl.stop
-00026530: 2061 6e64 2073 7461 7274 203c 2030 2061   and start < 0 a
-00026540: 6e64 2073 746f 7020 3e20 303a 0d0a 2020  nd stop > 0:..  
-00026550: 2020 2020 2020 2320 6c69 6b65 2022 783d        # like "x=
-00026560: 2d35 3a35 220d 0a20 2020 2020 2020 2070  -5:5"..        p
-00026570: 6173 730d 0a20 2020 2065 6c73 653a 0d0a  ass..    else:..
-00026580: 2020 2020 2020 2020 6966 202d 7320 3c20          if -s < 
-00026590: 7374 6172 7420 3c20 303a 0d0a 2020 2020  start < 0:..    
-000265a0: 2020 2020 2020 2020 7374 6172 7420 2b3d          start +=
-000265b0: 2073 0d0a 2020 2020 2020 2020 656c 6966   s..        elif
-000265c0: 206e 6f74 2030 203c 3d20 7374 6172 7420   not 0 <= start 
-000265d0: 3c20 733a 0d0a 2020 2020 2020 2020 2020  < s:..          
-000265e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000265f0: 6f72 2866 2249 6e76 616c 6964 2076 616c  or(f"Invalid val
-00026600: 7565 2065 6e63 6f75 6e74 6572 6564 2069  ue encountered i
-00026610: 6e20 736c 6963 6520 7b73 6c7d 2e22 290d  n slice {sl}.").
-00026620: 0a20 2020 2020 2020 2069 6620 2d73 203c  .        if -s <
-00026630: 2073 746f 7020 3c3d 2030 3a0d 0a20 2020   stop <= 0:..   
-00026640: 2020 2020 2020 2020 2073 746f 7020 2b3d           stop +=
-00026650: 2073 0d0a 2020 2020 2020 2020 656c 6966   s..        elif
-00026660: 206e 6f74 2030 203c 2073 746f 7020 3c3d   not 0 < stop <=
-00026670: 2073 3a0d 0a20 2020 2020 2020 2020 2020   s:..           
-00026680: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00026690: 7228 6622 496e 7661 6c69 6420 7661 6c75  r(f"Invalid valu
-000266a0: 6520 656e 636f 756e 7465 7265 6420 696e  e encountered in
-000266b0: 2073 6c69 6365 207b 736c 7d2e 2229 0d0a   slice {sl}.")..
-000266c0: 2020 2020 2020 2020 0d0a 2020 2020 6e20          ..    n 
-000266d0: 3d20 7374 6f70 202d 2073 7461 7274 0d0a  = stop - start..
-000266e0: 2020 2020 7265 7475 726e 2078 702e 6c69      return xp.li
-000266f0: 6e73 7061 6365 2873 7461 7274 2c20 7374  nspace(start, st
-00026700: 6f70 2c20 6e2a 7566 2c20 656e 6470 6f69  op, n*uf, endpoi
-00026710: 6e74 3d46 616c 7365 295b 3a2c 206e 702e  nt=False)[:, np.
-00026720: 6e65 7761 7869 735d 0d0a                 newaxis]..
+0001c4a0: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0001c4b0: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+0001c4c0: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+0001c4d0: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+0001c4e0: 2020 2020 7569 6e74 3820 6172 7261 7920      uint8 array 
+0001c4f0: 6f66 2074 6865 206e 756d 6265 7220 6f66  of the number of
+0001c500: 206e 6569 6768 626f 7273 2e0d 0a20 2020   neighbors...   
+0001c510: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+0001c520: 2020 2045 7861 6d70 6c65 730d 0a20 2020     Examples..   
+0001c530: 2020 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20       --------.. 
+0001c540: 2020 2020 2020 2020 2020 203e 3e3e 2073             >>> s
+0001c550: 6b6c 203d 2069 6d67 2e74 6872 6573 686f  kl = img.thresho
+0001c560: 6c64 2829 2e73 6b65 6c65 746f 6e69 7a65  ld().skeletonize
+0001c570: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0001c580: 3e3e 3e20 6564 6765 203d 2073 6b6c 2e63  >>> edge = skl.c
+0001c590: 6f75 6e74 5f6e 6569 6768 626f 7273 2829  ount_neighbors()
+0001c5a0: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
+0001c5b0: 3e20 6e70 2e61 7267 7768 6572 6528 6564  > np.argwhere(ed
+0001c5c0: 6765 203d 3d20 3129 2023 2067 6574 2063  ge == 1) # get c
+0001c5d0: 6f6f 7264 696e 6174 6573 206f 6620 6669  oordinates of fi
+0001c5e0: 6c61 6d65 6e74 2065 6467 6573 2e0d 0a20  lament edges... 
+0001c5f0: 2020 2020 2020 2020 2020 203e 3e3e 206e             >>> n
+0001c600: 702e 6172 6777 6865 7265 2865 6467 6520  p.argwhere(edge 
+0001c610: 3e3d 2033 2920 2320 6765 7420 636f 6f72  >= 3) # get coor
+0001c620: 6469 6e61 7465 7320 6f66 2066 696c 616d  dinates of filam
+0001c630: 656e 7420 6372 6f73 7320 7365 6374 696f  ent cross sectio
+0001c640: 6e73 2e0d 0a20 2020 2020 2020 200d 0a20  ns...        .. 
+0001c650: 2020 2020 2020 2022 2222 2020 2020 2020         """      
+0001c660: 2020 0d0a 2020 2020 2020 2020 6e64 696d    ..        ndim
+0001c670: 203d 206c 656e 2864 696d 7329 0d0a 2020   = len(dims)..  
+0001c680: 2020 2020 2020 636f 6e6e 6563 7469 7669        connectivi
+0001c690: 7479 203d 206e 6469 6d20 6966 2063 6f6e  ty = ndim if con
+0001c6a0: 6e65 6374 6976 6974 7920 6973 204e 6f6e  nectivity is Non
+0001c6b0: 6520 656c 7365 2063 6f6e 6e65 6374 6976  e else connectiv
+0001c6c0: 6974 790d 0a20 2020 2020 2020 2073 656c  ity..        sel
+0001c6d0: 656d 203d 206e 6469 2e6d 6f72 7068 6f6c  em = ndi.morphol
+0001c6e0: 6f67 792e 6765 6e65 7261 7465 5f62 696e  ogy.generate_bin
+0001c6f0: 6172 795f 7374 7275 6374 7572 6528 6e64  ary_structure(nd
+0001c700: 696d 2c20 636f 6e6e 6563 7469 7669 7479  im, connectivity
+0001c710: 290d 0a20 2020 2020 2020 2073 656c 656d  )..        selem
+0001c720: 5b28 312c 292a 6e64 696d 5d20 3d20 300d  [(1,)*ndim] = 0.
+0001c730: 0a20 2020 2020 2020 206f 7574 203d 2073  .        out = s
+0001c740: 656c 662e 6173 5f75 696e 7438 2829 2e5f  elf.as_uint8()._
+0001c750: 6170 706c 795f 6461 736b 280d 0a20 2020  apply_dask(..   
+0001c760: 2020 2020 2020 2020 205f 6669 6c74 6572           _filter
+0001c770: 732e 706f 7075 6c61 7469 6f6e 2c20 0d0a  s.population, ..
+0001c780: 2020 2020 2020 2020 2020 2020 635f 6178              c_ax
+0001c790: 6573 3d63 6f6d 706c 656d 656e 745f 6178  es=complement_ax
+0001c7a0: 6573 2864 696d 732c 2073 656c 662e 6178  es(dims, self.ax
+0001c7b0: 6573 292c 200d 0a20 2020 2020 2020 2020  es), ..         
+0001c7c0: 2020 2061 7267 733d 2873 656c 656d 2c29     args=(selem,)
+0001c7d0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+0001c7e0: 2020 2020 2069 6620 6d61 736b 3a0d 0a20       if mask:.. 
+0001c7f0: 2020 2020 2020 2020 2020 206f 7574 5b7e             out[~
+0001c800: 7365 6c66 2e76 616c 7565 5d20 3d20 300d  self.value] = 0.
+0001c810: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+0001c820: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
+0001c830: 742e 6173 7479 7065 286e 702e 7569 6e74  t.astype(np.uint
+0001c840: 3829 0d0a 2020 2020 0d0a 2020 2020 405f  8)..    ..    @_
+0001c850: 646f 6373 2e77 7269 7465 5f64 6f63 730d  docs.write_docs.
+0001c860: 0a20 2020 2040 6469 6d73 5f74 6f5f 7370  .    @dims_to_sp
+0001c870: 6174 6961 6c5f 6178 6573 0d0a 2020 2020  atial_axes..    
+0001c880: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
+0001c890: 5f6f 7574 7075 7428 6f6e 6c79 5f62 696e  _output(only_bin
+0001c8a0: 6172 793d 5472 7565 290d 0a20 2020 2064  ary=True)..    d
+0001c8b0: 6566 2072 656d 6f76 655f 736b 656c 6574  ef remove_skelet
+0001c8c0: 6f6e 5f73 7472 7563 7475 7265 280d 0a20  on_structure(.. 
+0001c8d0: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
+0001c8e0: 2020 2020 2020 7374 7275 6374 7572 653a        structure:
+0001c8f0: 204c 6974 6572 616c 5b22 7469 7022 2c20   Literal["tip", 
+0001c900: 2262 7261 6e63 6822 2c20 2263 726f 7373  "branch", "cross
+0001c910: 225d 203d 2022 7469 7022 2c0d 0a20 2020  "] = "tip",..   
+0001c920: 2020 2020 202a 2c0d 0a20 2020 2020 2020       *,..       
+0001c930: 2063 6f6e 6e65 6374 6976 6974 793a 2069   connectivity: i
+0001c940: 6e74 203d 204e 6f6e 652c 0d0a 2020 2020  nt = None,..    
+0001c950: 2020 2020 6469 6d73 3a20 4469 6d73 203d      dims: Dims =
+0001c960: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
+0001c970: 7570 6461 7465 3a20 626f 6f6c 203d 2046  update: bool = F
+0001c980: 616c 7365 2c0d 0a20 2020 2029 202d 3e20  alse,..    ) -> 
+0001c990: 496d 6741 7272 6179 3a0d 0a20 2020 2020  ImgArray:..     
+0001c9a0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0001c9b0: 5265 6d6f 7665 2063 6572 7461 696e 2073  Remove certain s
+0001c9c0: 7472 7563 7475 7265 2066 726f 6d20 736b  tructure from sk
+0001c9d0: 656c 6574 6f6e 697a 6564 2069 6d61 6765  eletonized image
+0001c9e0: 732e 0d0a 0d0a 2020 2020 2020 2020 5061  s.....        Pa
+0001c9f0: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+0001ca00: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+0001ca10: 2020 2020 2020 7374 7275 6374 7572 6520        structure 
+0001ca20: 3a20 7374 722c 2064 6566 6175 6c74 2069  : str, default i
+0001ca30: 7320 2274 6970 220d 0a20 2020 2020 2020  s "tip"..       
+0001ca40: 2020 2020 2057 6861 7420 7479 7065 206f       What type o
+0001ca50: 6620 7374 7275 6374 7572 6520 746f 2072  f structure to r
+0001ca60: 656d 6f76 652e 0d0a 2020 2020 2020 2020  emove...        
+0001ca70: 7b63 6f6e 6e65 6374 6976 6974 797d 0d0a  {connectivity}..
+0001ca80: 2020 2020 2020 2020 7b64 696d 737d 7b75          {dims}{u
+0001ca90: 7064 6174 657d 0d0a 0d0a 2020 2020 2020  pdate}....      
+0001caa0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+0001cab0: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+0001cac0: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
+0001cad0: 2020 2020 2020 2020 2020 5072 6f63 6573            Proces
+0001cae0: 7365 6420 696d 6167 652e 0d0a 2020 2020  sed image...    
+0001caf0: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+0001cb00: 0a20 2020 2020 2020 206f 7574 203d 2073  .        out = s
+0001cb10: 656c 662e 636f 7079 2829 0d0a 2020 2020  elf.copy()..    
+0001cb20: 2020 2020 6e65 6967 6862 6f72 203d 2073      neighbor = s
+0001cb30: 656c 662e 636f 756e 745f 6e65 6967 6862  elf.count_neighb
+0001cb40: 6f72 7328 636f 6e6e 6563 7469 7669 7479  ors(connectivity
+0001cb50: 3d63 6f6e 6e65 6374 6976 6974 792c 2064  =connectivity, d
+0001cb60: 696d 733d 6469 6d73 290d 0a20 2020 2020  ims=dims)..     
+0001cb70: 2020 2069 6620 7374 7275 6374 7572 6520     if structure 
+0001cb80: 3d3d 2022 7469 7022 3a0d 0a20 2020 2020  == "tip":..     
+0001cb90: 2020 2020 2020 2073 6c20 3d20 6e65 6967         sl = neig
+0001cba0: 6862 6f72 203d 3d20 310d 0a20 2020 2020  hbor == 1..     
+0001cbb0: 2020 2065 6c69 6620 7374 7275 6374 7572     elif structur
+0001cbc0: 6520 3d3d 2022 6272 616e 6368 223a 0d0a  e == "branch":..
+0001cbd0: 2020 2020 2020 2020 2020 2020 736c 203d              sl =
+0001cbe0: 206e 6569 6768 626f 7220 3e20 320d 0a20   neighbor > 2.. 
+0001cbf0: 2020 2020 2020 2065 6c69 6620 7374 7275         elif stru
+0001cc00: 6374 7572 6520 3d3d 2022 6372 6f73 7322  cture == "cross"
+0001cc10: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0001cc20: 6c20 3d20 6e65 6967 6862 6f72 203e 2033  l = neighbor > 3
+0001cc30: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0001cc40: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001cc50: 7365 2056 616c 7565 4572 726f 7228 2260  se ValueError("`
+0001cc60: 6d6f 6465 6020 6d75 7374 2062 6520 6f6e  mode` must be on
+0001cc70: 6520 6f66 207b 2774 6970 272c 2027 6272  e of {'tip', 'br
+0001cc80: 616e 6368 272c 2027 6372 6f73 7327 7d2e  anch', 'cross'}.
+0001cc90: 2229 0d0a 2020 2020 2020 2020 6f75 742e  ")..        out.
+0001cca0: 7661 6c75 655b 736c 5d20 3d20 300d 0a20  value[sl] = 0.. 
+0001ccb0: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
+0001ccc0: 740d 0a20 2020 200d 0a20 2020 2040 6469  t..    ..    @di
+0001ccd0: 6d73 5f74 6f5f 7370 6174 6961 6c5f 6178  ms_to_spatial_ax
+0001cce0: 6573 0d0a 2020 2020 4063 6865 636b 5f69  es..    @check_i
+0001ccf0: 6e70 7574 5f61 6e64 5f6f 7574 7075 7428  nput_and_output(
+0001cd00: 6e65 6564 5f6c 6162 656c 733d 5472 7565  need_labels=True
+0001cd10: 290d 0a20 2020 2064 6566 2077 6174 6572  )..    def water
+0001cd20: 7368 6564 280d 0a20 2020 2020 2020 2073  shed(..        s
+0001cd30: 656c 662c 0d0a 2020 2020 2020 2020 636f  elf,..        co
+0001cd40: 6f72 6473 3a20 4d61 726b 6572 4672 616d  ords: MarkerFram
+0001cd50: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+0001cd60: 0d0a 2020 2020 2020 2020 2a2c 0d0a 2020  ..        *,..  
+0001cd70: 2020 2020 2020 636f 6e6e 6563 7469 7669        connectivi
+0001cd80: 7479 3a20 696e 7420 3d20 312c 0d0a 2020  ty: int = 1,..  
+0001cd90: 2020 2020 2020 696e 7075 743a 204c 6974        input: Lit
+0001cda0: 6572 616c 5b22 7365 6c66 222c 2022 6469  eral["self", "di
+0001cdb0: 7374 616e 6365 225d 203d 2022 6469 7374  stance"] = "dist
+0001cdc0: 616e 6365 222c 200d 0a20 2020 2020 2020  ance", ..       
+0001cdd0: 206d 696e 5f64 6973 7461 6e63 653a 2066   min_distance: f
+0001cde0: 6c6f 6174 203d 2032 2c0d 0a20 2020 2020  loat = 2,..     
+0001cdf0: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
+0001ce00: 4e6f 6e65 2c0d 0a20 2020 2029 202d 3e20  None,..    ) -> 
+0001ce10: 4c61 6265 6c3a 0d0a 2020 2020 2020 2020  Label:..        
+0001ce20: 2222 220d 0a20 2020 2020 2020 204c 6162  """..        Lab
+0001ce30: 656c 2073 6567 6d65 6e74 6174 696f 6e20  el segmentation 
+0001ce40: 7573 696e 6720 7761 7465 7273 6865 6420  using watershed 
+0001ce50: 616c 676f 7269 7468 6d2e 0d0a 0d0a 2020  algorithm.....  
+0001ce60: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0001ce70: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+0001ce80: 2d2d 2d2d 0d0a 2020 2020 2020 2020 636f  ----..        co
+0001ce90: 6f72 6473 203a 204d 6172 6b65 7246 7261  ords : MarkerFra
+0001cea0: 6d65 2c20 6f70 7469 6f6e 616c 0d0a 2020  me, optional..  
+0001ceb0: 2020 2020 2020 2020 2020 5265 7475 726e            Return
+0001cec0: 6564 2062 7920 7375 6368 2061 7320 6070  ed by such as `p
+0001ced0: 6561 6b5f 6c6f 6361 6c5f 6d61 7828 2960  eak_local_max()`
+0001cee0: 2e20 4172 7261 7920 6f66 2063 6f6f 7264  . Array of coord
+0001cef0: 696e 6174 6573 206f 6620 7065 616b 732e  inates of peaks.
+0001cf00: 0d0a 2020 2020 2020 2020 7b63 6f6e 6e65  ..        {conne
+0001cf10: 6374 6976 6974 797d 0d0a 2020 2020 2020  ctivity}..      
+0001cf20: 2020 696e 7075 7420 3a20 7374 722c 206f    input : str, o
+0001cf30: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+0001cf40: 2020 2020 2057 6861 7420 696d 6167 6520       What image 
+0001cf50: 7769 6c6c 2062 6520 7468 6520 696e 7075  will be the inpu
+0001cf60: 7420 6f66 2077 6174 6572 7368 6564 2061  t of watershed a
+0001cf70: 6c67 6f72 6974 686d 2e20 2020 2020 2020  lgorithm.       
+0001cf80: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0001cf90: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0001cfa0: 202d 2022 7365 6c66 2220 2e2e 2e20 7365   - "self" ... se
+0001cfb0: 6c66 2069 7320 7573 6564 2e0d 0a20 2020  lf is used...   
+0001cfc0: 2020 2020 2020 2020 202d 2022 6469 7374           - "dist
+0001cfd0: 616e 6365 2220 2e2e 2e20 6469 7374 616e  ance" ... distan
+0001cfe0: 6365 206d 6170 206f 6620 7365 6c66 2e6c  ce map of self.l
+0001cff0: 6162 656c 7320 6973 2075 7365 642e 0d0a  abels is used...
+0001d000: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0001d010: 2020 2020 2020 7b64 696d 737d 0d0a 2020        {dims}..  
+0001d020: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0001d030: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+0001d040: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+0001d050: 2020 2020 2020 4c61 6265 6c0d 0a20 2020        Label..   
+0001d060: 2020 2020 2020 2020 2055 7064 6174 6564           Updated
+0001d070: 206c 6162 656c 732e 0d0a 2020 2020 2020   labels...      
+0001d080: 2020 2222 220d 0a20 2020 2020 2020 200d    """..        .
+0001d090: 0a20 2020 2020 2020 2023 2050 7265 7061  .        # Prepa
+0001d0a0: 7265 2074 6865 2069 6e70 7574 2069 6d61  re the input ima
+0001d0b0: 6765 2e0d 0a20 2020 2020 2020 2069 6620  ge...        if 
+0001d0c0: 696e 7075 7420 3d3d 2022 7365 6c66 223a  input == "self":
+0001d0d0: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+0001d0e0: 7075 745f 696d 6720 3d20 7365 6c66 2e63  put_img = self.c
+0001d0f0: 6f70 7928 290d 0a20 2020 2020 2020 2065  opy()..        e
+0001d100: 6c69 6620 696e 7075 7420 3d3d 2022 6469  lif input == "di
+0001d110: 7374 616e 6365 223a 0d0a 2020 2020 2020  stance":..      
+0001d120: 2020 2020 2020 696e 7075 745f 696d 6720        input_img 
+0001d130: 3d20 7365 6c66 2e5f 5f63 6c61 7373 5f5f  = self.__class__
+0001d140: 2873 656c 662e 6c61 6265 6c73 3e30 2c20  (self.labels>0, 
+0001d150: 6178 6573 3d73 656c 662e 6178 6573 292e  axes=self.axes).
+0001d160: 6469 7374 616e 6365 5f6d 6170 2864 696d  distance_map(dim
+0001d170: 733d 6469 6d73 290d 0a20 2020 2020 2020  s=dims)..       
+0001d180: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0001d190: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001d1a0: 7272 6f72 2822 2769 6e70 7574 5f27 206d  rror("'input_' m
+0001d1b0: 7573 7420 6265 2065 6974 6865 7220 2773  ust be either 's
+0001d1c0: 656c 6627 206f 7220 2764 6973 7461 6e63  elf' or 'distanc
+0001d1d0: 6527 2e22 290d 0a20 2020 2020 2020 2020  e'.")..         
+0001d1e0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001d1f0: 2069 6620 696e 7075 745f 696d 672e 6474   if input_img.dt
+0001d200: 7970 6520 3d3d 2062 6f6f 6c3a 0d0a 2020  ype == bool:..  
+0001d210: 2020 2020 2020 2020 2020 696e 7075 745f            input_
+0001d220: 696d 6720 3d20 696e 7075 745f 696d 672e  img = input_img.
+0001d230: 6173 7479 7065 286e 702e 7569 6e74 3829  astype(np.uint8)
+0001d240: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0001d250: 2020 2020 2020 2020 696e 7075 745f 696d          input_im
+0001d260: 672e 6c61 6265 6c73 203d 2073 656c 662e  g.labels = self.
+0001d270: 6c61 6265 6c73 0d0a 2020 2020 2020 2020  labels..        
+0001d280: 0d0a 2020 2020 2020 2020 6966 2063 6f6f  ..        if coo
+0001d290: 7264 7320 6973 204e 6f6e 653a 0d0a 2020  rds is None:..  
+0001d2a0: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+0001d2b0: 203d 2069 6e70 7574 5f69 6d67 2e70 6561   = input_img.pea
+0001d2c0: 6b5f 6c6f 6361 6c5f 6d61 7828 6d69 6e5f  k_local_max(min_
+0001d2d0: 6469 7374 616e 6365 3d6d 696e 5f64 6973  distance=min_dis
+0001d2e0: 7461 6e63 652c 2064 696d 733d 6469 6d73  tance, dims=dims
+0001d2f0: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+0001d300: 2020 2020 206c 6162 656c 7320 3d20 6c61       labels = la
+0001d310: 7267 6573 745f 7a65 726f 7328 696e 7075  rgest_zeros(inpu
+0001d320: 745f 696d 672e 7368 6170 6529 0d0a 2020  t_img.shape)..  
+0001d330: 2020 2020 2020 7368 6170 6520 3d20 7365        shape = se
+0001d340: 6c66 2e73 697a 6573 6f66 2864 696d 7329  lf.sizesof(dims)
+0001d350: 0d0a 2020 2020 2020 2020 6e5f 6c61 6265  ..        n_labe
+0001d360: 6c73 203d 2030 0d0a 2020 2020 2020 2020  ls = 0..        
+0001d370: 635f 6178 6573 203d 2063 6f6d 706c 656d  c_axes = complem
+0001d380: 656e 745f 6178 6573 2864 696d 732c 2073  ent_axes(dims, s
+0001d390: 656c 662e 6178 6573 290d 0a20 2020 2020  elf.axes)..     
+0001d3a0: 2020 206d 6172 6b65 7273 203d 206e 702e     markers = np.
+0001d3b0: 7a65 726f 7328 7368 6170 652c 2064 7479  zeros(shape, dty
+0001d3c0: 7065 3d6c 6162 656c 732e 6474 7970 6529  pe=labels.dtype)
+0001d3d0: 2023 2070 6c61 6365 686f 6c64 6572 2066   # placeholder f
+0001d3e0: 6f72 206d 6178 696d 610d 0a20 2020 2020  or maxima..     
+0001d3f0: 2020 2066 6f72 2073 6c2c 2063 7264 2069     for sl, crd i
+0001d400: 6e20 636f 6f72 6473 2e69 7465 7228 635f  n coords.iter(c_
+0001d410: 6178 6573 293a 0d0a 2020 2020 2020 2020  axes):..        
+0001d420: 2020 2020 2320 6372 642e 7661 6c75 6573      # crd.values
+0001d430: 2069 7320 284e 2c20 3229 2061 7272 6179   is (N, 2) array
+0001d440: 2073 6f20 7475 706c 6528 6372 642e 7661   so tuple(crd.va
+0001d450: 6c75 6573 2e54 2e74 6f6c 6973 7428 2929  lues.T.tolist())
+0001d460: 2069 7320 7477 6f20 284e 2c29 206c 6973   is two (N,) lis
+0001d470: 742e 0d0a 2020 2020 2020 2020 2020 2020  t...            
+0001d480: 6372 6420 3d20 6372 642e 7661 6c75 6573  crd = crd.values
+0001d490: 2e54 2e74 6f6c 6973 7428 290d 0a20 2020  .T.tolist()..   
+0001d4a0: 2020 2020 2020 2020 206d 6172 6b65 7273           markers
+0001d4b0: 5b74 7570 6c65 2863 7264 295d 203d 206e  [tuple(crd)] = n
+0001d4c0: 702e 6172 616e 6765 2831 2c20 6c65 6e28  p.arange(1, len(
+0001d4d0: 6372 645b 305d 292b 312c 2064 7479 7065  crd[0])+1, dtype
+0001d4e0: 3d6c 6162 656c 732e 6474 7970 6529 0d0a  =labels.dtype)..
+0001d4f0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+0001d500: 6c73 5b73 6c5d 203d 2073 6b73 6567 2e77  ls[sl] = skseg.w
+0001d510: 6174 6572 7368 6564 282d 696e 7075 745f  atershed(-input_
+0001d520: 696d 672e 7661 6c75 655b 736c 5d2c 206d  img.value[sl], m
+0001d530: 6172 6b65 7273 2c20 0d0a 2020 2020 2020  arkers, ..      
+0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2020 6d61 736b 3d69 6e70 7574 5f69 6d67    mask=input_img
+0001d570: 2e6c 6162 656c 732e 7661 6c75 655b 736c  .labels.value[sl
+0001d580: 5d2c 200d 0a20 2020 2020 2020 2020 2020  ], ..           
+0001d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5a0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001d5b0: 6e65 6374 6976 6974 793d 636f 6e6e 6563  nectivity=connec
+0001d5c0: 7469 7669 7479 290d 0a20 2020 2020 2020  tivity)..       
+0001d5d0: 2020 2020 206c 6162 656c 735b 736c 5d5b       labels[sl][
+0001d5e0: 6c61 6265 6c73 5b73 6c5d 3e30 5d20 2b3d  labels[sl]>0] +=
+0001d5f0: 206e 5f6c 6162 656c 730d 0a20 2020 2020   n_labels..     
+0001d600: 2020 2020 2020 206e 5f6c 6162 656c 7320         n_labels 
+0001d610: 3d20 6c61 6265 6c73 5b73 6c5d 2e6d 6178  = labels[sl].max
+0001d620: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0001d630: 6d61 726b 6572 735b 3a5d 203d 2030 2023  markers[:] = 0 #
+0001d640: 2072 6573 6574 2070 6c61 6365 686f 6c64   reset placehold
+0001d650: 6572 0d0a 2020 2020 2020 2020 0d0a 2020  er..        ..  
+0001d660: 2020 2020 2020 6c61 6265 6c73 203d 206c        labels = l
+0001d670: 6162 656c 732e 7669 6577 284c 6162 656c  abels.view(Label
+0001d680: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001d690: 6c61 6265 6c73 203d 206c 6162 656c 732e  labels = labels.
+0001d6a0: 6f70 7469 6d69 7a65 2829 0d0a 2020 2020  optimize()..    
+0001d6b0: 2020 2020 7365 6c66 2e6c 6162 656c 732e      self.labels.
+0001d6c0: 5f73 6574 5f69 6e66 6f28 7365 6c66 290d  _set_info(self).
+0001d6d0: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
+0001d6e0: 6265 6c73 2e73 6574 5f73 6361 6c65 2873  bels.set_scale(s
+0001d6f0: 656c 6629 0d0a 2020 2020 2020 2020 7265  elf)..        re
+0001d700: 7475 726e 2073 656c 662e 6c61 6265 6c73  turn self.labels
+0001d710: 0d0a 2020 2020 0d0a 2020 2020 405f 646f  ..    ..    @_do
+0001d720: 6373 2e77 7269 7465 5f64 6f63 730d 0a20  cs.write_docs.. 
+0001d730: 2020 2040 6469 6d73 5f74 6f5f 7370 6174     @dims_to_spat
+0001d740: 6961 6c5f 6178 6573 0d0a 2020 2020 4063  ial_axes..    @c
+0001d750: 6865 636b 5f69 6e70 7574 5f61 6e64 5f6f  heck_input_and_o
+0001d760: 7574 7075 7428 6e65 6564 5f6c 6162 656c  utput(need_label
+0001d770: 733d 5472 7565 290d 0a20 2020 2064 6566  s=True)..    def
+0001d780: 2072 616e 646f 6d5f 7761 6c6b 6572 280d   random_walker(.
+0001d790: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+0001d7a0: 2020 2020 2020 2020 6265 7461 3a20 666c          beta: fl
+0001d7b0: 6f61 7420 3d20 3133 302c 0d0a 2020 2020  oat = 130,..    
+0001d7c0: 2020 2020 6d6f 6465 3a20 4c69 7465 7261      mode: Litera
+0001d7d0: 6c5b 2263 6722 2c20 2263 675f 6a22 2c20  l["cg", "cg_j", 
+0001d7e0: 2263 675f 6d67 222c 2022 6266 225d 203d  "cg_mg", "bf"] =
+0001d7f0: 2022 6367 5f6a 222c 200d 0a20 2020 2020   "cg_j", ..     
+0001d800: 2020 2074 6f6c 3a20 666c 6f61 7420 3d20     tol: float = 
+0001d810: 3165 2d33 2c20 0d0a 2020 2020 2020 2020  1e-3, ..        
+0001d820: 2a2c 0d0a 2020 2020 2020 2020 6469 6d73  *,..        dims
+0001d830: 3a20 4469 6d73 203d 204e 6f6e 652c 0d0a  : Dims = None,..
+0001d840: 2020 2020 2920 2d3e 204c 6162 656c 3a0d      ) -> Label:.
+0001d850: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0001d860: 2020 2020 2020 5261 6e64 6f6d 2077 616c        Random wal
+0001d870: 6b65 7220 7365 676d 656e 7461 7469 6f6e  ker segmentation
+0001d880: 2e20 4f6e 6c79 2077 7261 7070 6564 2073  . Only wrapped s
+0001d890: 6b69 6d61 6765 2073 6567 6d65 6e74 6174  kimage segmentat
+0001d8a0: 696f 6e2e 200d 0a20 2020 2020 2020 200d  ion. ..        .
+0001d8b0: 0a20 2020 2020 2020 2060 6073 656c 662e  .        ``self.
+0001d8c0: 6c61 6265 6c73 6060 2077 696c 6c20 6265  labels`` will be
+0001d8d0: 2073 6567 6d65 6e74 6564 2061 6e64 2075   segmented and u
+0001d8e0: 7064 6174 6564 2069 6e70 6c61 6365 2e0d  pdated inplace..
+0001d8f0: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0001d900: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
+0001d910: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
+0001d920: 2020 2062 6574 612c 206d 6f64 652c 2074     beta, mode, t
+0001d930: 6f6c 0d0a 2020 2020 2020 2020 2020 2020  ol..            
+0001d940: 7365 6520 736b 696d 6167 652e 7365 676d  see skimage.segm
+0001d950: 656e 7461 7469 6f6e 2e72 616e 646f 6d5f  entation.random_
+0001d960: 7761 6c6b 6572 0d0a 2020 2020 2020 2020  walker..        
+0001d970: 7b64 696d 737d 0d0a 0d0a 2020 2020 2020  {dims}....      
+0001d980: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+0001d990: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+0001d9a0: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
+0001d9b0: 2020 2020 2020 2020 2020 5265 6c61 6265            Relabe
+0001d9c0: 6c65 6420 696d 6167 652e 0d0a 2020 2020  led image...    
+0001d9d0: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+0001d9e0: 0a20 2020 2020 2020 2063 5f61 7865 7320  .        c_axes 
+0001d9f0: 3d20 636f 6d70 6c65 6d65 6e74 5f61 7865  = complement_axe
+0001da00: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+0001da10: 7329 0d0a 2020 2020 2020 2020 0d0a 2020  s)..        ..  
+0001da20: 2020 2020 2020 666f 7220 736c 2c20 696d        for sl, im
+0001da30: 6720 696e 2073 656c 662e 6974 6572 2863  g in self.iter(c
+0001da40: 5f61 7865 732c 2069 7372 6177 3d54 7275  _axes, israw=Tru
+0001da50: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+0001da60: 2069 6d67 2e6c 6162 656c 735b 3a5d 203d   img.labels[:] =
+0001da70: 2073 6b73 6567 2e72 616e 646f 6d5f 7761   skseg.random_wa
+0001da80: 6c6b 6572 280d 0a20 2020 2020 2020 2020  lker(..         
+0001da90: 2020 2020 2020 2069 6d67 2e76 616c 7565         img.value
+0001daa0: 2c20 696d 672e 6c61 6265 6c73 2e76 616c  , img.labels.val
+0001dab0: 7565 2c20 6265 7461 3d62 6574 612c 206d  ue, beta=beta, m
+0001dac0: 6f64 653d 6d6f 6465 2c20 746f 6c3d 746f  ode=mode, tol=to
+0001dad0: 6c0d 0a20 2020 2020 2020 2020 2020 2029  l..            )
+0001dae0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0001daf0: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+0001db00: 656c 732e 5f73 6574 5f69 6e66 6f28 7365  els._set_info(se
+0001db10: 6c66 290d 0a20 2020 2020 2020 2072 6574  lf)..        ret
+0001db20: 7572 6e20 7365 6c66 2e6c 6162 656c 730d  urn self.labels.
+0001db30: 0a20 2020 200d 0a20 2020 2064 6566 206c  .    ..    def l
+0001db40: 6162 656c 5f74 6872 6573 686f 6c64 280d  abel_threshold(.
+0001db50: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+0001db60: 2020 2020 2020 2020 7468 723a 2066 6c6f          thr: flo
+0001db70: 6174 207c 2054 6872 6561 7368 6f6c 644d  at | ThreasholdM
+0001db80: 6574 686f 6420 3d20 226f 7473 7522 2c0d  ethod = "otsu",.
+0001db90: 0a20 2020 2020 2020 2066 696c 743a 2043  .        filt: C
+0001dba0: 616c 6c61 626c 655b 2e2e 2e2c 2062 6f6f  allable[..., boo
+0001dbb0: 6c5d 207c 204e 6f6e 6520 3d20 4e6f 6e65  l] | None = None
+0001dbc0: 2c0d 0a20 2020 2020 2020 202a 2c0d 0a20  ,..        *,.. 
+0001dbd0: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
+0001dbe0: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
+0001dbf0: 2020 202a 2a6b 7761 7267 732c 0d0a 2020     **kwargs,..  
+0001dc00: 2020 2920 2d3e 204c 6162 656c 3a0d 0a20    ) -> Label:.. 
+0001dc10: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0001dc20: 2020 2020 4d61 6b65 206c 6162 656c 7320      Make labels 
+0001dc30: 7769 7468 2074 6872 6573 686f 6c64 2829  with threshold()
+0001dc40: 2e20 4265 2073 7572 6520 7468 6174 206b  . Be sure that k
+0001dc50: 6579 776f 7264 2061 7267 756d 656e 7420  eyword argument 
+0001dc60: 6060 6469 6d73 6060 2063 616e 2062 650d  ``dims`` can be.
+0001dc70: 0a20 2020 2020 2020 2064 6966 6665 7265  .        differe
+0001dc80: 6e74 2028 696e 206d 6f73 7420 6361 7365  nt (in most case
+0001dc90: 7320 666f 7220 3e34 4420 696d 6167 6573  s for >4D images
+0001dca0: 2920 6265 7477 6565 6e20 7468 7265 7368  ) between thresh
+0001dcb0: 6f6c 6428 2920 616e 6420 6c61 6265 6c28  old() and label(
+0001dcc0: 292e 0d0a 2020 2020 2020 2020 496e 2074  )...        In t
+0001dcd0: 6869 7320 6675 6e63 7469 6f6e 2c20 626f  his function, bo
+0001dce0: 7468 2066 756e 6374 696f 6e20 7769 6c6c  th function will
+0001dcf0: 2068 6176 6520 7468 6520 7361 6d65 2060   have the same `
+0001dd00: 6064 696d 7360 6020 666f 7220 7369 6d70  `dims`` for simp
+0001dd10: 6c69 6369 7479 2e0d 0a0d 0a20 2020 2020  licity.....     
+0001dd20: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+0001dd30: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001dd40: 2d0d 0a20 2020 2020 2020 2074 6872 3a20  -..        thr: 
+0001dd50: 666c 6f61 7420 6f72 2073 7472 206f 7220  float or str or 
+0001dd60: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0d0a  None, optional..
+0001dd70: 2020 2020 2020 2020 2020 2020 5468 7265              Thre
+0001dd80: 7368 6f6c 6420 7661 6c75 652c 206f 7220  shold value, or 
+0001dd90: 7468 7265 7368 6f6c 6469 6e67 2061 6c67  thresholding alg
+0001dda0: 6f72 6974 686d 2e0d 0a20 2020 2020 2020  orithm...       
+0001ddb0: 207b 6469 6d73 7d0d 0a20 2020 2020 2020   {dims}..       
+0001ddc0: 202a 2a6b 7761 7267 733a 0d0a 2020 2020   **kwargs:..    
+0001ddd0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+0001dde0: 6172 6775 6d65 6e74 7320 7468 6174 2077  arguments that w
+0001ddf0: 696c 6c20 7061 7373 6564 2074 6f20 6675  ill passed to fu
+0001de00: 6e63 7469 6f6e 2069 6e64 6963 6174 6564  nction indicated
+0001de10: 2069 6e20 276d 6574 686f 6427 2e0d 0a20   in 'method'... 
+0001de20: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001de30: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+0001de40: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+0001de50: 2020 204c 6162 656c 0d0a 2020 2020 2020     Label..      
+0001de60: 2020 2020 2020 4e65 776c 7920 6372 6561        Newly crea
+0001de70: 7465 6420 6c61 6265 6c2e 0d0a 2020 2020  ted label...    
+0001de80: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+0001de90: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
+0001dea0: 3d20 7365 6c66 2e74 6872 6573 686f 6c64  = self.threshold
+0001deb0: 2874 6872 3d74 6872 2c20 2a2a 6b77 6172  (thr=thr, **kwar
+0001dec0: 6773 290d 0a20 2020 2020 2020 2072 6574  gs)..        ret
+0001ded0: 7572 6e20 7365 6c66 2e6c 6162 656c 286c  urn self.label(l
+0001dee0: 6162 656c 732c 2066 696c 743d 6669 6c74  abels, filt=filt
+0001def0: 2c20 6469 6d73 3d64 696d 7329 0d0a 2020  , dims=dims)..  
+0001df00: 2020 0d0a 2020 2020 6465 6620 7265 6769    ..    def regi
+0001df10: 6f6e 7072 6f70 7328 0d0a 2020 2020 2020  onprops(..      
+0001df20: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
+0001df30: 2070 726f 7065 7274 6965 733a 2049 7465   properties: Ite
+0001df40: 7261 626c 655b 7374 725d 207c 2073 7472  rable[str] | str
+0001df50: 203d 2028 226d 6561 6e5f 696e 7465 6e73   = ("mean_intens
+0001df60: 6974 7922 2c29 2c0d 0a20 2020 2020 2020  ity",),..       
+0001df70: 202a 2c20 0d0a 2020 2020 2020 2020 6578   *, ..        ex
+0001df80: 7472 615f 7072 6f70 6572 7469 6573 3a20  tra_properties: 
+0001df90: 4974 6572 6162 6c65 5b43 616c 6c61 626c  Iterable[Callabl
+0001dfa0: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
+0001dfb0: 2c0d 0a20 2020 2029 202d 3e20 4461 7461  ,..    ) -> Data
+0001dfc0: 4469 6374 5b73 7472 2c20 5072 6f70 4172  Dict[str, PropAr
+0001dfd0: 7261 795d 3a0d 0a20 2020 2020 2020 2022  ray]:..        "
+0001dfe0: 2222 0d0a 2020 2020 2020 2020 4d75 6c74  ""..        Mult
+0001dff0: 692d 6469 6d65 6e73 696f 6e61 6c20 7265  i-dimensional re
+0001e000: 6769 6f6e 2070 726f 7065 7274 7920 7175  gion property qu
+0001e010: 616e 7469 6669 6361 7469 6f6e 2e0d 0a20  antification... 
+0001e020: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001e030: 2052 756e 2073 6b69 6d61 6765 2773 2072   Run skimage's r
+0001e040: 6567 696f 6e70 726f 7073 2829 2066 756e  egionprops() fun
+0001e050: 6374 696f 6e20 616e 6420 7265 7475 726e  ction and return
+0001e060: 2074 6865 2072 6573 756c 7473 2061 7320   the results as 
+0001e070: 5072 6f70 4172 7261 792c 2073 6f0d 0a20  PropArray, so.. 
+0001e080: 2020 2020 2020 2074 6861 7420 796f 7520         that you 
+0001e090: 6361 6e20 6163 6365 7373 2075 7369 6e67  can access using
+0001e0a0: 2066 6c65 7869 626c 6520 736c 6963 696e   flexible slicin
+0001e0b0: 672e 2046 6f72 2065 7861 6d70 6c65 2c20  g. For example, 
+0001e0c0: 6966 2061 2074 6379 782d 696d 6167 6520  if a tcyx-image 
+0001e0d0: 6973 0d0a 2020 2020 2020 2020 616e 616c  is..        anal
+0001e0e0: 797a 6564 2077 6974 6820 6060 7072 6f70  yzed with ``prop
+0001e0f0: 6572 7469 6573 3d28 2258 222c 2022 5922  erties=("X", "Y"
+0001e100: 2960 602c 2074 6865 6e20 796f 7520 6361  )``, then you ca
+0001e110: 6e20 6765 7420 5827 7320 7469 6d65 2d63  n get X's time-c
+0001e120: 6f75 7273 6520 7072 6f66 696c 650d 0a20  ourse profile.. 
+0001e130: 2020 2020 2020 206f 6620 6368 616e 6e65         of channe
+0001e140: 6c20 3120 6174 206c 6162 656c 2033 2062  l 1 at label 3 b
+0001e150: 7920 6060 7072 6f70 5b22 5822 5d5b 2270  y ``prop["X"]["p
+0001e160: 3d35 3b63 3d31 225d 6060 206f 7220 6060  =5;c=1"]`` or ``
+0001e170: 7072 6f70 2e58 5b22 703d 353b 633d 3122  prop.X["p=5;c=1"
+0001e180: 5d60 602e 0d0a 0d0a 2020 2020 2020 2020  ]``.....        
+0001e190: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+0001e1a0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+0001e1b0: 2020 2020 2020 2020 7072 6f70 6572 7469          properti
+0001e1c0: 6573 203a 2069 7465 7261 626c 652c 206f  es : iterable, o
+0001e1d0: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+0001e1e0: 2020 2020 2070 726f 7065 7274 6965 7320       properties 
+0001e1f0: 746f 2061 6e61 6c79 7a65 2c20 7365 6520  to analyze, see 
+0001e200: 6060 736b 696d 6167 652e 6d65 6173 7572  ``skimage.measur
+0001e210: 652e 7265 6769 6f6e 7072 6f70 7360 602e  e.regionprops``.
+0001e220: 0d0a 2020 2020 2020 2020 6578 7472 615f  ..        extra_
+0001e230: 7072 6f70 6572 7469 6573 203a 2069 7465  properties : ite
+0001e240: 7261 626c 6520 6f66 2063 616c 6c61 626c  rable of callabl
+0001e250: 652c 206f 7074 696f 6e61 6c0d 0a20 2020  e, optional..   
+0001e260: 2020 2020 2020 2020 2065 7874 7261 2070           extra p
+0001e270: 726f 7065 7274 6965 7320 746f 2061 6e61  roperties to ana
+0001e280: 6c79 7a65 2c20 7365 6520 6060 736b 696d  lyze, see ``skim
+0001e290: 6167 652e 6d65 6173 7572 652e 7265 6769  age.measure.regi
+0001e2a0: 6f6e 7072 6f70 7360 602e 0d0a 0d0a 2020  onprops``.....  
+0001e2b0: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+0001e2c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
+0001e2d0: 2020 2020 2020 2020 4461 7461 4469 6374          DataDict
+0001e2e0: 206f 6620 5072 6f70 4172 7261 790d 0a20   of PropArray.. 
+0001e2f0: 2020 2020 2020 2020 2020 2044 6963 7469             Dicti
+0001e300: 6f6e 6172 7920 6861 7320 6b65 7973 206f  onary has keys o
+0001e310: 6620 7072 6f70 6572 7469 6573 2074 6861  f properties tha
+0001e320: 7420 6172 6520 7370 6563 6966 6965 6420  t are specified 
+0001e330: 6279 2060 7072 6f70 6572 7469 6573 602e  by `properties`.
+0001e340: 2045 6163 6820 7661 6c75 650d 0a20 2020   Each value..   
+0001e350: 2020 2020 2020 2020 2068 6173 2074 6865           has the
+0001e360: 2061 7272 6179 206f 6620 7072 6f70 6572   array of proper
+0001e370: 7469 6573 2e0d 0a20 2020 2020 2020 2020  ties...         
+0001e380: 2020 200d 0a20 2020 2020 2020 2045 7861     ..        Exa
+0001e390: 6d70 6c65 730d 0a20 2020 2020 2020 202d  mples..        -
+0001e3a0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+0001e3b0: 204d 6561 7375 7265 2072 6567 696f 6e20   Measure region 
+0001e3c0: 7072 6f70 6572 7469 6573 2061 726f 756e  properties aroun
+0001e3d0: 6420 7369 6e67 6c65 206d 6f6c 6563 756c  d single molecul
+0001e3e0: 6573 2e0d 0a20 2020 2020 2020 200d 0a20  es...        .. 
+0001e3f0: 2020 2020 2020 2020 2020 203e 3e3e 2063             >>> c
+0001e400: 6f6f 7264 7320 3d20 696d 672e 6365 6e74  oords = img.cent
+0001e410: 726f 6964 5f73 6d28 290d 0a20 2020 2020  roid_sm()..     
+0001e420: 2020 2020 2020 203e 3e3e 2069 6d67 2e73         >>> img.s
+0001e430: 7065 6369 6679 2863 6f6f 7264 732c 2033  pecify(coords, 3
+0001e440: 2c20 6c61 6265 6c74 7970 653d 2263 6972  , labeltype="cir
+0001e450: 636c 6522 290d 0a20 2020 2020 2020 2020  cle")..         
+0001e460: 2020 203e 3e3e 2070 726f 7073 203d 2069     >>> props = i
+0001e470: 6d67 2e72 6567 696f 6e70 726f 7073 2829  mg.regionprops()
+0001e480: 0d0a 2020 2020 2020 2020 2222 2220 2020  ..        """   
+0001e490: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
+0001e4a0: 645f 6178 6973 203d 2022 4e22 0d0a 2020  d_axis = "N"..  
+0001e4b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0001e4c0: 6e63 6528 7072 6f70 6572 7469 6573 2c20  nce(properties, 
+0001e4d0: 7374 7229 3a0d 0a20 2020 2020 2020 2020  str):..         
+0001e4e0: 2020 2070 726f 7065 7274 6965 7320 3d20     properties = 
+0001e4f0: 2870 726f 7065 7274 6965 732c 290d 0a20  (properties,).. 
+0001e500: 2020 2020 2020 2069 6620 6578 7472 615f         if extra_
+0001e510: 7072 6f70 6572 7469 6573 2069 7320 6e6f  properties is no
+0001e520: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0001e530: 2020 2020 2070 726f 7065 7274 6965 7320       properties 
+0001e540: 3d20 7072 6f70 6572 7469 6573 202b 2074  = properties + t
+0001e550: 7570 6c65 2865 782e 5f5f 6e61 6d65 5f5f  uple(ex.__name__
+0001e560: 2066 6f72 2065 7820 696e 2065 7874 7261   for ex in extra
+0001e570: 5f70 726f 7065 7274 6965 7329 0d0a 0d0a  _properties)....
+0001e580: 2020 2020 2020 2020 6966 2069 645f 6178          if id_ax
+0001e590: 6973 2069 6e20 7365 6c66 2e61 7865 733a  is in self.axes:
+0001e5a0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0001e5b0: 7468 6973 2064 696d 656e 7369 6f6e 2077  this dimension w
+0001e5c0: 696c 6c20 6265 206c 6162 656c 0d0a 2020  ill be label..  
+0001e5d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001e5e0: 5661 6c75 6545 7272 6f72 2866 2261 7869  ValueError(f"axi
+0001e5f0: 7320 277b 6964 5f61 7869 737d 2720 6973  s '{id_axis}' is
+0001e600: 2075 7365 6420 666f 7220 6c61 6265 6c20   used for label 
+0001e610: 4944 2069 6e20 4461 7461 4672 616d 6573  ID in DataFrames
+0001e620: 2e22 290d 0a20 2020 2020 2020 200d 0a20  .")..        .. 
+0001e630: 2020 2020 2020 2070 726f 705f 6178 6573         prop_axes
+0001e640: 203d 2063 6f6d 706c 656d 656e 745f 6178   = complement_ax
+0001e650: 6573 2873 656c 662e 6c61 6265 6c73 2e61  es(self.labels.a
+0001e660: 7865 732c 2073 656c 662e 6178 6573 290d  xes, self.axes).
+0001e670: 0a20 2020 2020 2020 2073 6861 7065 203d  .        shape =
+0001e680: 2073 656c 662e 7369 7a65 736f 6628 7072   self.sizesof(pr
+0001e690: 6f70 5f61 7865 7329 0d0a 0d0a 2020 2020  op_axes)....    
+0001e6a0: 2020 2020 6f75 7420 3d20 4461 7461 4469      out = DataDi
+0001e6b0: 6374 287b 703a 2050 726f 7041 7272 6179  ct({p: PropArray
+0001e6c0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0001e6d0: 2020 206e 702e 656d 7074 7928 2873 656c     np.empty((sel
+0001e6e0: 662e 6c61 6265 6c73 2e6d 6178 2829 2c29  f.labels.max(),)
+0001e6f0: 202b 2073 6861 7065 2c20 6474 7970 653d   + shape, dtype=
+0001e700: 6e70 2e66 6c6f 6174 3332 292c 0d0a 2020  np.float32),..  
+0001e710: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+0001e720: 6d65 3d73 656c 662e 6e61 6d65 2b22 2d70  me=self.name+"-p
+0001e730: 726f 7022 2c20 0d0a 2020 2020 2020 2020  rop", ..        
+0001e740: 2020 2020 2020 2020 6178 6573 3d5b 6964          axes=[id
+0001e750: 5f61 7869 735d 2b70 726f 705f 6178 6573  _axis]+prop_axes
+0001e760: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001e770: 2020 2073 6f75 7263 653d 7365 6c66 2e73     source=self.s
+0001e780: 6f75 7263 652c 0d0a 2020 2020 2020 2020  ource,..        
+0001e790: 2020 2020 2020 2020 7072 6f70 6e61 6d65          propname
+0001e7a0: 3d70 0d0a 2020 2020 2020 2020 2020 2020  =p..            
+0001e7b0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+0001e7c0: 2020 2020 2020 2066 6f72 2070 2069 6e20         for p in 
+0001e7d0: 7072 6f70 6572 7469 6573 0d0a 2020 2020  properties..    
+0001e7e0: 2020 2020 2020 2020 7d29 0d0a 2020 2020          })..    
+0001e7f0: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+0001e800: 6361 6c63 756c 6174 6520 7072 6f70 6572  calculate proper
+0001e810: 7479 2076 616c 7565 2066 6f72 2065 6163  ty value for eac
+0001e820: 6820 736c 6963 650d 0a20 2020 2020 2020  h slice..       
+0001e830: 2066 6f72 2073 6c2c 2069 6d67 2069 6e20   for sl, img in 
+0001e840: 7365 6c66 2e69 7465 7228 7072 6f70 5f61  self.iter(prop_a
+0001e850: 7865 732c 2065 7863 6c75 6465 3d73 656c  xes, exclude=sel
+0001e860: 662e 6c61 6265 6c73 2e61 7865 7329 3a0d  f.labels.axes):.
+0001e870: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0001e880: 7073 203d 2073 6b6d 6573 2e72 6567 696f  ps = skmes.regio
+0001e890: 6e70 726f 7073 2873 656c 662e 6c61 6265  nprops(self.labe
+0001e8a0: 6c73 2e76 616c 7565 2c20 696d 672c 2063  ls.value, img, c
+0001e8b0: 6163 6865 3d46 616c 7365 2c0d 0a20 2020  ache=False,..   
+0001e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8e0: 2020 2065 7874 7261 5f70 726f 7065 7274     extra_propert
+0001e8f0: 6965 733d 6578 7472 615f 7072 6f70 6572  ies=extra_proper
+0001e900: 7469 6573 290d 0a20 2020 2020 2020 2020  ties)..         
+0001e910: 2020 206c 6162 656c 5f73 6c20 3d20 2873     label_sl = (s
+0001e920: 6c69 6365 284e 6f6e 6529 2c29 202b 2073  lice(None),) + s
+0001e930: 6c0d 0a20 2020 2020 2020 2020 2020 2066  l..            f
+0001e940: 6f72 2070 726f 705f 6e61 6d65 2069 6e20  or prop_name in 
+0001e950: 7072 6f70 6572 7469 6573 3a0d 0a20 2020  properties:..   
+0001e960: 2020 2020 2020 2020 2020 2020 2023 2042               # B
+0001e970: 6f74 6820 7369 6465 7320 6861 7665 206c  oth sides have l
+0001e980: 656e 6774 6820 6f66 2069 645f 6178 6973  ength of id_axis
+0001e990: 2028 6e75 6d62 6572 206f 6620 6c61 6265   (number of labe
+0001e9a0: 6c73 2920 736f 2074 6861 7420 7661 6c75  ls) so that valu
+0001e9b0: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
+0001e9c0: 2020 2020 2320 6361 6e20 6265 2063 6f72      # can be cor
+0001e9d0: 7265 6374 6c79 2073 7562 7374 6974 7574  rectly substitut
+0001e9e0: 6564 2e0d 0a20 2020 2020 2020 2020 2020  ed...           
+0001e9f0: 2020 2020 206f 7574 5b70 726f 705f 6e61       out[prop_na
+0001ea00: 6d65 5d5b 6c61 6265 6c5f 736c 5d20 3d20  me][label_sl] = 
+0001ea10: 5b67 6574 6174 7472 2870 726f 702c 2070  [getattr(prop, p
+0001ea20: 726f 705f 6e61 6d65 2920 666f 7220 7072  rop_name) for pr
+0001ea30: 6f70 2069 6e20 7072 6f70 735d 0d0a 2020  op in props]..  
+0001ea40: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0001ea50: 666f 7220 7061 7272 2069 6e20 6f75 742e  for parr in out.
+0001ea60: 7661 6c75 6573 2829 3a0d 0a20 2020 2020  values():..     
+0001ea70: 2020 2020 2020 2070 6172 722e 7365 745f         parr.set_
+0001ea80: 7363 616c 6528 7365 6c66 290d 0a20 2020  scale(self)..   
+0001ea90: 2020 2020 2072 6574 7572 6e20 6f75 740d       return out.
+0001eaa0: 0a20 2020 200d 0a20 2020 2040 5f64 6f63  .    ..    @_doc
+0001eab0: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
+0001eac0: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
+0001ead0: 616c 5f61 7865 730d 0a20 2020 2040 6368  al_axes..    @ch
+0001eae0: 6563 6b5f 696e 7075 745f 616e 645f 6f75  eck_input_and_ou
+0001eaf0: 7470 7574 0d0a 2020 2020 6465 6620 6c62  tput..    def lb
+0001eb00: 7028 0d0a 2020 2020 2020 2020 7365 6c66  p(..        self
+0001eb10: 2c0d 0a20 2020 2020 2020 2070 3a20 696e  ,..        p: in
+0001eb20: 7420 3d20 3132 2c0d 0a20 2020 2020 2020  t = 12,..       
+0001eb30: 2072 6164 6975 733a 2069 6e74 203d 2031   radius: int = 1
+0001eb40: 2c0d 0a20 2020 2020 2020 202a 2c0d 0a20  ,..        *,.. 
+0001eb50: 2020 2020 2020 206d 6574 686f 643a 204c         method: L
+0001eb60: 6974 6572 616c 5b22 6465 6661 756c 7422  iteral["default"
+0001eb70: 2c20 2272 6f72 222c 2022 756e 6966 6f72  , "ror", "unifor
+0001eb80: 6d22 2c20 2276 6172 225d 203d 2022 6465  m", "var"] = "de
+0001eb90: 6661 756c 7422 2c0d 0a20 2020 2020 2020  fault",..       
+0001eba0: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
+0001ebb0: 6e65 2c0d 0a20 2020 2029 202d 3e20 496d  ne,..    ) -> Im
+0001ebc0: 6741 7272 6179 3a0d 0a20 2020 2020 2020  gArray:..       
+0001ebd0: 2022 2222 0d0a 2020 2020 2020 2020 4c6f   """..        Lo
+0001ebe0: 6361 6c20 6269 6e61 7279 2070 6174 7465  cal binary patte
+0001ebf0: 726e 2066 6561 7475 7265 2065 7874 7261  rn feature extra
+0001ec00: 6374 696f 6e2e 0d0a 0d0a 2020 2020 2020  ction.....      
+0001ec10: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+0001ec20: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0001ec30: 0d0a 2020 2020 2020 2020 7020 3a20 696e  ..        p : in
+0001ec40: 742c 2064 6566 6175 6c74 2069 7320 3132  t, default is 12
+0001ec50: 0d0a 2020 2020 2020 2020 2020 2020 4e75  ..            Nu
+0001ec60: 6d62 6572 206f 6620 6369 7263 756c 6172  mber of circular
+0001ec70: 206e 6569 6768 626f 7273 0d0a 2020 2020   neighbors..    
+0001ec80: 2020 2020 7261 6469 7573 203a 2069 6e74      radius : int
+0001ec90: 2c20 6465 6661 756c 7420 6973 2031 0d0a  , default is 1..
+0001eca0: 2020 2020 2020 2020 2020 2020 5261 6469              Radi
+0001ecb0: 7573 206f 6620 6e65 6967 6862 6f75 7273  us of neighbours
+0001ecc0: 2e0d 0a20 2020 2020 2020 206d 6574 686f  ...        metho
+0001ecd0: 6420 3a20 7374 722c 206f 7074 696f 6e61  d : str, optiona
+0001ece0: 6c0d 0a20 2020 2020 2020 2020 2020 204d  l..            M
+0001ecf0: 6574 686f 6420 746f 2064 6574 6572 6d69  ethod to determi
+0001ed00: 6e65 6420 7468 6520 7061 7474 6572 6e2e  ned the pattern.
+0001ed10: 0d0a 2020 2020 2020 2020 7b64 696d 737d  ..        {dims}
+0001ed20: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+0001ed30: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+0001ed40: 2d2d 2d2d 0d0a 2020 2020 2020 2020 496d  ----..        Im
+0001ed50: 6741 7272 6179 0d0a 2020 2020 2020 2020  gArray..        
+0001ed60: 2020 2020 4c6f 6361 6c20 6269 6e61 7279      Local binary
+0001ed70: 2070 6174 7465 726e 2069 6d61 6765 2e0d   pattern image..
+0001ed80: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
+0001ed90: 2020 2020 0d0a 2020 2020 2020 2020 0d0a      ..        ..
+0001eda0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001edb0: 656c 662e 5f61 7070 6c79 5f64 6173 6b28  elf._apply_dask(
+0001edc0: 0d0a 2020 2020 2020 2020 2020 2020 736b  ..            sk
+0001edd0: 6665 6174 2e6c 6f63 616c 5f62 696e 6172  feat.local_binar
+0001ede0: 795f 7061 7474 6572 6e2c 0d0a 2020 2020  y_pattern,..    
+0001edf0: 2020 2020 2020 2020 635f 6178 6573 3d63          c_axes=c
+0001ee00: 6f6d 706c 656d 656e 745f 6178 6573 2864  omplement_axes(d
+0001ee10: 696d 7329 2c20 0d0a 2020 2020 2020 2020  ims), ..        
+0001ee20: 2020 2020 6172 6773 3d28 702c 2072 6164      args=(p, rad
+0001ee30: 6975 732c 206d 6574 686f 6429 0d0a 2020  ius, method)..  
+0001ee40: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0001ee50: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
+0001ee60: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
+0001ee70: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
+0001ee80: 7865 730d 0a20 2020 2040 6368 6563 6b5f  xes..    @check_
+0001ee90: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
+0001eea0: 0d0a 2020 2020 6465 6620 676c 636d 5f70  ..    def glcm_p
+0001eeb0: 726f 7073 2873 656c 662c 2064 6973 7461  rops(self, dista
+0001eec0: 6e63 6573 2c20 616e 676c 6573 2c20 7261  nces, angles, ra
+0001eed0: 6469 7573 3a69 6e74 2c20 7072 6f70 6572  dius:int, proper
+0001eee0: 7469 6573 3a74 7570 6c65 3d4e 6f6e 652c  ties:tuple=None,
+0001eef0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0001ef00: 2020 2020 2020 2a2c 2062 696e 733a 696e        *, bins:in
+0001ef10: 743d 4e6f 6e65 2c20 7265 7363 616c 655f  t=None, rescale_
+0001ef20: 6d61 783a 626f 6f6c 3d46 616c 7365 2c20  max:bool=False, 
+0001ef30: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+0001ef40: 6529 202d 3e20 496d 6741 7272 6179 3a0d  e) -> ImgArray:.
+0001ef50: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0001ef60: 2020 2020 2020 436f 6d70 7574 6520 7072        Compute pr
+0001ef70: 6f70 6572 7469 6573 206f 6620 2247 7261  operties of "Gra
+0001ef80: 7920 4c65 7665 6c20 436f 6f63 7572 7265  y Level Coocurre
+0001ef90: 6e63 6520 4d61 7472 6978 222e 2054 6869  nce Matrix". Thi
+0001efa0: 7320 7769 6c6c 2074 616b 6520 6c6f 6e67  s will take long
+0001efb0: 2074 696d 650d 0a20 2020 2020 2020 2062   time..        b
+0001efc0: 6563 6175 7365 206f 6620 7075 7265 2050  ecause of pure P
+0001efd0: 7974 686f 6e20 666f 722d 6c6f 6f70 2e0d  ython for-loop..
+0001efe0: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0001eff0: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
+0001f000: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
+0001f010: 2020 2064 6973 7461 6e63 6573 203a 2061     distances : a
+0001f020: 7272 6179 5f6c 696b 650d 0a20 2020 2020  rray_like..     
+0001f030: 2020 2020 2020 204c 6973 7420 6f66 2070         List of p
+0001f040: 6978 656c 2070 6169 7220 6469 7374 616e  ixel pair distan
+0001f050: 6365 206f 6666 7365 7473 2e0d 0a20 2020  ce offsets...   
+0001f060: 2020 2020 2061 6e67 6c65 7320 3a20 6172       angles : ar
+0001f070: 7261 795f 6c69 6b65 0d0a 2020 2020 2020  ray_like..      
+0001f080: 2020 2020 2020 4c69 7374 206f 6620 7069        List of pi
+0001f090: 7865 6c20 7061 6972 2061 6e67 6c65 7320  xel pair angles 
+0001f0a0: 696e 2072 6164 6961 6e73 2e0d 0a20 2020  in radians...   
+0001f0b0: 2020 2020 2072 6164 6975 7320 3a20 696e       radius : in
+0001f0c0: 740d 0a20 2020 2020 2020 2020 2020 2057  t..            W
+0001f0d0: 696e 646f 7720 7261 6469 7573 2e0d 0a20  indow radius... 
+0001f0e0: 2020 2020 2020 2070 726f 7065 7274 6965         propertie
+0001f0f0: 7320 3a20 7475 706c 6520 6f66 2073 7472  s : tuple of str
+0001f100: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+0001f110: 6e74 7261 7374 2c20 6469 7373 696d 696c  ntrast, dissimil
+0001f120: 6172 6974 792c 2068 6f6d 6f67 656e 6569  arity, homogenei
+0001f130: 7479 2c20 656e 6572 6779 2c20 6d65 616e  ty, energy, mean
+0001f140: 2c20 7374 642c 2061 736d 2c20 6d61 782c  , std, asm, max,
+0001f150: 2065 6e74 726f 7079 0d0a 2020 2020 2020   entropy..      
+0001f160: 2020 6269 6e73 203a 2069 6e74 2c20 6f70    bins : int, op
+0001f170: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
+0001f180: 2020 2020 4e75 6d62 6572 206f 6620 6269      Number of bi
+0001f190: 6e73 2e0d 0a20 2020 2020 2020 2072 6573  ns...        res
+0001f1a0: 6361 6c65 5f6d 6178 203a 2062 6f6f 6c2c  cale_max : bool,
+0001f1b0: 2064 6566 6175 6c74 2069 7320 4661 6c73   default is Fals
+0001f1c0: 650d 0a20 2020 2020 2020 2020 2020 2049  e..            I
+0001f1d0: 6620 5472 7565 2c20 7468 6520 636f 6e74  f True, the cont
+0001f1e0: 7261 7374 206f 6620 7468 6520 696e 7075  rast of the inpu
+0001f1f0: 7420 696d 6167 6520 6973 206d 6178 696d  t image is maxim
+0001f200: 697a 6564 2062 7920 6d75 6c74 6970 6c79  ized by multiply
+0001f210: 696e 6720 616e 2069 6e74 6567 6572 2e0d  ing an integer..
+0001f220: 0a20 2020 2020 2020 207b 6469 6d73 7d0d  .        {dims}.
+0001f230: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+0001f240: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
+0001f250: 2d2d 2d0d 0a20 2020 2020 2020 2044 6174  ---..        Dat
+0001f260: 6144 6963 7420 6f66 2049 6d67 4172 7261  aDict of ImgArra
+0001f270: 790d 0a20 2020 2020 2020 2020 2020 2047  y..            G
+0001f280: 4c43 4d20 7769 7468 2061 6464 6974 696f  LCM with additio
+0001f290: 6e61 6c20 6178 6573 2022 6461 222c 2077  nal axes "da", w
+0001f2a0: 6865 7265 2022 6422 206d 6561 6e73 2064  here "d" means d
+0001f2b0: 6973 7461 6e63 6520 616e 6420 2261 2220  istance and "a" 
+0001f2c0: 6d65 616e 7320 616e 676c 652e 0d0a 2020  means angle...  
+0001f2d0: 2020 2020 2020 2020 2020 4966 2069 6e70            If inp
+0001f2e0: 7574 2069 6d61 6765 2068 6173 2022 747a  ut image has "tz
+0001f2f0: 7978 2220 6178 6573 2074 6865 6e20 6f75  yx" axes then ou
+0001f300: 7470 7574 2077 696c 6c20 6861 7665 2022  tput will have "
+0001f310: 747a 643c 7978 2220 6178 6573 2e0d 0a20  tzd<yx" axes... 
+0001f320: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001f330: 2045 7861 6d70 6c65 730d 0a20 2020 2020   Examples..     
+0001f340: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
+0001f350: 2020 2020 2050 6c6f 7420 474c 434d 2773       Plot GLCM's
+0001f360: 2049 444d 2061 6e64 2041 534d 2069 6d61   IDM and ASM ima
+0001f370: 6765 730d 0a20 2020 2020 2020 2020 2020  ges..           
+0001f380: 203e 3e3e 206f 7574 203d 2069 6d67 2e67   >>> out = img.g
+0001f390: 6c63 6d5f 7072 6f70 7328 5b31 5d2c 205b  lcm_props([1], [
+0001f3a0: 305d 2c20 332c 2070 726f 7065 7274 6965  0], 3, propertie
+0001f3b0: 733d 2822 6964 6d22 2c22 6173 6d22 2929  s=("idm","asm"))
+0001f3c0: 0d0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
+0001f3d0: 3e20 6f75 742e 6964 6d5b 2264 3d30 3b3c  > out.idm["d=0;<
+0001f3e0: 3d30 225d 2e69 6d73 686f 7728 290d 0a20  =0"].imshow().. 
+0001f3f0: 2020 2020 2020 2020 2020 203e 3e3e 206f             >>> o
+0001f400: 7574 2e61 736d 5b22 643d 303b 3c3d 3022  ut.asm["d=0;<=0"
+0001f410: 5d2e 696d 7368 6f77 2829 0d0a 2020 2020  ].imshow()..    
+0001f420: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+0001f430: 0a20 2020 2020 2020 2073 656c 662c 2062  .        self, b
+0001f440: 696e 732c 2072 6573 6361 6c65 5f6d 6178  ins, rescale_max
+0001f450: 203d 205f 676c 636d 2e63 6865 636b 5f67   = _glcm.check_g
+0001f460: 6c63 6d28 7365 6c66 2c20 6269 6e73 2c20  lcm(self, bins, 
+0001f470: 7265 7363 616c 655f 6d61 7829 0d0a 2020  rescale_max)..  
+0001f480: 2020 2020 2020 6966 2070 726f 7065 7274        if propert
+0001f490: 6965 7320 6973 204e 6f6e 653a 0d0a 2020  ies is None:..  
+0001f4a0: 2020 2020 2020 2020 2020 7072 6f70 6572            proper
+0001f4b0: 7469 6573 203d 2028 2263 6f6e 7472 6173  ties = ("contras
+0001f4c0: 7422 2c20 2264 6973 7369 6d69 6c61 7269  t", "dissimilari
+0001f4d0: 7479 222c 2022 6964 6d22 2c20 0d0a 2020  ty", "idm", ..  
+0001f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4f0: 2020 2020 2020 2020 2261 736d 222c 2022          "asm", "
+0001f500: 6d61 7822 2c20 2265 6e74 726f 7079 222c  max", "entropy",
+0001f510: 2022 636f 7272 656c 6174 696f 6e22 290d   "correlation").
+0001f520: 0a20 2020 2020 2020 2063 5f61 7865 7320  .        c_axes 
+0001f530: 3d20 636f 6d70 6c65 6d65 6e74 5f61 7865  = complement_axe
+0001f540: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+0001f550: 7329 0d0a 2020 2020 2020 2020 6469 7374  s)..        dist
+0001f560: 616e 6365 7320 3d20 6e70 2e61 7361 7272  ances = np.asarr
+0001f570: 6179 2864 6973 7461 6e63 6573 2c20 6474  ay(distances, dt
+0001f580: 7970 653d 6e70 2e75 696e 7438 290d 0a20  ype=np.uint8).. 
+0001f590: 2020 2020 2020 2061 6e67 6c65 7320 3d20         angles = 
+0001f5a0: 6e70 2e61 7361 7272 6179 2861 6e67 6c65  np.asarray(angle
+0001f5b0: 732c 2064 7479 7065 3d6e 702e 666c 6f61  s, dtype=np.floa
+0001f5c0: 7433 3229 0d0a 2020 2020 2020 2020 6f75  t32)..        ou
+0001f5d0: 7473 6861 7065 203d 2073 656c 662e 7369  tshape = self.si
+0001f5e0: 7a65 736f 6628 635f 6178 6573 2920 2b20  zesof(c_axes) + 
+0001f5f0: 286c 656e 2864 6973 7461 6e63 6573 292c  (len(distances),
+0001f600: 206c 656e 2861 6e67 6c65 7329 2920 2b20   len(angles)) + 
+0001f610: 7365 6c66 2e73 697a 6573 6f66 2864 696d  self.sizesof(dim
+0001f620: 7329 0d0a 2020 2020 2020 2020 6f75 7420  s)..        out 
+0001f630: 3d20 7b7d 0d0a 2020 2020 2020 2020 666f  = {}..        fo
+0001f640: 7220 7072 6f70 2069 6e20 7072 6f70 6572  r prop in proper
+0001f650: 7469 6573 3a0d 0a20 2020 2020 2020 2020  ties:..         
+0001f660: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0001f670: 2870 726f 702c 2073 7472 293a 0d0a 2020  (prop, str):..  
+0001f680: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+0001f690: 745b 7072 6f70 5d20 3d20 6e70 2e65 6d70  t[prop] = np.emp
+0001f6a0: 7479 286f 7574 7368 6170 652c 2064 7479  ty(outshape, dty
+0001f6b0: 7065 3d6e 702e 666c 6f61 7433 3229 2e76  pe=np.float32).v
+0001f6c0: 6965 7728 7365 6c66 2e5f 5f63 6c61 7373  iew(self.__class
+0001f6d0: 5f5f 290d 0a20 2020 2020 2020 2020 2020  __)..           
+0001f6e0: 2065 6c69 6620 6361 6c6c 6162 6c65 2870   elif callable(p
+0001f6f0: 726f 7029 3a0d 0a20 2020 2020 2020 2020  rop):..         
+0001f700: 2020 2020 2020 206f 7574 5b70 726f 702e         out[prop.
+0001f710: 5f5f 6e61 6d65 5f5f 5d20 3d20 6e70 2e65  __name__] = np.e
+0001f720: 6d70 7479 286f 7574 7368 6170 652c 2064  mpty(outshape, d
+0001f730: 7479 7065 3d6e 702e 666c 6f61 7433 3229  type=np.float32)
+0001f740: 2e76 6965 7728 7365 6c66 2e5f 5f63 6c61  .view(self.__cla
+0001f750: 7373 5f5f 290d 0a20 2020 2020 2020 2020  ss__)..         
+0001f760: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001f770: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001f780: 5479 7065 4572 726f 7228 2270 726f 7065  TypeError("prope
+0001f790: 7274 6965 7320 6d75 7374 2062 6520 7374  rties must be st
+0001f7a0: 7220 6f72 2063 616c 6c61 626c 652e 2229  r or callable.")
+0001f7b0: 0d0a 2020 2020 2020 2020 6f75 7420 3d20  ..        out = 
+0001f7c0: 4461 7461 4469 6374 286f 7574 290d 0a20  DataDict(out).. 
+0001f7d0: 2020 2020 2020 2073 656c 6620 3d20 7365         self = se
+0001f7e0: 6c66 2e70 6164 2872 6164 6975 732c 206d  lf.pad(radius, m
+0001f7f0: 6f64 653d 2272 6566 6c65 6374 222c 2064  ode="reflect", d
+0001f800: 696d 733d 6469 6d73 290d 0a20 2020 2020  ims=dims)..     
+0001f810: 2020 2066 6f72 2073 6c2c 2069 6d67 2069     for sl, img i
+0001f820: 6e20 7365 6c66 2e69 7465 7228 635f 6178  n self.iter(c_ax
+0001f830: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
+0001f840: 2020 7072 6f70 6f75 7420 3d20 5f67 6c63    propout = _glc
+0001f850: 6d2e 676c 636d 5f70 726f 7073 5f28 696d  m.glcm_props_(im
+0001f860: 672c 2064 6973 7461 6e63 6573 2c20 616e  g, distances, an
+0001f870: 676c 6573 2c20 6269 6e73 2c20 7261 6469  gles, bins, radi
+0001f880: 7573 2c20 7072 6f70 6572 7469 6573 290d  us, properties).
+0001f890: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001f8a0: 2070 726f 7020 696e 2070 726f 7065 7274   prop in propert
+0001f8b0: 6965 733a 0d0a 2020 2020 2020 2020 2020  ies:..          
+0001f8c0: 2020 2020 2020 6f75 745b 7072 6f70 5d2e        out[prop].
+0001f8d0: 7661 6c75 655b 736c 5d20 3d20 7072 6f70  value[sl] = prop
+0001f8e0: 6f75 745b 7072 6f70 5d0d 0a20 2020 2020  out[prop]..     
+0001f8f0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0001f900: 2066 6f72 206b 2c20 7620 696e 206f 7574   for k, v in out
+0001f910: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
+0001f920: 2020 2020 2020 2076 2e5f 7365 745f 696e         v._set_in
+0001f930: 666f 2873 656c 662c 206e 6577 5f61 7865  fo(self, new_axe
+0001f940: 733d 635f 6178 6573 2b22 6461 222b 6469  s=c_axes+"da"+di
+0001f950: 6d73 290d 0a20 2020 2020 2020 2072 6574  ms)..        ret
+0001f960: 7572 6e20 6f75 740d 0a20 2020 200d 0a20  urn out..    .. 
+0001f970: 2020 200d 0a20 2020 2040 7361 6d65 5f64     ..    @same_d
+0001f980: 7479 7065 0d0a 2020 2020 6465 6620 7072  type..    def pr
+0001f990: 6f6a 280d 0a20 2020 2020 2020 2073 656c  oj(..        sel
+0001f9a0: 662c 0d0a 2020 2020 2020 2020 6178 6973  f,..        axis
+0001f9b0: 3a20 4178 6973 4c69 6b65 207c 204e 6f6e  : AxisLike | Non
+0001f9c0: 6520 3d20 4e6f 6e65 2c0d 0a20 2020 2020  e = None,..     
+0001f9d0: 2020 206d 6574 686f 643a 2073 7472 207c     method: str |
+0001f9e0: 2043 616c 6c61 626c 6520 3d20 226d 6561   Callable = "mea
+0001f9f0: 6e22 2c0d 0a20 2020 2020 2020 206d 6173  n",..        mas
+0001fa00: 6b20 3d20 4e6f 6e65 2c0d 0a20 2020 2020  k = None,..     
+0001fa10: 2020 202a 2a6b 7761 7267 730d 0a20 2020     **kwargs..   
+0001fa20: 2029 202d 3e20 496d 6741 7272 6179 3a0d   ) -> ImgArray:.
+0001fa30: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0001fa40: 2020 2020 2020 5072 6f6a 6563 7469 6f6e        Projection
+0001fa50: 2061 6c6f 6e67 2061 6e79 2061 7869 732e   along any axis.
+0001fa60: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
+0001fa70: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+0001fa80: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+0001fa90: 2020 2020 6178 6973 203a 2073 7472 2c20      axis : str, 
+0001faa0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+0001fab0: 2020 2020 2020 416c 6f6e 6720 7768 6963        Along whic
+0001fac0: 6820 6178 6973 2070 726f 6a65 6374 696f  h axis projectio
+0001fad0: 6e20 7769 6c6c 2062 6520 6361 6c63 756c  n will be calcul
+0001fae0: 6174 6564 2e20 4966 204e 6f6e 652c 206d  ated. If None, m
+0001faf0: 6f73 7420 706c 6175 7369 626c 6520 6f6e  ost plausible on
+0001fb00: 6520 7769 6c6c 2062 6520 6368 6f73 656e  e will be chosen
+0001fb10: 2e0d 0a20 2020 2020 2020 206d 6574 686f  ...        metho
+0001fb20: 6420 3a20 7374 7220 6f72 2063 616c 6c61  d : str or calla
+0001fb30: 626c 652c 2064 6566 6175 6c74 2069 7320  ble, default is 
+0001fb40: 6d65 616e 2d70 726f 6a65 6374 696f 6e2e  mean-projection.
+0001fb50: 0d0a 2020 2020 2020 2020 2020 2020 5072  ..            Pr
+0001fb60: 6f6a 6563 7469 6f6e 206d 6574 686f 642e  ojection method.
+0001fb70: 2049 6620 7374 7220 6973 2067 6976 656e   If str is given
+0001fb80: 2c20 6974 2077 696c 6c20 636f 6e76 6572  , it will conver
+0001fb90: 7465 6420 746f 206e 756d 7079 2066 756e  ted to numpy fun
+0001fba0: 6374 696f 6e2e 0d0a 2020 2020 2020 2020  ction...        
+0001fbb0: 6d61 736b 203a 2061 7272 6179 2d6c 696b  mask : array-lik
+0001fbc0: 652c 206f 7074 696f 6e61 6c0d 0a20 2020  e, optional..   
+0001fbd0: 2020 2020 2020 2020 2049 6620 7072 6f76           If prov
+0001fbe0: 6964 6564 2c20 696e 7075 7420 696d 6167  ided, input imag
+0001fbf0: 6520 7769 6c6c 2062 6520 636f 6e76 6572  e will be conver
+0001fc00: 7465 6420 746f 206e 702e 6d61 2e61 7272  ted to np.ma.arr
+0001fc10: 6179 2061 6e64 2060 606d 6574 686f 6460  ay and ``method`
+0001fc20: 6020 7769 6c6c 2061 6c73 6f20 6265 2069  ` will also be i
+0001fc30: 6e74 6572 7072 6574 6564 0d0a 2020 2020  nterpreted..    
+0001fc40: 2020 2020 2020 2020 6173 2061 6e20 6d61          as an ma
+0001fc50: 736b 6564 2066 756e 6374 696f 2069 6620  sked functio if 
+0001fc60: 706f 7373 6962 6c65 2e0d 0a20 2020 2020  possible...     
+0001fc70: 2020 202a 2a6b 7761 7267 730d 0a20 2020     **kwargs..   
+0001fc80: 2020 2020 2020 2020 204f 7468 6572 206b           Other k
+0001fc90: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+0001fca0: 2074 6861 7420 7769 6c6c 2070 6173 7365   that will passe
+0001fcb0: 6420 746f 2070 726f 6a65 6374 696f 6e20  d to projection 
+0001fcc0: 6675 6e63 7469 6f6e 2e0d 0a0d 0a20 2020  function.....   
+0001fcd0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+0001fce0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
+0001fcf0: 2020 2020 2020 2049 6d67 4172 7261 790d         ImgArray.
+0001fd00: 0a20 2020 2020 2020 2020 2020 2050 726f  .            Pro
+0001fd10: 6a65 6374 6564 2069 6d61 6765 2e0d 0a20  jected image... 
+0001fd20: 2020 2020 2020 2022 2222 2020 2020 2020         """      
+0001fd30: 2020 0d0a 2020 2020 2020 2020 2320 6465    ..        # de
+0001fd40: 7465 726d 696e 6520 6675 6e63 7469 6f6e  termine function
+0001fd50: 0d0a 2020 2020 2020 2020 6966 206d 6173  ..        if mas
+0001fd60: 6b20 6973 206e 6f74 204e 6f6e 653a 0d0a  k is not None:..
+0001fd70: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0001fd80: 7369 6e73 7461 6e63 6528 6d65 7468 6f64  sinstance(method
+0001fd90: 2c20 7374 7229 3a0d 0a20 2020 2020 2020  , str):..       
+0001fda0: 2020 2020 2020 2020 2066 756e 6320 3d20           func = 
+0001fdb0: 6765 7461 7474 7228 6e70 2e6d 612c 206d  getattr(np.ma, m
+0001fdc0: 6574 686f 6429 0d0a 2020 2020 2020 2020  ethod)..        
+0001fdd0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001fde0: 2020 2020 2020 2020 2020 2066 756e 6320             func 
+0001fdf0: 3d20 6d65 7468 6f64 0d0a 2020 2020 2020  = method..      
+0001fe00: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0001fe10: 2020 2020 2066 756e 6320 3d20 5f63 6865       func = _che
+0001fe20: 636b 5f66 756e 6374 696f 6e28 6d65 7468  ck_function(meth
+0001fe30: 6f64 290d 0a20 2020 2020 2020 200d 0a20  od)..        .. 
+0001fe40: 2020 2020 2020 2069 6620 6178 6973 2069         if axis i
+0001fe50: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0001fe60: 2020 2020 2061 7869 7320 3d20 6669 6e64       axis = find
+0001fe70: 5f66 6972 7374 5f61 7070 6561 7265 6428  _first_appeared(
+0001fe80: 227a 7470 6961 6322 2c20 696e 636c 7564  "ztpiac", includ
+0001fe90: 653d 7365 6c66 2e61 7865 732c 2065 7863  e=self.axes, exc
+0001fea0: 6c75 6465 3d22 7978 2229 0d0a 2020 2020  lude="yx")..    
+0001feb0: 2020 2020 656c 6966 206e 6f74 2068 6173      elif not has
+0001fec0: 6174 7472 2861 7869 732c 2022 5f5f 6974  attr(axis, "__it
+0001fed0: 6572 5f5f 2229 3a0d 0a20 2020 2020 2020  er__"):..       
+0001fee0: 2020 2020 2061 7869 7320 3d20 5b61 7869       axis = [axi
+0001fef0: 735d 0d0a 2020 2020 2020 2020 6178 6973  s]..        axis
+0001ff00: 696e 7420 3d20 7475 706c 6528 7365 6c66  int = tuple(self
+0001ff10: 2e61 7869 736f 6628 6129 2066 6f72 2061  .axisof(a) for a
+0001ff20: 2069 6e20 6178 6973 290d 0a20 2020 2020   in axis)..     
+0001ff30: 2020 2069 6620 6675 6e63 2e5f 5f6d 6f64     if func.__mod
+0001ff40: 756c 655f 5f20 3d3d 2022 6e75 6d70 792e  ule__ == "numpy.
+0001ff50: 6d61 2e63 6f72 6522 3a0d 0a20 2020 2020  ma.core":..     
+0001ff60: 2020 2020 2020 2061 7272 203d 206e 702e         arr = np.
+0001ff70: 6d61 2e61 7272 6179 2873 656c 662e 7661  ma.array(self.va
+0001ff80: 6c75 652c 206d 6173 6b3d 6d61 736b 2c20  lue, mask=mask, 
+0001ff90: 6474 7970 653d 7365 6c66 2e64 7479 7065  dtype=self.dtype
+0001ffa0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0001ffb0: 6620 6675 6e63 2069 7320 6e70 2e6d 612e  f func is np.ma.
+0001ffc0: 6d65 616e 3a0d 0a20 2020 2020 2020 2020  mean:..         
+0001ffd0: 2020 2020 2020 206f 7574 203d 2066 756e         out = fun
+0001ffe0: 6328 6172 722c 2061 7869 733d 6178 6973  c(arr, axis=axis
+0001fff0: 696e 742c 2064 7479 7065 3d6e 702e 666c  int, dtype=np.fl
+00020000: 6f61 7433 322c 202a 2a6b 7761 7267 7329  oat32, **kwargs)
+00020010: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00020020: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00020030: 2020 2020 206f 7574 203d 2066 756e 6328       out = func(
+00020040: 6172 722c 2061 7869 733d 6178 6973 696e  arr, axis=axisin
+00020050: 742c 202a 2a6b 7761 7267 7329 0d0a 2020  t, **kwargs)..  
+00020060: 2020 2020 2020 656c 6966 2066 756e 6320        elif func 
+00020070: 6973 206e 702e 6d65 616e 3a0d 0a20 2020  is np.mean:..   
+00020080: 2020 2020 2020 2020 206f 7574 203d 2066           out = f
+00020090: 756e 6328 7365 6c66 2e76 616c 7565 2c20  unc(self.value, 
+000200a0: 6178 6973 3d61 7869 7369 6e74 2c20 6474  axis=axisint, dt
+000200b0: 7970 653d 6e70 2e66 6c6f 6174 3332 2c20  ype=np.float32, 
+000200c0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+000200d0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000200e0: 2020 2020 2020 6f75 7420 3d20 6675 6e63        out = func
+000200f0: 2873 656c 662e 7661 6c75 652c 2061 7869  (self.value, axi
+00020100: 733d 6178 6973 696e 742c 202a 2a6b 7761  s=axisint, **kwa
+00020110: 7267 7329 0d0a 2020 2020 2020 2020 0d0a  rgs)..        ..
+00020120: 2020 2020 2020 2020 6f75 7420 3d20 6f75          out = ou
+00020130: 742e 7669 6577 2873 656c 662e 5f5f 636c  t.view(self.__cl
+00020140: 6173 735f 5f29 0d0a 2020 2020 2020 2020  ass__)..        
+00020150: 6f75 742e 5f73 6574 5f69 6e66 6f28 7365  out._set_info(se
+00020160: 6c66 2c20 7365 6c66 2e61 7865 732e 6472  lf, self.axes.dr
+00020170: 6f70 2861 7869 7369 6e74 2929 0d0a 2020  op(axisint))..  
+00020180: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+00020190: 0d0a 0d0a 2020 2020 4063 6865 636b 5f69  ....    @check_i
+000201a0: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
+000201b0: 0a20 2020 2064 6566 2063 6c69 7028 7365  .    def clip(se
+000201c0: 6c66 2c20 696e 5f72 616e 6765 3a20 7475  lf, in_range: tu
+000201d0: 706c 655b 696e 7420 7c20 7374 722c 2069  ple[int | str, i
+000201e0: 6e74 207c 2073 7472 5d20 3d20 2822 3025  nt | str] = ("0%
+000201f0: 222c 2022 3130 3025 2229 2920 2d3e 2049  ", "100%")) -> I
+00020200: 6d67 4172 7261 793a 0d0a 2020 2020 2020  mgArray:..      
+00020210: 2020 2222 220d 0a20 2020 2020 2020 2053    """..        S
+00020220: 6174 7572 6174 6520 6c6f 772f 6869 6768  aturate low/high
+00020230: 2069 6e74 656e 7369 7479 2075 7369 6e67   intensity using
+00020240: 206e 702e 636c 6970 2829 2e0d 0a0d 0a20   np.clip()..... 
+00020250: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00020260: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00020270: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2069  -----..        i
+00020280: 6e5f 7261 6e67 6520 3a20 7477 6f20 7363  n_range : two sc
+00020290: 616c 6172 2076 616c 7565 732c 206f 7074  alar values, opt
+000202a0: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
+000202b0: 2020 2072 616e 6765 206f 6620 6c6f 7765     range of lowe
+000202c0: 722f 7570 7065 7220 6c69 6d69 7473 2c20  r/upper limits, 
+000202d0: 6279 2064 6566 6175 6c74 2028 3025 2c20  by default (0%, 
+000202e0: 3130 3025 292e 0d0a 0d0a 2020 2020 2020  100%).....      
+000202f0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+00020300: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+00020310: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
+00020320: 2020 2020 2020 2020 2020 436c 6970 7065            Clippe
+00020330: 6420 696d 6167 6520 7769 7468 2074 656d  d image with tem
+00020340: 706f 7261 6c20 6174 7472 6962 7574 650d  poral attribute.
+00020350: 0a20 2020 2020 2020 2022 2222 2020 2020  .        """    
+00020360: 2020 2020 0d0a 2020 2020 2020 2020 6c6f      ..        lo
+00020370: 7765 726c 696d 2c20 7570 7065 726c 696d  werlim, upperlim
+00020380: 203d 205f 6368 6563 6b5f 636c 6970 5f72   = _check_clip_r
+00020390: 616e 6765 2869 6e5f 7261 6e67 652c 2073  ange(in_range, s
+000203a0: 656c 662e 7661 6c75 6529 0d0a 2020 2020  elf.value)..    
+000203b0: 2020 2020 6f75 7420 3d20 6e70 2e63 6c69      out = np.cli
+000203c0: 7028 7365 6c66 2e76 616c 7565 2c20 6c6f  p(self.value, lo
+000203d0: 7765 726c 696d 2c20 7570 7065 726c 696d  werlim, upperlim
+000203e0: 290d 0a20 2020 2020 2020 206f 7574 203d  )..        out =
+000203f0: 206f 7574 2e76 6965 7728 7365 6c66 2e5f   out.view(self._
+00020400: 5f63 6c61 7373 5f5f 290d 0a20 2020 2020  _class__)..     
+00020410: 2020 2072 6574 7572 6e20 6f75 740d 0a20     return out.. 
+00020420: 2020 200d 0a20 2020 2040 6368 6563 6b5f     ..    @check_
+00020430: 696e 7075 745f 616e 645f 6f75 7470 7574  input_and_output
+00020440: 0d0a 2020 2020 6465 6620 7265 7363 616c  ..    def rescal
+00020450: 655f 696e 7465 6e73 6974 7928 0d0a 2020  e_intensity(..  
+00020460: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
+00020470: 2020 2020 2069 6e5f 7261 6e67 653a 2074       in_range: t
+00020480: 7570 6c65 5b69 6e74 207c 2073 7472 2c20  uple[int | str, 
+00020490: 696e 7420 7c20 7374 725d 203d 2028 2230  int | str] = ("0
+000204a0: 2522 2c20 2231 3030 2522 292c 200d 0a20  %", "100%"), .. 
+000204b0: 2020 2020 2020 2064 7479 7065 203d 206e         dtype = n
+000204c0: 702e 7569 6e74 3136 0d0a 2020 2020 2920  p.uint16..    ) 
+000204d0: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
+000204e0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+000204f0: 2020 2052 6573 6361 6c65 2074 6865 2069     Rescale the i
+00020500: 6e74 656e 7369 7479 206f 6620 7468 6520  ntensity of the 
+00020510: 696d 6167 6520 7573 696e 6720 736b 696d  image using skim
+00020520: 6167 652e 6578 706f 7375 7265 2e72 6573  age.exposure.res
+00020530: 6361 6c65 5f69 6e74 656e 7369 7479 2829  cale_intensity()
+00020540: 2e0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
+00020550: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
+00020560: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+00020570: 2020 2020 2069 6e5f 7261 6e67 6520 3a20       in_range : 
+00020580: 7477 6f20 7363 616c 6172 2076 616c 7565  two scalar value
+00020590: 732c 2064 6566 6175 6c74 2069 7320 2830  s, default is (0
+000205a0: 252c 2031 3030 2529 0d0a 2020 2020 2020  %, 100%)..      
+000205b0: 2020 2020 2020 5261 6e67 6520 6f66 206c        Range of l
+000205c0: 6f77 6572 2f75 7070 6572 206c 696d 6974  ower/upper limit
+000205d0: 2e0d 0a20 2020 2020 2020 2064 7479 7065  ...        dtype
+000205e0: 203a 206e 756d 7079 2064 7479 7065 2c20   : numpy dtype, 
+000205f0: 6465 6661 756c 7420 6973 206e 702e 7569  default is np.ui
+00020600: 6e74 3136 0d0a 2020 2020 2020 2020 2020  nt16..          
+00020610: 2020 4f75 7470 7574 2064 7479 7065 2e0d    Output dtype..
+00020620: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00020630: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
+00020640: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
+00020650: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
+00020660: 2020 2052 6573 6361 6c65 6420 696d 6167     Rescaled imag
+00020670: 6520 7769 7468 2074 656d 706f 7261 6c20  e with temporal 
+00020680: 6174 7472 6962 7574 650d 0a20 2020 2020  attribute..     
+00020690: 2020 2022 2222 2020 2020 2020 2020 0d0a     """        ..
+000206a0: 2020 2020 2020 2020 6f75 7420 3d20 7365          out = se
+000206b0: 6c66 2e76 6965 7728 6e70 2e6e 6461 7272  lf.view(np.ndarr
+000206c0: 6179 292e 6173 7479 7065 286e 702e 666c  ay).astype(np.fl
+000206d0: 6f61 7433 3229 0d0a 2020 2020 2020 2020  oat32)..        
+000206e0: 6c6f 7765 726c 696d 2c20 7570 7065 726c  lowerlim, upperl
+000206f0: 696d 203d 205f 6368 6563 6b5f 636c 6970  im = _check_clip
+00020700: 5f72 616e 6765 2869 6e5f 7261 6e67 652c  _range(in_range,
+00020710: 2073 656c 662e 7661 6c75 6529 0d0a 2020   self.value)..  
+00020720: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00020730: 2020 2020 6f75 7420 3d20 736b 6578 702e      out = skexp.
+00020740: 7265 7363 616c 655f 696e 7465 6e73 6974  rescale_intensit
+00020750: 7928 6f75 742c 2069 6e5f 7261 6e67 653d  y(out, in_range=
+00020760: 286c 6f77 6572 6c69 6d2c 2075 7070 6572  (lowerlim, upper
+00020770: 6c69 6d29 2c20 6f75 745f 7261 6e67 653d  lim), out_range=
+00020780: 2264 7479 7065 2229 0d0a 2020 2020 2020  "dtype")..      
+00020790: 2020 0d0a 2020 2020 2020 2020 6f75 7420    ..        out 
+000207a0: 3d20 6f75 742e 7669 6577 2873 656c 662e  = out.view(self.
+000207b0: 5f5f 636c 6173 735f 5f29 0d0a 2020 2020  __class__)..    
+000207c0: 2020 2020 7265 7475 726e 206f 7574 0d0a      return out..
+000207d0: 2020 2020 0d0a 2020 2020 4063 6865 636b      ..    @check
+000207e0: 5f69 6e70 7574 5f61 6e64 5f6f 7574 7075  _input_and_outpu
+000207f0: 740d 0a20 2020 2064 6566 2074 7261 636b  t..    def track
+00020800: 5f64 7269 6674 280d 0a20 2020 2020 2020  _drift(..       
+00020810: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+00020820: 616c 6f6e 673a 2041 7869 734c 696b 6520  along: AxisLike 
+00020830: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0d0a  | None = None,..
+00020840: 2020 2020 2020 2020 7368 6f77 5f64 7269          show_dri
+00020850: 6674 3a20 626f 6f6c 203d 2046 616c 7365  ft: bool = False
+00020860: 2c20 0d0a 2020 2020 2020 2020 7570 7361  , ..        upsa
+00020870: 6d70 6c65 5f66 6163 746f 723a 2069 6e74  mple_factor: int
+00020880: 203d 2031 302c 0d0a 2020 2020 2920 2d3e   = 10,..    ) ->
+00020890: 204d 6172 6b65 7246 7261 6d65 3a0d 0a20   MarkerFrame:.. 
+000208a0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000208b0: 2020 2020 4361 6c63 756c 6174 6520 7978      Calculate yx
+000208c0: 2d64 6972 6563 7469 6f6e 616c 2064 7269  -directional dri
+000208d0: 6674 2075 7369 6e67 2074 6865 206d 6574  ft using the met
+000208e0: 686f 6420 6571 7569 7661 6c65 6e74 2074  hod equivalent t
+000208f0: 6f0d 0a20 2020 2020 2020 2060 6073 6b69  o..        ``ski
+00020900: 6d61 6765 2e72 6567 6973 7472 6174 696f  mage.registratio
+00020910: 6e2e 7068 6173 655f 6372 6f73 735f 636f  n.phase_cross_co
+00020920: 7272 656c 6174 696f 6e60 602e 0d0a 0d0a  rrelation``.....
+00020930: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00020940: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
+00020950: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
+00020960: 616c 6f6e 6720 3a20 4178 6973 4c69 6b65  along : AxisLike
+00020970: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+00020980: 2020 2020 2020 2020 416c 6f6e 6720 7768          Along wh
+00020990: 6963 6820 6178 6973 2064 7269 6674 2077  ich axis drift w
+000209a0: 696c 6c20 6265 2063 616c 6375 6c61 7465  ill be calculate
+000209b0: 642e 0d0a 2020 2020 2020 2020 7368 6f77  d...        show
+000209c0: 5f64 7269 6674 203a 2062 6f6f 6c2c 2064  _drift : bool, d
+000209d0: 6566 6175 6c74 2069 7320 4661 6c73 650d  efault is False.
+000209e0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+000209f0: 5472 7565 2c20 706c 6f74 2074 6865 2072  True, plot the r
+00020a00: 6573 756c 742e 0d0a 2020 2020 2020 2020  esult...        
+00020a10: 7570 7361 6d70 6c65 5f66 6163 746f 7220  upsample_factor 
+00020a20: 3a20 696e 742c 2064 6566 6175 6c74 2069  : int, default i
+00020a30: 7320 3130 0d0a 2020 2020 2020 2020 2020  s 10..          
+00020a40: 2020 5570 2d73 616d 706c 696e 6720 6661    Up-sampling fa
+00020a50: 6374 6f72 2077 6865 6e20 6361 6c63 756c  ctor when calcul
+00020a60: 6174 696e 6720 7068 6173 6520 6372 6f73  ating phase cros
+00020a70: 7320 636f 7272 656c 6174 696f 6e2e 0d0a  s correlation...
+00020a80: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00020a90: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
+00020aa0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0d0a         -------..
+00020ab0: 2020 2020 2020 2020 4d61 726b 6572 4672          MarkerFr
+00020ac0: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
+00020ad0: 2044 6174 6146 7261 6d65 2073 7472 7563   DataFrame struc
+00020ae0: 7475 7265 2077 6974 6820 782c 7920 636f  ture with x,y co
+00020af0: 6c75 6d6e 730d 0a20 2020 2020 2020 2022  lumns..        "
+00020b00: 2222 2020 2020 2020 2020 0d0a 2020 2020  ""        ..    
+00020b10: 2020 2020 6672 6f6d 202e 2e66 7261 6d65      from ..frame
+00020b20: 2069 6d70 6f72 7420 4d61 726b 6572 4672   import MarkerFr
+00020b30: 616d 650d 0a20 2020 2020 2020 200d 0a20  ame..        .. 
+00020b40: 2020 2020 2020 2069 6620 616c 6f6e 6720         if along 
+00020b50: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00020b60: 2020 2020 2020 616c 6f6e 6720 3d20 6669        along = fi
+00020b70: 6e64 5f66 6972 7374 5f61 7070 6561 7265  nd_first_appeare
+00020b80: 6428 2274 707a 6369 6122 2c20 696e 636c  d("tpzcia", incl
+00020b90: 7564 653d 7365 6c66 2e61 7865 7329 0d0a  ude=self.axes)..
+00020ba0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+00020bb0: 2861 6c6f 6e67 2920 213d 2031 3a0d 0a20  (along) != 1:.. 
+00020bc0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00020bd0: 2056 616c 7565 4572 726f 7228 2260 616c   ValueError("`al
+00020be0: 6f6e 6760 206d 7573 7420 6265 2073 696e  ong` must be sin
+00020bf0: 676c 6520 6368 6172 6163 7465 722e 2229  gle character.")
+00020c00: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00020c10: 2069 7369 6e73 7461 6e63 6528 7570 7361   isinstance(upsa
+00020c20: 6d70 6c65 5f66 6163 746f 722c 2069 6e74  mple_factor, int
+00020c30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00020c40: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00020c50: 6622 7570 7361 6d70 6c65 2d66 6163 746f  f"upsample-facto
+00020c60: 7220 6d75 7374 2062 6520 696e 7465 6765  r must be intege
+00020c70: 7220 6275 7420 676f 7420 7b74 7970 6528  r but got {type(
+00020c80: 7570 7361 6d70 6c65 5f66 6163 746f 7229  upsample_factor)
+00020c90: 7d22 290d 0a20 2020 2020 2020 2020 2020  }")..           
+00020ca0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00020cb0: 2020 2072 6573 756c 7420 3d20 6e70 2e7a     result = np.z
+00020cc0: 6572 6f73 2828 7365 6c66 2e73 697a 656f  eros((self.sizeo
+00020cd0: 6628 616c 6f6e 6729 2c20 7365 6c66 2e6e  f(along), self.n
+00020ce0: 6469 6d2d 3129 2c20 6474 7970 653d 6e70  dim-1), dtype=np
+00020cf0: 2e66 6c6f 6174 3332 290d 0a20 2020 2020  .float32)..     
+00020d00: 2020 2063 5f61 7865 7320 3d20 636f 6d70     c_axes = comp
+00020d10: 6c65 6d65 6e74 5f61 7865 7328 616c 6f6e  lement_axes(alon
+00020d20: 672c 2073 656c 662e 6178 6573 290d 0a20  g, self.axes).. 
+00020d30: 2020 2020 2020 206c 6173 745f 696d 6720         last_img 
+00020d40: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+00020d50: 696d 675f 6666 7420 3d20 7365 6c66 2e66  img_fft = self.f
+00020d60: 6674 2873 6869 6674 3d46 616c 7365 2c20  ft(shift=False, 
+00020d70: 6469 6d73 3d63 5f61 7865 7329 0d0a 2020  dims=c_axes)..  
+00020d80: 2020 2020 2020 666f 7220 692c 2028 5f2c        for i, (_,
+00020d90: 2069 6d67 2920 696e 2065 6e75 6d65 7261   img) in enumera
+00020da0: 7465 2869 6d67 5f66 6674 2e69 7465 7228  te(img_fft.iter(
+00020db0: 616c 6f6e 6729 293a 0d0a 2020 2020 2020  along)):..      
+00020dc0: 2020 2020 2020 696d 6720 3d20 7870 2e61        img = xp.a
+00020dd0: 7361 7272 6179 2869 6d67 290d 0a20 2020  sarray(img)..   
+00020de0: 2020 2020 2020 2020 2069 6620 6c61 7374           if last
+00020df0: 5f69 6d67 2069 7320 6e6f 7420 4e6f 6e65  _img is not None
+00020e00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00020e10: 2020 2072 6573 756c 745b 695d 203d 2078     result[i] = x
+00020e20: 702e 6173 6e75 6d70 7928 0d0a 2020 2020  p.asnumpy(..    
+00020e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e40: 5f63 6f72 722e 7375 6270 6978 656c 5f70  _corr.subpixel_p
+00020e50: 6363 286c 6173 745f 696d 672c 2069 6d67  cc(last_img, img
+00020e60: 2c20 7570 7361 6d70 6c65 5f66 6163 746f  , upsample_facto
+00020e70: 723d 7570 7361 6d70 6c65 5f66 6163 746f  r=upsample_facto
+00020e80: 7229 5b30 5d0d 0a20 2020 2020 2020 2020  r)[0]..         
+00020e90: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00020ea0: 2020 2020 2020 2020 2020 6c61 7374 5f69            last_i
+00020eb0: 6d67 203d 2069 6d67 0d0a 2020 2020 2020  mg = img..      
+00020ec0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00020ed0: 2020 2020 2020 2020 2020 2020 206c 6173               las
+00020ee0: 745f 696d 6720 3d20 696d 670d 0a20 2020  t_img = img..   
+00020ef0: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+00020f00: 6573 756c 7420 3d20 4d61 726b 6572 4672  esult = MarkerFr
+00020f10: 616d 6528 6e70 2e63 756d 7375 6d28 7265  ame(np.cumsum(re
+00020f20: 7375 6c74 2c20 6178 6973 3d30 292c 2063  sult, axis=0), c
+00020f30: 6f6c 756d 6e73 3d63 5f61 7865 7329 0d0a  olumns=c_axes)..
+00020f40: 2020 2020 2020 2020 6966 2073 686f 775f          if show_
+00020f50: 6472 6966 743a 0d0a 2020 2020 2020 2020  drift:..        
+00020f60: 2020 2020 6672 6f6d 202e 5f75 7469 6c73      from ._utils
+00020f70: 2069 6d70 6f72 7420 5f70 6c6f 7420 6173   import _plot as
+00020f80: 205f 706c 740d 0a20 2020 2020 2020 2020   _plt..         
+00020f90: 2020 205f 706c 742e 706c 6f74 5f64 7269     _plt.plot_dri
+00020fa0: 6674 2872 6573 756c 7429 0d0a 2020 2020  ft(result)..    
+00020fb0: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+00020fc0: 7375 6c74 2e69 6e64 6578 2e6e 616d 6520  sult.index.name 
+00020fd0: 3d20 7374 7228 616c 6f6e 6729 0d0a 2020  = str(along)..  
+00020fe0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+00020ff0: 756c 740d 0a20 2020 200d 0a20 2020 2040  ult..    ..    @
+00021000: 5f64 6f63 732e 7772 6974 655f 646f 6373  _docs.write_docs
+00021010: 0d0a 2020 2020 4064 696d 735f 746f 5f73  ..    @dims_to_s
+00021020: 7061 7469 616c 5f61 7865 730d 0a20 2020  patial_axes..   
+00021030: 2040 7361 6d65 5f64 7479 7065 2861 7366   @same_dtype(asf
+00021040: 6c6f 6174 3d54 7275 6529 0d0a 2020 2020  loat=True)..    
+00021050: 4063 6865 636b 5f69 6e70 7574 5f61 6e64  @check_input_and
+00021060: 5f6f 7574 7075 740d 0a20 2020 2064 6566  _output..    def
+00021070: 2064 7269 6674 5f63 6f72 7265 6374 696f   drift_correctio
+00021080: 6e28 0d0a 2020 2020 2020 2020 7365 6c66  n(..        self
+00021090: 2c0d 0a20 2020 2020 2020 2073 6869 6674  ,..        shift
+000210a0: 3a20 436f 6f72 6473 203d 204e 6f6e 652c  : Coords = None,
+000210b0: 0d0a 2020 2020 2020 2020 7265 663a 2049  ..        ref: I
+000210c0: 6d67 4172 7261 7920 3d20 4e6f 6e65 2c0d  mgArray = None,.
+000210d0: 0a20 2020 2020 2020 202a 2c0d 0a20 2020  .        *,..   
+000210e0: 2020 2020 207a 6572 6f5f 6176 653a 2062       zero_ave: b
+000210f0: 6f6f 6c20 3d20 5472 7565 2c0d 0a20 2020  ool = True,..   
+00021100: 2020 2020 2061 6c6f 6e67 3a20 4178 6973       along: Axis
+00021110: 4c69 6b65 207c 204e 6f6e 6520 3d20 4e6f  Like | None = No
+00021120: 6e65 2c0d 0a20 2020 2020 2020 206f 7264  ne,..        ord
+00021130: 6572 3a20 696e 7420 3d20 312c 0d0a 2020  er: int = 1,..  
+00021140: 2020 2020 2020 6d6f 6465 3a20 7374 7220        mode: str 
+00021150: 3d20 2263 6f6e 7374 616e 7422 2c0d 0a20  = "constant",.. 
+00021160: 2020 2020 2020 2063 7661 6c3a 2066 6c6f         cval: flo
+00021170: 6174 203d 2030 2c0d 0a20 2020 2020 2020  at = 0,..       
+00021180: 2064 696d 733a 2044 696d 7320 3d20 322c   dims: Dims = 2,
+00021190: 0d0a 2020 2020 2020 2020 7570 6461 7465  ..        update
+000211a0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0d  : bool = False,.
+000211b0: 0a20 2020 2029 202d 3e20 496d 6741 7272  .    ) -> ImgArr
+000211c0: 6179 3a0d 0a20 2020 2020 2020 2022 2222  ay:..        """
+000211d0: 0d0a 2020 2020 2020 2020 4472 6966 7420  ..        Drift 
+000211e0: 636f 7272 6563 7469 6f6e 2075 7369 6e67  correction using
+000211f0: 2069 7465 7261 7469 7665 2041 6666 696e   iterative Affin
+00021200: 6520 7472 616e 736c 6174 696f 6e2e 2049  e translation. I
+00021210: 6620 7472 616e 736c 6174 696f 6e20 7665  f translation ve
+00021220: 6374 6f72 7320 6060 7368 6966 7460 600d  ctors ``shift``.
+00021230: 0a20 2020 2020 2020 2069 7320 6e6f 7420  .        is not 
+00021240: 6769 7665 6e2c 2074 6865 6e20 6974 2077  given, then it w
+00021250: 696c 6c20 6265 2064 6574 6572 6d69 6e65  ill be determine
+00021260: 6420 7573 696e 6720 6060 7472 6163 6b5f  d using ``track_
+00021270: 6472 6966 7460 6020 6d65 7468 6f64 206f  drift`` method o
+00021280: 6620 496d 6741 7272 6179 2e0d 0a0d 0a20  f ImgArray..... 
+00021290: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+000212a0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000212b0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2073  -----..        s
+000212c0: 6869 6674 203a 2044 6174 6146 7261 6d65  hift : DataFrame
+000212d0: 206f 7220 284e 2c20 4429 2061 7272 6179   or (N, D) array
+000212e0: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+000212f0: 2020 2020 2020 2020 5472 616e 736c 6174          Translat
+00021300: 696f 6e20 7665 6374 6f72 732e 2049 6620  ion vectors. If 
+00021310: 4461 7461 4672 616d 652c 2069 7420 6d75  DataFrame, it mu
+00021320: 7374 2068 6176 6520 636f 6c75 6d6e 7320  st have columns 
+00021330: 6e61 6d65 6420 7769 7468 2061 6c6c 2074  named with all t
+00021340: 6865 2073 796d 626f 6c73 0d0a 2020 2020  he symbols..    
+00021350: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
+00021360: 6420 696e 2060 6064 696d 7360 602e 0d0a  d in ``dims``...
+00021370: 2020 2020 2020 2020 7265 6620 3a20 496d          ref : Im
+00021380: 6741 7272 6179 2c20 6f70 7469 6f6e 616c  gArray, optional
+00021390: 0d0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
+000213a0: 6520 7265 6665 7265 6e63 6520 6e2d 4420  e reference n-D 
+000213b0: 696d 6167 6520 746f 2064 6574 6572 6d69  image to determi
+000213c0: 6e65 2064 7269 6674 2c20 6966 2060 6073  ne drift, if ``s
+000213d0: 6869 6674 6060 2077 6173 206e 6f74 2067  hift`` was not g
+000213e0: 6976 656e 2e0d 0a20 2020 2020 2020 207a  iven...        z
+000213f0: 6572 6f5f 6176 6520 3a20 626f 6f6c 2c20  ero_ave : bool, 
+00021400: 6465 6661 756c 7420 6973 2054 7275 650d  default is True.
+00021410: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00021420: 5472 7565 2c20 6176 6572 6167 6520 7368  True, average sh
+00021430: 6966 7420 7769 6c6c 2062 6520 7a65 726f  ift will be zero
+00021440: 2e0d 0a20 2020 2020 2020 2061 6c6f 6e67  ...        along
+00021450: 203a 2041 7869 734c 696b 652c 206f 7074   : AxisLike, opt
+00021460: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
+00021470: 2020 2041 6c6f 6e67 2077 6869 6368 2061     Along which a
+00021480: 7869 7320 6472 6966 7420 7769 6c6c 2062  xis drift will b
+00021490: 6520 636f 7272 6563 7465 642e 0d0a 2020  e corrected...  
+000214a0: 2020 2020 2020 7b64 696d 737d 7b75 7064        {dims}{upd
+000214b0: 6174 657d 0d0a 2020 2020 2020 2020 6166  ate}..        af
+000214c0: 6669 6e65 5f6b 7761 7267 7320 3a0d 0a20  fine_kwargs :.. 
+000214d0: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
+000214e0: 7264 2061 7267 756d 656e 7473 2074 6861  rd arguments tha
+000214f0: 7420 7769 6c6c 2062 6520 7061 7373 6564  t will be passed
+00021500: 2074 6f20 6060 7761 7270 6060 2e0d 0a0d   to ``warp``....
+00021510: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00021520: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+00021530: 2d0d 0a20 2020 2020 2020 2049 6d67 4172  -..        ImgAr
+00021540: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
+00021550: 2043 6f72 7265 6374 6564 2069 6d61 6765   Corrected image
+00021560: 2e0d 0a20 2020 2020 2020 2020 2020 200d  ...            .
+00021570: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+00021580: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00021590: 2d2d 2d0d 0a20 2020 2020 2020 2044 7269  ---..        Dri
+000215a0: 6674 2063 6f72 7265 6374 696f 6e20 6f66  ft correction of
+000215b0: 206d 756c 7469 6368 616e 6e65 6c20 696d   multichannel im
+000215c0: 6167 6520 7573 696e 6720 7468 6520 6669  age using the fi
+000215d0: 7273 7420 6368 616e 6e65 6c20 6173 2074  rst channel as t
+000215e0: 6865 2072 6566 6572 656e 6365 2e0d 0a20  he reference... 
+000215f0: 2020 2020 2020 2020 2020 203e 3e3e 2069             >>> i
+00021600: 6d67 2e64 7269 6674 5f63 6f72 7265 6374  mg.drift_correct
+00021610: 696f 6e28 7265 663d 696d 675b 2263 3d30  ion(ref=img["c=0
+00021620: 225d 290d 0a20 2020 2020 2020 2022 2222  "])..        """
+00021630: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00021640: 2020 0d0a 2020 2020 2020 2020 6966 2061    ..        if a
+00021650: 6c6f 6e67 2069 7320 4e6f 6e65 3a0d 0a20  long is None:.. 
+00021660: 2020 2020 2020 2020 2020 2061 6c6f 6e67             along
+00021670: 203d 2066 696e 645f 6669 7273 745f 6170   = find_first_ap
+00021680: 7065 6172 6564 2822 7470 7a63 6961 222c  peared("tpzcia",
+00021690: 2069 6e63 6c75 6465 3d73 656c 662e 6178   include=self.ax
+000216a0: 6573 2c20 6578 636c 7564 653d 6469 6d73  es, exclude=dims
+000216b0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+000216c0: 6c65 6e28 616c 6f6e 6729 2021 3d20 313a  len(along) != 1:
+000216d0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+000216e0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+000216f0: 6061 6c6f 6e67 6020 6d75 7374 2062 6520  `along` must be 
+00021700: 7369 6e67 6c65 2063 6861 7261 6374 6572  single character
+00021710: 2e22 290d 0a20 2020 2020 2020 200d 0a20  .")..        .. 
+00021720: 2020 2020 2020 2069 6620 7368 6966 7420         if shift 
+00021730: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00021740: 2020 2020 2020 2320 6465 7465 726d 696e        # determin
+00021750: 6520 2772 6566 270d 0a20 2020 2020 2020  e 'ref'..       
+00021760: 2020 2020 2069 6620 7265 6620 6973 204e       if ref is N
+00021770: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00021780: 2020 2020 2020 7265 6620 3d20 7365 6c66        ref = self
+00021790: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000217a0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+000217b0: 6528 7265 662c 2049 6d67 4172 7261 7929  e(ref, ImgArray)
+000217c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000217d0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+000217e0: 6f72 2866 2227 7265 6627 206d 7573 7420  or(f"'ref' must 
+000217f0: 6265 2061 6e20 496d 6741 7272 6179 206f  be an ImgArray o
+00021800: 626a 6563 742c 2062 7574 2067 6f74 207b  bject, but got {
+00021810: 7479 7065 2872 6566 297d 2229 0d0a 2020  type(ref)}")..  
+00021820: 2020 2020 2020 2020 2020 6966 2072 6566            if ref
+00021830: 2e61 7865 7320 213d 205b 616c 6f6e 675d  .axes != [along]
+00021840: 202b 2064 696d 733a 0d0a 2020 2020 2020   + dims:..      
+00021850: 2020 2020 2020 2020 2020 6672 6f6d 2069            from i
+00021860: 7465 7274 6f6f 6c73 2069 6d70 6f72 7420  tertools import 
+00021870: 7072 6f64 7563 740d 0a20 2020 2020 2020  product..       
+00021880: 2020 2020 2020 2020 205f 635f 6178 6573           _c_axes
+00021890: 203d 2063 6f6d 706c 656d 656e 745f 6178   = complement_ax
+000218a0: 6573 285b 616c 6f6e 675d 202b 2064 696d  es([along] + dim
+000218b0: 732c 2073 7472 2872 6566 2e61 7865 7329  s, str(ref.axes)
+000218c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000218d0: 2020 2066 6d74 203d 2073 6c69 6365 722e     fmt = slicer.
+000218e0: 6765 745f 666f 726d 6174 7465 7228 5f63  get_formatter(_c
+000218f0: 5f61 7865 7329 0d0a 2020 2020 2020 2020  _axes)..        
+00021900: 2020 2020 2020 2020 6f75 7420 3d20 6e70          out = np
+00021910: 2e65 6d70 7479 5f6c 696b 6528 7365 6c66  .empty_like(self
+00021920: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00021930: 2020 2066 6f72 2069 6478 2069 6e20 7072     for idx in pr
+00021940: 6f64 7563 7428 2a28 7261 6e67 6528 7265  oduct(*(range(re
+00021950: 662e 7369 7a65 6f66 2861 2929 2066 6f72  f.sizeof(a)) for
+00021960: 2061 2069 6e20 5f63 5f61 7865 7329 293a   a in _c_axes)):
+00021970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021980: 2020 2020 2020 736c 203d 2066 6d74 5b69        sl = fmt[i
+00021990: 6478 5d0d 0a20 2020 2020 2020 2020 2020  dx]..           
+000219a0: 2020 2020 2020 2020 206f 7574 5b73 6c5d           out[sl]
+000219b0: 203d 2073 656c 665b 736c 5d2e 6472 6966   = self[sl].drif
+000219c0: 745f 636f 7272 6563 7469 6f6e 280d 0a20  t_correction(.. 
+000219d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219e0: 2020 2020 2020 2072 6566 3d72 6566 5b73         ref=ref[s
+000219f0: 6c5d 2c20 7a65 726f 5f61 7665 3d7a 6572  l], zero_ave=zer
+00021a00: 6f5f 6176 652c 2061 6c6f 6e67 3d61 6c6f  o_ave, along=alo
+00021a10: 6e67 2c20 6469 6d73 3d64 696d 732c 0d0a  ng, dims=dims,..
+00021a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a30: 2020 2020 2020 2020 7570 6461 7465 3d75          update=u
+00021a40: 7064 6174 652c 206f 7264 6572 3d6f 7264  pdate, order=ord
+00021a50: 6572 2c20 6d6f 6465 3d6d 6f64 652c 2063  er, mode=mode, c
+00021a60: 7661 6c3d 6376 616c 2c0d 0a20 2020 2020  val=cval,..     
+00021a70: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00021a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021a90: 2020 7265 7475 726e 206f 7574 0d0a 0d0a    return out....
+00021aa0: 2020 2020 2020 2020 2020 2020 7368 6966              shif
+00021ab0: 7420 3d20 7265 662e 7472 6163 6b5f 6472  t = ref.track_dr
+00021ac0: 6966 7428 616c 6f6e 673d 616c 6f6e 6729  ift(along=along)
+00021ad0: 2e76 616c 7565 730d 0a20 2020 2020 2020  .values..       
+00021ae0: 2020 2020 200d 0a20 2020 2020 2020 2065       ..        e
+00021af0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00021b00: 2020 7368 6966 7420 3d20 6e70 2e61 7361    shift = np.asa
+00021b10: 7272 6179 2873 6869 6674 2c20 6474 7970  rray(shift, dtyp
+00021b20: 653d 6e70 2e66 6c6f 6174 3332 290d 0a20  e=np.float32).. 
+00021b30: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+00021b40: 656c 662e 7369 7a65 6f66 2861 6c6f 6e67  elf.sizeof(along
+00021b50: 292c 2073 656c 662e 6e64 696d 2920 213d  ), self.ndim) !=
+00021b60: 2073 6869 6674 2e73 6861 7065 3a0d 0a20   shift.shape:.. 
+00021b70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00021b80: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00021b90: 2257 726f 6e67 2073 6861 7065 206f 6620  "Wrong shape of 
+00021ba0: 6073 6869 6674 602e 2229 0d0a 0d0a 2020  `shift`.")....  
+00021bb0: 2020 2020 2020 6966 207a 6572 6f5f 6176        if zero_av
+00021bc0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00021bd0: 7368 6966 7420 3d20 7368 6966 7420 2d20  shift = shift - 
+00021be0: 6e70 2e6d 6561 6e28 7368 6966 742c 2061  np.mean(shift, a
+00021bf0: 7869 733d 3029 0d0a 2020 2020 2020 2020  xis=0)..        
+00021c00: 2020 2020 0d0a 2020 2020 2020 2020 6f75      ..        ou
+00021c10: 7420 3d20 7870 2e65 6d70 7479 2873 656c  t = xp.empty(sel
+00021c20: 662e 7368 6170 6529 0d0a 2020 2020 2020  f.shape)..      
+00021c30: 2020 745f 696e 6465 7820 3d20 7365 6c66    t_index = self
+00021c40: 2e61 7869 736f 6628 616c 6f6e 6729 0d0a  .axisof(along)..
+00021c50: 2020 2020 2020 2020 6e64 696d 203d 206c          ndim = l
+00021c60: 656e 2864 696d 7329 0d0a 2020 2020 2020  en(dims)..      
+00021c70: 2020 6d78 203d 206e 702e 6579 6528 6e64    mx = np.eye(nd
+00021c80: 696d 202b 2031 2c20 6474 7970 653d 6e70  im + 1, dtype=np
+00021c90: 2e66 6c6f 6174 3332 2920 2320 4166 6669  .float32) # Affi
+00021ca0: 6e65 2074 7261 6e73 666f 726d 6174 696f  ne transformatio
+00021cb0: 6e20 6d61 7472 6978 0d0a 2020 2020 2020  n matrix..      
+00021cc0: 2020 696e 7075 745f 696d 6720 3d20 7365    input_img = se
+00021cd0: 6c66 2e73 706c 696e 655f 6669 6c74 6572  lf.spline_filter
+00021ce0: 286d 6f64 653d 6d6f 6465 2c20 6f72 6465  (mode=mode, orde
+00021cf0: 723d 6f72 6465 7229 0d0a 2020 2020 2020  r=order)..      
+00021d00: 2020 666f 7220 736c 2c20 696d 6720 696e    for sl, img in
+00021d10: 2069 6e70 7574 5f69 6d67 2e69 7465 7228   input_img.iter(
+00021d20: 636f 6d70 6c65 6d65 6e74 5f61 7865 7328  complement_axes(
+00021d30: 6469 6d73 2c20 7365 6c66 2e61 7865 7329  dims, self.axes)
+00021d40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00021d50: 6d78 5b3a 2d31 2c20 2d31 5d20 3d20 2d73  mx[:-1, -1] = -s
+00021d60: 6869 6674 5b73 6c5b 745f 696e 6465 785d  hift[sl[t_index]
+00021d70: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
+00021d80: 7574 5b73 6c5d 203d 205f 7472 616e 7366  ut[sl] = _transf
+00021d90: 6f72 6d2e 7761 7270 2869 6d67 2c20 6d78  orm.warp(img, mx
+00021da0: 2c20 6d6f 6465 3d6d 6f64 652c 2063 7661  , mode=mode, cva
+00021db0: 6c3d 6376 616c 2c20 6f72 6465 723d 6f72  l=cval, order=or
+00021dc0: 6465 722c 2070 7265 6669 6c74 6572 3d46  der, prefilter=F
+00021dd0: 616c 7365 290d 0a20 2020 2020 2020 200d  alse)..        .
+00021de0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00021df0: 6f75 740d 0a0d 0a20 2020 2040 5f64 6f63  out....    @_doc
+00021e00: 732e 7772 6974 655f 646f 6373 0d0a 2020  s.write_docs..  
+00021e10: 2020 4064 696d 735f 746f 5f73 7061 7469    @dims_to_spati
+00021e20: 616c 5f61 7865 730d 0a20 2020 2040 6368  al_axes..    @ch
+00021e30: 6563 6b5f 696e 7075 745f 616e 645f 6f75  eck_input_and_ou
+00021e40: 7470 7574 0d0a 2020 2020 6465 6620 6573  tput..    def es
+00021e50: 7469 6d61 7465 5f73 6967 6d61 2873 656c  timate_sigma(sel
+00021e60: 662c 202a 2c20 7371 7565 657a 653a 2062  f, *, squeeze: b
+00021e70: 6f6f 6c20 3d20 5472 7565 2c20 6469 6d73  ool = True, dims
+00021e80: 3a20 4469 6d73 203d 204e 6f6e 6529 202d  : Dims = None) -
+00021e90: 3e20 5072 6f70 4172 7261 7920 7c20 666c  > PropArray | fl
+00021ea0: 6f61 743a 0d0a 2020 2020 2020 2020 2222  oat:..        ""
+00021eb0: 220d 0a20 2020 2020 2020 2057 6176 656c  "..        Wavel
+00021ec0: 6574 2d62 6173 6564 2065 7374 696d 6174  et-based estimat
+00021ed0: 696f 6e20 6f66 2047 6175 7373 6961 6e20  ion of Gaussian 
+00021ee0: 6e6f 6973 652e 0d0a 0d0a 2020 2020 2020  noise.....      
+00021ef0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00021f00: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00021f10: 0d0a 2020 2020 2020 2020 7371 7565 657a  ..        squeez
+00021f20: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
+00021f30: 7420 6973 2054 7275 650d 0a20 2020 2020  t is True..     
+00021f40: 2020 2020 2020 2049 6620 5472 7565 2061         If True a
+00021f50: 6e64 206f 7574 7075 7420 6361 6e20 6265  nd output can be
+00021f60: 2063 6f6e 7665 7274 6564 2074 6f20 6120   converted to a 
+00021f70: 7363 616c 6172 2c20 7468 656e 2063 6f6e  scalar, then con
+00021f80: 7665 7274 2069 742e 0d0a 2020 2020 2020  vert it...      
+00021f90: 2020 7b64 696d 737d 0d0a 0d0a 2020 2020    {dims}....    
+00021fa0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00021fb0: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
+00021fc0: 2020 2020 2020 5072 6f70 4172 7261 7920        PropArray 
+00021fd0: 6f72 2066 6c6f 6174 0d0a 2020 2020 2020  or float..      
+00021fe0: 2020 2020 2020 4573 7469 6d61 7465 6420        Estimated 
+00021ff0: 7374 616e 6461 7264 2064 6576 6961 7469  standard deviati
+00022000: 6f6e 2e20 7369 676d 615b 2274 3d30 3b63  on. sigma["t=0;c
+00022010: 3d31 225d 206d 6561 6e73 2074 6865 2065  =1"] means the e
+00022020: 7374 696d 6174 6564 2076 616c 7565 206f  stimated value o
+00022030: 660d 0a20 2020 2020 2020 2020 2020 2069  f..            i
+00022040: 6d61 6765 2073 6c69 6365 2061 7420 743d  mage slice at t=
+00022050: 3020 616e 6420 633d 312e 0d0a 2020 2020  0 and c=1...    
+00022060: 2020 2020 2222 2220 2020 2020 2020 200d      """        .
+00022070: 0a20 2020 2020 2020 2063 5f61 7865 7320  .        c_axes 
+00022080: 3d20 636f 6d70 6c65 6d65 6e74 5f61 7865  = complement_axe
+00022090: 7328 6469 6d73 2c20 7365 6c66 2e61 7865  s(dims, self.axe
+000220a0: 7329 0d0a 2020 2020 2020 2020 6f75 7420  s)..        out 
+000220b0: 3d20 7365 6c66 2e5f 6170 706c 795f 6461  = self._apply_da
+000220c0: 736b 280d 0a20 2020 2020 2020 2020 2020  sk(..           
+000220d0: 2073 6b72 6573 2e65 7374 696d 6174 655f   skres.estimate_
+000220e0: 7369 676d 612c 0d0a 2020 2020 2020 2020  sigma,..        
+000220f0: 2020 2020 635f 6178 6573 3d63 5f61 7865      c_axes=c_axe
+00022100: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00022110: 6472 6f70 5f61 7869 733d 6469 6d73 0d0a  drop_axis=dims..
+00022120: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00022130: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00022140: 2069 6620 6f75 742e 6e64 696d 203d 3d20   if out.ndim == 
+00022150: 3020 616e 6420 7371 7565 657a 653a 0d0a  0 and squeeze:..
+00022160: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
+00022170: 3d20 6f75 742e 6974 656d 2829 0d0a 2020  = out.item()..  
+00022180: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00022190: 2020 2020 2020 2020 206f 7574 203d 2050           out = P
+000221a0: 726f 7041 7272 6179 280d 0a20 2020 2020  ropArray(..     
+000221b0: 2020 2020 2020 2020 2020 206f 7574 2c20             out, 
+000221c0: 6474 7970 653d 6e70 2e66 6c6f 6174 3332  dtype=np.float32
+000221d0: 2c20 6e61 6d65 3d73 656c 662e 6e61 6d65  , name=self.name
+000221e0: 2c20 6178 6573 3d63 5f61 7865 732c 2070  , axes=c_axes, p
+000221f0: 726f 706e 616d 653d 2265 7374 696d 6174  ropname="estimat
+00022200: 655f 7369 676d 6122 0d0a 2020 2020 2020  e_sigma"..      
+00022210: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00022220: 2020 2020 206f 7574 2e5f 7365 745f 696e       out._set_in
+00022230: 666f 2873 656c 662c 206e 6577 5f61 7865  fo(self, new_axe
+00022240: 733d 635f 6178 6573 290d 0a20 2020 2020  s=c_axes)..     
+00022250: 2020 2072 6574 7572 6e20 6f75 7420 2020     return out   
+00022260: 2020 2020 0d0a 2020 2020 2020 2020 0d0a      ..        ..
+00022270: 2020 2020 0d0a 2020 2020 4064 696d 735f      ..    @dims_
+00022280: 746f 5f73 7061 7469 616c 5f61 7865 730d  to_spatial_axes.
+00022290: 0a20 2020 2040 6368 6563 6b5f 696e 7075  .    @check_inpu
+000222a0: 745f 616e 645f 6f75 7470 7574 0d0a 2020  t_and_output..  
+000222b0: 2020 6465 6620 7061 6428 0d0a 2020 2020    def pad(..    
+000222c0: 2020 2020 7365 6c66 2c20 0d0a 2020 2020      self, ..    
+000222d0: 2020 2020 7061 645f 7769 6474 683a 2069      pad_width: i
+000222e0: 6e74 207c 2074 7570 6c65 5b69 6e74 2c20  nt | tuple[int, 
+000222f0: 696e 745d 207c 2053 6571 7565 6e63 655b  int] | Sequence[
+00022300: 7475 706c 655b 696e 742c 2069 6e74 5d5d  tuple[int, int]]
+00022310: 2c20 0d0a 2020 2020 2020 2020 2a2c 200d  , ..        *, .
+00022320: 0a20 2020 2020 2020 206d 6f64 653a 2050  .        mode: P
+00022330: 6164 6469 6e67 4d6f 6465 203d 2022 636f  addingMode = "co
+00022340: 6e73 7461 6e74 222c 200d 0a20 2020 2020  nstant", ..     
+00022350: 2020 2064 696d 733a 2044 696d 7320 3d20     dims: Dims = 
+00022360: 4e6f 6e65 2c20 0d0a 2020 2020 2020 2020  None, ..        
+00022370: 2a2a 6b77 6172 6773 0d0a 2020 2020 2920  **kwargs..    ) 
+00022380: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
+00022390: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+000223a0: 2020 2050 6164 2069 6d61 6765 206f 6e6c     Pad image onl
+000223b0: 7920 666f 7220 7370 6174 6961 6c20 6469  y for spatial di
+000223c0: 6d65 6e73 696f 6e73 2e0d 0a0d 0a20 2020  mensions.....   
+000223d0: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
+000223e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000223f0: 2d2d 2d0d 0a20 2020 2020 2020 2070 6164  ---..        pad
+00022400: 5f77 6964 7468 2c20 6d6f 6465 2c20 2a2a  _width, mode, **
+00022410: 6b77 6172 6773 203a 200d 0a20 2020 2020  kwargs : ..     
+00022420: 2020 2020 2020 2053 6565 2064 6f63 756d         See docum
+00022430: 656e 7461 7469 6f6e 206f 6620 6e70 2e70  entation of np.p
+00022440: 6164 2829 2e0d 0a20 2020 2020 2020 2064  ad()...        d
+00022450: 696d 7320 3a20 696e 7420 6f72 2073 7472  ims : int or str
+00022460: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+00022470: 2020 2020 2020 2020 5768 6963 6820 6469          Which di
+00022480: 6d65 6e73 696f 6e20 746f 2070 6164 2e0d  mension to pad..
+00022490: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+000224a0: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
+000224b0: 2d2d 2d0d 0a20 2020 2020 2020 2049 6d67  ---..        Img
+000224c0: 4172 7261 790d 0a20 2020 2020 2020 2020  Array..         
+000224d0: 2020 2050 6164 6465 6420 696d 6167 652e     Padded image.
+000224e0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000224f0: 2020 2020 4578 616d 706c 6573 0d0a 2020      Examples..  
+00022500: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
+00022510: 2020 2020 2020 2020 5375 7070 6f73 6520          Suppose 
+00022520: 6060 696d 6760 6020 6861 7320 7a79 782d  ``img`` has zyx-
+00022530: 6178 6573 2e0d 0a20 2020 2020 2020 200d  axes...        .
+00022540: 0a20 2020 2020 2020 2031 2e20 5061 6464  .        1. Padd
+00022550: 696e 6720 3520 7069 7865 6c73 2069 6e20  ing 5 pixels in 
+00022560: 7a79 782d 6469 7265 6374 696f 6e3a 0d0a  zyx-direction:..
+00022570: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+00022580: 696d 672e 7061 6428 3529 0d0a 2020 2020  img.pad(5)..    
+00022590: 2020 2020 322e 2050 6164 6469 6e67 2035      2. Padding 5
+000225a0: 2070 6978 656c 7320 696e 2079 782d 6469   pixels in yx-di
+000225b0: 7265 6374 696f 6e3a 0d0a 2020 2020 2020  rection:..      
+000225c0: 2020 2020 2020 3e3e 3e20 696d 672e 7061        >>> img.pa
+000225d0: 6428 352c 2064 696d 733d 2279 7822 290d  d(5, dims="yx").
+000225e0: 0a20 2020 2020 2020 2033 2e20 5061 6464  .        3. Padd
+000225f0: 696e 6720 3520 7069 7865 6c73 2069 6e20  ing 5 pixels in 
+00022600: 7978 2d64 6972 6563 7469 6f6e 2061 6e64  yx-direction and
+00022610: 2032 2070 6978 656c 7320 696e 207a 2d64   2 pixels in z-d
+00022620: 6972 6563 7469 6f6e 3a0d 0a20 2020 2020  irection:..     
+00022630: 2020 2020 2020 203e 3e3e 2069 6d67 2e70         >>> img.p
+00022640: 6164 285b 2835 2c35 292c 2028 342c 3429  ad([(5,5), (4,4)
+00022650: 2c20 2834 2c34 295d 290d 0a20 2020 2020  , (4,4)])..     
+00022660: 2020 2034 2e20 5061 6464 696e 6720 3130     4. Padding 10
+00022670: 2070 6978 656c 7320 696e 207a 2d28 2d29   pixels in z-(-)
+00022680: 2d64 6972 6563 7469 6f6e 2061 6e64 2035  -direction and 5
+00022690: 2070 6978 656c 7320 696e 207a 2d28 2b29   pixels in z-(+)
+000226a0: 2d64 6972 6563 7469 6f6e 2e0d 0a20 2020  -direction...   
+000226b0: 2020 2020 2020 2020 203e 3e3e 2069 6d67           >>> img
+000226c0: 2e70 6164 285b 2831 302c 2035 295d 2c20  .pad([(10, 5)], 
+000226d0: 6469 6d73 3d22 7a22 290d 0a20 2020 2020  dims="z")..     
+000226e0: 2020 2022 2222 2020 2020 2020 2020 0d0a     """        ..
+000226f0: 2020 2020 2020 2020 7061 645f 7769 6474          pad_widt
+00022700: 6820 3d20 5f6d 6973 632e 6d61 6b65 5f70  h = _misc.make_p
+00022710: 6164 2870 6164 5f77 6964 7468 2c20 6469  ad(pad_width, di
+00022720: 6d73 2c20 7365 6c66 2e61 7865 732c 202a  ms, self.axes, *
+00022730: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+00022740: 2020 7061 6469 6d67 203d 206e 702e 7061    padimg = np.pa
+00022750: 6428 7365 6c66 2e76 616c 7565 2c20 7061  d(self.value, pa
+00022760: 645f 7769 6474 682c 206d 6f64 652c 202a  d_width, mode, *
+00022770: 2a6b 7761 7267 7329 2e76 6965 7728 7365  *kwargs).view(se
+00022780: 6c66 2e5f 5f63 6c61 7373 5f5f 290d 0a20  lf.__class__).. 
+00022790: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+000227a0: 6469 6d67 0d0a 2020 2020 0d0a 2020 2020  dimg..    ..    
+000227b0: 4073 616d 655f 6474 7970 6528 6173 666c  @same_dtype(asfl
+000227c0: 6f61 743d 5472 7565 290d 0a20 2020 2040  oat=True)..    @
+000227d0: 6368 6563 6b5f 696e 7075 745f 616e 645f  check_input_and_
+000227e0: 6f75 7470 7574 0d0a 2020 2020 6465 6620  output..    def 
+000227f0: 7061 645f 6465 666f 6375 7328 7365 6c66  pad_defocus(self
+00022800: 2c20 6b65 726e 656c 2c20 2a2c 2064 6570  , kernel, *, dep
+00022810: 7468 3a20 696e 7420 3d20 332c 2077 6964  th: int = 3, wid
+00022820: 7468 3a20 696e 7420 3d20 362c 2062 673a  th: int = 6, bg:
+00022830: 2066 6c6f 6174 203d 204e 6f6e 6529 202d   float = None) -
+00022840: 3e20 496d 6741 7272 6179 3a0d 0a20 2020  > ImgArray:..   
+00022850: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00022860: 2020 4d61 6b65 2061 207a 2d64 6972 6563    Make a z-direc
+00022870: 7469 6f6e 616c 2070 6164 6465 6420 696d  tional padded im
+00022880: 6167 6520 6279 2064 6566 6f63 7573 696e  age by defocusin
+00022890: 6720 7468 6520 6f72 6967 696e 616c 2069  g the original i
+000228a0: 6d61 6765 2e20 5468 6973 2070 6164 6469  mage. This paddi
+000228b0: 6e67 2069 730d 0a20 2020 2020 2020 2075  ng is..        u
+000228c0: 7365 6675 6c20 7768 656e 2061 7070 6c79  seful when apply
+000228d0: 696e 6720 4646 5420 746f 2061 2033 4420  ing FFT to a 3D 
+000228e0: 696d 6167 652e 0d0a 2020 2020 2020 2020  image...        
+000228f0: 0d0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00022900: 7465 7273 0d0a 2020 2020 2020 2020 2d2d  ters..        --
+00022910: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
+00022920: 2020 6b65 726e 656c 203a 2030 2d2c 2031    kernel : 0-, 1
+00022930: 2d20 6f72 2033 2d64 696d 656e 7369 6f6e  - or 3-dimension
+00022940: 616c 2061 7272 6179 2e0d 0a20 2020 2020  al array...     
+00022950: 2020 2020 2020 2049 6620 302d 2028 7363         If 0- (sc
+00022960: 616c 6172 2920 6f72 2031 2d64 696d 656e  alar) or 1-dimen
+00022970: 7369 6f6e 616c 2061 7272 6179 2077 6173  sional array was
+00022980: 2067 6976 656e 2c20 7468 6973 2069 7320   given, this is 
+00022990: 696e 7465 7270 7265 7465 6420 6173 2073  interpreted as s
+000229a0: 7461 6e64 6172 640d 0a20 2020 2020 2020  tandard..       
+000229b0: 2020 2020 2064 6576 6961 7469 6f6e 206f       deviation o
+000229c0: 6620 4761 7573 7369 616e 206b 6572 6e65  f Gaussian kerne
+000229d0: 6c2e 2049 6620 332d 6469 6d65 6e73 696f  l. If 3-dimensio
+000229e0: 6e61 6c20 6172 7261 7920 7761 7320 6769  nal array was gi
+000229f0: 7665 6e2c 2074 6869 7320 6973 2064 6972  ven, this is dir
+00022a00: 6563 746c 790d 0a20 2020 2020 2020 2020  ectly..         
+00022a10: 2020 2075 7365 6420 6173 2063 6f6e 766f     used as convo
+00022a20: 6c75 7469 6f6e 206b 6572 6e65 6c2e 204f  lution kernel. O
+00022a30: 7468 6572 2064 696d 656e 7369 6f6e 2077  ther dimension w
+00022a40: 696c 6c20 7261 6973 6520 5661 6c75 6545  ill raise ValueE
+00022a50: 7272 6f72 2e0d 0a20 2020 2020 2020 2064  rror...        d
+00022a60: 6570 7468 203a 2069 6e74 2c20 6465 6661  epth : int, defa
+00022a70: 756c 7420 6973 2033 0d0a 2020 2020 2020  ult is 3..      
+00022a80: 2020 2020 2020 4465 7074 6820 6f66 2064        Depth of d
+00022a90: 6566 6f63 7573 696e 672e 2046 6f72 2061  efocusing. For a
+00022aa0: 6e20 696d 6167 6520 7769 7468 207a 2d61  n image with z-a
+00022ab0: 7869 7320 7369 7a65 204c 2c20 7468 656e  xis size L, then
+00022ac0: 206f 7574 7075 7420 696d 6167 6520 7769   output image wi
+00022ad0: 6c6c 2068 6176 650d 0a20 2020 2020 2020  ll have..       
+00022ae0: 2020 2020 2073 697a 6520 4c20 2b20 322a       size L + 2*
+00022af0: 6465 7074 682e 0d0a 2020 2020 2020 2020  depth...        
+00022b00: 7769 6474 6820 3a20 696e 742c 2064 6566  width : int, def
+00022b10: 6175 6c74 2069 7320 360d 0a20 2020 2020  ault is 6..     
+00022b20: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
+00022b30: 6465 666f 6375 7369 6e67 2e20 466f 7220  defocusing. For 
+00022b40: 616e 2069 6d61 6765 2077 6974 6820 7978  an image with yx
+00022b50: 2d73 6861 7065 2028 4d2c 204e 292c 2074  -shape (M, N), t
+00022b60: 6865 6e20 6f75 7470 7574 2069 6d61 6765  hen output image
+00022b70: 2077 696c 6c20 6861 7665 0d0a 2020 2020   will have..    
+00022b80: 2020 2020 2020 2020 7368 6170 6520 284d          shape (M
+00022b90: 202a 2032 2a77 6964 7468 2c20 4e20 2b20   * 2*width, N + 
+00022ba0: 322a 7769 6474 6829 2e0d 0a20 2020 2020  2*width)...     
+00022bb0: 2020 2062 6720 3a20 666c 6f61 742c 206f     bg : float, o
+00022bc0: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+00022bd0: 2020 2020 2042 6163 6b67 726f 756e 6420       Background 
+00022be0: 696e 7465 6e73 6974 792e 2049 6620 6e6f  intensity. If no
+00022bf0: 7420 6769 7665 6e2c 2069 7420 7769 6c6c  t given, it will
+00022c00: 2063 616c 6375 6c61 7465 6420 6173 2074   calculated as t
+00022c10: 6865 206d 696e 696d 756d 2076 616c 7565  he minimum value
+00022c20: 206f 6620 0d0a 2020 2020 2020 2020 2020   of ..          
+00022c30: 2020 7468 6520 6f72 6967 696e 616c 2069    the original i
+00022c40: 6d61 6765 2e0d 0a0d 0a20 2020 2020 2020  mage.....       
+00022c50: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+00022c60: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+00022c70: 2020 2049 6d67 4172 7261 790d 0a20 2020     ImgArray..   
+00022c80: 2020 2020 2020 2020 2050 6164 6465 6420           Padded 
+00022c90: 696d 6167 652e 0d0a 2020 2020 2020 2020  image...        
+00022ca0: 2020 2020 0d0a 2020 2020 2020 2020 4578      ..        Ex
+00022cb0: 616d 706c 6573 0d0a 2020 2020 2020 2020  amples..        
+00022cc0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
+00022cd0: 2020 6465 7074 6820 3d20 320d 0a20 2020    depth = 2..   
+00022ce0: 2020 2020 200d 0a20 2020 2020 2020 202e       ..        .
+00022cf0: 2e20 636f 6465 2d62 6c6f 636b 3a3a 0d0a  . code-block::..
+00022d00: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00022d10: 2020 2020 2020 2d2d 2d2d 7c20 2020 7c2d        ----|   |-
+00022d20: 2d2d 2d7c 206f 207c 2d2d 2020 2020 206f  ---| o |--     o
+00022d30: 202e 2e2e 2063 656e 7465 7220 6f66 206b   ... center of k
+00022d40: 6572 6e65 6c0d 0a20 2020 2020 2020 2020  ernel..         
+00022d50: 2020 202d 2d2d 2d7c 206f 207c 2d2d 2d2d     ----| o |----
+00022d60: 7c20 2020 7c2d 2d0d 0a20 2020 2020 2020  |   |--..       
+00022d70: 2020 2020 202b 2b2b 2b7c 2020 207c 2b2b       ++++|   |++
+00022d80: 2b2b 7c5f 5f5f 7c2b 2b20 203c 2d20 7468  ++|___|++  <- th
+00022d90: 6520 7570 7065 7220 6564 6765 206f 6620  e upper edge of 
+00022da0: 6f72 6967 696e 616c 2069 6d61 6765 200d  original image .
+00022db0: 0a20 2020 2020 2020 2020 2020 202b 2b2b  .            +++
+00022dc0: 2b7c 5f5f 5f7c 2b2b 2b2b 2b2b 2b2b 2b2b  +|___|++++++++++
+00022dd0: 2b0d 0a0d 0a20 2020 2020 2020 2022 2222  +....        """
+00022de0: 0d0a 2020 2020 2020 2020 6267 203d 205f  ..        bg = _
+00022df0: 6368 6563 6b5f 6267 2873 656c 662c 2062  check_bg(self, b
+00022e00: 6729 0d0a 2020 2020 2020 2020 0d0a 2020  g)..        ..  
+00022e10: 2020 2020 2020 6966 206e 702e 6973 7363        if np.issc
+00022e20: 616c 6172 286b 6572 6e65 6c29 3a0d 0a20  alar(kernel):.. 
+00022e30: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
+00022e40: 6c20 3d20 6e70 2e61 7272 6179 285b 6b65  l = np.array([ke
+00022e50: 726e 656c 5d2a 3329 0d0a 2020 2020 2020  rnel]*3)..      
+00022e60: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00022e70: 2020 2020 206b 6572 6e65 6c20 3d20 6e70       kernel = np
+00022e80: 2e61 7361 7272 6179 286b 6572 6e65 6c29  .asarray(kernel)
+00022e90: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00022ea0: 2020 2020 6966 206b 6572 6e65 6c2e 6e64      if kernel.nd
+00022eb0: 696d 203c 3d20 313a 0d0a 2020 2020 2020  im <= 1:..      
+00022ec0: 2020 2020 2020 6465 6620 6669 6c74 6572        def filter
+00022ed0: 5f66 756e 6328 696d 6729 3a0d 0a20 2020  _func(img):..   
+00022ee0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00022ef0: 7572 6e20 7870 2e61 736e 756d 7079 285f  urn xp.asnumpy(_
+00022f00: 6669 6c74 6572 732e 6761 7573 7369 616e  filters.gaussian
+00022f10: 5f66 696c 7465 7228 696d 672c 206b 6572  _filter(img, ker
+00022f20: 6e65 6c2c 206d 6f64 653d 2263 6f6e 7374  nel, mode="const
+00022f30: 616e 7422 2c20 6376 616c 3d62 6729 290d  ant", cval=bg)).
+00022f40: 0a20 2020 2020 2020 2020 2020 2064 7a2c  .            dz,
+00022f50: 2064 792c 2064 7820 3d20 6b65 726e 656c   dy, dx = kernel
+00022f60: 2a33 2023 2033 2d73 6967 6d61 0d0a 2020  *3 # 3-sigma..  
+00022f70: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00022f80: 2020 2020 656c 6966 206b 6572 6e65 6c2e      elif kernel.
+00022f90: 6e64 696d 203d 3d20 333a 0d0a 2020 2020  ndim == 3:..    
+00022fa0: 2020 2020 2020 2020 6b65 726e 656c 203d          kernel =
+00022fb0: 206b 6572 6e65 6c2e 6173 7479 7065 286e   kernel.astype(n
+00022fc0: 702e 666c 6f61 7433 3229 0d0a 2020 2020  p.float32)..    
+00022fd0: 2020 2020 2020 2020 6b65 726e 656c 203d          kernel =
+00022fe0: 206b 6572 6e65 6c20 2f20 6e70 2e73 756d   kernel / np.sum
+00022ff0: 286b 6572 6e65 6c29 0d0a 2020 2020 2020  (kernel)..      
+00023000: 2020 2020 2020 6465 6620 6669 6c74 6572        def filter
+00023010: 5f66 756e 6328 696d 6729 3a0d 0a20 2020  _func(img):..   
+00023020: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00023030: 7572 6e20 7870 2e61 736e 756d 7079 285f  urn xp.asnumpy(_
+00023040: 6669 6c74 6572 732e 636f 6e76 6f6c 7665  filters.convolve
+00023050: 2869 6d67 2c20 6b65 726e 656c 2c20 6d6f  (img, kernel, mo
+00023060: 6465 3d22 636f 6e73 7461 6e74 222c 2063  de="constant", c
+00023070: 7661 6c3d 6267 2929 0d0a 2020 2020 2020  val=bg))..      
+00023080: 2020 2020 2020 647a 2c20 6479 2c20 6478        dz, dy, dx
+00023090: 203d 206e 702e 6172 7261 7928 6b65 726e   = np.array(kern
+000230a0: 656c 2e73 6861 7065 292f 2f32 0d0a 2020  el.shape)//2..  
+000230b0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000230c0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000230d0: 616c 7565 4572 726f 7228 2260 6b65 726e  alueError("`kern
+000230e0: 656c 6020 6f6e 6c79 2074 616b 6520 302c  el` only take 0,
+000230f0: 2031 2c20 3320 6469 6d65 6e73 696f 6e61   1, 3 dimensiona
+00023100: 6c20 6172 7261 7920 6173 2061 6e20 696e  l array as an in
+00023110: 7075 742e 2229 0d0a 2020 2020 2020 2020  put.")..        
+00023120: 0d0a 2020 2020 2020 2020 7061 645f 7769  ..        pad_wi
+00023130: 6474 6820 3d20 5b28 6465 7074 682c 2064  dth = [(depth, d
+00023140: 6570 7468 292c 2028 7769 6474 682c 2077  epth), (width, w
+00023150: 6964 7468 292c 2028 7769 6474 682c 2077  idth), (width, w
+00023160: 6964 7468 295d 0d0a 2020 2020 2020 2020  idth)]..        
+00023170: 7061 6469 6d67 203d 2073 656c 662e 7061  padimg = self.pa
+00023180: 6428 7061 645f 7769 6474 682c 206d 6f64  d(pad_width, mod
+00023190: 653d 2263 6f6e 7374 616e 7422 2c20 636f  e="constant", co
+000231a0: 6e73 7461 6e74 5f76 616c 7565 733d 6267  nstant_values=bg
+000231b0: 2c20 6469 6d73 3d22 7a79 7822 290d 0a20  , dims="zyx").. 
+000231c0: 2020 2020 2020 206f 7574 203d 206e 702e         out = np.
+000231d0: 636f 7079 2870 6164 696d 672e 7661 6c75  copy(padimg.valu
+000231e0: 6529 0d0a 2020 2020 2020 2020 2320 636f  e)..        # co
+000231f0: 6e76 6f6c 7665 2070 7366 0d0a 2020 2020  nvolve psf..    
+00023200: 2020 2020 7a5f 6564 6765 3020 3d20 736c      z_edge0 = sl
+00023210: 6963 6528 4e6f 6e65 2c20 6465 7074 682c  ice(None, depth,
+00023220: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
+00023230: 7a5f 6d69 6420 3d20 736c 6963 6528 6465  z_mid = slice(de
+00023240: 7074 682c 202d 6465 7074 682c 204e 6f6e  pth, -depth, Non
+00023250: 6529 0d0a 2020 2020 2020 2020 7a5f 6564  e)..        z_ed
+00023260: 6765 3120 3d20 736c 6963 6528 2d64 6570  ge1 = slice(-dep
+00023270: 7468 2c20 4e6f 6e65 2c20 4e6f 6e65 290d  th, None, None).
+00023280: 0a20 2020 2020 2020 2079 5f65 6467 6530  .        y_edge0
+00023290: 203d 2078 5f65 6467 6530 203d 2073 6c69   = x_edge0 = sli
+000232a0: 6365 284e 6f6e 652c 2077 6964 7468 2c20  ce(None, width, 
+000232b0: 4e6f 6e65 290d 0a20 2020 2020 2020 2079  None)..        y
+000232c0: 5f6d 6964 203d 2073 6c69 6365 2877 6964  _mid = slice(wid
+000232d0: 7468 2c20 2d77 6964 7468 2c20 4e6f 6e65  th, -width, None
+000232e0: 290d 0a20 2020 2020 2020 2079 5f65 6467  )..        y_edg
+000232f0: 6531 203d 2078 5f65 6467 6531 203d 2073  e1 = x_edge1 = s
+00023300: 6c69 6365 282d 7769 6474 682c 204e 6f6e  lice(-width, Non
+00023310: 652c 204e 6f6e 6529 0d0a 2020 2020 2020  e, None)..      
+00023320: 2020 0d0a 2020 2020 2020 2020 666f 7220    ..        for 
+00023330: 736c 2c20 696d 6720 696e 2070 6164 696d  sl, img in padim
+00023340: 672e 6974 6572 2863 6f6d 706c 656d 656e  g.iter(complemen
+00023350: 745f 6178 6573 2822 7a79 7822 2c20 7365  t_axes("zyx", se
+00023360: 6c66 2e61 7865 7329 293a 0d0a 2020 2020  lf.axes)):..    
+00023370: 2020 2020 2020 2020 6f75 745f 203d 206f          out_ = o
+00023380: 7574 5b73 6c5d 0d0a 2020 2020 2020 2020  ut[sl]..        
+00023390: 2020 2020 6f75 745f 5b7a 5f65 6467 6530      out_[z_edge0
+000233a0: 5d20 3d20 6669 6c74 6572 5f66 756e 6328  ] = filter_func(
+000233b0: 696d 675b 3a64 6570 7468 2b64 7a20 5d29  img[:depth+dz ])
+000233c0: 5b7a 5f65 6467 6530 5d0d 0a20 2020 2020  [z_edge0]..     
+000233d0: 2020 2020 2020 206f 7574 5f5b 7a5f 6564         out_[z_ed
+000233e0: 6765 315d 203d 2066 696c 7465 725f 6675  ge1] = filter_fu
+000233f0: 6e63 2869 6d67 5b2d 6465 7074 682d 647a  nc(img[-depth-dz
+00023400: 3a5d 295b 7a5f 6564 6765 315d 0d0a 2020  :])[z_edge1]..  
+00023410: 2020 2020 2020 2020 2020 6f75 745f 5b7a            out_[z
+00023420: 5f6d 6964 2c20 795f 6564 6765 305d 203d  _mid, y_edge0] =
+00023430: 2066 696c 7465 725f 6675 6e63 2869 6d67   filter_func(img
+00023440: 5b3a 2c20 3a77 6964 7468 2b64 7920 5d29  [:, :width+dy ])
+00023450: 5b7a 5f6d 6964 2c20 795f 6564 6765 305d  [z_mid, y_edge0]
+00023460: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
+00023470: 745f 5b7a 5f6d 6964 2c20 795f 6564 6765  t_[z_mid, y_edge
+00023480: 315d 203d 2066 696c 7465 725f 6675 6e63  1] = filter_func
+00023490: 2869 6d67 5b3a 2c20 2d77 6964 7468 2d64  (img[:, -width-d
+000234a0: 793a 5d29 5b7a 5f6d 6964 2c20 795f 6564  y:])[z_mid, y_ed
+000234b0: 6765 315d 0d0a 2020 2020 2020 2020 2020  ge1]..          
+000234c0: 2020 6f75 745f 5b7a 5f6d 6964 2c20 795f    out_[z_mid, y_
+000234d0: 6d69 642c 2078 5f65 6467 6530 5d20 3d20  mid, x_edge0] = 
+000234e0: 6669 6c74 6572 5f66 756e 6328 696d 675b  filter_func(img[
+000234f0: 3a2c 203a 2c20 3a77 6964 7468 2b64 7820  :, :, :width+dx 
+00023500: 5d29 5b7a 5f6d 6964 2c20 795f 6d69 642c  ])[z_mid, y_mid,
+00023510: 2078 5f65 6467 6530 5d0d 0a20 2020 2020   x_edge0]..     
+00023520: 2020 2020 2020 206f 7574 5f5b 7a5f 6d69         out_[z_mi
+00023530: 642c 2079 5f6d 6964 2c20 785f 6564 6765  d, y_mid, x_edge
+00023540: 315d 203d 2066 696c 7465 725f 6675 6e63  1] = filter_func
+00023550: 2869 6d67 5b3a 2c20 3a2c 202d 7769 6474  (img[:, :, -widt
+00023560: 682d 6478 3a5d 295b 7a5f 6d69 642c 2079  h-dx:])[z_mid, y
+00023570: 5f6d 6964 2c20 785f 6564 6765 315d 0d0a  _mid, x_edge1]..
+00023580: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00023590: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+000235a0: 2e76 6965 7728 7365 6c66 2e5f 5f63 6c61  .view(self.__cla
+000235b0: 7373 5f5f 290d 0a20 2020 200d 0a20 2020  ss__)..    ..   
+000235c0: 200d 0a20 2020 2040 5f64 6f63 732e 7772   ..    @_docs.wr
+000235d0: 6974 655f 646f 6373 0d0a 2020 2020 4064  ite_docs..    @d
+000235e0: 696d 735f 746f 5f73 7061 7469 616c 5f61  ims_to_spatial_a
+000235f0: 7865 730d 0a20 2020 2040 7361 6d65 5f64  xes..    @same_d
+00023600: 7479 7065 2861 7366 6c6f 6174 3d54 7275  type(asfloat=Tru
+00023610: 6529 0d0a 2020 2020 4063 6865 636b 5f69  e)..    @check_i
+00023620: 6e70 7574 5f61 6e64 5f6f 7574 7075 740d  nput_and_output.
+00023630: 0a20 2020 2064 6566 2077 6965 6e65 7228  .    def wiener(
+00023640: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
+00023650: 0a20 2020 2020 2020 2070 7366 3a20 6e70  .        psf: np
+00023660: 2e6e 6461 7272 6179 207c 2043 616c 6c61  .ndarray | Calla
+00023670: 626c 655b 5b74 7570 6c65 5b69 6e74 2c20  ble[[tuple[int, 
+00023680: 2e2e 2e5d 5d2c 206e 702e 6e64 6172 7261  ...]], np.ndarra
+00023690: 795d 2c0d 0a20 2020 2020 2020 206c 6d64  y],..        lmd
+000236a0: 3a20 666c 6f61 7420 3d20 302e 312c 0d0a  : float = 0.1,..
+000236b0: 2020 2020 2020 2020 2a2c 200d 0a20 2020          *, ..   
+000236c0: 2020 2020 2064 696d 733a 2044 696d 7320       dims: Dims 
+000236d0: 3d20 4e6f 6e65 2c20 0d0a 2020 2020 2020  = None, ..      
+000236e0: 2020 7570 6461 7465 3a20 626f 6f6c 203d    update: bool =
+000236f0: 2046 616c 7365 0d0a 2020 2020 2920 2d3e   False..    ) ->
+00023700: 2049 6d67 4172 7261 793a 0d0a 2020 2020   ImgArray:..    
+00023710: 2020 2020 7222 2222 0d0a 2020 2020 2020      r"""..      
+00023720: 2020 436c 6173 7369 6361 6c20 7769 656e    Classical wien
+00023730: 6572 2064 6563 6f6e 766f 6c75 7469 6f6e  er deconvolution
+00023740: 2e20 5468 6973 2061 6c67 6f72 6974 686d  . This algorithm
+00023750: 2068 6173 2074 6865 2073 6572 696f 7573   has the serious
+00023760: 2072 696e 6769 6e67 2070 726f 626c 656d   ringing problem
+00023770: 0d0a 2020 2020 2020 2020 6966 2070 6172  ..        if par
+00023780: 616d 6574 6572 7320 6172 6520 7365 7420  ameters are set 
+00023790: 746f 2077 726f 6e67 2076 616c 7565 732e  to wrong values.
+000237a0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000237b0: 2020 2020 3a6d 6174 683a 6046 5b59 5f7b      :math:`F[Y_{
+000237c0: 7265 737d 5d20 3d20 5c66 7261 637b 465b  res}] = \frac{F[
+000237d0: 595f 7b6f 6273 7d5d 205c 6364 6f74 205c  Y_{obs}] \cdot \
+000237e0: 6261 727b 487d 7d7b 7c48 7c5e 3220 2b20  bar{H}}{|H|^2 + 
+000237f0: 5c6c 616d 6264 617d 600d 0a20 2020 2020  \lambda}`..     
+00023800: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00023810: 203a 6d61 7468 3a60 595f 7b6f 6273 7d60   :math:`Y_{obs}`
+00023820: 3a20 6f62 7365 7276 6564 2069 6d61 6765  : observed image
+00023830: 3b0d 0a20 2020 2020 2020 203a 6d61 7468  ;..        :math
+00023840: 3a60 595f 7b72 6573 7d60 3a20 7265 7374  :`Y_{res}`: rest
+00023850: 6f72 6564 2069 6d61 6765 3b0d 0a20 2020  ored image;..   
+00023860: 2020 2020 203a 6d61 7468 3a60 4860 203a       :math:`H` :
+00023870: 2046 4654 206f 6620 706f 696e 7420 7370   FFT of point sp
+00023880: 7265 6164 2066 756e 6374 696f 6e20 2850  read function (P
+00023890: 5346 293b 0d0a 0d0a 2020 2020 2020 2020  SF);....        
+000238a0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+000238b0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+000238c0: 2020 2020 2020 2020 7073 6620 3a20 6e64          psf : nd
+000238d0: 6172 7261 7920 6f72 2063 616c 6c61 626c  array or callabl
+000238e0: 650d 0a20 2020 2020 2020 2020 2020 2050  e..            P
+000238f0: 6f69 6e74 2073 7072 6561 6420 6675 6e63  oint spread func
+00023900: 7469 6f6e 2e20 4966 2061 2066 756e 6374  tion. If a funct
+00023910: 696f 6e20 6973 2067 6976 656e 2c20 6070  ion is given, `p
+00023920: 7366 2873 6861 7065 2960 2077 696c 6c20  sf(shape)` will 
+00023930: 6265 0d0a 2020 2020 2020 2020 2020 2020  be..            
+00023940: 6361 6c6c 6564 2074 6f20 6765 6e65 7261  called to genera
+00023950: 7465 2074 6865 2050 5346 2e0d 0a20 2020  te the PSF...   
+00023960: 2020 2020 206c 6d64 203a 2066 6c6f 6174       lmd : float
+00023970: 2c20 6465 6661 756c 7420 6973 2030 2e31  , default is 0.1
+00023980: 0d0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
+00023990: 6e73 7461 6e74 2076 616c 7565 2075 7365  nstant value use
+000239a0: 6420 696e 2074 6865 2064 6563 6f6e 766f  d in the deconvo
+000239b0: 6c75 7469 6f6e 2e20 5365 6520 466f 726d  lution. See Form
+000239c0: 756c 6174 696f 6e20 6265 6c6f 772e 0d0a  ulation below...
+000239d0: 2020 2020 2020 2020 7b64 696d 737d 7b75          {dims}{u
+000239e0: 7064 6174 657d 0d0a 0d0a 2020 2020 2020  pdate}....      
+000239f0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+00023a00: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+00023a10: 2020 2020 496d 6741 7272 6179 0d0a 2020      ImgArray..  
+00023a20: 2020 2020 2020 2020 2020 4465 636f 6e76            Deconv
+00023a30: 6f6c 7665 6420 696d 6167 652e 0d0a 2020  olved image...  
+00023a40: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00023a50: 0d0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+00023a60: 736f 0d0a 2020 2020 2020 2020 2d2d 2d2d  so..        ----
+00023a70: 2d2d 2d2d 0d0a 2020 2020 2020 2020 6c75  ----..        lu
+00023a80: 6379 0d0a 2020 2020 2020 2020 6c75 6379  cy..        lucy
+00023a90: 5f74 760d 0a20 2020 2020 2020 2022 2222  _tv..        """
+00023aa0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00023ab0: 2020 6966 206c 6d64 203c 3d20 303a 0d0a    if lmd <= 0:..
+00023ac0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00023ad0: 6520 5661 6c75 6545 7272 6f72 2866 226c  e ValueError(f"l
+00023ae0: 6d64 206d 7573 7420 6265 2070 6f73 6974  md must be posit
+00023af0: 6976 652c 2062 7574 2067 6f74 3a20 7b6c  ive, but got: {l
+00023b00: 6d64 7d22 290d 0a20 2020 2020 2020 200d  md}")..        .
+00023b10: 0a20 2020 2020 2020 2070 7366 5f66 742c  .        psf_ft,
+00023b20: 2070 7366 5f66 745f 636f 6e6a 203d 205f   psf_ft_conj = _
+00023b30: 6465 636f 6e76 2e63 6865 636b 5f70 7366  deconv.check_psf
+00023b40: 280d 0a20 2020 2020 2020 2020 2020 2073  (..            s
+00023b50: 656c 662e 7369 7a65 736f 6628 6469 6d73  elf.sizesof(dims
+00023b60: 292c 2074 7570 6c65 2873 656c 662e 7363  ), tuple(self.sc
+00023b70: 616c 655b 6178 6973 5d20 666f 7220 6178  ale[axis] for ax
+00023b80: 6973 2069 6e20 6469 6d73 292c 2070 7366  is in dims), psf
+00023b90: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
+00023ba0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00023bb0: 7265 7475 726e 2073 656c 662e 5f61 7070  return self._app
+00023bc0: 6c79 5f64 6173 6b28 0d0a 2020 2020 2020  ly_dask(..      
+00023bd0: 2020 2020 2020 5f64 6563 6f6e 762e 7769        _deconv.wi
+00023be0: 656e 6572 2c20 0d0a 2020 2020 2020 2020  ener, ..        
+00023bf0: 2020 2020 635f 6178 6573 3d63 6f6d 706c      c_axes=compl
+00023c00: 656d 656e 745f 6178 6573 2864 696d 732c  ement_axes(dims,
+00023c10: 2073 656c 662e 6178 6573 292c 0d0a 2020   self.axes),..  
+00023c20: 2020 2020 2020 2020 2020 6172 6773 3d28            args=(
+00023c30: 7073 665f 6674 2c20 7073 665f 6674 5f63  psf_ft, psf_ft_c
+00023c40: 6f6e 6a2c 206c 6d64 290d 0a20 2020 2020  onj, lmd)..     
+00023c50: 2020 2029 2020 2020 0d0a 0d0a 2020 2020     )    ....    
+00023c60: 405f 646f 6373 2e77 7269 7465 5f64 6f63  @_docs.write_doc
+00023c70: 730d 0a20 2020 2040 6469 6d73 5f74 6f5f  s..    @dims_to_
+00023c80: 7370 6174 6961 6c5f 6178 6573 0d0a 2020  spatial_axes..  
+00023c90: 2020 4073 616d 655f 6474 7970 6528 6173    @same_dtype(as
+00023ca0: 666c 6f61 743d 5472 7565 290d 0a20 2020  float=True)..   
+00023cb0: 2040 6368 6563 6b5f 696e 7075 745f 616e   @check_input_an
+00023cc0: 645f 6f75 7470 7574 0d0a 2020 2020 6465  d_output..    de
+00023cd0: 6620 6c75 6379 280d 0a20 2020 2020 2020  f lucy(..       
+00023ce0: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+00023cf0: 7073 663a 206e 702e 6e64 6172 7261 7920  psf: np.ndarray 
+00023d00: 7c20 4361 6c6c 6162 6c65 5b5b 7475 706c  | Callable[[tupl
+00023d10: 655b 696e 742c 202e 2e2e 5d5d 2c20 6e70  e[int, ...]], np
+00023d20: 2e6e 6461 7272 6179 5d2c 0d0a 2020 2020  .ndarray],..    
+00023d30: 2020 2020 6e69 7465 723a 2069 6e74 203d      niter: int =
+00023d40: 2035 302c 0d0a 2020 2020 2020 2020 6570   50,..        ep
+00023d50: 733a 2066 6c6f 6174 203d 2031 652d 352c  s: float = 1e-5,
+00023d60: 0d0a 2020 2020 2020 2020 2a2c 200d 0a20  ..        *, .. 
+00023d70: 2020 2020 2020 2064 696d 733a 2044 696d         dims: Dim
+00023d80: 7320 3d20 4e6f 6e65 2c20 0d0a 2020 2020  s = None, ..    
+00023d90: 2020 2020 7570 6461 7465 3a20 626f 6f6c      update: bool
+00023da0: 203d 2046 616c 7365 0d0a 2020 2020 2920   = False..    ) 
+00023db0: 2d3e 2049 6d67 4172 7261 793a 0d0a 2020  -> ImgArray:..  
+00023dc0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00023dd0: 2020 2044 6563 6f6e 766f 6c75 7469 6f6e     Deconvolution
+00023de0: 206f 6620 4e2d 6469 6d65 6e73 696f 6e61   of N-dimensiona
+00023df0: 6c20 696d 6167 652c 2075 7369 6e67 2052  l image, using R
+00023e00: 6963 6861 7264 736f 6e2d 4c75 6379 2773  ichardson-Lucy's
+00023e10: 2061 6c67 6f72 6974 686d 2e0d 0a20 2020   algorithm...   
+00023e20: 2020 2020 200d 0a20 2020 2020 2020 2050       ..        P
+00023e30: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+00023e40: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+00023e50: 2020 2020 2020 2070 7366 203a 206e 6461         psf : nda
+00023e60: 7272 6179 206f 7220 6361 6c6c 6162 6c65  rray or callable
+00023e70: 0d0a 2020 2020 2020 2020 2020 2020 506f  ..            Po
+00023e80: 696e 7420 7370 7265 6164 2066 756e 6374  int spread funct
+00023e90: 696f 6e2e 2049 6620 6120 6675 6e63 7469  ion. If a functi
+00023ea0: 6f6e 2069 7320 6769 7665 6e2c 2060 7073  on is given, `ps
+00023eb0: 6628 7368 6170 6529 6020 7769 6c6c 2062  f(shape)` will b
+00023ec0: 650d 0a20 2020 2020 2020 2020 2020 2063  e..            c
+00023ed0: 616c 6c65 6420 746f 2067 656e 6572 6174  alled to generat
+00023ee0: 6520 7468 6520 5053 462e 0d0a 2020 2020  e the PSF...    
+00023ef0: 2020 2020 6e69 7465 7220 3a20 696e 742c      niter : int,
+00023f00: 2064 6566 6175 6c74 2069 7320 3530 2e0d   default is 50..
+00023f10: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
+00023f20: 6265 7220 6f66 2069 7465 7261 7469 6f6e  ber of iteration
+00023f30: 732e 0d0a 2020 2020 2020 2020 6570 7320  s...        eps 
+00023f40: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00023f50: 2069 7320 3165 2d35 0d0a 2020 2020 2020   is 1e-5..      
+00023f60: 2020 2020 2020 4475 7269 6e67 2064 6563        During dec
+00023f70: 6f6e 766f 6c75 7469 6f6e 2c20 6469 7669  onvolution, divi
+00023f80: 7369 6f6e 2062 7920 736d 616c 6c20 7661  sion by small va
+00023f90: 6c75 6573 2069 6e20 7468 6520 636f 6e76  lues in the conv
+00023fa0: 6f6c 7665 2069 6d61 6765 200d 0a20 2020  olve image ..   
+00023fb0: 2020 2020 2020 2020 206f 6620 6573 7469           of esti
+00023fc0: 6d61 7469 6f6e 2061 6e64 2050 5346 206d  mation and PSF m
+00023fd0: 6179 2063 6175 7365 2064 6976 6572 6765  ay cause diverge
+00023fe0: 6e63 652e 2054 6865 7265 666f 7265 2c20  nce. Therefore, 
+00023ff0: 6469 7669 7369 6f6e 2062 7920 0d0a 2020  division by ..  
+00024000: 2020 2020 2020 2020 2020 7661 6c75 6573            values
+00024010: 2075 6e64 6572 2060 6570 7360 2069 7320   under `eps` is 
+00024020: 7375 6273 7469 7475 7465 6420 746f 207a  substituted to z
+00024030: 6572 6f2e 0d0a 2020 2020 2020 2020 7b64  ero...        {d
+00024040: 696d 737d 7b75 7064 6174 657d 0d0a 2020  ims}{update}..  
+00024050: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00024060: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
+00024070: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
+00024080: 2020 496d 6741 7272 6179 0d0a 2020 2020    ImgArray..    
+00024090: 2020 2020 2020 2020 4465 636f 6e76 6f6c          Deconvol
+000240a0: 7665 6420 696d 6167 652e 0d0a 2020 2020  ved image...    
+000240b0: 2020 2020 0d0a 2020 2020 2020 2020 5365      ..        Se
+000240c0: 6520 416c 736f 0d0a 2020 2020 2020 2020  e Also..        
+000240d0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
+000240e0: 2020 6c75 6379 5f74 760d 0a20 2020 2020    lucy_tv..     
+000240f0: 2020 2077 6965 6e65 720d 0a20 2020 2020     wiener..     
+00024100: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00024110: 0d0a 2020 2020 2020 2020 7073 665f 6674  ..        psf_ft
+00024120: 2c20 7073 665f 6674 5f63 6f6e 6a20 3d20  , psf_ft_conj = 
+00024130: 5f64 6563 6f6e 762e 6368 6563 6b5f 7073  _deconv.check_ps
+00024140: 6628 0d0a 2020 2020 2020 2020 2020 2020  f(..            
+00024150: 7365 6c66 2e73 697a 6573 6f66 2864 696d  self.sizesof(dim
+00024160: 7329 2c20 7475 706c 6528 7365 6c66 2e73  s), tuple(self.s
+00024170: 6361 6c65 5b61 7869 735d 2066 6f72 2061  cale[axis] for a
+00024180: 7869 7320 696e 2064 696d 7329 2c20 7073  xis in dims), ps
+00024190: 662c 0d0a 2020 2020 2020 2020 290d 0a0d  f,..        )...
+000241a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000241b0: 7365 6c66 2e5f 6170 706c 795f 6461 736b  self._apply_dask
+000241c0: 280d 0a20 2020 2020 2020 2020 2020 205f  (..            _
+000241d0: 6465 636f 6e76 2e72 6963 6861 7264 736f  deconv.richardso
+000241e0: 6e5f 6c75 6379 2c20 0d0a 2020 2020 2020  n_lucy, ..      
+000241f0: 2020 2020 2020 635f 6178 6573 3d63 6f6d        c_axes=com
+00024200: 706c 656d 656e 745f 6178 6573 2864 696d  plement_axes(dim
+00024210: 732c 2073 656c 662e 6178 6573 292c 0d0a  s, self.axes),..
+00024220: 2020 2020 2020 2020 2020 2020 6172 6773              args
+00024230: 3d28 7073 665f 6674 2c20 7073 665f 6674  =(psf_ft, psf_ft
+00024240: 5f63 6f6e 6a2c 206e 6974 6572 2c20 6570  _conj, niter, ep
+00024250: 7329 0d0a 2020 2020 2020 2020 290d 0a20  s)..        ).. 
+00024260: 2020 2020 2020 200d 0a20 2020 2040 5f64         ..    @_d
+00024270: 6f63 732e 7772 6974 655f 646f 6373 0d0a  ocs.write_docs..
+00024280: 2020 2020 4064 696d 735f 746f 5f73 7061      @dims_to_spa
+00024290: 7469 616c 5f61 7865 730d 0a20 2020 2040  tial_axes..    @
+000242a0: 7361 6d65 5f64 7479 7065 2861 7366 6c6f  same_dtype(asflo
+000242b0: 6174 3d54 7275 6529 0d0a 2020 2020 4063  at=True)..    @c
+000242c0: 6865 636b 5f69 6e70 7574 5f61 6e64 5f6f  heck_input_and_o
+000242d0: 7574 7075 740d 0a20 2020 2064 6566 206c  utput..    def l
+000242e0: 7563 795f 7476 280d 0a20 2020 2020 2020  ucy_tv(..       
+000242f0: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+00024300: 7073 663a 206e 702e 6e64 6172 7261 7920  psf: np.ndarray 
+00024310: 7c20 4361 6c6c 6162 6c65 5b5b 7475 706c  | Callable[[tupl
+00024320: 655b 696e 742c 202e 2e2e 5d5d 2c20 6e70  e[int, ...]], np
+00024330: 2e6e 6461 7272 6179 5d2c 0d0a 2020 2020  .ndarray],..    
+00024340: 2020 2020 6d61 785f 6974 6572 3a20 696e      max_iter: in
+00024350: 7420 3d20 3530 2c0d 0a20 2020 2020 2020  t = 50,..       
+00024360: 206c 6d64 3a20 666c 6f61 7420 3d20 3165   lmd: float = 1e
+00024370: 2d33 2c0d 0a20 2020 2020 2020 2074 6f6c  -3,..        tol
+00024380: 3a20 666c 6f61 7420 3d20 3165 2d33 2c0d  : float = 1e-3,.
+00024390: 0a20 2020 2020 2020 2065 7073 3a20 666c  .        eps: fl
+000243a0: 6f61 7420 3d20 3165 2d35 2c0d 0a20 2020  oat = 1e-5,..   
+000243b0: 2020 2020 202a 2c0d 0a20 2020 2020 2020       *,..       
+000243c0: 2064 696d 733a 2044 696d 7320 3d20 4e6f   dims: Dims = No
+000243d0: 6e65 2c0d 0a20 2020 2020 2020 2075 7064  ne,..        upd
+000243e0: 6174 653a 2062 6f6f 6c20 3d20 4661 6c73  ate: bool = Fals
+000243f0: 650d 0a20 2020 2029 202d 3e20 496d 6741  e..    ) -> ImgA
+00024400: 7272 6179 3a0d 0a20 2020 2020 2020 2072  rray:..        r
+00024410: 2222 220d 0a20 2020 2020 2020 2044 6563  """..        Dec
+00024420: 6f6e 766f 6c75 7469 6f6e 206f 6620 4e2d  onvolution of N-
+00024430: 6469 6d65 6e73 696f 6e61 6c20 696d 6167  dimensional imag
+00024440: 652c 2075 7369 6e67 2052 6963 6861 7264  e, using Richard
+00024450: 736f 6e2d 4c75 6379 2773 2061 6c67 6f72  son-Lucy's algor
+00024460: 6974 686d 2077 6974 680d 0a20 2020 2020  ithm with..     
+00024470: 2020 2074 6f74 616c 2076 6172 6961 6e63     total varianc
+00024480: 6520 7265 6775 6c61 7269 7a61 7469 6f6e  e regularization
+00024490: 2028 736f 2063 616c 6c65 6420 524c 2d54   (so called RL-T
+000244a0: 5620 616c 676f 7269 7468 6d29 2e20 5468  V algorithm). Th
+000244b0: 6520 5456 2072 6567 756c 6172 697a 6174  e TV regularizat
+000244c0: 696f 6e0d 0a20 2020 2020 2020 2066 6163  ion..        fac
+000244d0: 746f 7220 6174 2070 6978 656c 2070 6f73  tor at pixel pos
+000244e0: 6974 696f 6e20 3a6d 6174 683a 6078 602c  ition :math:`x`,
+000244f0: 203a 6d61 7468 3a60 465f 7b72 6567 7d28   :math:`F_{reg}(
+00024500: 7829 602c 2069 7320 6361 6c63 756c 6174  x)`, is calculat
+00024510: 6564 2061 733a 0d0a 2020 2020 2020 2020  ed as:..        
+00024520: 0d0a 2020 2020 2020 2020 2e2e 206d 6174  ..        .. mat
+00024530: 683a 3a0d 0a20 2020 2020 2020 2020 2020  h::..           
+00024540: 200d 0a20 2020 2020 2020 2020 2020 2046   ..            F
+00024550: 5f7b 7265 677d 2878 2920 3d20 5c66 7261  _{reg}(x) = \fra
+00024560: 637b 317d 7b31 2d5c 6c61 6d62 6461 205c  c{1}{1-\lambda \
+00024570: 6364 6f74 2064 6976 285c 6672 6163 7b67  cdot div(\frac{g
+00024580: 7261 6428 4928 7829 7d7b 7c67 7261 6428  rad(I(x)}{|grad(
+00024590: 4928 7829 297c 7d29 7d0d 0a20 2020 2020  I(x))|})}..     
+000245a0: 2020 200d 0a20 2020 2020 2020 2028 3a6d     ..        (:m
+000245b0: 6174 683a 6049 2878 2960 3a20 696d 6167  ath:`I(x)`: imag
+000245c0: 652c 203a 6d61 7468 3a60 5c6c 616d 6264  e, :math:`\lambd
+000245d0: 6160 3a20 636f 6e73 7461 6e74 290d 0a20  a`: constant).. 
+000245e0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000245f0: 2061 6e64 2074 6869 7320 6661 6374 6f72   and this factor
+00024600: 2069 7320 6d75 6c74 6970 6c69 6564 2066   is multiplied f
+00024610: 6f72 2065 7665 7279 2065 7374 696d 6174  or every estimat
+00024620: 696f 6e20 6d61 6465 2069 6e20 6561 6368  ion made in each
+00024630: 2069 7465 7261 7469 6f6e 2e0d 0a20 2020   iteration...   
+00024640: 2020 2020 200d 0a20 2020 2020 2020 2050       ..        P
+00024650: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+00024660: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+00024670: 2020 2020 2020 2070 7366 203a 206e 6461         psf : nda
+00024680: 7272 6179 206f 7220 6361 6c6c 6162 6c65  rray or callable
+00024690: 0d0a 2020 2020 2020 2020 2020 2020 506f  ..            Po
+000246a0: 696e 7420 7370 7265 6164 2066 756e 6374  int spread funct
+000246b0: 696f 6e2e 2049 6620 6120 6675 6e63 7469  ion. If a functi
+000246c0: 6f6e 2069 7320 6769 7665 6e2c 2060 7073  on is given, `ps
+000246d0: 6628 7368 6170 6529 6020 7769 6c6c 2062  f(shape)` will b
+000246e0: 650d 0a20 2020 2020 2020 2020 2020 2063  e..            c
+000246f0: 616c 6c65 6420 746f 2067 656e 6572 6174  alled to generat
+00024700: 6520 7468 6520 5053 462e 0d0a 2020 2020  e the PSF...    
+00024710: 2020 2020 6d61 785f 6974 6572 203a 2069      max_iter : i
+00024720: 6e74 2c20 6465 6661 756c 7420 6973 2035  nt, default is 5
+00024730: 302e 0d0a 2020 2020 2020 2020 2020 2020  0...            
+00024740: 4d61 7869 6d75 6d20 6e75 6d62 6572 206f  Maximum number o
+00024750: 6620 6974 6572 6174 696f 6e73 2e0d 0a20  f iterations... 
+00024760: 2020 2020 2020 206c 6d64 203a 2066 6c6f         lmd : flo
+00024770: 6174 2c20 6465 6661 756c 7420 6973 2031  at, default is 1
+00024780: 652d 330d 0a20 2020 2020 2020 2020 2020  e-3..           
+00024790: 2054 6865 2063 6f6e 7374 616e 7420 6c61   The constant la
+000247a0: 6d62 6461 206f 6620 5456 2072 6567 756c  mbda of TV regul
+000247b0: 6172 697a 6174 696f 6e20 6661 6374 6f72  arization factor
+000247c0: 2e0d 0a20 2020 2020 2020 2074 6f6c 203a  ...        tol :
+000247d0: 2066 6c6f 6174 2c20 6465 6661 756c 7420   float, default 
+000247e0: 6973 2031 652d 330d 0a20 2020 2020 2020  is 1e-3..       
+000247f0: 2020 2020 2049 7465 7261 7469 6f6e 2073       Iteration s
+00024800: 746f 7073 2069 6620 7265 6775 6c61 7269  tops if regulari
+00024810: 7a65 6420 6162 736f 6c75 7465 2073 756d  zed absolute sum
+00024820: 6d61 7469 6f6e 2069 7320 6c6f 7765 7220  mation is lower 
+00024830: 7468 616e 2074 6869 7320 0d0a 2020 2020  than this ..    
+00024840: 2020 2020 2020 2020 7661 6c75 652e 0d0a          value...
+00024850: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00024860: 2020 2020 2020 2020 2020 3a6d 6174 683a            :math:
+00024870: 605c 6672 6163 7b5c 7375 6d5f 7b78 7d7c  `\frac{\sum_{x}|
+00024880: 4927 2878 2920 2d20 4928 7829 7c7d 7b5c  I'(x) - I(x)|}{\
+00024890: 7375 6d5f 7b78 7d7c 4928 7829 7c7d 600d  sum_{x}|I(x)|}`.
+000248a0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+000248b0: 2020 2020 2020 2020 2020 2028 3a6d 6174             (:mat
+000248c0: 683a 6049 2728 7829 603a 2065 7374 696d  h:`I'(x)`: estim
+000248d0: 6174 696f 6e20 6f66 203a 6d61 7468 3a60  ation of :math:`
+000248e0: 6b2b 3160 2d74 6820 6974 6572 6174 696f  k+1`-th iteratio
+000248f0: 6e2c 203a 6d61 7468 3a60 4928 7829 603a  n, :math:`I(x)`:
+00024900: 200d 0a20 2020 2020 2020 2020 2020 2065   ..            e
+00024910: 7374 696d 6174 696f 6e20 6f66 203a 6d61  stimation of :ma
+00024920: 7468 3a60 6b60 2d74 6820 6974 6572 6174  th:`k`-th iterat
+00024930: 696f 6e29 0d0a 2020 2020 2020 2020 0d0a  ion)..        ..
+00024940: 2020 2020 2020 2020 6570 7320 3a20 666c          eps : fl
+00024950: 6f61 742c 2064 6566 6175 6c74 2069 7320  oat, default is 
+00024960: 3165 2d35 0d0a 2020 2020 2020 2020 2020  1e-5..          
+00024970: 2020 4475 7269 6e67 2064 6563 6f6e 766f    During deconvo
+00024980: 6c75 7469 6f6e 2c20 6469 7669 7369 6f6e  lution, division
+00024990: 2062 7920 736d 616c 6c20 7661 6c75 6573   by small values
+000249a0: 2069 6e20 7468 6520 636f 6e76 6f6c 7665   in the convolve
+000249b0: 2069 6d61 6765 206f 660d 0a20 2020 2020   image of..     
+000249c0: 2020 2020 2020 2065 7374 696d 6174 696f         estimatio
+000249d0: 6e20 616e 6420 5053 4620 6d61 7920 6361  n and PSF may ca
+000249e0: 7573 6520 6469 7665 7267 656e 6365 2e20  use divergence. 
+000249f0: 5468 6572 6566 6f72 652c 2064 6976 6973  Therefore, divis
+00024a00: 696f 6e20 6279 2076 616c 7565 7320 0d0a  ion by values ..
+00024a10: 2020 2020 2020 2020 2020 2020 756e 6465              unde
+00024a20: 7220 6060 6570 7360 6020 6973 2073 7562  r ``eps`` is sub
+00024a30: 7374 6974 7574 6564 2074 6f20 7a65 726f  stituted to zero
+00024a40: 2e0d 0a20 2020 2020 2020 207b 6469 6d73  ...        {dims
+00024a50: 7d7b 7570 6461 7465 7d0d 0a20 2020 2020  }{update}..     
+00024a60: 2020 200d 0a20 2020 2020 2020 2052 6574     ..        Ret
+00024a70: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
+00024a80: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2049  -----..        I
+00024a90: 6d67 4172 7261 790d 0a20 2020 2020 2020  mgArray..       
+00024aa0: 2020 2020 2044 6563 6f6e 766f 6c76 6564       Deconvolved
+00024ab0: 2069 6d61 6765 2e0d 0a20 2020 2020 2020   image...       
+00024ac0: 200d 0a20 2020 2020 2020 2052 6566 6572   ..        Refer
+00024ad0: 656e 6365 730d 0a20 2020 2020 2020 202d  ences..        -
+00024ae0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
+00024af0: 2020 202d 2044 6579 2c20 4e2e 2c20 426c     - Dey, N., Bl
+00024b00: 616e 632d 46c3 a972 6175 642c 204c 2e2c  anc-F..raud, L.,
+00024b10: 205a 696d 6d65 722c 2043 2e2c 2052 6f75   Zimmer, C., Rou
+00024b20: 782c 2050 2e2c 204b 616d 2c20 5a2e 2c20  x, P., Kam, Z., 
+00024b30: 4f6c 6976 6f2d 4d61 7269 6e2c 204a 2e20  Olivo-Marin, J. 
+00024b40: 432e 2c20 0d0a 2020 2020 2020 2020 2020  C., ..          
+00024b50: 2620 5a65 7275 6269 612c 204a 2e20 2832  & Zerubia, J. (2
+00024b60: 3030 3429 2e20 3344 206d 6963 726f 7363  004). 3D microsc
+00024b70: 6f70 7920 6465 636f 6e76 6f6c 7574 696f  opy deconvolutio
+00024b80: 6e20 7573 696e 6720 5269 6368 6172 6473  n using Richards
+00024b90: 6f6e 2d4c 7563 7920 616c 676f 7269 7468  on-Lucy algorith
+00024ba0: 6d20 0d0a 2020 2020 2020 2020 2020 7769  m ..          wi
+00024bb0: 7468 2074 6f74 616c 2076 6172 6961 7469  th total variati
+00024bc0: 6f6e 2072 6567 756c 6172 697a 6174 696f  on regularizatio
+00024bd0: 6e20 2844 6f63 746f 7261 6c20 6469 7373  n (Doctoral diss
+00024be0: 6572 7461 7469 6f6e 2c20 494e 5249 4129  ertation, INRIA)
+00024bf0: 2e0d 0a20 2020 2020 2020 200d 0a20 2020  ...        ..   
+00024c00: 2020 2020 2053 6565 2041 6c73 6f0d 0a20       See Also.. 
+00024c10: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0d         --------.
+00024c20: 0a20 2020 2020 2020 206c 7563 790d 0a20  .        lucy.. 
+00024c30: 2020 2020 2020 2077 6965 6e65 720d 0a20         wiener.. 
+00024c40: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00024c50: 2020 2020 6966 206c 6d64 203c 3d20 303a      if lmd <= 0:
+00024c60: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00024c70: 6973 6520 5661 6c75 6545 7272 6f72 280d  ise ValueError(.
+00024c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024c90: 2022 496e 2052 6963 6861 6473 6f6e 2d4c   "In Richadson-L
+00024ca0: 7563 7920 7769 7468 2074 6f74 616c 2d76  ucy with total-v
+00024cb0: 6172 6961 6e63 652d 7265 6775 6c61 7269  ariance-regulari
+00024cc0: 7a61 7469 6f6e 2c20 220d 0a20 2020 2020  zation, "..     
+00024cd0: 2020 2020 2020 2020 2020 2022 7061 7261             "para
+00024ce0: 6d65 7465 7220 606c 6d64 6020 6d75 7374  meter `lmd` must
+00024cf0: 2062 6520 706f 7369 7469 7665 2e22 0d0a   be positive."..
+00024d00: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00024d10: 2020 2020 2020 2070 7366 5f66 742c 2070         psf_ft, p
+00024d20: 7366 5f66 745f 636f 6e6a 203d 205f 6465  sf_ft_conj = _de
+00024d30: 636f 6e76 2e63 6865 636b 5f70 7366 280d  conv.check_psf(.
+00024d40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00024d50: 662e 7369 7a65 736f 6628 6469 6d73 292c  f.sizesof(dims),
+00024d60: 2074 7570 6c65 2873 656c 662e 7363 616c   tuple(self.scal
+00024d70: 655b 6178 6973 5d20 666f 7220 6178 6973  e[axis] for axis
+00024d80: 2069 6e20 6469 6d73 292c 2070 7366 0d0a   in dims), psf..
+00024d90: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+00024da0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00024db0: 2e5f 6170 706c 795f 6461 736b 280d 0a20  ._apply_dask(.. 
+00024dc0: 2020 2020 2020 2020 2020 205f 6465 636f             _deco
+00024dd0: 6e76 2e72 6963 6861 7264 736f 6e5f 6c75  nv.richardson_lu
+00024de0: 6379 5f74 762c 200d 0a20 2020 2020 2020  cy_tv, ..       
+00024df0: 2020 2020 2063 5f61 7865 733d 636f 6d70       c_axes=comp
+00024e00: 6c65 6d65 6e74 5f61 7865 7328 6469 6d73  lement_axes(dims
+00024e10: 2c20 7365 6c66 2e61 7865 7329 2c0d 0a20  , self.axes),.. 
+00024e20: 2020 2020 2020 2020 2020 2061 7267 733d             args=
+00024e30: 2870 7366 5f66 742c 2070 7366 5f66 745f  (psf_ft, psf_ft_
+00024e40: 636f 6e6a 2c20 6d61 785f 6974 6572 2c20  conj, max_iter, 
+00024e50: 6c6d 642c 2074 6f6c 2c20 6570 7329 0d0a  lmd, tol, eps)..
+00024e60: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+00024e70: 2040 5f64 6f63 732e 7772 6974 655f 646f   @_docs.write_do
+00024e80: 6373 0d0a 2020 2020 4064 696d 735f 746f  cs..    @dims_to
+00024e90: 5f73 7061 7469 616c 5f61 7865 730d 0a20  _spatial_axes.. 
+00024ea0: 2020 2040 7361 6d65 5f64 7479 7065 2861     @same_dtype(a
+00024eb0: 7366 6c6f 6174 3d54 7275 6529 0d0a 2020  sfloat=True)..  
+00024ec0: 2020 4063 6865 636b 5f69 6e70 7574 5f61    @check_input_a
+00024ed0: 6e64 5f6f 7574 7075 740d 0a20 2020 2064  nd_output..    d
+00024ee0: 6566 2074 696c 6564 5f6c 7563 7928 0d0a  ef tiled_lucy(..
+00024ef0: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
+00024f00: 2020 2020 2020 2070 7366 3a20 6e70 2e6e         psf: np.n
+00024f10: 6461 7272 6179 207c 2043 616c 6c61 626c  darray | Callabl
+00024f20: 655b 5b74 7570 6c65 5b69 6e74 2c20 2e2e  e[[tuple[int, ..
+00024f30: 2e5d 5d2c 206e 702e 6e64 6172 7261 795d  .]], np.ndarray]
+00024f40: 2c0d 0a20 2020 2020 2020 206e 6974 6572  ,..        niter
+00024f50: 3a20 696e 7420 3d20 3530 2c0d 0a20 2020  : int = 50,..   
+00024f60: 2020 2020 2065 7073 3a20 666c 6f61 7420       eps: float 
+00024f70: 3d20 3165 2d35 2c0d 0a20 2020 2020 2020  = 1e-5,..       
+00024f80: 2063 6875 6e6b 7320 3d20 2261 7574 6f22   chunks = "auto"
+00024f90: 2c0d 0a20 2020 2020 2020 206f 7665 726c  ,..        overl
+00024fa0: 6170 3a20 696e 7420 3d20 3332 2c0d 0a20  ap: int = 32,.. 
+00024fb0: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
+00024fc0: 0d0a 2020 2020 2920 2d3e 2049 6d67 4172  ..    ) -> ImgAr
+00024fd0: 7261 793a 0d0a 2020 2020 2020 2020 7761  ray:..        wa
+00024fe0: 726e 696e 6773 2e77 6172 6e28 0d0a 2020  rnings.warn(..  
+00024ff0: 2020 2020 2020 2020 2020 2260 7469 6c65            "`tile
+00025000: 645f 6c75 6379 6020 6973 2064 6570 7265  d_lucy` is depre
+00025010: 6361 7465 6420 506c 6561 7365 2075 7365  cated Please use
+00025020: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+00025030: 6622 6069 6d67 2e74 696c 6564 287b 6368  f"`img.tiled({ch
+00025040: 756e 6b73 3d7d 2c20 7b6f 7665 726c 6170  unks=}, {overlap
+00025050: 3d7d 292e 6c75 6379 282e 2e2e 2960 2069  =}).lucy(...)` i
+00025060: 6e73 7465 6164 2e22 2c0d 0a20 2020 2020  nstead.",..     
+00025070: 2020 2020 2020 2044 6570 7265 6361 7469         Deprecati
+00025080: 6f6e 5761 726e 696e 672c 0d0a 2020 2020  onWarning,..    
+00025090: 2020 2020 290d 0a20 2020 2020 2020 2072      )..        r
+000250a0: 6574 7572 6e20 7365 6c66 2e74 696c 6564  eturn self.tiled
+000250b0: 2863 6875 6e6b 732c 206f 7665 726c 6170  (chunks, overlap
+000250c0: 292e 6c75 6379 2870 7366 2c20 6e69 7465  ).lucy(psf, nite
+000250d0: 722c 2065 7073 290d 0a0d 0a64 6566 205f  r, eps)....def _
+000250e0: 6368 6563 6b5f 636f 6f72 6469 6e61 7465  check_coordinate
+000250f0: 7328 636f 6f72 6473 2c20 696d 673a 2049  s(coords, img: I
+00025100: 6d67 4172 7261 792c 2064 696d 733a 2044  mgArray, dims: D
+00025110: 696d 7320 3d20 4e6f 6e65 293a 0d0a 2020  ims = None):..  
+00025120: 2020 6672 6f6d 2069 6d70 792e 6672 616d    from impy.fram
+00025130: 6520 696d 706f 7274 204d 6172 6b65 7246  e import MarkerF
+00025140: 7261 6d65 0d0a 0d0a 2020 2020 6966 206e  rame....    if n
+00025150: 6f74 2069 7369 6e73 7461 6e63 6528 636f  ot isinstance(co
+00025160: 6f72 6473 2c20 4d61 726b 6572 4672 616d  ords, MarkerFram
+00025170: 6529 3a0d 0a20 2020 2020 2020 2063 6f6f  e):..        coo
+00025180: 7264 7320 3d20 6e70 2e61 7361 7272 6179  rds = np.asarray
+00025190: 2863 6f6f 7264 7329 0d0a 2020 2020 2020  (coords)..      
+000251a0: 2020 6966 2063 6f6f 7264 732e 6e64 696d    if coords.ndim
+000251b0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+000251c0: 2020 2020 636f 6f72 6473 203d 2063 6f6f      coords = coo
+000251d0: 7264 732e 7265 7368 6170 6528 312c 202d  rds.reshape(1, -
+000251e0: 3129 0d0a 2020 2020 2020 2020 656c 6966  1)..        elif
+000251f0: 2063 6f6f 7264 732e 6e64 696d 2021 3d20   coords.ndim != 
+00025200: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
+00025210: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00025220: 2822 496e 7075 7420 6361 6e6e 6f74 2062  ("Input cannot b
+00025230: 6520 696e 7465 7270 7265 7465 6420 6173  e interpreted as
+00025240: 2063 6f6f 7264 696e 6174 6528 7329 2e22   coordinate(s)."
+00025250: 290d 0a20 2020 2020 2020 2069 6620 6469  )..        if di
+00025260: 6d73 2069 7320 4e6f 6e65 3a0d 0a20 2020  ms is None:..   
+00025270: 2020 2020 2020 2020 206e 6469 6d20 3d20           ndim = 
+00025280: 636f 6f72 6473 2e73 6861 7065 5b31 5d0d  coords.shape[1].
+00025290: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000252a0: 6e64 696d 203d 3d20 696d 672e 6e64 696d  ndim == img.ndim
+000252b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000252c0: 2020 2064 696d 7320 3d20 696d 672e 6178     dims = img.ax
+000252d0: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
+000252e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000252f0: 2020 2020 2020 2064 696d 7320 3d20 636f         dims = co
+00025300: 6d70 6c65 6d65 6e74 5f61 7865 7328 2263  mplement_axes("c
+00025310: 222c 2069 6d67 2e61 7865 7329 5b2d 6e64  ", img.axes)[-nd
+00025320: 696d 3a5d 0d0a 2020 2020 2020 2020 636f  im:]..        co
+00025330: 6f72 6473 203d 204d 6172 6b65 7246 7261  ords = MarkerFra
+00025340: 6d65 2863 6f6f 7264 732c 2063 6f6c 756d  me(coords, colum
+00025350: 6e73 3d64 696d 732c 2064 7479 7065 3d6e  ns=dims, dtype=n
+00025360: 702e 7569 6e74 3136 290d 0a20 2020 2020  p.uint16)..     
+00025370: 2020 2063 6f6f 7264 732e 7365 745f 7363     coords.set_sc
+00025380: 616c 6528 696d 6729 0d0a 2020 2020 0d0a  ale(img)..    ..
+00025390: 2020 2020 7265 7475 726e 2063 6f6f 7264      return coord
+000253a0: 730d 0a0d 0a64 6566 205f 6368 6563 6b5f  s....def _check_
+000253b0: 6675 6e63 7469 6f6e 2866 756e 6329 3a0d  function(func):.
+000253c0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+000253d0: 6365 2866 756e 632c 2073 7472 293a 0d0a  ce(func, str):..
+000253e0: 2020 2020 2020 2020 6675 6e63 203d 2067          func = g
+000253f0: 6574 6174 7472 286e 702c 2066 756e 632c  etattr(np, func,
+00025400: 204e 6f6e 6529 0d0a 2020 2020 6966 2063   None)..    if c
+00025410: 616c 6c61 626c 6528 6675 6e63 293a 0d0a  allable(func):..
+00025420: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00025430: 756e 630d 0a20 2020 2065 6c73 653a 0d0a  unc..    else:..
+00025440: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00025450: 7065 4572 726f 7228 224d 7573 7420 6265  peError("Must be
+00025460: 206f 6e65 206f 6620 6e75 6d70 7920 6d65   one of numpy me
+00025470: 7468 6f64 7320 6f72 2063 616c 6c61 626c  thods or callabl
+00025480: 6520 6f62 6a65 6374 2e22 290d 0a20 2020  e object.")..   
+00025490: 200d 0a64 6566 205f 6368 6563 6b5f 6267   ..def _check_bg
+000254a0: 2869 6d67 3a20 496d 6741 7272 6179 2c20  (img: ImgArray, 
+000254b0: 6267 293a 0d0a 2020 2020 2320 6465 7465  bg):..    # dete
+000254c0: 726d 696e 6520 6267 0d0a 2020 2020 6966  rmine bg..    if
+000254d0: 2062 6720 6973 204e 6f6e 653a 0d0a 2020   bg is None:..  
+000254e0: 2020 2020 2020 6267 203d 2069 6d67 2e6d        bg = img.m
+000254f0: 696e 2829 0d0a 2020 2020 656c 6966 2069  in()..    elif i
+00025500: 7369 6e73 7461 6e63 6528 6267 2c20 7374  sinstance(bg, st
+00025510: 7229 2061 6e64 2062 672e 656e 6473 7769  r) and bg.endswi
+00025520: 7468 2822 2522 293a 0d0a 2020 2020 2020  th("%"):..      
+00025530: 2020 6267 203d 206e 702e 7065 7263 656e    bg = np.percen
+00025540: 7469 6c65 2869 6d67 2e76 616c 7565 2c20  tile(img.value, 
+00025550: 666c 6f61 7428 6267 5b3a 2d31 5d29 290d  float(bg[:-1])).
+00025560: 0a20 2020 2065 6c69 6620 6e6f 7420 6e70  .    elif not np
+00025570: 2e69 7373 6361 6c61 7228 6267 293a 0d0a  .isscalar(bg):..
+00025580: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00025590: 7065 4572 726f 7228 2257 726f 6e67 2074  peError("Wrong t
+000255a0: 7970 6520 6f66 2060 6267 602e 2229 0d0a  ype of `bg`.")..
+000255b0: 2020 2020 7265 7475 726e 2062 670d 0a0d      return bg...
+000255c0: 0a64 6566 205f 6368 6563 6b5f 7465 6d70  .def _check_temp
+000255d0: 6c61 7465 2874 656d 706c 6174 6529 3a0d  late(template):.
+000255e0: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
+000255f0: 7374 616e 6365 2874 656d 706c 6174 652c  stance(template,
+00025600: 206e 702e 6e64 6172 7261 7929 3a0d 0a20   np.ndarray):.. 
+00025610: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00025620: 6545 7272 6f72 2866 2260 7465 6d70 6c61  eError(f"`templa
+00025630: 7465 6020 6d75 7374 2062 6520 6e70 2e6e  te` must be np.n
+00025640: 6461 7272 6179 2c20 6275 7420 676f 7420  darray, but got 
+00025650: 7b74 7970 6528 7465 6d70 6c61 7465 297d  {type(template)}
+00025660: 2229 0d0a 2020 2020 656c 6966 2074 656d  ")..    elif tem
+00025670: 706c 6174 652e 6e64 696d 206e 6f74 2069  plate.ndim not i
+00025680: 6e20 2832 2c20 3329 3a0d 0a20 2020 2020  n (2, 3):..     
+00025690: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000256a0: 726f 7228 2260 7465 6d70 6c61 7465 206d  ror("`template m
+000256b0: 7573 7420 6265 2032 206f 7220 3320 6469  ust be 2 or 3 di
+000256c0: 6d65 6e73 696f 6e61 6c2e 6022 290d 0a20  mensional.`").. 
+000256d0: 2020 2074 656d 706c 6174 6520 3d20 6e70     template = np
+000256e0: 2e61 7361 7272 6179 2874 656d 706c 6174  .asarray(templat
+000256f0: 6529 2e61 7374 7970 6528 6e70 2e66 6c6f  e).astype(np.flo
+00025700: 6174 3332 2c20 636f 7079 3d54 7275 6529  at32, copy=True)
+00025710: 0d0a 2020 2020 7265 7475 726e 2074 656d  ..    return tem
+00025720: 706c 6174 650d 0a0d 0a64 6566 205f 6361  plate....def _ca
+00025730: 6c63 5f63 656e 7472 6f69 6428 696d 673a  lc_centroid(img:
+00025740: 206e 702e 6e64 6172 7261 792c 206e 6469   np.ndarray, ndi
+00025750: 6d3a 2069 6e74 2920 2d3e 206e 702e 6e64  m: int) -> np.nd
+00025760: 6172 7261 793a 0d0a 2020 2020 6d6f 6d20  array:..    mom 
+00025770: 3d20 736b 6d65 732e 6d6f 6d65 6e74 7328  = skmes.moments(
+00025780: 696d 672c 206f 7264 6572 3d31 290d 0a20  img, order=1).. 
+00025790: 2020 2063 656e 7472 6f69 6420 3d20 6e70     centroid = np
+000257a0: 2e61 7272 6179 285b 6d6f 6d5b 2830 2c29  .array([mom[(0,)
+000257b0: 2a69 202b 2028 312c 2920 2b20 2830 2c29  *i + (1,) + (0,)
+000257c0: 2a28 6e64 696d 2d69 2d31 295d 200d 0a20  *(ndim-i-1)] .. 
+000257d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257e0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+000257f0: 7261 6e67 6528 6e64 696d 295d 2920 2f20  range(ndim)]) / 
+00025800: 6d6f 6d5b 2830 2c29 2a6e 6469 6d5d 0d0a  mom[(0,)*ndim]..
+00025810: 2020 2020 7265 7475 726e 2063 656e 7472      return centr
+00025820: 6f69 640d 0a0d 0a64 6566 205f 6368 6563  oid....def _chec
+00025830: 6b5f 636c 6970 5f72 616e 6765 2869 6e5f  k_clip_range(in_
+00025840: 7261 6e67 652c 2069 6d67 2920 2d3e 2074  range, img) -> t
+00025850: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
+00025860: 745d 3a0d 0a20 2020 2022 2222 0d0a 2020  t]:..    """..  
+00025870: 2020 4361 6c6c 6564 2069 6e20 636c 6970    Called in clip
+00025880: 5f6f 7574 6c69 6572 7328 2920 616e 6420  _outliers() and 
+00025890: 7265 7363 616c 655f 696e 7465 6e73 6974  rescale_intensit
+000258a0: 7928 292e 0d0a 2020 2020 2222 2220 2020  y()...    """   
+000258b0: 200d 0a20 2020 206c 6f77 6572 2c20 7570   ..    lower, up
+000258c0: 7065 7220 3d20 696e 5f72 616e 6765 0d0a  per = in_range..
+000258d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000258e0: 6528 6c6f 7765 722c 2073 7472 2920 616e  e(lower, str) an
+000258f0: 6420 6c6f 7765 722e 656e 6473 7769 7468  d lower.endswith
+00025900: 2822 2522 293a 0d0a 2020 2020 2020 2020  ("%"):..        
+00025910: 6c6f 7765 7220 3d20 666c 6f61 7428 6c6f  lower = float(lo
+00025920: 7765 725b 3a2d 315d 290d 0a20 2020 2020  wer[:-1])..     
+00025930: 2020 206c 6f77 6572 6c69 6d20 3d20 6e70     lowerlim = np
+00025940: 2e70 6572 6365 6e74 696c 6528 696d 672c  .percentile(img,
+00025950: 206c 6f77 6572 290d 0a20 2020 2065 6c69   lower)..    eli
+00025960: 6620 6c6f 7765 7220 6973 204e 6f6e 653a  f lower is None:
+00025970: 0d0a 2020 2020 2020 2020 6c6f 7765 726c  ..        lowerl
+00025980: 696d 203d 206e 702e 6d69 6e28 696d 6729  im = np.min(img)
+00025990: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+000259a0: 2020 2020 206c 6f77 6572 6c69 6d20 3d20       lowerlim = 
+000259b0: 666c 6f61 7428 6c6f 7765 7229 0d0a 2020  float(lower)..  
+000259c0: 2020 0d0a 2020 2020 6966 2069 7369 6e73    ..    if isins
+000259d0: 7461 6e63 6528 7570 7065 722c 2073 7472  tance(upper, str
+000259e0: 2920 616e 6420 7570 7065 722e 656e 6473  ) and upper.ends
+000259f0: 7769 7468 2822 2522 293a 0d0a 2020 2020  with("%"):..    
+00025a00: 2020 2020 7570 7065 7220 3d20 666c 6f61      upper = floa
+00025a10: 7428 7570 7065 725b 3a2d 315d 290d 0a20  t(upper[:-1]).. 
+00025a20: 2020 2020 2020 2075 7070 6572 6c69 6d20         upperlim 
+00025a30: 3d20 6e70 2e70 6572 6365 6e74 696c 6528  = np.percentile(
+00025a40: 696d 672c 2075 7070 6572 290d 0a20 2020  img, upper)..   
+00025a50: 2065 6c69 6620 7570 7065 7220 6973 204e   elif upper is N
+00025a60: 6f6e 653a 0d0a 2020 2020 2020 2020 7570  one:..        up
+00025a70: 7065 726c 696d 203d 206e 702e 6d61 7828  perlim = np.max(
+00025a80: 696d 6729 0d0a 2020 2020 656c 7365 3a0d  img)..    else:.
+00025a90: 0a20 2020 2020 2020 2075 7070 6572 6c69  .        upperli
+00025aa0: 6d20 3d20 666c 6f61 7428 7570 7065 7229  m = float(upper)
+00025ab0: 0d0a 2020 2020 0d0a 2020 2020 6966 206c  ..    ..    if l
+00025ac0: 6f77 6572 6c69 6d20 3e3d 2075 7070 6572  owerlim >= upper
+00025ad0: 6c69 6d3a 0d0a 2020 2020 2020 2020 7261  lim:..        ra
+00025ae0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00025af0: 226c 6f77 6572 6c69 6d20 6973 206c 6172  "lowerlim is lar
+00025b00: 6765 7220 7468 616e 2075 7070 6572 6c69  ger than upperli
+00025b10: 6d3a 207b 6c6f 7765 726c 696d 7d20 3e3d  m: {lowerlim} >=
+00025b20: 207b 7570 7065 726c 696d 7d22 290d 0a20   {upperlim}").. 
+00025b30: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
+00025b40: 6c6f 7765 726c 696d 2c20 7570 7065 726c  lowerlim, upperl
+00025b50: 696d 0d0a 0d0a 6465 6620 5f73 7065 6369  im....def _speci
+00025b60: 6679 5f6f 6e65 2863 656e 7465 722c 2072  fy_one(center, r
+00025b70: 6164 6975 732c 2073 6861 7065 3a74 7570  adius, shape:tup
+00025b80: 6c65 2920 2d3e 2074 7570 6c65 5b73 6c69  le) -> tuple[sli
+00025b90: 6365 5d3a 0d0a 2020 2020 736c 203d 2074  ce]:..    sl = t
+00025ba0: 7570 6c65 2873 6c69 6365 286d 6178 2830  uple(slice(max(0
+00025bb0: 2c20 7863 2d72 292c 206d 696e 2878 632b  , xc-r), min(xc+
+00025bc0: 722b 312c 2073 6829 2c20 4e6f 6e65 2920  r+1, sh), None) 
+00025bd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025be0: 2020 2020 2020 2020 2020 666f 7220 7863            for xc
+00025bf0: 2c20 722c 2073 6820 696e 207a 6970 2863  , r, sh in zip(c
+00025c00: 656e 7465 722c 2072 6164 6975 732c 2073  enter, radius, s
+00025c10: 6861 7065 2929 0d0a 2020 2020 7265 7475  hape))..    retu
+00025c20: 726e 2073 6c0d 0a0d 0a64 6566 2063 6865  rn sl....def che
+00025c30: 636b 5f66 696c 7465 725f 6675 6e63 2866  ck_filter_func(f
+00025c40: 293a 0d0a 2020 2020 6966 2066 2069 7320  ):..    if f is 
+00025c50: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2066  None:..        f
+00025c60: 203d 206c 616d 6264 6120 783a 2054 7275   = lambda x: Tru
+00025c70: 650d 0a20 2020 2065 6c69 6620 6e6f 7420  e..    elif not 
+00025c80: 6361 6c6c 6162 6c65 2866 293a 0d0a 2020  callable(f):..  
+00025c90: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00025ca0: 4572 726f 7228 2260 6669 6c74 6020 6d75  Error("`filt` mu
+00025cb0: 7374 2062 6520 6361 6c6c 6162 6c65 2e22  st be callable."
+00025cc0: 290d 0a20 2020 2072 6574 7572 6e20 660d  )..    return f.
+00025cd0: 0a0d 0a0d 0a64 6566 2077 6176 655f 6e75  .....def wave_nu
+00025ce0: 6d28 736c 3a20 736c 6963 652c 2073 3a20  m(sl: slice, s: 
+00025cf0: 696e 742c 2075 663a 2069 6e74 2920 2d3e  int, uf: int) ->
+00025d00: 2078 702e 6e64 6172 7261 793a 0d0a 2020   xp.ndarray:..  
+00025d10: 2020 2222 220d 0a20 2020 2041 2066 756e    """..    A fun
+00025d20: 6374 696f 6e20 7468 6174 206d 616b 6573  ction that makes
+00025d30: 2077 6176 6520 6e75 6d62 6572 2076 6572   wave number ver
+00025d40: 7469 6361 6c20 7665 6374 6f72 2e20 5265  tical vector. Re
+00025d50: 7475 726e 6564 2076 6563 746f 7220 7769  turned vector wi
+00025d60: 6c6c 0d0a 2020 2020 6265 205b 6b2f 732c  ll..    be [k/s,
+00025d70: 2028 6b20 2b20 312f 7566 292f 732c 2028   (k + 1/uf)/s, (
+00025d80: 6b20 2b20 322f 7566 292f 732c 202e 2e2e  k + 2/uf)/s, ...
+00025d90: 5d20 2877 6865 7265 206b 203d 2073 6c2e  ] (where k = sl.
+00025da0: 7374 6172 7429 0d0a 0d0a 2020 2020 5061  start)....    Pa
+00025db0: 7261 6d65 7465 7273 0d0a 2020 2020 2d2d  rameters..    --
+00025dc0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 736c  --------..    sl
+00025dd0: 203a 2073 6c69 6365 0d0a 2020 2020 2020   : slice..      
+00025de0: 2020 536c 6963 6520 7468 6174 2073 7065    Slice that spe
+00025df0: 6369 6679 2077 6869 6368 2070 6172 7420  cify which part 
+00025e00: 6f66 2074 6865 2069 6d61 6765 2077 696c  of the image wil
+00025e10: 6c20 6265 2074 7261 6e73 666f 726d 6564  l be transformed
+00025e20: 2e0d 0a20 2020 2073 203a 2069 6e74 0d0a  ...    s : int..
+00025e30: 2020 2020 2020 2020 5369 7a65 2061 6c6f          Size alo
+00025e40: 6e67 2063 6572 7461 696e 2064 696d 656e  ng certain dimen
+00025e50: 7369 6f6e 2e0d 0a20 2020 2075 6620 3a20  sion...    uf : 
+00025e60: 696e 740d 0a20 2020 2020 2020 2055 702d  int..        Up-
+00025e70: 7361 6d70 6c69 6e67 2066 6163 746f 7220  sampling factor 
+00025e80: 6f66 2063 6572 7461 696e 2064 696d 656e  of certain dimen
+00025e90: 7369 6f6e 2e0d 0a20 2020 2022 2222 0d0a  sion...    """..
+00025ea0: 2020 2020 7374 6172 7420 3d20 3020 6966      start = 0 if
+00025eb0: 2073 6c2e 7374 6172 7420 6973 204e 6f6e   sl.start is Non
+00025ec0: 6520 656c 7365 2073 6c2e 7374 6172 740d  e else sl.start.
+00025ed0: 0a20 2020 2073 746f 7020 3d20 7320 6966  .    stop = s if
+00025ee0: 2073 6c2e 7374 6f70 2069 7320 4e6f 6e65   sl.stop is None
+00025ef0: 2065 6c73 6520 736c 2e73 746f 700d 0a20   else sl.stop.. 
+00025f00: 2020 200d 0a20 2020 2069 6620 736c 2e73     ..    if sl.s
+00025f10: 7461 7274 2061 6e64 2073 6c2e 7374 6f70  tart and sl.stop
+00025f20: 2061 6e64 2073 7461 7274 203c 2030 2061   and start < 0 a
+00025f30: 6e64 2073 746f 7020 3e20 303a 0d0a 2020  nd stop > 0:..  
+00025f40: 2020 2020 2020 2320 6c69 6b65 2022 783d        # like "x=
+00025f50: 2d35 3a35 220d 0a20 2020 2020 2020 2070  -5:5"..        p
+00025f60: 6173 730d 0a20 2020 2065 6c73 653a 0d0a  ass..    else:..
+00025f70: 2020 2020 2020 2020 6966 202d 7320 3c20          if -s < 
+00025f80: 7374 6172 7420 3c20 303a 0d0a 2020 2020  start < 0:..    
+00025f90: 2020 2020 2020 2020 7374 6172 7420 2b3d          start +=
+00025fa0: 2073 0d0a 2020 2020 2020 2020 656c 6966   s..        elif
+00025fb0: 206e 6f74 2030 203c 3d20 7374 6172 7420   not 0 <= start 
+00025fc0: 3c20 733a 0d0a 2020 2020 2020 2020 2020  < s:..          
+00025fd0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00025fe0: 6f72 2866 2249 6e76 616c 6964 2076 616c  or(f"Invalid val
+00025ff0: 7565 2065 6e63 6f75 6e74 6572 6564 2069  ue encountered i
+00026000: 6e20 736c 6963 6520 7b73 6c7d 2e22 290d  n slice {sl}.").
+00026010: 0a20 2020 2020 2020 2069 6620 2d73 203c  .        if -s <
+00026020: 2073 746f 7020 3c3d 2030 3a0d 0a20 2020   stop <= 0:..   
+00026030: 2020 2020 2020 2020 2073 746f 7020 2b3d           stop +=
+00026040: 2073 0d0a 2020 2020 2020 2020 656c 6966   s..        elif
+00026050: 206e 6f74 2030 203c 2073 746f 7020 3c3d   not 0 < stop <=
+00026060: 2073 3a0d 0a20 2020 2020 2020 2020 2020   s:..           
+00026070: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00026080: 7228 6622 496e 7661 6c69 6420 7661 6c75  r(f"Invalid valu
+00026090: 6520 656e 636f 756e 7465 7265 6420 696e  e encountered in
+000260a0: 2073 6c69 6365 207b 736c 7d2e 2229 0d0a   slice {sl}.")..
+000260b0: 2020 2020 2020 2020 0d0a 2020 2020 6e20          ..    n 
+000260c0: 3d20 7374 6f70 202d 2073 7461 7274 0d0a  = stop - start..
+000260d0: 2020 2020 7265 7475 726e 2078 702e 6c69      return xp.li
+000260e0: 6e73 7061 6365 2873 7461 7274 2c20 7374  nspace(start, st
+000260f0: 6f70 2c20 6e2a 7566 2c20 656e 6470 6f69  op, n*uf, endpoi
+00026100: 6e74 3d46 616c 7365 295b 3a2c 206e 702e  nt=False)[:, np.
+00026110: 6e65 7761 7869 735d 0d0a                 newaxis]..
```

### Comparing `impy_array-2.2.2/impy/arrays/label.py` & `impy_array-2.2.3/impy/arrays/label.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/labeledarray.py` & `impy_array-2.2.3/impy/arrays/labeledarray.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/lazy.py` & `impy_array-2.2.3/impy/arrays/lazy.py`

 * *Files 0% similar despite different names*

```diff
@@ -1027,15 +1027,14 @@
             x1 = int(np.ceil(size / 2 * (1 + sc)))
             slices.append(f"{a}={x0}:{x1}")
 
         out = self[";".join(slices)]
         
         return out
     
-    @_docs.copy_docs(ImgArray.tiled_lowpass_filter)
     @dims_to_spatial_axes
     @check_input_and_output_lazy
     def tiled_lowpass_filter(self, cutoff: float = 0.2, order: int = 2, overlap: int = 16, *,
                              dims: Dims = None, update: bool = False) -> LazyImgArray:
         from ._utils._skimage import _get_ND_butterworth_filter
         self = self.as_float()
         c_axes = complement_axes(dims, self.axes)
@@ -1573,22 +1572,22 @@
         yield outsl
 
 # NOTE: following FFT functions needs the "resource" argument to make it work with both
 # numpy and cupy.
 @lru_cache
 def _get_fft_func(resource) -> Callable[[DaskArray], DaskArray]:
     """Get the scipy FFT function for dask."""
-    from array_api import scipy_fft
+    from impy.array_api import scipy_fft
     from dask import array as da
     
     return da.fft.fft_wrap(scipy_fft.fftn)
 
 @lru_cache
 def _get_ifft_func(resource) -> Callable[[DaskArray], DaskArray]:
     """Get the scipy IFFT function for dask."""
-    from array_api import scipy_fft
+    from impy.array_api import scipy_fft
     from dask import array as da
     
     return da.fft.fft_wrap(scipy_fft.ifftn)
```

### Comparing `impy_array-2.2.2/impy/arrays/phasearray.py` & `impy_array-2.2.3/impy/arrays/phasearray.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/specials.py` & `impy_array-2.2.3/impy/arrays/specials.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_corr.py` & `impy_array-2.2.3/impy/arrays/_utils/_corr.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_deconv.py` & `impy_array-2.2.3/impy/arrays/_utils/_deconv.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_docs.py` & `impy_array-2.2.3/impy/arrays/_utils/_docs.py`

 * *Files 20% similar despite different names*

```diff
@@ -6,21 +6,29 @@
     dims = \
         """
         dims : str or int, optional
             Spatial dimensions. If string is given, each symbol is interpeted as an axis name of spatial dimensions. If an integer is given, it is interpreted as the number of spatial dimensions. 
             For instance, ``dims="yx"`` means axes ``"y"`` and ``"x"`` are spatial dimensions and function is applied to other axes, say, ``"t"`` and/or ``"c"``. ``dims=3`` is equivalent to ``dims="zyx"``.
             """
     ,
+    
+    fourier = \
+        """
+        fourier : bool, default is False
+            Whether to run the convolution in Fourier space. This option is useful when the kernel or the image is large.
+            Note that discrete Fourier transform assumes that the image is periodic, so that if intensities of the input image are not consecutive at img[0] and img[-1], you may get some artifacts at the boundary.
+        """
+    ,
         
     update = \
         """
         update : bool, default is False
             If True, input itself is updated to the output.
             """
-        ,
+    ,
         
     radius = \
         """
         radius : float, optional
             Radius of kernel structure. For instance, if input has two spatial dimensions, ``radius=1`` gives a structure
 
                 .. code-block:: python
@@ -35,31 +43,31 @@
                 
                     [[0, 1, 1, 0], 
                      [1, 1, 1, 1],
                      [1, 1, 1, 1],
                      [0, 1, 1, 0]]
             
             """
-        ,
+    ,
         
     sigma = \
         """
         sigma : float or array of float, optional
             Standard deviation(s) of Gaussian filter. 
             If a scalar value is given, same standard deviation will applied to all the spatial dimensions.
             """
-        ,
+    ,
         
     order = \
         """
         order : int, default is 1
             Spline interpolation order. 
             For more details see `here <https://scikit-image.org/docs/dev/api/skimage.transform.html#skimage.transform.warp>`_.
             """
-        ,
+    ,
         
     squeeze = \
         """
         squeeze : bool, default is True
             If True, the redundant axis will be deleted. 
             Array with sinl0gle value will be converted to a scalar.
             """
```

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_filters.py` & `impy_array-2.2.3/impy/arrays/_utils/_filters.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,42 +1,44 @@
 from typing import Callable, TYPE_CHECKING
 import numpy as np
 from ._skimage import *
 from ._linalg import hessian_eigval
-from ...array_api import xp, cupy_dispatcher
+from impy.array_api import xp, cupy_dispatcher
 from scipy import ndimage as scipy_ndi
 
                
 __all__ = ["binary_erosion",
-           "erosion"
-           "binary_dilation",
-           "dilation",
-           "binary_opening",
-           "opening",
-           "binary_closing",
-           "closing",
-           "gaussian_filter", 
-           "median_filter",
-           "convolve",
-           "white_tophat",
-           "gaussian_laplace",
-           "spline_filter",
-           "kalman_filter",
-           "fill_hole",
-           "mean_filter",
-           "phase_mean_filter",
-           "std_filter",
-           "coef_filter",
-           "dog_filter",
-           "doh_filter",
-           "gabor_filter",
-           "skeletonize",
-           "population",
-           "ncc_filter",
-           ]
+    "erosion"
+    "binary_dilation",
+    "dilation",
+    "binary_opening",
+    "opening",
+    "binary_closing",
+    "closing",
+    "gaussian_filter", 
+    "gaussian_filter_fourier",
+    "median_filter",
+    "convolve",
+    "white_tophat",
+    "gaussian_laplace",
+    "spline_filter",
+    "kalman_filter",
+    "fill_hole",
+    "mean_filter",
+    "phase_mean_filter",
+    "std_filter",
+    "coef_filter",
+    "dog_filter",
+    "dog_filter_fourier",
+    "doh_filter",
+    "gabor_filter",
+    "skeletonize",
+    "population",
+    "ncc_filter",
+]
 
 def get_func(function_name) -> Callable[..., np.ndarray]:
     def func(*args, **kwargs):
         _f = getattr(xp.ndi, function_name, getattr(scipy_ndi, function_name))
         return cupy_dispatcher(_f)(*args, **kwargs)
     func.__name__ = function_name
     return func
@@ -51,14 +53,15 @@
 closing = get_func("grey_closing")
 gaussian_filter = get_func("gaussian_filter")
 median_filter = get_func("median_filter")
 spline_filter = get_func("spline_filter")
 convolve = get_func("convolve")
 white_tophat = get_func("white_tophat")
 gaussian_laplace = get_func("gaussian_laplace")
+_fourier_gaussian = get_func("fourier_gaussian")
 
 if TYPE_CHECKING:
     binary_erosion = scipy_ndi.binary_erosion
     erosion = scipy_ndi.grey_erosion
     binary_dilation = scipy_ndi.binary_dilation
     dilation = scipy_ndi.grey_dilation
     binary_opening = scipy_ndi.binary_opening
@@ -67,14 +70,15 @@
     closing = scipy_ndi.grey_closing
     gaussian_filter = scipy_ndi.gaussian_filter
     median_filter = scipy_ndi.median_filter
     spline_filter = scipy_ndi.spline_filter
     convolve = scipy_ndi.convolve
     white_tophat = scipy_ndi.white_tophat
     gaussian_laplace = scipy_ndi.gaussian_laplace
+    _fourier_gaussian = scipy_ndi.fourier_gaussian
 
 def kalman_filter(img_stack, gain, noise_var):
     # data is 3D or 4D
     img_stack = xp.asarray(img_stack)
     out = xp.empty_like(img_stack)
     spatial_shape = img_stack.shape[1:]
     for t, img in enumerate(img_stack):
@@ -84,14 +88,19 @@
         else:
             kalman_gain = predicted_var / (predicted_var + noise_var)
             estimate = gain*estimate + (1.0 - gain)*img + kalman_gain*(img - estimate)
             predicted_var *= 1 - kalman_gain
         out[t] = estimate
     return out
 
+def gaussian_filter_fourier(img: np.ndarray, sigma: float):
+    img_ft = xp.fft.fftn(img)
+    out_ft = _fourier_gaussian(img_ft, sigma)
+    return xp.fft.ifftn(out_ft).real
+
 def fill_hole(img: np.ndarray, mask: np.ndarray):
     from skimage.morphology import reconstruction
     seed = np.copy(img)
     seed[1:-1, 1:-1] = img.max()
     return reconstruction(seed, mask, method="erosion")
 
 def mean_filter(img, selem, mode="reflect", cval=0.0):
@@ -118,14 +127,20 @@
     return out
     
 def dog_filter(img, low_sigma, high_sigma, mode="reflect", cval=0.0):
     filt_l = gaussian_filter(img, low_sigma, mode=mode, cval=cval)
     filt_h = gaussian_filter(img, high_sigma, mode=mode, cval=cval)
     return filt_l - filt_h
 
+def dog_filter_fourier(img: np.ndarray, low_sigma: float, high_sigma: float):
+    img_ft = xp.fft.fftn(img)
+    filt_l = _fourier_gaussian(img_ft, low_sigma)
+    filt_h = _fourier_gaussian(img_ft, high_sigma)
+    return xp.fft.ifftn(filt_l - filt_h).real
+
 def doh_filter(img, sigma, pxsize):
     eigval = hessian_eigval(img, sigma, pxsize)
     eigval[eigval>0] = 0
     det = xp.abs(xp.prod(eigval, axis=-1))
     return det
 
 def gabor_filter(img: np.ndarray, ker: np.ndarray, mode="reflect", cval=0.0):
```

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_glcm.py` & `impy_array-2.2.3/impy/arrays/_utils/_glcm.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_linalg.py` & `impy_array-2.2.3/impy/arrays/_utils/_linalg.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_misc.py` & `impy_array-2.2.3/impy/arrays/_utils/_misc.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_plot.py` & `impy_array-2.2.3/impy/arrays/_utils/_plot.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_process_numba.py` & `impy_array-2.2.3/impy/arrays/_utils/_process_numba.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_skimage.py` & `impy_array-2.2.3/impy/arrays/_utils/_skimage.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_structures.py` & `impy_array-2.2.3/impy/arrays/_utils/_structures.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/_utils/_transform.py` & `impy_array-2.2.3/impy/arrays/_utils/_transform.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/bases/metaarray.py` & `impy_array-2.2.3/impy/arrays/bases/metaarray.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/arrays/bases/overload.py` & `impy_array-2.2.3/impy/arrays/bases/overload.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/axes/_axes.py` & `impy_array-2.2.3/impy/axes/_axes.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/axes/_axes_tuple.py` & `impy_array-2.2.3/impy/axes/_axes_tuple.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/axes/_axis.py` & `impy_array-2.2.3/impy/axes/_axis.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/axes/_slicer.py` & `impy_array-2.2.3/impy/axes/_slicer.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/frame/frames.py` & `impy_array-2.2.3/impy/frame/frames.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/utils/axesop.py` & `impy_array-2.2.3/impy/utils/axesop.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/utils/deco.py` & `impy_array-2.2.3/impy/utils/deco.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/utils/gauss.py` & `impy_array-2.2.3/impy/utils/gauss.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/utils/misc.py` & `impy_array-2.2.3/impy/utils/misc.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/utils/slicer.py` & `impy_array-2.2.3/impy/utils/slicer.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/viewer/utils.py` & `impy_array-2.2.3/impy/viewer/utils.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/impy/viewer/viewer.py` & `impy_array-2.2.3/impy/viewer/viewer.py`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/.gitignore` & `impy_array-2.2.3/.gitignore`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/LICENSE` & `impy_array-2.2.3/LICENSE`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/README.md` & `impy_array-2.2.3/README.md`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/pyproject.toml` & `impy_array-2.2.3/pyproject.toml`

 * *Files identical despite different names*

### Comparing `impy_array-2.2.2/PKG-INFO` & `impy_array-2.2.3/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: impy-array
-Version: 2.2.2
+Version: 2.2.3
 Summary: Speed up coding/extending image analysis in Python.
 Project-URL: Download, https://github.com/hanjinliu/impy
 Author-email: Hanjin Liu <liuhanjin-sc@g.ecc.u-tokyo.ac.jp>
 License: BSD 3-Clause License
         
         Copyright (c) 2021, hanjinliu
         All rights reserved.
```

