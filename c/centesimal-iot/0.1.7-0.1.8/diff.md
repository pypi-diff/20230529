# Comparing `tmp/centesimal_iot-0.1.7-py2.py3-none-any.whl.zip` & `tmp/centesimal_iot-0.1.8-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,26 +1,26 @@
-Zip file size: 25082 bytes, number of entries: 24
--rw-rw-r--  2.0 unx      127 b- defN 23-May-28 19:14 iot/__init__.py
+Zip file size: 25687 bytes, number of entries: 24
+-rw-rw-r--  2.0 unx      127 b- defN 23-May-29 13:29 iot/__init__.py
 -rw-rw-r--  2.0 unx      387 b- defN 23-Apr-17 09:42 iot/cli.py
 -rw-rw-r--  2.0 unx     4957 b- defN 23-Apr-17 11:32 iot/helpers.py
 -rw-rw-r--  2.0 unx       51 b- defN 23-Apr-17 09:52 iot/iot.py
 -rw-rw-r--  2.0 unx      795 b- defN 23-May-25 16:27 iot/cli/__init__.py
 -rw-rw-r--  2.0 unx     5068 b- defN 23-Apr-26 09:33 iot/cli/describe.py
--rw-rw-r--  2.0 unx     6109 b- defN 23-May-28 19:02 iot/cli/inventory.py
+-rw-rw-r--  2.0 unx     9733 b- defN 23-May-29 13:07 iot/cli/inventory.py
 -rw-rw-r--  2.0 unx     2498 b- defN 23-May-26 07:47 iot/cli/plan.py
 -rw-rw-r--  2.0 unx     2907 b- defN 23-May-23 15:23 iot/cli/real.py
 -rw-rw-r--  2.0 unx     1622 b- defN 23-Apr-26 09:31 iot/cli/roles.py
 -rw-rw-r--  2.0 unx      809 b- defN 23-Apr-27 10:06 iot/cli/run.py
 -rw-rw-r--  2.0 unx     3247 b- defN 23-May-23 15:23 iot/cli/target.py
 -rw-rw-r--  2.0 unx     3246 b- defN 23-Apr-26 17:36 iot/cli/test.py
 -rw-rw-r--  2.0 unx     1795 b- defN 23-Apr-26 09:30 iot/cli/users.py
 -rw-rw-r--  2.0 unx     3258 b- defN 23-May-23 15:23 iot/cli/watch.py
 -rw-rw-r--  2.0 unx    17520 b- defN 23-May-28 17:50 iot/cli/wingdbstub.py
 -rw-rw-r--  2.0 unx     1918 b- defN 23-Apr-26 09:35 iot/cli/workspaces.py
 -rw-rw-r--  2.0 unx     2759 b- defN 23-May-28 18:42 iot/tools/__init__.py
--rw-rw-r--  2.0 unx      162 b- defN 23-May-28 19:14 centesimal_iot-0.1.7.dist-info/AUTHORS.rst
--rw-rw-r--  2.0 unx     1222 b- defN 23-May-28 19:14 centesimal_iot-0.1.7.dist-info/METADATA
--rw-rw-r--  2.0 unx      110 b- defN 23-May-28 19:14 centesimal_iot-0.1.7.dist-info/WHEEL
--rw-rw-r--  2.0 unx       37 b- defN 23-May-28 19:14 centesimal_iot-0.1.7.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx        4 b- defN 23-May-28 19:14 centesimal_iot-0.1.7.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1841 b- defN 23-May-28 19:14 centesimal_iot-0.1.7.dist-info/RECORD
-24 files, 62449 bytes uncompressed, 22158 bytes compressed:  64.5%
+-rw-rw-r--  2.0 unx      162 b- defN 23-May-29 13:29 centesimal_iot-0.1.8.dist-info/AUTHORS.rst
+-rw-rw-r--  2.0 unx     1222 b- defN 23-May-29 13:29 centesimal_iot-0.1.8.dist-info/METADATA
+-rw-rw-r--  2.0 unx      110 b- defN 23-May-29 13:29 centesimal_iot-0.1.8.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       37 b- defN 23-May-29 13:29 centesimal_iot-0.1.8.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx        4 b- defN 23-May-29 13:29 centesimal_iot-0.1.8.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1841 b- defN 23-May-29 13:29 centesimal_iot-0.1.8.dist-info/RECORD
+24 files, 66073 bytes uncompressed, 22763 bytes compressed:  65.5%
```

## zipnote {}

```diff
@@ -48,26 +48,26 @@
 
 Filename: iot/cli/workspaces.py
 Comment: 
 
 Filename: iot/tools/__init__.py
 Comment: 
 
-Filename: centesimal_iot-0.1.7.dist-info/AUTHORS.rst
+Filename: centesimal_iot-0.1.8.dist-info/AUTHORS.rst
 Comment: 
 
-Filename: centesimal_iot-0.1.7.dist-info/METADATA
+Filename: centesimal_iot-0.1.8.dist-info/METADATA
 Comment: 
 
-Filename: centesimal_iot-0.1.7.dist-info/WHEEL
+Filename: centesimal_iot-0.1.8.dist-info/WHEEL
 Comment: 
 
-Filename: centesimal_iot-0.1.7.dist-info/entry_points.txt
+Filename: centesimal_iot-0.1.8.dist-info/entry_points.txt
 Comment: 
 
-Filename: centesimal_iot-0.1.7.dist-info/top_level.txt
+Filename: centesimal_iot-0.1.8.dist-info/top_level.txt
 Comment: 
 
-Filename: centesimal_iot-0.1.7.dist-info/RECORD
+Filename: centesimal_iot-0.1.8.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## iot/__init__.py

```diff
@@ -1,5 +1,5 @@
 """Top-level package for iot."""
 
 __author__ = """Asterio Gonzalez"""
 __email__ = 'apastor@cibernos.com'
-__version__ = '0.1.7'
+__version__ = '0.1.8'
```

## iot/cli/inventory.py

```diff
@@ -1,27 +1,31 @@
 import asyncio
 import re
 import os
+import yaml
 import click
 
 from pycelium.action import Action
 from pycelium.installer import Installer
+from pycelium.scanner import RenameHost
 from pycelium.shell import Reactor, DefaultExecutor
 from pycelium.rsync import Rsync  # forced import (late-binding)
 
 # from pycelium.pastor import Pastor
 # from pycelium.scanner import Settler
 
 from pycelium.tools import soft, expandpath, parse_uri
+from pycelium.tools.containers import deindent_by, search, simplify
 from pycelium.tools.persistence import find_files
 from pycelium.tools.cli.inventory import (
     inventory,
     credentials,
     INVENTORY_ROOT,
     explore_host,
+    explore_single_host,
     get_mac,
     get_host_tags,
     save_yaml,
 )
 from pycelium.tools.cli.config import (
     config,
     banner,
@@ -35,15 +39,15 @@
 
 
 @inventory.command()
 # @click.argument('filename', default='sample.gan')
 @click.option("--network", multiple=True)
 @click.option("--user", multiple=True)
 @click.option("--password", multiple=True)
-@click.option("--shuffle", default=False, type=bool)
+@click.option("--shuffle", default=True, type=bool)
 @click.pass_obj
 def install(env, network, user, shuffle, password):
     """
     - [ ] Gather information similar as explore
     - [ ] Install single node
     """
     config.callback()
@@ -59,43 +63,38 @@
         soft(ctx, **cfg)
         print("{_progress:.2%} {_printable_uri:>40}".format_map(ctx))
         host = ctx['host']
         if host in conquered:
             print(f"{host} is alredy conquered! :), skiping")
             continue
 
-        data = explore_host(ctx)
+        data = explore_single_host(ctx, host)
         mac = get_mac(data)
         if mac:
-            mac = mac.replace(':', '')
             ctx['observed_hostname'] = observed_hostname = (
                 data.get('observed_hostname') or host
             )
-            data = data.get('real')
-            tags = get_host_tags(data)
-            _tags = '/'.join(tags)
-            path = f"{top}/{_tags}/{observed_hostname}.{mac}.yaml"
-            print(f"saved: {path}")
-
-            save_yaml(data, path)
             conquered[host] = data
             conquered[observed_hostname] = data
 
-            # now the install part
-            tags.add(observed_hostname)
+            # now the installing part
+            tags = get_host_tags(data)
+            # tags = data['_tags']
+            tags.append(observed_hostname)
+
             install_single_node(tags, ctx)
             foo = 1
 
     foo = 1
 
 
 def install_single_node(tags, ctx):
     includes = ctx.get('includes', [])
 
-    tags.add('base')
+    tags.append('base')
     for t in tags:
         for t in re.findall(r'\w+', t):
             includes.append(f'(.*?\.)?{t}\.yaml')
 
     reactor = Reactor(env=ctx)
 
     conn = DefaultExecutor(**ctx)
@@ -224,7 +223,131 @@
     # Coded as sequence: # TODO: review
     # --------------------------------------------------
     async def _seq_10_rsync_remote(self, *args, **kw):
         executor = await self.is_connected()
         result = await executor.rsync(self.source, self.target)
 
         return True
+
+
+# -----------------------------------------------
+# rename clean nodes based on somw HW values
+# -----------------------------------------------
+
+
+@inventory.command()
+# @click.argument('filename', default='sample.gan')
+@click.option("--network", multiple=True)
+@click.option("--user", multiple=True)
+@click.option("--password", multiple=True)
+@click.option("--shuffle", default=True, type=bool)
+@click.pass_obj
+def fish(env, network, user, shuffle, password):
+    """
+    - [ ] Gather information similar as explore
+    - [ ] Install single node
+    """
+    config.callback()
+    extend_config(env)
+
+    conquered = dict()
+    cfg = dict(env.__dict__)
+
+    top = expandpath(INVENTORY_ROOT)
+    found = find_files(folders=[top], includes=['user.00e0670e2eb8.yaml'])
+    banner("Unassigned hosts", found)
+
+    host_name_cfg = 'hostnames.yaml'
+    host_names = yaml.load(open(host_name_cfg).read(), Loader=yaml.Loader)
+
+    host_criteria = {}
+    for host, criteria in host_names.items():
+        blueprint = {}
+        for k, v in criteria.items():
+            if '*' not in k:
+                k = f'.*{k}'
+            v = str(v)
+            blueprint[k] = v
+        host_criteria[host] = blueprint
+
+    for path in found:
+        data = yaml.load(open(path).read(), Loader=yaml.Loader)
+        for host, blueprint in host_criteria.items():
+            result = search(data, blueprint)
+            result = simplify(result)
+            if result:
+                # hostname found!
+                # ctx = dict(env.__dict__)
+                ctx = data.get('_context')
+                soft(ctx, **cfg)
+
+                print(f"{GREEN}renaming node to: {host}{RESET}")
+                rename_host(ctx, hostname=host)
+
+                print(f"{GREEN}reload node facts: {host}{RESET}")
+                data2 = explore_single_host(ctx, host)
+
+                print(f"{YELLOW}installing new node: {host}{RESET}")
+                tags = get_host_tags(data2)
+                data3 = install_single_node(tags, ctx)
+                if data3:
+                    print(
+                        f"{BLUE}deleting obsolete inventory file: {path}{RESET}"
+                    )
+                    os.unlink(path)
+
+                # rename inventory name
+
+                foo = 1
+
+        foo = 1
+
+    return
+    print(f"network: {network}")
+    print(f"user: {user}")
+    for ctx in credentials(network, user, shuffle, password, cfg):
+        soft(ctx, **cfg)
+        print("{_progress:.2%} {_printable_uri:>40}".format_map(ctx))
+        host = ctx['host']
+        if host in conquered:
+            print(f"{host} is alredy conquered! :), skiping")
+            continue
+
+        data = explore_host(ctx)
+        mac = get_mac(data)
+        if mac:
+            mac = mac.replace(':', '')
+            ctx['observed_hostname'] = observed_hostname = (
+                data.get('observed_hostname') or host
+            )
+            data = data.get('real')
+            tags = get_host_tags(data)
+            _tags = '/'.join(tags)
+            path = f"{top}/{_tags}/{observed_hostname}.{mac}.yaml"
+            print(f"saved: {path}")
+
+            save_yaml(data, path)
+            conquered[host] = data
+            conquered[observed_hostname] = data
+
+            # now the install part
+            tags.add(observed_hostname)
+            install_single_node(tags, ctx)
+            foo = 1
+
+    foo = 1
+
+
+def rename_host(ctx, hostname):
+    reactor = Reactor(env=ctx)
+
+    conn = DefaultExecutor(**ctx)
+    reactor.attach(conn)
+
+    # stm = Settler(daemon=False)
+    stm = RenameHost(hostname=hostname)
+    reactor.attach(stm)
+
+    # magic ...
+    asyncio.run(reactor.main())
+
+    foo = 1
```

## Comparing `centesimal_iot-0.1.7.dist-info/METADATA` & `centesimal_iot-0.1.8.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: centesimal-iot
-Version: 0.1.7
+Version: 0.1.8
 Summary: IoT infrastructure
 Home-page: https://github.com/asterio.gonzalez/iot
 Author: Asterio Gonzalez
 Author-email: apastor@cibernos.com
 Keywords: iot
 Classifier: Development Status :: 2 - Pre-Alpha
 Classifier: Intended Audience :: Developers
```

## Comparing `centesimal_iot-0.1.7.dist-info/RECORD` & `centesimal_iot-0.1.8.dist-info/RECORD`

 * *Files 21% similar despite different names*

```diff
@@ -1,24 +1,24 @@
-iot/__init__.py,sha256=Kjeby5I3tTX79wcXCvmLDdL8-umqOxSQu19HEd0zuog,127
+iot/__init__.py,sha256=ZP1MJ3cFDM0RN1SaZPuUKlpLqk8D5U635crhjs9Ryuc,127
 iot/cli.py,sha256=NWisFZ8exvfNi2zG1-zYdrVQ_gzuQX2bZS5kKFYiLEU,387
 iot/helpers.py,sha256=OI2cmpWFz6RFP5Nt0TiZxw5jozc8OF_D0hoNjFzndSQ,4957
 iot/iot.py,sha256=VimQ94AIw9Q9XQ4vKq8PbUezS7PNcLk_EMNYtCzS6rU,51
 iot/cli/__init__.py,sha256=sIcEEUjYgl3Ff2z1LaKtL2G8uJVrq4sIjfKWOQnXBMc,795
 iot/cli/describe.py,sha256=1JRLUaFIGXYkEfnBUAd04T3hDTGI04ynJbRsEYpAcJY,5068
-iot/cli/inventory.py,sha256=FKoK0kH3maUHt_kZGJZRAmBdPNiTbYvD2TpNSwGw33Q,6109
+iot/cli/inventory.py,sha256=puaYyryuRkIfZnv9FxMD4iaq656yK3e-8h9qOx8s0eg,9733
 iot/cli/plan.py,sha256=wGsrGpxPXnLR3Hid4hEn4NEMb0GJ0eJcbhRQJkoH0d8,2498
 iot/cli/real.py,sha256=rfVF8Omf3a6jyzenWkUTIH6tIYkglPFr0SLBrWY5AIA,2907
 iot/cli/roles.py,sha256=WNWwgUXLk9JK56EsBbS7Bk4PNYg4yWlCqQd_DKLFtkA,1622
 iot/cli/run.py,sha256=U3xMRpybPXMipDy98DB1VFR6vbRXOHyCBOGdacY8tFo,809
 iot/cli/target.py,sha256=bRXllA2pvqKORTFe_Yohmh87JkekpHTCg-qMW_RiC-A,3247
 iot/cli/test.py,sha256=C0lqt8IQEGo2cOoHR43G1jcAlkoOillZ2Q0WYfV7H1A,3246
 iot/cli/users.py,sha256=sair249wY-fG4E6ayZIpxDcI6IxVY2UcItOnc85zlwE,1795
 iot/cli/watch.py,sha256=-ZUVZEaHvuL0zbKHnzGPVjBaOzcyj6-naP4GOx0kjjQ,3258
 iot/cli/wingdbstub.py,sha256=gudSdjjvFcxHpHq7Z-oMza0o7_LehSsqtFYirFc2CV8,17520
 iot/cli/workspaces.py,sha256=6XRO-aYZy_aFXHoIbumlpHTmEFPyylMBIaR1RbI57Ns,1918
 iot/tools/__init__.py,sha256=YlZjhGRX1VYnpphuK7OrwxOxuCEnpoCwC891wH6O4u4,2759
-centesimal_iot-0.1.7.dist-info/AUTHORS.rst,sha256=DJWRsAX9L2yG7FsyDzWBb8G9Oeb0cvjnUxyPZR_5elM,162
-centesimal_iot-0.1.7.dist-info/METADATA,sha256=HUFAwjJDYQc3RBUU6Zg74RMkdGYwiJV2sonUm0x7bTU,1222
-centesimal_iot-0.1.7.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
-centesimal_iot-0.1.7.dist-info/entry_points.txt,sha256=shS0YwmHrq5G3uFwO3YHoSeUmRstZj4KcaJW-bn5CB4,37
-centesimal_iot-0.1.7.dist-info/top_level.txt,sha256=GrFBYwTe_zimcbxQb9lowAJUNeDArWJA0esDNiSx9Kw,4
-centesimal_iot-0.1.7.dist-info/RECORD,,
+centesimal_iot-0.1.8.dist-info/AUTHORS.rst,sha256=DJWRsAX9L2yG7FsyDzWBb8G9Oeb0cvjnUxyPZR_5elM,162
+centesimal_iot-0.1.8.dist-info/METADATA,sha256=sAJbbTzMQcK0RNpB_mq5QJKV5R4I8vwnAME_OjGM5Uc,1222
+centesimal_iot-0.1.8.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+centesimal_iot-0.1.8.dist-info/entry_points.txt,sha256=shS0YwmHrq5G3uFwO3YHoSeUmRstZj4KcaJW-bn5CB4,37
+centesimal_iot-0.1.8.dist-info/top_level.txt,sha256=GrFBYwTe_zimcbxQb9lowAJUNeDArWJA0esDNiSx9Kw,4
+centesimal_iot-0.1.8.dist-info/RECORD,,
```

